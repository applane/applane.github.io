function W2(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const a=Object.getOwnPropertyDescriptor(i,s);a&&Object.defineProperty(n,s,a.get?a:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function $0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Fy={exports:{}},ju={};var Xw;function V2(){if(Xw)return ju;Xw=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var o=null;if(a!==void 0&&(o=""+a),s.key!==void 0&&(o=""+s.key),"key"in s){a={};for(var c in s)c!=="key"&&(a[c]=s[c])}else a=s;return s=a.ref,{$$typeof:n,type:i,key:o,ref:s!==void 0?s:null,props:a}}return ju.Fragment=e,ju.jsx=t,ju.jsxs=t,ju}var qw;function H2(){return qw||(qw=1,Fy.exports=V2()),Fy.exports}var V=H2(),Iy={exports:{}},Vt={};var Jw;function z2(){if(Jw)return Vt;Jw=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function k(R){return R===null||typeof R!="object"?null:(R=y&&R[y]||R["@@iterator"],typeof R=="function"?R:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,T={};function x(R,te,we){this.props=R,this.context=te,this.refs=T,this.updater=we||_}x.prototype.isReactComponent={},x.prototype.setState=function(R,te){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,te,"setState")},x.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function E(){}E.prototype=x.prototype;function N(R,te,we){this.props=R,this.context=te,this.refs=T,this.updater=we||_}var v=N.prototype=new E;v.constructor=N,w(v,x.prototype),v.isPureReactComponent=!0;var L=Array.isArray;function A(){}var D={H:null,A:null,T:null,S:null},H=Object.prototype.hasOwnProperty;function J(R,te,we){var Ee=we.ref;return{$$typeof:n,type:R,key:te,ref:Ee!==void 0?Ee:null,props:we}}function K(R,te){return J(R.type,te,R.props)}function Y(R){return typeof R=="object"&&R!==null&&R.$$typeof===n}function C(R){var te={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(we){return te[we]})}var Q=/\/+/g;function Z(R,te){return typeof R=="object"&&R!==null&&R.key!=null?C(""+R.key):te.toString(36)}function le(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(A,A):(R.status="pending",R.then(function(te){R.status==="pending"&&(R.status="fulfilled",R.value=te)},function(te){R.status==="pending"&&(R.status="rejected",R.reason=te)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function F(R,te,we,Ee,qe){var je=typeof R;(je==="undefined"||je==="boolean")&&(R=null);var ze=!1;if(R===null)ze=!0;else switch(je){case"bigint":case"string":case"number":ze=!0;break;case"object":switch(R.$$typeof){case n:case e:ze=!0;break;case p:return ze=R._init,F(ze(R._payload),te,we,Ee,qe)}}if(ze)return qe=qe(R),ze=Ee===""?"."+Z(R,0):Ee,L(qe)?(we="",ze!=null&&(we=ze.replace(Q,"$&/")+"/"),F(qe,te,we,"",function(xt){return xt})):qe!=null&&(Y(qe)&&(qe=K(qe,we+(qe.key==null||R&&R.key===qe.key?"":(""+qe.key).replace(Q,"$&/")+"/")+ze)),te.push(qe)),1;ze=0;var qt=Ee===""?".":Ee+":";if(L(R))for(var Pt=0;Pt<R.length;Pt++)Ee=R[Pt],je=qt+Z(Ee,Pt),ze+=F(Ee,te,we,je,qe);else if(Pt=k(R),typeof Pt=="function")for(R=Pt.call(R),Pt=0;!(Ee=R.next()).done;)Ee=Ee.value,je=qt+Z(Ee,Pt++),ze+=F(Ee,te,we,je,qe);else if(je==="object"){if(typeof R.then=="function")return F(le(R),te,we,Ee,qe);throw te=String(R),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return ze}function re(R,te,we){if(R==null)return R;var Ee=[],qe=0;return F(R,Ee,"","",function(je){return te.call(we,je,qe++)}),Ee}function _e(R){if(R._status===-1){var te=R._result;te=te(),te.then(function(we){(R._status===0||R._status===-1)&&(R._status=1,R._result=we)},function(we){(R._status===0||R._status===-1)&&(R._status=2,R._result=we)}),R._status===-1&&(R._status=0,R._result=te)}if(R._status===1)return R._result.default;throw R._result}var ve=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},Ve={map:re,forEach:function(R,te,we){re(R,function(){te.apply(this,arguments)},we)},count:function(R){var te=0;return re(R,function(){te++}),te},toArray:function(R){return re(R,function(te){return te})||[]},only:function(R){if(!Y(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return Vt.Activity=g,Vt.Children=Ve,Vt.Component=x,Vt.Fragment=t,Vt.Profiler=s,Vt.PureComponent=N,Vt.StrictMode=i,Vt.Suspense=h,Vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Vt.__COMPILER_RUNTIME={__proto__:null,c:function(R){return D.H.useMemoCache(R)}},Vt.cache=function(R){return function(){return R.apply(null,arguments)}},Vt.cacheSignal=function(){return null},Vt.cloneElement=function(R,te,we){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var Ee=w({},R.props),qe=R.key;if(te!=null)for(je in te.key!==void 0&&(qe=""+te.key),te)!H.call(te,je)||je==="key"||je==="__self"||je==="__source"||je==="ref"&&te.ref===void 0||(Ee[je]=te[je]);var je=arguments.length-2;if(je===1)Ee.children=we;else if(1<je){for(var ze=Array(je),qt=0;qt<je;qt++)ze[qt]=arguments[qt+2];Ee.children=ze}return J(R.type,qe,Ee)},Vt.createContext=function(R){return R={$$typeof:o,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:a,_context:R},R},Vt.createElement=function(R,te,we){var Ee,qe={},je=null;if(te!=null)for(Ee in te.key!==void 0&&(je=""+te.key),te)H.call(te,Ee)&&Ee!=="key"&&Ee!=="__self"&&Ee!=="__source"&&(qe[Ee]=te[Ee]);var ze=arguments.length-2;if(ze===1)qe.children=we;else if(1<ze){for(var qt=Array(ze),Pt=0;Pt<ze;Pt++)qt[Pt]=arguments[Pt+2];qe.children=qt}if(R&&R.defaultProps)for(Ee in ze=R.defaultProps,ze)qe[Ee]===void 0&&(qe[Ee]=ze[Ee]);return J(R,je,qe)},Vt.createRef=function(){return{current:null}},Vt.forwardRef=function(R){return{$$typeof:c,render:R}},Vt.isValidElement=Y,Vt.lazy=function(R){return{$$typeof:p,_payload:{_status:-1,_result:R},_init:_e}},Vt.memo=function(R,te){return{$$typeof:d,type:R,compare:te===void 0?null:te}},Vt.startTransition=function(R){var te=D.T,we={};D.T=we;try{var Ee=R(),qe=D.S;qe!==null&&qe(we,Ee),typeof Ee=="object"&&Ee!==null&&typeof Ee.then=="function"&&Ee.then(A,ve)}catch(je){ve(je)}finally{te!==null&&we.types!==null&&(te.types=we.types),D.T=te}},Vt.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Vt.use=function(R){return D.H.use(R)},Vt.useActionState=function(R,te,we){return D.H.useActionState(R,te,we)},Vt.useCallback=function(R,te){return D.H.useCallback(R,te)},Vt.useContext=function(R){return D.H.useContext(R)},Vt.useDebugValue=function(){},Vt.useDeferredValue=function(R,te){return D.H.useDeferredValue(R,te)},Vt.useEffect=function(R,te){return D.H.useEffect(R,te)},Vt.useEffectEvent=function(R){return D.H.useEffectEvent(R)},Vt.useId=function(){return D.H.useId()},Vt.useImperativeHandle=function(R,te,we){return D.H.useImperativeHandle(R,te,we)},Vt.useInsertionEffect=function(R,te){return D.H.useInsertionEffect(R,te)},Vt.useLayoutEffect=function(R,te){return D.H.useLayoutEffect(R,te)},Vt.useMemo=function(R,te){return D.H.useMemo(R,te)},Vt.useOptimistic=function(R,te){return D.H.useOptimistic(R,te)},Vt.useReducer=function(R,te,we){return D.H.useReducer(R,te,we)},Vt.useRef=function(R){return D.H.useRef(R)},Vt.useState=function(R){return D.H.useState(R)},Vt.useSyncExternalStore=function(R,te,we){return D.H.useSyncExternalStore(R,te,we)},Vt.useTransition=function(){return D.H.useTransition()},Vt.version="19.2.3",Vt}var Qw;function X0(){return Qw||(Qw=1,Iy.exports=z2()),Iy.exports}var O=X0();const gr=$0(O),p0=W2({__proto__:null,default:gr},[O]);var Wy={exports:{}},eh={},Vy={exports:{}},Hy={};var Kw;function G2(){return Kw||(Kw=1,(function(n){function e(F,re){var _e=F.length;F.push(re);e:for(;0<_e;){var ve=_e-1>>>1,Ve=F[ve];if(0<s(Ve,re))F[ve]=re,F[_e]=Ve,_e=ve;else break e}}function t(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var re=F[0],_e=F.pop();if(_e!==re){F[0]=_e;e:for(var ve=0,Ve=F.length,R=Ve>>>1;ve<R;){var te=2*(ve+1)-1,we=F[te],Ee=te+1,qe=F[Ee];if(0>s(we,_e))Ee<Ve&&0>s(qe,we)?(F[ve]=qe,F[Ee]=_e,ve=Ee):(F[ve]=we,F[te]=_e,ve=te);else if(Ee<Ve&&0>s(qe,_e))F[ve]=qe,F[Ee]=_e,ve=Ee;else break e}}return re}function s(F,re){var _e=F.sortIndex-re.sortIndex;return _e!==0?_e:F.id-re.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();n.unstable_now=function(){return o.now()-c}}var h=[],d=[],p=1,g=null,y=3,k=!1,_=!1,w=!1,T=!1,x=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function v(F){for(var re=t(d);re!==null;){if(re.callback===null)i(d);else if(re.startTime<=F)i(d),re.sortIndex=re.expirationTime,e(h,re);else break;re=t(d)}}function L(F){if(w=!1,v(F),!_)if(t(h)!==null)_=!0,A||(A=!0,C());else{var re=t(d);re!==null&&le(L,re.startTime-F)}}var A=!1,D=-1,H=5,J=-1;function K(){return T?!0:!(n.unstable_now()-J<H)}function Y(){if(T=!1,A){var F=n.unstable_now();J=F;var re=!0;try{e:{_=!1,w&&(w=!1,E(D),D=-1),k=!0;var _e=y;try{t:{for(v(F),g=t(h);g!==null&&!(g.expirationTime>F&&K());){var ve=g.callback;if(typeof ve=="function"){g.callback=null,y=g.priorityLevel;var Ve=ve(g.expirationTime<=F);if(F=n.unstable_now(),typeof Ve=="function"){g.callback=Ve,v(F),re=!0;break t}g===t(h)&&i(h),v(F)}else i(h);g=t(h)}if(g!==null)re=!0;else{var R=t(d);R!==null&&le(L,R.startTime-F),re=!1}}break e}finally{g=null,y=_e,k=!1}re=void 0}}finally{re?C():A=!1}}}var C;if(typeof N=="function")C=function(){N(Y)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,Z=Q.port2;Q.port1.onmessage=Y,C=function(){Z.postMessage(null)}}else C=function(){x(Y,0)};function le(F,re){D=x(function(){F(n.unstable_now())},re)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(F){switch(y){case 1:case 2:case 3:var re=3;break;default:re=y}var _e=y;y=re;try{return F()}finally{y=_e}},n.unstable_requestPaint=function(){T=!0},n.unstable_runWithPriority=function(F,re){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var _e=y;y=F;try{return re()}finally{y=_e}},n.unstable_scheduleCallback=function(F,re,_e){var ve=n.unstable_now();switch(typeof _e=="object"&&_e!==null?(_e=_e.delay,_e=typeof _e=="number"&&0<_e?ve+_e:ve):_e=ve,F){case 1:var Ve=-1;break;case 2:Ve=250;break;case 5:Ve=1073741823;break;case 4:Ve=1e4;break;default:Ve=5e3}return Ve=_e+Ve,F={id:p++,callback:re,priorityLevel:F,startTime:_e,expirationTime:Ve,sortIndex:-1},_e>ve?(F.sortIndex=_e,e(d,F),t(h)===null&&F===t(d)&&(w?(E(D),D=-1):w=!0,le(L,_e-ve))):(F.sortIndex=Ve,e(h,F),_||k||(_=!0,A||(A=!0,C()))),F},n.unstable_shouldYield=K,n.unstable_wrapCallback=function(F){var re=y;return function(){var _e=y;y=re;try{return F.apply(this,arguments)}finally{y=_e}}}})(Hy)),Hy}var Zw;function U2(){return Zw||(Zw=1,Vy.exports=G2()),Vy.exports}var zy={exports:{}},_n={};var jw;function Y2(){if(jw)return _n;jw=1;var n=X0();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(h,d,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:g==null?null:""+g,children:h,containerInfo:d,implementation:p}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return _n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,_n.createPortal=function(h,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,p)},_n.flushSync=function(h){var d=o.T,p=i.p;try{if(o.T=null,i.p=2,h)return h()}finally{o.T=d,i.p=p,i.d.f()}},_n.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},_n.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},_n.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var p=d.as,g=c(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,k=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:k}):p==="script"&&i.d.X(h,{crossOrigin:g,integrity:y,fetchPriority:k,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},_n.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=c(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},_n.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,g=c(p,d.crossOrigin);i.d.L(h,p,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},_n.preloadModule=function(h,d){if(typeof h=="string")if(d){var p=c(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},_n.requestFormReset=function(h){i.d.r(h)},_n.unstable_batchedUpdates=function(h,d){return h(d)},_n.useFormState=function(h,d,p){return o.H.useFormState(h,d,p)},_n.useFormStatus=function(){return o.H.useHostTransitionStatus()},_n.version="19.2.3",_n}var e1;function hT(){if(e1)return zy.exports;e1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),zy.exports=Y2(),zy.exports}var t1;function $2(){if(t1)return eh;t1=1;var n=U2(),e=X0(),t=hT();function i(r){var l="https://react.dev/errors/"+r;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function a(r){var l=r,u=r;if(r.alternate)for(;l.return;)l=l.return;else{r=l;do l=r,(l.flags&4098)!==0&&(u=l.return),r=l.return;while(r)}return l.tag===3?u:null}function o(r){if(r.tag===13){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function c(r){if(r.tag===31){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function h(r){if(a(r)!==r)throw Error(i(188))}function d(r){var l=r.alternate;if(!l){if(l=a(r),l===null)throw Error(i(188));return l!==r?null:r}for(var u=r,f=l;;){var m=u.return;if(m===null)break;var b=m.alternate;if(b===null){if(f=m.return,f!==null){u=f;continue}break}if(m.child===b.child){for(b=m.child;b;){if(b===u)return h(m),r;if(b===f)return h(m),l;b=b.sibling}throw Error(i(188))}if(u.return!==f.return)u=m,f=b;else{for(var B=!1,P=m.child;P;){if(P===u){B=!0,u=m,f=b;break}if(P===f){B=!0,f=m,u=b;break}P=P.sibling}if(!B){for(P=b.child;P;){if(P===u){B=!0,u=b,f=m;break}if(P===f){B=!0,f=b,u=m;break}P=P.sibling}if(!B)throw Error(i(189))}}if(u.alternate!==f)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?r:l}function p(r){var l=r.tag;if(l===5||l===26||l===27||l===6)return r;for(r=r.child;r!==null;){if(l=p(r),l!==null)return l;r=r.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),k=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),N=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),K=Symbol.for("react.memo_cache_sentinel"),Y=Symbol.iterator;function C(r){return r===null||typeof r!="object"?null:(r=Y&&r[Y]||r["@@iterator"],typeof r=="function"?r:null)}var Q=Symbol.for("react.client.reference");function Z(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Q?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case w:return"Fragment";case x:return"Profiler";case T:return"StrictMode";case L:return"Suspense";case A:return"SuspenseList";case J:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case _:return"Portal";case N:return r.displayName||"Context";case E:return(r._context.displayName||"Context")+".Consumer";case v:var l=r.render;return r=r.displayName,r||(r=l.displayName||l.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case D:return l=r.displayName||null,l!==null?l:Z(r.type)||"Memo";case H:l=r._payload,r=r._init;try{return Z(r(l))}catch{}}return null}var le=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_e={pending:!1,data:null,method:null,action:null},ve=[],Ve=-1;function R(r){return{current:r}}function te(r){0>Ve||(r.current=ve[Ve],ve[Ve]=null,Ve--)}function we(r,l){Ve++,ve[Ve]=r.current,r.current=l}var Ee=R(null),qe=R(null),je=R(null),ze=R(null);function qt(r,l){switch(we(je,l),we(qe,r),we(Ee,null),l.nodeType){case 9:case 11:r=(r=l.documentElement)&&(r=r.namespaceURI)?mw(r):0;break;default:if(r=l.tagName,l=l.namespaceURI)l=mw(l),r=yw(l,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}te(Ee),we(Ee,r)}function Pt(){te(Ee),te(qe),te(je)}function xt(r){r.memoizedState!==null&&we(ze,r);var l=Ee.current,u=yw(l,r.type);l!==u&&(we(qe,r),we(Ee,u))}function zt(r){qe.current===r&&(te(Ee),te(qe)),ze.current===r&&(te(ze),Ju._currentValue=_e)}var Ut,yi;function St(r){if(Ut===void 0)try{throw Error()}catch(u){var l=u.stack.trim().match(/\n( *(at )?)/);Ut=l&&l[1]||"",yi=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ut+r+yi}var ri=!1;function Ms(r,l){if(!r||ri)return"";ri=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(l){var Be=function(){throw Error()};if(Object.defineProperty(Be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Be,[])}catch(ue){var ae=ue}Reflect.construct(r,[],Be)}else{try{Be.call()}catch(ue){ae=ue}r.call(Be.prototype)}}else{try{throw Error()}catch(ue){ae=ue}(Be=r())&&typeof Be.catch=="function"&&Be.catch(function(){})}}catch(ue){if(ue&&ae&&typeof ue.stack=="string")return[ue.stack,ae.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=f.DetermineComponentFrameRoot(),B=b[0],P=b[1];if(B&&P){var W=B.split(`
`),se=P.split(`
`);for(m=f=0;f<W.length&&!W[f].includes("DetermineComponentFrameRoot");)f++;for(;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;if(f===W.length||m===se.length)for(f=W.length-1,m=se.length-1;1<=f&&0<=m&&W[f]!==se[m];)m--;for(;1<=f&&0<=m;f--,m--)if(W[f]!==se[m]){if(f!==1||m!==1)do if(f--,m--,0>m||W[f]!==se[m]){var ge=`
`+W[f].replace(" at new "," at ");return r.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",r.displayName)),ge}while(1<=f&&0<=m);break}}}finally{ri=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?St(u):""}function di(r,l){switch(r.tag){case 26:case 27:case 5:return St(r.type);case 16:return St("Lazy");case 13:return r.child!==l&&l!==null?St("Suspense Fallback"):St("Suspense");case 19:return St("SuspenseList");case 0:case 15:return Ms(r.type,!1);case 11:return Ms(r.type.render,!1);case 1:return Ms(r.type,!0);case 31:return St("Activity");default:return""}}function Ni(r){try{var l="",u=null;do l+=di(r,u),u=r,r=r.return;while(r);return l}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Mi=Object.prototype.hasOwnProperty,Ss=n.unstable_scheduleCallback,Ci=n.unstable_cancelCallback,tt=n.unstable_shouldYield,bn=n.unstable_requestPaint,Zt=n.unstable_now,He=n.unstable_getCurrentPriorityLevel,Me=n.unstable_ImmediatePriority,Ge=n.unstable_UserBlockingPriority,pt=n.unstable_NormalPriority,kt=n.unstable_LowPriority,Et=n.unstable_IdlePriority,Yt=n.log,ps=n.unstable_setDisableYieldValue,bi=null,Hi=null;function Sn(r){if(typeof Yt=="function"&&ps(r),Hi&&typeof Hi.setStrictMode=="function")try{Hi.setStrictMode(bi,r)}catch{}}var Qs=Math.clz32?Math.clz32:_s,dt=Math.log,Li=Math.LN2;function _s(r){return r>>>=0,r===0?32:31-(dt(r)/Li|0)|0}var Nn=256,wr=262144,os=4194304;function ls(r){var l=r&42;if(l!==0)return l;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function oo(r,l,u){var f=r.pendingLanes;if(f===0)return 0;var m=0,b=r.suspendedLanes,B=r.pingedLanes;r=r.warmLanes;var P=f&134217727;return P!==0?(f=P&~b,f!==0?m=ls(f):(B&=P,B!==0?m=ls(B):u||(u=P&~r,u!==0&&(m=ls(u))))):(P=f&~b,P!==0?m=ls(P):B!==0?m=ls(B):u||(u=f&~r,u!==0&&(m=ls(u)))),m===0?0:l!==0&&l!==m&&(l&b)===0&&(b=m&-m,u=l&-l,b>=u||b===32&&(u&4194048)!==0)?l:m}function er(r,l){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&l)===0}function Ra(r,l){switch(r){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kb(){var r=os;return os<<=1,(os&62914560)===0&&(os=4194304),r}function xg(r){for(var l=[],u=0;31>u;u++)l.push(r);return l}function cu(r,l){r.pendingLanes|=l,l!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Nv(r,l,u,f,m,b){var B=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var P=r.entanglements,W=r.expirationTimes,se=r.hiddenUpdates;for(u=B&~u;0<u;){var ge=31-Qs(u),Be=1<<ge;P[ge]=0,W[ge]=-1;var ae=se[ge];if(ae!==null)for(se[ge]=null,ge=0;ge<ae.length;ge++){var ue=ae[ge];ue!==null&&(ue.lane&=-536870913)}u&=~Be}f!==0&&Zb(r,f,0),b!==0&&m===0&&r.tag!==0&&(r.suspendedLanes|=b&~(B&~l))}function Zb(r,l,u){r.pendingLanes|=l,r.suspendedLanes&=~l;var f=31-Qs(l);r.entangledLanes|=l,r.entanglements[f]=r.entanglements[f]|1073741824|u&261930}function jb(r,l){var u=r.entangledLanes|=l;for(r=r.entanglements;u;){var f=31-Qs(u),m=1<<f;m&l|r[f]&l&&(r[f]|=l),u&=~m}}function eS(r,l){var u=l&-l;return u=(u&42)!==0?1:vg(u),(u&(r.suspendedLanes|l))!==0?0:u}function vg(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Ng(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function tS(){var r=re.p;return r!==0?r:(r=window.event,r===void 0?32:Vw(r.type))}function iS(r,l){var u=re.p;try{return re.p=r,l()}finally{re.p=u}}var lo=Math.random().toString(36).slice(2),on="__reactFiber$"+lo,Rn="__reactProps$"+lo,Ul="__reactContainer$"+lo,Cg="__reactEvents$"+lo,Cv="__reactListeners$"+lo,Ev="__reactHandles$"+lo,sS="__reactResources$"+lo,uu="__reactMarker$"+lo;function Eg(r){delete r[on],delete r[Rn],delete r[Cg],delete r[Cv],delete r[Ev]}function Yl(r){var l=r[on];if(l)return l;for(var u=r.parentNode;u;){if(l=u[Ul]||u[on]){if(u=l.alternate,l.child!==null||u!==null&&u.child!==null)for(r=Tw(r);r!==null;){if(u=r[on])return u;r=Tw(r)}return l}r=u,u=r.parentNode}return null}function $l(r){if(r=r[on]||r[Ul]){var l=r.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return r}return null}function hu(r){var l=r.tag;if(l===5||l===26||l===27||l===6)return r.stateNode;throw Error(i(33))}function Xl(r){var l=r[sS];return l||(l=r[sS]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Ks(r){r[uu]=!0}var nS=new Set,aS={};function sl(r,l){ql(r,l),ql(r+"Capture",l)}function ql(r,l){for(aS[r]=l,r=0;r<l.length;r++)nS.add(l[r])}var Pv=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rS={},oS={};function Dv(r){return Mi.call(oS,r)?!0:Mi.call(rS,r)?!1:Pv.test(r)?oS[r]=!0:(rS[r]=!0,!1)}function od(r,l,u){if(Dv(l))if(u===null)r.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(l);return;case"boolean":var f=l.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(l);return}}r.setAttribute(l,""+u)}}function ld(r,l,u){if(u===null)r.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(l);return}r.setAttribute(l,""+u)}}function Br(r,l,u,f){if(f===null)r.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(l,u,""+f)}}function pa(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function lS(r){var l=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Mv(r,l,u){var f=Object.getOwnPropertyDescriptor(r.constructor.prototype,l);if(!r.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var m=f.get,b=f.set;return Object.defineProperty(r,l,{configurable:!0,get:function(){return m.call(this)},set:function(B){u=""+B,b.call(this,B)}}),Object.defineProperty(r,l,{enumerable:f.enumerable}),{getValue:function(){return u},setValue:function(B){u=""+B},stopTracking:function(){r._valueTracker=null,delete r[l]}}}}function Pg(r){if(!r._valueTracker){var l=lS(r)?"checked":"value";r._valueTracker=Mv(r,l,""+r[l])}}function cS(r){if(!r)return!1;var l=r._valueTracker;if(!l)return!0;var u=l.getValue(),f="";return r&&(f=lS(r)?r.checked?"true":"false":r.value),r=f,r!==u?(l.setValue(r),!0):!1}function cd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Lv=/[\n"\\]/g;function ga(r){return r.replace(Lv,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Dg(r,l,u,f,m,b,B,P){r.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?r.type=B:r.removeAttribute("type"),l!=null?B==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+pa(l)):r.value!==""+pa(l)&&(r.value=""+pa(l)):B!=="submit"&&B!=="reset"||r.removeAttribute("value"),l!=null?Mg(r,B,pa(l)):u!=null?Mg(r,B,pa(u)):f!=null&&r.removeAttribute("value"),m==null&&b!=null&&(r.defaultChecked=!!b),m!=null&&(r.checked=m&&typeof m!="function"&&typeof m!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?r.name=""+pa(P):r.removeAttribute("name")}function uS(r,l,u,f,m,b,B,P){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.type=b),l!=null||u!=null){if(!(b!=="submit"&&b!=="reset"||l!=null)){Pg(r);return}u=u!=null?""+pa(u):"",l=l!=null?""+pa(l):u,P||l===r.value||(r.value=l),r.defaultValue=l}f=f??m,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=P?r.checked:!!f,r.defaultChecked=!!f,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(r.name=B),Pg(r)}function Mg(r,l,u){l==="number"&&cd(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function Jl(r,l,u,f){if(r=r.options,l){l={};for(var m=0;m<u.length;m++)l["$"+u[m]]=!0;for(u=0;u<r.length;u++)m=l.hasOwnProperty("$"+r[u].value),r[u].selected!==m&&(r[u].selected=m),m&&f&&(r[u].defaultSelected=!0)}else{for(u=""+pa(u),l=null,m=0;m<r.length;m++){if(r[m].value===u){r[m].selected=!0,f&&(r[m].defaultSelected=!0);return}l!==null||r[m].disabled||(l=r[m])}l!==null&&(l.selected=!0)}}function hS(r,l,u){if(l!=null&&(l=""+pa(l),l!==r.value&&(r.value=l),u==null)){r.defaultValue!==l&&(r.defaultValue=l);return}r.defaultValue=u!=null?""+pa(u):""}function dS(r,l,u,f){if(l==null){if(f!=null){if(u!=null)throw Error(i(92));if(le(f)){if(1<f.length)throw Error(i(93));f=f[0]}u=f}u==null&&(u=""),l=u}u=pa(l),r.defaultValue=u,f=r.textContent,f===u&&f!==""&&f!==null&&(r.value=f),Pg(r)}function Ql(r,l){if(l){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=l;return}}r.textContent=l}var Av=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function fS(r,l,u){var f=l.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?r.setProperty(l,""):l==="float"?r.cssFloat="":r[l]="":f?r.setProperty(l,u):typeof u!="number"||u===0||Av.has(l)?l==="float"?r.cssFloat=u:r[l]=(""+u).trim():r[l]=u+"px"}function pS(r,l,u){if(l!=null&&typeof l!="object")throw Error(i(62));if(r=r.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||l!=null&&l.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var m in l)f=l[m],l.hasOwnProperty(m)&&u[m]!==f&&fS(r,m,f)}else for(var b in l)l.hasOwnProperty(b)&&fS(r,b,l[b])}function Lg(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ov=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ud(r){return Ov.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Tr(){}var Ag=null;function Rg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Kl=null,Zl=null;function gS(r){var l=$l(r);if(l&&(r=l.stateNode)){var u=r[Rn]||null;e:switch(r=l.stateNode,l.type){case"input":if(Dg(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),l=u.name,u.type==="radio"&&l!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ga(""+l)+'"][type="radio"]'),l=0;l<u.length;l++){var f=u[l];if(f!==r&&f.form===r.form){var m=f[Rn]||null;if(!m)throw Error(i(90));Dg(f,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(l=0;l<u.length;l++)f=u[l],f.form===r.form&&cS(f)}break e;case"textarea":hS(r,u.value,u.defaultValue);break e;case"select":l=u.value,l!=null&&Jl(r,!!u.multiple,l,!1)}}}var Og=!1;function mS(r,l,u){if(Og)return r(l,u);Og=!0;try{var f=r(l);return f}finally{if(Og=!1,(Kl!==null||Zl!==null)&&(Kd(),Kl&&(l=Kl,r=Zl,Zl=Kl=null,gS(l),r)))for(l=0;l<r.length;l++)gS(r[l])}}function du(r,l){var u=r.stateNode;if(u===null)return null;var f=u[Rn]||null;if(f===null)return null;u=f[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(i(231,l,typeof u));return u}var xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fg=!1;if(xr)try{var fu={};Object.defineProperty(fu,"passive",{get:function(){Fg=!0}}),window.addEventListener("test",fu,fu),window.removeEventListener("test",fu,fu)}catch{Fg=!1}var co=null,Ig=null,hd=null;function yS(){if(hd)return hd;var r,l=Ig,u=l.length,f,m="value"in co?co.value:co.textContent,b=m.length;for(r=0;r<u&&l[r]===m[r];r++);var B=u-r;for(f=1;f<=B&&l[u-f]===m[b-f];f++);return hd=m.slice(r,1<f?1-f:void 0)}function dd(r){var l=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&l===13&&(r=13)):r=l,r===10&&(r=13),32<=r||r===13?r:0}function fd(){return!0}function bS(){return!1}function On(r){function l(u,f,m,b,B){this._reactName=u,this._targetInst=m,this.type=f,this.nativeEvent=b,this.target=B,this.currentTarget=null;for(var P in r)r.hasOwnProperty(P)&&(u=r[P],this[P]=u?u(b):b[P]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?fd:bS,this.isPropagationStopped=bS,this}return g(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=fd)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=fd)},persist:function(){},isPersistent:fd}),l}var nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pd=On(nl),pu=g({},nl,{view:0,detail:0}),Fv=On(pu),Wg,Vg,gu,gd=g({},pu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==gu&&(gu&&r.type==="mousemove"?(Wg=r.screenX-gu.screenX,Vg=r.screenY-gu.screenY):Vg=Wg=0,gu=r),Wg)},movementY:function(r){return"movementY"in r?r.movementY:Vg}}),SS=On(gd),Iv=g({},gd,{dataTransfer:0}),Wv=On(Iv),Vv=g({},pu,{relatedTarget:0}),Hg=On(Vv),Hv=g({},nl,{animationName:0,elapsedTime:0,pseudoElement:0}),zv=On(Hv),Gv=g({},nl,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Uv=On(Gv),Yv=g({},nl,{data:0}),_S=On(Yv),$v={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jv(r){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(r):(r=qv[r])?!!l[r]:!1}function zg(){return Jv}var Qv=g({},pu,{key:function(r){if(r.key){var l=$v[r.key]||r.key;if(l!=="Unidentified")return l}return r.type==="keypress"?(r=dd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Xv[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zg,charCode:function(r){return r.type==="keypress"?dd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?dd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Kv=On(Qv),Zv=g({},gd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kS=On(Zv),jv=g({},pu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zg}),eN=On(jv),tN=g({},nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),iN=On(tN),sN=g({},gd,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),nN=On(sN),aN=g({},nl,{newState:0,oldState:0}),rN=On(aN),oN=[9,13,27,32],Gg=xr&&"CompositionEvent"in window,mu=null;xr&&"documentMode"in document&&(mu=document.documentMode);var lN=xr&&"TextEvent"in window&&!mu,wS=xr&&(!Gg||mu&&8<mu&&11>=mu),BS=" ",TS=!1;function xS(r,l){switch(r){case"keyup":return oN.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vS(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var jl=!1;function cN(r,l){switch(r){case"compositionend":return vS(l);case"keypress":return l.which!==32?null:(TS=!0,BS);case"textInput":return r=l.data,r===BS&&TS?null:r;default:return null}}function uN(r,l){if(jl)return r==="compositionend"||!Gg&&xS(r,l)?(r=yS(),hd=Ig=co=null,jl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return wS&&l.locale!=="ko"?null:l.data;default:return null}}var hN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NS(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l==="input"?!!hN[r.type]:l==="textarea"}function CS(r,l,u,f){Kl?Zl?Zl.push(f):Zl=[f]:Kl=f,l=af(l,"onChange"),0<l.length&&(u=new pd("onChange","change",null,u,f),r.push({event:u,listeners:l}))}var yu=null,bu=null;function dN(r){uw(r,0)}function md(r){var l=hu(r);if(cS(l))return r}function ES(r,l){if(r==="change")return l}var PS=!1;if(xr){var Ug;if(xr){var Yg="oninput"in document;if(!Yg){var DS=document.createElement("div");DS.setAttribute("oninput","return;"),Yg=typeof DS.oninput=="function"}Ug=Yg}else Ug=!1;PS=Ug&&(!document.documentMode||9<document.documentMode)}function MS(){yu&&(yu.detachEvent("onpropertychange",LS),bu=yu=null)}function LS(r){if(r.propertyName==="value"&&md(bu)){var l=[];CS(l,bu,r,Rg(r)),mS(dN,l)}}function fN(r,l,u){r==="focusin"?(MS(),yu=l,bu=u,yu.attachEvent("onpropertychange",LS)):r==="focusout"&&MS()}function pN(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return md(bu)}function gN(r,l){if(r==="click")return md(l)}function mN(r,l){if(r==="input"||r==="change")return md(l)}function yN(r,l){return r===l&&(r!==0||1/r===1/l)||r!==r&&l!==l}var qn=typeof Object.is=="function"?Object.is:yN;function Su(r,l){if(qn(r,l))return!0;if(typeof r!="object"||r===null||typeof l!="object"||l===null)return!1;var u=Object.keys(r),f=Object.keys(l);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var m=u[f];if(!Mi.call(l,m)||!qn(r[m],l[m]))return!1}return!0}function AS(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function RS(r,l){var u=AS(r);r=0;for(var f;u;){if(u.nodeType===3){if(f=r+u.textContent.length,r<=l&&f>=l)return{node:u,offset:l-r};r=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=AS(u)}}function OS(r,l){return r&&l?r===l?!0:r&&r.nodeType===3?!1:l&&l.nodeType===3?OS(r,l.parentNode):"contains"in r?r.contains(l):r.compareDocumentPosition?!!(r.compareDocumentPosition(l)&16):!1:!1}function FS(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var l=cd(r.document);l instanceof r.HTMLIFrameElement;){try{var u=typeof l.contentWindow.location.href=="string"}catch{u=!1}if(u)r=l.contentWindow;else break;l=cd(r.document)}return l}function $g(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l&&(l==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||l==="textarea"||r.contentEditable==="true")}var bN=xr&&"documentMode"in document&&11>=document.documentMode,ec=null,Xg=null,_u=null,qg=!1;function IS(r,l,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;qg||ec==null||ec!==cd(f)||(f=ec,"selectionStart"in f&&$g(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),_u&&Su(_u,f)||(_u=f,f=af(Xg,"onSelect"),0<f.length&&(l=new pd("onSelect","select",null,l,u),r.push({event:l,listeners:f}),l.target=ec)))}function al(r,l){var u={};return u[r.toLowerCase()]=l.toLowerCase(),u["Webkit"+r]="webkit"+l,u["Moz"+r]="moz"+l,u}var tc={animationend:al("Animation","AnimationEnd"),animationiteration:al("Animation","AnimationIteration"),animationstart:al("Animation","AnimationStart"),transitionrun:al("Transition","TransitionRun"),transitionstart:al("Transition","TransitionStart"),transitioncancel:al("Transition","TransitionCancel"),transitionend:al("Transition","TransitionEnd")},Jg={},WS={};xr&&(WS=document.createElement("div").style,"AnimationEvent"in window||(delete tc.animationend.animation,delete tc.animationiteration.animation,delete tc.animationstart.animation),"TransitionEvent"in window||delete tc.transitionend.transition);function rl(r){if(Jg[r])return Jg[r];if(!tc[r])return r;var l=tc[r],u;for(u in l)if(l.hasOwnProperty(u)&&u in WS)return Jg[r]=l[u];return r}var VS=rl("animationend"),HS=rl("animationiteration"),zS=rl("animationstart"),SN=rl("transitionrun"),_N=rl("transitionstart"),kN=rl("transitioncancel"),GS=rl("transitionend"),US=new Map,Qg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qg.push("scrollEnd");function Oa(r,l){US.set(r,l),sl(l,[r])}var yd=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},ma=[],ic=0,Kg=0;function bd(){for(var r=ic,l=Kg=ic=0;l<r;){var u=ma[l];ma[l++]=null;var f=ma[l];ma[l++]=null;var m=ma[l];ma[l++]=null;var b=ma[l];if(ma[l++]=null,f!==null&&m!==null){var B=f.pending;B===null?m.next=m:(m.next=B.next,B.next=m),f.pending=m}b!==0&&YS(u,m,b)}}function Sd(r,l,u,f){ma[ic++]=r,ma[ic++]=l,ma[ic++]=u,ma[ic++]=f,Kg|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function Zg(r,l,u,f){return Sd(r,l,u,f),_d(r)}function ol(r,l){return Sd(r,null,null,l),_d(r)}function YS(r,l,u){r.lanes|=u;var f=r.alternate;f!==null&&(f.lanes|=u);for(var m=!1,b=r.return;b!==null;)b.childLanes|=u,f=b.alternate,f!==null&&(f.childLanes|=u),b.tag===22&&(r=b.stateNode,r===null||r._visibility&1||(m=!0)),r=b,b=b.return;return r.tag===3?(b=r.stateNode,m&&l!==null&&(m=31-Qs(u),r=b.hiddenUpdates,f=r[m],f===null?r[m]=[l]:f.push(l),l.lane=u|536870912),b):null}function _d(r){if(50<zu)throw zu=0,oy=null,Error(i(185));for(var l=r.return;l!==null;)r=l,l=r.return;return r.tag===3?r.stateNode:null}var sc={};function wN(r,l,u,f){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(r,l,u,f){return new wN(r,l,u,f)}function jg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function vr(r,l){var u=r.alternate;return u===null?(u=Jn(r.tag,l,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=l,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&65011712,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,l=r.dependencies,u.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function $S(r,l){r.flags&=65011714;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=l,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,l=u.dependencies,r.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),r}function kd(r,l,u,f,m,b){var B=0;if(f=r,typeof r=="function")jg(r)&&(B=1);else if(typeof r=="string")B=N2(r,u,Ee.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case J:return r=Jn(31,u,l,m),r.elementType=J,r.lanes=b,r;case w:return ll(u.children,m,b,l);case T:B=8,m|=24;break;case x:return r=Jn(12,u,l,m|2),r.elementType=x,r.lanes=b,r;case L:return r=Jn(13,u,l,m),r.elementType=L,r.lanes=b,r;case A:return r=Jn(19,u,l,m),r.elementType=A,r.lanes=b,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case N:B=10;break e;case E:B=9;break e;case v:B=11;break e;case D:B=14;break e;case H:B=16,f=null;break e}B=29,u=Error(i(130,r===null?"null":typeof r,"")),f=null}return l=Jn(B,u,l,m),l.elementType=r,l.type=f,l.lanes=b,l}function ll(r,l,u,f){return r=Jn(7,r,f,l),r.lanes=u,r}function em(r,l,u){return r=Jn(6,r,null,l),r.lanes=u,r}function XS(r){var l=Jn(18,null,null,0);return l.stateNode=r,l}function tm(r,l,u){return l=Jn(4,r.children!==null?r.children:[],r.key,l),l.lanes=u,l.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},l}var qS=new WeakMap;function ya(r,l){if(typeof r=="object"&&r!==null){var u=qS.get(r);return u!==void 0?u:(l={value:r,source:l,stack:Ni(l)},qS.set(r,l),l)}return{value:r,source:l,stack:Ni(l)}}var nc=[],ac=0,wd=null,ku=0,ba=[],Sa=0,uo=null,tr=1,ir="";function Nr(r,l){nc[ac++]=ku,nc[ac++]=wd,wd=r,ku=l}function JS(r,l,u){ba[Sa++]=tr,ba[Sa++]=ir,ba[Sa++]=uo,uo=r;var f=tr;r=ir;var m=32-Qs(f)-1;f&=~(1<<m),u+=1;var b=32-Qs(l)+m;if(30<b){var B=m-m%5;b=(f&(1<<B)-1).toString(32),f>>=B,m-=B,tr=1<<32-Qs(l)+m|u<<m|f,ir=b+r}else tr=1<<b|u<<m|f,ir=r}function im(r){r.return!==null&&(Nr(r,1),JS(r,1,0))}function sm(r){for(;r===wd;)wd=nc[--ac],nc[ac]=null,ku=nc[--ac],nc[ac]=null;for(;r===uo;)uo=ba[--Sa],ba[Sa]=null,ir=ba[--Sa],ba[Sa]=null,tr=ba[--Sa],ba[Sa]=null}function QS(r,l){ba[Sa++]=tr,ba[Sa++]=ir,ba[Sa++]=uo,tr=l.id,ir=l.overflow,uo=r}var ln=null,cs=null,ui=!1,ho=null,_a=!1,nm=Error(i(519));function fo(r){var l=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw wu(ya(l,r)),nm}function KS(r){var l=r.stateNode,u=r.type,f=r.memoizedProps;switch(l[on]=r,l[Rn]=f,u){case"dialog":si("cancel",l),si("close",l);break;case"iframe":case"object":case"embed":si("load",l);break;case"video":case"audio":for(u=0;u<Uu.length;u++)si(Uu[u],l);break;case"source":si("error",l);break;case"img":case"image":case"link":si("error",l),si("load",l);break;case"details":si("toggle",l);break;case"input":si("invalid",l),uS(l,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":si("invalid",l);break;case"textarea":si("invalid",l),dS(l,f.value,f.defaultValue,f.children)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||l.textContent===""+u||f.suppressHydrationWarning===!0||pw(l.textContent,u)?(f.popover!=null&&(si("beforetoggle",l),si("toggle",l)),f.onScroll!=null&&si("scroll",l),f.onScrollEnd!=null&&si("scrollend",l),f.onClick!=null&&(l.onclick=Tr),l=!0):l=!1,l||fo(r,!0)}function ZS(r){for(ln=r.return;ln;)switch(ln.tag){case 5:case 31:case 13:_a=!1;return;case 27:case 3:_a=!0;return;default:ln=ln.return}}function rc(r){if(r!==ln)return!1;if(!ui)return ZS(r),ui=!0,!1;var l=r.tag,u;if((u=l!==3&&l!==27)&&((u=l===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||wy(r.type,r.memoizedProps)),u=!u),u&&cs&&fo(r),ZS(r),l===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));cs=Bw(r)}else if(l===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));cs=Bw(r)}else l===27?(l=cs,No(r.type)?(r=Ny,Ny=null,cs=r):cs=l):cs=ln?wa(r.stateNode.nextSibling):null;return!0}function cl(){cs=ln=null,ui=!1}function am(){var r=ho;return r!==null&&(Vn===null?Vn=r:Vn.push.apply(Vn,r),ho=null),r}function wu(r){ho===null?ho=[r]:ho.push(r)}var rm=R(null),ul=null,Cr=null;function po(r,l,u){we(rm,l._currentValue),l._currentValue=u}function Er(r){r._currentValue=rm.current,te(rm)}function om(r,l,u){for(;r!==null;){var f=r.alternate;if((r.childLanes&l)!==l?(r.childLanes|=l,f!==null&&(f.childLanes|=l)):f!==null&&(f.childLanes&l)!==l&&(f.childLanes|=l),r===u)break;r=r.return}}function lm(r,l,u,f){var m=r.child;for(m!==null&&(m.return=r);m!==null;){var b=m.dependencies;if(b!==null){var B=m.child;b=b.firstContext;e:for(;b!==null;){var P=b;b=m;for(var W=0;W<l.length;W++)if(P.context===l[W]){b.lanes|=u,P=b.alternate,P!==null&&(P.lanes|=u),om(b.return,u,r),f||(B=null);break e}b=P.next}}else if(m.tag===18){if(B=m.return,B===null)throw Error(i(341));B.lanes|=u,b=B.alternate,b!==null&&(b.lanes|=u),om(B,u,r),B=null}else B=m.child;if(B!==null)B.return=m;else for(B=m;B!==null;){if(B===r){B=null;break}if(m=B.sibling,m!==null){m.return=B.return,B=m;break}B=B.return}m=B}}function oc(r,l,u,f){r=null;for(var m=l,b=!1;m!==null;){if(!b){if((m.flags&524288)!==0)b=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var B=m.alternate;if(B===null)throw Error(i(387));if(B=B.memoizedProps,B!==null){var P=m.type;qn(m.pendingProps.value,B.value)||(r!==null?r.push(P):r=[P])}}else if(m===ze.current){if(B=m.alternate,B===null)throw Error(i(387));B.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(r!==null?r.push(Ju):r=[Ju])}m=m.return}r!==null&&lm(l,r,u,f),l.flags|=262144}function Bd(r){for(r=r.firstContext;r!==null;){if(!qn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function hl(r){ul=r,Cr=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function cn(r){return jS(ul,r)}function Td(r,l){return ul===null&&hl(r),jS(r,l)}function jS(r,l){var u=l._currentValue;if(l={context:l,memoizedValue:u,next:null},Cr===null){if(r===null)throw Error(i(308));Cr=l,r.dependencies={lanes:0,firstContext:l},r.flags|=524288}else Cr=Cr.next=l;return u}var BN=typeof AbortController<"u"?AbortController:function(){var r=[],l=this.signal={aborted:!1,addEventListener:function(u,f){r.push(f)}};this.abort=function(){l.aborted=!0,r.forEach(function(u){return u()})}},TN=n.unstable_scheduleCallback,xN=n.unstable_NormalPriority,Is={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cm(){return{controller:new BN,data:new Map,refCount:0}}function Bu(r){r.refCount--,r.refCount===0&&TN(xN,function(){r.controller.abort()})}var Tu=null,um=0,lc=0,cc=null;function vN(r,l){if(Tu===null){var u=Tu=[];um=0,lc=fy(),cc={status:"pending",value:void 0,then:function(f){u.push(f)}}}return um++,l.then(e_,e_),l}function e_(){if(--um===0&&Tu!==null){cc!==null&&(cc.status="fulfilled");var r=Tu;Tu=null,lc=0,cc=null;for(var l=0;l<r.length;l++)(0,r[l])()}}function NN(r,l){var u=[],f={status:"pending",value:null,reason:null,then:function(m){u.push(m)}};return r.then(function(){f.status="fulfilled",f.value=l;for(var m=0;m<u.length;m++)(0,u[m])(l)},function(m){for(f.status="rejected",f.reason=m,m=0;m<u.length;m++)(0,u[m])(void 0)}),f}var t_=F.S;F.S=function(r,l){Ik=Zt(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&vN(r,l),t_!==null&&t_(r,l)};var dl=R(null);function hm(){var r=dl.current;return r!==null?r:ji.pooledCache}function xd(r,l){l===null?we(dl,dl.current):we(dl,l.pool)}function i_(){var r=hm();return r===null?null:{parent:Is._currentValue,pool:r}}var uc=Error(i(460)),dm=Error(i(474)),vd=Error(i(542)),Nd={then:function(){}};function s_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function n_(r,l,u){switch(u=r[u],u===void 0?r.push(l):u!==l&&(l.then(Tr,Tr),l=u),l.status){case"fulfilled":return l.value;case"rejected":throw r=l.reason,r_(r),r;default:if(typeof l.status=="string")l.then(Tr,Tr);else{if(r=ji,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=l,r.status="pending",r.then(function(f){if(l.status==="pending"){var m=l;m.status="fulfilled",m.value=f}},function(f){if(l.status==="pending"){var m=l;m.status="rejected",m.reason=f}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw r=l.reason,r_(r),r}throw pl=l,uc}}function fl(r){try{var l=r._init;return l(r._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(pl=u,uc):u}}var pl=null;function a_(){if(pl===null)throw Error(i(459));var r=pl;return pl=null,r}function r_(r){if(r===uc||r===vd)throw Error(i(483))}var hc=null,xu=0;function Cd(r){var l=xu;return xu+=1,hc===null&&(hc=[]),n_(hc,r,l)}function vu(r,l){l=l.props.ref,r.ref=l!==void 0?l:null}function Ed(r,l){throw l.$$typeof===y?Error(i(525)):(r=Object.prototype.toString.call(l),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":r)))}function o_(r){function l(X,G){if(r){var ie=X.deletions;ie===null?(X.deletions=[G],X.flags|=16):ie.push(G)}}function u(X,G){if(!r)return null;for(;G!==null;)l(X,G),G=G.sibling;return null}function f(X){for(var G=new Map;X!==null;)X.key!==null?G.set(X.key,X):G.set(X.index,X),X=X.sibling;return G}function m(X,G){return X=vr(X,G),X.index=0,X.sibling=null,X}function b(X,G,ie){return X.index=ie,r?(ie=X.alternate,ie!==null?(ie=ie.index,ie<G?(X.flags|=67108866,G):ie):(X.flags|=67108866,G)):(X.flags|=1048576,G)}function B(X){return r&&X.alternate===null&&(X.flags|=67108866),X}function P(X,G,ie,be){return G===null||G.tag!==6?(G=em(ie,X.mode,be),G.return=X,G):(G=m(G,ie),G.return=X,G)}function W(X,G,ie,be){var gt=ie.type;return gt===w?ge(X,G,ie.props.children,be,ie.key):G!==null&&(G.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===H&&fl(gt)===G.type)?(G=m(G,ie.props),vu(G,ie),G.return=X,G):(G=kd(ie.type,ie.key,ie.props,null,X.mode,be),vu(G,ie),G.return=X,G)}function se(X,G,ie,be){return G===null||G.tag!==4||G.stateNode.containerInfo!==ie.containerInfo||G.stateNode.implementation!==ie.implementation?(G=tm(ie,X.mode,be),G.return=X,G):(G=m(G,ie.children||[]),G.return=X,G)}function ge(X,G,ie,be,gt){return G===null||G.tag!==7?(G=ll(ie,X.mode,be,gt),G.return=X,G):(G=m(G,ie),G.return=X,G)}function Be(X,G,ie){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=em(""+G,X.mode,ie),G.return=X,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case k:return ie=kd(G.type,G.key,G.props,null,X.mode,ie),vu(ie,G),ie.return=X,ie;case _:return G=tm(G,X.mode,ie),G.return=X,G;case H:return G=fl(G),Be(X,G,ie)}if(le(G)||C(G))return G=ll(G,X.mode,ie,null),G.return=X,G;if(typeof G.then=="function")return Be(X,Cd(G),ie);if(G.$$typeof===N)return Be(X,Td(X,G),ie);Ed(X,G)}return null}function ae(X,G,ie,be){var gt=G!==null?G.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return gt!==null?null:P(X,G,""+ie,be);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case k:return ie.key===gt?W(X,G,ie,be):null;case _:return ie.key===gt?se(X,G,ie,be):null;case H:return ie=fl(ie),ae(X,G,ie,be)}if(le(ie)||C(ie))return gt!==null?null:ge(X,G,ie,be,null);if(typeof ie.then=="function")return ae(X,G,Cd(ie),be);if(ie.$$typeof===N)return ae(X,G,Td(X,ie),be);Ed(X,ie)}return null}function ue(X,G,ie,be,gt){if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return X=X.get(ie)||null,P(G,X,""+be,gt);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case k:return X=X.get(be.key===null?ie:be.key)||null,W(G,X,be,gt);case _:return X=X.get(be.key===null?ie:be.key)||null,se(G,X,be,gt);case H:return be=fl(be),ue(X,G,ie,be,gt)}if(le(be)||C(be))return X=X.get(ie)||null,ge(G,X,be,gt,null);if(typeof be.then=="function")return ue(X,G,ie,Cd(be),gt);if(be.$$typeof===N)return ue(X,G,ie,Td(G,be),gt);Ed(G,be)}return null}function Je(X,G,ie,be){for(var gt=null,Si=null,st=G,$t=G=0,li=null;st!==null&&$t<ie.length;$t++){st.index>$t?(li=st,st=null):li=st.sibling;var _i=ae(X,st,ie[$t],be);if(_i===null){st===null&&(st=li);break}r&&st&&_i.alternate===null&&l(X,st),G=b(_i,G,$t),Si===null?gt=_i:Si.sibling=_i,Si=_i,st=li}if($t===ie.length)return u(X,st),ui&&Nr(X,$t),gt;if(st===null){for(;$t<ie.length;$t++)st=Be(X,ie[$t],be),st!==null&&(G=b(st,G,$t),Si===null?gt=st:Si.sibling=st,Si=st);return ui&&Nr(X,$t),gt}for(st=f(st);$t<ie.length;$t++)li=ue(st,X,$t,ie[$t],be),li!==null&&(r&&li.alternate!==null&&st.delete(li.key===null?$t:li.key),G=b(li,G,$t),Si===null?gt=li:Si.sibling=li,Si=li);return r&&st.forEach(function(Mo){return l(X,Mo)}),ui&&Nr(X,$t),gt}function vt(X,G,ie,be){if(ie==null)throw Error(i(151));for(var gt=null,Si=null,st=G,$t=G=0,li=null,_i=ie.next();st!==null&&!_i.done;$t++,_i=ie.next()){st.index>$t?(li=st,st=null):li=st.sibling;var Mo=ae(X,st,_i.value,be);if(Mo===null){st===null&&(st=li);break}r&&st&&Mo.alternate===null&&l(X,st),G=b(Mo,G,$t),Si===null?gt=Mo:Si.sibling=Mo,Si=Mo,st=li}if(_i.done)return u(X,st),ui&&Nr(X,$t),gt;if(st===null){for(;!_i.done;$t++,_i=ie.next())_i=Be(X,_i.value,be),_i!==null&&(G=b(_i,G,$t),Si===null?gt=_i:Si.sibling=_i,Si=_i);return ui&&Nr(X,$t),gt}for(st=f(st);!_i.done;$t++,_i=ie.next())_i=ue(st,X,$t,_i.value,be),_i!==null&&(r&&_i.alternate!==null&&st.delete(_i.key===null?$t:_i.key),G=b(_i,G,$t),Si===null?gt=_i:Si.sibling=_i,Si=_i);return r&&st.forEach(function(I2){return l(X,I2)}),ui&&Nr(X,$t),gt}function Ui(X,G,ie,be){if(typeof ie=="object"&&ie!==null&&ie.type===w&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case k:e:{for(var gt=ie.key;G!==null;){if(G.key===gt){if(gt=ie.type,gt===w){if(G.tag===7){u(X,G.sibling),be=m(G,ie.props.children),be.return=X,X=be;break e}}else if(G.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===H&&fl(gt)===G.type){u(X,G.sibling),be=m(G,ie.props),vu(be,ie),be.return=X,X=be;break e}u(X,G);break}else l(X,G);G=G.sibling}ie.type===w?(be=ll(ie.props.children,X.mode,be,ie.key),be.return=X,X=be):(be=kd(ie.type,ie.key,ie.props,null,X.mode,be),vu(be,ie),be.return=X,X=be)}return B(X);case _:e:{for(gt=ie.key;G!==null;){if(G.key===gt)if(G.tag===4&&G.stateNode.containerInfo===ie.containerInfo&&G.stateNode.implementation===ie.implementation){u(X,G.sibling),be=m(G,ie.children||[]),be.return=X,X=be;break e}else{u(X,G);break}else l(X,G);G=G.sibling}be=tm(ie,X.mode,be),be.return=X,X=be}return B(X);case H:return ie=fl(ie),Ui(X,G,ie,be)}if(le(ie))return Je(X,G,ie,be);if(C(ie)){if(gt=C(ie),typeof gt!="function")throw Error(i(150));return ie=gt.call(ie),vt(X,G,ie,be)}if(typeof ie.then=="function")return Ui(X,G,Cd(ie),be);if(ie.$$typeof===N)return Ui(X,G,Td(X,ie),be);Ed(X,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,G!==null&&G.tag===6?(u(X,G.sibling),be=m(G,ie),be.return=X,X=be):(u(X,G),be=em(ie,X.mode,be),be.return=X,X=be),B(X)):u(X,G)}return function(X,G,ie,be){try{xu=0;var gt=Ui(X,G,ie,be);return hc=null,gt}catch(st){if(st===uc||st===vd)throw st;var Si=Jn(29,st,null,X.mode);return Si.lanes=be,Si.return=X,Si}}}var gl=o_(!0),l_=o_(!1),go=!1;function fm(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function pm(r,l){r=r.updateQueue,l.updateQueue===r&&(l.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function mo(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function yo(r,l,u){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(Bi&2)!==0){var m=f.pending;return m===null?l.next=l:(l.next=m.next,m.next=l),f.pending=l,l=_d(r),YS(r,null,u),l}return Sd(r,f,l,u),_d(r)}function Nu(r,l,u){if(l=l.updateQueue,l!==null&&(l=l.shared,(u&4194048)!==0)){var f=l.lanes;f&=r.pendingLanes,u|=f,l.lanes=u,jb(r,u)}}function gm(r,l){var u=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var m=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var B={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};b===null?m=b=B:b=b.next=B,u=u.next}while(u!==null);b===null?m=b=l:b=b.next=l}else m=b=l;u={baseState:f.baseState,firstBaseUpdate:m,lastBaseUpdate:b,shared:f.shared,callbacks:f.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=l:r.next=l,u.lastBaseUpdate=l}var mm=!1;function Cu(){if(mm){var r=cc;if(r!==null)throw r}}function Eu(r,l,u,f){mm=!1;var m=r.updateQueue;go=!1;var b=m.firstBaseUpdate,B=m.lastBaseUpdate,P=m.shared.pending;if(P!==null){m.shared.pending=null;var W=P,se=W.next;W.next=null,B===null?b=se:B.next=se,B=W;var ge=r.alternate;ge!==null&&(ge=ge.updateQueue,P=ge.lastBaseUpdate,P!==B&&(P===null?ge.firstBaseUpdate=se:P.next=se,ge.lastBaseUpdate=W))}if(b!==null){var Be=m.baseState;B=0,ge=se=W=null,P=b;do{var ae=P.lane&-536870913,ue=ae!==P.lane;if(ue?(oi&ae)===ae:(f&ae)===ae){ae!==0&&ae===lc&&(mm=!0),ge!==null&&(ge=ge.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});e:{var Je=r,vt=P;ae=l;var Ui=u;switch(vt.tag){case 1:if(Je=vt.payload,typeof Je=="function"){Be=Je.call(Ui,Be,ae);break e}Be=Je;break e;case 3:Je.flags=Je.flags&-65537|128;case 0:if(Je=vt.payload,ae=typeof Je=="function"?Je.call(Ui,Be,ae):Je,ae==null)break e;Be=g({},Be,ae);break e;case 2:go=!0}}ae=P.callback,ae!==null&&(r.flags|=64,ue&&(r.flags|=8192),ue=m.callbacks,ue===null?m.callbacks=[ae]:ue.push(ae))}else ue={lane:ae,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ge===null?(se=ge=ue,W=Be):ge=ge.next=ue,B|=ae;if(P=P.next,P===null){if(P=m.shared.pending,P===null)break;ue=P,P=ue.next,ue.next=null,m.lastBaseUpdate=ue,m.shared.pending=null}}while(!0);ge===null&&(W=Be),m.baseState=W,m.firstBaseUpdate=se,m.lastBaseUpdate=ge,b===null&&(m.shared.lanes=0),wo|=B,r.lanes=B,r.memoizedState=Be}}function c_(r,l){if(typeof r!="function")throw Error(i(191,r));r.call(l)}function u_(r,l){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)c_(u[r],l)}var dc=R(null),Pd=R(0);function h_(r,l){r=Ir,we(Pd,r),we(dc,l),Ir=r|l.baseLanes}function ym(){we(Pd,Ir),we(dc,dc.current)}function bm(){Ir=Pd.current,te(dc),te(Pd)}var Qn=R(null),ka=null;function bo(r){var l=r.alternate;we(Ls,Ls.current&1),we(Qn,r),ka===null&&(l===null||dc.current!==null||l.memoizedState!==null)&&(ka=r)}function Sm(r){we(Ls,Ls.current),we(Qn,r),ka===null&&(ka=r)}function d_(r){r.tag===22?(we(Ls,Ls.current),we(Qn,r),ka===null&&(ka=r)):So()}function So(){we(Ls,Ls.current),we(Qn,Qn.current)}function Kn(r){te(Qn),ka===r&&(ka=null),te(Ls)}var Ls=R(0);function Dd(r){for(var l=r;l!==null;){if(l.tag===13){var u=l.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||xy(u)||vy(u)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Pr=0,Gt=null,zi=null,Ws=null,Md=!1,fc=!1,ml=!1,Ld=0,Pu=0,pc=null,CN=0;function vs(){throw Error(i(321))}function _m(r,l){if(l===null)return!1;for(var u=0;u<l.length&&u<r.length;u++)if(!qn(r[u],l[u]))return!1;return!0}function km(r,l,u,f,m,b){return Pr=b,Gt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,F.H=r===null||r.memoizedState===null?J_:Om,ml=!1,b=u(f,m),ml=!1,fc&&(b=p_(l,u,f,m)),f_(r),b}function f_(r){F.H=Lu;var l=zi!==null&&zi.next!==null;if(Pr=0,Ws=zi=Gt=null,Md=!1,Pu=0,pc=null,l)throw Error(i(300));r===null||Vs||(r=r.dependencies,r!==null&&Bd(r)&&(Vs=!0))}function p_(r,l,u,f){Gt=r;var m=0;do{if(fc&&(pc=null),Pu=0,fc=!1,25<=m)throw Error(i(301));if(m+=1,Ws=zi=null,r.updateQueue!=null){var b=r.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}F.H=Q_,b=l(u,f)}while(fc);return b}function EN(){var r=F.H,l=r.useState()[0];return l=typeof l.then=="function"?Du(l):l,r=r.useState()[0],(zi!==null?zi.memoizedState:null)!==r&&(Gt.flags|=1024),l}function wm(){var r=Ld!==0;return Ld=0,r}function Bm(r,l,u){l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~u}function Tm(r){if(Md){for(r=r.memoizedState;r!==null;){var l=r.queue;l!==null&&(l.pending=null),r=r.next}Md=!1}Pr=0,Ws=zi=Gt=null,fc=!1,Pu=Ld=0,pc=null}function Cn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ws===null?Gt.memoizedState=Ws=r:Ws=Ws.next=r,Ws}function As(){if(zi===null){var r=Gt.alternate;r=r!==null?r.memoizedState:null}else r=zi.next;var l=Ws===null?Gt.memoizedState:Ws.next;if(l!==null)Ws=l,zi=r;else{if(r===null)throw Gt.alternate===null?Error(i(467)):Error(i(310));zi=r,r={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},Ws===null?Gt.memoizedState=Ws=r:Ws=Ws.next=r}return Ws}function Ad(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Du(r){var l=Pu;return Pu+=1,pc===null&&(pc=[]),r=n_(pc,r,l),l=Gt,(Ws===null?l.memoizedState:Ws.next)===null&&(l=l.alternate,F.H=l===null||l.memoizedState===null?J_:Om),r}function Rd(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Du(r);if(r.$$typeof===N)return cn(r)}throw Error(i(438,String(r)))}function xm(r){var l=null,u=Gt.updateQueue;if(u!==null&&(l=u.memoCache),l==null){var f=Gt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(l={data:f.data.map(function(m){return m.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),u===null&&(u=Ad(),Gt.updateQueue=u),u.memoCache=l,u=l.data[l.index],u===void 0)for(u=l.data[l.index]=Array(r),f=0;f<r;f++)u[f]=K;return l.index++,u}function Dr(r,l){return typeof l=="function"?l(r):l}function Od(r){var l=As();return vm(l,zi,r)}function vm(r,l,u){var f=r.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=u;var m=r.baseQueue,b=f.pending;if(b!==null){if(m!==null){var B=m.next;m.next=b.next,b.next=B}l.baseQueue=m=b,f.pending=null}if(b=r.baseState,m===null)r.memoizedState=b;else{l=m.next;var P=B=null,W=null,se=l,ge=!1;do{var Be=se.lane&-536870913;if(Be!==se.lane?(oi&Be)===Be:(Pr&Be)===Be){var ae=se.revertLane;if(ae===0)W!==null&&(W=W.next={lane:0,revertLane:0,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),Be===lc&&(ge=!0);else if((Pr&ae)===ae){se=se.next,ae===lc&&(ge=!0);continue}else Be={lane:0,revertLane:se.revertLane,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},W===null?(P=W=Be,B=b):W=W.next=Be,Gt.lanes|=ae,wo|=ae;Be=se.action,ml&&u(b,Be),b=se.hasEagerState?se.eagerState:u(b,Be)}else ae={lane:Be,revertLane:se.revertLane,gesture:se.gesture,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},W===null?(P=W=ae,B=b):W=W.next=ae,Gt.lanes|=Be,wo|=Be;se=se.next}while(se!==null&&se!==l);if(W===null?B=b:W.next=P,!qn(b,r.memoizedState)&&(Vs=!0,ge&&(u=cc,u!==null)))throw u;r.memoizedState=b,r.baseState=B,r.baseQueue=W,f.lastRenderedState=b}return m===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function Nm(r){var l=As(),u=l.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=r;var f=u.dispatch,m=u.pending,b=l.memoizedState;if(m!==null){u.pending=null;var B=m=m.next;do b=r(b,B.action),B=B.next;while(B!==m);qn(b,l.memoizedState)||(Vs=!0),l.memoizedState=b,l.baseQueue===null&&(l.baseState=b),u.lastRenderedState=b}return[b,f]}function g_(r,l,u){var f=Gt,m=As(),b=ui;if(b){if(u===void 0)throw Error(i(407));u=u()}else u=l();var B=!qn((zi||m).memoizedState,u);if(B&&(m.memoizedState=u,Vs=!0),m=m.queue,Pm(b_.bind(null,f,m,r),[r]),m.getSnapshot!==l||B||Ws!==null&&Ws.memoizedState.tag&1){if(f.flags|=2048,gc(9,{destroy:void 0},y_.bind(null,f,m,u,l),null),ji===null)throw Error(i(349));b||(Pr&127)!==0||m_(f,l,u)}return u}function m_(r,l,u){r.flags|=16384,r={getSnapshot:l,value:u},l=Gt.updateQueue,l===null?(l=Ad(),Gt.updateQueue=l,l.stores=[r]):(u=l.stores,u===null?l.stores=[r]:u.push(r))}function y_(r,l,u,f){l.value=u,l.getSnapshot=f,S_(l)&&__(r)}function b_(r,l,u){return u(function(){S_(l)&&__(r)})}function S_(r){var l=r.getSnapshot;r=r.value;try{var u=l();return!qn(r,u)}catch{return!0}}function __(r){var l=ol(r,2);l!==null&&Hn(l,r,2)}function Cm(r){var l=Cn();if(typeof r=="function"){var u=r;if(r=u(),ml){Sn(!0);try{u()}finally{Sn(!1)}}}return l.memoizedState=l.baseState=r,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dr,lastRenderedState:r},l}function k_(r,l,u,f){return r.baseState=u,vm(r,zi,typeof f=="function"?f:Dr)}function PN(r,l,u,f,m){if(Wd(r))throw Error(i(485));if(r=l.action,r!==null){var b={payload:m,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){b.listeners.push(B)}};F.T!==null?u(!0):b.isTransition=!1,f(b),u=l.pending,u===null?(b.next=l.pending=b,w_(l,b)):(b.next=u.next,l.pending=u.next=b)}}function w_(r,l){var u=l.action,f=l.payload,m=r.state;if(l.isTransition){var b=F.T,B={};F.T=B;try{var P=u(m,f),W=F.S;W!==null&&W(B,P),B_(r,l,P)}catch(se){Em(r,l,se)}finally{b!==null&&B.types!==null&&(b.types=B.types),F.T=b}}else try{b=u(m,f),B_(r,l,b)}catch(se){Em(r,l,se)}}function B_(r,l,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){T_(r,l,f)},function(f){return Em(r,l,f)}):T_(r,l,u)}function T_(r,l,u){l.status="fulfilled",l.value=u,x_(l),r.state=u,l=r.pending,l!==null&&(u=l.next,u===l?r.pending=null:(u=u.next,l.next=u,w_(r,u)))}function Em(r,l,u){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do l.status="rejected",l.reason=u,x_(l),l=l.next;while(l!==f)}r.action=null}function x_(r){r=r.listeners;for(var l=0;l<r.length;l++)(0,r[l])()}function v_(r,l){return l}function N_(r,l){if(ui){var u=ji.formState;if(u!==null){e:{var f=Gt;if(ui){if(cs){t:{for(var m=cs,b=_a;m.nodeType!==8;){if(!b){m=null;break t}if(m=wa(m.nextSibling),m===null){m=null;break t}}b=m.data,m=b==="F!"||b==="F"?m:null}if(m){cs=wa(m.nextSibling),f=m.data==="F!";break e}}fo(f)}f=!1}f&&(l=u[0])}}return u=Cn(),u.memoizedState=u.baseState=l,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:v_,lastRenderedState:l},u.queue=f,u=$_.bind(null,Gt,f),f.dispatch=u,f=Cm(!1),b=Rm.bind(null,Gt,!1,f.queue),f=Cn(),m={state:l,dispatch:null,action:r,pending:null},f.queue=m,u=PN.bind(null,Gt,m,b,u),m.dispatch=u,f.memoizedState=r,[l,u,!1]}function C_(r){var l=As();return E_(l,zi,r)}function E_(r,l,u){if(l=vm(r,l,v_)[0],r=Od(Dr)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var f=Du(l)}catch(B){throw B===uc?vd:B}else f=l;l=As();var m=l.queue,b=m.dispatch;return u!==l.memoizedState&&(Gt.flags|=2048,gc(9,{destroy:void 0},DN.bind(null,m,u),null)),[f,b,r]}function DN(r,l){r.action=l}function P_(r){var l=As(),u=zi;if(u!==null)return E_(l,u,r);As(),l=l.memoizedState,u=As();var f=u.queue.dispatch;return u.memoizedState=r,[l,f,!1]}function gc(r,l,u,f){return r={tag:r,create:u,deps:f,inst:l,next:null},l=Gt.updateQueue,l===null&&(l=Ad(),Gt.updateQueue=l),u=l.lastEffect,u===null?l.lastEffect=r.next=r:(f=u.next,u.next=r,r.next=f,l.lastEffect=r),r}function D_(){return As().memoizedState}function Fd(r,l,u,f){var m=Cn();Gt.flags|=r,m.memoizedState=gc(1|l,{destroy:void 0},u,f===void 0?null:f)}function Id(r,l,u,f){var m=As();f=f===void 0?null:f;var b=m.memoizedState.inst;zi!==null&&f!==null&&_m(f,zi.memoizedState.deps)?m.memoizedState=gc(l,b,u,f):(Gt.flags|=r,m.memoizedState=gc(1|l,b,u,f))}function M_(r,l){Fd(8390656,8,r,l)}function Pm(r,l){Id(2048,8,r,l)}function MN(r){Gt.flags|=4;var l=Gt.updateQueue;if(l===null)l=Ad(),Gt.updateQueue=l,l.events=[r];else{var u=l.events;u===null?l.events=[r]:u.push(r)}}function L_(r){var l=As().memoizedState;return MN({ref:l,nextImpl:r}),function(){if((Bi&2)!==0)throw Error(i(440));return l.impl.apply(void 0,arguments)}}function A_(r,l){return Id(4,2,r,l)}function R_(r,l){return Id(4,4,r,l)}function O_(r,l){if(typeof l=="function"){r=r();var u=l(r);return function(){typeof u=="function"?u():l(null)}}if(l!=null)return r=r(),l.current=r,function(){l.current=null}}function F_(r,l,u){u=u!=null?u.concat([r]):null,Id(4,4,O_.bind(null,l,r),u)}function Dm(){}function I_(r,l){var u=As();l=l===void 0?null:l;var f=u.memoizedState;return l!==null&&_m(l,f[1])?f[0]:(u.memoizedState=[r,l],r)}function W_(r,l){var u=As();l=l===void 0?null:l;var f=u.memoizedState;if(l!==null&&_m(l,f[1]))return f[0];if(f=r(),ml){Sn(!0);try{r()}finally{Sn(!1)}}return u.memoizedState=[f,l],f}function Mm(r,l,u){return u===void 0||(Pr&1073741824)!==0&&(oi&261930)===0?r.memoizedState=l:(r.memoizedState=u,r=Vk(),Gt.lanes|=r,wo|=r,u)}function V_(r,l,u,f){return qn(u,l)?u:dc.current!==null?(r=Mm(r,u,f),qn(r,l)||(Vs=!0),r):(Pr&42)===0||(Pr&1073741824)!==0&&(oi&261930)===0?(Vs=!0,r.memoizedState=u):(r=Vk(),Gt.lanes|=r,wo|=r,l)}function H_(r,l,u,f,m){var b=re.p;re.p=b!==0&&8>b?b:8;var B=F.T,P={};F.T=P,Rm(r,!1,l,u);try{var W=m(),se=F.S;if(se!==null&&se(P,W),W!==null&&typeof W=="object"&&typeof W.then=="function"){var ge=NN(W,f);Mu(r,l,ge,ea(r))}else Mu(r,l,f,ea(r))}catch(Be){Mu(r,l,{then:function(){},status:"rejected",reason:Be},ea())}finally{re.p=b,B!==null&&P.types!==null&&(B.types=P.types),F.T=B}}function LN(){}function Lm(r,l,u,f){if(r.tag!==5)throw Error(i(476));var m=z_(r).queue;H_(r,m,l,_e,u===null?LN:function(){return G_(r),u(f)})}function z_(r){var l=r.memoizedState;if(l!==null)return l;l={memoizedState:_e,baseState:_e,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dr,lastRenderedState:_e},next:null};var u={};return l.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dr,lastRenderedState:u},next:null},r.memoizedState=l,r=r.alternate,r!==null&&(r.memoizedState=l),l}function G_(r){var l=z_(r);l.next===null&&(l=r.alternate.memoizedState),Mu(r,l.next.queue,{},ea())}function Am(){return cn(Ju)}function U_(){return As().memoizedState}function Y_(){return As().memoizedState}function AN(r){for(var l=r.return;l!==null;){switch(l.tag){case 24:case 3:var u=ea();r=mo(u);var f=yo(l,r,u);f!==null&&(Hn(f,l,u),Nu(f,l,u)),l={cache:cm()},r.payload=l;return}l=l.return}}function RN(r,l,u){var f=ea();u={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Wd(r)?X_(l,u):(u=Zg(r,l,u,f),u!==null&&(Hn(u,r,f),q_(u,l,f)))}function $_(r,l,u){var f=ea();Mu(r,l,u,f)}function Mu(r,l,u,f){var m={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Wd(r))X_(l,m);else{var b=r.alternate;if(r.lanes===0&&(b===null||b.lanes===0)&&(b=l.lastRenderedReducer,b!==null))try{var B=l.lastRenderedState,P=b(B,u);if(m.hasEagerState=!0,m.eagerState=P,qn(P,B))return Sd(r,l,m,0),ji===null&&bd(),!1}catch{}if(u=Zg(r,l,m,f),u!==null)return Hn(u,r,f),q_(u,l,f),!0}return!1}function Rm(r,l,u,f){if(f={lane:2,revertLane:fy(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Wd(r)){if(l)throw Error(i(479))}else l=Zg(r,u,f,2),l!==null&&Hn(l,r,2)}function Wd(r){var l=r.alternate;return r===Gt||l!==null&&l===Gt}function X_(r,l){fc=Md=!0;var u=r.pending;u===null?l.next=l:(l.next=u.next,u.next=l),r.pending=l}function q_(r,l,u){if((u&4194048)!==0){var f=l.lanes;f&=r.pendingLanes,u|=f,l.lanes=u,jb(r,u)}}var Lu={readContext:cn,use:Rd,useCallback:vs,useContext:vs,useEffect:vs,useImperativeHandle:vs,useLayoutEffect:vs,useInsertionEffect:vs,useMemo:vs,useReducer:vs,useRef:vs,useState:vs,useDebugValue:vs,useDeferredValue:vs,useTransition:vs,useSyncExternalStore:vs,useId:vs,useHostTransitionStatus:vs,useFormState:vs,useActionState:vs,useOptimistic:vs,useMemoCache:vs,useCacheRefresh:vs};Lu.useEffectEvent=vs;var J_={readContext:cn,use:Rd,useCallback:function(r,l){return Cn().memoizedState=[r,l===void 0?null:l],r},useContext:cn,useEffect:M_,useImperativeHandle:function(r,l,u){u=u!=null?u.concat([r]):null,Fd(4194308,4,O_.bind(null,l,r),u)},useLayoutEffect:function(r,l){return Fd(4194308,4,r,l)},useInsertionEffect:function(r,l){Fd(4,2,r,l)},useMemo:function(r,l){var u=Cn();l=l===void 0?null:l;var f=r();if(ml){Sn(!0);try{r()}finally{Sn(!1)}}return u.memoizedState=[f,l],f},useReducer:function(r,l,u){var f=Cn();if(u!==void 0){var m=u(l);if(ml){Sn(!0);try{u(l)}finally{Sn(!1)}}}else m=l;return f.memoizedState=f.baseState=m,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:m},f.queue=r,r=r.dispatch=RN.bind(null,Gt,r),[f.memoizedState,r]},useRef:function(r){var l=Cn();return r={current:r},l.memoizedState=r},useState:function(r){r=Cm(r);var l=r.queue,u=$_.bind(null,Gt,l);return l.dispatch=u,[r.memoizedState,u]},useDebugValue:Dm,useDeferredValue:function(r,l){var u=Cn();return Mm(u,r,l)},useTransition:function(){var r=Cm(!1);return r=H_.bind(null,Gt,r.queue,!0,!1),Cn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,l,u){var f=Gt,m=Cn();if(ui){if(u===void 0)throw Error(i(407));u=u()}else{if(u=l(),ji===null)throw Error(i(349));(oi&127)!==0||m_(f,l,u)}m.memoizedState=u;var b={value:u,getSnapshot:l};return m.queue=b,M_(b_.bind(null,f,b,r),[r]),f.flags|=2048,gc(9,{destroy:void 0},y_.bind(null,f,b,u,l),null),u},useId:function(){var r=Cn(),l=ji.identifierPrefix;if(ui){var u=ir,f=tr;u=(f&~(1<<32-Qs(f)-1)).toString(32)+u,l="_"+l+"R_"+u,u=Ld++,0<u&&(l+="H"+u.toString(32)),l+="_"}else u=CN++,l="_"+l+"r_"+u.toString(32)+"_";return r.memoizedState=l},useHostTransitionStatus:Am,useFormState:N_,useActionState:N_,useOptimistic:function(r){var l=Cn();l.memoizedState=l.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=u,l=Rm.bind(null,Gt,!0,u),u.dispatch=l,[r,l]},useMemoCache:xm,useCacheRefresh:function(){return Cn().memoizedState=AN.bind(null,Gt)},useEffectEvent:function(r){var l=Cn(),u={impl:r};return l.memoizedState=u,function(){if((Bi&2)!==0)throw Error(i(440));return u.impl.apply(void 0,arguments)}}},Om={readContext:cn,use:Rd,useCallback:I_,useContext:cn,useEffect:Pm,useImperativeHandle:F_,useInsertionEffect:A_,useLayoutEffect:R_,useMemo:W_,useReducer:Od,useRef:D_,useState:function(){return Od(Dr)},useDebugValue:Dm,useDeferredValue:function(r,l){var u=As();return V_(u,zi.memoizedState,r,l)},useTransition:function(){var r=Od(Dr)[0],l=As().memoizedState;return[typeof r=="boolean"?r:Du(r),l]},useSyncExternalStore:g_,useId:U_,useHostTransitionStatus:Am,useFormState:C_,useActionState:C_,useOptimistic:function(r,l){var u=As();return k_(u,zi,r,l)},useMemoCache:xm,useCacheRefresh:Y_};Om.useEffectEvent=L_;var Q_={readContext:cn,use:Rd,useCallback:I_,useContext:cn,useEffect:Pm,useImperativeHandle:F_,useInsertionEffect:A_,useLayoutEffect:R_,useMemo:W_,useReducer:Nm,useRef:D_,useState:function(){return Nm(Dr)},useDebugValue:Dm,useDeferredValue:function(r,l){var u=As();return zi===null?Mm(u,r,l):V_(u,zi.memoizedState,r,l)},useTransition:function(){var r=Nm(Dr)[0],l=As().memoizedState;return[typeof r=="boolean"?r:Du(r),l]},useSyncExternalStore:g_,useId:U_,useHostTransitionStatus:Am,useFormState:P_,useActionState:P_,useOptimistic:function(r,l){var u=As();return zi!==null?k_(u,zi,r,l):(u.baseState=r,[r,u.queue.dispatch])},useMemoCache:xm,useCacheRefresh:Y_};Q_.useEffectEvent=L_;function Fm(r,l,u,f){l=r.memoizedState,u=u(f,l),u=u==null?l:g({},l,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var Im={enqueueSetState:function(r,l,u){r=r._reactInternals;var f=ea(),m=mo(f);m.payload=l,u!=null&&(m.callback=u),l=yo(r,m,f),l!==null&&(Hn(l,r,f),Nu(l,r,f))},enqueueReplaceState:function(r,l,u){r=r._reactInternals;var f=ea(),m=mo(f);m.tag=1,m.payload=l,u!=null&&(m.callback=u),l=yo(r,m,f),l!==null&&(Hn(l,r,f),Nu(l,r,f))},enqueueForceUpdate:function(r,l){r=r._reactInternals;var u=ea(),f=mo(u);f.tag=2,l!=null&&(f.callback=l),l=yo(r,f,u),l!==null&&(Hn(l,r,u),Nu(l,r,u))}};function K_(r,l,u,f,m,b,B){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,b,B):l.prototype&&l.prototype.isPureReactComponent?!Su(u,f)||!Su(m,b):!0}function Z_(r,l,u,f){r=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(u,f),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(u,f),l.state!==r&&Im.enqueueReplaceState(l,l.state,null)}function yl(r,l){var u=l;if("ref"in l){u={};for(var f in l)f!=="ref"&&(u[f]=l[f])}if(r=r.defaultProps){u===l&&(u=g({},u));for(var m in r)u[m]===void 0&&(u[m]=r[m])}return u}function j_(r){yd(r)}function ek(r){console.error(r)}function tk(r){yd(r)}function Vd(r,l){try{var u=r.onUncaughtError;u(l.value,{componentStack:l.stack})}catch(f){setTimeout(function(){throw f})}}function ik(r,l,u){try{var f=r.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Wm(r,l,u){return u=mo(u),u.tag=3,u.payload={element:null},u.callback=function(){Vd(r,l)},u}function sk(r){return r=mo(r),r.tag=3,r}function nk(r,l,u,f){var m=u.type.getDerivedStateFromError;if(typeof m=="function"){var b=f.value;r.payload=function(){return m(b)},r.callback=function(){ik(l,u,f)}}var B=u.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(r.callback=function(){ik(l,u,f),typeof m!="function"&&(Bo===null?Bo=new Set([this]):Bo.add(this));var P=f.stack;this.componentDidCatch(f.value,{componentStack:P!==null?P:""})})}function ON(r,l,u,f,m){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(l=u.alternate,l!==null&&oc(l,u,m,!0),u=Qn.current,u!==null){switch(u.tag){case 31:case 13:return ka===null?Zd():u.alternate===null&&Ns===0&&(Ns=3),u.flags&=-257,u.flags|=65536,u.lanes=m,f===Nd?u.flags|=16384:(l=u.updateQueue,l===null?u.updateQueue=new Set([f]):l.add(f),uy(r,f,m)),!1;case 22:return u.flags|=65536,f===Nd?u.flags|=16384:(l=u.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=l):(u=l.retryQueue,u===null?l.retryQueue=new Set([f]):u.add(f)),uy(r,f,m)),!1}throw Error(i(435,u.tag))}return uy(r,f,m),Zd(),!1}if(ui)return l=Qn.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=m,f!==nm&&(r=Error(i(422),{cause:f}),wu(ya(r,u)))):(f!==nm&&(l=Error(i(423),{cause:f}),wu(ya(l,u))),r=r.current.alternate,r.flags|=65536,m&=-m,r.lanes|=m,f=ya(f,u),m=Wm(r.stateNode,f,m),gm(r,m),Ns!==4&&(Ns=2)),!1;var b=Error(i(520),{cause:f});if(b=ya(b,u),Hu===null?Hu=[b]:Hu.push(b),Ns!==4&&(Ns=2),l===null)return!0;f=ya(f,u),u=l;do{switch(u.tag){case 3:return u.flags|=65536,r=m&-m,u.lanes|=r,r=Wm(u.stateNode,f,r),gm(u,r),!1;case 1:if(l=u.type,b=u.stateNode,(u.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Bo===null||!Bo.has(b))))return u.flags|=65536,m&=-m,u.lanes|=m,m=sk(m),nk(m,r,u,f),gm(u,m),!1}u=u.return}while(u!==null);return!1}var Vm=Error(i(461)),Vs=!1;function un(r,l,u,f){l.child=r===null?l_(l,null,u,f):gl(l,r.child,u,f)}function ak(r,l,u,f,m){u=u.render;var b=l.ref;if("ref"in f){var B={};for(var P in f)P!=="ref"&&(B[P]=f[P])}else B=f;return hl(l),f=km(r,l,u,B,b,m),P=wm(),r!==null&&!Vs?(Bm(r,l,m),Mr(r,l,m)):(ui&&P&&im(l),l.flags|=1,un(r,l,f,m),l.child)}function rk(r,l,u,f,m){if(r===null){var b=u.type;return typeof b=="function"&&!jg(b)&&b.defaultProps===void 0&&u.compare===null?(l.tag=15,l.type=b,ok(r,l,b,f,m)):(r=kd(u.type,null,f,l,l.mode,m),r.ref=l.ref,r.return=l,l.child=r)}if(b=r.child,!qm(r,m)){var B=b.memoizedProps;if(u=u.compare,u=u!==null?u:Su,u(B,f)&&r.ref===l.ref)return Mr(r,l,m)}return l.flags|=1,r=vr(b,f),r.ref=l.ref,r.return=l,l.child=r}function ok(r,l,u,f,m){if(r!==null){var b=r.memoizedProps;if(Su(b,f)&&r.ref===l.ref)if(Vs=!1,l.pendingProps=f=b,qm(r,m))(r.flags&131072)!==0&&(Vs=!0);else return l.lanes=r.lanes,Mr(r,l,m)}return Hm(r,l,u,f,m)}function lk(r,l,u,f){var m=f.children,b=r!==null?r.memoizedState:null;if(r===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((l.flags&128)!==0){if(b=b!==null?b.baseLanes|u:u,r!==null){for(f=l.child=r.child,m=0;f!==null;)m=m|f.lanes|f.childLanes,f=f.sibling;f=m&~b}else f=0,l.child=null;return ck(r,l,b,u,f)}if((u&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},r!==null&&xd(l,b!==null?b.cachePool:null),b!==null?h_(l,b):ym(),d_(l);else return f=l.lanes=536870912,ck(r,l,b!==null?b.baseLanes|u:u,u,f)}else b!==null?(xd(l,b.cachePool),h_(l,b),So(),l.memoizedState=null):(r!==null&&xd(l,null),ym(),So());return un(r,l,m,u),l.child}function Au(r,l){return r!==null&&r.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function ck(r,l,u,f,m){var b=hm();return b=b===null?null:{parent:Is._currentValue,pool:b},l.memoizedState={baseLanes:u,cachePool:b},r!==null&&xd(l,null),ym(),d_(l),r!==null&&oc(r,l,f,!0),l.childLanes=m,null}function Hd(r,l){return l=Gd({mode:l.mode,children:l.children},r.mode),l.ref=r.ref,r.child=l,l.return=r,l}function uk(r,l,u){return gl(l,r.child,null,u),r=Hd(l,l.pendingProps),r.flags|=2,Kn(l),l.memoizedState=null,r}function FN(r,l,u){var f=l.pendingProps,m=(l.flags&128)!==0;if(l.flags&=-129,r===null){if(ui){if(f.mode==="hidden")return r=Hd(l,f),l.lanes=536870912,Au(null,r);if(Sm(l),(r=cs)?(r=ww(r,_a),r=r!==null&&r.data==="&"?r:null,r!==null&&(l.memoizedState={dehydrated:r,treeContext:uo!==null?{id:tr,overflow:ir}:null,retryLane:536870912,hydrationErrors:null},u=XS(r),u.return=l,l.child=u,ln=l,cs=null)):r=null,r===null)throw fo(l);return l.lanes=536870912,null}return Hd(l,f)}var b=r.memoizedState;if(b!==null){var B=b.dehydrated;if(Sm(l),m)if(l.flags&256)l.flags&=-257,l=uk(r,l,u);else if(l.memoizedState!==null)l.child=r.child,l.flags|=128,l=null;else throw Error(i(558));else if(Vs||oc(r,l,u,!1),m=(u&r.childLanes)!==0,Vs||m){if(f=ji,f!==null&&(B=eS(f,u),B!==0&&B!==b.retryLane))throw b.retryLane=B,ol(r,B),Hn(f,r,B),Vm;Zd(),l=uk(r,l,u)}else r=b.treeContext,cs=wa(B.nextSibling),ln=l,ui=!0,ho=null,_a=!1,r!==null&&QS(l,r),l=Hd(l,f),l.flags|=4096;return l}return r=vr(r.child,{mode:f.mode,children:f.children}),r.ref=l.ref,l.child=r,r.return=l,r}function zd(r,l){var u=l.ref;if(u===null)r!==null&&r.ref!==null&&(l.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(r===null||r.ref!==u)&&(l.flags|=4194816)}}function Hm(r,l,u,f,m){return hl(l),u=km(r,l,u,f,void 0,m),f=wm(),r!==null&&!Vs?(Bm(r,l,m),Mr(r,l,m)):(ui&&f&&im(l),l.flags|=1,un(r,l,u,m),l.child)}function hk(r,l,u,f,m,b){return hl(l),l.updateQueue=null,u=p_(l,f,u,m),f_(r),f=wm(),r!==null&&!Vs?(Bm(r,l,b),Mr(r,l,b)):(ui&&f&&im(l),l.flags|=1,un(r,l,u,b),l.child)}function dk(r,l,u,f,m){if(hl(l),l.stateNode===null){var b=sc,B=u.contextType;typeof B=="object"&&B!==null&&(b=cn(B)),b=new u(f,b),l.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Im,l.stateNode=b,b._reactInternals=l,b=l.stateNode,b.props=f,b.state=l.memoizedState,b.refs={},fm(l),B=u.contextType,b.context=typeof B=="object"&&B!==null?cn(B):sc,b.state=l.memoizedState,B=u.getDerivedStateFromProps,typeof B=="function"&&(Fm(l,u,B,f),b.state=l.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(B=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),B!==b.state&&Im.enqueueReplaceState(b,b.state,null),Eu(l,f,b,m),Cu(),b.state=l.memoizedState),typeof b.componentDidMount=="function"&&(l.flags|=4194308),f=!0}else if(r===null){b=l.stateNode;var P=l.memoizedProps,W=yl(u,P);b.props=W;var se=b.context,ge=u.contextType;B=sc,typeof ge=="object"&&ge!==null&&(B=cn(ge));var Be=u.getDerivedStateFromProps;ge=typeof Be=="function"||typeof b.getSnapshotBeforeUpdate=="function",P=l.pendingProps!==P,ge||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(P||se!==B)&&Z_(l,b,f,B),go=!1;var ae=l.memoizedState;b.state=ae,Eu(l,f,b,m),Cu(),se=l.memoizedState,P||ae!==se||go?(typeof Be=="function"&&(Fm(l,u,Be,f),se=l.memoizedState),(W=go||K_(l,u,W,f,ae,se,B))?(ge||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(l.flags|=4194308)):(typeof b.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=f,l.memoizedState=se),b.props=f,b.state=se,b.context=B,f=W):(typeof b.componentDidMount=="function"&&(l.flags|=4194308),f=!1)}else{b=l.stateNode,pm(r,l),B=l.memoizedProps,ge=yl(u,B),b.props=ge,Be=l.pendingProps,ae=b.context,se=u.contextType,W=sc,typeof se=="object"&&se!==null&&(W=cn(se)),P=u.getDerivedStateFromProps,(se=typeof P=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(B!==Be||ae!==W)&&Z_(l,b,f,W),go=!1,ae=l.memoizedState,b.state=ae,Eu(l,f,b,m),Cu();var ue=l.memoizedState;B!==Be||ae!==ue||go||r!==null&&r.dependencies!==null&&Bd(r.dependencies)?(typeof P=="function"&&(Fm(l,u,P,f),ue=l.memoizedState),(ge=go||K_(l,u,ge,f,ae,ue,W)||r!==null&&r.dependencies!==null&&Bd(r.dependencies))?(se||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(f,ue,W),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(f,ue,W)),typeof b.componentDidUpdate=="function"&&(l.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof b.componentDidUpdate!="function"||B===r.memoizedProps&&ae===r.memoizedState||(l.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&ae===r.memoizedState||(l.flags|=1024),l.memoizedProps=f,l.memoizedState=ue),b.props=f,b.state=ue,b.context=W,f=ge):(typeof b.componentDidUpdate!="function"||B===r.memoizedProps&&ae===r.memoizedState||(l.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&ae===r.memoizedState||(l.flags|=1024),f=!1)}return b=f,zd(r,l),f=(l.flags&128)!==0,b||f?(b=l.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:b.render(),l.flags|=1,r!==null&&f?(l.child=gl(l,r.child,null,m),l.child=gl(l,null,u,m)):un(r,l,u,m),l.memoizedState=b.state,r=l.child):r=Mr(r,l,m),r}function fk(r,l,u,f){return cl(),l.flags|=256,un(r,l,u,f),l.child}var zm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Gm(r){return{baseLanes:r,cachePool:i_()}}function Um(r,l,u){return r=r!==null?r.childLanes&~u:0,l&&(r|=jn),r}function pk(r,l,u){var f=l.pendingProps,m=!1,b=(l.flags&128)!==0,B;if((B=b)||(B=r!==null&&r.memoizedState===null?!1:(Ls.current&2)!==0),B&&(m=!0,l.flags&=-129),B=(l.flags&32)!==0,l.flags&=-33,r===null){if(ui){if(m?bo(l):So(),(r=cs)?(r=ww(r,_a),r=r!==null&&r.data!=="&"?r:null,r!==null&&(l.memoizedState={dehydrated:r,treeContext:uo!==null?{id:tr,overflow:ir}:null,retryLane:536870912,hydrationErrors:null},u=XS(r),u.return=l,l.child=u,ln=l,cs=null)):r=null,r===null)throw fo(l);return vy(r)?l.lanes=32:l.lanes=536870912,null}var P=f.children;return f=f.fallback,m?(So(),m=l.mode,P=Gd({mode:"hidden",children:P},m),f=ll(f,m,u,null),P.return=l,f.return=l,P.sibling=f,l.child=P,f=l.child,f.memoizedState=Gm(u),f.childLanes=Um(r,B,u),l.memoizedState=zm,Au(null,f)):(bo(l),Ym(l,P))}var W=r.memoizedState;if(W!==null&&(P=W.dehydrated,P!==null)){if(b)l.flags&256?(bo(l),l.flags&=-257,l=$m(r,l,u)):l.memoizedState!==null?(So(),l.child=r.child,l.flags|=128,l=null):(So(),P=f.fallback,m=l.mode,f=Gd({mode:"visible",children:f.children},m),P=ll(P,m,u,null),P.flags|=2,f.return=l,P.return=l,f.sibling=P,l.child=f,gl(l,r.child,null,u),f=l.child,f.memoizedState=Gm(u),f.childLanes=Um(r,B,u),l.memoizedState=zm,l=Au(null,f));else if(bo(l),vy(P)){if(B=P.nextSibling&&P.nextSibling.dataset,B)var se=B.dgst;B=se,f=Error(i(419)),f.stack="",f.digest=B,wu({value:f,source:null,stack:null}),l=$m(r,l,u)}else if(Vs||oc(r,l,u,!1),B=(u&r.childLanes)!==0,Vs||B){if(B=ji,B!==null&&(f=eS(B,u),f!==0&&f!==W.retryLane))throw W.retryLane=f,ol(r,f),Hn(B,r,f),Vm;xy(P)||Zd(),l=$m(r,l,u)}else xy(P)?(l.flags|=192,l.child=r.child,l=null):(r=W.treeContext,cs=wa(P.nextSibling),ln=l,ui=!0,ho=null,_a=!1,r!==null&&QS(l,r),l=Ym(l,f.children),l.flags|=4096);return l}return m?(So(),P=f.fallback,m=l.mode,W=r.child,se=W.sibling,f=vr(W,{mode:"hidden",children:f.children}),f.subtreeFlags=W.subtreeFlags&65011712,se!==null?P=vr(se,P):(P=ll(P,m,u,null),P.flags|=2),P.return=l,f.return=l,f.sibling=P,l.child=f,Au(null,f),f=l.child,P=r.child.memoizedState,P===null?P=Gm(u):(m=P.cachePool,m!==null?(W=Is._currentValue,m=m.parent!==W?{parent:W,pool:W}:m):m=i_(),P={baseLanes:P.baseLanes|u,cachePool:m}),f.memoizedState=P,f.childLanes=Um(r,B,u),l.memoizedState=zm,Au(r.child,f)):(bo(l),u=r.child,r=u.sibling,u=vr(u,{mode:"visible",children:f.children}),u.return=l,u.sibling=null,r!==null&&(B=l.deletions,B===null?(l.deletions=[r],l.flags|=16):B.push(r)),l.child=u,l.memoizedState=null,u)}function Ym(r,l){return l=Gd({mode:"visible",children:l},r.mode),l.return=r,r.child=l}function Gd(r,l){return r=Jn(22,r,null,l),r.lanes=0,r}function $m(r,l,u){return gl(l,r.child,null,u),r=Ym(l,l.pendingProps.children),r.flags|=2,l.memoizedState=null,r}function gk(r,l,u){r.lanes|=l;var f=r.alternate;f!==null&&(f.lanes|=l),om(r.return,l,u)}function Xm(r,l,u,f,m,b){var B=r.memoizedState;B===null?r.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:m,treeForkCount:b}:(B.isBackwards=l,B.rendering=null,B.renderingStartTime=0,B.last=f,B.tail=u,B.tailMode=m,B.treeForkCount=b)}function mk(r,l,u){var f=l.pendingProps,m=f.revealOrder,b=f.tail;f=f.children;var B=Ls.current,P=(B&2)!==0;if(P?(B=B&1|2,l.flags|=128):B&=1,we(Ls,B),un(r,l,f,u),f=ui?ku:0,!P&&r!==null&&(r.flags&128)!==0)e:for(r=l.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&gk(r,u,l);else if(r.tag===19)gk(r,u,l);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===l)break e;for(;r.sibling===null;){if(r.return===null||r.return===l)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(m){case"forwards":for(u=l.child,m=null;u!==null;)r=u.alternate,r!==null&&Dd(r)===null&&(m=u),u=u.sibling;u=m,u===null?(m=l.child,l.child=null):(m=u.sibling,u.sibling=null),Xm(l,!1,m,u,b,f);break;case"backwards":case"unstable_legacy-backwards":for(u=null,m=l.child,l.child=null;m!==null;){if(r=m.alternate,r!==null&&Dd(r)===null){l.child=m;break}r=m.sibling,m.sibling=u,u=m,m=r}Xm(l,!0,u,null,b,f);break;case"together":Xm(l,!1,null,null,void 0,f);break;default:l.memoizedState=null}return l.child}function Mr(r,l,u){if(r!==null&&(l.dependencies=r.dependencies),wo|=l.lanes,(u&l.childLanes)===0)if(r!==null){if(oc(r,l,u,!1),(u&l.childLanes)===0)return null}else return null;if(r!==null&&l.child!==r.child)throw Error(i(153));if(l.child!==null){for(r=l.child,u=vr(r,r.pendingProps),l.child=u,u.return=l;r.sibling!==null;)r=r.sibling,u=u.sibling=vr(r,r.pendingProps),u.return=l;u.sibling=null}return l.child}function qm(r,l){return(r.lanes&l)!==0?!0:(r=r.dependencies,!!(r!==null&&Bd(r)))}function IN(r,l,u){switch(l.tag){case 3:qt(l,l.stateNode.containerInfo),po(l,Is,r.memoizedState.cache),cl();break;case 27:case 5:xt(l);break;case 4:qt(l,l.stateNode.containerInfo);break;case 10:po(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Sm(l),null;break;case 13:var f=l.memoizedState;if(f!==null)return f.dehydrated!==null?(bo(l),l.flags|=128,null):(u&l.child.childLanes)!==0?pk(r,l,u):(bo(l),r=Mr(r,l,u),r!==null?r.sibling:null);bo(l);break;case 19:var m=(r.flags&128)!==0;if(f=(u&l.childLanes)!==0,f||(oc(r,l,u,!1),f=(u&l.childLanes)!==0),m){if(f)return mk(r,l,u);l.flags|=128}if(m=l.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),we(Ls,Ls.current),f)break;return null;case 22:return l.lanes=0,lk(r,l,u,l.pendingProps);case 24:po(l,Is,r.memoizedState.cache)}return Mr(r,l,u)}function yk(r,l,u){if(r!==null)if(r.memoizedProps!==l.pendingProps)Vs=!0;else{if(!qm(r,u)&&(l.flags&128)===0)return Vs=!1,IN(r,l,u);Vs=(r.flags&131072)!==0}else Vs=!1,ui&&(l.flags&1048576)!==0&&JS(l,ku,l.index);switch(l.lanes=0,l.tag){case 16:e:{var f=l.pendingProps;if(r=fl(l.elementType),l.type=r,typeof r=="function")jg(r)?(f=yl(r,f),l.tag=1,l=dk(null,l,r,f,u)):(l.tag=0,l=Hm(null,l,r,f,u));else{if(r!=null){var m=r.$$typeof;if(m===v){l.tag=11,l=ak(null,l,r,f,u);break e}else if(m===D){l.tag=14,l=rk(null,l,r,f,u);break e}}throw l=Z(r)||r,Error(i(306,l,""))}}return l;case 0:return Hm(r,l,l.type,l.pendingProps,u);case 1:return f=l.type,m=yl(f,l.pendingProps),dk(r,l,f,m,u);case 3:e:{if(qt(l,l.stateNode.containerInfo),r===null)throw Error(i(387));f=l.pendingProps;var b=l.memoizedState;m=b.element,pm(r,l),Eu(l,f,null,u);var B=l.memoizedState;if(f=B.cache,po(l,Is,f),f!==b.cache&&lm(l,[Is],u,!0),Cu(),f=B.element,b.isDehydrated)if(b={element:f,isDehydrated:!1,cache:B.cache},l.updateQueue.baseState=b,l.memoizedState=b,l.flags&256){l=fk(r,l,f,u);break e}else if(f!==m){m=ya(Error(i(424)),l),wu(m),l=fk(r,l,f,u);break e}else{switch(r=l.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(cs=wa(r.firstChild),ln=l,ui=!0,ho=null,_a=!0,u=l_(l,null,f,u),l.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(cl(),f===m){l=Mr(r,l,u);break e}un(r,l,f,u)}l=l.child}return l;case 26:return zd(r,l),r===null?(u=Cw(l.type,null,l.pendingProps,null))?l.memoizedState=u:ui||(u=l.type,r=l.pendingProps,f=rf(je.current).createElement(u),f[on]=l,f[Rn]=r,hn(f,u,r),Ks(f),l.stateNode=f):l.memoizedState=Cw(l.type,r.memoizedProps,l.pendingProps,r.memoizedState),null;case 27:return xt(l),r===null&&ui&&(f=l.stateNode=xw(l.type,l.pendingProps,je.current),ln=l,_a=!0,m=cs,No(l.type)?(Ny=m,cs=wa(f.firstChild)):cs=m),un(r,l,l.pendingProps.children,u),zd(r,l),r===null&&(l.flags|=4194304),l.child;case 5:return r===null&&ui&&((m=f=cs)&&(f=p2(f,l.type,l.pendingProps,_a),f!==null?(l.stateNode=f,ln=l,cs=wa(f.firstChild),_a=!1,m=!0):m=!1),m||fo(l)),xt(l),m=l.type,b=l.pendingProps,B=r!==null?r.memoizedProps:null,f=b.children,wy(m,b)?f=null:B!==null&&wy(m,B)&&(l.flags|=32),l.memoizedState!==null&&(m=km(r,l,EN,null,null,u),Ju._currentValue=m),zd(r,l),un(r,l,f,u),l.child;case 6:return r===null&&ui&&((r=u=cs)&&(u=g2(u,l.pendingProps,_a),u!==null?(l.stateNode=u,ln=l,cs=null,r=!0):r=!1),r||fo(l)),null;case 13:return pk(r,l,u);case 4:return qt(l,l.stateNode.containerInfo),f=l.pendingProps,r===null?l.child=gl(l,null,f,u):un(r,l,f,u),l.child;case 11:return ak(r,l,l.type,l.pendingProps,u);case 7:return un(r,l,l.pendingProps,u),l.child;case 8:return un(r,l,l.pendingProps.children,u),l.child;case 12:return un(r,l,l.pendingProps.children,u),l.child;case 10:return f=l.pendingProps,po(l,l.type,f.value),un(r,l,f.children,u),l.child;case 9:return m=l.type._context,f=l.pendingProps.children,hl(l),m=cn(m),f=f(m),l.flags|=1,un(r,l,f,u),l.child;case 14:return rk(r,l,l.type,l.pendingProps,u);case 15:return ok(r,l,l.type,l.pendingProps,u);case 19:return mk(r,l,u);case 31:return FN(r,l,u);case 22:return lk(r,l,u,l.pendingProps);case 24:return hl(l),f=cn(Is),r===null?(m=hm(),m===null&&(m=ji,b=cm(),m.pooledCache=b,b.refCount++,b!==null&&(m.pooledCacheLanes|=u),m=b),l.memoizedState={parent:f,cache:m},fm(l),po(l,Is,m)):((r.lanes&u)!==0&&(pm(r,l),Eu(l,null,null,u),Cu()),m=r.memoizedState,b=l.memoizedState,m.parent!==f?(m={parent:f,cache:f},l.memoizedState=m,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=m),po(l,Is,f)):(f=b.cache,po(l,Is,f),f!==m.cache&&lm(l,[Is],u,!0))),un(r,l,l.pendingProps.children,u),l.child;case 29:throw l.pendingProps}throw Error(i(156,l.tag))}function Lr(r){r.flags|=4}function Jm(r,l,u,f,m){if((l=(r.mode&32)!==0)&&(l=!1),l){if(r.flags|=16777216,(m&335544128)===m)if(r.stateNode.complete)r.flags|=8192;else if(Uk())r.flags|=8192;else throw pl=Nd,dm}else r.flags&=-16777217}function bk(r,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Lw(l))if(Uk())r.flags|=8192;else throw pl=Nd,dm}function Ud(r,l){l!==null&&(r.flags|=4),r.flags&16384&&(l=r.tag!==22?Kb():536870912,r.lanes|=l,Sc|=l)}function Ru(r,l){if(!ui)switch(r.tailMode){case"hidden":l=r.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?l||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function us(r){var l=r.alternate!==null&&r.alternate.child===r.child,u=0,f=0;if(l)for(var m=r.child;m!==null;)u|=m.lanes|m.childLanes,f|=m.subtreeFlags&65011712,f|=m.flags&65011712,m.return=r,m=m.sibling;else for(m=r.child;m!==null;)u|=m.lanes|m.childLanes,f|=m.subtreeFlags,f|=m.flags,m.return=r,m=m.sibling;return r.subtreeFlags|=f,r.childLanes=u,l}function WN(r,l,u){var f=l.pendingProps;switch(sm(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return us(l),null;case 1:return us(l),null;case 3:return u=l.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),Er(Is),Pt(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(rc(l)?Lr(l):r===null||r.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,am())),us(l),null;case 26:var m=l.type,b=l.memoizedState;return r===null?(Lr(l),b!==null?(us(l),bk(l,b)):(us(l),Jm(l,m,null,f,u))):b?b!==r.memoizedState?(Lr(l),us(l),bk(l,b)):(us(l),l.flags&=-16777217):(r=r.memoizedProps,r!==f&&Lr(l),us(l),Jm(l,m,r,f,u)),null;case 27:if(zt(l),u=je.current,m=l.type,r!==null&&l.stateNode!=null)r.memoizedProps!==f&&Lr(l);else{if(!f){if(l.stateNode===null)throw Error(i(166));return us(l),null}r=Ee.current,rc(l)?KS(l):(r=xw(m,f,u),l.stateNode=r,Lr(l))}return us(l),null;case 5:if(zt(l),m=l.type,r!==null&&l.stateNode!=null)r.memoizedProps!==f&&Lr(l);else{if(!f){if(l.stateNode===null)throw Error(i(166));return us(l),null}if(b=Ee.current,rc(l))KS(l);else{var B=rf(je.current);switch(b){case 1:b=B.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:b=B.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":b=B.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":b=B.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":b=B.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof f.is=="string"?B.createElement("select",{is:f.is}):B.createElement("select"),f.multiple?b.multiple=!0:f.size&&(b.size=f.size);break;default:b=typeof f.is=="string"?B.createElement(m,{is:f.is}):B.createElement(m)}}b[on]=l,b[Rn]=f;e:for(B=l.child;B!==null;){if(B.tag===5||B.tag===6)b.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===l)break e;for(;B.sibling===null;){if(B.return===null||B.return===l)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}l.stateNode=b;e:switch(hn(b,m,f),m){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Lr(l)}}return us(l),Jm(l,l.type,r===null?null:r.memoizedProps,l.pendingProps,u),null;case 6:if(r&&l.stateNode!=null)r.memoizedProps!==f&&Lr(l);else{if(typeof f!="string"&&l.stateNode===null)throw Error(i(166));if(r=je.current,rc(l)){if(r=l.stateNode,u=l.memoizedProps,f=null,m=ln,m!==null)switch(m.tag){case 27:case 5:f=m.memoizedProps}r[on]=l,r=!!(r.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||pw(r.nodeValue,u)),r||fo(l,!0)}else r=rf(r).createTextNode(f),r[on]=l,l.stateNode=r}return us(l),null;case 31:if(u=l.memoizedState,r===null||r.memoizedState!==null){if(f=rc(l),u!==null){if(r===null){if(!f)throw Error(i(318));if(r=l.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[on]=l}else cl(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;us(l),r=!1}else u=am(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=u),r=!0;if(!r)return l.flags&256?(Kn(l),l):(Kn(l),null);if((l.flags&128)!==0)throw Error(i(558))}return us(l),null;case 13:if(f=l.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(m=rc(l),f!==null&&f.dehydrated!==null){if(r===null){if(!m)throw Error(i(318));if(m=l.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[on]=l}else cl(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;us(l),m=!1}else m=am(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=m),m=!0;if(!m)return l.flags&256?(Kn(l),l):(Kn(l),null)}return Kn(l),(l.flags&128)!==0?(l.lanes=u,l):(u=f!==null,r=r!==null&&r.memoizedState!==null,u&&(f=l.child,m=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(m=f.alternate.memoizedState.cachePool.pool),b=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(b=f.memoizedState.cachePool.pool),b!==m&&(f.flags|=2048)),u!==r&&u&&(l.child.flags|=8192),Ud(l,l.updateQueue),us(l),null);case 4:return Pt(),r===null&&yy(l.stateNode.containerInfo),us(l),null;case 10:return Er(l.type),us(l),null;case 19:if(te(Ls),f=l.memoizedState,f===null)return us(l),null;if(m=(l.flags&128)!==0,b=f.rendering,b===null)if(m)Ru(f,!1);else{if(Ns!==0||r!==null&&(r.flags&128)!==0)for(r=l.child;r!==null;){if(b=Dd(r),b!==null){for(l.flags|=128,Ru(f,!1),r=b.updateQueue,l.updateQueue=r,Ud(l,r),l.subtreeFlags=0,r=u,u=l.child;u!==null;)$S(u,r),u=u.sibling;return we(Ls,Ls.current&1|2),ui&&Nr(l,f.treeForkCount),l.child}r=r.sibling}f.tail!==null&&Zt()>Jd&&(l.flags|=128,m=!0,Ru(f,!1),l.lanes=4194304)}else{if(!m)if(r=Dd(b),r!==null){if(l.flags|=128,m=!0,r=r.updateQueue,l.updateQueue=r,Ud(l,r),Ru(f,!0),f.tail===null&&f.tailMode==="hidden"&&!b.alternate&&!ui)return us(l),null}else 2*Zt()-f.renderingStartTime>Jd&&u!==536870912&&(l.flags|=128,m=!0,Ru(f,!1),l.lanes=4194304);f.isBackwards?(b.sibling=l.child,l.child=b):(r=f.last,r!==null?r.sibling=b:l.child=b,f.last=b)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=Zt(),r.sibling=null,u=Ls.current,we(Ls,m?u&1|2:u&1),ui&&Nr(l,f.treeForkCount),r):(us(l),null);case 22:case 23:return Kn(l),bm(),f=l.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(l.flags|=8192):f&&(l.flags|=8192),f?(u&536870912)!==0&&(l.flags&128)===0&&(us(l),l.subtreeFlags&6&&(l.flags|=8192)):us(l),u=l.updateQueue,u!==null&&Ud(l,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),f=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(f=l.memoizedState.cachePool.pool),f!==u&&(l.flags|=2048),r!==null&&te(dl),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),l.memoizedState.cache!==u&&(l.flags|=2048),Er(Is),us(l),null;case 25:return null;case 30:return null}throw Error(i(156,l.tag))}function VN(r,l){switch(sm(l),l.tag){case 1:return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 3:return Er(Is),Pt(),r=l.flags,(r&65536)!==0&&(r&128)===0?(l.flags=r&-65537|128,l):null;case 26:case 27:case 5:return zt(l),null;case 31:if(l.memoizedState!==null){if(Kn(l),l.alternate===null)throw Error(i(340));cl()}return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 13:if(Kn(l),r=l.memoizedState,r!==null&&r.dehydrated!==null){if(l.alternate===null)throw Error(i(340));cl()}return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 19:return te(Ls),null;case 4:return Pt(),null;case 10:return Er(l.type),null;case 22:case 23:return Kn(l),bm(),r!==null&&te(dl),r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 24:return Er(Is),null;case 25:return null;default:return null}}function Sk(r,l){switch(sm(l),l.tag){case 3:Er(Is),Pt();break;case 26:case 27:case 5:zt(l);break;case 4:Pt();break;case 31:l.memoizedState!==null&&Kn(l);break;case 13:Kn(l);break;case 19:te(Ls);break;case 10:Er(l.type);break;case 22:case 23:Kn(l),bm(),r!==null&&te(dl);break;case 24:Er(Is)}}function Ou(r,l){try{var u=l.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var m=f.next;u=m;do{if((u.tag&r)===r){f=void 0;var b=u.create,B=u.inst;f=b(),B.destroy=f}u=u.next}while(u!==m)}}catch(P){Ri(l,l.return,P)}}function _o(r,l,u){try{var f=l.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var b=m.next;f=b;do{if((f.tag&r)===r){var B=f.inst,P=B.destroy;if(P!==void 0){B.destroy=void 0,m=l;var W=u,se=P;try{se()}catch(ge){Ri(m,W,ge)}}}f=f.next}while(f!==b)}}catch(ge){Ri(l,l.return,ge)}}function _k(r){var l=r.updateQueue;if(l!==null){var u=r.stateNode;try{u_(l,u)}catch(f){Ri(r,r.return,f)}}}function kk(r,l,u){u.props=yl(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(f){Ri(r,l,f)}}function Fu(r,l){try{var u=r.ref;if(u!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof u=="function"?r.refCleanup=u(f):u.current=f}}catch(m){Ri(r,l,m)}}function sr(r,l){var u=r.ref,f=r.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(m){Ri(r,l,m)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(m){Ri(r,l,m)}else u.current=null}function wk(r){var l=r.type,u=r.memoizedProps,f=r.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(m){Ri(r,r.return,m)}}function Qm(r,l,u){try{var f=r.stateNode;l2(f,r.type,u,l),f[Rn]=l}catch(m){Ri(r,r.return,m)}}function Bk(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&No(r.type)||r.tag===4}function Km(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Bk(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&No(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Zm(r,l,u){var f=r.tag;if(f===5||f===6)r=r.stateNode,l?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(r,l):(l=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,l.appendChild(r),u=u._reactRootContainer,u!=null||l.onclick!==null||(l.onclick=Tr));else if(f!==4&&(f===27&&No(r.type)&&(u=r.stateNode,l=null),r=r.child,r!==null))for(Zm(r,l,u),r=r.sibling;r!==null;)Zm(r,l,u),r=r.sibling}function Yd(r,l,u){var f=r.tag;if(f===5||f===6)r=r.stateNode,l?u.insertBefore(r,l):u.appendChild(r);else if(f!==4&&(f===27&&No(r.type)&&(u=r.stateNode),r=r.child,r!==null))for(Yd(r,l,u),r=r.sibling;r!==null;)Yd(r,l,u),r=r.sibling}function Tk(r){var l=r.stateNode,u=r.memoizedProps;try{for(var f=r.type,m=l.attributes;m.length;)l.removeAttributeNode(m[0]);hn(l,f,u),l[on]=r,l[Rn]=u}catch(b){Ri(r,r.return,b)}}var Ar=!1,Hs=!1,jm=!1,xk=typeof WeakSet=="function"?WeakSet:Set,Zs=null;function HN(r,l){if(r=r.containerInfo,_y=ff,r=FS(r),$g(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var m=f.anchorOffset,b=f.focusNode;f=f.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var B=0,P=-1,W=-1,se=0,ge=0,Be=r,ae=null;t:for(;;){for(var ue;Be!==u||m!==0&&Be.nodeType!==3||(P=B+m),Be!==b||f!==0&&Be.nodeType!==3||(W=B+f),Be.nodeType===3&&(B+=Be.nodeValue.length),(ue=Be.firstChild)!==null;)ae=Be,Be=ue;for(;;){if(Be===r)break t;if(ae===u&&++se===m&&(P=B),ae===b&&++ge===f&&(W=B),(ue=Be.nextSibling)!==null)break;Be=ae,ae=Be.parentNode}Be=ue}u=P===-1||W===-1?null:{start:P,end:W}}else u=null}u=u||{start:0,end:0}}else u=null;for(ky={focusedElem:r,selectionRange:u},ff=!1,Zs=l;Zs!==null;)if(l=Zs,r=l.child,(l.subtreeFlags&1028)!==0&&r!==null)r.return=l,Zs=r;else for(;Zs!==null;){switch(l=Zs,b=l.alternate,r=l.flags,l.tag){case 0:if((r&4)!==0&&(r=l.updateQueue,r=r!==null?r.events:null,r!==null))for(u=0;u<r.length;u++)m=r[u],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&b!==null){r=void 0,u=l,m=b.memoizedProps,b=b.memoizedState,f=u.stateNode;try{var Je=yl(u.type,m);r=f.getSnapshotBeforeUpdate(Je,b),f.__reactInternalSnapshotBeforeUpdate=r}catch(vt){Ri(u,u.return,vt)}}break;case 3:if((r&1024)!==0){if(r=l.stateNode.containerInfo,u=r.nodeType,u===9)Ty(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Ty(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=l.sibling,r!==null){r.return=l.return,Zs=r;break}Zs=l.return}}function vk(r,l,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:Or(r,u),f&4&&Ou(5,u);break;case 1:if(Or(r,u),f&4)if(r=u.stateNode,l===null)try{r.componentDidMount()}catch(B){Ri(u,u.return,B)}else{var m=yl(u.type,l.memoizedProps);l=l.memoizedState;try{r.componentDidUpdate(m,l,r.__reactInternalSnapshotBeforeUpdate)}catch(B){Ri(u,u.return,B)}}f&64&&_k(u),f&512&&Fu(u,u.return);break;case 3:if(Or(r,u),f&64&&(r=u.updateQueue,r!==null)){if(l=null,u.child!==null)switch(u.child.tag){case 27:case 5:l=u.child.stateNode;break;case 1:l=u.child.stateNode}try{u_(r,l)}catch(B){Ri(u,u.return,B)}}break;case 27:l===null&&f&4&&Tk(u);case 26:case 5:Or(r,u),l===null&&f&4&&wk(u),f&512&&Fu(u,u.return);break;case 12:Or(r,u);break;case 31:Or(r,u),f&4&&Ek(r,u);break;case 13:Or(r,u),f&4&&Pk(r,u),f&64&&(r=u.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(u=QN.bind(null,u),m2(r,u))));break;case 22:if(f=u.memoizedState!==null||Ar,!f){l=l!==null&&l.memoizedState!==null||Hs,m=Ar;var b=Hs;Ar=f,(Hs=l)&&!b?Fr(r,u,(u.subtreeFlags&8772)!==0):Or(r,u),Ar=m,Hs=b}break;case 30:break;default:Or(r,u)}}function Nk(r){var l=r.alternate;l!==null&&(r.alternate=null,Nk(l)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(l=r.stateNode,l!==null&&Eg(l)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var gs=null,Fn=!1;function Rr(r,l,u){for(u=u.child;u!==null;)Ck(r,l,u),u=u.sibling}function Ck(r,l,u){if(Hi&&typeof Hi.onCommitFiberUnmount=="function")try{Hi.onCommitFiberUnmount(bi,u)}catch{}switch(u.tag){case 26:Hs||sr(u,l),Rr(r,l,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Hs||sr(u,l);var f=gs,m=Fn;No(u.type)&&(gs=u.stateNode,Fn=!1),Rr(r,l,u),$u(u.stateNode),gs=f,Fn=m;break;case 5:Hs||sr(u,l);case 6:if(f=gs,m=Fn,gs=null,Rr(r,l,u),gs=f,Fn=m,gs!==null)if(Fn)try{(gs.nodeType===9?gs.body:gs.nodeName==="HTML"?gs.ownerDocument.body:gs).removeChild(u.stateNode)}catch(b){Ri(u,l,b)}else try{gs.removeChild(u.stateNode)}catch(b){Ri(u,l,b)}break;case 18:gs!==null&&(Fn?(r=gs,_w(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,u.stateNode),Nc(r)):_w(gs,u.stateNode));break;case 4:f=gs,m=Fn,gs=u.stateNode.containerInfo,Fn=!0,Rr(r,l,u),gs=f,Fn=m;break;case 0:case 11:case 14:case 15:_o(2,u,l),Hs||_o(4,u,l),Rr(r,l,u);break;case 1:Hs||(sr(u,l),f=u.stateNode,typeof f.componentWillUnmount=="function"&&kk(u,l,f)),Rr(r,l,u);break;case 21:Rr(r,l,u);break;case 22:Hs=(f=Hs)||u.memoizedState!==null,Rr(r,l,u),Hs=f;break;default:Rr(r,l,u)}}function Ek(r,l){if(l.memoizedState===null&&(r=l.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Nc(r)}catch(u){Ri(l,l.return,u)}}}function Pk(r,l){if(l.memoizedState===null&&(r=l.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Nc(r)}catch(u){Ri(l,l.return,u)}}function zN(r){switch(r.tag){case 31:case 13:case 19:var l=r.stateNode;return l===null&&(l=r.stateNode=new xk),l;case 22:return r=r.stateNode,l=r._retryCache,l===null&&(l=r._retryCache=new xk),l;default:throw Error(i(435,r.tag))}}function $d(r,l){var u=zN(r);l.forEach(function(f){if(!u.has(f)){u.add(f);var m=KN.bind(null,r,f);f.then(m,m)}})}function In(r,l){var u=l.deletions;if(u!==null)for(var f=0;f<u.length;f++){var m=u[f],b=r,B=l,P=B;e:for(;P!==null;){switch(P.tag){case 27:if(No(P.type)){gs=P.stateNode,Fn=!1;break e}break;case 5:gs=P.stateNode,Fn=!1;break e;case 3:case 4:gs=P.stateNode.containerInfo,Fn=!0;break e}P=P.return}if(gs===null)throw Error(i(160));Ck(b,B,m),gs=null,Fn=!1,b=m.alternate,b!==null&&(b.return=null),m.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)Dk(l,r),l=l.sibling}var Fa=null;function Dk(r,l){var u=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:In(l,r),Wn(r),f&4&&(_o(3,r,r.return),Ou(3,r),_o(5,r,r.return));break;case 1:In(l,r),Wn(r),f&512&&(Hs||u===null||sr(u,u.return)),f&64&&Ar&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var m=Fa;if(In(l,r),Wn(r),f&512&&(Hs||u===null||sr(u,u.return)),f&4){var b=u!==null?u.memoizedState:null;if(f=r.memoizedState,u===null)if(f===null)if(r.stateNode===null){e:{f=r.type,u=r.memoizedProps,m=m.ownerDocument||m;t:switch(f){case"title":b=m.getElementsByTagName("title")[0],(!b||b[uu]||b[on]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=m.createElement(f),m.head.insertBefore(b,m.querySelector("head > title"))),hn(b,f,u),b[on]=r,Ks(b),f=b;break e;case"link":var B=Dw("link","href",m).get(f+(u.href||""));if(B){for(var P=0;P<B.length;P++)if(b=B[P],b.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&b.getAttribute("rel")===(u.rel==null?null:u.rel)&&b.getAttribute("title")===(u.title==null?null:u.title)&&b.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){B.splice(P,1);break t}}b=m.createElement(f),hn(b,f,u),m.head.appendChild(b);break;case"meta":if(B=Dw("meta","content",m).get(f+(u.content||""))){for(P=0;P<B.length;P++)if(b=B[P],b.getAttribute("content")===(u.content==null?null:""+u.content)&&b.getAttribute("name")===(u.name==null?null:u.name)&&b.getAttribute("property")===(u.property==null?null:u.property)&&b.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&b.getAttribute("charset")===(u.charSet==null?null:u.charSet)){B.splice(P,1);break t}}b=m.createElement(f),hn(b,f,u),m.head.appendChild(b);break;default:throw Error(i(468,f))}b[on]=r,Ks(b),f=b}r.stateNode=f}else Mw(m,r.type,r.stateNode);else r.stateNode=Pw(m,f,r.memoizedProps);else b!==f?(b===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):b.count--,f===null?Mw(m,r.type,r.stateNode):Pw(m,f,r.memoizedProps)):f===null&&r.stateNode!==null&&Qm(r,r.memoizedProps,u.memoizedProps)}break;case 27:In(l,r),Wn(r),f&512&&(Hs||u===null||sr(u,u.return)),u!==null&&f&4&&Qm(r,r.memoizedProps,u.memoizedProps);break;case 5:if(In(l,r),Wn(r),f&512&&(Hs||u===null||sr(u,u.return)),r.flags&32){m=r.stateNode;try{Ql(m,"")}catch(Je){Ri(r,r.return,Je)}}f&4&&r.stateNode!=null&&(m=r.memoizedProps,Qm(r,m,u!==null?u.memoizedProps:m)),f&1024&&(jm=!0);break;case 6:if(In(l,r),Wn(r),f&4){if(r.stateNode===null)throw Error(i(162));f=r.memoizedProps,u=r.stateNode;try{u.nodeValue=f}catch(Je){Ri(r,r.return,Je)}}break;case 3:if(cf=null,m=Fa,Fa=of(l.containerInfo),In(l,r),Fa=m,Wn(r),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Nc(l.containerInfo)}catch(Je){Ri(r,r.return,Je)}jm&&(jm=!1,Mk(r));break;case 4:f=Fa,Fa=of(r.stateNode.containerInfo),In(l,r),Wn(r),Fa=f;break;case 12:In(l,r),Wn(r);break;case 31:In(l,r),Wn(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,$d(r,f)));break;case 13:In(l,r),Wn(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(qd=Zt()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,$d(r,f)));break;case 22:m=r.memoizedState!==null;var W=u!==null&&u.memoizedState!==null,se=Ar,ge=Hs;if(Ar=se||m,Hs=ge||W,In(l,r),Hs=ge,Ar=se,Wn(r),f&8192)e:for(l=r.stateNode,l._visibility=m?l._visibility&-2:l._visibility|1,m&&(u===null||W||Ar||Hs||bl(r)),u=null,l=r;;){if(l.tag===5||l.tag===26){if(u===null){W=u=l;try{if(b=W.stateNode,m)B=b.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{P=W.stateNode;var Be=W.memoizedProps.style,ae=Be!=null&&Be.hasOwnProperty("display")?Be.display:null;P.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(Je){Ri(W,W.return,Je)}}}else if(l.tag===6){if(u===null){W=l;try{W.stateNode.nodeValue=m?"":W.memoizedProps}catch(Je){Ri(W,W.return,Je)}}}else if(l.tag===18){if(u===null){W=l;try{var ue=W.stateNode;m?kw(ue,!0):kw(W.stateNode,!1)}catch(Je){Ri(W,W.return,Je)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===r)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break e;for(;l.sibling===null;){if(l.return===null||l.return===r)break e;u===l&&(u=null),l=l.return}u===l&&(u=null),l.sibling.return=l.return,l=l.sibling}f&4&&(f=r.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,$d(r,u))));break;case 19:In(l,r),Wn(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,$d(r,f)));break;case 30:break;case 21:break;default:In(l,r),Wn(r)}}function Wn(r){var l=r.flags;if(l&2){try{for(var u,f=r.return;f!==null;){if(Bk(f)){u=f;break}f=f.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var m=u.stateNode,b=Km(r);Yd(r,b,m);break;case 5:var B=u.stateNode;u.flags&32&&(Ql(B,""),u.flags&=-33);var P=Km(r);Yd(r,P,B);break;case 3:case 4:var W=u.stateNode.containerInfo,se=Km(r);Zm(r,se,W);break;default:throw Error(i(161))}}catch(ge){Ri(r,r.return,ge)}r.flags&=-3}l&4096&&(r.flags&=-4097)}function Mk(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var l=r;Mk(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),r=r.sibling}}function Or(r,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)vk(r,l.alternate,l),l=l.sibling}function bl(r){for(r=r.child;r!==null;){var l=r;switch(l.tag){case 0:case 11:case 14:case 15:_o(4,l,l.return),bl(l);break;case 1:sr(l,l.return);var u=l.stateNode;typeof u.componentWillUnmount=="function"&&kk(l,l.return,u),bl(l);break;case 27:$u(l.stateNode);case 26:case 5:sr(l,l.return),bl(l);break;case 22:l.memoizedState===null&&bl(l);break;case 30:bl(l);break;default:bl(l)}r=r.sibling}}function Fr(r,l,u){for(u=u&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var f=l.alternate,m=r,b=l,B=b.flags;switch(b.tag){case 0:case 11:case 15:Fr(m,b,u),Ou(4,b);break;case 1:if(Fr(m,b,u),f=b,m=f.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(se){Ri(f,f.return,se)}if(f=b,m=f.updateQueue,m!==null){var P=f.stateNode;try{var W=m.shared.hiddenCallbacks;if(W!==null)for(m.shared.hiddenCallbacks=null,m=0;m<W.length;m++)c_(W[m],P)}catch(se){Ri(f,f.return,se)}}u&&B&64&&_k(b),Fu(b,b.return);break;case 27:Tk(b);case 26:case 5:Fr(m,b,u),u&&f===null&&B&4&&wk(b),Fu(b,b.return);break;case 12:Fr(m,b,u);break;case 31:Fr(m,b,u),u&&B&4&&Ek(m,b);break;case 13:Fr(m,b,u),u&&B&4&&Pk(m,b);break;case 22:b.memoizedState===null&&Fr(m,b,u),Fu(b,b.return);break;case 30:break;default:Fr(m,b,u)}l=l.sibling}}function ey(r,l){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(r=l.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&Bu(u))}function ty(r,l){r=null,l.alternate!==null&&(r=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==r&&(l.refCount++,r!=null&&Bu(r))}function Ia(r,l,u,f){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Lk(r,l,u,f),l=l.sibling}function Lk(r,l,u,f){var m=l.flags;switch(l.tag){case 0:case 11:case 15:Ia(r,l,u,f),m&2048&&Ou(9,l);break;case 1:Ia(r,l,u,f);break;case 3:Ia(r,l,u,f),m&2048&&(r=null,l.alternate!==null&&(r=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==r&&(l.refCount++,r!=null&&Bu(r)));break;case 12:if(m&2048){Ia(r,l,u,f),r=l.stateNode;try{var b=l.memoizedProps,B=b.id,P=b.onPostCommit;typeof P=="function"&&P(B,l.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(W){Ri(l,l.return,W)}}else Ia(r,l,u,f);break;case 31:Ia(r,l,u,f);break;case 13:Ia(r,l,u,f);break;case 23:break;case 22:b=l.stateNode,B=l.alternate,l.memoizedState!==null?b._visibility&2?Ia(r,l,u,f):Iu(r,l):b._visibility&2?Ia(r,l,u,f):(b._visibility|=2,mc(r,l,u,f,(l.subtreeFlags&10256)!==0||!1)),m&2048&&ey(B,l);break;case 24:Ia(r,l,u,f),m&2048&&ty(l.alternate,l);break;default:Ia(r,l,u,f)}}function mc(r,l,u,f,m){for(m=m&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var b=r,B=l,P=u,W=f,se=B.flags;switch(B.tag){case 0:case 11:case 15:mc(b,B,P,W,m),Ou(8,B);break;case 23:break;case 22:var ge=B.stateNode;B.memoizedState!==null?ge._visibility&2?mc(b,B,P,W,m):Iu(b,B):(ge._visibility|=2,mc(b,B,P,W,m)),m&&se&2048&&ey(B.alternate,B);break;case 24:mc(b,B,P,W,m),m&&se&2048&&ty(B.alternate,B);break;default:mc(b,B,P,W,m)}l=l.sibling}}function Iu(r,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var u=r,f=l,m=f.flags;switch(f.tag){case 22:Iu(u,f),m&2048&&ey(f.alternate,f);break;case 24:Iu(u,f),m&2048&&ty(f.alternate,f);break;default:Iu(u,f)}l=l.sibling}}var Wu=8192;function yc(r,l,u){if(r.subtreeFlags&Wu)for(r=r.child;r!==null;)Ak(r,l,u),r=r.sibling}function Ak(r,l,u){switch(r.tag){case 26:yc(r,l,u),r.flags&Wu&&r.memoizedState!==null&&C2(u,Fa,r.memoizedState,r.memoizedProps);break;case 5:yc(r,l,u);break;case 3:case 4:var f=Fa;Fa=of(r.stateNode.containerInfo),yc(r,l,u),Fa=f;break;case 22:r.memoizedState===null&&(f=r.alternate,f!==null&&f.memoizedState!==null?(f=Wu,Wu=16777216,yc(r,l,u),Wu=f):yc(r,l,u));break;default:yc(r,l,u)}}function Rk(r){var l=r.alternate;if(l!==null&&(r=l.child,r!==null)){l.child=null;do l=r.sibling,r.sibling=null,r=l;while(r!==null)}}function Vu(r){var l=r.deletions;if((r.flags&16)!==0){if(l!==null)for(var u=0;u<l.length;u++){var f=l[u];Zs=f,Fk(f,r)}Rk(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ok(r),r=r.sibling}function Ok(r){switch(r.tag){case 0:case 11:case 15:Vu(r),r.flags&2048&&_o(9,r,r.return);break;case 3:Vu(r);break;case 12:Vu(r);break;case 22:var l=r.stateNode;r.memoizedState!==null&&l._visibility&2&&(r.return===null||r.return.tag!==13)?(l._visibility&=-3,Xd(r)):Vu(r);break;default:Vu(r)}}function Xd(r){var l=r.deletions;if((r.flags&16)!==0){if(l!==null)for(var u=0;u<l.length;u++){var f=l[u];Zs=f,Fk(f,r)}Rk(r)}for(r=r.child;r!==null;){switch(l=r,l.tag){case 0:case 11:case 15:_o(8,l,l.return),Xd(l);break;case 22:u=l.stateNode,u._visibility&2&&(u._visibility&=-3,Xd(l));break;default:Xd(l)}r=r.sibling}}function Fk(r,l){for(;Zs!==null;){var u=Zs;switch(u.tag){case 0:case 11:case 15:_o(8,u,l);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Bu(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Zs=f;else e:for(u=r;Zs!==null;){f=Zs;var m=f.sibling,b=f.return;if(Nk(f),f===u){Zs=null;break e}if(m!==null){m.return=b,Zs=m;break e}Zs=b}}}var GN={getCacheForType:function(r){var l=cn(Is),u=l.data.get(r);return u===void 0&&(u=r(),l.data.set(r,u)),u},cacheSignal:function(){return cn(Is).controller.signal}},UN=typeof WeakMap=="function"?WeakMap:Map,Bi=0,ji=null,ii=null,oi=0,Ai=0,Zn=null,ko=!1,bc=!1,iy=!1,Ir=0,Ns=0,wo=0,Sl=0,sy=0,jn=0,Sc=0,Hu=null,Vn=null,ny=!1,qd=0,Ik=0,Jd=1/0,Qd=null,Bo=null,Ys=0,To=null,_c=null,Wr=0,ay=0,ry=null,Wk=null,zu=0,oy=null;function ea(){return(Bi&2)!==0&&oi!==0?oi&-oi:F.T!==null?fy():tS()}function Vk(){if(jn===0)if((oi&536870912)===0||ui){var r=wr;wr<<=1,(wr&3932160)===0&&(wr=262144),jn=r}else jn=536870912;return r=Qn.current,r!==null&&(r.flags|=32),jn}function Hn(r,l,u){(r===ji&&(Ai===2||Ai===9)||r.cancelPendingCommit!==null)&&(kc(r,0),xo(r,oi,jn,!1)),cu(r,u),((Bi&2)===0||r!==ji)&&(r===ji&&((Bi&2)===0&&(Sl|=u),Ns===4&&xo(r,oi,jn,!1)),nr(r))}function Hk(r,l,u){if((Bi&6)!==0)throw Error(i(327));var f=!u&&(l&127)===0&&(l&r.expiredLanes)===0||er(r,l),m=f?XN(r,l):cy(r,l,!0),b=f;do{if(m===0){bc&&!f&&xo(r,l,0,!1);break}else{if(u=r.current.alternate,b&&!YN(u)){m=cy(r,l,!1),b=!1;continue}if(m===2){if(b=l,r.errorRecoveryDisabledLanes&b)var B=0;else B=r.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){l=B;e:{var P=r;m=Hu;var W=P.current.memoizedState.isDehydrated;if(W&&(kc(P,B).flags|=256),B=cy(P,B,!1),B!==2){if(iy&&!W){P.errorRecoveryDisabledLanes|=b,Sl|=b,m=4;break e}b=Vn,Vn=m,b!==null&&(Vn===null?Vn=b:Vn.push.apply(Vn,b))}m=B}if(b=!1,m!==2)continue}}if(m===1){kc(r,0),xo(r,l,0,!0);break}e:{switch(f=r,b=m,b){case 0:case 1:throw Error(i(345));case 4:if((l&4194048)!==l)break;case 6:xo(f,l,jn,!ko);break e;case 2:Vn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((l&62914560)===l&&(m=qd+300-Zt(),10<m)){if(xo(f,l,jn,!ko),oo(f,0,!0)!==0)break e;Wr=l,f.timeoutHandle=bw(zk.bind(null,f,u,Vn,Qd,ny,l,jn,Sl,Sc,ko,b,"Throttled",-0,0),m);break e}zk(f,u,Vn,Qd,ny,l,jn,Sl,Sc,ko,b,null,-0,0)}}break}while(!0);nr(r)}function zk(r,l,u,f,m,b,B,P,W,se,ge,Be,ae,ue){if(r.timeoutHandle=-1,Be=l.subtreeFlags,Be&8192||(Be&16785408)===16785408){Be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Tr},Ak(l,b,Be);var Je=(b&62914560)===b?qd-Zt():(b&4194048)===b?Ik-Zt():0;if(Je=E2(Be,Je),Je!==null){Wr=b,r.cancelPendingCommit=Je(Qk.bind(null,r,l,b,u,f,m,B,P,W,ge,Be,null,ae,ue)),xo(r,b,B,!se);return}}Qk(r,l,b,u,f,m,B,P,W)}function YN(r){for(var l=r;;){var u=l.tag;if((u===0||u===11||u===15)&&l.flags&16384&&(u=l.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var m=u[f],b=m.getSnapshot;m=m.value;try{if(!qn(b(),m))return!1}catch{return!1}}if(u=l.child,l.subtreeFlags&16384&&u!==null)u.return=l,l=u;else{if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function xo(r,l,u,f){l&=~sy,l&=~Sl,r.suspendedLanes|=l,r.pingedLanes&=~l,f&&(r.warmLanes|=l),f=r.expirationTimes;for(var m=l;0<m;){var b=31-Qs(m),B=1<<b;f[b]=-1,m&=~B}u!==0&&Zb(r,u,l)}function Kd(){return(Bi&6)===0?(Gu(0),!1):!0}function ly(){if(ii!==null){if(Ai===0)var r=ii.return;else r=ii,Cr=ul=null,Tm(r),hc=null,xu=0,r=ii;for(;r!==null;)Sk(r.alternate,r),r=r.return;ii=null}}function kc(r,l){var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,h2(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),Wr=0,ly(),ji=r,ii=u=vr(r.current,null),oi=l,Ai=0,Zn=null,ko=!1,bc=er(r,l),iy=!1,Sc=jn=sy=Sl=wo=Ns=0,Vn=Hu=null,ny=!1,(l&8)!==0&&(l|=l&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=l;0<f;){var m=31-Qs(f),b=1<<m;l|=r[m],f&=~b}return Ir=l,bd(),u}function Gk(r,l){Gt=null,F.H=Lu,l===uc||l===vd?(l=a_(),Ai=3):l===dm?(l=a_(),Ai=4):Ai=l===Vm?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Zn=l,ii===null&&(Ns=1,Vd(r,ya(l,r.current)))}function Uk(){var r=Qn.current;return r===null?!0:(oi&4194048)===oi?ka===null:(oi&62914560)===oi||(oi&536870912)!==0?r===ka:!1}function Yk(){var r=F.H;return F.H=Lu,r===null?Lu:r}function $k(){var r=F.A;return F.A=GN,r}function Zd(){Ns=4,ko||(oi&4194048)!==oi&&Qn.current!==null||(bc=!0),(wo&134217727)===0&&(Sl&134217727)===0||ji===null||xo(ji,oi,jn,!1)}function cy(r,l,u){var f=Bi;Bi|=2;var m=Yk(),b=$k();(ji!==r||oi!==l)&&(Qd=null,kc(r,l)),l=!1;var B=Ns;e:do try{if(Ai!==0&&ii!==null){var P=ii,W=Zn;switch(Ai){case 8:ly(),B=6;break e;case 3:case 2:case 9:case 6:Qn.current===null&&(l=!0);var se=Ai;if(Ai=0,Zn=null,wc(r,P,W,se),u&&bc){B=0;break e}break;default:se=Ai,Ai=0,Zn=null,wc(r,P,W,se)}}$N(),B=Ns;break}catch(ge){Gk(r,ge)}while(!0);return l&&r.shellSuspendCounter++,Cr=ul=null,Bi=f,F.H=m,F.A=b,ii===null&&(ji=null,oi=0,bd()),B}function $N(){for(;ii!==null;)Xk(ii)}function XN(r,l){var u=Bi;Bi|=2;var f=Yk(),m=$k();ji!==r||oi!==l?(Qd=null,Jd=Zt()+500,kc(r,l)):bc=er(r,l);e:do try{if(Ai!==0&&ii!==null){l=ii;var b=Zn;t:switch(Ai){case 1:Ai=0,Zn=null,wc(r,l,b,1);break;case 2:case 9:if(s_(b)){Ai=0,Zn=null,qk(l);break}l=function(){Ai!==2&&Ai!==9||ji!==r||(Ai=7),nr(r)},b.then(l,l);break e;case 3:Ai=7;break e;case 4:Ai=5;break e;case 7:s_(b)?(Ai=0,Zn=null,qk(l)):(Ai=0,Zn=null,wc(r,l,b,7));break;case 5:var B=null;switch(ii.tag){case 26:B=ii.memoizedState;case 5:case 27:var P=ii;if(B?Lw(B):P.stateNode.complete){Ai=0,Zn=null;var W=P.sibling;if(W!==null)ii=W;else{var se=P.return;se!==null?(ii=se,jd(se)):ii=null}break t}}Ai=0,Zn=null,wc(r,l,b,5);break;case 6:Ai=0,Zn=null,wc(r,l,b,6);break;case 8:ly(),Ns=6;break e;default:throw Error(i(462))}}qN();break}catch(ge){Gk(r,ge)}while(!0);return Cr=ul=null,F.H=f,F.A=m,Bi=u,ii!==null?0:(ji=null,oi=0,bd(),Ns)}function qN(){for(;ii!==null&&!tt();)Xk(ii)}function Xk(r){var l=yk(r.alternate,r,Ir);r.memoizedProps=r.pendingProps,l===null?jd(r):ii=l}function qk(r){var l=r,u=l.alternate;switch(l.tag){case 15:case 0:l=hk(u,l,l.pendingProps,l.type,void 0,oi);break;case 11:l=hk(u,l,l.pendingProps,l.type.render,l.ref,oi);break;case 5:Tm(l);default:Sk(u,l),l=ii=$S(l,Ir),l=yk(u,l,Ir)}r.memoizedProps=r.pendingProps,l===null?jd(r):ii=l}function wc(r,l,u,f){Cr=ul=null,Tm(l),hc=null,xu=0;var m=l.return;try{if(ON(r,m,l,u,oi)){Ns=1,Vd(r,ya(u,r.current)),ii=null;return}}catch(b){if(m!==null)throw ii=m,b;Ns=1,Vd(r,ya(u,r.current)),ii=null;return}l.flags&32768?(ui||f===1?r=!0:bc||(oi&536870912)!==0?r=!1:(ko=r=!0,(f===2||f===9||f===3||f===6)&&(f=Qn.current,f!==null&&f.tag===13&&(f.flags|=16384))),Jk(l,r)):jd(l)}function jd(r){var l=r;do{if((l.flags&32768)!==0){Jk(l,ko);return}r=l.return;var u=WN(l.alternate,l,Ir);if(u!==null){ii=u;return}if(l=l.sibling,l!==null){ii=l;return}ii=l=r}while(l!==null);Ns===0&&(Ns=5)}function Jk(r,l){do{var u=VN(r.alternate,r);if(u!==null){u.flags&=32767,ii=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!l&&(r=r.sibling,r!==null)){ii=r;return}ii=r=u}while(r!==null);Ns=6,ii=null}function Qk(r,l,u,f,m,b,B,P,W){r.cancelPendingCommit=null;do ef();while(Ys!==0);if((Bi&6)!==0)throw Error(i(327));if(l!==null){if(l===r.current)throw Error(i(177));if(b=l.lanes|l.childLanes,b|=Kg,Nv(r,u,b,B,P,W),r===ji&&(ii=ji=null,oi=0),_c=l,To=r,Wr=u,ay=b,ry=m,Wk=f,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,ZN(pt,function(){return tw(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||f){f=F.T,F.T=null,m=re.p,re.p=2,B=Bi,Bi|=4;try{HN(r,l,u)}finally{Bi=B,re.p=m,F.T=f}}Ys=1,Kk(),Zk(),jk()}}function Kk(){if(Ys===1){Ys=0;var r=To,l=_c,u=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||u){u=F.T,F.T=null;var f=re.p;re.p=2;var m=Bi;Bi|=4;try{Dk(l,r);var b=ky,B=FS(r.containerInfo),P=b.focusedElem,W=b.selectionRange;if(B!==P&&P&&P.ownerDocument&&OS(P.ownerDocument.documentElement,P)){if(W!==null&&$g(P)){var se=W.start,ge=W.end;if(ge===void 0&&(ge=se),"selectionStart"in P)P.selectionStart=se,P.selectionEnd=Math.min(ge,P.value.length);else{var Be=P.ownerDocument||document,ae=Be&&Be.defaultView||window;if(ae.getSelection){var ue=ae.getSelection(),Je=P.textContent.length,vt=Math.min(W.start,Je),Ui=W.end===void 0?vt:Math.min(W.end,Je);!ue.extend&&vt>Ui&&(B=Ui,Ui=vt,vt=B);var X=RS(P,vt),G=RS(P,Ui);if(X&&G&&(ue.rangeCount!==1||ue.anchorNode!==X.node||ue.anchorOffset!==X.offset||ue.focusNode!==G.node||ue.focusOffset!==G.offset)){var ie=Be.createRange();ie.setStart(X.node,X.offset),ue.removeAllRanges(),vt>Ui?(ue.addRange(ie),ue.extend(G.node,G.offset)):(ie.setEnd(G.node,G.offset),ue.addRange(ie))}}}}for(Be=[],ue=P;ue=ue.parentNode;)ue.nodeType===1&&Be.push({element:ue,left:ue.scrollLeft,top:ue.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<Be.length;P++){var be=Be[P];be.element.scrollLeft=be.left,be.element.scrollTop=be.top}}ff=!!_y,ky=_y=null}finally{Bi=m,re.p=f,F.T=u}}r.current=l,Ys=2}}function Zk(){if(Ys===2){Ys=0;var r=To,l=_c,u=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||u){u=F.T,F.T=null;var f=re.p;re.p=2;var m=Bi;Bi|=4;try{vk(r,l.alternate,l)}finally{Bi=m,re.p=f,F.T=u}}Ys=3}}function jk(){if(Ys===4||Ys===3){Ys=0,bn();var r=To,l=_c,u=Wr,f=Wk;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ys=5:(Ys=0,_c=To=null,ew(r,r.pendingLanes));var m=r.pendingLanes;if(m===0&&(Bo=null),Ng(u),l=l.stateNode,Hi&&typeof Hi.onCommitFiberRoot=="function")try{Hi.onCommitFiberRoot(bi,l,void 0,(l.current.flags&128)===128)}catch{}if(f!==null){l=F.T,m=re.p,re.p=2,F.T=null;try{for(var b=r.onRecoverableError,B=0;B<f.length;B++){var P=f[B];b(P.value,{componentStack:P.stack})}}finally{F.T=l,re.p=m}}(Wr&3)!==0&&ef(),nr(r),m=r.pendingLanes,(u&261930)!==0&&(m&42)!==0?r===oy?zu++:(zu=0,oy=r):zu=0,Gu(0)}}function ew(r,l){(r.pooledCacheLanes&=l)===0&&(l=r.pooledCache,l!=null&&(r.pooledCache=null,Bu(l)))}function ef(){return Kk(),Zk(),jk(),tw()}function tw(){if(Ys!==5)return!1;var r=To,l=ay;ay=0;var u=Ng(Wr),f=F.T,m=re.p;try{re.p=32>u?32:u,F.T=null,u=ry,ry=null;var b=To,B=Wr;if(Ys=0,_c=To=null,Wr=0,(Bi&6)!==0)throw Error(i(331));var P=Bi;if(Bi|=4,Ok(b.current),Lk(b,b.current,B,u),Bi=P,Gu(0,!1),Hi&&typeof Hi.onPostCommitFiberRoot=="function")try{Hi.onPostCommitFiberRoot(bi,b)}catch{}return!0}finally{re.p=m,F.T=f,ew(r,l)}}function iw(r,l,u){l=ya(u,l),l=Wm(r.stateNode,l,2),r=yo(r,l,2),r!==null&&(cu(r,2),nr(r))}function Ri(r,l,u){if(r.tag===3)iw(r,r,u);else for(;l!==null;){if(l.tag===3){iw(l,r,u);break}else if(l.tag===1){var f=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Bo===null||!Bo.has(f))){r=ya(u,r),u=sk(2),f=yo(l,u,2),f!==null&&(nk(u,f,l,r),cu(f,2),nr(f));break}}l=l.return}}function uy(r,l,u){var f=r.pingCache;if(f===null){f=r.pingCache=new UN;var m=new Set;f.set(l,m)}else m=f.get(l),m===void 0&&(m=new Set,f.set(l,m));m.has(u)||(iy=!0,m.add(u),r=JN.bind(null,r,l,u),l.then(r,r))}function JN(r,l,u){var f=r.pingCache;f!==null&&f.delete(l),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,ji===r&&(oi&u)===u&&(Ns===4||Ns===3&&(oi&62914560)===oi&&300>Zt()-qd?(Bi&2)===0&&kc(r,0):sy|=u,Sc===oi&&(Sc=0)),nr(r)}function sw(r,l){l===0&&(l=Kb()),r=ol(r,l),r!==null&&(cu(r,l),nr(r))}function QN(r){var l=r.memoizedState,u=0;l!==null&&(u=l.retryLane),sw(r,u)}function KN(r,l){var u=0;switch(r.tag){case 31:case 13:var f=r.stateNode,m=r.memoizedState;m!==null&&(u=m.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(l),sw(r,u)}function ZN(r,l){return Ss(r,l)}var tf=null,Bc=null,hy=!1,sf=!1,dy=!1,vo=0;function nr(r){r!==Bc&&r.next===null&&(Bc===null?tf=Bc=r:Bc=Bc.next=r),sf=!0,hy||(hy=!0,e2())}function Gu(r,l){if(!dy&&sf){dy=!0;do for(var u=!1,f=tf;f!==null;){if(r!==0){var m=f.pendingLanes;if(m===0)var b=0;else{var B=f.suspendedLanes,P=f.pingedLanes;b=(1<<31-Qs(42|r)+1)-1,b&=m&~(B&~P),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(u=!0,ow(f,b))}else b=oi,b=oo(f,f===ji?b:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(b&3)===0||er(f,b)||(u=!0,ow(f,b));f=f.next}while(u);dy=!1}}function jN(){nw()}function nw(){sf=hy=!1;var r=0;vo!==0&&u2()&&(r=vo);for(var l=Zt(),u=null,f=tf;f!==null;){var m=f.next,b=aw(f,l);b===0?(f.next=null,u===null?tf=m:u.next=m,m===null&&(Bc=u)):(u=f,(r!==0||(b&3)!==0)&&(sf=!0)),f=m}Ys!==0&&Ys!==5||Gu(r),vo!==0&&(vo=0)}function aw(r,l){for(var u=r.suspendedLanes,f=r.pingedLanes,m=r.expirationTimes,b=r.pendingLanes&-62914561;0<b;){var B=31-Qs(b),P=1<<B,W=m[B];W===-1?((P&u)===0||(P&f)!==0)&&(m[B]=Ra(P,l)):W<=l&&(r.expiredLanes|=P),b&=~P}if(l=ji,u=oi,u=oo(r,r===l?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,u===0||r===l&&(Ai===2||Ai===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&Ci(f),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||er(r,u)){if(l=u&-u,l===r.callbackPriority)return l;switch(f!==null&&Ci(f),Ng(u)){case 2:case 8:u=Ge;break;case 32:u=pt;break;case 268435456:u=Et;break;default:u=pt}return f=rw.bind(null,r),u=Ss(u,f),r.callbackPriority=l,r.callbackNode=u,l}return f!==null&&f!==null&&Ci(f),r.callbackPriority=2,r.callbackNode=null,2}function rw(r,l){if(Ys!==0&&Ys!==5)return r.callbackNode=null,r.callbackPriority=0,null;var u=r.callbackNode;if(ef()&&r.callbackNode!==u)return null;var f=oi;return f=oo(r,r===ji?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(Hk(r,f,l),aw(r,Zt()),r.callbackNode!=null&&r.callbackNode===u?rw.bind(null,r):null)}function ow(r,l){if(ef())return null;Hk(r,l,!0)}function e2(){d2(function(){(Bi&6)!==0?Ss(Me,jN):nw()})}function fy(){if(vo===0){var r=lc;r===0&&(r=Nn,Nn<<=1,(Nn&261888)===0&&(Nn=256)),vo=r}return vo}function lw(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:ud(""+r)}function cw(r,l){var u=l.ownerDocument.createElement("input");return u.name=l.name,u.value=l.value,r.id&&u.setAttribute("form",r.id),l.parentNode.insertBefore(u,l),r=new FormData(r),u.parentNode.removeChild(u),r}function t2(r,l,u,f,m){if(l==="submit"&&u&&u.stateNode===m){var b=lw((m[Rn]||null).action),B=f.submitter;B&&(l=(l=B[Rn]||null)?lw(l.formAction):B.getAttribute("formAction"),l!==null&&(b=l,B=null));var P=new pd("action","action",null,f,m);r.push({event:P,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(vo!==0){var W=B?cw(m,B):new FormData(m);Lm(u,{pending:!0,data:W,method:m.method,action:b},null,W)}}else typeof b=="function"&&(P.preventDefault(),W=B?cw(m,B):new FormData(m),Lm(u,{pending:!0,data:W,method:m.method,action:b},b,W))},currentTarget:m}]})}}for(var py=0;py<Qg.length;py++){var gy=Qg[py],i2=gy.toLowerCase(),s2=gy[0].toUpperCase()+gy.slice(1);Oa(i2,"on"+s2)}Oa(VS,"onAnimationEnd"),Oa(HS,"onAnimationIteration"),Oa(zS,"onAnimationStart"),Oa("dblclick","onDoubleClick"),Oa("focusin","onFocus"),Oa("focusout","onBlur"),Oa(SN,"onTransitionRun"),Oa(_N,"onTransitionStart"),Oa(kN,"onTransitionCancel"),Oa(GS,"onTransitionEnd"),ql("onMouseEnter",["mouseout","mouseover"]),ql("onMouseLeave",["mouseout","mouseover"]),ql("onPointerEnter",["pointerout","pointerover"]),ql("onPointerLeave",["pointerout","pointerover"]),sl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),sl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),sl("onBeforeInput",["compositionend","keypress","textInput","paste"]),sl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),sl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),sl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Uu));function uw(r,l){l=(l&4)!==0;for(var u=0;u<r.length;u++){var f=r[u],m=f.event;f=f.listeners;e:{var b=void 0;if(l)for(var B=f.length-1;0<=B;B--){var P=f[B],W=P.instance,se=P.currentTarget;if(P=P.listener,W!==b&&m.isPropagationStopped())break e;b=P,m.currentTarget=se;try{b(m)}catch(ge){yd(ge)}m.currentTarget=null,b=W}else for(B=0;B<f.length;B++){if(P=f[B],W=P.instance,se=P.currentTarget,P=P.listener,W!==b&&m.isPropagationStopped())break e;b=P,m.currentTarget=se;try{b(m)}catch(ge){yd(ge)}m.currentTarget=null,b=W}}}}function si(r,l){var u=l[Cg];u===void 0&&(u=l[Cg]=new Set);var f=r+"__bubble";u.has(f)||(hw(l,r,2,!1),u.add(f))}function my(r,l,u){var f=0;l&&(f|=4),hw(u,r,f,l)}var nf="_reactListening"+Math.random().toString(36).slice(2);function yy(r){if(!r[nf]){r[nf]=!0,nS.forEach(function(u){u!=="selectionchange"&&(n2.has(u)||my(u,!1,r),my(u,!0,r))});var l=r.nodeType===9?r:r.ownerDocument;l===null||l[nf]||(l[nf]=!0,my("selectionchange",!1,l))}}function hw(r,l,u,f){switch(Vw(l)){case 2:var m=M2;break;case 8:m=L2;break;default:m=My}u=m.bind(null,l,u,r),m=void 0,!Fg||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(m=!0),f?m!==void 0?r.addEventListener(l,u,{capture:!0,passive:m}):r.addEventListener(l,u,!0):m!==void 0?r.addEventListener(l,u,{passive:m}):r.addEventListener(l,u,!1)}function by(r,l,u,f,m){var b=f;if((l&1)===0&&(l&2)===0&&f!==null)e:for(;;){if(f===null)return;var B=f.tag;if(B===3||B===4){var P=f.stateNode.containerInfo;if(P===m)break;if(B===4)for(B=f.return;B!==null;){var W=B.tag;if((W===3||W===4)&&B.stateNode.containerInfo===m)return;B=B.return}for(;P!==null;){if(B=Yl(P),B===null)return;if(W=B.tag,W===5||W===6||W===26||W===27){f=b=B;continue e}P=P.parentNode}}f=f.return}mS(function(){var se=b,ge=Rg(u),Be=[];e:{var ae=US.get(r);if(ae!==void 0){var ue=pd,Je=r;switch(r){case"keypress":if(dd(u)===0)break e;case"keydown":case"keyup":ue=Kv;break;case"focusin":Je="focus",ue=Hg;break;case"focusout":Je="blur",ue=Hg;break;case"beforeblur":case"afterblur":ue=Hg;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=SS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=Wv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=eN;break;case VS:case HS:case zS:ue=zv;break;case GS:ue=iN;break;case"scroll":case"scrollend":ue=Fv;break;case"wheel":ue=nN;break;case"copy":case"cut":case"paste":ue=Uv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=kS;break;case"toggle":case"beforetoggle":ue=rN}var vt=(l&4)!==0,Ui=!vt&&(r==="scroll"||r==="scrollend"),X=vt?ae!==null?ae+"Capture":null:ae;vt=[];for(var G=se,ie;G!==null;){var be=G;if(ie=be.stateNode,be=be.tag,be!==5&&be!==26&&be!==27||ie===null||X===null||(be=du(G,X),be!=null&&vt.push(Yu(G,be,ie))),Ui)break;G=G.return}0<vt.length&&(ae=new ue(ae,Je,null,u,ge),Be.push({event:ae,listeners:vt}))}}if((l&7)===0){e:{if(ae=r==="mouseover"||r==="pointerover",ue=r==="mouseout"||r==="pointerout",ae&&u!==Ag&&(Je=u.relatedTarget||u.fromElement)&&(Yl(Je)||Je[Ul]))break e;if((ue||ae)&&(ae=ge.window===ge?ge:(ae=ge.ownerDocument)?ae.defaultView||ae.parentWindow:window,ue?(Je=u.relatedTarget||u.toElement,ue=se,Je=Je?Yl(Je):null,Je!==null&&(Ui=a(Je),vt=Je.tag,Je!==Ui||vt!==5&&vt!==27&&vt!==6)&&(Je=null)):(ue=null,Je=se),ue!==Je)){if(vt=SS,be="onMouseLeave",X="onMouseEnter",G="mouse",(r==="pointerout"||r==="pointerover")&&(vt=kS,be="onPointerLeave",X="onPointerEnter",G="pointer"),Ui=ue==null?ae:hu(ue),ie=Je==null?ae:hu(Je),ae=new vt(be,G+"leave",ue,u,ge),ae.target=Ui,ae.relatedTarget=ie,be=null,Yl(ge)===se&&(vt=new vt(X,G+"enter",Je,u,ge),vt.target=ie,vt.relatedTarget=Ui,be=vt),Ui=be,ue&&Je)t:{for(vt=a2,X=ue,G=Je,ie=0,be=X;be;be=vt(be))ie++;be=0;for(var gt=G;gt;gt=vt(gt))be++;for(;0<ie-be;)X=vt(X),ie--;for(;0<be-ie;)G=vt(G),be--;for(;ie--;){if(X===G||G!==null&&X===G.alternate){vt=X;break t}X=vt(X),G=vt(G)}vt=null}else vt=null;ue!==null&&dw(Be,ae,ue,vt,!1),Je!==null&&Ui!==null&&dw(Be,Ui,Je,vt,!0)}}e:{if(ae=se?hu(se):window,ue=ae.nodeName&&ae.nodeName.toLowerCase(),ue==="select"||ue==="input"&&ae.type==="file")var Si=ES;else if(NS(ae))if(PS)Si=mN;else{Si=pN;var st=fN}else ue=ae.nodeName,!ue||ue.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?se&&Lg(se.elementType)&&(Si=ES):Si=gN;if(Si&&(Si=Si(r,se))){CS(Be,Si,u,ge);break e}st&&st(r,ae,se),r==="focusout"&&se&&ae.type==="number"&&se.memoizedProps.value!=null&&Mg(ae,"number",ae.value)}switch(st=se?hu(se):window,r){case"focusin":(NS(st)||st.contentEditable==="true")&&(ec=st,Xg=se,_u=null);break;case"focusout":_u=Xg=ec=null;break;case"mousedown":qg=!0;break;case"contextmenu":case"mouseup":case"dragend":qg=!1,IS(Be,u,ge);break;case"selectionchange":if(bN)break;case"keydown":case"keyup":IS(Be,u,ge)}var $t;if(Gg)e:{switch(r){case"compositionstart":var li="onCompositionStart";break e;case"compositionend":li="onCompositionEnd";break e;case"compositionupdate":li="onCompositionUpdate";break e}li=void 0}else jl?xS(r,u)&&(li="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&(li="onCompositionStart");li&&(wS&&u.locale!=="ko"&&(jl||li!=="onCompositionStart"?li==="onCompositionEnd"&&jl&&($t=yS()):(co=ge,Ig="value"in co?co.value:co.textContent,jl=!0)),st=af(se,li),0<st.length&&(li=new _S(li,r,null,u,ge),Be.push({event:li,listeners:st}),$t?li.data=$t:($t=vS(u),$t!==null&&(li.data=$t)))),($t=lN?cN(r,u):uN(r,u))&&(li=af(se,"onBeforeInput"),0<li.length&&(st=new _S("onBeforeInput","beforeinput",null,u,ge),Be.push({event:st,listeners:li}),st.data=$t)),t2(Be,r,se,u,ge)}uw(Be,l)})}function Yu(r,l,u){return{instance:r,listener:l,currentTarget:u}}function af(r,l){for(var u=l+"Capture",f=[];r!==null;){var m=r,b=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||b===null||(m=du(r,u),m!=null&&f.unshift(Yu(r,m,b)),m=du(r,l),m!=null&&f.push(Yu(r,m,b))),r.tag===3)return f;r=r.return}return[]}function a2(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function dw(r,l,u,f,m){for(var b=l._reactName,B=[];u!==null&&u!==f;){var P=u,W=P.alternate,se=P.stateNode;if(P=P.tag,W!==null&&W===f)break;P!==5&&P!==26&&P!==27||se===null||(W=se,m?(se=du(u,b),se!=null&&B.unshift(Yu(u,se,W))):m||(se=du(u,b),se!=null&&B.push(Yu(u,se,W)))),u=u.return}B.length!==0&&r.push({event:l,listeners:B})}var r2=/\r\n?/g,o2=/\u0000|\uFFFD/g;function fw(r){return(typeof r=="string"?r:""+r).replace(r2,`
`).replace(o2,"")}function pw(r,l){return l=fw(l),fw(r)===l}function Gi(r,l,u,f,m,b){switch(u){case"children":typeof f=="string"?l==="body"||l==="textarea"&&f===""||Ql(r,f):(typeof f=="number"||typeof f=="bigint")&&l!=="body"&&Ql(r,""+f);break;case"className":ld(r,"class",f);break;case"tabIndex":ld(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ld(r,u,f);break;case"style":pS(r,f,b);break;case"data":if(l!=="object"){ld(r,"data",f);break}case"src":case"href":if(f===""&&(l!=="a"||u!=="href")){r.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(u);break}f=ud(""+f),r.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(u==="formAction"?(l!=="input"&&Gi(r,l,"name",m.name,m,null),Gi(r,l,"formEncType",m.formEncType,m,null),Gi(r,l,"formMethod",m.formMethod,m,null),Gi(r,l,"formTarget",m.formTarget,m,null)):(Gi(r,l,"encType",m.encType,m,null),Gi(r,l,"method",m.method,m,null),Gi(r,l,"target",m.target,m,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(u);break}f=ud(""+f),r.setAttribute(u,f);break;case"onClick":f!=null&&(r.onclick=Tr);break;case"onScroll":f!=null&&si("scroll",r);break;case"onScrollEnd":f!=null&&si("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(u=f.__html,u!=null){if(m.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}u=ud(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,""+f):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":f===!0?r.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,f):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(u,f):r.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(u):r.setAttribute(u,f);break;case"popover":si("beforetoggle",r),si("toggle",r),od(r,"popover",f);break;case"xlinkActuate":Br(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Br(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Br(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Br(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Br(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Br(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Br(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Br(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Br(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":od(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Rv.get(u)||u,od(r,u,f))}}function Sy(r,l,u,f,m,b){switch(u){case"style":pS(r,f,b);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(u=f.__html,u!=null){if(m.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"children":typeof f=="string"?Ql(r,f):(typeof f=="number"||typeof f=="bigint")&&Ql(r,""+f);break;case"onScroll":f!=null&&si("scroll",r);break;case"onScrollEnd":f!=null&&si("scrollend",r);break;case"onClick":f!=null&&(r.onclick=Tr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!aS.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(m=u.endsWith("Capture"),l=u.slice(2,m?u.length-7:void 0),b=r[Rn]||null,b=b!=null?b[u]:null,typeof b=="function"&&r.removeEventListener(l,b,m),typeof f=="function")){typeof b!="function"&&b!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(l,f,m);break e}u in r?r[u]=f:f===!0?r.setAttribute(u,""):od(r,u,f)}}}function hn(r,l,u){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":si("error",r),si("load",r);var f=!1,m=!1,b;for(b in u)if(u.hasOwnProperty(b)){var B=u[b];if(B!=null)switch(b){case"src":f=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,l));default:Gi(r,l,b,B,u,null)}}m&&Gi(r,l,"srcSet",u.srcSet,u,null),f&&Gi(r,l,"src",u.src,u,null);return;case"input":si("invalid",r);var P=b=B=m=null,W=null,se=null;for(f in u)if(u.hasOwnProperty(f)){var ge=u[f];if(ge!=null)switch(f){case"name":m=ge;break;case"type":B=ge;break;case"checked":W=ge;break;case"defaultChecked":se=ge;break;case"value":b=ge;break;case"defaultValue":P=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(i(137,l));break;default:Gi(r,l,f,ge,u,null)}}uS(r,b,P,W,se,B,m,!1);return;case"select":si("invalid",r),f=B=b=null;for(m in u)if(u.hasOwnProperty(m)&&(P=u[m],P!=null))switch(m){case"value":b=P;break;case"defaultValue":B=P;break;case"multiple":f=P;default:Gi(r,l,m,P,u,null)}l=b,u=B,r.multiple=!!f,l!=null?Jl(r,!!f,l,!1):u!=null&&Jl(r,!!f,u,!0);return;case"textarea":si("invalid",r),b=m=f=null;for(B in u)if(u.hasOwnProperty(B)&&(P=u[B],P!=null))switch(B){case"value":f=P;break;case"defaultValue":m=P;break;case"children":b=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(i(91));break;default:Gi(r,l,B,P,u,null)}dS(r,f,m,b);return;case"option":for(W in u)if(u.hasOwnProperty(W)&&(f=u[W],f!=null))switch(W){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Gi(r,l,W,f,u,null)}return;case"dialog":si("beforetoggle",r),si("toggle",r),si("cancel",r),si("close",r);break;case"iframe":case"object":si("load",r);break;case"video":case"audio":for(f=0;f<Uu.length;f++)si(Uu[f],r);break;case"image":si("error",r),si("load",r);break;case"details":si("toggle",r);break;case"embed":case"source":case"link":si("error",r),si("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in u)if(u.hasOwnProperty(se)&&(f=u[se],f!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,l));default:Gi(r,l,se,f,u,null)}return;default:if(Lg(l)){for(ge in u)u.hasOwnProperty(ge)&&(f=u[ge],f!==void 0&&Sy(r,l,ge,f,u,void 0));return}}for(P in u)u.hasOwnProperty(P)&&(f=u[P],f!=null&&Gi(r,l,P,f,u,null))}function l2(r,l,u,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,b=null,B=null,P=null,W=null,se=null,ge=null;for(ue in u){var Be=u[ue];if(u.hasOwnProperty(ue)&&Be!=null)switch(ue){case"checked":break;case"value":break;case"defaultValue":W=Be;default:f.hasOwnProperty(ue)||Gi(r,l,ue,null,f,Be)}}for(var ae in f){var ue=f[ae];if(Be=u[ae],f.hasOwnProperty(ae)&&(ue!=null||Be!=null))switch(ae){case"type":b=ue;break;case"name":m=ue;break;case"checked":se=ue;break;case"defaultChecked":ge=ue;break;case"value":B=ue;break;case"defaultValue":P=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(i(137,l));break;default:ue!==Be&&Gi(r,l,ae,ue,f,Be)}}Dg(r,B,P,W,se,ge,b,m);return;case"select":ue=B=P=ae=null;for(b in u)if(W=u[b],u.hasOwnProperty(b)&&W!=null)switch(b){case"value":break;case"multiple":ue=W;default:f.hasOwnProperty(b)||Gi(r,l,b,null,f,W)}for(m in f)if(b=f[m],W=u[m],f.hasOwnProperty(m)&&(b!=null||W!=null))switch(m){case"value":ae=b;break;case"defaultValue":P=b;break;case"multiple":B=b;default:b!==W&&Gi(r,l,m,b,f,W)}l=P,u=B,f=ue,ae!=null?Jl(r,!!u,ae,!1):!!f!=!!u&&(l!=null?Jl(r,!!u,l,!0):Jl(r,!!u,u?[]:"",!1));return;case"textarea":ue=ae=null;for(P in u)if(m=u[P],u.hasOwnProperty(P)&&m!=null&&!f.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:Gi(r,l,P,null,f,m)}for(B in f)if(m=f[B],b=u[B],f.hasOwnProperty(B)&&(m!=null||b!=null))switch(B){case"value":ae=m;break;case"defaultValue":ue=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(i(91));break;default:m!==b&&Gi(r,l,B,m,f,b)}hS(r,ae,ue);return;case"option":for(var Je in u)if(ae=u[Je],u.hasOwnProperty(Je)&&ae!=null&&!f.hasOwnProperty(Je))switch(Je){case"selected":r.selected=!1;break;default:Gi(r,l,Je,null,f,ae)}for(W in f)if(ae=f[W],ue=u[W],f.hasOwnProperty(W)&&ae!==ue&&(ae!=null||ue!=null))switch(W){case"selected":r.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:Gi(r,l,W,ae,f,ue)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in u)ae=u[vt],u.hasOwnProperty(vt)&&ae!=null&&!f.hasOwnProperty(vt)&&Gi(r,l,vt,null,f,ae);for(se in f)if(ae=f[se],ue=u[se],f.hasOwnProperty(se)&&ae!==ue&&(ae!=null||ue!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(i(137,l));break;default:Gi(r,l,se,ae,f,ue)}return;default:if(Lg(l)){for(var Ui in u)ae=u[Ui],u.hasOwnProperty(Ui)&&ae!==void 0&&!f.hasOwnProperty(Ui)&&Sy(r,l,Ui,void 0,f,ae);for(ge in f)ae=f[ge],ue=u[ge],!f.hasOwnProperty(ge)||ae===ue||ae===void 0&&ue===void 0||Sy(r,l,ge,ae,f,ue);return}}for(var X in u)ae=u[X],u.hasOwnProperty(X)&&ae!=null&&!f.hasOwnProperty(X)&&Gi(r,l,X,null,f,ae);for(Be in f)ae=f[Be],ue=u[Be],!f.hasOwnProperty(Be)||ae===ue||ae==null&&ue==null||Gi(r,l,Be,ae,f,ue)}function gw(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function c2(){if(typeof performance.getEntriesByType=="function"){for(var r=0,l=0,u=performance.getEntriesByType("resource"),f=0;f<u.length;f++){var m=u[f],b=m.transferSize,B=m.initiatorType,P=m.duration;if(b&&P&&gw(B)){for(B=0,P=m.responseEnd,f+=1;f<u.length;f++){var W=u[f],se=W.startTime;if(se>P)break;var ge=W.transferSize,Be=W.initiatorType;ge&&gw(Be)&&(W=W.responseEnd,B+=ge*(W<P?1:(P-se)/(W-se)))}if(--f,l+=8*(b+B)/(m.duration/1e3),r++,10<r)break}}if(0<r)return l/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var _y=null,ky=null;function rf(r){return r.nodeType===9?r:r.ownerDocument}function mw(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yw(r,l){if(r===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&l==="foreignObject"?0:r}function wy(r,l){return r==="textarea"||r==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var By=null;function u2(){var r=window.event;return r&&r.type==="popstate"?r===By?!1:(By=r,!0):(By=null,!1)}var bw=typeof setTimeout=="function"?setTimeout:void 0,h2=typeof clearTimeout=="function"?clearTimeout:void 0,Sw=typeof Promise=="function"?Promise:void 0,d2=typeof queueMicrotask=="function"?queueMicrotask:typeof Sw<"u"?function(r){return Sw.resolve(null).then(r).catch(f2)}:bw;function f2(r){setTimeout(function(){throw r})}function No(r){return r==="head"}function _w(r,l){var u=l,f=0;do{var m=u.nextSibling;if(r.removeChild(u),m&&m.nodeType===8)if(u=m.data,u==="/$"||u==="/&"){if(f===0){r.removeChild(m),Nc(l);return}f--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")f++;else if(u==="html")$u(r.ownerDocument.documentElement);else if(u==="head"){u=r.ownerDocument.head,$u(u);for(var b=u.firstChild;b;){var B=b.nextSibling,P=b.nodeName;b[uu]||P==="SCRIPT"||P==="STYLE"||P==="LINK"&&b.rel.toLowerCase()==="stylesheet"||u.removeChild(b),b=B}}else u==="body"&&$u(r.ownerDocument.body);u=m}while(u);Nc(l)}function kw(r,l){var u=r;r=0;do{var f=u.nextSibling;if(u.nodeType===1?l?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(l?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),f&&f.nodeType===8)if(u=f.data,u==="/$"){if(r===0)break;r--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||r++;u=f}while(u)}function Ty(r){var l=r.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var u=l;switch(l=l.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Ty(u),Eg(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function p2(r,l,u,f){for(;r.nodeType===1;){var m=u;if(r.nodeName.toLowerCase()!==l.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[uu])switch(l){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(b=r.getAttribute("rel"),b==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(b!==m.rel||r.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||r.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||r.getAttribute("title")!==(m.title==null?null:m.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(b=r.getAttribute("src"),(b!==(m.src==null?null:m.src)||r.getAttribute("type")!==(m.type==null?null:m.type)||r.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&b&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(l==="input"&&r.type==="hidden"){var b=m.name==null?null:""+m.name;if(m.type==="hidden"&&r.getAttribute("name")===b)return r}else return r;if(r=wa(r.nextSibling),r===null)break}return null}function g2(r,l,u){if(l==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=wa(r.nextSibling),r===null))return null;return r}function ww(r,l){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!l||(r=wa(r.nextSibling),r===null))return null;return r}function xy(r){return r.data==="$?"||r.data==="$~"}function vy(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function m2(r,l){var u=r.ownerDocument;if(r.data==="$~")r._reactRetry=l;else if(r.data!=="$?"||u.readyState!=="loading")l();else{var f=function(){l(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function wa(r){for(;r!=null;r=r.nextSibling){var l=r.nodeType;if(l===1||l===3)break;if(l===8){if(l=r.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return r}var Ny=null;function Bw(r){r=r.nextSibling;for(var l=0;r;){if(r.nodeType===8){var u=r.data;if(u==="/$"||u==="/&"){if(l===0)return wa(r.nextSibling);l--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||l++}r=r.nextSibling}return null}function Tw(r){r=r.previousSibling;for(var l=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(l===0)return r;l--}else u!=="/$"&&u!=="/&"||l++}r=r.previousSibling}return null}function xw(r,l,u){switch(l=rf(u),r){case"html":if(r=l.documentElement,!r)throw Error(i(452));return r;case"head":if(r=l.head,!r)throw Error(i(453));return r;case"body":if(r=l.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function $u(r){for(var l=r.attributes;l.length;)r.removeAttributeNode(l[0]);Eg(r)}var Ba=new Map,vw=new Set;function of(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Vr=re.d;re.d={f:y2,r:b2,D:S2,C:_2,L:k2,m:w2,X:T2,S:B2,M:x2};function y2(){var r=Vr.f(),l=Kd();return r||l}function b2(r){var l=$l(r);l!==null&&l.tag===5&&l.type==="form"?G_(l):Vr.r(r)}var Tc=typeof document>"u"?null:document;function Nw(r,l,u){var f=Tc;if(f&&typeof l=="string"&&l){var m=ga(l);m='link[rel="'+r+'"][href="'+m+'"]',typeof u=="string"&&(m+='[crossorigin="'+u+'"]'),vw.has(m)||(vw.add(m),r={rel:r,crossOrigin:u,href:l},f.querySelector(m)===null&&(l=f.createElement("link"),hn(l,"link",r),Ks(l),f.head.appendChild(l)))}}function S2(r){Vr.D(r),Nw("dns-prefetch",r,null)}function _2(r,l){Vr.C(r,l),Nw("preconnect",r,l)}function k2(r,l,u){Vr.L(r,l,u);var f=Tc;if(f&&r&&l){var m='link[rel="preload"][as="'+ga(l)+'"]';l==="image"&&u&&u.imageSrcSet?(m+='[imagesrcset="'+ga(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(m+='[imagesizes="'+ga(u.imageSizes)+'"]')):m+='[href="'+ga(r)+'"]';var b=m;switch(l){case"style":b=xc(r);break;case"script":b=vc(r)}Ba.has(b)||(r=g({rel:"preload",href:l==="image"&&u&&u.imageSrcSet?void 0:r,as:l},u),Ba.set(b,r),f.querySelector(m)!==null||l==="style"&&f.querySelector(Xu(b))||l==="script"&&f.querySelector(qu(b))||(l=f.createElement("link"),hn(l,"link",r),Ks(l),f.head.appendChild(l)))}}function w2(r,l){Vr.m(r,l);var u=Tc;if(u&&r){var f=l&&typeof l.as=="string"?l.as:"script",m='link[rel="modulepreload"][as="'+ga(f)+'"][href="'+ga(r)+'"]',b=m;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=vc(r)}if(!Ba.has(b)&&(r=g({rel:"modulepreload",href:r},l),Ba.set(b,r),u.querySelector(m)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(qu(b)))return}f=u.createElement("link"),hn(f,"link",r),Ks(f),u.head.appendChild(f)}}}function B2(r,l,u){Vr.S(r,l,u);var f=Tc;if(f&&r){var m=Xl(f).hoistableStyles,b=xc(r);l=l||"default";var B=m.get(b);if(!B){var P={loading:0,preload:null};if(B=f.querySelector(Xu(b)))P.loading=5;else{r=g({rel:"stylesheet",href:r,"data-precedence":l},u),(u=Ba.get(b))&&Cy(r,u);var W=B=f.createElement("link");Ks(W),hn(W,"link",r),W._p=new Promise(function(se,ge){W.onload=se,W.onerror=ge}),W.addEventListener("load",function(){P.loading|=1}),W.addEventListener("error",function(){P.loading|=2}),P.loading|=4,lf(B,l,f)}B={type:"stylesheet",instance:B,count:1,state:P},m.set(b,B)}}}function T2(r,l){Vr.X(r,l);var u=Tc;if(u&&r){var f=Xl(u).hoistableScripts,m=vc(r),b=f.get(m);b||(b=u.querySelector(qu(m)),b||(r=g({src:r,async:!0},l),(l=Ba.get(m))&&Ey(r,l),b=u.createElement("script"),Ks(b),hn(b,"link",r),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},f.set(m,b))}}function x2(r,l){Vr.M(r,l);var u=Tc;if(u&&r){var f=Xl(u).hoistableScripts,m=vc(r),b=f.get(m);b||(b=u.querySelector(qu(m)),b||(r=g({src:r,async:!0,type:"module"},l),(l=Ba.get(m))&&Ey(r,l),b=u.createElement("script"),Ks(b),hn(b,"link",r),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},f.set(m,b))}}function Cw(r,l,u,f){var m=(m=je.current)?of(m):null;if(!m)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(l=xc(u.href),u=Xl(m).hoistableStyles,f=u.get(l),f||(f={type:"style",instance:null,count:0,state:null},u.set(l,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=xc(u.href);var b=Xl(m).hoistableStyles,B=b.get(r);if(B||(m=m.ownerDocument||m,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(r,B),(b=m.querySelector(Xu(r)))&&!b._p&&(B.instance=b,B.state.loading=5),Ba.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Ba.set(r,u),b||v2(m,r,u,B.state))),l&&f===null)throw Error(i(528,""));return B}if(l&&f!==null)throw Error(i(529,""));return null;case"script":return l=u.async,u=u.src,typeof u=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=vc(u),u=Xl(m).hoistableScripts,f=u.get(l),f||(f={type:"script",instance:null,count:0,state:null},u.set(l,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function xc(r){return'href="'+ga(r)+'"'}function Xu(r){return'link[rel="stylesheet"]['+r+"]"}function Ew(r){return g({},r,{"data-precedence":r.precedence,precedence:null})}function v2(r,l,u,f){r.querySelector('link[rel="preload"][as="style"]['+l+"]")?f.loading=1:(l=r.createElement("link"),f.preload=l,l.addEventListener("load",function(){return f.loading|=1}),l.addEventListener("error",function(){return f.loading|=2}),hn(l,"link",u),Ks(l),r.head.appendChild(l))}function vc(r){return'[src="'+ga(r)+'"]'}function qu(r){return"script[async]"+r}function Pw(r,l,u){if(l.count++,l.instance===null)switch(l.type){case"style":var f=r.querySelector('style[data-href~="'+ga(u.href)+'"]');if(f)return l.instance=f,Ks(f),f;var m=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),Ks(f),hn(f,"style",m),lf(f,u.precedence,r),l.instance=f;case"stylesheet":m=xc(u.href);var b=r.querySelector(Xu(m));if(b)return l.state.loading|=4,l.instance=b,Ks(b),b;f=Ew(u),(m=Ba.get(m))&&Cy(f,m),b=(r.ownerDocument||r).createElement("link"),Ks(b);var B=b;return B._p=new Promise(function(P,W){B.onload=P,B.onerror=W}),hn(b,"link",f),l.state.loading|=4,lf(b,u.precedence,r),l.instance=b;case"script":return b=vc(u.src),(m=r.querySelector(qu(b)))?(l.instance=m,Ks(m),m):(f=u,(m=Ba.get(b))&&(f=g({},u),Ey(f,m)),r=r.ownerDocument||r,m=r.createElement("script"),Ks(m),hn(m,"link",f),r.head.appendChild(m),l.instance=m);case"void":return null;default:throw Error(i(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(f=l.instance,l.state.loading|=4,lf(f,u.precedence,r));return l.instance}function lf(r,l,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=f.length?f[f.length-1]:null,b=m,B=0;B<f.length;B++){var P=f[B];if(P.dataset.precedence===l)b=P;else if(b!==m)break}b?b.parentNode.insertBefore(r,b.nextSibling):(l=u.nodeType===9?u.head:u,l.insertBefore(r,l.firstChild))}function Cy(r,l){r.crossOrigin==null&&(r.crossOrigin=l.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=l.referrerPolicy),r.title==null&&(r.title=l.title)}function Ey(r,l){r.crossOrigin==null&&(r.crossOrigin=l.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=l.referrerPolicy),r.integrity==null&&(r.integrity=l.integrity)}var cf=null;function Dw(r,l,u){if(cf===null){var f=new Map,m=cf=new Map;m.set(u,f)}else m=cf,f=m.get(u),f||(f=new Map,m.set(u,f));if(f.has(r))return f;for(f.set(r,null),u=u.getElementsByTagName(r),m=0;m<u.length;m++){var b=u[m];if(!(b[uu]||b[on]||r==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var B=b.getAttribute(l)||"";B=r+B;var P=f.get(B);P?P.push(b):f.set(B,[b])}}return f}function Mw(r,l,u){r=r.ownerDocument||r,r.head.insertBefore(u,l==="title"?r.querySelector("head > title"):null)}function N2(r,l,u){if(u===1||l.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return r=l.disabled,typeof l.precedence=="string"&&r==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function Lw(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function C2(r,l,u,f){if(u.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var m=xc(f.href),b=l.querySelector(Xu(m));if(b){l=b._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(r.count++,r=uf.bind(r),l.then(r,r)),u.state.loading|=4,u.instance=b,Ks(b);return}b=l.ownerDocument||l,f=Ew(f),(m=Ba.get(m))&&Cy(f,m),b=b.createElement("link"),Ks(b);var B=b;B._p=new Promise(function(P,W){B.onload=P,B.onerror=W}),hn(b,"link",f),u.instance=b}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(u,l),(l=u.state.preload)&&(u.state.loading&3)===0&&(r.count++,u=uf.bind(r),l.addEventListener("load",u),l.addEventListener("error",u))}}var Py=0;function E2(r,l){return r.stylesheets&&r.count===0&&df(r,r.stylesheets),0<r.count||0<r.imgCount?function(u){var f=setTimeout(function(){if(r.stylesheets&&df(r,r.stylesheets),r.unsuspend){var b=r.unsuspend;r.unsuspend=null,b()}},6e4+l);0<r.imgBytes&&Py===0&&(Py=62500*c2());var m=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&df(r,r.stylesheets),r.unsuspend)){var b=r.unsuspend;r.unsuspend=null,b()}},(r.imgBytes>Py?50:800)+l);return r.unsuspend=u,function(){r.unsuspend=null,clearTimeout(f),clearTimeout(m)}}:null}function uf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)df(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var hf=null;function df(r,l){r.stylesheets=null,r.unsuspend!==null&&(r.count++,hf=new Map,l.forEach(P2,r),hf=null,uf.call(r))}function P2(r,l){if(!(l.state.loading&4)){var u=hf.get(r);if(u)var f=u.get(null);else{u=new Map,hf.set(r,u);for(var m=r.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<m.length;b++){var B=m[b];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(u.set(B.dataset.precedence,B),f=B)}f&&u.set(null,f)}m=l.instance,B=m.getAttribute("data-precedence"),b=u.get(B)||f,b===f&&u.set(null,m),u.set(B,m),this.count++,f=uf.bind(this),m.addEventListener("load",f),m.addEventListener("error",f),b?b.parentNode.insertBefore(m,b.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(m,r.firstChild)),l.state.loading|=4}}var Ju={$$typeof:N,Provider:null,Consumer:null,_currentValue:_e,_currentValue2:_e,_threadCount:0};function D2(r,l,u,f,m,b,B,P,W){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xg(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xg(0),this.hiddenUpdates=xg(null),this.identifierPrefix=f,this.onUncaughtError=m,this.onCaughtError=b,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function Aw(r,l,u,f,m,b,B,P,W,se,ge,Be){return r=new D2(r,l,u,B,W,se,ge,Be,P),l=1,b===!0&&(l|=24),b=Jn(3,null,null,l),r.current=b,b.stateNode=r,l=cm(),l.refCount++,r.pooledCache=l,l.refCount++,b.memoizedState={element:f,isDehydrated:u,cache:l},fm(b),r}function Rw(r){return r?(r=sc,r):sc}function Ow(r,l,u,f,m,b){m=Rw(m),f.context===null?f.context=m:f.pendingContext=m,f=mo(l),f.payload={element:u},b=b===void 0?null:b,b!==null&&(f.callback=b),u=yo(r,f,l),u!==null&&(Hn(u,r,l),Nu(u,r,l))}function Fw(r,l){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<l?u:l}}function Dy(r,l){Fw(r,l),(r=r.alternate)&&Fw(r,l)}function Iw(r){if(r.tag===13||r.tag===31){var l=ol(r,67108864);l!==null&&Hn(l,r,67108864),Dy(r,67108864)}}function Ww(r){if(r.tag===13||r.tag===31){var l=ea();l=vg(l);var u=ol(r,l);u!==null&&Hn(u,r,l),Dy(r,l)}}var ff=!0;function M2(r,l,u,f){var m=F.T;F.T=null;var b=re.p;try{re.p=2,My(r,l,u,f)}finally{re.p=b,F.T=m}}function L2(r,l,u,f){var m=F.T;F.T=null;var b=re.p;try{re.p=8,My(r,l,u,f)}finally{re.p=b,F.T=m}}function My(r,l,u,f){if(ff){var m=Ly(f);if(m===null)by(r,l,f,pf,u),Hw(r,f);else if(R2(m,r,l,u,f))f.stopPropagation();else if(Hw(r,f),l&4&&-1<A2.indexOf(r)){for(;m!==null;){var b=$l(m);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var B=ls(b.pendingLanes);if(B!==0){var P=b;for(P.pendingLanes|=2,P.entangledLanes|=2;B;){var W=1<<31-Qs(B);P.entanglements[1]|=W,B&=~W}nr(b),(Bi&6)===0&&(Jd=Zt()+500,Gu(0))}}break;case 31:case 13:P=ol(b,2),P!==null&&Hn(P,b,2),Kd(),Dy(b,2)}if(b=Ly(f),b===null&&by(r,l,f,pf,u),b===m)break;m=b}m!==null&&f.stopPropagation()}else by(r,l,f,null,u)}}function Ly(r){return r=Rg(r),Ay(r)}var pf=null;function Ay(r){if(pf=null,r=Yl(r),r!==null){var l=a(r);if(l===null)r=null;else{var u=l.tag;if(u===13){if(r=o(l),r!==null)return r;r=null}else if(u===31){if(r=c(l),r!==null)return r;r=null}else if(u===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;r=null}else l!==r&&(r=null)}}return pf=r,null}function Vw(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(He()){case Me:return 2;case Ge:return 8;case pt:case kt:return 32;case Et:return 268435456;default:return 32}default:return 32}}var Ry=!1,Co=null,Eo=null,Po=null,Qu=new Map,Ku=new Map,Do=[],A2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Hw(r,l){switch(r){case"focusin":case"focusout":Co=null;break;case"dragenter":case"dragleave":Eo=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":Qu.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ku.delete(l.pointerId)}}function Zu(r,l,u,f,m,b){return r===null||r.nativeEvent!==b?(r={blockedOn:l,domEventName:u,eventSystemFlags:f,nativeEvent:b,targetContainers:[m]},l!==null&&(l=$l(l),l!==null&&Iw(l)),r):(r.eventSystemFlags|=f,l=r.targetContainers,m!==null&&l.indexOf(m)===-1&&l.push(m),r)}function R2(r,l,u,f,m){switch(l){case"focusin":return Co=Zu(Co,r,l,u,f,m),!0;case"dragenter":return Eo=Zu(Eo,r,l,u,f,m),!0;case"mouseover":return Po=Zu(Po,r,l,u,f,m),!0;case"pointerover":var b=m.pointerId;return Qu.set(b,Zu(Qu.get(b)||null,r,l,u,f,m)),!0;case"gotpointercapture":return b=m.pointerId,Ku.set(b,Zu(Ku.get(b)||null,r,l,u,f,m)),!0}return!1}function zw(r){var l=Yl(r.target);if(l!==null){var u=a(l);if(u!==null){if(l=u.tag,l===13){if(l=o(u),l!==null){r.blockedOn=l,iS(r.priority,function(){Ww(u)});return}}else if(l===31){if(l=c(u),l!==null){r.blockedOn=l,iS(r.priority,function(){Ww(u)});return}}else if(l===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function gf(r){if(r.blockedOn!==null)return!1;for(var l=r.targetContainers;0<l.length;){var u=Ly(r.nativeEvent);if(u===null){u=r.nativeEvent;var f=new u.constructor(u.type,u);Ag=f,u.target.dispatchEvent(f),Ag=null}else return l=$l(u),l!==null&&Iw(l),r.blockedOn=u,!1;l.shift()}return!0}function Gw(r,l,u){gf(r)&&u.delete(l)}function O2(){Ry=!1,Co!==null&&gf(Co)&&(Co=null),Eo!==null&&gf(Eo)&&(Eo=null),Po!==null&&gf(Po)&&(Po=null),Qu.forEach(Gw),Ku.forEach(Gw)}function mf(r,l){r.blockedOn===l&&(r.blockedOn=null,Ry||(Ry=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,O2)))}var yf=null;function Uw(r){yf!==r&&(yf=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){yf===r&&(yf=null);for(var l=0;l<r.length;l+=3){var u=r[l],f=r[l+1],m=r[l+2];if(typeof f!="function"){if(Ay(f||u)===null)continue;break}var b=$l(u);b!==null&&(r.splice(l,3),l-=3,Lm(b,{pending:!0,data:m,method:u.method,action:f},f,m))}}))}function Nc(r){function l(W){return mf(W,r)}Co!==null&&mf(Co,r),Eo!==null&&mf(Eo,r),Po!==null&&mf(Po,r),Qu.forEach(l),Ku.forEach(l);for(var u=0;u<Do.length;u++){var f=Do[u];f.blockedOn===r&&(f.blockedOn=null)}for(;0<Do.length&&(u=Do[0],u.blockedOn===null);)zw(u),u.blockedOn===null&&Do.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var m=u[f],b=u[f+1],B=m[Rn]||null;if(typeof b=="function")B||Uw(u);else if(B){var P=null;if(b&&b.hasAttribute("formAction")){if(m=b,B=b[Rn]||null)P=B.formAction;else if(Ay(m)!==null)continue}else P=B.action;typeof P=="function"?u[f+1]=P:(u.splice(f,3),f-=3),Uw(u)}}}function Yw(){function r(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(B){return m=B})},focusReset:"manual",scroll:"manual"})}function l(){m!==null&&(m(),m=null),f||setTimeout(u,20)}function u(){if(!f&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,m=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(u,100),function(){f=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),m!==null&&(m(),m=null)}}}function Oy(r){this._internalRoot=r}bf.prototype.render=Oy.prototype.render=function(r){var l=this._internalRoot;if(l===null)throw Error(i(409));var u=l.current,f=ea();Ow(u,f,r,l,null,null)},bf.prototype.unmount=Oy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var l=r.containerInfo;Ow(r.current,2,null,r,null,null),Kd(),l[Ul]=null}};function bf(r){this._internalRoot=r}bf.prototype.unstable_scheduleHydration=function(r){if(r){var l=tS();r={blockedOn:null,target:r,priority:l};for(var u=0;u<Do.length&&l!==0&&l<Do[u].priority;u++);Do.splice(u,0,r),u===0&&zw(r)}};var $w=e.version;if($w!=="19.2.3")throw Error(i(527,$w,"19.2.3"));re.findDOMNode=function(r){var l=r._reactInternals;if(l===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=d(l),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var F2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sf.isDisabled&&Sf.supportsFiber)try{bi=Sf.inject(F2),Hi=Sf}catch{}}return eh.createRoot=function(r,l){if(!s(r))throw Error(i(299));var u=!1,f="",m=j_,b=ek,B=tk;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(f=l.identifierPrefix),l.onUncaughtError!==void 0&&(m=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(B=l.onRecoverableError)),l=Aw(r,1,!1,null,null,u,f,null,m,b,B,Yw),r[Ul]=l.current,yy(r),new Oy(l)},eh.hydrateRoot=function(r,l,u){if(!s(r))throw Error(i(299));var f=!1,m="",b=j_,B=ek,P=tk,W=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(m=u.identifierPrefix),u.onUncaughtError!==void 0&&(b=u.onUncaughtError),u.onCaughtError!==void 0&&(B=u.onCaughtError),u.onRecoverableError!==void 0&&(P=u.onRecoverableError),u.formState!==void 0&&(W=u.formState)),l=Aw(r,1,!0,l,u??null,f,m,W,b,B,P,Yw),l.context=Rw(null),u=l.current,f=ea(),f=vg(f),m=mo(f),m.callback=null,yo(u,m,f),u=f,l.current.lanes=u,cu(l,u),nr(l),r[Ul]=l.current,yy(r),new bf(l)},eh.version="19.2.3",eh}var i1;function X2(){if(i1)return Wy.exports;i1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Wy.exports=$2(),Wy.exports}var q2=X2();function to(n,...e){const t=new URL(`https://mui.com/production-error/?code=${n}`);return e.forEach(i=>t.searchParams.append("args[]",i)),`Minified MUI error #${n}; visit ${t} for the full message.`}const yr="$$material";function Xf(){return Xf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Xf.apply(null,arguments)}function J2(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function Q2(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var K2=(function(){function n(t){var i=this;this._insertTag=function(s){var a;i.tags.length===0?i.insertionPoint?a=i.insertionPoint.nextSibling:i.prepend?a=i.container.firstChild:a=i.before:a=i.tags[i.tags.length-1].nextSibling,i.container.insertBefore(s,a),i.tags.push(s)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(i){i.forEach(this._insertTag)},e.insert=function(i){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Q2(this));var s=this.tags[this.tags.length-1];if(this.isSpeedy){var a=J2(s);try{a.insertRule(i,a.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(i));this.ctr++},e.flush=function(){this.tags.forEach(function(i){var s;return(s=i.parentNode)==null?void 0:s.removeChild(i)}),this.tags=[],this.ctr=0},n})(),kn="-ms-",qf="-moz-",Ti="-webkit-",dT="comm",q0="rule",J0="decl",Z2="@import",fT="@keyframes",j2="@layer",eC=Math.abs,Yp=String.fromCharCode,tC=Object.assign;function iC(n,e){return dn(n,0)^45?(((e<<2^dn(n,0))<<2^dn(n,1))<<2^dn(n,2))<<2^dn(n,3):0}function pT(n){return n.trim()}function sC(n,e){return(n=e.exec(n))?n[0]:n}function xi(n,e,t){return n.replace(e,t)}function g0(n,e){return n.indexOf(e)}function dn(n,e){return n.charCodeAt(e)|0}function Rh(n,e,t){return n.slice(e,t)}function lr(n){return n.length}function Q0(n){return n.length}function _f(n,e){return e.push(n),n}function nC(n,e){return n.map(e).join("")}var $p=1,qc=1,gT=0,$n=0,Us=0,au="";function Xp(n,e,t,i,s,a,o){return{value:n,root:e,parent:t,type:i,props:s,children:a,line:$p,column:qc,length:o,return:""}}function th(n,e){return tC(Xp("",null,null,"",null,null,0),n,{length:-n.length},e)}function aC(){return Us}function rC(){return Us=$n>0?dn(au,--$n):0,qc--,Us===10&&(qc=1,$p--),Us}function ca(){return Us=$n<gT?dn(au,$n++):0,qc++,Us===10&&(qc=1,$p++),Us}function br(){return dn(au,$n)}function Wf(){return $n}function Xh(n,e){return Rh(au,n,e)}function Oh(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function mT(n){return $p=qc=1,gT=lr(au=n),$n=0,[]}function yT(n){return au="",n}function Vf(n){return pT(Xh($n-1,m0(n===91?n+2:n===40?n+1:n)))}function oC(n){for(;(Us=br())&&Us<33;)ca();return Oh(n)>2||Oh(Us)>3?"":" "}function lC(n,e){for(;--e&&ca()&&!(Us<48||Us>102||Us>57&&Us<65||Us>70&&Us<97););return Xh(n,Wf()+(e<6&&br()==32&&ca()==32))}function m0(n){for(;ca();)switch(Us){case n:return $n;case 34:case 39:n!==34&&n!==39&&m0(Us);break;case 40:n===41&&m0(n);break;case 92:ca();break}return $n}function cC(n,e){for(;ca()&&n+Us!==57;)if(n+Us===84&&br()===47)break;return"/*"+Xh(e,$n-1)+"*"+Yp(n===47?n:ca())}function uC(n){for(;!Oh(br());)ca();return Xh(n,$n)}function hC(n){return yT(Hf("",null,null,null,[""],n=mT(n),0,[0],n))}function Hf(n,e,t,i,s,a,o,c,h){for(var d=0,p=0,g=o,y=0,k=0,_=0,w=1,T=1,x=1,E=0,N="",v=s,L=a,A=i,D=N;T;)switch(_=E,E=ca()){case 40:if(_!=108&&dn(D,g-1)==58){g0(D+=xi(Vf(E),"&","&\f"),"&\f")!=-1&&(x=-1);break}case 34:case 39:case 91:D+=Vf(E);break;case 9:case 10:case 13:case 32:D+=oC(_);break;case 92:D+=lC(Wf()-1,7);continue;case 47:switch(br()){case 42:case 47:_f(dC(cC(ca(),Wf()),e,t),h);break;default:D+="/"}break;case 123*w:c[d++]=lr(D)*x;case 125*w:case 59:case 0:switch(E){case 0:case 125:T=0;case 59+p:x==-1&&(D=xi(D,/\f/g,"")),k>0&&lr(D)-g&&_f(k>32?n1(D+";",i,t,g-1):n1(xi(D," ","")+";",i,t,g-2),h);break;case 59:D+=";";default:if(_f(A=s1(D,e,t,d,p,s,c,N,v=[],L=[],g),a),E===123)if(p===0)Hf(D,e,A,A,v,a,g,c,L);else switch(y===99&&dn(D,3)===110?100:y){case 100:case 108:case 109:case 115:Hf(n,A,A,i&&_f(s1(n,A,A,0,0,s,c,N,s,v=[],g),L),s,L,g,c,i?v:L);break;default:Hf(D,A,A,A,[""],L,0,c,L)}}d=p=k=0,w=x=1,N=D="",g=o;break;case 58:g=1+lr(D),k=_;default:if(w<1){if(E==123)--w;else if(E==125&&w++==0&&rC()==125)continue}switch(D+=Yp(E),E*w){case 38:x=p>0?1:(D+="\f",-1);break;case 44:c[d++]=(lr(D)-1)*x,x=1;break;case 64:br()===45&&(D+=Vf(ca())),y=br(),p=g=lr(N=D+=uC(Wf())),E++;break;case 45:_===45&&lr(D)==2&&(w=0)}}return a}function s1(n,e,t,i,s,a,o,c,h,d,p){for(var g=s-1,y=s===0?a:[""],k=Q0(y),_=0,w=0,T=0;_<i;++_)for(var x=0,E=Rh(n,g+1,g=eC(w=o[_])),N=n;x<k;++x)(N=pT(w>0?y[x]+" "+E:xi(E,/&\f/g,y[x])))&&(h[T++]=N);return Xp(n,e,t,s===0?q0:c,h,d,p)}function dC(n,e,t){return Xp(n,e,t,dT,Yp(aC()),Rh(n,2,-2),0)}function n1(n,e,t,i){return Xp(n,e,t,J0,Rh(n,0,i),Rh(n,i+1,-1),i)}function $c(n,e){for(var t="",i=Q0(n),s=0;s<i;s++)t+=e(n[s],s,n,e)||"";return t}function fC(n,e,t,i){switch(n.type){case j2:if(n.children.length)break;case Z2:case J0:return n.return=n.return||n.value;case dT:return"";case fT:return n.return=n.value+"{"+$c(n.children,i)+"}";case q0:n.value=n.props.join(",")}return lr(t=$c(n.children,i))?n.return=n.value+"{"+t+"}":""}function pC(n){var e=Q0(n);return function(t,i,s,a){for(var o="",c=0;c<e;c++)o+=n[c](t,i,s,a)||"";return o}}function gC(n){return function(e){e.root||(e=e.return)&&n(e)}}function bT(n){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=n(t)),e[t]}}var mC=function(e,t,i){for(var s=0,a=0;s=a,a=br(),s===38&&a===12&&(t[i]=1),!Oh(a);)ca();return Xh(e,$n)},yC=function(e,t){var i=-1,s=44;do switch(Oh(s)){case 0:s===38&&br()===12&&(t[i]=1),e[i]+=mC($n-1,t,i);break;case 2:e[i]+=Vf(s);break;case 4:if(s===44){e[++i]=br()===58?"&\f":"",t[i]=e[i].length;break}default:e[i]+=Yp(s)}while(s=ca());return e},bC=function(e,t){return yT(yC(mT(e),t))},a1=new WeakMap,SC=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,i=e.parent,s=e.column===i.column&&e.line===i.line;i.type!=="rule";)if(i=i.parent,!i)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!a1.get(i))&&!s){a1.set(e,!0);for(var a=[],o=bC(t,a),c=i.props,h=0,d=0;h<o.length;h++)for(var p=0;p<c.length;p++,d++)e.props[d]=a[h]?o[h].replace(/&\f/g,c[p]):c[p]+" "+o[h]}}},_C=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function ST(n,e){switch(iC(n,e)){case 5103:return Ti+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ti+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Ti+n+qf+n+kn+n+n;case 6828:case 4268:return Ti+n+kn+n+n;case 6165:return Ti+n+kn+"flex-"+n+n;case 5187:return Ti+n+xi(n,/(\w+).+(:[^]+)/,Ti+"box-$1$2"+kn+"flex-$1$2")+n;case 5443:return Ti+n+kn+"flex-item-"+xi(n,/flex-|-self/,"")+n;case 4675:return Ti+n+kn+"flex-line-pack"+xi(n,/align-content|flex-|-self/,"")+n;case 5548:return Ti+n+kn+xi(n,"shrink","negative")+n;case 5292:return Ti+n+kn+xi(n,"basis","preferred-size")+n;case 6060:return Ti+"box-"+xi(n,"-grow","")+Ti+n+kn+xi(n,"grow","positive")+n;case 4554:return Ti+xi(n,/([^-])(transform)/g,"$1"+Ti+"$2")+n;case 6187:return xi(xi(xi(n,/(zoom-|grab)/,Ti+"$1"),/(image-set)/,Ti+"$1"),n,"")+n;case 5495:case 3959:return xi(n,/(image-set\([^]*)/,Ti+"$1$`$1");case 4968:return xi(xi(n,/(.+:)(flex-)?(.*)/,Ti+"box-pack:$3"+kn+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ti+n+n;case 4095:case 3583:case 4068:case 2532:return xi(n,/(.+)-inline(.+)/,Ti+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(lr(n)-1-e>6)switch(dn(n,e+1)){case 109:if(dn(n,e+4)!==45)break;case 102:return xi(n,/(.+:)(.+)-([^]+)/,"$1"+Ti+"$2-$3$1"+qf+(dn(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~g0(n,"stretch")?ST(xi(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(dn(n,e+1)!==115)break;case 6444:switch(dn(n,lr(n)-3-(~g0(n,"!important")&&10))){case 107:return xi(n,":",":"+Ti)+n;case 101:return xi(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Ti+(dn(n,14)===45?"inline-":"")+"box$3$1"+Ti+"$2$3$1"+kn+"$2box$3")+n}break;case 5936:switch(dn(n,e+11)){case 114:return Ti+n+kn+xi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Ti+n+kn+xi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Ti+n+kn+xi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Ti+n+kn+n+n}return n}var kC=function(e,t,i,s){if(e.length>-1&&!e.return)switch(e.type){case J0:e.return=ST(e.value,e.length);break;case fT:return $c([th(e,{value:xi(e.value,"@","@"+Ti)})],s);case q0:if(e.length)return nC(e.props,function(a){switch(sC(a,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return $c([th(e,{props:[xi(a,/:(read-\w+)/,":"+qf+"$1")]})],s);case"::placeholder":return $c([th(e,{props:[xi(a,/:(plac\w+)/,":"+Ti+"input-$1")]}),th(e,{props:[xi(a,/:(plac\w+)/,":"+qf+"$1")]}),th(e,{props:[xi(a,/:(plac\w+)/,kn+"input-$1")]})],s)}return""})}},wC=[kC],BC=function(e){var t=e.key;if(t==="css"){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,function(w){var T=w.getAttribute("data-emotion");T.indexOf(" ")!==-1&&(document.head.appendChild(w),w.setAttribute("data-s",""))})}var s=e.stylisPlugins||wC,a={},o,c=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(w){for(var T=w.getAttribute("data-emotion").split(" "),x=1;x<T.length;x++)a[T[x]]=!0;c.push(w)});var h,d=[SC,_C];{var p,g=[fC,gC(function(w){p.insert(w)})],y=pC(d.concat(s,g)),k=function(T){return $c(hC(T),y)};h=function(T,x,E,N){p=E,k(T?T+"{"+x.styles+"}":x.styles),N&&(_.inserted[x.name]=!0)}}var _={key:t,sheet:new K2({key:t,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:h};return _.sheet.hydrate(c),_},Gy={exports:{}},Ei={};var r1;function TC(){if(r1)return Ei;r1=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,t=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,o=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,h=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,g=n?Symbol.for("react.suspense"):60113,y=n?Symbol.for("react.suspense_list"):60120,k=n?Symbol.for("react.memo"):60115,_=n?Symbol.for("react.lazy"):60116,w=n?Symbol.for("react.block"):60121,T=n?Symbol.for("react.fundamental"):60117,x=n?Symbol.for("react.responder"):60118,E=n?Symbol.for("react.scope"):60119;function N(L){if(typeof L=="object"&&L!==null){var A=L.$$typeof;switch(A){case e:switch(L=L.type,L){case h:case d:case i:case a:case s:case g:return L;default:switch(L=L&&L.$$typeof,L){case c:case p:case _:case k:case o:return L;default:return A}}case t:return A}}}function v(L){return N(L)===d}return Ei.AsyncMode=h,Ei.ConcurrentMode=d,Ei.ContextConsumer=c,Ei.ContextProvider=o,Ei.Element=e,Ei.ForwardRef=p,Ei.Fragment=i,Ei.Lazy=_,Ei.Memo=k,Ei.Portal=t,Ei.Profiler=a,Ei.StrictMode=s,Ei.Suspense=g,Ei.isAsyncMode=function(L){return v(L)||N(L)===h},Ei.isConcurrentMode=v,Ei.isContextConsumer=function(L){return N(L)===c},Ei.isContextProvider=function(L){return N(L)===o},Ei.isElement=function(L){return typeof L=="object"&&L!==null&&L.$$typeof===e},Ei.isForwardRef=function(L){return N(L)===p},Ei.isFragment=function(L){return N(L)===i},Ei.isLazy=function(L){return N(L)===_},Ei.isMemo=function(L){return N(L)===k},Ei.isPortal=function(L){return N(L)===t},Ei.isProfiler=function(L){return N(L)===a},Ei.isStrictMode=function(L){return N(L)===s},Ei.isSuspense=function(L){return N(L)===g},Ei.isValidElementType=function(L){return typeof L=="string"||typeof L=="function"||L===i||L===d||L===a||L===s||L===g||L===y||typeof L=="object"&&L!==null&&(L.$$typeof===_||L.$$typeof===k||L.$$typeof===o||L.$$typeof===c||L.$$typeof===p||L.$$typeof===T||L.$$typeof===x||L.$$typeof===E||L.$$typeof===w)},Ei.typeOf=N,Ei}var o1;function xC(){return o1||(o1=1,Gy.exports=TC()),Gy.exports}var Uy,l1;function vC(){if(l1)return Uy;l1=1;var n=xC(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};a[n.ForwardRef]=i,a[n.Memo]=s;function o(_){return n.isMemo(_)?s:a[_.$$typeof]||e}var c=Object.defineProperty,h=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,g=Object.getPrototypeOf,y=Object.prototype;function k(_,w,T){if(typeof w!="string"){if(y){var x=g(w);x&&x!==y&&k(_,x,T)}var E=h(w);d&&(E=E.concat(d(w)));for(var N=o(_),v=o(w),L=0;L<E.length;++L){var A=E[L];if(!t[A]&&!(T&&T[A])&&!(v&&v[A])&&!(N&&N[A])){var D=p(w,A);try{c(_,A,D)}catch{}}}}return _}return Uy=k,Uy}vC();var NC=!0;function _T(n,e,t){var i="";return t.split(" ").forEach(function(s){n[s]!==void 0?e.push(n[s]+";"):s&&(i+=s+" ")}),i}var K0=function(e,t,i){var s=e.key+"-"+t.name;(i===!1||NC===!1)&&e.registered[s]===void 0&&(e.registered[s]=t.styles)},Z0=function(e,t,i){K0(e,t,i);var s=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var a=t;do e.insert(t===a?"."+s:"",a,e.sheet,!0),a=a.next;while(a!==void 0)}};function CC(n){for(var e=0,t,i=0,s=n.length;s>=4;++i,s-=4)t=n.charCodeAt(i)&255|(n.charCodeAt(++i)&255)<<8|(n.charCodeAt(++i)&255)<<16|(n.charCodeAt(++i)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(s){case 3:e^=(n.charCodeAt(i+2)&255)<<16;case 2:e^=(n.charCodeAt(i+1)&255)<<8;case 1:e^=n.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var EC={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},PC=/[A-Z]|^ms/g,DC=/_EMO_([^_]+?)_([^]*?)_EMO_/g,kT=function(e){return e.charCodeAt(1)===45},c1=function(e){return e!=null&&typeof e!="boolean"},Yy=bT(function(n){return kT(n)?n:n.replace(PC,"-$&").toLowerCase()}),u1=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(DC,function(i,s,a){return cr={name:s,styles:a,next:cr},s})}return EC[e]!==1&&!kT(e)&&typeof t=="number"&&t!==0?t+"px":t};function Fh(n,e,t){if(t==null)return"";var i=t;if(i.__emotion_styles!==void 0)return i;switch(typeof t){case"boolean":return"";case"object":{var s=t;if(s.anim===1)return cr={name:s.name,styles:s.styles,next:cr},s.name;var a=t;if(a.styles!==void 0){var o=a.next;if(o!==void 0)for(;o!==void 0;)cr={name:o.name,styles:o.styles,next:cr},o=o.next;var c=a.styles+";";return c}return MC(n,e,t)}case"function":{if(n!==void 0){var h=cr,d=t(n);return cr=h,Fh(n,e,d)}break}}var p=t;if(e==null)return p;var g=e[p];return g!==void 0?g:p}function MC(n,e,t){var i="";if(Array.isArray(t))for(var s=0;s<t.length;s++)i+=Fh(n,e,t[s])+";";else for(var a in t){var o=t[a];if(typeof o!="object"){var c=o;e!=null&&e[c]!==void 0?i+=a+"{"+e[c]+"}":c1(c)&&(i+=Yy(a)+":"+u1(a,c)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&(e==null||e[o[0]]===void 0))for(var h=0;h<o.length;h++)c1(o[h])&&(i+=Yy(a)+":"+u1(a,o[h])+";");else{var d=Fh(n,e,o);switch(a){case"animation":case"animationName":{i+=Yy(a)+":"+d+";";break}default:i+=a+"{"+d+"}"}}}return i}var h1=/label:\s*([^\s;{]+)\s*(;|$)/g,cr;function qh(n,e,t){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var i=!0,s="";cr=void 0;var a=n[0];if(a==null||a.raw===void 0)i=!1,s+=Fh(t,e,a);else{var o=a;s+=o[0]}for(var c=1;c<n.length;c++)if(s+=Fh(t,e,n[c]),i){var h=a;s+=h[c]}h1.lastIndex=0;for(var d="",p;(p=h1.exec(s))!==null;)d+="-"+p[1];var g=CC(s)+d;return{name:g,styles:s,next:cr}}var LC=function(e){return e()},wT=p0.useInsertionEffect?p0.useInsertionEffect:!1,BT=wT||LC,d1=wT||O.useLayoutEffect,TT=O.createContext(typeof HTMLElement<"u"?BC({key:"css"}):null);TT.Provider;var j0=function(e){return O.forwardRef(function(t,i){var s=O.useContext(TT);return e(t,s,i)})},Jh=O.createContext({}),eb={}.hasOwnProperty,y0="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",AC=function(e,t){var i={};for(var s in t)eb.call(t,s)&&(i[s]=t[s]);return i[y0]=e,i},RC=function(e){var t=e.cache,i=e.serialized,s=e.isStringTag;return K0(t,i,s),BT(function(){return Z0(t,i,s)}),null},OC=j0(function(n,e,t){var i=n.css;typeof i=="string"&&e.registered[i]!==void 0&&(i=e.registered[i]);var s=n[y0],a=[i],o="";typeof n.className=="string"?o=_T(e.registered,a,n.className):n.className!=null&&(o=n.className+" ");var c=qh(a,void 0,O.useContext(Jh));o+=e.key+"-"+c.name;var h={};for(var d in n)eb.call(n,d)&&d!=="css"&&d!==y0&&(h[d]=n[d]);return h.className=o,t&&(h.ref=t),O.createElement(O.Fragment,null,O.createElement(RC,{cache:e,serialized:c,isStringTag:typeof s=="string"}),O.createElement(s,h))}),FC=OC,f1=function(e,t){var i=arguments;if(t==null||!eb.call(t,"css"))return O.createElement.apply(void 0,i);var s=i.length,a=new Array(s);a[0]=FC,a[1]=AC(e,t);for(var o=2;o<s;o++)a[o]=i[o];return O.createElement.apply(null,a)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(f1||(f1={}));var IC=j0(function(n,e){var t=n.styles,i=qh([t],void 0,O.useContext(Jh)),s=O.useRef();return d1(function(){var a=e.key+"-global",o=new e.sheet.constructor({key:a,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),c=!1,h=document.querySelector('style[data-emotion="'+a+" "+i.name+'"]');return e.sheet.tags.length&&(o.before=e.sheet.tags[0]),h!==null&&(c=!0,h.setAttribute("data-emotion",a),o.hydrate([h])),s.current=[o,c],function(){o.flush()}},[e]),d1(function(){var a=s.current,o=a[0],c=a[1];if(c){a[1]=!1;return}if(i.next!==void 0&&Z0(e,i.next,!0),o.tags.length){var h=o.tags[o.tags.length-1].nextElementSibling;o.before=h,o.flush()}e.insert("",i,o,!1)},[e,i.name]),null});function tb(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return qh(e)}function Qh(){var n=tb.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}var WC=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|popover|popoverTarget|popoverTargetAction|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,VC=bT(function(n){return WC.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),HC=VC,zC=function(e){return e!=="theme"},p1=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?HC:zC},g1=function(e,t,i){var s;if(t){var a=t.shouldForwardProp;s=e.__emotion_forwardProp&&a?function(o){return e.__emotion_forwardProp(o)&&a(o)}:a}return typeof s!="function"&&i&&(s=e.__emotion_forwardProp),s},GC=function(e){var t=e.cache,i=e.serialized,s=e.isStringTag;return K0(t,i,s),BT(function(){return Z0(t,i,s)}),null},UC=function n(e,t){var i=e.__emotion_real===e,s=i&&e.__emotion_base||e,a,o;t!==void 0&&(a=t.label,o=t.target);var c=g1(e,t,i),h=c||p1(s),d=!h("as");return function(){var p=arguments,g=i&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(a!==void 0&&g.push("label:"+a+";"),p[0]==null||p[0].raw===void 0)g.push.apply(g,p);else{var y=p[0];g.push(y[0]);for(var k=p.length,_=1;_<k;_++)g.push(p[_],y[_])}var w=j0(function(T,x,E){var N=d&&T.as||s,v="",L=[],A=T;if(T.theme==null){A={};for(var D in T)A[D]=T[D];A.theme=O.useContext(Jh)}typeof T.className=="string"?v=_T(x.registered,L,T.className):T.className!=null&&(v=T.className+" ");var H=qh(g.concat(L),x.registered,A);v+=x.key+"-"+H.name,o!==void 0&&(v+=" "+o);var J=d&&c===void 0?p1(N):h,K={};for(var Y in T)d&&Y==="as"||J(Y)&&(K[Y]=T[Y]);return K.className=v,E&&(K.ref=E),O.createElement(O.Fragment,null,O.createElement(GC,{cache:x,serialized:H,isStringTag:typeof N=="string"}),O.createElement(N,K))});return w.displayName=a!==void 0?a:"Styled("+(typeof s=="string"?s:s.displayName||s.name||"Component")+")",w.defaultProps=e.defaultProps,w.__emotion_real=w,w.__emotion_base=s,w.__emotion_styles=g,w.__emotion_forwardProp=c,Object.defineProperty(w,"toString",{value:function(){return"."+o}}),w.withComponent=function(T,x){var E=n(T,Xf({},t,x,{shouldForwardProp:g1(w,x,!0)}));return E.apply(void 0,g)},w}},YC=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],b0=UC.bind(null);YC.forEach(function(n){b0[n]=b0(n)});var $y={exports:{}},Xy,m1;function $C(){if(m1)return Xy;m1=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Xy=n,Xy}var qy,y1;function XC(){if(y1)return qy;y1=1;var n=$C();function e(){}function t(){}return t.resetWarningCache=e,qy=function(){function i(o,c,h,d,p,g){if(g!==n){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}i.isRequired=i;function s(){return i}var a={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:s,element:i,elementType:i,instanceOf:s,node:i,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},qy}var b1;function qC(){return b1||(b1=1,$y.exports=XC()()),$y.exports}var JC=qC();const ra=$0(JC);function QC(n){return n==null||Object.keys(n).length===0}function xT(n){const{styles:e,defaultTheme:t={}}=n,i=typeof e=="function"?s=>e(QC(s)?t:s):e;return V.jsx(IC,{styles:i})}function vT(n,e){return b0(n,e)}function KC(n,e){Array.isArray(n.__emotion_styles)&&(n.__emotion_styles=e(n.__emotion_styles))}const S1=[];function Go(n){return S1[0]=n,qh(S1)}var Jy={exports:{}},Yi={};var _1;function ZC(){if(_1)return Yi;_1=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.view_transition"),k=Symbol.for("react.client.reference");function _(w){if(typeof w=="object"&&w!==null){var T=w.$$typeof;switch(T){case n:switch(w=w.type,w){case t:case s:case i:case h:case d:case y:return w;default:switch(w=w&&w.$$typeof,w){case o:case c:case g:case p:return w;case a:return w;default:return T}}case e:return T}}}return Yi.ContextConsumer=a,Yi.ContextProvider=o,Yi.Element=n,Yi.ForwardRef=c,Yi.Fragment=t,Yi.Lazy=g,Yi.Memo=p,Yi.Portal=e,Yi.Profiler=s,Yi.StrictMode=i,Yi.Suspense=h,Yi.SuspenseList=d,Yi.isContextConsumer=function(w){return _(w)===a},Yi.isContextProvider=function(w){return _(w)===o},Yi.isElement=function(w){return typeof w=="object"&&w!==null&&w.$$typeof===n},Yi.isForwardRef=function(w){return _(w)===c},Yi.isFragment=function(w){return _(w)===t},Yi.isLazy=function(w){return _(w)===g},Yi.isMemo=function(w){return _(w)===p},Yi.isPortal=function(w){return _(w)===e},Yi.isProfiler=function(w){return _(w)===s},Yi.isStrictMode=function(w){return _(w)===i},Yi.isSuspense=function(w){return _(w)===h},Yi.isSuspenseList=function(w){return _(w)===d},Yi.isValidElementType=function(w){return typeof w=="string"||typeof w=="function"||w===t||w===s||w===i||w===h||w===d||typeof w=="object"&&w!==null&&(w.$$typeof===g||w.$$typeof===p||w.$$typeof===o||w.$$typeof===a||w.$$typeof===c||w.$$typeof===k||w.getModuleId!==void 0)},Yi.typeOf=_,Yi}var k1;function jC(){return k1||(k1=1,Jy.exports=ZC()),Jy.exports}var NT=jC();function dr(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function CT(n){if(O.isValidElement(n)||NT.isValidElementType(n)||!dr(n))return n;const e={};return Object.keys(n).forEach(t=>{e[t]=CT(n[t])}),e}function rn(n,e,t={clone:!0}){const i=t.clone?{...n}:n;return dr(n)&&dr(e)&&Object.keys(e).forEach(s=>{O.isValidElement(e[s])||NT.isValidElementType(e[s])?i[s]=e[s]:dr(e[s])&&Object.prototype.hasOwnProperty.call(n,s)&&dr(n[s])?i[s]=rn(n[s],e[s],t):t.clone?i[s]=dr(e[s])?CT(e[s]):e[s]:i[s]=e[s]}),i}const eE=n=>{const e=Object.keys(n).map(t=>({key:t,val:n[t]}))||[];return e.sort((t,i)=>t.val-i.val),e.reduce((t,i)=>({...t,[i.key]:i.val}),{})};function tE(n){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:t="px",step:i=5,...s}=n,a=eE(e),o=Object.keys(a);function c(y){return`@media (min-width:${typeof e[y]=="number"?e[y]:y}${t})`}function h(y){return`@media (max-width:${(typeof e[y]=="number"?e[y]:y)-i/100}${t})`}function d(y,k){const _=o.indexOf(k);return`@media (min-width:${typeof e[y]=="number"?e[y]:y}${t}) and (max-width:${(_!==-1&&typeof e[o[_]]=="number"?e[o[_]]:k)-i/100}${t})`}function p(y){return o.indexOf(y)+1<o.length?d(y,o[o.indexOf(y)+1]):c(y)}function g(y){const k=o.indexOf(y);return k===0?c(o[1]):k===o.length-1?h(o[k]):d(y,o[o.indexOf(y)+1]).replace("@media","@media not all and")}return{keys:o,values:a,up:c,down:h,between:d,only:p,not:g,unit:t,...s}}function w1(n,e){if(!n.containerQueries)return e;const t=Object.keys(e).filter(i=>i.startsWith("@container")).sort((i,s)=>{const a=/min-width:\s*([0-9.]+)/;return+(i.match(a)?.[1]||0)-+(s.match(a)?.[1]||0)});return t.length?t.reduce((i,s)=>{const a=e[s];return delete i[s],i[s]=a,i},{...e}):e}function iE(n,e){return e==="@"||e.startsWith("@")&&(n.some(t=>e.startsWith(`@${t}`))||!!e.match(/^@\d/))}function sE(n,e){const t=e.match(/^@([^/]+)?\/?(.+)?$/);if(!t)return null;const[,i,s]=t,a=Number.isNaN(+i)?i||0:+i;return n.containerQueries(s).up(a)}function nE(n){const e=(a,o)=>a.replace("@media",o?`@container ${o}`:"@container");function t(a,o){a.up=(...c)=>e(n.breakpoints.up(...c),o),a.down=(...c)=>e(n.breakpoints.down(...c),o),a.between=(...c)=>e(n.breakpoints.between(...c),o),a.only=(...c)=>e(n.breakpoints.only(...c),o),a.not=(...c)=>{const h=e(n.breakpoints.not(...c),o);return h.includes("not all and")?h.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):h}}const i={},s=a=>(t(i,a),i);return t(s),{...n,containerQueries:s}}const aE={borderRadius:4};function bh(n,e){return e?rn(n,e,{clone:!1}):n}const qp={xs:0,sm:600,md:900,lg:1200,xl:1536},B1={keys:["xs","sm","md","lg","xl"],up:n=>`@media (min-width:${qp[n]}px)`},rE={containerQueries:n=>({up:e=>{let t=typeof e=="number"?e:qp[e]||e;return typeof t=="number"&&(t=`${t}px`),n?`@container ${n} (min-width:${t})`:`@container (min-width:${t})`}})};function Ja(n,e,t){const i=n.theme||{};if(Array.isArray(e)){const a=i.breakpoints||B1;return e.reduce((o,c,h)=>(o[a.up(a.keys[h])]=t(e[h]),o),{})}if(typeof e=="object"){const a=i.breakpoints||B1;return Object.keys(e).reduce((o,c)=>{if(iE(a.keys,c)){const h=sE(i.containerQueries?i:rE,c);h&&(o[h]=t(e[c],c))}else if(Object.keys(a.values||qp).includes(c)){const h=a.up(c);o[h]=t(e[c],c)}else{const h=c;o[h]=e[h]}return o},{})}return t(e)}function ET(n={}){return n.keys?.reduce((t,i)=>{const s=n.up(i);return t[s]={},t},{})||{}}function S0(n,e){return n.reduce((t,i)=>{const s=t[i];return(!s||Object.keys(s).length===0)&&delete t[i],t},e)}function oE(n,...e){const t=ET(n),i=[t,...e].reduce((s,a)=>rn(s,a),{});return S0(Object.keys(t),i)}function lE(n,e){if(typeof n!="object")return{};const t={},i=Object.keys(e);return Array.isArray(n)?i.forEach((s,a)=>{a<n.length&&(t[s]=!0)}):i.forEach(s=>{n[s]!=null&&(t[s]=!0)}),t}function Qy({values:n,breakpoints:e,base:t}){const i=t||lE(n,e),s=Object.keys(i);if(s.length===0)return n;let a;return s.reduce((o,c,h)=>(Array.isArray(n)?(o[c]=n[h]!=null?n[h]:n[a],a=h):typeof n=="object"?(o[c]=n[c]!=null?n[c]:n[a],a=c):o[c]=n,o),{})}function bt(n){if(typeof n!="string")throw new Error(to(7));return n.charAt(0).toUpperCase()+n.slice(1)}function Jp(n,e,t=!0){if(!e||typeof e!="string")return null;if(n&&n.vars&&t){const i=`vars.${e}`.split(".").reduce((s,a)=>s&&s[a]?s[a]:null,n);if(i!=null)return i}return e.split(".").reduce((i,s)=>i&&i[s]!=null?i[s]:null,n)}function Jf(n,e,t,i=t){let s;return typeof n=="function"?s=n(t):Array.isArray(n)?s=n[t]||i:s=Jp(n,t)||i,e&&(s=e(s,i,n)),s}function Fs(n){const{prop:e,cssProperty:t=n.prop,themeKey:i,transform:s}=n,a=o=>{if(o[e]==null)return null;const c=o[e],h=o.theme,d=Jp(h,i)||{};return Ja(o,c,g=>{let y=Jf(d,s,g);return g===y&&typeof g=="string"&&(y=Jf(d,s,`${e}${g==="default"?"":bt(g)}`,g)),t===!1?y:{[t]:y}})};return a.propTypes={},a.filterProps=[e],a}function cE(n){const e={};return t=>(e[t]===void 0&&(e[t]=n(t)),e[t])}const uE={m:"margin",p:"padding"},hE={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},T1={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},dE=cE(n=>{if(n.length>2)if(T1[n])n=T1[n];else return[n];const[e,t]=n.split(""),i=uE[e],s=hE[t]||"";return Array.isArray(s)?s.map(a=>i+a):[i+s]}),ib=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],sb=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...ib,...sb];function Kh(n,e,t,i){const s=Jp(n,e,!0)??t;return typeof s=="number"||typeof s=="string"?a=>typeof a=="string"?a:typeof s=="string"?s.startsWith("var(")&&a===0?0:s.startsWith("var(")&&a===1?s:`calc(${a} * ${s})`:s*a:Array.isArray(s)?a=>{if(typeof a=="string")return a;const o=Math.abs(a),c=s[o];return a>=0?c:typeof c=="number"?-c:typeof c=="string"&&c.startsWith("var(")?`calc(-1 * ${c})`:`-${c}`}:typeof s=="function"?s:()=>{}}function Qp(n){return Kh(n,"spacing",8)}function Wl(n,e){return typeof e=="string"||e==null?e:n(e)}function fE(n,e){return t=>n.reduce((i,s)=>(i[s]=Wl(e,t),i),{})}function pE(n,e,t,i){if(!e.includes(t))return null;const s=dE(t),a=fE(s,i),o=n[t];return Ja(n,o,a)}function PT(n,e){const t=Qp(n.theme);return Object.keys(n).map(i=>pE(n,e,i,t)).reduce(bh,{})}function Cs(n){return PT(n,ib)}Cs.propTypes={};Cs.filterProps=ib;function Es(n){return PT(n,sb)}Es.propTypes={};Es.filterProps=sb;function DT(n=8,e=Qp({spacing:n})){if(n.mui)return n;const t=(...i)=>(i.length===0?[1]:i).map(a=>{const o=e(a);return typeof o=="number"?`${o}px`:o}).join(" ");return t.mui=!0,t}function Kp(...n){const e=n.reduce((i,s)=>(s.filterProps.forEach(a=>{i[a]=s}),i),{}),t=i=>Object.keys(i).reduce((s,a)=>e[a]?bh(s,e[a](i)):s,{});return t.propTypes={},t.filterProps=n.reduce((i,s)=>i.concat(s.filterProps),[]),t}function Ca(n){return typeof n!="number"?n:`${n}px solid`}function La(n,e){return Fs({prop:n,themeKey:"borders",transform:e})}const gE=La("border",Ca),mE=La("borderTop",Ca),yE=La("borderRight",Ca),bE=La("borderBottom",Ca),SE=La("borderLeft",Ca),_E=La("borderColor"),kE=La("borderTopColor"),wE=La("borderRightColor"),BE=La("borderBottomColor"),TE=La("borderLeftColor"),xE=La("outline",Ca),vE=La("outlineColor"),Zp=n=>{if(n.borderRadius!==void 0&&n.borderRadius!==null){const e=Kh(n.theme,"shape.borderRadius",4),t=i=>({borderRadius:Wl(e,i)});return Ja(n,n.borderRadius,t)}return null};Zp.propTypes={};Zp.filterProps=["borderRadius"];Kp(gE,mE,yE,bE,SE,_E,kE,wE,BE,TE,Zp,xE,vE);const jp=n=>{if(n.gap!==void 0&&n.gap!==null){const e=Kh(n.theme,"spacing",8),t=i=>({gap:Wl(e,i)});return Ja(n,n.gap,t)}return null};jp.propTypes={};jp.filterProps=["gap"];const eg=n=>{if(n.columnGap!==void 0&&n.columnGap!==null){const e=Kh(n.theme,"spacing",8),t=i=>({columnGap:Wl(e,i)});return Ja(n,n.columnGap,t)}return null};eg.propTypes={};eg.filterProps=["columnGap"];const tg=n=>{if(n.rowGap!==void 0&&n.rowGap!==null){const e=Kh(n.theme,"spacing",8),t=i=>({rowGap:Wl(e,i)});return Ja(n,n.rowGap,t)}return null};tg.propTypes={};tg.filterProps=["rowGap"];const NE=Fs({prop:"gridColumn"}),CE=Fs({prop:"gridRow"}),EE=Fs({prop:"gridAutoFlow"}),PE=Fs({prop:"gridAutoColumns"}),DE=Fs({prop:"gridAutoRows"}),ME=Fs({prop:"gridTemplateColumns"}),LE=Fs({prop:"gridTemplateRows"}),AE=Fs({prop:"gridTemplateAreas"}),RE=Fs({prop:"gridArea"});Kp(jp,eg,tg,NE,CE,EE,PE,DE,ME,LE,AE,RE);function Xc(n,e){return e==="grey"?e:n}const OE=Fs({prop:"color",themeKey:"palette",transform:Xc}),FE=Fs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Xc}),IE=Fs({prop:"backgroundColor",themeKey:"palette",transform:Xc});Kp(OE,FE,IE);function la(n){return n<=1&&n!==0?`${n*100}%`:n}const WE=Fs({prop:"width",transform:la}),nb=n=>{if(n.maxWidth!==void 0&&n.maxWidth!==null){const e=t=>{const i=n.theme?.breakpoints?.values?.[t]||qp[t];return i?n.theme?.breakpoints?.unit!=="px"?{maxWidth:`${i}${n.theme.breakpoints.unit}`}:{maxWidth:i}:{maxWidth:la(t)}};return Ja(n,n.maxWidth,e)}return null};nb.filterProps=["maxWidth"];const VE=Fs({prop:"minWidth",transform:la}),HE=Fs({prop:"height",transform:la}),zE=Fs({prop:"maxHeight",transform:la}),GE=Fs({prop:"minHeight",transform:la});Fs({prop:"size",cssProperty:"width",transform:la});Fs({prop:"size",cssProperty:"height",transform:la});const UE=Fs({prop:"boxSizing"});Kp(WE,nb,VE,HE,zE,GE,UE);const Zh={border:{themeKey:"borders",transform:Ca},borderTop:{themeKey:"borders",transform:Ca},borderRight:{themeKey:"borders",transform:Ca},borderBottom:{themeKey:"borders",transform:Ca},borderLeft:{themeKey:"borders",transform:Ca},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Ca},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:Zp},color:{themeKey:"palette",transform:Xc},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Xc},backgroundColor:{themeKey:"palette",transform:Xc},p:{style:Es},pt:{style:Es},pr:{style:Es},pb:{style:Es},pl:{style:Es},px:{style:Es},py:{style:Es},padding:{style:Es},paddingTop:{style:Es},paddingRight:{style:Es},paddingBottom:{style:Es},paddingLeft:{style:Es},paddingX:{style:Es},paddingY:{style:Es},paddingInline:{style:Es},paddingInlineStart:{style:Es},paddingInlineEnd:{style:Es},paddingBlock:{style:Es},paddingBlockStart:{style:Es},paddingBlockEnd:{style:Es},m:{style:Cs},mt:{style:Cs},mr:{style:Cs},mb:{style:Cs},ml:{style:Cs},mx:{style:Cs},my:{style:Cs},margin:{style:Cs},marginTop:{style:Cs},marginRight:{style:Cs},marginBottom:{style:Cs},marginLeft:{style:Cs},marginX:{style:Cs},marginY:{style:Cs},marginInline:{style:Cs},marginInlineStart:{style:Cs},marginInlineEnd:{style:Cs},marginBlock:{style:Cs},marginBlockStart:{style:Cs},marginBlockEnd:{style:Cs},displayPrint:{cssProperty:!1,transform:n=>({"@media print":{display:n}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:jp},rowGap:{style:tg},columnGap:{style:eg},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:la},maxWidth:{style:nb},minWidth:{transform:la},height:{transform:la},maxHeight:{transform:la},minHeight:{transform:la},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function YE(...n){const e=n.reduce((i,s)=>i.concat(Object.keys(s)),[]),t=new Set(e);return n.every(i=>t.size===Object.keys(i).length)}function $E(n,e){return typeof n=="function"?n(e):n}function XE(){function n(t,i,s,a){const o={[t]:i,theme:s},c=a[t];if(!c)return{[t]:i};const{cssProperty:h=t,themeKey:d,transform:p,style:g}=c;if(i==null)return null;if(d==="typography"&&i==="inherit")return{[t]:i};const y=Jp(s,d)||{};return g?g(o):Ja(o,i,_=>{let w=Jf(y,p,_);return _===w&&typeof _=="string"&&(w=Jf(y,p,`${t}${_==="default"?"":bt(_)}`,_)),h===!1?w:{[h]:w}})}function e(t){const{sx:i,theme:s={},nested:a}=t||{};if(!i)return null;const o=s.unstable_sxConfig??Zh;function c(h){let d=h;if(typeof h=="function")d=h(s);else if(typeof h!="object")return h;if(!d)return null;const p=ET(s.breakpoints),g=Object.keys(p);let y=p;return Object.keys(d).forEach(k=>{const _=$E(d[k],s);if(_!=null)if(typeof _=="object")if(o[k])y=bh(y,n(k,_,s,o));else{const w=Ja({theme:s},_,T=>({[k]:T}));YE(w,_)?y[k]=e({sx:_,theme:s,nested:!0}):y=bh(y,w)}else y=bh(y,n(k,_,s,o))}),!a&&s.modularCssLayers?{"@layer sx":w1(s,S0(g,y))}:w1(s,S0(g,y))}return Array.isArray(i)?i.map(c):c(i)}return e}const Xo=XE();Xo.filterProps=["sx"];function qE(n,e){const t=this;if(t.vars){if(!t.colorSchemes?.[n]||typeof t.getColorSchemeSelector!="function")return{};let i=t.getColorSchemeSelector(n);return i==="&"?e:((i.includes("data-")||i.includes("."))&&(i=`*:where(${i.replace(/\s*&$/,"")}) &`),{[i]:e})}return t.palette.mode===n?e:{}}function ig(n={},...e){const{breakpoints:t={},palette:i={},spacing:s,shape:a={},...o}=n,c=tE(t),h=DT(s);let d=rn({breakpoints:c,direction:"ltr",components:{},palette:{mode:"light",...i},spacing:h,shape:{...aE,...a}},o);return d=nE(d),d.applyStyles=qE,d=e.reduce((p,g)=>rn(p,g),d),d.unstable_sxConfig={...Zh,...o?.unstable_sxConfig},d.unstable_sx=function(g){return Xo({sx:g,theme:this})},d}function JE(n){return Object.keys(n).length===0}function ab(n=null){const e=O.useContext(Jh);return!e||JE(e)?n:e}const QE=ig();function sg(n=QE){return ab(n)}function Ky(n){const e=Go(n);return n!==e&&e.styles?(e.styles.match(/^@layer\s+[^{]*$/)||(e.styles=`@layer global{${e.styles}}`),e):n}function MT({styles:n,themeId:e,defaultTheme:t={}}){const i=sg(t),s=e&&i[e]||i;let a=typeof n=="function"?n(s):n;return s.modularCssLayers&&(Array.isArray(a)?a=a.map(o=>Ky(typeof o=="function"?o(s):o)):a=Ky(a)),V.jsx(xT,{styles:a})}const KE=n=>{const e={systemProps:{},otherProps:{}},t=n?.theme?.unstable_sxConfig??Zh;return Object.keys(n).forEach(i=>{t[i]?e.systemProps[i]=n[i]:e.otherProps[i]=n[i]}),e};function rb(n){const{sx:e,...t}=n,{systemProps:i,otherProps:s}=KE(t);let a;return Array.isArray(e)?a=[i,...e]:typeof e=="function"?a=(...o)=>{const c=e(...o);return dr(c)?{...i,...c}:i}:a={...i,...e},{...s,sx:a}}const x1=n=>n,ZE=()=>{let n=x1;return{configure(e){n=e},generate(e){return n(e)},reset(){n=x1}}},LT=ZE();function AT(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=AT(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function Lt(){for(var n,e,t=0,i="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=AT(n))&&(i&&(i+=" "),i+=e);return i}function jE(n={}){const{themeId:e,defaultTheme:t,defaultClassName:i="MuiBox-root",generateClassName:s}=n,a=vT("div",{shouldForwardProp:c=>c!=="theme"&&c!=="sx"&&c!=="as"})(Xo);return O.forwardRef(function(h,d){const p=sg(t),{className:g,component:y="div",...k}=rb(h);return V.jsx(a,{as:y,ref:d,className:Lt(g,s?s(i):i),theme:e&&p[e]||p,...k})})}const eP={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Qi(n,e,t="Mui"){const i=eP[e];return i?`${t}-${i}`:`${LT.generate(n)}-${e}`}function Wi(n,e,t="Mui"){const i={};return e.forEach(s=>{i[s]=Qi(n,s,t)}),i}function RT(n){const{variants:e,...t}=n,i={variants:e,style:Go(t),isProcessed:!0};return i.style===t||e&&e.forEach(s=>{typeof s.style!="function"&&(s.style=Go(s.style))}),i}const tP=ig();function Zy(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}function Dl(n,e){return e&&n&&typeof n=="object"&&n.styles&&!n.styles.startsWith("@layer")&&(n.styles=`@layer ${e}{${String(n.styles)}}`),n}function iP(n){return n?(e,t)=>t[n]:null}function sP(n,e,t){n.theme=aP(n.theme)?t:n.theme[e]||n.theme}function zf(n,e,t){const i=typeof e=="function"?e(n):e;if(Array.isArray(i))return i.flatMap(s=>zf(n,s,t));if(Array.isArray(i?.variants)){let s;if(i.isProcessed)s=t?Dl(i.style,t):i.style;else{const{variants:a,...o}=i;s=t?Dl(Go(o),t):o}return OT(n,i.variants,[s],t)}return i?.isProcessed?t?Dl(Go(i.style),t):i.style:t?Dl(Go(i),t):i}function OT(n,e,t=[],i=void 0){let s;e:for(let a=0;a<e.length;a+=1){const o=e[a];if(typeof o.props=="function"){if(s??={...n,...n.ownerState,ownerState:n.ownerState},!o.props(s))continue}else for(const c in o.props)if(n[c]!==o.props[c]&&n.ownerState?.[c]!==o.props[c])continue e;typeof o.style=="function"?(s??={...n,...n.ownerState,ownerState:n.ownerState},t.push(i?Dl(Go(o.style(s)),i):o.style(s))):t.push(i?Dl(Go(o.style),i):o.style)}return t}function FT(n={}){const{themeId:e,defaultTheme:t=tP,rootShouldForwardProp:i=Zy,slotShouldForwardProp:s=Zy}=n;function a(c){sP(c,e,t)}return(c,h={})=>{KC(c,A=>A.filter(D=>D!==Xo));const{name:d,slot:p,skipVariantsResolver:g,skipSx:y,overridesResolver:k=iP(oP(p)),..._}=h,w=d&&d.startsWith("Mui")||p?"components":"custom",T=g!==void 0?g:p&&p!=="Root"&&p!=="root"||!1,x=y||!1;let E=Zy;p==="Root"||p==="root"?E=i:p?E=s:rP(c)&&(E=void 0);const N=vT(c,{shouldForwardProp:E,label:nP(),..._}),v=A=>{if(A.__emotion_real===A)return A;if(typeof A=="function")return function(H){return zf(H,A,H.theme.modularCssLayers?w:void 0)};if(dr(A)){const D=RT(A);return function(J){return D.variants?zf(J,D,J.theme.modularCssLayers?w:void 0):J.theme.modularCssLayers?Dl(D.style,w):D.style}}return A},L=(...A)=>{const D=[],H=A.map(v),J=[];if(D.push(a),d&&k&&J.push(function(Q){const le=Q.theme.components?.[d]?.styleOverrides;if(!le)return null;const F={};for(const re in le)F[re]=zf(Q,le[re],Q.theme.modularCssLayers?"theme":void 0);return k(Q,F)}),d&&!T&&J.push(function(Q){const le=Q.theme?.components?.[d]?.variants;return le?OT(Q,le,[],Q.theme.modularCssLayers?"theme":void 0):null}),x||J.push(Xo),Array.isArray(H[0])){const C=H.shift(),Q=new Array(D.length).fill(""),Z=new Array(J.length).fill("");let le;le=[...Q,...C,...Z],le.raw=[...Q,...C.raw,...Z],D.unshift(le)}const K=[...D,...H,...J],Y=N(...K);return c.muiName&&(Y.muiName=c.muiName),Y};return N.withConfig&&(L.withConfig=N.withConfig),L}}function nP(n,e){return void 0}function aP(n){for(const e in n)return!1;return!0}function rP(n){return typeof n=="string"&&n.charCodeAt(0)>96}function oP(n){return n&&n.charAt(0).toLowerCase()+n.slice(1)}const lP=FT();function Jc(n,e,t=!1){const i={...e};for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)){const a=s;if(a==="components"||a==="slots")i[a]={...n[a],...i[a]};else if(a==="componentsProps"||a==="slotProps"){const o=n[a],c=e[a];if(!c)i[a]=o||{};else if(!o)i[a]=c;else{i[a]={...c};for(const h in o)if(Object.prototype.hasOwnProperty.call(o,h)){const d=h;i[a][d]=Jc(o[d],c[d],t)}}}else a==="className"&&t&&e.className?i.className=Lt(n?.className,e?.className):a==="style"&&t&&e.style?i.style={...n?.style,...e?.style}:i[a]===void 0&&(i[a]=n[a])}return i}function cP(n){const{theme:e,name:t,props:i}=n;return!e||!e.components||!e.components[t]||!e.components[t].defaultProps?i:Jc(e.components[t].defaultProps,i)}function uP({props:n,name:e,defaultTheme:t,themeId:i}){let s=sg(t);return i&&(s=s[i]||s),cP({theme:s,name:e,props:n})}const Ma=typeof window<"u"?O.useLayoutEffect:O.useEffect;function Oc(n,e=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(n,t))}function ob(n,e=0,t=1){return Oc(n,e,t)}function hP(n){n=n.slice(1);const e=new RegExp(`.{1,${n.length>=6?2:1}}`,"g");let t=n.match(e);return t&&t[0].length===1&&(t=t.map(i=>i+i)),t?`rgb${t.length===4?"a":""}(${t.map((i,s)=>s<3?parseInt(i,16):Math.round(parseInt(i,16)/255*1e3)/1e3).join(", ")})`:""}function qo(n){if(n.type)return n;if(n.charAt(0)==="#")return qo(hP(n));const e=n.indexOf("("),t=n.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(t))throw new Error(to(9,n));let i=n.substring(e+1,n.length-1),s;if(t==="color"){if(i=i.split(" "),s=i.shift(),i.length===4&&i[3].charAt(0)==="/"&&(i[3]=i[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(s))throw new Error(to(10,s))}else i=i.split(",");return i=i.map(a=>parseFloat(a)),{type:t,values:i,colorSpace:s}}const dP=n=>{const e=qo(n);return e.values.slice(0,3).map((t,i)=>e.type.includes("hsl")&&i!==0?`${t}%`:t).join(" ")},uh=(n,e)=>{try{return dP(n)}catch{return n}};function ng(n){const{type:e,colorSpace:t}=n;let{values:i}=n;return e.includes("rgb")?i=i.map((s,a)=>a<3?parseInt(s,10):s):e.includes("hsl")&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),e.includes("color")?i=`${t} ${i.join(" ")}`:i=`${i.join(", ")}`,`${e}(${i})`}function IT(n){n=qo(n);const{values:e}=n,t=e[0],i=e[1]/100,s=e[2]/100,a=i*Math.min(s,1-s),o=(d,p=(d+t/30)%12)=>s-a*Math.max(Math.min(p-3,9-p,1),-1);let c="rgb";const h=[Math.round(o(0)*255),Math.round(o(8)*255),Math.round(o(4)*255)];return n.type==="hsla"&&(c+="a",h.push(e[3])),ng({type:c,values:h})}function _0(n){n=qo(n);let e=n.type==="hsl"||n.type==="hsla"?qo(IT(n)).values:n.values;return e=e.map(t=>(n.type!=="color"&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function fP(n,e){const t=_0(n),i=_0(e);return(Math.max(t,i)+.05)/(Math.min(t,i)+.05)}function Qf(n,e){return n=qo(n),e=ob(e),(n.type==="rgb"||n.type==="hsl")&&(n.type+="a"),n.type==="color"?n.values[3]=`/${e}`:n.values[3]=e,ng(n)}function _l(n,e,t){try{return Qf(n,e)}catch{return n}}function Jo(n,e){if(n=qo(n),e=ob(e),n.type.includes("hsl"))n.values[2]*=1-e;else if(n.type.includes("rgb")||n.type.includes("color"))for(let t=0;t<3;t+=1)n.values[t]*=1-e;return ng(n)}function Oi(n,e,t){try{return Jo(n,e)}catch{return n}}function ag(n,e){if(n=qo(n),e=ob(e),n.type.includes("hsl"))n.values[2]+=(100-n.values[2])*e;else if(n.type.includes("rgb"))for(let t=0;t<3;t+=1)n.values[t]+=(255-n.values[t])*e;else if(n.type.includes("color"))for(let t=0;t<3;t+=1)n.values[t]+=(1-n.values[t])*e;return ng(n)}function Fi(n,e,t){try{return ag(n,e)}catch{return n}}function pP(n,e=.15){return _0(n)>.5?Jo(n,e):ag(n,e)}function kf(n,e,t){try{return pP(n,e)}catch{return n}}const WT=O.createContext(null);function lb(){return O.useContext(WT)}const gP=typeof Symbol=="function"&&Symbol.for,mP=gP?Symbol.for("mui.nested"):"__THEME_NESTED__";function yP(n,e){return typeof e=="function"?e(n):{...n,...e}}function bP(n){const{children:e,theme:t}=n,i=lb(),s=O.useMemo(()=>{const a=i===null?{...t}:yP(i,t);return a!=null&&(a[mP]=i!==null),a},[t,i]);return V.jsx(WT.Provider,{value:s,children:e})}const VT=O.createContext();function SP({value:n,...e}){return V.jsx(VT.Provider,{value:n??!0,...e})}const HT=()=>O.useContext(VT)??!1,zT=O.createContext(void 0);function _P({value:n,children:e}){return V.jsx(zT.Provider,{value:n,children:e})}function kP(n){const{theme:e,name:t,props:i}=n;if(!e||!e.components||!e.components[t])return i;const s=e.components[t];return s.defaultProps?Jc(s.defaultProps,i,e.components.mergeClassNameAndStyle):!s.styleOverrides&&!s.variants?Jc(s,i,e.components.mergeClassNameAndStyle):i}function wP({props:n,name:e}){const t=O.useContext(zT);return kP({props:n,name:e,theme:{components:t}})}let v1=0;function BP(n){const[e,t]=O.useState(n),i=n||e;return O.useEffect(()=>{e==null&&(v1+=1,t(`mui-${v1}`))},[e]),i}const TP={...p0},N1=TP.useId;function rg(n){if(N1!==void 0){const e=N1();return n??e}return BP(n)}function xP(n){const e=ab(),t=rg()||"",{modularCssLayers:i}=n;let s="mui.global, mui.components, mui.theme, mui.custom, mui.sx";return!i||e!==null?s="":typeof i=="string"?s=i.replace(/mui(?!\.)/g,s):s=`@layer ${s};`,Ma(()=>{const a=document.querySelector("head");if(!a)return;const o=a.firstChild;if(s){if(o&&o.hasAttribute?.("data-mui-layer-order")&&o.getAttribute("data-mui-layer-order")===t)return;const c=document.createElement("style");c.setAttribute("data-mui-layer-order",t),c.textContent=s,a.prepend(c)}else a.querySelector(`style[data-mui-layer-order="${t}"]`)?.remove()},[s,t]),s?V.jsx(MT,{styles:s}):null}const C1={};function E1(n,e,t,i=!1){return O.useMemo(()=>{const s=n&&e[n]||e;if(typeof t=="function"){const a=t(s),o=n?{...e,[n]:a}:a;return i?()=>o:o}return n?{...e,[n]:t}:{...e,...t}},[n,e,t,i])}function GT(n){const{children:e,theme:t,themeId:i}=n,s=ab(C1),a=lb()||C1,o=E1(i,s,t),c=E1(i,a,t,!0),h=(i?o[i]:o).direction==="rtl",d=xP(o);return V.jsx(bP,{theme:c,children:V.jsx(Jh.Provider,{value:o,children:V.jsx(SP,{value:h,children:V.jsxs(_P,{value:i?o[i].components:o.components,children:[d,e]})})})})}const P1={theme:void 0};function vP(n){let e,t;return function(s){let a=e;return(a===void 0||s.theme!==t)&&(P1.theme=s.theme,a=RT(n(P1)),e=a,t=s.theme),a}}const cb="mode",ub="color-scheme",NP="data-color-scheme";function CP(n){const{defaultMode:e="system",defaultLightColorScheme:t="light",defaultDarkColorScheme:i="dark",modeStorageKey:s=cb,colorSchemeStorageKey:a=ub,attribute:o=NP,colorSchemeNode:c="document.documentElement",nonce:h}=n||{};let d="",p=o;if(o==="class"&&(p=".%s"),o==="data"&&(p="[data-%s]"),p.startsWith(".")){const y=p.substring(1);d+=`${c}.classList.remove('${y}'.replace('%s', light), '${y}'.replace('%s', dark));
      ${c}.classList.add('${y}'.replace('%s', colorScheme));`}const g=p.match(/\[([^[\]]+)\]/);if(g){const[y,k]=g[1].split("=");k||(d+=`${c}.removeAttribute('${y}'.replace('%s', light));
      ${c}.removeAttribute('${y}'.replace('%s', dark));`),d+=`
      ${c}.setAttribute('${y}'.replace('%s', colorScheme), ${k?`${k}.replace('%s', colorScheme)`:'""'});`}else p!==".%s"&&(d+=`${c}.setAttribute('${p}', colorScheme);`);return V.jsx("script",{suppressHydrationWarning:!0,nonce:typeof window>"u"?h:"",dangerouslySetInnerHTML:{__html:`(function() {
try {
  let colorScheme = '';
  const mode = localStorage.getItem('${s}') || '${e}';
  const dark = localStorage.getItem('${a}-dark') || '${i}';
  const light = localStorage.getItem('${a}-light') || '${t}';
  if (mode === 'system') {
    // handle system mode
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql.matches) {
      colorScheme = dark
    } else {
      colorScheme = light
    }
  }
  if (mode === 'light') {
    colorScheme = light;
  }
  if (mode === 'dark') {
    colorScheme = dark;
  }
  if (colorScheme) {
    ${d}
  }
} catch(e){}})();`}},"mui-color-scheme-init")}function EP(){}const PP=({key:n,storageWindow:e})=>(!e&&typeof window<"u"&&(e=window),{get(t){if(typeof window>"u")return;if(!e)return t;let i;try{i=e.localStorage.getItem(n)}catch{}return i||t},set:t=>{if(e)try{e.localStorage.setItem(n,t)}catch{}},subscribe:t=>{if(!e)return EP;const i=s=>{const a=s.newValue;s.key===n&&t(a)};return e.addEventListener("storage",i),()=>{e.removeEventListener("storage",i)}}});function jy(){}function D1(n){if(typeof window<"u"&&typeof window.matchMedia=="function"&&n==="system")return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function UT(n,e){if(n.mode==="light"||n.mode==="system"&&n.systemMode==="light")return e("light");if(n.mode==="dark"||n.mode==="system"&&n.systemMode==="dark")return e("dark")}function DP(n){return UT(n,e=>{if(e==="light")return n.lightColorScheme;if(e==="dark")return n.darkColorScheme})}function MP(n){const{defaultMode:e="light",defaultLightColorScheme:t,defaultDarkColorScheme:i,supportedColorSchemes:s=[],modeStorageKey:a=cb,colorSchemeStorageKey:o=ub,storageWindow:c=typeof window>"u"?void 0:window,storageManager:h=PP,noSsr:d=!1}=n,p=s.join(","),g=s.length>1,y=O.useMemo(()=>h?.({key:a,storageWindow:c}),[h,a,c]),k=O.useMemo(()=>h?.({key:`${o}-light`,storageWindow:c}),[h,o,c]),_=O.useMemo(()=>h?.({key:`${o}-dark`,storageWindow:c}),[h,o,c]),[w,T]=O.useState(()=>{const H=y?.get(e)||e,J=k?.get(t)||t,K=_?.get(i)||i;return{mode:H,systemMode:D1(H),lightColorScheme:J,darkColorScheme:K}}),[x,E]=O.useState(d||!g);O.useEffect(()=>{E(!0)},[]);const N=DP(w),v=O.useCallback(H=>{T(J=>{if(H===J.mode)return J;const K=H??e;return y?.set(K),{...J,mode:K,systemMode:D1(K)}})},[y,e]),L=O.useCallback(H=>{H?typeof H=="string"?H&&!p.includes(H)?console.error(`\`${H}\` does not exist in \`theme.colorSchemes\`.`):T(J=>{const K={...J};return UT(J,Y=>{Y==="light"&&(k?.set(H),K.lightColorScheme=H),Y==="dark"&&(_?.set(H),K.darkColorScheme=H)}),K}):T(J=>{const K={...J},Y=H.light===null?t:H.light,C=H.dark===null?i:H.dark;return Y&&(p.includes(Y)?(K.lightColorScheme=Y,k?.set(Y)):console.error(`\`${Y}\` does not exist in \`theme.colorSchemes\`.`)),C&&(p.includes(C)?(K.darkColorScheme=C,_?.set(C)):console.error(`\`${C}\` does not exist in \`theme.colorSchemes\`.`)),K}):T(J=>(k?.set(t),_?.set(i),{...J,lightColorScheme:t,darkColorScheme:i}))},[p,k,_,t,i]),A=O.useCallback(H=>{w.mode==="system"&&T(J=>{const K=H?.matches?"dark":"light";return J.systemMode===K?J:{...J,systemMode:K}})},[w.mode]),D=O.useRef(A);return D.current=A,O.useEffect(()=>{if(typeof window.matchMedia!="function"||!g)return;const H=(...K)=>D.current(...K),J=window.matchMedia("(prefers-color-scheme: dark)");return J.addListener(H),H(J),()=>{J.removeListener(H)}},[g]),O.useEffect(()=>{if(g){const H=y?.subscribe(Y=>{(!Y||["light","dark","system"].includes(Y))&&v(Y||e)})||jy,J=k?.subscribe(Y=>{(!Y||p.match(Y))&&L({light:Y})})||jy,K=_?.subscribe(Y=>{(!Y||p.match(Y))&&L({dark:Y})})||jy;return()=>{H(),J(),K()}}},[L,v,p,e,c,g,y,k,_]),{...w,mode:x?w.mode:void 0,systemMode:x?w.systemMode:void 0,colorScheme:x?N:void 0,setMode:v,setColorScheme:L}}const LP="*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}";function AP(n){const{themeId:e,theme:t={},modeStorageKey:i=cb,colorSchemeStorageKey:s=ub,disableTransitionOnChange:a=!1,defaultColorScheme:o,resolveTheme:c}=n,h={allColorSchemes:[],colorScheme:void 0,darkColorScheme:void 0,lightColorScheme:void 0,mode:void 0,setColorScheme:()=>{},setMode:()=>{},systemMode:void 0},d=O.createContext(void 0),p=()=>O.useContext(d)||h,g={},y={};function k(x){const{children:E,theme:N,modeStorageKey:v=i,colorSchemeStorageKey:L=s,disableTransitionOnChange:A=a,storageManager:D,storageWindow:H=typeof window>"u"?void 0:window,documentNode:J=typeof document>"u"?void 0:document,colorSchemeNode:K=typeof document>"u"?void 0:document.documentElement,disableNestedContext:Y=!1,disableStyleSheetGeneration:C=!1,defaultMode:Q="system",forceThemeRerender:Z=!1,noSsr:le}=x,F=O.useRef(!1),re=lb(),_e=O.useContext(d),ve=!!_e&&!Y,Ve=O.useMemo(()=>N||(typeof t=="function"?t():t),[N]),R=Ve[e],te=R||Ve,{colorSchemes:we=g,components:Ee=y,cssVarPrefix:qe}=te,je=Object.keys(we).filter(Me=>!!we[Me]).join(","),ze=O.useMemo(()=>je.split(","),[je]),qt=typeof o=="string"?o:o.light,Pt=typeof o=="string"?o:o.dark,xt=we[qt]&&we[Pt]?Q:we[te.defaultColorScheme]?.palette?.mode||te.palette?.mode,{mode:zt,setMode:Ut,systemMode:yi,lightColorScheme:St,darkColorScheme:ri,colorScheme:Ms,setColorScheme:di}=MP({supportedColorSchemes:ze,defaultLightColorScheme:qt,defaultDarkColorScheme:Pt,modeStorageKey:v,colorSchemeStorageKey:L,defaultMode:xt,storageManager:D,storageWindow:H,noSsr:le});let Ni=zt,Mi=Ms;ve&&(Ni=_e.mode,Mi=_e.colorScheme);let Ss=Mi||te.defaultColorScheme;te.vars&&!Z&&(Ss=te.defaultColorScheme);const Ci=O.useMemo(()=>{const Me=te.generateThemeVars?.()||te.vars,Ge={...te,components:Ee,colorSchemes:we,cssVarPrefix:qe,vars:Me};if(typeof Ge.generateSpacing=="function"&&(Ge.spacing=Ge.generateSpacing()),Ss){const pt=we[Ss];pt&&typeof pt=="object"&&Object.keys(pt).forEach(kt=>{pt[kt]&&typeof pt[kt]=="object"?Ge[kt]={...Ge[kt],...pt[kt]}:Ge[kt]=pt[kt]})}return c?c(Ge):Ge},[te,Ss,Ee,we,qe]),tt=te.colorSchemeSelector;Ma(()=>{if(Mi&&K&&tt&&tt!=="media"){const Me=tt;let Ge=tt;if(Me==="class"&&(Ge=".%s"),Me==="data"&&(Ge="[data-%s]"),Me?.startsWith("data-")&&!Me.includes("%s")&&(Ge=`[${Me}="%s"]`),Ge.startsWith("."))K.classList.remove(...ze.map(pt=>Ge.substring(1).replace("%s",pt))),K.classList.add(Ge.substring(1).replace("%s",Mi));else{const pt=Ge.replace("%s",Mi).match(/\[([^\]]+)\]/);if(pt){const[kt,Et]=pt[1].split("=");Et||ze.forEach(Yt=>{K.removeAttribute(kt.replace(Mi,Yt))}),K.setAttribute(kt,Et?Et.replace(/"|'/g,""):"")}else K.setAttribute(Ge,Mi)}}},[Mi,tt,K,ze]),O.useEffect(()=>{let Me;if(A&&F.current&&J){const Ge=J.createElement("style");Ge.appendChild(J.createTextNode(LP)),J.head.appendChild(Ge),window.getComputedStyle(J.body),Me=setTimeout(()=>{J.head.removeChild(Ge)},1)}return()=>{clearTimeout(Me)}},[Mi,A,J]),O.useEffect(()=>(F.current=!0,()=>{F.current=!1}),[]);const bn=O.useMemo(()=>({allColorSchemes:ze,colorScheme:Mi,darkColorScheme:ri,lightColorScheme:St,mode:Ni,setColorScheme:di,setMode:Ut,systemMode:yi}),[ze,Mi,ri,St,Ni,di,Ut,yi,Ci.colorSchemeSelector]);let Zt=!0;(C||te.cssVariables===!1||ve&&re?.cssVarPrefix===qe)&&(Zt=!1);const He=V.jsxs(O.Fragment,{children:[V.jsx(GT,{themeId:R?e:void 0,theme:Ci,children:E}),Zt&&V.jsx(xT,{styles:Ci.generateStyleSheets?.()||[]})]});return ve?He:V.jsx(d.Provider,{value:bn,children:He})}const _=typeof o=="string"?o:o.light,w=typeof o=="string"?o:o.dark;return{CssVarsProvider:k,useColorScheme:p,getInitColorSchemeScript:x=>CP({colorSchemeStorageKey:s,defaultLightColorScheme:_,defaultDarkColorScheme:w,modeStorageKey:i,...x})}}function RP(n=""){function e(...i){if(!i.length)return"";const s=i[0];return typeof s=="string"&&!s.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${n?`${n}-`:""}${s}${e(...i.slice(1))})`:`, ${s}`}return(i,...s)=>`var(--${n?`${n}-`:""}${i}${e(...s)})`}const M1=(n,e,t,i=[])=>{let s=n;e.forEach((a,o)=>{o===e.length-1?Array.isArray(s)?s[Number(a)]=t:s&&typeof s=="object"&&(s[a]=t):s&&typeof s=="object"&&(s[a]||(s[a]=i.includes(a)?[]:{}),s=s[a])})},OP=(n,e,t)=>{function i(s,a=[],o=[]){Object.entries(s).forEach(([c,h])=>{(!t||t&&!t([...a,c]))&&h!=null&&(typeof h=="object"&&Object.keys(h).length>0?i(h,[...a,c],Array.isArray(h)?[...o,c]:o):e([...a,c],h,o))})}i(n)},FP=(n,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(i=>n.includes(i))||n[n.length-1].toLowerCase().includes("opacity")?e:`${e}px`:e;function e0(n,e){const{prefix:t,shouldSkipGeneratingVar:i}=e||{},s={},a={},o={};return OP(n,(c,h,d)=>{if((typeof h=="string"||typeof h=="number")&&(!i||!i(c,h))){const p=`--${t?`${t}-`:""}${c.join("-")}`,g=FP(c,h);Object.assign(s,{[p]:g}),M1(a,c,`var(${p})`,d),M1(o,c,`var(${p}, ${g})`,d)}},c=>c[0]==="vars"),{css:s,vars:a,varsWithDefaults:o}}function IP(n,e={}){const{getSelector:t=x,disableCssColorScheme:i,colorSchemeSelector:s,enableContrastVars:a}=e,{colorSchemes:o={},components:c,defaultColorScheme:h="light",...d}=n,{vars:p,css:g,varsWithDefaults:y}=e0(d,e);let k=y;const _={},{[h]:w,...T}=o;if(Object.entries(T||{}).forEach(([v,L])=>{const{vars:A,css:D,varsWithDefaults:H}=e0(L,e);k=rn(k,H),_[v]={css:D,vars:A}}),w){const{css:v,vars:L,varsWithDefaults:A}=e0(w,e);k=rn(k,A),_[h]={css:v,vars:L}}function x(v,L){let A=s;if(s==="class"&&(A=".%s"),s==="data"&&(A="[data-%s]"),s?.startsWith("data-")&&!s.includes("%s")&&(A=`[${s}="%s"]`),v){if(A==="media")return n.defaultColorScheme===v?":root":{[`@media (prefers-color-scheme: ${o[v]?.palette?.mode||v})`]:{":root":L}};if(A)return n.defaultColorScheme===v?`:root, ${A.replace("%s",String(v))}`:A.replace("%s",String(v))}return":root"}return{vars:k,generateThemeVars:()=>{let v={...p};return Object.entries(_).forEach(([,{vars:L}])=>{v=rn(v,L)}),v},generateStyleSheets:()=>{const v=[],L=n.defaultColorScheme||"light";function A(J,K){Object.keys(K).length&&v.push(typeof J=="string"?{[J]:{...K}}:J)}A(t(void 0,{...g}),g);const{[L]:D,...H}=_;if(D){const{css:J}=D,K=o[L]?.palette?.mode,Y=!i&&K?{colorScheme:K,...J}:{...J};A(t(L,{...Y}),Y)}return Object.entries(H).forEach(([J,{css:K}])=>{const Y=o[J]?.palette?.mode,C=!i&&Y?{colorScheme:Y,...K}:{...K};A(t(J,{...C}),C)}),a&&v.push({":root":{"--__l-threshold":"0.7","--__l":"clamp(0, (l / var(--__l-threshold) - 1) * -infinity, 1)","--__a":"clamp(0.87, (l / var(--__l-threshold) - 1) * -infinity, 1)"}}),v}}}function WP(n){return function(t){return n==="media"?`@media (prefers-color-scheme: ${t})`:n?n.startsWith("data-")&&!n.includes("%s")?`[${n}="${t}"] &`:n==="class"?`.${t} &`:n==="data"?`[data-${t}] &`:`${n.replace("%s",t)} &`:"&"}}function Ki(n,e,t=void 0){const i={};for(const s in n){const a=n[s];let o="",c=!0;for(let h=0;h<a.length;h+=1){const d=a[h];d&&(o+=(c===!0?"":" ")+e(d),c=!1,t&&t[d]&&(o+=" "+t[d]))}i[s]=o}return i}const VP=ig(),HP=lP("div",{name:"MuiStack",slot:"Root"});function zP(n){return uP({props:n,name:"MuiStack",defaultTheme:VP})}function GP(n,e){const t=O.Children.toArray(n).filter(Boolean);return t.reduce((i,s,a)=>(i.push(s),a<t.length-1&&i.push(O.cloneElement(e,{key:`separator-${a}`})),i),[])}const UP=n=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[n],YP=({ownerState:n,theme:e})=>{let t={display:"flex",flexDirection:"column",...Ja({theme:e},Qy({values:n.direction,breakpoints:e.breakpoints.values}),i=>({flexDirection:i}))};if(n.spacing){const i=Qp(e),s=Object.keys(e.breakpoints.values).reduce((h,d)=>((typeof n.spacing=="object"&&n.spacing[d]!=null||typeof n.direction=="object"&&n.direction[d]!=null)&&(h[d]=!0),h),{}),a=Qy({values:n.direction,base:s}),o=Qy({values:n.spacing,base:s});typeof a=="object"&&Object.keys(a).forEach((h,d,p)=>{if(!a[h]){const y=d>0?a[p[d-1]]:"column";a[h]=y}}),t=rn(t,Ja({theme:e},o,(h,d)=>n.useFlexGap?{gap:Wl(i,h)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${UP(d?a[d]:n.direction)}`]:Wl(i,h)}}))}return t=oE(e.breakpoints,t),t};function $P(n={}){const{createStyledComponent:e=HP,useThemeProps:t=zP,componentName:i="MuiStack"}=n,s=()=>Ki({root:["root"]},h=>Qi(i,h),{}),a=e(YP);return O.forwardRef(function(h,d){const p=t(h),g=rb(p),{component:y="div",direction:k="column",spacing:_=0,divider:w,children:T,className:x,useFlexGap:E=!1,...N}=g,v={direction:k,spacing:_,useFlexGap:E},L=s();return V.jsx(a,{as:y,ownerState:v,ref:d,className:Lt(L.root,x),...N,children:w?GP(T,w):T})})}const Ih={black:"#000",white:"#fff"},XP={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Cc={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},Ec={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},ih={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},Pc={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},Dc={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},Mc={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"};function YT(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Ih.white,default:Ih.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const $T=YT();function XT(){return{text:{primary:Ih.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Ih.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const k0=XT();function L1(n,e,t,i){const s=i.light||i,a=i.dark||i*1.5;n[e]||(n.hasOwnProperty(t)?n[e]=n[t]:e==="light"?n.light=ag(n.main,s):e==="dark"&&(n.dark=Jo(n.main,a)))}function A1(n,e,t,i,s){const a=s.light||s,o=s.dark||s*1.5;e[t]||(e.hasOwnProperty(i)?e[t]=e[i]:t==="light"?e.light=`color-mix(in ${n}, ${e.main}, #fff ${(a*100).toFixed(0)}%)`:t==="dark"&&(e.dark=`color-mix(in ${n}, ${e.main}, #000 ${(o*100).toFixed(0)}%)`))}function qP(n="light"){return n==="dark"?{main:Pc[200],light:Pc[50],dark:Pc[400]}:{main:Pc[700],light:Pc[400],dark:Pc[800]}}function JP(n="light"){return n==="dark"?{main:Cc[200],light:Cc[50],dark:Cc[400]}:{main:Cc[500],light:Cc[300],dark:Cc[700]}}function QP(n="light"){return n==="dark"?{main:Ec[500],light:Ec[300],dark:Ec[700]}:{main:Ec[700],light:Ec[400],dark:Ec[800]}}function KP(n="light"){return n==="dark"?{main:Dc[400],light:Dc[300],dark:Dc[700]}:{main:Dc[700],light:Dc[500],dark:Dc[900]}}function ZP(n="light"){return n==="dark"?{main:Mc[400],light:Mc[300],dark:Mc[700]}:{main:Mc[800],light:Mc[500],dark:Mc[900]}}function jP(n="light"){return n==="dark"?{main:ih[400],light:ih[300],dark:ih[700]}:{main:"#ed6c02",light:ih[500],dark:ih[900]}}function eD(n){return`oklch(from ${n} var(--__l) 0 h / var(--__a))`}function hb(n){const{mode:e="light",contrastThreshold:t=3,tonalOffset:i=.2,colorSpace:s,...a}=n,o=n.primary||qP(e),c=n.secondary||JP(e),h=n.error||QP(e),d=n.info||KP(e),p=n.success||ZP(e),g=n.warning||jP(e);function y(T){return s?eD(T):fP(T,k0.text.primary)>=t?k0.text.primary:$T.text.primary}const k=({color:T,name:x,mainShade:E=500,lightShade:N=300,darkShade:v=700})=>{if(T={...T},!T.main&&T[E]&&(T.main=T[E]),!T.hasOwnProperty("main"))throw new Error(to(11,x?` (${x})`:"",E));if(typeof T.main!="string")throw new Error(to(12,x?` (${x})`:"",JSON.stringify(T.main)));return s?(A1(s,T,"light",N,i),A1(s,T,"dark",v,i)):(L1(T,"light",N,i),L1(T,"dark",v,i)),T.contrastText||(T.contrastText=y(T.main)),T};let _;return e==="light"?_=YT():e==="dark"&&(_=XT()),rn({common:{...Ih},mode:e,primary:k({color:o,name:"primary"}),secondary:k({color:c,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:k({color:h,name:"error"}),warning:k({color:g,name:"warning"}),info:k({color:d,name:"info"}),success:k({color:p,name:"success"}),grey:XP,contrastThreshold:t,getContrastText:y,augmentColor:k,tonalOffset:i,..._},a)}function tD(n){const e={};return Object.entries(n).forEach(i=>{const[s,a]=i;typeof a=="object"&&(e[s]=`${a.fontStyle?`${a.fontStyle} `:""}${a.fontVariant?`${a.fontVariant} `:""}${a.fontWeight?`${a.fontWeight} `:""}${a.fontStretch?`${a.fontStretch} `:""}${a.fontSize||""}${a.lineHeight?`/${a.lineHeight} `:""}${a.fontFamily||""}`)}),e}function iD(n,e){return{toolbar:{minHeight:56,[n.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[n.up("sm")]:{minHeight:64}},...e}}function sD(n){return Math.round(n*1e5)/1e5}const R1={textTransform:"uppercase"},O1='"Roboto", "Helvetica", "Arial", sans-serif';function qT(n,e){const{fontFamily:t=O1,fontSize:i=14,fontWeightLight:s=300,fontWeightRegular:a=400,fontWeightMedium:o=500,fontWeightBold:c=700,htmlFontSize:h=16,allVariants:d,pxToRem:p,...g}=typeof e=="function"?e(n):e,y=i/14,k=p||(T=>`${T/h*y}rem`),_=(T,x,E,N,v)=>({fontFamily:t,fontWeight:T,fontSize:k(x),lineHeight:E,...t===O1?{letterSpacing:`${sD(N/x)}em`}:{},...v,...d}),w={h1:_(s,96,1.167,-1.5),h2:_(s,60,1.2,-.5),h3:_(a,48,1.167,0),h4:_(a,34,1.235,.25),h5:_(a,24,1.334,0),h6:_(o,20,1.6,.15),subtitle1:_(a,16,1.75,.15),subtitle2:_(o,14,1.57,.1),body1:_(a,16,1.5,.15),body2:_(a,14,1.43,.15),button:_(o,14,1.75,.4,R1),caption:_(a,12,1.66,.4),overline:_(a,12,2.66,1,R1),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return rn({htmlFontSize:h,pxToRem:k,fontFamily:t,fontSize:i,fontWeightLight:s,fontWeightRegular:a,fontWeightMedium:o,fontWeightBold:c,...w},g,{clone:!1})}const nD=.2,aD=.14,rD=.12;function ms(...n){return[`${n[0]}px ${n[1]}px ${n[2]}px ${n[3]}px rgba(0,0,0,${nD})`,`${n[4]}px ${n[5]}px ${n[6]}px ${n[7]}px rgba(0,0,0,${aD})`,`${n[8]}px ${n[9]}px ${n[10]}px ${n[11]}px rgba(0,0,0,${rD})`].join(",")}const oD=["none",ms(0,2,1,-1,0,1,1,0,0,1,3,0),ms(0,3,1,-2,0,2,2,0,0,1,5,0),ms(0,3,3,-2,0,3,4,0,0,1,8,0),ms(0,2,4,-1,0,4,5,0,0,1,10,0),ms(0,3,5,-1,0,5,8,0,0,1,14,0),ms(0,3,5,-1,0,6,10,0,0,1,18,0),ms(0,4,5,-2,0,7,10,1,0,2,16,1),ms(0,5,5,-3,0,8,10,1,0,3,14,2),ms(0,5,6,-3,0,9,12,1,0,3,16,2),ms(0,6,6,-3,0,10,14,1,0,4,18,3),ms(0,6,7,-4,0,11,15,1,0,4,20,3),ms(0,7,8,-4,0,12,17,2,0,5,22,4),ms(0,7,8,-4,0,13,19,2,0,5,24,4),ms(0,7,9,-4,0,14,21,2,0,5,26,4),ms(0,8,9,-5,0,15,22,2,0,6,28,5),ms(0,8,10,-5,0,16,24,2,0,6,30,5),ms(0,8,11,-5,0,17,26,2,0,6,32,5),ms(0,9,11,-5,0,18,28,2,0,7,34,6),ms(0,9,12,-6,0,19,29,2,0,7,36,6),ms(0,10,13,-6,0,20,31,3,0,8,38,7),ms(0,10,13,-6,0,21,33,3,0,8,40,7),ms(0,10,14,-6,0,22,35,3,0,8,42,7),ms(0,11,14,-7,0,23,36,3,0,9,44,8),ms(0,11,15,-7,0,24,38,3,0,9,46,8)],lD={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},cD={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function F1(n){return`${Math.round(n)}ms`}function uD(n){if(!n)return 0;const e=n/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function hD(n){const e={...lD,...n.easing},t={...cD,...n.duration};return{getAutoHeightDuration:uD,create:(s=["all"],a={})=>{const{duration:o=t.standard,easing:c=e.easeInOut,delay:h=0,...d}=a;return(Array.isArray(s)?s:[s]).map(p=>`${p} ${typeof o=="string"?o:F1(o)} ${c} ${typeof h=="string"?h:F1(h)}`).join(",")},...n,easing:e,duration:t}}const dD={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function fD(n){return dr(n)||typeof n>"u"||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||Array.isArray(n)}function JT(n={}){const e={...n};function t(i){const s=Object.entries(i);for(let a=0;a<s.length;a++){const[o,c]=s[a];!fD(c)||o.startsWith("unstable_")?delete i[o]:dr(c)&&(i[o]={...c},t(i[o]))}}return t(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function I1(n){return typeof n=="number"?`${(n*100).toFixed(0)}%`:`calc((${n}) * 100%)`}const pD=n=>{if(!Number.isNaN(+n))return+n;const e=n.match(/\d*\.?\d+/g);if(!e)return 0;let t=0;for(let i=0;i<e.length;i+=1)t+=+e[i];return t};function gD(n){Object.assign(n,{alpha(e,t){const i=this||n;return i.colorSpace?`oklch(from ${e} l c h / ${typeof t=="string"?`calc(${t})`:t})`:i.vars?`rgba(${e.replace(/var\(--([^,\s)]+)(?:,[^)]+)?\)+/g,"var(--$1Channel)")} / ${typeof t=="string"?`calc(${t})`:t})`:Qf(e,pD(t))},lighten(e,t){const i=this||n;return i.colorSpace?`color-mix(in ${i.colorSpace}, ${e}, #fff ${I1(t)})`:ag(e,t)},darken(e,t){const i=this||n;return i.colorSpace?`color-mix(in ${i.colorSpace}, ${e}, #000 ${I1(t)})`:Jo(e,t)}})}function w0(n={},...e){const{breakpoints:t,mixins:i={},spacing:s,palette:a={},transitions:o={},typography:c={},shape:h,colorSpace:d,...p}=n;if(n.vars&&n.generateThemeVars===void 0)throw new Error(to(20));const g=hb({...a,colorSpace:d}),y=ig(n);let k=rn(y,{mixins:iD(y.breakpoints,i),palette:g,shadows:oD.slice(),typography:qT(g,c),transitions:hD(o),zIndex:{...dD}});return k=rn(k,p),k=e.reduce((_,w)=>rn(_,w),k),k.unstable_sxConfig={...Zh,...p?.unstable_sxConfig},k.unstable_sx=function(w){return Xo({sx:w,theme:this})},k.toRuntimeSource=JT,gD(k),k}function B0(n){let e;return n<1?e=5.11916*n**2:e=4.5*Math.log(n+1)+2,Math.round(e*10)/1e3}const mD=[...Array(25)].map((n,e)=>{if(e===0)return"none";const t=B0(e);return`linear-gradient(rgba(255 255 255 / ${t}), rgba(255 255 255 / ${t}))`});function QT(n){return{inputPlaceholder:n==="dark"?.5:.42,inputUnderline:n==="dark"?.7:.42,switchTrackDisabled:n==="dark"?.2:.12,switchTrack:n==="dark"?.3:.38}}function KT(n){return n==="dark"?mD:[]}function yD(n){const{palette:e={mode:"light"},opacity:t,overlays:i,colorSpace:s,...a}=n,o=hb({...e,colorSpace:s});return{palette:o,opacity:{...QT(o.mode),...t},overlays:i||KT(o.mode),...a}}function bD(n){return!!n[0].match(/(cssVarPrefix|colorSchemeSelector|modularCssLayers|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!n[0].match(/sxConfig$/)||n[0]==="palette"&&!!n[1]?.match(/(mode|contrastThreshold|tonalOffset)/)}const SD=n=>[...[...Array(25)].map((e,t)=>`--${n?`${n}-`:""}overlays-${t}`),`--${n?`${n}-`:""}palette-AppBar-darkBg`,`--${n?`${n}-`:""}palette-AppBar-darkColor`],_D=n=>(e,t)=>{const i=n.rootSelector||":root",s=n.colorSchemeSelector;let a=s;if(s==="class"&&(a=".%s"),s==="data"&&(a="[data-%s]"),s?.startsWith("data-")&&!s.includes("%s")&&(a=`[${s}="%s"]`),n.defaultColorScheme===e){if(e==="dark"){const o={};return SD(n.cssVarPrefix).forEach(c=>{o[c]=t[c],delete t[c]}),a==="media"?{[i]:t,"@media (prefers-color-scheme: dark)":{[i]:o}}:a?{[a.replace("%s",e)]:o,[`${i}, ${a.replace("%s",e)}`]:t}:{[i]:{...t,...o}}}if(a&&a!=="media")return`${i}, ${a.replace("%s",String(e))}`}else if(e){if(a==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{[i]:t}};if(a)return a.replace("%s",String(e))}return i};function kD(n,e){e.forEach(t=>{n[t]||(n[t]={})})}function me(n,e,t){!n[e]&&t&&(n[e]=t)}function hh(n){return typeof n!="string"||!n.startsWith("hsl")?n:IT(n)}function Hr(n,e){`${e}Channel`in n||(n[`${e}Channel`]=uh(hh(n[e])))}function wD(n){return typeof n=="number"?`${n}px`:typeof n=="string"||typeof n=="function"||Array.isArray(n)?n:"8px"}const ar=n=>{try{return n()}catch{}},BD=(n="mui")=>RP(n);function t0(n,e,t,i,s){if(!t)return;t=t===!0?{}:t;const a=s==="dark"?"dark":"light";if(!i){e[s]=yD({...t,palette:{mode:a,...t?.palette},colorSpace:n});return}const{palette:o,...c}=w0({...i,palette:{mode:a,...t?.palette},colorSpace:n});return e[s]={...t,palette:o,opacity:{...QT(a),...t?.opacity},overlays:t?.overlays||KT(a)},c}function TD(n={},...e){const{colorSchemes:t={light:!0},defaultColorScheme:i,disableCssColorScheme:s=!1,cssVarPrefix:a="mui",nativeColor:o=!1,shouldSkipGeneratingVar:c=bD,colorSchemeSelector:h=t.light&&t.dark?"media":void 0,rootSelector:d=":root",...p}=n,g=Object.keys(t)[0],y=i||(t.light&&g!=="light"?"light":g),k=BD(a),{[y]:_,light:w,dark:T,...x}=t,E={...x};let N=_;if((y==="dark"&&!("dark"in t)||y==="light"&&!("light"in t))&&(N=!0),!N)throw new Error(to(21,y));let v;o&&(v="oklch");const L=t0(v,E,N,p,y);w&&!E.light&&t0(v,E,w,void 0,"light"),T&&!E.dark&&t0(v,E,T,void 0,"dark");let A={defaultColorScheme:y,...L,cssVarPrefix:a,colorSchemeSelector:h,rootSelector:d,getCssVar:k,colorSchemes:E,font:{...tD(L.typography),...L.font},spacing:wD(p.spacing)};Object.keys(A.colorSchemes).forEach(Y=>{const C=A.colorSchemes[Y].palette,Q=le=>{const F=le.split("-"),re=F[1],_e=F[2];return k(le,C[re][_e])};C.mode==="light"&&(me(C.common,"background","#fff"),me(C.common,"onBackground","#000")),C.mode==="dark"&&(me(C.common,"background","#000"),me(C.common,"onBackground","#fff"));function Z(le,F,re){if(v){let _e;return le===_l&&(_e=`transparent ${((1-re)*100).toFixed(0)}%`),le===Oi&&(_e=`#000 ${(re*100).toFixed(0)}%`),le===Fi&&(_e=`#fff ${(re*100).toFixed(0)}%`),`color-mix(in ${v}, ${F}, ${_e})`}return le(F,re)}if(kD(C,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),C.mode==="light"){me(C.Alert,"errorColor",Z(Oi,C.error.light,.6)),me(C.Alert,"infoColor",Z(Oi,C.info.light,.6)),me(C.Alert,"successColor",Z(Oi,C.success.light,.6)),me(C.Alert,"warningColor",Z(Oi,C.warning.light,.6)),me(C.Alert,"errorFilledBg",Q("palette-error-main")),me(C.Alert,"infoFilledBg",Q("palette-info-main")),me(C.Alert,"successFilledBg",Q("palette-success-main")),me(C.Alert,"warningFilledBg",Q("palette-warning-main")),me(C.Alert,"errorFilledColor",ar(()=>C.getContrastText(C.error.main))),me(C.Alert,"infoFilledColor",ar(()=>C.getContrastText(C.info.main))),me(C.Alert,"successFilledColor",ar(()=>C.getContrastText(C.success.main))),me(C.Alert,"warningFilledColor",ar(()=>C.getContrastText(C.warning.main))),me(C.Alert,"errorStandardBg",Z(Fi,C.error.light,.9)),me(C.Alert,"infoStandardBg",Z(Fi,C.info.light,.9)),me(C.Alert,"successStandardBg",Z(Fi,C.success.light,.9)),me(C.Alert,"warningStandardBg",Z(Fi,C.warning.light,.9)),me(C.Alert,"errorIconColor",Q("palette-error-main")),me(C.Alert,"infoIconColor",Q("palette-info-main")),me(C.Alert,"successIconColor",Q("palette-success-main")),me(C.Alert,"warningIconColor",Q("palette-warning-main")),me(C.AppBar,"defaultBg",Q("palette-grey-100")),me(C.Avatar,"defaultBg",Q("palette-grey-400")),me(C.Button,"inheritContainedBg",Q("palette-grey-300")),me(C.Button,"inheritContainedHoverBg",Q("palette-grey-A100")),me(C.Chip,"defaultBorder",Q("palette-grey-400")),me(C.Chip,"defaultAvatarColor",Q("palette-grey-700")),me(C.Chip,"defaultIconColor",Q("palette-grey-700")),me(C.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),me(C.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),me(C.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),me(C.LinearProgress,"primaryBg",Z(Fi,C.primary.main,.62)),me(C.LinearProgress,"secondaryBg",Z(Fi,C.secondary.main,.62)),me(C.LinearProgress,"errorBg",Z(Fi,C.error.main,.62)),me(C.LinearProgress,"infoBg",Z(Fi,C.info.main,.62)),me(C.LinearProgress,"successBg",Z(Fi,C.success.main,.62)),me(C.LinearProgress,"warningBg",Z(Fi,C.warning.main,.62)),me(C.Skeleton,"bg",v?Z(_l,C.text.primary,.11):`rgba(${Q("palette-text-primaryChannel")} / 0.11)`),me(C.Slider,"primaryTrack",Z(Fi,C.primary.main,.62)),me(C.Slider,"secondaryTrack",Z(Fi,C.secondary.main,.62)),me(C.Slider,"errorTrack",Z(Fi,C.error.main,.62)),me(C.Slider,"infoTrack",Z(Fi,C.info.main,.62)),me(C.Slider,"successTrack",Z(Fi,C.success.main,.62)),me(C.Slider,"warningTrack",Z(Fi,C.warning.main,.62));const le=v?Z(Oi,C.background.default,.6825):kf(C.background.default,.8);me(C.SnackbarContent,"bg",le),me(C.SnackbarContent,"color",ar(()=>v?k0.text.primary:C.getContrastText(le))),me(C.SpeedDialAction,"fabHoverBg",kf(C.background.paper,.15)),me(C.StepConnector,"border",Q("palette-grey-400")),me(C.StepContent,"border",Q("palette-grey-400")),me(C.Switch,"defaultColor",Q("palette-common-white")),me(C.Switch,"defaultDisabledColor",Q("palette-grey-100")),me(C.Switch,"primaryDisabledColor",Z(Fi,C.primary.main,.62)),me(C.Switch,"secondaryDisabledColor",Z(Fi,C.secondary.main,.62)),me(C.Switch,"errorDisabledColor",Z(Fi,C.error.main,.62)),me(C.Switch,"infoDisabledColor",Z(Fi,C.info.main,.62)),me(C.Switch,"successDisabledColor",Z(Fi,C.success.main,.62)),me(C.Switch,"warningDisabledColor",Z(Fi,C.warning.main,.62)),me(C.TableCell,"border",Z(Fi,Z(_l,C.divider,1),.88)),me(C.Tooltip,"bg",Z(_l,C.grey[700],.92))}if(C.mode==="dark"){me(C.Alert,"errorColor",Z(Fi,C.error.light,.6)),me(C.Alert,"infoColor",Z(Fi,C.info.light,.6)),me(C.Alert,"successColor",Z(Fi,C.success.light,.6)),me(C.Alert,"warningColor",Z(Fi,C.warning.light,.6)),me(C.Alert,"errorFilledBg",Q("palette-error-dark")),me(C.Alert,"infoFilledBg",Q("palette-info-dark")),me(C.Alert,"successFilledBg",Q("palette-success-dark")),me(C.Alert,"warningFilledBg",Q("palette-warning-dark")),me(C.Alert,"errorFilledColor",ar(()=>C.getContrastText(C.error.dark))),me(C.Alert,"infoFilledColor",ar(()=>C.getContrastText(C.info.dark))),me(C.Alert,"successFilledColor",ar(()=>C.getContrastText(C.success.dark))),me(C.Alert,"warningFilledColor",ar(()=>C.getContrastText(C.warning.dark))),me(C.Alert,"errorStandardBg",Z(Oi,C.error.light,.9)),me(C.Alert,"infoStandardBg",Z(Oi,C.info.light,.9)),me(C.Alert,"successStandardBg",Z(Oi,C.success.light,.9)),me(C.Alert,"warningStandardBg",Z(Oi,C.warning.light,.9)),me(C.Alert,"errorIconColor",Q("palette-error-main")),me(C.Alert,"infoIconColor",Q("palette-info-main")),me(C.Alert,"successIconColor",Q("palette-success-main")),me(C.Alert,"warningIconColor",Q("palette-warning-main")),me(C.AppBar,"defaultBg",Q("palette-grey-900")),me(C.AppBar,"darkBg",Q("palette-background-paper")),me(C.AppBar,"darkColor",Q("palette-text-primary")),me(C.Avatar,"defaultBg",Q("palette-grey-600")),me(C.Button,"inheritContainedBg",Q("palette-grey-800")),me(C.Button,"inheritContainedHoverBg",Q("palette-grey-700")),me(C.Chip,"defaultBorder",Q("palette-grey-700")),me(C.Chip,"defaultAvatarColor",Q("palette-grey-300")),me(C.Chip,"defaultIconColor",Q("palette-grey-300")),me(C.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),me(C.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),me(C.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),me(C.LinearProgress,"primaryBg",Z(Oi,C.primary.main,.5)),me(C.LinearProgress,"secondaryBg",Z(Oi,C.secondary.main,.5)),me(C.LinearProgress,"errorBg",Z(Oi,C.error.main,.5)),me(C.LinearProgress,"infoBg",Z(Oi,C.info.main,.5)),me(C.LinearProgress,"successBg",Z(Oi,C.success.main,.5)),me(C.LinearProgress,"warningBg",Z(Oi,C.warning.main,.5)),me(C.Skeleton,"bg",v?Z(_l,C.text.primary,.13):`rgba(${Q("palette-text-primaryChannel")} / 0.13)`),me(C.Slider,"primaryTrack",Z(Oi,C.primary.main,.5)),me(C.Slider,"secondaryTrack",Z(Oi,C.secondary.main,.5)),me(C.Slider,"errorTrack",Z(Oi,C.error.main,.5)),me(C.Slider,"infoTrack",Z(Oi,C.info.main,.5)),me(C.Slider,"successTrack",Z(Oi,C.success.main,.5)),me(C.Slider,"warningTrack",Z(Oi,C.warning.main,.5));const le=v?Z(Fi,C.background.default,.985):kf(C.background.default,.98);me(C.SnackbarContent,"bg",le),me(C.SnackbarContent,"color",ar(()=>v?$T.text.primary:C.getContrastText(le))),me(C.SpeedDialAction,"fabHoverBg",kf(C.background.paper,.15)),me(C.StepConnector,"border",Q("palette-grey-600")),me(C.StepContent,"border",Q("palette-grey-600")),me(C.Switch,"defaultColor",Q("palette-grey-300")),me(C.Switch,"defaultDisabledColor",Q("palette-grey-600")),me(C.Switch,"primaryDisabledColor",Z(Oi,C.primary.main,.55)),me(C.Switch,"secondaryDisabledColor",Z(Oi,C.secondary.main,.55)),me(C.Switch,"errorDisabledColor",Z(Oi,C.error.main,.55)),me(C.Switch,"infoDisabledColor",Z(Oi,C.info.main,.55)),me(C.Switch,"successDisabledColor",Z(Oi,C.success.main,.55)),me(C.Switch,"warningDisabledColor",Z(Oi,C.warning.main,.55)),me(C.TableCell,"border",Z(Oi,Z(_l,C.divider,1),.68)),me(C.Tooltip,"bg",Z(_l,C.grey[700],.92))}Hr(C.background,"default"),Hr(C.background,"paper"),Hr(C.common,"background"),Hr(C.common,"onBackground"),Hr(C,"divider"),Object.keys(C).forEach(le=>{const F=C[le];le!=="tonalOffset"&&F&&typeof F=="object"&&(F.main&&me(C[le],"mainChannel",uh(hh(F.main))),F.light&&me(C[le],"lightChannel",uh(hh(F.light))),F.dark&&me(C[le],"darkChannel",uh(hh(F.dark))),F.contrastText&&me(C[le],"contrastTextChannel",uh(hh(F.contrastText))),le==="text"&&(Hr(C[le],"primary"),Hr(C[le],"secondary")),le==="action"&&(F.active&&Hr(C[le],"active"),F.selected&&Hr(C[le],"selected")))})}),A=e.reduce((Y,C)=>rn(Y,C),A);const D={prefix:a,disableCssColorScheme:s,shouldSkipGeneratingVar:c,getSelector:_D(A),enableContrastVars:o},{vars:H,generateThemeVars:J,generateStyleSheets:K}=IP(A,D);return A.vars=H,Object.entries(A.colorSchemes[A.defaultColorScheme]).forEach(([Y,C])=>{A[Y]=C}),A.generateThemeVars=J,A.generateStyleSheets=K,A.generateSpacing=function(){return DT(p.spacing,Qp(this))},A.getColorSchemeSelector=WP(h),A.spacing=A.generateSpacing(),A.shouldSkipGeneratingVar=c,A.unstable_sxConfig={...Zh,...p?.unstable_sxConfig},A.unstable_sx=function(C){return Xo({sx:C,theme:this})},A.toRuntimeSource=JT,A}function W1(n,e,t){n.colorSchemes&&t&&(n.colorSchemes[e]={...t!==!0&&t,palette:hb({...t===!0?{}:t.palette,mode:e})})}function og(n={},...e){const{palette:t,cssVariables:i=!1,colorSchemes:s=t?void 0:{light:!0},defaultColorScheme:a=t?.mode,...o}=n,c=a||"light",h=s?.[c],d={...s,...t?{[c]:{...typeof h!="boolean"&&h,palette:t}}:void 0};if(i===!1){if(!("colorSchemes"in n))return w0(n,...e);let p=t;"palette"in n||d[c]&&(d[c]!==!0?p=d[c].palette:c==="dark"&&(p={mode:"dark"}));const g=w0({...n,palette:p},...e);return g.defaultColorScheme=c,g.colorSchemes=d,g.palette.mode==="light"&&(g.colorSchemes.light={...d.light!==!0&&d.light,palette:g.palette},W1(g,"dark",d.dark)),g.palette.mode==="dark"&&(g.colorSchemes.dark={...d.dark!==!0&&d.dark,palette:g.palette},W1(g,"light",d.light)),g}return!t&&!("light"in d)&&c==="light"&&(d.light=!0),TD({...o,colorSchemes:d,defaultColorScheme:c,...typeof i!="boolean"&&i},...e)}const db=og();function fb(){const n=sg(db);return n[yr]||n}function lg(n){return n!=="ownerState"&&n!=="theme"&&n!=="sx"&&n!=="as"}const Aa=n=>lg(n)&&n!=="classes",Ke=FT({themeId:yr,defaultTheme:db,rootShouldForwardProp:Aa});function xD({theme:n,...e}){const t=yr in n?n[yr]:void 0;return V.jsx(GT,{...e,themeId:t?yr:void 0,theme:t||n})}const wf={colorSchemeStorageKey:"mui-color-scheme",defaultLightColorScheme:"light",defaultDarkColorScheme:"dark",modeStorageKey:"mui-mode"},{CssVarsProvider:vD}=AP({themeId:yr,theme:()=>og({cssVariables:!0}),colorSchemeStorageKey:wf.colorSchemeStorageKey,modeStorageKey:wf.modeStorageKey,defaultColorScheme:{light:wf.defaultLightColorScheme,dark:wf.defaultDarkColorScheme},resolveTheme:n=>{const e={...n,typography:qT(n.palette,n.typography)};return e.unstable_sx=function(i){return Xo({sx:i,theme:this})},e}}),ND=vD;function CD({theme:n,...e}){const t=O.useMemo(()=>{if(typeof n=="function")return n;const i=yr in n?n[yr]:n;return"colorSchemes"in i?null:"vars"in i?n:{...n,vars:null}},[n]);return t?V.jsx(xD,{theme:t,...e}):V.jsx(ND,{theme:n,...e})}function V1(...n){return n.reduce((e,t)=>t==null?e:function(...s){e.apply(this,s),t.apply(this,s)},()=>{})}function ED(n){return V.jsx(MT,{...n,defaultTheme:db,themeId:yr})}function pb(n){return function(t){return V.jsx(ED,{styles:typeof n=="function"?i=>n({theme:i,...t}):n})}}function PD(){return rb}const wi=vP;function Zi(n){return wP(n)}function DD(n){return Qi("MuiSvgIcon",n)}Wi("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const MD=n=>{const{color:e,fontSize:t,classes:i}=n,s={root:["root",e!=="inherit"&&`color${bt(e)}`,`fontSize${bt(t)}`]};return Ki(s,DD,i)},LD=Ke("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.color!=="inherit"&&e[`color${bt(t.color)}`],e[`fontSize${bt(t.fontSize)}`]]}})(wi(({theme:n})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:n.transitions?.create?.("fill",{duration:(n.vars??n).transitions?.duration?.shorter}),variants:[{props:e=>!e.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:n.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:n.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:n.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((n.vars??n).palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(n.vars??n).palette?.[e]?.main}})),{props:{color:"action"},style:{color:(n.vars??n).palette?.action?.active}},{props:{color:"disabled"},style:{color:(n.vars??n).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),T0=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiSvgIcon"}),{children:s,className:a,color:o="inherit",component:c="svg",fontSize:h="medium",htmlColor:d,inheritViewBox:p=!1,titleAccess:g,viewBox:y="0 0 24 24",...k}=i,_=O.isValidElement(s)&&s.type==="svg",w={...i,color:o,component:c,fontSize:h,instanceFontSize:e.fontSize,inheritViewBox:p,viewBox:y,hasSvgAsChild:_},T={};p||(T.viewBox=y);const x=MD(w);return V.jsxs(LD,{as:c,className:Lt(x.root,a),focusable:"false",color:d,"aria-hidden":g?void 0:!0,role:g?"img":void 0,ref:t,...T,...k,..._&&s.props,ownerState:w,children:[_?s.props.children:s,g?V.jsx("title",{children:g}):null]})});T0.muiName="SvgIcon";function fa(n,e){function t(i,s){return V.jsx(T0,{"data-testid":void 0,ref:s,...i,children:n})}return t.muiName=T0.muiName,O.memo(O.forwardRef(t))}function ZT(n,e=166){let t;function i(...s){const a=()=>{n.apply(this,s)};clearTimeout(t),t=setTimeout(a,e)}return i.clear=()=>{clearTimeout(t)},i}function Ln(n){return n&&n.ownerDocument||document}function io(n){return Ln(n).defaultView||window}function H1(n,e){typeof n=="function"?n(e):n&&(n.current=e)}function x0(n){const{controlled:e,default:t,name:i,state:s="value"}=n,{current:a}=O.useRef(e!==void 0),[o,c]=O.useState(t),h=a?e:o,d=O.useCallback(p=>{a||c(p)},[]);return[h,d]}function Sr(n){const e=O.useRef(n);return Ma(()=>{e.current=n}),O.useRef((...t)=>(0,e.current)(...t)).current}function yn(...n){const e=O.useRef(void 0),t=O.useCallback(i=>{const s=n.map(a=>{if(a==null)return null;if(typeof a=="function"){const o=a,c=o(i);return typeof c=="function"?c:()=>{o(null)}}return a.current=i,()=>{a.current=null}});return()=>{s.forEach(a=>a?.())}},n);return O.useMemo(()=>n.every(i=>i==null)?null:i=>{e.current&&(e.current(),e.current=void 0),i!=null&&(e.current=t(i))},n)}function AD(n,e){const t=n.charCodeAt(2);return n[0]==="o"&&n[1]==="n"&&t>=65&&t<=90&&typeof e=="function"}function RD(n,e){if(!n)return e;function t(o,c){const h={};return Object.keys(c).forEach(d=>{AD(d,c[d])&&typeof o[d]=="function"&&(h[d]=(...p)=>{o[d](...p),c[d](...p)})}),h}if(typeof n=="function"||typeof e=="function")return o=>{const c=typeof e=="function"?e(o):e,h=typeof n=="function"?n({...o,...c}):n,d=Lt(o?.className,c?.className,h?.className),p=t(h,c);return{...c,...h,...p,...!!d&&{className:d},...c?.style&&h?.style&&{style:{...c.style,...h.style}},...c?.sx&&h?.sx&&{sx:[...Array.isArray(c.sx)?c.sx:[c.sx],...Array.isArray(h.sx)?h.sx:[h.sx]]}}};const i=e,s=t(n,i),a=Lt(i?.className,n?.className);return{...e,...n,...s,...!!a&&{className:a},...i?.style&&n?.style&&{style:{...i.style,...n.style}},...i?.sx&&n?.sx&&{sx:[...Array.isArray(i.sx)?i.sx:[i.sx],...Array.isArray(n.sx)?n.sx:[n.sx]]}}}function jT(n,e){if(n==null)return{};var t={};for(var i in n)if({}.hasOwnProperty.call(n,i)){if(e.indexOf(i)!==-1)continue;t[i]=n[i]}return t}function v0(n,e){return v0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},v0(n,e)}function ex(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,v0(n,e)}var tx=hT();const Bf=$0(tx),z1={disabled:!1},Kf=gr.createContext(null);var OD=function(e){return e.scrollTop},dh="unmounted",Tl="exited",xl="entering",Fc="entered",N0="exiting",kr=(function(n){ex(e,n);function e(i,s){var a;a=n.call(this,i,s)||this;var o=s,c=o&&!o.isMounting?i.enter:i.appear,h;return a.appearStatus=null,i.in?c?(h=Tl,a.appearStatus=xl):h=Fc:i.unmountOnExit||i.mountOnEnter?h=dh:h=Tl,a.state={status:h},a.nextCallback=null,a}e.getDerivedStateFromProps=function(s,a){var o=s.in;return o&&a.status===dh?{status:Tl}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(s){var a=null;if(s!==this.props){var o=this.state.status;this.props.in?o!==xl&&o!==Fc&&(a=xl):(o===xl||o===Fc)&&(a=N0)}this.updateStatus(!1,a)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var s=this.props.timeout,a,o,c;return a=o=c=s,s!=null&&typeof s!="number"&&(a=s.exit,o=s.enter,c=s.appear!==void 0?s.appear:o),{exit:a,enter:o,appear:c}},t.updateStatus=function(s,a){if(s===void 0&&(s=!1),a!==null)if(this.cancelNextCallback(),a===xl){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:Bf.findDOMNode(this);o&&OD(o)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Tl&&this.setState({status:dh})},t.performEnter=function(s){var a=this,o=this.props.enter,c=this.context?this.context.isMounting:s,h=this.props.nodeRef?[c]:[Bf.findDOMNode(this),c],d=h[0],p=h[1],g=this.getTimeouts(),y=c?g.appear:g.enter;if(!s&&!o||z1.disabled){this.safeSetState({status:Fc},function(){a.props.onEntered(d)});return}this.props.onEnter(d,p),this.safeSetState({status:xl},function(){a.props.onEntering(d,p),a.onTransitionEnd(y,function(){a.safeSetState({status:Fc},function(){a.props.onEntered(d,p)})})})},t.performExit=function(){var s=this,a=this.props.exit,o=this.getTimeouts(),c=this.props.nodeRef?void 0:Bf.findDOMNode(this);if(!a||z1.disabled){this.safeSetState({status:Tl},function(){s.props.onExited(c)});return}this.props.onExit(c),this.safeSetState({status:N0},function(){s.props.onExiting(c),s.onTransitionEnd(o.exit,function(){s.safeSetState({status:Tl},function(){s.props.onExited(c)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(s,a){a=this.setNextCallback(a),this.setState(s,a)},t.setNextCallback=function(s){var a=this,o=!0;return this.nextCallback=function(c){o&&(o=!1,a.nextCallback=null,s(c))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},t.onTransitionEnd=function(s,a){this.setNextCallback(a);var o=this.props.nodeRef?this.props.nodeRef.current:Bf.findDOMNode(this),c=s==null&&!this.props.addEndListener;if(!o||c){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var h=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],d=h[0],p=h[1];this.props.addEndListener(d,p)}s!=null&&setTimeout(this.nextCallback,s)},t.render=function(){var s=this.state.status;if(s===dh)return null;var a=this.props,o=a.children;a.in,a.mountOnEnter,a.unmountOnExit,a.appear,a.enter,a.exit,a.timeout,a.addEndListener,a.onEnter,a.onEntering,a.onEntered,a.onExit,a.onExiting,a.onExited,a.nodeRef;var c=jT(a,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return gr.createElement(Kf.Provider,{value:null},typeof o=="function"?o(s,c):gr.cloneElement(gr.Children.only(o),c))},e})(gr.Component);kr.contextType=Kf;kr.propTypes={};function Lc(){}kr.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Lc,onEntering:Lc,onEntered:Lc,onExit:Lc,onExiting:Lc,onExited:Lc};kr.UNMOUNTED=dh;kr.EXITED=Tl;kr.ENTERING=xl;kr.ENTERED=Fc;kr.EXITING=N0;function FD(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function gb(n,e){var t=function(a){return e&&O.isValidElement(a)?e(a):a},i=Object.create(null);return n&&O.Children.map(n,function(s){return s}).forEach(function(s){i[s.key]=t(s)}),i}function ID(n,e){n=n||{},e=e||{};function t(p){return p in e?e[p]:n[p]}var i=Object.create(null),s=[];for(var a in n)a in e?s.length&&(i[a]=s,s=[]):s.push(a);var o,c={};for(var h in e){if(i[h])for(o=0;o<i[h].length;o++){var d=i[h][o];c[i[h][o]]=t(d)}c[h]=t(h)}for(o=0;o<s.length;o++)c[s[o]]=t(s[o]);return c}function Ml(n,e,t){return t[e]!=null?t[e]:n.props[e]}function WD(n,e){return gb(n.children,function(t){return O.cloneElement(t,{onExited:e.bind(null,t),in:!0,appear:Ml(t,"appear",n),enter:Ml(t,"enter",n),exit:Ml(t,"exit",n)})})}function VD(n,e,t){var i=gb(n.children),s=ID(e,i);return Object.keys(s).forEach(function(a){var o=s[a];if(O.isValidElement(o)){var c=a in e,h=a in i,d=e[a],p=O.isValidElement(d)&&!d.props.in;h&&(!c||p)?s[a]=O.cloneElement(o,{onExited:t.bind(null,o),in:!0,exit:Ml(o,"exit",n),enter:Ml(o,"enter",n)}):!h&&c&&!p?s[a]=O.cloneElement(o,{in:!1}):h&&c&&O.isValidElement(d)&&(s[a]=O.cloneElement(o,{onExited:t.bind(null,o),in:d.props.in,exit:Ml(o,"exit",n),enter:Ml(o,"enter",n)}))}}),s}var HD=Object.values||function(n){return Object.keys(n).map(function(e){return n[e]})},zD={component:"div",childFactory:function(e){return e}},mb=(function(n){ex(e,n);function e(i,s){var a;a=n.call(this,i,s)||this;var o=a.handleExited.bind(FD(a));return a.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},a}var t=e.prototype;return t.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},t.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(s,a){var o=a.children,c=a.handleExited,h=a.firstRender;return{children:h?WD(s,c):VD(s,o,c),firstRender:!1}},t.handleExited=function(s,a){var o=gb(this.props.children);s.key in o||(s.props.onExited&&s.props.onExited(a),this.mounted&&this.setState(function(c){var h=Xf({},c.children);return delete h[s.key],{children:h}}))},t.render=function(){var s=this.props,a=s.component,o=s.childFactory,c=jT(s,["component","childFactory"]),h=this.state.contextValue,d=HD(this.state.children).map(o);return delete c.appear,delete c.enter,delete c.exit,a===null?gr.createElement(Kf.Provider,{value:h},d):gr.createElement(Kf.Provider,{value:h},gr.createElement(a,c,d))},e})(gr.Component);mb.propTypes={};mb.defaultProps=zD;const G1={};function ix(n,e){const t=O.useRef(G1);return t.current===G1&&(t.current=n(e)),t}const GD=[];function UD(n){O.useEffect(n,GD)}class yb{static create(){return new yb}currentId=null;start(e,t){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,t()},e)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function sx(){const n=ix(yb.create).current;return UD(n.disposeEffect),n}const nx=n=>n.scrollTop;function Zf(n,e){const{timeout:t,easing:i,style:s={}}=n;return{duration:s.transitionDuration??(typeof t=="number"?t:t[e.mode]||0),easing:s.transitionTimingFunction??(typeof i=="object"?i[e.mode]:i),delay:s.transitionDelay}}function Uo(n){return typeof n=="string"}function ax(n,e,t){return n===void 0||Uo(n)?e:{...e,ownerState:{...e.ownerState,...t}}}function rx(n,e,t){return typeof n=="function"?n(e,t):n}function Sh(n,e=[]){if(n===void 0)return{};const t={};return Object.keys(n).filter(i=>i.match(/^on[A-Z]/)&&typeof n[i]=="function"&&!e.includes(i)).forEach(i=>{t[i]=n[i]}),t}function U1(n){if(n===void 0)return{};const e={};return Object.keys(n).filter(t=>!(t.match(/^on[A-Z]/)&&typeof n[t]=="function")).forEach(t=>{e[t]=n[t]}),e}function ox(n){const{getSlotProps:e,additionalProps:t,externalSlotProps:i,externalForwardedProps:s,className:a}=n;if(!e){const k=Lt(t?.className,a,s?.className,i?.className),_={...t?.style,...s?.style,...i?.style},w={...t,...s,...i};return k.length>0&&(w.className=k),Object.keys(_).length>0&&(w.style=_),{props:w,internalRef:void 0}}const o=Sh({...s,...i}),c=U1(i),h=U1(s),d=e(o),p=Lt(d?.className,t?.className,a,s?.className,i?.className),g={...d?.style,...t?.style,...s?.style,...i?.style},y={...d,...t,...h,...c};return p.length>0&&(y.className=p),Object.keys(g).length>0&&(y.style=g),{props:y,internalRef:d.ref}}function ua(n,e){const{className:t,elementType:i,ownerState:s,externalForwardedProps:a,internalForwardedProps:o,shouldForwardComponentProp:c=!1,...h}=e,{component:d,slots:p={[n]:void 0},slotProps:g={[n]:void 0},...y}=a,k=p[n]||i,_=rx(g[n],s),{props:{component:w,...T},internalRef:x}=ox({className:t,...h,externalForwardedProps:n==="root"?y:void 0,externalSlotProps:_}),E=yn(x,_?.ref,e.ref),N=n==="root"?w||d:w,v=ax(k,{...n==="root"&&!d&&!p[n]&&o,...n!=="root"&&!p[n]&&o,...T,...N&&!c&&{as:N},...N&&c&&{component:N},ref:E},s);return[k,v]}function YD(n){return Qi("MuiPaper",n)}Wi("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const $D=n=>{const{square:e,elevation:t,variant:i,classes:s}=n,a={root:["root",i,!e&&"rounded",i==="elevation"&&`elevation${t}`]};return Ki(a,YD,s)},XD=Ke("div",{name:"MuiPaper",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[t.variant],!t.square&&e.rounded,t.variant==="elevation"&&e[`elevation${t.elevation}`]]}})(wi(({theme:n})=>({backgroundColor:(n.vars||n).palette.background.paper,color:(n.vars||n).palette.text.primary,transition:n.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:n.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(n.vars||n).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),cg=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiPaper"}),s=fb(),{className:a,component:o="div",elevation:c=1,square:h=!1,variant:d="elevation",...p}=i,g={...i,component:o,elevation:c,square:h,variant:d},y=$D(g);return V.jsx(XD,{as:o,ownerState:g,className:Lt(y.root,a),ref:t,...p,style:{...d==="elevation"&&{"--Paper-shadow":(s.vars||s).shadows[c],...s.vars&&{"--Paper-overlay":s.vars.overlays?.[c]},...!s.vars&&s.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${Qf("#fff",B0(c))}, ${Qf("#fff",B0(c))})`}},...p.style}})});function jf(n){try{return n.matches(":focus-visible")}catch{}return!1}class ep{static create(){return new ep}static use(){const e=ix(ep.create).current,[t,i]=O.useState(!1);return e.shouldMount=t,e.setShouldMount=i,O.useEffect(e.mountEffect,[t]),e}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=JD(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...e){this.mount().then(()=>this.ref.current?.start(...e))}stop(...e){this.mount().then(()=>this.ref.current?.stop(...e))}pulsate(...e){this.mount().then(()=>this.ref.current?.pulsate(...e))}}function qD(){return ep.use()}function JD(){let n,e;const t=new Promise((i,s)=>{n=i,e=s});return t.resolve=n,t.reject=e,t}function QD(n){const{className:e,classes:t,pulsate:i=!1,rippleX:s,rippleY:a,rippleSize:o,in:c,onExited:h,timeout:d}=n,[p,g]=O.useState(!1),y=Lt(e,t.ripple,t.rippleVisible,i&&t.ripplePulsate),k={width:o,height:o,top:-(o/2)+a,left:-(o/2)+s},_=Lt(t.child,p&&t.childLeaving,i&&t.childPulsate);return!c&&!p&&g(!0),O.useEffect(()=>{if(!c&&h!=null){const w=setTimeout(h,d);return()=>{clearTimeout(w)}}},[h,c,d]),V.jsx("span",{className:y,style:k,children:V.jsx("span",{className:_})})}const va=Wi("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),C0=550,KD=80,ZD=Qh`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,jD=Qh`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,eM=Qh`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,tM=Ke("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),iM=Ke(QD,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${va.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${ZD};
    animation-duration: ${C0}ms;
    animation-timing-function: ${({theme:n})=>n.transitions.easing.easeInOut};
  }

  &.${va.ripplePulsate} {
    animation-duration: ${({theme:n})=>n.transitions.duration.shorter}ms;
  }

  & .${va.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${va.childLeaving} {
    opacity: 0;
    animation-name: ${jD};
    animation-duration: ${C0}ms;
    animation-timing-function: ${({theme:n})=>n.transitions.easing.easeInOut};
  }

  & .${va.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${eM};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:n})=>n.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,sM=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiTouchRipple"}),{center:s=!1,classes:a={},className:o,...c}=i,[h,d]=O.useState([]),p=O.useRef(0),g=O.useRef(null);O.useEffect(()=>{g.current&&(g.current(),g.current=null)},[h]);const y=O.useRef(!1),k=sx(),_=O.useRef(null),w=O.useRef(null),T=O.useCallback(v=>{const{pulsate:L,rippleX:A,rippleY:D,rippleSize:H,cb:J}=v;d(K=>[...K,V.jsx(iM,{classes:{ripple:Lt(a.ripple,va.ripple),rippleVisible:Lt(a.rippleVisible,va.rippleVisible),ripplePulsate:Lt(a.ripplePulsate,va.ripplePulsate),child:Lt(a.child,va.child),childLeaving:Lt(a.childLeaving,va.childLeaving),childPulsate:Lt(a.childPulsate,va.childPulsate)},timeout:C0,pulsate:L,rippleX:A,rippleY:D,rippleSize:H},p.current)]),p.current+=1,g.current=J},[a]),x=O.useCallback((v={},L={},A=()=>{})=>{const{pulsate:D=!1,center:H=s||L.pulsate,fakeElement:J=!1}=L;if(v?.type==="mousedown"&&y.current){y.current=!1;return}v?.type==="touchstart"&&(y.current=!0);const K=J?null:w.current,Y=K?K.getBoundingClientRect():{width:0,height:0,left:0,top:0};let C,Q,Z;if(H||v===void 0||v.clientX===0&&v.clientY===0||!v.clientX&&!v.touches)C=Math.round(Y.width/2),Q=Math.round(Y.height/2);else{const{clientX:le,clientY:F}=v.touches&&v.touches.length>0?v.touches[0]:v;C=Math.round(le-Y.left),Q=Math.round(F-Y.top)}if(H)Z=Math.sqrt((2*Y.width**2+Y.height**2)/3),Z%2===0&&(Z+=1);else{const le=Math.max(Math.abs((K?K.clientWidth:0)-C),C)*2+2,F=Math.max(Math.abs((K?K.clientHeight:0)-Q),Q)*2+2;Z=Math.sqrt(le**2+F**2)}v?.touches?_.current===null&&(_.current=()=>{T({pulsate:D,rippleX:C,rippleY:Q,rippleSize:Z,cb:A})},k.start(KD,()=>{_.current&&(_.current(),_.current=null)})):T({pulsate:D,rippleX:C,rippleY:Q,rippleSize:Z,cb:A})},[s,T,k]),E=O.useCallback(()=>{x({},{pulsate:!0})},[x]),N=O.useCallback((v,L)=>{if(k.clear(),v?.type==="touchend"&&_.current){_.current(),_.current=null,k.start(0,()=>{N(v,L)});return}_.current=null,d(A=>A.length>0?A.slice(1):A),g.current=L},[k]);return O.useImperativeHandle(t,()=>({pulsate:E,start:x,stop:N}),[E,x,N]),V.jsx(tM,{className:Lt(va.root,a.root,o),ref:w,...c,children:V.jsx(mb,{component:null,exit:!0,children:h})})});function nM(n){return Qi("MuiButtonBase",n)}const aM=Wi("MuiButtonBase",["root","disabled","focusVisible"]),rM=n=>{const{disabled:e,focusVisible:t,focusVisibleClassName:i,classes:s}=n,o=Ki({root:["root",e&&"disabled",t&&"focusVisible"]},nM,s);return t&&i&&(o.root+=` ${i}`),o},oM=Ke("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${aM.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),jh=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiButtonBase"}),{action:s,centerRipple:a=!1,children:o,className:c,component:h="button",disabled:d=!1,disableRipple:p=!1,disableTouchRipple:g=!1,focusRipple:y=!1,focusVisibleClassName:k,LinkComponent:_="a",onBlur:w,onClick:T,onContextMenu:x,onDragLeave:E,onFocus:N,onFocusVisible:v,onKeyDown:L,onKeyUp:A,onMouseDown:D,onMouseLeave:H,onMouseUp:J,onTouchEnd:K,onTouchMove:Y,onTouchStart:C,tabIndex:Q=0,TouchRippleProps:Z,touchRippleRef:le,type:F,...re}=i,_e=O.useRef(null),ve=qD(),Ve=yn(ve.ref,le),[R,te]=O.useState(!1);d&&R&&te(!1),O.useImperativeHandle(s,()=>({focusVisible:()=>{te(!0),_e.current.focus()}}),[]);const we=ve.shouldMount&&!p&&!d;O.useEffect(()=>{R&&y&&!p&&ve.pulsate()},[p,y,R,ve]);const Ee=zr(ve,"start",D,g),qe=zr(ve,"stop",x,g),je=zr(ve,"stop",E,g),ze=zr(ve,"stop",J,g),qt=zr(ve,"stop",tt=>{R&&tt.preventDefault(),H&&H(tt)},g),Pt=zr(ve,"start",C,g),xt=zr(ve,"stop",K,g),zt=zr(ve,"stop",Y,g),Ut=zr(ve,"stop",tt=>{jf(tt.target)||te(!1),w&&w(tt)},!1),yi=Sr(tt=>{_e.current||(_e.current=tt.currentTarget),jf(tt.target)&&(te(!0),v&&v(tt)),N&&N(tt)}),St=()=>{const tt=_e.current;return h&&h!=="button"&&!(tt.tagName==="A"&&tt.href)},ri=Sr(tt=>{y&&!tt.repeat&&R&&tt.key===" "&&ve.stop(tt,()=>{ve.start(tt)}),tt.target===tt.currentTarget&&St()&&tt.key===" "&&tt.preventDefault(),L&&L(tt),tt.target===tt.currentTarget&&St()&&tt.key==="Enter"&&!d&&(tt.preventDefault(),T&&T(tt))}),Ms=Sr(tt=>{y&&tt.key===" "&&R&&!tt.defaultPrevented&&ve.stop(tt,()=>{ve.pulsate(tt)}),A&&A(tt),T&&tt.target===tt.currentTarget&&St()&&tt.key===" "&&!tt.defaultPrevented&&T(tt)});let di=h;di==="button"&&(re.href||re.to)&&(di=_);const Ni={};if(di==="button"){const tt=!!re.formAction;Ni.type=F===void 0&&!tt?"button":F,Ni.disabled=d}else!re.href&&!re.to&&(Ni.role="button"),d&&(Ni["aria-disabled"]=d);const Mi=yn(t,_e),Ss={...i,centerRipple:a,component:h,disabled:d,disableRipple:p,disableTouchRipple:g,focusRipple:y,tabIndex:Q,focusVisible:R},Ci=rM(Ss);return V.jsxs(oM,{as:di,className:Lt(Ci.root,c),ownerState:Ss,onBlur:Ut,onClick:T,onContextMenu:qe,onFocus:yi,onKeyDown:ri,onKeyUp:Ms,onMouseDown:Ee,onMouseLeave:qt,onMouseUp:ze,onDragLeave:je,onTouchEnd:xt,onTouchMove:zt,onTouchStart:Pt,ref:Mi,tabIndex:d?-1:Q,type:F,...Ni,...re,children:[o,we?V.jsx(sM,{ref:Ve,center:a,...Z}):null]})});function zr(n,e,t,i=!1){return Sr(s=>(t&&t(s),i||n[e](s),!0))}function lM(n){return typeof n.main=="string"}function cM(n,e=[]){if(!lM(n))return!1;for(const t of e)if(!n.hasOwnProperty(t)||typeof n[t]!="string")return!1;return!0}function da(n=[]){return([,e])=>e&&cM(e,n)}function uM(n){return Qi("MuiCircularProgress",n)}Wi("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","track","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Wa=44,E0=Qh`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,P0=Qh`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,hM=typeof E0!="string"?tb`
        animation: ${E0} 1.4s linear infinite;
      `:null,dM=typeof P0!="string"?tb`
        animation: ${P0} 1.4s ease-in-out infinite;
      `:null,fM=n=>{const{classes:e,variant:t,color:i,disableShrink:s}=n,a={root:["root",t,`color${bt(i)}`],svg:["svg"],track:["track"],circle:["circle",`circle${bt(t)}`,s&&"circleDisableShrink"]};return Ki(a,uM,e)},pM=Ke("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[t.variant],e[`color${bt(t.color)}`]]}})(wi(({theme:n})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:n.transitions.create("transform")}},{props:{variant:"indeterminate"},style:hM||{animation:`${E0} 1.4s linear infinite`}},...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{color:(n.vars||n).palette[e].main}}))]}))),gM=Ke("svg",{name:"MuiCircularProgress",slot:"Svg"})({display:"block"}),mM=Ke("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.circle,e[`circle${bt(t.variant)}`],t.disableShrink&&e.circleDisableShrink]}})(wi(({theme:n})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:n.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:e})=>e.variant==="indeterminate"&&!e.disableShrink,style:dM||{animation:`${P0} 1.4s ease-in-out infinite`}}]}))),yM=Ke("circle",{name:"MuiCircularProgress",slot:"Track"})(wi(({theme:n})=>({stroke:"currentColor",opacity:(n.vars||n).palette.action.activatedOpacity}))),lx=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiCircularProgress"}),{className:s,color:a="primary",disableShrink:o=!1,enableTrackSlot:c=!1,size:h=40,style:d,thickness:p=3.6,value:g=0,variant:y="indeterminate",...k}=i,_={...i,color:a,disableShrink:o,size:h,thickness:p,value:g,variant:y,enableTrackSlot:c},w=fM(_),T={},x={},E={};if(y==="determinate"){const N=2*Math.PI*((Wa-p)/2);T.strokeDasharray=N.toFixed(3),E["aria-valuenow"]=Math.round(g),T.strokeDashoffset=`${((100-g)/100*N).toFixed(3)}px`,x.transform="rotate(-90deg)"}return V.jsx(pM,{className:Lt(w.root,s),style:{width:h,height:h,...x,...d},ownerState:_,ref:t,role:"progressbar",...E,...k,children:V.jsxs(gM,{className:w.svg,ownerState:_,viewBox:`${Wa/2} ${Wa/2} ${Wa} ${Wa}`,children:[c?V.jsx(yM,{className:w.track,ownerState:_,cx:Wa,cy:Wa,r:(Wa-p)/2,fill:"none",strokeWidth:p,"aria-hidden":"true"}):null,V.jsx(mM,{className:w.circle,style:T,ownerState:_,cx:Wa,cy:Wa,r:(Wa-p)/2,fill:"none",strokeWidth:p})]})})});function bM(n){return Qi("MuiIconButton",n)}const Y1=Wi("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge","loading","loadingIndicator","loadingWrapper"]),SM=n=>{const{classes:e,disabled:t,color:i,edge:s,size:a,loading:o}=n,c={root:["root",o&&"loading",t&&"disabled",i!=="default"&&`color${bt(i)}`,s&&`edge${bt(s)}`,`size${bt(a)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]};return Ki(c,bM,e)},_M=Ke(jh,{name:"MuiIconButton",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.loading&&e.loading,t.color!=="default"&&e[`color${bt(t.color)}`],t.edge&&e[`edge${bt(t.edge)}`],e[`size${bt(t.size)}`]]}})(wi(({theme:n})=>({textAlign:"center",flex:"0 0 auto",fontSize:n.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(n.vars||n).palette.action.active,transition:n.transitions.create("background-color",{duration:n.transitions.duration.shortest}),variants:[{props:e=>!e.disableRipple,style:{"--IconButton-hoverBg":n.alpha((n.vars||n).palette.action.active,(n.vars||n).palette.action.hoverOpacity),"&:hover":{backgroundColor:"var(--IconButton-hoverBg)","@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),wi(({theme:n})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{color:(n.vars||n).palette[e].main}})),...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{"--IconButton-hoverBg":n.alpha((n.vars||n).palette[e].main,(n.vars||n).palette.action.hoverOpacity)}})),{props:{size:"small"},style:{padding:5,fontSize:n.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:n.typography.pxToRem(28)}}],[`&.${Y1.disabled}`]:{backgroundColor:"transparent",color:(n.vars||n).palette.action.disabled},[`&.${Y1.loading}`]:{color:"transparent"}}))),kM=Ke("span",{name:"MuiIconButton",slot:"LoadingIndicator"})(({theme:n})=>({display:"none",position:"absolute",visibility:"visible",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:(n.vars||n).palette.action.disabled,variants:[{props:{loading:!0},style:{display:"flex"}}]})),Wh=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiIconButton"}),{edge:s=!1,children:a,className:o,color:c="default",disabled:h=!1,disableFocusRipple:d=!1,size:p="medium",id:g,loading:y=null,loadingIndicator:k,..._}=i,w=rg(g),T=k??V.jsx(lx,{"aria-labelledby":w,color:"inherit",size:16}),x={...i,edge:s,color:c,disabled:h,disableFocusRipple:d,loading:y,loadingIndicator:T,size:p},E=SM(x);return V.jsxs(_M,{id:y?w:g,className:Lt(E.root,o),centerRipple:!0,focusRipple:!d,disabled:h||y,ref:t,..._,ownerState:x,children:[typeof y=="boolean"&&V.jsx("span",{className:E.loadingWrapper,style:{display:"contents"},children:V.jsx(kM,{className:E.loadingIndicator,ownerState:x,children:y&&T})}),a]})});function wM(n){return Qi("MuiTypography",n)}const $1=Wi("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]),BM={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},TM=PD(),xM=n=>{const{align:e,gutterBottom:t,noWrap:i,paragraph:s,variant:a,classes:o}=n,c={root:["root",a,n.align!=="inherit"&&`align${bt(e)}`,t&&"gutterBottom",i&&"noWrap",s&&"paragraph"]};return Ki(c,wM,o)},vM=Ke("span",{name:"MuiTypography",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.variant&&e[t.variant],t.align!=="inherit"&&e[`align${bt(t.align)}`],t.noWrap&&e.noWrap,t.gutterBottom&&e.gutterBottom,t.paragraph&&e.paragraph]}})(wi(({theme:n})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(n.typography).filter(([e,t])=>e!=="inherit"&&t&&typeof t=="object").map(([e,t])=>({props:{variant:e},style:t})),...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{color:(n.vars||n).palette[e].main}})),...Object.entries(n.palette?.text||{}).filter(([,e])=>typeof e=="string").map(([e])=>({props:{color:`text${bt(e)}`},style:{color:(n.vars||n).palette.text[e]}})),{props:({ownerState:e})=>e.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:e})=>e.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:e})=>e.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:e})=>e.paragraph,style:{marginBottom:16}}]}))),X1={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Ya=O.forwardRef(function(e,t){const{color:i,...s}=Zi({props:e,name:"MuiTypography"}),a=!BM[i],o=TM({...s,...a&&{color:i}}),{align:c="inherit",className:h,component:d,gutterBottom:p=!1,noWrap:g=!1,paragraph:y=!1,variant:k="body1",variantMapping:_=X1,...w}=o,T={...o,align:c,color:i,className:h,component:d,gutterBottom:p,noWrap:g,paragraph:y,variant:k,variantMapping:_},x=d||(y?"p":_[k]||X1[k])||"span",E=xM(T);return V.jsx(vM,{as:x,ref:t,className:Lt(E.root,h),...w,ownerState:T,style:{...c!=="inherit"&&{"--Typography-textAlign":c},...w.style}})});function NM(n){return Qi("MuiAppBar",n)}Wi("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent","colorError","colorInfo","colorSuccess","colorWarning"]);const CM=n=>{const{color:e,position:t,classes:i}=n,s={root:["root",`color${bt(e)}`,`position${bt(t)}`]};return Ki(s,NM,i)},q1=(n,e)=>n?`${n?.replace(")","")}, ${e})`:e,EM=Ke(cg,{name:"MuiAppBar",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[`position${bt(t.position)}`],e[`color${bt(t.color)}`]]}})(wi(({theme:n})=>({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0,variants:[{props:{position:"fixed"},style:{position:"fixed",zIndex:(n.vars||n).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}}},{props:{position:"absolute"},style:{position:"absolute",zIndex:(n.vars||n).zIndex.appBar,top:0,left:"auto",right:0}},{props:{position:"sticky"},style:{position:"sticky",zIndex:(n.vars||n).zIndex.appBar,top:0,left:"auto",right:0}},{props:{position:"static"},style:{position:"static"}},{props:{position:"relative"},style:{position:"relative"}},{props:{color:"inherit"},style:{"--AppBar-color":"inherit"}},{props:{color:"default"},style:{"--AppBar-background":n.vars?n.vars.palette.AppBar.defaultBg:n.palette.grey[100],"--AppBar-color":n.vars?n.vars.palette.text.primary:n.palette.getContrastText(n.palette.grey[100]),...n.applyStyles("dark",{"--AppBar-background":n.vars?n.vars.palette.AppBar.defaultBg:n.palette.grey[900],"--AppBar-color":n.vars?n.vars.palette.text.primary:n.palette.getContrastText(n.palette.grey[900])})}},...Object.entries(n.palette).filter(da(["contrastText"])).map(([e])=>({props:{color:e},style:{"--AppBar-background":(n.vars??n).palette[e].main,"--AppBar-color":(n.vars??n).palette[e].contrastText}})),{props:e=>e.enableColorOnDark===!0&&!["inherit","transparent"].includes(e.color),style:{backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)"}},{props:e=>e.enableColorOnDark===!1&&!["inherit","transparent"].includes(e.color),style:{backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)",...n.applyStyles("dark",{backgroundColor:n.vars?q1(n.vars.palette.AppBar.darkBg,"var(--AppBar-background)"):null,color:n.vars?q1(n.vars.palette.AppBar.darkColor,"var(--AppBar-color)"):null})}},{props:{color:"transparent"},style:{"--AppBar-background":"transparent","--AppBar-color":"inherit",backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)",...n.applyStyles("dark",{backgroundImage:"none"})}}]}))),PM=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiAppBar"}),{className:s,color:a="primary",enableColorOnDark:o=!1,position:c="fixed",...h}=i,d={...i,color:a,position:c,enableColorOnDark:o},p=CM(d);return V.jsx(EM,{square:!0,component:"header",ownerState:d,elevation:4,className:Lt(p.root,s,c==="fixed"&&"mui-fixed"),ref:t,...h})});function Gr(n){const{elementType:e,externalSlotProps:t,ownerState:i,skipResolvingSlotProps:s=!1,...a}=n,o=s?{}:rx(t,i),{props:c,internalRef:h}=ox({...a,externalSlotProps:o}),d=yn(h,o?.ref,n.additionalProps?.ref);return ax(e,{...c,ref:d},i)}function ed(n){return parseInt(O.version,10)>=19?n?.props?.ref||null:n?.ref||null}function DM(n){return typeof n=="function"?n():n}const MM=O.forwardRef(function(e,t){const{children:i,container:s,disablePortal:a=!1}=e,[o,c]=O.useState(null),h=yn(O.isValidElement(i)?ed(i):null,t);if(Ma(()=>{a||c(DM(s)||document.body)},[s,a]),Ma(()=>{if(o&&!a)return H1(t,o),()=>{H1(t,null)}},[t,o,a]),a){if(O.isValidElement(i)){const d={ref:h};return O.cloneElement(i,d)}return i}return o&&tx.createPortal(i,o)});function LM(n){return Qi("MuiListSubheader",n)}Wi("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);const AM=n=>{const{classes:e,color:t,disableGutters:i,inset:s,disableSticky:a}=n,o={root:["root",t!=="default"&&`color${bt(t)}`,!i&&"gutters",s&&"inset",!a&&"sticky"]};return Ki(o,LM,e)},RM=Ke("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.color!=="default"&&e[`color${bt(t.color)}`],!t.disableGutters&&e.gutters,t.inset&&e.inset,!t.disableSticky&&e.sticky]}})(wi(({theme:n})=>({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(n.vars||n).palette.text.secondary,fontFamily:n.typography.fontFamily,fontWeight:n.typography.fontWeightMedium,fontSize:n.typography.pxToRem(14),variants:[{props:{color:"primary"},style:{color:(n.vars||n).palette.primary.main}},{props:{color:"inherit"},style:{color:"inherit"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:72}},{props:({ownerState:e})=>!e.disableSticky,style:{position:"sticky",top:0,zIndex:1,backgroundColor:(n.vars||n).palette.background.paper}}]}))),D0=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiListSubheader"}),{className:s,color:a="default",component:o="li",disableGutters:c=!1,disableSticky:h=!1,inset:d=!1,...p}=i,g={...i,color:a,component:o,disableGutters:c,disableSticky:h,inset:d},y=AM(g);return V.jsx(RM,{as:o,className:Lt(y.root,s),ref:t,ownerState:g,...p})});D0&&(D0.muiSkipListHighlight=!0);function Tf(n){return parseInt(n,10)||0}const OM={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function FM(n){for(const e in n)return!1;return!0}function J1(n){return FM(n)||n.outerHeightStyle===0&&!n.overflowing}const IM=O.forwardRef(function(e,t){const{onChange:i,maxRows:s,minRows:a=1,style:o,value:c,...h}=e,{current:d}=O.useRef(c!=null),p=O.useRef(null),g=yn(t,p),y=O.useRef(null),k=O.useRef(null),_=O.useCallback(()=>{const N=p.current,v=k.current;if(!N||!v)return;const A=io(N).getComputedStyle(N);if(A.width==="0px")return{outerHeightStyle:0,overflowing:!1};v.style.width=A.width,v.value=N.value||e.placeholder||"x",v.value.slice(-1)===`
`&&(v.value+=" ");const D=A.boxSizing,H=Tf(A.paddingBottom)+Tf(A.paddingTop),J=Tf(A.borderBottomWidth)+Tf(A.borderTopWidth),K=v.scrollHeight;v.value="x";const Y=v.scrollHeight;let C=K;a&&(C=Math.max(Number(a)*Y,C)),s&&(C=Math.min(Number(s)*Y,C)),C=Math.max(C,Y);const Q=C+(D==="border-box"?H+J:0),Z=Math.abs(C-K)<=1;return{outerHeightStyle:Q,overflowing:Z}},[s,a,e.placeholder]),w=Sr(()=>{const N=p.current,v=_();if(!N||!v||J1(v))return!1;const L=v.outerHeightStyle;return y.current!=null&&y.current!==L}),T=O.useCallback(()=>{const N=p.current,v=_();if(!N||!v||J1(v))return;const L=v.outerHeightStyle;y.current!==L&&(y.current=L,N.style.height=`${L}px`),N.style.overflow=v.overflowing?"hidden":""},[_]),x=O.useRef(-1);Ma(()=>{const N=ZT(T),v=p?.current;if(!v)return;const L=io(v);L.addEventListener("resize",N);let A;return typeof ResizeObserver<"u"&&(A=new ResizeObserver(()=>{w()&&(A.unobserve(v),cancelAnimationFrame(x.current),T(),x.current=requestAnimationFrame(()=>{A.observe(v)}))}),A.observe(v)),()=>{N.clear(),cancelAnimationFrame(x.current),L.removeEventListener("resize",N),A&&A.disconnect()}},[_,T,w]),Ma(()=>{T()});const E=N=>{d||T();const v=N.target,L=v.value.length,A=v.value.endsWith(`
`),D=v.selectionStart===L;A&&D&&v.setSelectionRange(L,L),i&&i(N)};return V.jsxs(O.Fragment,{children:[V.jsx("textarea",{value:c,onChange:E,ref:g,rows:a,style:o,...h}),V.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:k,tabIndex:-1,style:{...OM.shadow,...o,paddingTop:0,paddingBottom:0}})]})});function bb({props:n,states:e,muiFormControl:t}){return e.reduce((i,s)=>(i[s]=n[s],t&&typeof n[s]>"u"&&(i[s]=t[s]),i),{})}const cx=O.createContext(void 0);function Sb(){return O.useContext(cx)}function Q1(n){return n!=null&&!(Array.isArray(n)&&n.length===0)}function ux(n,e=!1){return n&&(Q1(n.value)&&n.value!==""||e&&Q1(n.defaultValue)&&n.defaultValue!=="")}function WM(n){return Qi("MuiInputBase",n)}const Qc=Wi("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var K1;const ug=(n,e)=>{const{ownerState:t}=n;return[e.root,t.formControl&&e.formControl,t.startAdornment&&e.adornedStart,t.endAdornment&&e.adornedEnd,t.error&&e.error,t.size==="small"&&e.sizeSmall,t.multiline&&e.multiline,t.color&&e[`color${bt(t.color)}`],t.fullWidth&&e.fullWidth,t.hiddenLabel&&e.hiddenLabel]},hg=(n,e)=>{const{ownerState:t}=n;return[e.input,t.size==="small"&&e.inputSizeSmall,t.multiline&&e.inputMultiline,t.type==="search"&&e.inputTypeSearch,t.startAdornment&&e.inputAdornedStart,t.endAdornment&&e.inputAdornedEnd,t.hiddenLabel&&e.inputHiddenLabel]},VM=n=>{const{classes:e,color:t,disabled:i,error:s,endAdornment:a,focused:o,formControl:c,fullWidth:h,hiddenLabel:d,multiline:p,readOnly:g,size:y,startAdornment:k,type:_}=n,w={root:["root",`color${bt(t)}`,i&&"disabled",s&&"error",h&&"fullWidth",o&&"focused",c&&"formControl",y&&y!=="medium"&&`size${bt(y)}`,p&&"multiline",k&&"adornedStart",a&&"adornedEnd",d&&"hiddenLabel",g&&"readOnly"],input:["input",i&&"disabled",_==="search"&&"inputTypeSearch",p&&"inputMultiline",y==="small"&&"inputSizeSmall",d&&"inputHiddenLabel",k&&"inputAdornedStart",a&&"inputAdornedEnd",g&&"readOnly"]};return Ki(w,WM,e)},dg=Ke("div",{name:"MuiInputBase",slot:"Root",overridesResolver:ug})(wi(({theme:n})=>({...n.typography.body1,color:(n.vars||n).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${Qc.disabled}`]:{color:(n.vars||n).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:e})=>e.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:e,size:t})=>e.multiline&&t==="small",style:{paddingTop:1}},{props:({ownerState:e})=>e.fullWidth,style:{width:"100%"}}]}))),fg=Ke("input",{name:"MuiInputBase",slot:"Input",overridesResolver:hg})(wi(({theme:n})=>{const e=n.palette.mode==="light",t={color:"currentColor",...n.vars?{opacity:n.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5},transition:n.transitions.create("opacity",{duration:n.transitions.duration.shorter})},i={opacity:"0 !important"},s=n.vars?{opacity:n.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":t,"&::-moz-placeholder":t,"&::-ms-input-placeholder":t,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${Qc.formControl} &`]:{"&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&::-ms-input-placeholder":i,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus::-ms-input-placeholder":s},[`&.${Qc.disabled}`]:{opacity:1,WebkitTextFillColor:(n.vars||n).palette.text.disabled},variants:[{props:({ownerState:a})=>!a.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:a})=>a.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),Z1=pb({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),_b=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiInputBase"}),{"aria-describedby":s,autoComplete:a,autoFocus:o,className:c,color:h,components:d={},componentsProps:p={},defaultValue:g,disabled:y,disableInjectingGlobalStyles:k,endAdornment:_,error:w,fullWidth:T=!1,id:x,inputComponent:E="input",inputProps:N={},inputRef:v,margin:L,maxRows:A,minRows:D,multiline:H=!1,name:J,onBlur:K,onChange:Y,onClick:C,onFocus:Q,onKeyDown:Z,onKeyUp:le,placeholder:F,readOnly:re,renderSuffix:_e,rows:ve,size:Ve,slotProps:R={},slots:te={},startAdornment:we,type:Ee="text",value:qe,...je}=i,ze=N.value!=null?N.value:qe,{current:qt}=O.useRef(ze!=null),Pt=O.useRef(),xt=O.useCallback(Yt=>{},[]),zt=yn(Pt,v,N.ref,xt),[Ut,yi]=O.useState(!1),St=Sb(),ri=bb({props:i,muiFormControl:St,states:["color","disabled","error","hiddenLabel","size","required","filled"]});ri.focused=St?St.focused:Ut,O.useEffect(()=>{!St&&y&&Ut&&(yi(!1),K&&K())},[St,y,Ut,K]);const Ms=St&&St.onFilled,di=St&&St.onEmpty,Ni=O.useCallback(Yt=>{ux(Yt)?Ms&&Ms():di&&di()},[Ms,di]);Ma(()=>{qt&&Ni({value:ze})},[ze,Ni,qt]);const Mi=Yt=>{Q&&Q(Yt),N.onFocus&&N.onFocus(Yt),St&&St.onFocus?St.onFocus(Yt):yi(!0)},Ss=Yt=>{K&&K(Yt),N.onBlur&&N.onBlur(Yt),St&&St.onBlur?St.onBlur(Yt):yi(!1)},Ci=(Yt,...ps)=>{if(!qt){const bi=Yt.target||Pt.current;if(bi==null)throw new Error(to(1));Ni({value:bi.value})}N.onChange&&N.onChange(Yt,...ps),Y&&Y(Yt,...ps)};O.useEffect(()=>{Ni(Pt.current)},[]);const tt=Yt=>{Pt.current&&Yt.currentTarget===Yt.target&&Pt.current.focus(),C&&C(Yt)};let bn=E,Zt=N;H&&bn==="input"&&(ve?Zt={type:void 0,minRows:ve,maxRows:ve,...Zt}:Zt={type:void 0,maxRows:A,minRows:D,...Zt},bn=IM);const He=Yt=>{Ni(Yt.animationName==="mui-auto-fill-cancel"?Pt.current:{value:"x"})};O.useEffect(()=>{St&&St.setAdornedStart(!!we)},[St,we]);const Me={...i,color:ri.color||"primary",disabled:ri.disabled,endAdornment:_,error:ri.error,focused:ri.focused,formControl:St,fullWidth:T,hiddenLabel:ri.hiddenLabel,multiline:H,size:ri.size,startAdornment:we,type:Ee},Ge=VM(Me),pt=te.root||d.Root||dg,kt=R.root||p.root||{},Et=te.input||d.Input||fg;return Zt={...Zt,...R.input??p.input},V.jsxs(O.Fragment,{children:[!k&&typeof Z1=="function"&&(K1||(K1=V.jsx(Z1,{}))),V.jsxs(pt,{...kt,ref:t,onClick:tt,...je,...!Uo(pt)&&{ownerState:{...Me,...kt.ownerState}},className:Lt(Ge.root,kt.className,c,re&&"MuiInputBase-readOnly"),children:[we,V.jsx(cx.Provider,{value:null,children:V.jsx(Et,{"aria-invalid":ri.error,"aria-describedby":s,autoComplete:a,autoFocus:o,defaultValue:g,disabled:ri.disabled,id:x,onAnimationStart:He,name:J,placeholder:F,readOnly:re,required:ri.required,rows:ve,value:ze,onKeyDown:Z,onKeyUp:le,type:Ee,...Zt,...!Uo(Et)&&{as:bn,ownerState:{...Me,...Zt.ownerState}},ref:zt,className:Lt(Ge.input,Zt.className,re&&"MuiInputBase-readOnly"),onBlur:Ss,onChange:Ci,onFocus:Mi})}),_,_e?_e({...ri,startAdornment:we}):null]})]})});function HM(n){return Qi("MuiInput",n)}const sh={...Qc,...Wi("MuiInput",["root","underline","input"])};function zM(n){return Qi("MuiOutlinedInput",n)}const rr={...Qc,...Wi("MuiOutlinedInput",["root","notchedOutline","input"])};function GM(n){return Qi("MuiFilledInput",n)}const kl={...Qc,...Wi("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},UM=fa(V.jsx("path",{d:"M7 10l5 5 5-5z"})),YM={entering:{opacity:1},entered:{opacity:1}},$M=O.forwardRef(function(e,t){const i=fb(),s={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:a,appear:o=!0,children:c,easing:h,in:d,onEnter:p,onEntered:g,onEntering:y,onExit:k,onExited:_,onExiting:w,style:T,timeout:x=s,TransitionComponent:E=kr,...N}=e,v=O.useRef(null),L=yn(v,ed(c),t),A=Z=>le=>{if(Z){const F=v.current;le===void 0?Z(F):Z(F,le)}},D=A(y),H=A((Z,le)=>{nx(Z);const F=Zf({style:T,timeout:x,easing:h},{mode:"enter"});Z.style.webkitTransition=i.transitions.create("opacity",F),Z.style.transition=i.transitions.create("opacity",F),p&&p(Z,le)}),J=A(g),K=A(w),Y=A(Z=>{const le=Zf({style:T,timeout:x,easing:h},{mode:"exit"});Z.style.webkitTransition=i.transitions.create("opacity",le),Z.style.transition=i.transitions.create("opacity",le),k&&k(Z)}),C=A(_),Q=Z=>{a&&a(v.current,Z)};return V.jsx(E,{appear:o,in:d,nodeRef:v,onEnter:H,onEntered:J,onEntering:D,onExit:Y,onExited:C,onExiting:K,addEndListener:Q,timeout:x,...N,children:(Z,{ownerState:le,...F})=>O.cloneElement(c,{style:{opacity:0,visibility:Z==="exited"&&!d?"hidden":void 0,...YM[Z],...T,...c.props.style},ref:L,...F})})});function XM(n){return Qi("MuiBackdrop",n)}Wi("MuiBackdrop",["root","invisible"]);const qM=n=>{const{classes:e,invisible:t}=n;return Ki({root:["root",t&&"invisible"]},XM,e)},JM=Ke("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),QM=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiBackdrop"}),{children:s,className:a,component:o="div",invisible:c=!1,open:h,components:d={},componentsProps:p={},slotProps:g={},slots:y={},TransitionComponent:k,transitionDuration:_,...w}=i,T={...i,component:o,invisible:c},x=qM(T),E={transition:k,root:d.Root,...y},N={...p,...g},v={component:o,slots:E,slotProps:N},[L,A]=ua("root",{elementType:JM,externalForwardedProps:v,className:Lt(x.root,a),ownerState:T}),[D,H]=ua("transition",{elementType:$M,externalForwardedProps:v,ownerState:T});return V.jsx(D,{in:h,timeout:_,...w,...H,children:V.jsx(L,{"aria-hidden":!0,...A,classes:x,ref:t,children:s})})}),KM=Wi("MuiBox",["root"]),ZM=og(),Ic=jE({themeId:yr,defaultTheme:ZM,defaultClassName:KM.root,generateClassName:LT.generate});function jM(n){return Qi("MuiButton",n)}const wl=Wi("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),eL=O.createContext({}),tL=O.createContext(void 0),iL=n=>{const{color:e,disableElevation:t,fullWidth:i,size:s,variant:a,loading:o,loadingPosition:c,classes:h}=n,d={root:["root",o&&"loading",a,`${a}${bt(e)}`,`size${bt(s)}`,`${a}Size${bt(s)}`,`color${bt(e)}`,t&&"disableElevation",i&&"fullWidth",o&&`loadingPosition${bt(c)}`],startIcon:["icon","startIcon",`iconSize${bt(s)}`],endIcon:["icon","endIcon",`iconSize${bt(s)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},p=Ki(d,jM,h);return{...h,...p}},hx=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],sL=Ke(jh,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiButton",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[t.variant],e[`${t.variant}${bt(t.color)}`],e[`size${bt(t.size)}`],e[`${t.variant}Size${bt(t.size)}`],t.color==="inherit"&&e.colorInherit,t.disableElevation&&e.disableElevation,t.fullWidth&&e.fullWidth,t.loading&&e.loading]}})(wi(({theme:n})=>{const e=n.palette.mode==="light"?n.palette.grey[300]:n.palette.grey[800],t=n.palette.mode==="light"?n.palette.grey.A100:n.palette.grey[700];return{...n.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(n.vars||n).shape.borderRadius,transition:n.transitions.create(["background-color","box-shadow","border-color","color"],{duration:n.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${wl.disabled}`]:{color:(n.vars||n).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(n.vars||n).shadows[2],"&:hover":{boxShadow:(n.vars||n).shadows[4],"@media (hover: none)":{boxShadow:(n.vars||n).shadows[2]}},"&:active":{boxShadow:(n.vars||n).shadows[8]},[`&.${wl.focusVisible}`]:{boxShadow:(n.vars||n).shadows[6]},[`&.${wl.disabled}`]:{color:(n.vars||n).palette.action.disabled,boxShadow:(n.vars||n).shadows[0],backgroundColor:(n.vars||n).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${wl.disabled}`]:{border:`1px solid ${(n.vars||n).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(n.palette).filter(da()).map(([i])=>({props:{color:i},style:{"--variant-textColor":(n.vars||n).palette[i].main,"--variant-outlinedColor":(n.vars||n).palette[i].main,"--variant-outlinedBorder":n.alpha((n.vars||n).palette[i].main,.5),"--variant-containedColor":(n.vars||n).palette[i].contrastText,"--variant-containedBg":(n.vars||n).palette[i].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(n.vars||n).palette[i].dark,"--variant-textBg":n.alpha((n.vars||n).palette[i].main,(n.vars||n).palette.action.hoverOpacity),"--variant-outlinedBorder":(n.vars||n).palette[i].main,"--variant-outlinedBg":n.alpha((n.vars||n).palette[i].main,(n.vars||n).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":n.vars?n.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":n.vars?n.vars.palette.Button.inheritContainedHoverBg:t,"--variant-textBg":n.alpha((n.vars||n).palette.text.primary,(n.vars||n).palette.action.hoverOpacity),"--variant-outlinedBg":n.alpha((n.vars||n).palette.text.primary,(n.vars||n).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:n.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:n.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:n.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:n.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:n.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:n.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${wl.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${wl.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:n.transitions.create(["background-color","box-shadow","border-color"],{duration:n.transitions.duration.short}),[`&.${wl.loading}`]:{color:"transparent"}}}]}})),nL=Ke("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.startIcon,t.loading&&e.startIconLoadingStart,e[`iconSize${bt(t.size)}`]]}})(({theme:n})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:n.transitions.create(["opacity"],{duration:n.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...hx]})),aL=Ke("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.endIcon,t.loading&&e.endIconLoadingEnd,e[`iconSize${bt(t.size)}`]]}})(({theme:n})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:n.transitions.create(["opacity"],{duration:n.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...hx]})),rL=Ke("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:n})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(n.vars||n).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),j1=Ke("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),oL=O.forwardRef(function(e,t){const i=O.useContext(eL),s=O.useContext(tL),a=Jc(i,e),o=Zi({props:a,name:"MuiButton"}),{children:c,color:h="primary",component:d="button",className:p,disabled:g=!1,disableElevation:y=!1,disableFocusRipple:k=!1,endIcon:_,focusVisibleClassName:w,fullWidth:T=!1,id:x,loading:E=null,loadingIndicator:N,loadingPosition:v="center",size:L="medium",startIcon:A,type:D,variant:H="text",...J}=o,K=rg(x),Y=N??V.jsx(lx,{"aria-labelledby":K,color:"inherit",size:16}),C={...o,color:h,component:d,disabled:g,disableElevation:y,disableFocusRipple:k,fullWidth:T,loading:E,loadingIndicator:Y,loadingPosition:v,size:L,type:D,variant:H},Q=iL(C),Z=(A||E&&v==="start")&&V.jsx(nL,{className:Q.startIcon,ownerState:C,children:A||V.jsx(j1,{className:Q.loadingIconPlaceholder,ownerState:C})}),le=(_||E&&v==="end")&&V.jsx(aL,{className:Q.endIcon,ownerState:C,children:_||V.jsx(j1,{className:Q.loadingIconPlaceholder,ownerState:C})}),F=s||"",re=typeof E=="boolean"?V.jsx("span",{className:Q.loadingWrapper,style:{display:"contents"},children:E&&V.jsx(rL,{className:Q.loadingIndicator,ownerState:C,children:Y})}):null;return V.jsxs(sL,{ownerState:C,className:Lt(i.className,Q.root,p,F),component:d,disabled:g||E,focusRipple:!k,focusVisibleClassName:Lt(Q.focusVisible,w),ref:t,type:D,id:E?K:x,...J,classes:Q,children:[Z,v!=="end"&&re,c,v==="end"&&re,le]})}),M0=typeof pb({})=="function",lL=(n,e)=>({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%",...e&&!n.vars&&{colorScheme:n.palette.mode}}),cL=n=>({color:(n.vars||n).palette.text.primary,...n.typography.body1,backgroundColor:(n.vars||n).palette.background.default,"@media print":{backgroundColor:(n.vars||n).palette.common.white}}),dx=(n,e=!1)=>{const t={};e&&n.colorSchemes&&typeof n.getColorSchemeSelector=="function"&&Object.entries(n.colorSchemes).forEach(([a,o])=>{const c=n.getColorSchemeSelector(a);c.startsWith("@")?t[c]={":root":{colorScheme:o.palette?.mode}}:t[c.replace(/\s*&/,"")]={colorScheme:o.palette?.mode}});let i={html:lL(n,e),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:n.typography.fontWeightBold},body:{margin:0,...cL(n),"&::backdrop":{backgroundColor:(n.vars||n).palette.background.default}},...t};const s=n.components?.MuiCssBaseline?.styleOverrides;return s&&(i=[i,s]),i},Gf="mui-ecs",uL=n=>{const e=dx(n,!1),t=Array.isArray(e)?e[0]:e;return!n.vars&&t&&(t.html[`:root:has(${Gf})`]={colorScheme:n.palette.mode}),n.colorSchemes&&Object.entries(n.colorSchemes).forEach(([i,s])=>{const a=n.getColorSchemeSelector(i);a.startsWith("@")?t[a]={[`:root:not(:has(.${Gf}))`]:{colorScheme:s.palette?.mode}}:t[a.replace(/\s*&/,"")]={[`&:not(:has(.${Gf}))`]:{colorScheme:s.palette?.mode}}}),e},hL=pb(M0?({theme:n,enableColorScheme:e})=>dx(n,e):({theme:n})=>uL(n));function dL(n){const e=Zi({props:n,name:"MuiCssBaseline"}),{children:t,enableColorScheme:i=!1}=e;return V.jsxs(O.Fragment,{children:[M0&&V.jsx(hL,{enableColorScheme:i}),!M0&&!i&&V.jsx("span",{className:Gf,style:{display:"none"}}),t]})}function fx(n=window){const e=n.document.documentElement.clientWidth;return n.innerWidth-e}function fL(n){const e=Ln(n);return e.body===n?io(n).innerWidth>e.documentElement.clientWidth:n.scrollHeight>n.clientHeight}function _h(n,e){e?n.setAttribute("aria-hidden","true"):n.removeAttribute("aria-hidden")}function eB(n){return parseInt(io(n).getComputedStyle(n).paddingRight,10)||0}function pL(n){const t=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(n.tagName),i=n.tagName==="INPUT"&&n.getAttribute("type")==="hidden";return t||i}function tB(n,e,t,i,s){const a=[e,t,...i];[].forEach.call(n.children,o=>{const c=!a.includes(o),h=!pL(o);c&&h&&_h(o,s)})}function i0(n,e){let t=-1;return n.some((i,s)=>e(i)?(t=s,!0):!1),t}function gL(n,e){const t=[],i=n.container;if(!e.disableScrollLock){if(fL(i)){const o=fx(io(i));t.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight=`${eB(i)+o}px`;const c=Ln(i).querySelectorAll(".mui-fixed");[].forEach.call(c,h=>{t.push({value:h.style.paddingRight,property:"padding-right",el:h}),h.style.paddingRight=`${eB(h)+o}px`})}let a;if(i.parentNode instanceof DocumentFragment)a=Ln(i).body;else{const o=i.parentElement,c=io(i);a=o?.nodeName==="HTML"&&c.getComputedStyle(o).overflowY==="scroll"?o:i}t.push({value:a.style.overflow,property:"overflow",el:a},{value:a.style.overflowX,property:"overflow-x",el:a},{value:a.style.overflowY,property:"overflow-y",el:a}),a.style.overflow="hidden"}return()=>{t.forEach(({value:a,el:o,property:c})=>{a?o.style.setProperty(c,a):o.style.removeProperty(c)})}}function mL(n){const e=[];return[].forEach.call(n.children,t=>{t.getAttribute("aria-hidden")==="true"&&e.push(t)}),e}class yL{constructor(){this.modals=[],this.containers=[]}add(e,t){let i=this.modals.indexOf(e);if(i!==-1)return i;i=this.modals.length,this.modals.push(e),e.modalRef&&_h(e.modalRef,!1);const s=mL(t);tB(t,e.mount,e.modalRef,s,!0);const a=i0(this.containers,o=>o.container===t);return a!==-1?(this.containers[a].modals.push(e),i):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:s}),i)}mount(e,t){const i=i0(this.containers,a=>a.modals.includes(e)),s=this.containers[i];s.restore||(s.restore=gL(s,t))}remove(e,t=!0){const i=this.modals.indexOf(e);if(i===-1)return i;const s=i0(this.containers,o=>o.modals.includes(e)),a=this.containers[s];if(a.modals.splice(a.modals.indexOf(e),1),this.modals.splice(i,1),a.modals.length===0)a.restore&&a.restore(),e.modalRef&&_h(e.modalRef,t),tB(a.container,e.mount,e.modalRef,a.hiddenSiblings,!1),this.containers.splice(s,1);else{const o=a.modals[a.modals.length-1];o.modalRef&&_h(o.modalRef,!1)}return i}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}function fh(n){let e=n.activeElement;for(;e?.shadowRoot?.activeElement!=null;)e=e.shadowRoot.activeElement;return e}const bL=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function SL(n){const e=parseInt(n.getAttribute("tabindex")||"",10);return Number.isNaN(e)?n.contentEditable==="true"||(n.nodeName==="AUDIO"||n.nodeName==="VIDEO"||n.nodeName==="DETAILS")&&n.getAttribute("tabindex")===null?0:n.tabIndex:e}function _L(n){if(n.tagName!=="INPUT"||n.type!=="radio"||!n.name)return!1;const e=i=>n.ownerDocument.querySelector(`input[type="radio"]${i}`);let t=e(`[name="${n.name}"]:checked`);return t||(t=e(`[name="${n.name}"]`)),t!==n}function kL(n){return!(n.disabled||n.tagName==="INPUT"&&n.type==="hidden"||_L(n))}function wL(n){const e=[],t=[];return Array.from(n.querySelectorAll(bL)).forEach((i,s)=>{const a=SL(i);a===-1||!kL(i)||(a===0?e.push(i):t.push({documentOrder:s,tabIndex:a,node:i}))}),t.sort((i,s)=>i.tabIndex===s.tabIndex?i.documentOrder-s.documentOrder:i.tabIndex-s.tabIndex).map(i=>i.node).concat(e)}function BL(){return!0}function TL(n){const{children:e,disableAutoFocus:t=!1,disableEnforceFocus:i=!1,disableRestoreFocus:s=!1,getTabbable:a=wL,isEnabled:o=BL,open:c}=n,h=O.useRef(!1),d=O.useRef(null),p=O.useRef(null),g=O.useRef(null),y=O.useRef(null),k=O.useRef(!1),_=O.useRef(null),w=yn(ed(e),_),T=O.useRef(null);O.useEffect(()=>{!c||!_.current||(k.current=!t)},[t,c]),O.useEffect(()=>{if(!c||!_.current)return;const N=Ln(_.current),v=fh(N);return _.current.contains(v)||(_.current.hasAttribute("tabIndex")||_.current.setAttribute("tabIndex","-1"),k.current&&_.current.focus()),()=>{s||(g.current&&g.current.focus&&(h.current=!0,g.current.focus()),g.current=null)}},[c]),O.useEffect(()=>{if(!c||!_.current)return;const N=Ln(_.current),v=fh(N),L=H=>{T.current=H,!(i||!o()||H.key!=="Tab")&&v===_.current&&H.shiftKey&&(h.current=!0,p.current&&p.current.focus())},A=()=>{const H=_.current;if(H===null)return;const J=fh(N);if(!N.hasFocus()||!o()||h.current){h.current=!1;return}if(H.contains(J)||i&&J!==d.current&&J!==p.current)return;if(J!==y.current)y.current=null;else if(y.current!==null)return;if(!k.current)return;let K=[];if((J===d.current||J===p.current)&&(K=a(_.current)),K.length>0){const Y=!!(T.current?.shiftKey&&T.current?.key==="Tab"),C=K[0],Q=K[K.length-1];typeof C!="string"&&typeof Q!="string"&&(Y?Q.focus():C.focus())}else H.focus()};N.addEventListener("focusin",A),N.addEventListener("keydown",L,!0);const D=setInterval(()=>{const H=fh(N);H&&H.tagName==="BODY"&&A()},50);return()=>{clearInterval(D),N.removeEventListener("focusin",A),N.removeEventListener("keydown",L,!0)}},[t,i,s,o,c,a]);const x=N=>{g.current===null&&(g.current=N.relatedTarget),k.current=!0,y.current=N.target;const v=e.props.onFocus;v&&v(N)},E=N=>{g.current===null&&(g.current=N.relatedTarget),k.current=!0};return V.jsxs(O.Fragment,{children:[V.jsx("div",{tabIndex:c?0:-1,onFocus:E,ref:d,"data-testid":"sentinelStart"}),O.cloneElement(e,{ref:w,onFocus:x}),V.jsx("div",{tabIndex:c?0:-1,onFocus:E,ref:p,"data-testid":"sentinelEnd"})]})}function xL(n){return typeof n=="function"?n():n}function vL(n){return n?n.props.hasOwnProperty("in"):!1}const iB=()=>{},xf=new yL;function NL(n){const{container:e,disableEscapeKeyDown:t=!1,disableScrollLock:i=!1,closeAfterTransition:s=!1,onTransitionEnter:a,onTransitionExited:o,children:c,onClose:h,open:d,rootRef:p}=n,g=O.useRef({}),y=O.useRef(null),k=O.useRef(null),_=yn(k,p),[w,T]=O.useState(!d),x=vL(c);let E=!0;(n["aria-hidden"]==="false"||n["aria-hidden"]===!1)&&(E=!1);const N=()=>Ln(y.current),v=()=>(g.current.modalRef=k.current,g.current.mount=y.current,g.current),L=()=>{xf.mount(v(),{disableScrollLock:i}),k.current&&(k.current.scrollTop=0)},A=Sr(()=>{const le=xL(e)||N().body;xf.add(v(),le),k.current&&L()}),D=()=>xf.isTopModal(v()),H=Sr(le=>{y.current=le,le&&(d&&D()?L():k.current&&_h(k.current,E))}),J=O.useCallback(()=>{xf.remove(v(),E)},[E]);O.useEffect(()=>()=>{J()},[J]),O.useEffect(()=>{d?A():(!x||!s)&&J()},[d,J,x,s,A]);const K=le=>F=>{le.onKeyDown?.(F),!(F.key!=="Escape"||F.which===229||!D())&&(t||(F.stopPropagation(),h&&h(F,"escapeKeyDown")))},Y=le=>F=>{le.onClick?.(F),F.target===F.currentTarget&&h&&h(F,"backdropClick")};return{getRootProps:(le={})=>{const F=Sh(n);delete F.onTransitionEnter,delete F.onTransitionExited;const re={...F,...le};return{role:"presentation",...re,onKeyDown:K(re),ref:_}},getBackdropProps:(le={})=>{const F=le;return{"aria-hidden":!0,...F,onClick:Y(F),open:d}},getTransitionProps:()=>{const le=()=>{T(!1),a&&a()},F=()=>{T(!0),o&&o(),s&&J()};return{onEnter:V1(le,c?.props.onEnter??iB),onExited:V1(F,c?.props.onExited??iB)}},rootRef:_,portalRef:H,isTopModal:D,exited:w,hasTransition:x}}function CL(n){return Qi("MuiModal",n)}Wi("MuiModal",["root","hidden","backdrop"]);const EL=n=>{const{open:e,exited:t,classes:i}=n;return Ki({root:["root",!e&&t&&"hidden"],backdrop:["backdrop"]},CL,i)},PL=Ke("div",{name:"MuiModal",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,!t.open&&t.exited&&e.hidden]}})(wi(({theme:n})=>({position:"fixed",zIndex:(n.vars||n).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),DL=Ke(QM,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),ML=O.forwardRef(function(e,t){const i=Zi({name:"MuiModal",props:e}),{BackdropComponent:s=DL,BackdropProps:a,classes:o,className:c,closeAfterTransition:h=!1,children:d,container:p,component:g,components:y={},componentsProps:k={},disableAutoFocus:_=!1,disableEnforceFocus:w=!1,disableEscapeKeyDown:T=!1,disablePortal:x=!1,disableRestoreFocus:E=!1,disableScrollLock:N=!1,hideBackdrop:v=!1,keepMounted:L=!1,onClose:A,onTransitionEnter:D,onTransitionExited:H,open:J,slotProps:K={},slots:Y={},theme:C,...Q}=i,Z={...i,closeAfterTransition:h,disableAutoFocus:_,disableEnforceFocus:w,disableEscapeKeyDown:T,disablePortal:x,disableRestoreFocus:E,disableScrollLock:N,hideBackdrop:v,keepMounted:L},{getRootProps:le,getBackdropProps:F,getTransitionProps:re,portalRef:_e,isTopModal:ve,exited:Ve,hasTransition:R}=NL({...Z,rootRef:t}),te={...Z,exited:Ve},we=EL(te),Ee={};if(d.props.tabIndex===void 0&&(Ee.tabIndex="-1"),R){const{onEnter:xt,onExited:zt}=re();Ee.onEnter=xt,Ee.onExited=zt}const qe={slots:{root:y.Root,backdrop:y.Backdrop,...Y},slotProps:{...k,...K}},[je,ze]=ua("root",{ref:t,elementType:PL,externalForwardedProps:{...qe,...Q,component:g},getSlotProps:le,ownerState:te,className:Lt(c,we?.root,!te.open&&te.exited&&we?.hidden)}),[qt,Pt]=ua("backdrop",{ref:a?.ref,elementType:s,externalForwardedProps:qe,shouldForwardComponentProp:!0,additionalProps:a,getSlotProps:xt=>F({...xt,onClick:zt=>{xt?.onClick&&xt.onClick(zt)}}),className:Lt(a?.className,we?.backdrop),ownerState:te});return!L&&!J&&(!R||Ve)?null:V.jsx(MM,{ref:_e,container:p,disablePortal:x,children:V.jsxs(je,{...ze,children:[!v&&s?V.jsx(qt,{...Pt}):null,V.jsx(TL,{disableEnforceFocus:w,disableAutoFocus:_,disableRestoreFocus:E,isEnabled:ve,open:J,children:O.cloneElement(d,Ee)})]})})});function LL(n){return Qi("MuiDivider",n)}const sB=Wi("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),AL=n=>{const{absolute:e,children:t,classes:i,flexItem:s,light:a,orientation:o,textAlign:c,variant:h}=n;return Ki({root:["root",e&&"absolute",h,a&&"light",o==="vertical"&&"vertical",s&&"flexItem",t&&"withChildren",t&&o==="vertical"&&"withChildrenVertical",c==="right"&&o!=="vertical"&&"textAlignRight",c==="left"&&o!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",o==="vertical"&&"wrapperVertical"]},LL,i)},RL=Ke("div",{name:"MuiDivider",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,t.absolute&&e.absolute,e[t.variant],t.light&&e.light,t.orientation==="vertical"&&e.vertical,t.flexItem&&e.flexItem,t.children&&e.withChildren,t.children&&t.orientation==="vertical"&&e.withChildrenVertical,t.textAlign==="right"&&t.orientation!=="vertical"&&e.textAlignRight,t.textAlign==="left"&&t.orientation!=="vertical"&&e.textAlignLeft]}})(wi(({theme:n})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(n.vars||n).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:n.alpha((n.vars||n).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:n.spacing(2),marginRight:n.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:n.spacing(1),marginBottom:n.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&e.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(n.vars||n).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>e.orientation==="vertical"&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(n.vars||n).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>e.textAlign==="right"&&e.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>e.textAlign==="left"&&e.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),OL=Ke("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.wrapper,t.orientation==="vertical"&&e.wrapperVertical]}})(wi(({theme:n})=>({display:"inline-block",paddingLeft:`calc(${n.spacing(1)} * 1.2)`,paddingRight:`calc(${n.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${n.spacing(1)} * 1.2)`,paddingBottom:`calc(${n.spacing(1)} * 1.2)`}}]}))),L0=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiDivider"}),{absolute:s=!1,children:a,className:o,orientation:c="horizontal",component:h=a||c==="vertical"?"div":"hr",flexItem:d=!1,light:p=!1,role:g=h!=="hr"?"separator":void 0,textAlign:y="center",variant:k="fullWidth",..._}=i,w={...i,absolute:s,component:h,flexItem:d,light:p,orientation:c,role:g,textAlign:y,variant:k},T=AL(w);return V.jsx(RL,{as:h,className:Lt(T.root,o),role:g,ref:t,ownerState:w,"aria-orientation":g==="separator"&&(h!=="hr"||c==="vertical")?c:void 0,..._,children:a?V.jsx(OL,{className:T.wrapper,ownerState:w,children:a}):null})});L0&&(L0.muiSkipListHighlight=!0);const FL=n=>{const{classes:e,disableUnderline:t,startAdornment:i,endAdornment:s,size:a,hiddenLabel:o,multiline:c}=n,h={root:["root",!t&&"underline",i&&"adornedStart",s&&"adornedEnd",a==="small"&&`size${bt(a)}`,o&&"hiddenLabel",c&&"multiline"],input:["input"]},d=Ki(h,GM,e);return{...e,...d}},IL=Ke(dg,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[...ug(n,e),!t.disableUnderline&&e.underline]}})(wi(({theme:n})=>{const e=n.palette.mode==="light",t=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",i=e?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",s=e?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",a=e?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:n.vars?n.vars.palette.FilledInput.bg:i,borderTopLeftRadius:(n.vars||n).shape.borderRadius,borderTopRightRadius:(n.vars||n).shape.borderRadius,transition:n.transitions.create("background-color",{duration:n.transitions.duration.shorter,easing:n.transitions.easing.easeOut}),"&:hover":{backgroundColor:n.vars?n.vars.palette.FilledInput.hoverBg:s,"@media (hover: none)":{backgroundColor:n.vars?n.vars.palette.FilledInput.bg:i}},[`&.${kl.focused}`]:{backgroundColor:n.vars?n.vars.palette.FilledInput.bg:i},[`&.${kl.disabled}`]:{backgroundColor:n.vars?n.vars.palette.FilledInput.disabledBg:a},variants:[{props:({ownerState:o})=>!o.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:n.transitions.create("transform",{duration:n.transitions.duration.shorter,easing:n.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${kl.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${kl.error}`]:{"&::before, &::after":{borderBottomColor:(n.vars||n).palette.error.main}},"&::before":{borderBottom:`1px solid ${n.vars?n.alpha(n.vars.palette.common.onBackground,n.vars.opacity.inputUnderline):t}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:n.transitions.create("border-bottom-color",{duration:n.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${kl.disabled}, .${kl.error}):before`]:{borderBottom:`1px solid ${(n.vars||n).palette.text.primary}`},[`&.${kl.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(n.palette).filter(da()).map(([o])=>({props:{disableUnderline:!1,color:o},style:{"&::after":{borderBottom:`2px solid ${(n.vars||n).palette[o]?.main}`}}})),{props:({ownerState:o})=>o.startAdornment,style:{paddingLeft:12}},{props:({ownerState:o})=>o.endAdornment,style:{paddingRight:12}},{props:({ownerState:o})=>o.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:o,size:c})=>o.multiline&&c==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:o})=>o.multiline&&o.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:o})=>o.multiline&&o.hiddenLabel&&o.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),WL=Ke(fg,{name:"MuiFilledInput",slot:"Input",overridesResolver:hg})(wi(({theme:n})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!n.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:n.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:n.palette.mode==="light"?null:"#fff",caretColor:n.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...n.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[n.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:e})=>e.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}},{props:({ownerState:e})=>e.hiddenLabel&&e.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:e})=>e.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),px=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiFilledInput"}),{disableUnderline:s=!1,components:a={},componentsProps:o,fullWidth:c=!1,hiddenLabel:h,inputComponent:d="input",multiline:p=!1,slotProps:g,slots:y={},type:k="text",..._}=i,w={...i,disableUnderline:s,fullWidth:c,inputComponent:d,multiline:p,type:k},T=FL(i),x={root:{ownerState:w},input:{ownerState:w}},E=g??o?rn(x,g??o):x,N=y.root??a.Root??IL,v=y.input??a.Input??WL;return V.jsx(_b,{slots:{root:N,input:v},slotProps:E,fullWidth:c,inputComponent:d,multiline:p,ref:t,type:k,..._,classes:T})});px.muiName="Input";function A0(n){return`scale(${n}, ${n**2})`}const VL={entering:{opacity:1,transform:A0(1)},entered:{opacity:1,transform:"none"}},s0=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),R0=O.forwardRef(function(e,t){const{addEndListener:i,appear:s=!0,children:a,easing:o,in:c,onEnter:h,onEntered:d,onEntering:p,onExit:g,onExited:y,onExiting:k,style:_,timeout:w="auto",TransitionComponent:T=kr,...x}=e,E=sx(),N=O.useRef(),v=fb(),L=O.useRef(null),A=yn(L,ed(a),t),D=le=>F=>{if(le){const re=L.current;F===void 0?le(re):le(re,F)}},H=D(p),J=D((le,F)=>{nx(le);const{duration:re,delay:_e,easing:ve}=Zf({style:_,timeout:w,easing:o},{mode:"enter"});let Ve;w==="auto"?(Ve=v.transitions.getAutoHeightDuration(le.clientHeight),N.current=Ve):Ve=re,le.style.transition=[v.transitions.create("opacity",{duration:Ve,delay:_e}),v.transitions.create("transform",{duration:s0?Ve:Ve*.666,delay:_e,easing:ve})].join(","),h&&h(le,F)}),K=D(d),Y=D(k),C=D(le=>{const{duration:F,delay:re,easing:_e}=Zf({style:_,timeout:w,easing:o},{mode:"exit"});let ve;w==="auto"?(ve=v.transitions.getAutoHeightDuration(le.clientHeight),N.current=ve):ve=F,le.style.transition=[v.transitions.create("opacity",{duration:ve,delay:re}),v.transitions.create("transform",{duration:s0?ve:ve*.666,delay:s0?re:re||ve*.333,easing:_e})].join(","),le.style.opacity=0,le.style.transform=A0(.75),g&&g(le)}),Q=D(y),Z=le=>{w==="auto"&&E.start(N.current||0,le),i&&i(L.current,le)};return V.jsx(T,{appear:s,in:c,nodeRef:L,onEnter:J,onEntered:K,onEntering:H,onExit:C,onExited:Q,onExiting:Y,addEndListener:Z,timeout:w==="auto"?null:w,...x,children:(le,{ownerState:F,...re})=>O.cloneElement(a,{style:{opacity:0,transform:A0(.75),visibility:le==="exited"&&!c?"hidden":void 0,...VL[le],..._,...a.props.style},ref:A,...re})})});R0&&(R0.muiSupportAuto=!0);const HL=n=>{const{classes:e,disableUnderline:t}=n,s=Ki({root:["root",!t&&"underline"],input:["input"]},HM,e);return{...e,...s}},zL=Ke(dg,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiInput",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[...ug(n,e),!t.disableUnderline&&e.underline]}})(wi(({theme:n})=>{let t=n.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return n.vars&&(t=n.alpha(n.vars.palette.common.onBackground,n.vars.opacity.inputUnderline)),{position:"relative",variants:[{props:({ownerState:i})=>i.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:i})=>!i.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:n.transitions.create("transform",{duration:n.transitions.duration.shorter,easing:n.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${sh.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${sh.error}`]:{"&::before, &::after":{borderBottomColor:(n.vars||n).palette.error.main}},"&::before":{borderBottom:`1px solid ${t}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:n.transitions.create("border-bottom-color",{duration:n.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${sh.disabled}, .${sh.error}):before`]:{borderBottom:`2px solid ${(n.vars||n).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${t}`}},[`&.${sh.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(n.palette).filter(da()).map(([i])=>({props:{color:i,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(n.vars||n).palette[i].main}`}}}))]}})),GL=Ke(fg,{name:"MuiInput",slot:"Input",overridesResolver:hg})({}),gx=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiInput"}),{disableUnderline:s=!1,components:a={},componentsProps:o,fullWidth:c=!1,inputComponent:h="input",multiline:d=!1,slotProps:p,slots:g={},type:y="text",...k}=i,_=HL(i),T={root:{ownerState:{disableUnderline:s}}},x=p??o?rn(p??o,T):T,E=g.root??a.Root??zL,N=g.input??a.Input??GL;return V.jsx(_b,{slots:{root:E,input:N},slotProps:x,fullWidth:c,inputComponent:h,multiline:d,ref:t,type:y,...k,classes:_})});gx.muiName="Input";const Kc=O.createContext({});function UL(n){return Qi("MuiList",n)}Wi("MuiList",["root","padding","dense","subheader"]);const YL=n=>{const{classes:e,disablePadding:t,dense:i,subheader:s}=n;return Ki({root:["root",!t&&"padding",i&&"dense",s&&"subheader"]},UL,e)},$L=Ke("ul",{name:"MuiList",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,!t.disablePadding&&e.padding,t.dense&&e.dense,t.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:n})=>!n.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:n})=>n.subheader,style:{paddingTop:0}}]}),mx=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiList"}),{children:s,className:a,component:o="ul",dense:c=!1,disablePadding:h=!1,subheader:d,...p}=i,g=O.useMemo(()=>({dense:c}),[c]),y={...i,component:o,dense:c,disablePadding:h},k=YL(y);return V.jsx(Kc.Provider,{value:g,children:V.jsxs($L,{as:o,className:Lt(k.root,a),ref:t,ownerState:y,...p,children:[d,s]})})});function XL(n){return Qi("MuiListItemButton",n)}const nh=Wi("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),qL=(n,e)=>{const{ownerState:t}=n;return[e.root,t.dense&&e.dense,t.alignItems==="flex-start"&&e.alignItemsFlexStart,t.divider&&e.divider,!t.disableGutters&&e.gutters]},JL=n=>{const{alignItems:e,classes:t,dense:i,disabled:s,disableGutters:a,divider:o,selected:c}=n,d=Ki({root:["root",i&&"dense",!a&&"gutters",o&&"divider",s&&"disabled",e==="flex-start"&&"alignItemsFlexStart",c&&"selected"]},XL,t);return{...t,...d}},QL=Ke(jh,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:qL})(wi(({theme:n})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:n.transitions.create("background-color",{duration:n.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(n.vars||n).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${nh.selected}`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,(n.vars||n).palette.action.selectedOpacity),[`&.${nh.focusVisible}`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.focusOpacity}`)}},[`&.${nh.selected}:hover`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:n.alpha((n.vars||n).palette.primary.main,(n.vars||n).palette.action.selectedOpacity)}},[`&.${nh.focusVisible}`]:{backgroundColor:(n.vars||n).palette.action.focus},[`&.${nh.disabled}`]:{opacity:(n.vars||n).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(n.vars||n).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),KL=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiListItemButton"}),{alignItems:s="center",autoFocus:a=!1,component:o="div",children:c,dense:h=!1,disableGutters:d=!1,divider:p=!1,focusVisibleClassName:g,selected:y=!1,className:k,..._}=i,w=O.useContext(Kc),T=O.useMemo(()=>({dense:h||w.dense||!1,alignItems:s,disableGutters:d}),[s,w.dense,h,d]),x=O.useRef(null);Ma(()=>{a&&x.current&&x.current.focus()},[a]);const E={...i,alignItems:s,dense:T.dense,disableGutters:d,divider:p,selected:y},N=JL(E),v=yn(x,t);return V.jsx(Kc.Provider,{value:T,children:V.jsx(QL,{ref:v,href:_.href||_.to,component:(_.href||_.to)&&o==="div"?"button":o,focusVisibleClassName:Lt(N.focusVisible,g),ownerState:E,className:Lt(N.root,k),..._,classes:N,children:c})})}),nB=Wi("MuiListItemIcon",["root","alignItemsFlexStart"]);function ZL(n){return Qi("MuiListItemText",n)}const Wc=Wi("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),jL=n=>{const{classes:e,inset:t,primary:i,secondary:s,dense:a}=n;return Ki({root:["root",t&&"inset",a&&"dense",i&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},ZL,e)},eA=Ke("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[{[`& .${Wc.primary}`]:e.primary},{[`& .${Wc.secondary}`]:e.secondary},e.root,t.inset&&e.inset,t.primary&&t.secondary&&e.multiline,t.dense&&e.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${$1.root}:where(& .${Wc.primary})`]:{display:"block"},[`.${$1.root}:where(& .${Wc.secondary})`]:{display:"block"},variants:[{props:({ownerState:n})=>n.primary&&n.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:n})=>n.inset,style:{paddingLeft:56}}]}),yx=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiListItemText"}),{children:s,className:a,disableTypography:o=!1,inset:c=!1,primary:h,primaryTypographyProps:d,secondary:p,secondaryTypographyProps:g,slots:y={},slotProps:k={},..._}=i,{dense:w}=O.useContext(Kc);let T=h??s,x=p;const E={...i,disableTypography:o,inset:c,primary:!!T,secondary:!!x,dense:w},N=jL(E),v={slots:y,slotProps:{primary:d,secondary:g,...k}},[L,A]=ua("root",{className:Lt(N.root,a),elementType:eA,externalForwardedProps:{...v,..._},ownerState:E,ref:t}),[D,H]=ua("primary",{className:N.primary,elementType:Ya,externalForwardedProps:v,ownerState:E}),[J,K]=ua("secondary",{className:N.secondary,elementType:Ya,externalForwardedProps:v,ownerState:E});return T!=null&&T.type!==Ya&&!o&&(T=V.jsx(D,{variant:w?"body2":"body1",component:H?.variant?void 0:"span",...H,children:T})),x!=null&&x.type!==Ya&&!o&&(x=V.jsx(J,{variant:"body2",color:"textSecondary",...K,children:x})),V.jsxs(L,{...A,children:[T,x]})});function n0(n,e,t){return n===e?n.firstChild:e&&e.nextElementSibling?e.nextElementSibling:t?null:n.firstChild}function aB(n,e,t){return n===e?t?n.firstChild:n.lastChild:e&&e.previousElementSibling?e.previousElementSibling:t?null:n.lastChild}function bx(n,e){if(e===void 0)return!0;let t=n.innerText;return t===void 0&&(t=n.textContent),t=t.trim().toLowerCase(),t.length===0?!1:e.repeating?t[0]===e.keys[0]:t.startsWith(e.keys.join(""))}function ah(n,e,t,i,s,a){let o=!1,c=s(n,e,e?t:!1);for(;c;){if(c===n.firstChild){if(o)return!1;o=!0}const h=i?!1:c.disabled||c.getAttribute("aria-disabled")==="true";if(!c.hasAttribute("tabindex")||!bx(c,a)||h)c=s(n,c,t);else return c.focus(),!0}return!1}const tA=O.forwardRef(function(e,t){const{actions:i,autoFocus:s=!1,autoFocusItem:a=!1,children:o,className:c,disabledItemsFocusable:h=!1,disableListWrap:d=!1,onKeyDown:p,variant:g="selectedMenu",...y}=e,k=O.useRef(null),_=O.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});Ma(()=>{s&&k.current.focus()},[s]),O.useImperativeHandle(i,()=>({adjustStyleForScrollbar:(N,{direction:v})=>{const L=!k.current.style.width;if(N.clientHeight<k.current.clientHeight&&L){const A=`${fx(io(N))}px`;k.current.style[v==="rtl"?"paddingLeft":"paddingRight"]=A,k.current.style.width=`calc(100% + ${A})`}return k.current}}),[]);const w=N=>{const v=k.current,L=N.key;if(N.ctrlKey||N.metaKey||N.altKey){p&&p(N);return}const D=fh(Ln(v));if(L==="ArrowDown")N.preventDefault(),ah(v,D,d,h,n0);else if(L==="ArrowUp")N.preventDefault(),ah(v,D,d,h,aB);else if(L==="Home")N.preventDefault(),ah(v,null,d,h,n0);else if(L==="End")N.preventDefault(),ah(v,null,d,h,aB);else if(L.length===1){const H=_.current,J=L.toLowerCase(),K=performance.now();H.keys.length>0&&(K-H.lastTime>500?(H.keys=[],H.repeating=!0,H.previousKeyMatched=!0):H.repeating&&J!==H.keys[0]&&(H.repeating=!1)),H.lastTime=K,H.keys.push(J);const Y=D&&!H.repeating&&bx(D,H);H.previousKeyMatched&&(Y||ah(v,D,!1,h,n0,H))?N.preventDefault():H.previousKeyMatched=!1}p&&p(N)},T=yn(k,t);let x=-1;O.Children.forEach(o,(N,v)=>{if(!O.isValidElement(N)){x===v&&(x+=1,x>=o.length&&(x=-1));return}N.props.disabled||(g==="selectedMenu"&&N.props.selected||x===-1)&&(x=v),x===v&&(N.props.disabled||N.props.muiSkipListHighlight||N.type.muiSkipListHighlight)&&(x+=1,x>=o.length&&(x=-1))});const E=O.Children.map(o,(N,v)=>{if(v===x){const L={};return a&&(L.autoFocus=!0),N.props.tabIndex===void 0&&g==="selectedMenu"&&(L.tabIndex=0),O.cloneElement(N,L)}return N});return V.jsx(mx,{role:"menu",ref:T,className:c,onKeyDown:w,tabIndex:s?0:-1,...y,children:E})});function iA(n){return Qi("MuiPopover",n)}Wi("MuiPopover",["root","paper"]);function rB(n,e){let t=0;return typeof e=="number"?t=e:e==="center"?t=n.height/2:e==="bottom"&&(t=n.height),t}function oB(n,e){let t=0;return typeof e=="number"?t=e:e==="center"?t=n.width/2:e==="right"&&(t=n.width),t}function lB(n){return[n.horizontal,n.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function vf(n){return typeof n=="function"?n():n}const sA=n=>{const{classes:e}=n;return Ki({root:["root"],paper:["paper"]},iA,e)},nA=Ke(ML,{name:"MuiPopover",slot:"Root"})({}),Sx=Ke(cg,{name:"MuiPopover",slot:"Paper"})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),aA=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiPopover"}),{action:s,anchorEl:a,anchorOrigin:o={vertical:"top",horizontal:"left"},anchorPosition:c,anchorReference:h="anchorEl",children:d,className:p,container:g,elevation:y=8,marginThreshold:k=16,open:_,PaperProps:w={},slots:T={},slotProps:x={},transformOrigin:E={vertical:"top",horizontal:"left"},TransitionComponent:N,transitionDuration:v="auto",TransitionProps:L={},disableScrollLock:A=!1,...D}=i,H=O.useRef(),J={...i,anchorOrigin:o,anchorReference:h,elevation:y,marginThreshold:k,transformOrigin:E,TransitionComponent:N,transitionDuration:v,TransitionProps:L},K=sA(J),Y=O.useCallback(()=>{if(h==="anchorPosition")return c;const xt=vf(a),Ut=(xt&&xt.nodeType===1?xt:Ln(H.current).body).getBoundingClientRect();return{top:Ut.top+rB(Ut,o.vertical),left:Ut.left+oB(Ut,o.horizontal)}},[a,o.horizontal,o.vertical,c,h]),C=O.useCallback(xt=>({vertical:rB(xt,E.vertical),horizontal:oB(xt,E.horizontal)}),[E.horizontal,E.vertical]),Q=O.useCallback(xt=>{const zt={width:xt.offsetWidth,height:xt.offsetHeight},Ut=C(zt);if(h==="none")return{top:null,left:null,transformOrigin:lB(Ut)};const yi=Y();let St=yi.top-Ut.vertical,ri=yi.left-Ut.horizontal;const Ms=St+zt.height,di=ri+zt.width,Ni=io(vf(a)),Mi=Ni.innerHeight-k,Ss=Ni.innerWidth-k;if(k!==null&&St<k){const Ci=St-k;St-=Ci,Ut.vertical+=Ci}else if(k!==null&&Ms>Mi){const Ci=Ms-Mi;St-=Ci,Ut.vertical+=Ci}if(k!==null&&ri<k){const Ci=ri-k;ri-=Ci,Ut.horizontal+=Ci}else if(di>Ss){const Ci=di-Ss;ri-=Ci,Ut.horizontal+=Ci}return{top:`${Math.round(St)}px`,left:`${Math.round(ri)}px`,transformOrigin:lB(Ut)}},[a,h,Y,C,k]),[Z,le]=O.useState(_),F=O.useCallback(()=>{const xt=H.current;if(!xt)return;const zt=Q(xt);zt.top!==null&&xt.style.setProperty("top",zt.top),zt.left!==null&&(xt.style.left=zt.left),xt.style.transformOrigin=zt.transformOrigin,le(!0)},[Q]);O.useEffect(()=>(A&&window.addEventListener("scroll",F),()=>window.removeEventListener("scroll",F)),[a,A,F]);const re=()=>{F()},_e=()=>{le(!1)};O.useEffect(()=>{_&&F()}),O.useImperativeHandle(s,()=>_?{updatePosition:()=>{F()}}:null,[_,F]),O.useEffect(()=>{if(!_)return;const xt=ZT(()=>{F()}),zt=io(vf(a));return zt.addEventListener("resize",xt),()=>{xt.clear(),zt.removeEventListener("resize",xt)}},[a,_,F]);let ve=v;const Ve={slots:{transition:N,...T},slotProps:{transition:L,paper:w,...x}},[R,te]=ua("transition",{elementType:R0,externalForwardedProps:Ve,ownerState:J,getSlotProps:xt=>({...xt,onEntering:(zt,Ut)=>{xt.onEntering?.(zt,Ut),re()},onExited:zt=>{xt.onExited?.(zt),_e()}}),additionalProps:{appear:!0,in:_}});v==="auto"&&!R.muiSupportAuto&&(ve=void 0);const we=g||(a?Ln(vf(a)).body:void 0),[Ee,{slots:qe,slotProps:je,...ze}]=ua("root",{ref:t,elementType:nA,externalForwardedProps:{...Ve,...D},shouldForwardComponentProp:!0,additionalProps:{slots:{backdrop:T.backdrop},slotProps:{backdrop:RD(typeof x.backdrop=="function"?x.backdrop(J):x.backdrop,{invisible:!0})},container:we,open:_},ownerState:J,className:Lt(K.root,p)}),[qt,Pt]=ua("paper",{ref:H,className:K.paper,elementType:Sx,externalForwardedProps:Ve,shouldForwardComponentProp:!0,additionalProps:{elevation:y,style:Z?void 0:{opacity:0}},ownerState:J});return V.jsx(Ee,{...ze,...!Uo(Ee)&&{slots:qe,slotProps:je,disableScrollLock:A},children:V.jsx(R,{...te,timeout:ve,children:V.jsx(qt,{...Pt,children:d})})})});function rA(n){return Qi("MuiMenu",n)}Wi("MuiMenu",["root","paper","list"]);const oA={vertical:"top",horizontal:"right"},lA={vertical:"top",horizontal:"left"},cA=n=>{const{classes:e}=n;return Ki({root:["root"],paper:["paper"],list:["list"]},rA,e)},uA=Ke(aA,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiMenu",slot:"Root"})({}),hA=Ke(Sx,{name:"MuiMenu",slot:"Paper"})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),dA=Ke(tA,{name:"MuiMenu",slot:"List"})({outline:0}),fA=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiMenu"}),{autoFocus:s=!0,children:a,className:o,disableAutoFocusItem:c=!1,MenuListProps:h={},onClose:d,open:p,PaperProps:g={},PopoverClasses:y,transitionDuration:k="auto",TransitionProps:{onEntering:_,...w}={},variant:T="selectedMenu",slots:x={},slotProps:E={},...N}=i,v=HT(),L={...i,autoFocus:s,disableAutoFocusItem:c,MenuListProps:h,onEntering:_,PaperProps:g,transitionDuration:k,TransitionProps:w,variant:T},A=cA(L),D=s&&!c&&p,H=O.useRef(null),J=(ve,Ve)=>{H.current&&H.current.adjustStyleForScrollbar(ve,{direction:v?"rtl":"ltr"}),_&&_(ve,Ve)},K=ve=>{ve.key==="Tab"&&(ve.preventDefault(),d&&d(ve,"tabKeyDown"))};let Y=-1;O.Children.map(a,(ve,Ve)=>{O.isValidElement(ve)&&(ve.props.disabled||(T==="selectedMenu"&&ve.props.selected||Y===-1)&&(Y=Ve))});const C={slots:x,slotProps:{list:h,transition:w,paper:g,...E}},Q=Gr({elementType:x.root,externalSlotProps:E.root,ownerState:L,className:[A.root,o]}),[Z,le]=ua("paper",{className:A.paper,elementType:hA,externalForwardedProps:C,shouldForwardComponentProp:!0,ownerState:L}),[F,re]=ua("list",{className:Lt(A.list,h.className),elementType:dA,shouldForwardComponentProp:!0,externalForwardedProps:C,getSlotProps:ve=>({...ve,onKeyDown:Ve=>{K(Ve),ve.onKeyDown?.(Ve)}}),ownerState:L}),_e=typeof C.slotProps.transition=="function"?C.slotProps.transition(L):C.slotProps.transition;return V.jsx(uA,{onClose:d,anchorOrigin:{vertical:"bottom",horizontal:v?"right":"left"},transformOrigin:v?oA:lA,slots:{root:x.root,paper:Z,backdrop:x.backdrop,...x.transition&&{transition:x.transition}},slotProps:{root:Q,paper:le,backdrop:typeof E.backdrop=="function"?E.backdrop(L):E.backdrop,transition:{..._e,onEntering:(...ve)=>{J(...ve),_e?.onEntering?.(...ve)}}},open:p,ref:t,transitionDuration:k,ownerState:L,...N,classes:y,children:V.jsx(F,{actions:H,autoFocus:s&&(Y===-1||c),autoFocusItem:D,variant:T,...re,children:a})})});function pA(n){return Qi("MuiMenuItem",n)}const rh=Wi("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),gA=(n,e)=>{const{ownerState:t}=n;return[e.root,t.dense&&e.dense,t.divider&&e.divider,!t.disableGutters&&e.gutters]},mA=n=>{const{disabled:e,dense:t,divider:i,disableGutters:s,selected:a,classes:o}=n,h=Ki({root:["root",t&&"dense",e&&"disabled",!s&&"gutters",i&&"divider",a&&"selected"]},pA,o);return{...o,...h}},yA=Ke(jh,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:gA})(wi(({theme:n})=>({...n.typography.body1,display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap","&:hover":{textDecoration:"none",backgroundColor:(n.vars||n).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${rh.selected}`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,(n.vars||n).palette.action.selectedOpacity),[`&.${rh.focusVisible}`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.focusOpacity}`)}},[`&.${rh.selected}:hover`]:{backgroundColor:n.alpha((n.vars||n).palette.primary.main,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:n.alpha((n.vars||n).palette.primary.main,(n.vars||n).palette.action.selectedOpacity)}},[`&.${rh.focusVisible}`]:{backgroundColor:(n.vars||n).palette.action.focus},[`&.${rh.disabled}`]:{opacity:(n.vars||n).palette.action.disabledOpacity},[`& + .${sB.root}`]:{marginTop:n.spacing(1),marginBottom:n.spacing(1)},[`& + .${sB.inset}`]:{marginLeft:52},[`& .${Wc.root}`]:{marginTop:0,marginBottom:0},[`& .${Wc.inset}`]:{paddingLeft:36},[`& .${nB.root}`]:{minWidth:36},variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(n.vars||n).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:e})=>!e.dense,style:{[n.breakpoints.up("sm")]:{minHeight:"auto"}}},{props:({ownerState:e})=>e.dense,style:{minHeight:32,paddingTop:4,paddingBottom:4,...n.typography.body2,[`& .${nB.root} svg`]:{fontSize:"1.25rem"}}}]}))),bA=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiMenuItem"}),{autoFocus:s=!1,component:a="li",dense:o=!1,divider:c=!1,disableGutters:h=!1,focusVisibleClassName:d,role:p="menuitem",tabIndex:g,className:y,...k}=i,_=O.useContext(Kc),w=O.useMemo(()=>({dense:o||_.dense||!1,disableGutters:h}),[_.dense,o,h]),T=O.useRef(null);Ma(()=>{s&&T.current&&T.current.focus()},[s]);const x={...i,dense:w.dense,divider:c,disableGutters:h},E=mA(i),N=yn(T,t);let v;return i.disabled||(v=g!==void 0?g:-1),V.jsx(Kc.Provider,{value:w,children:V.jsx(yA,{ref:N,role:p,tabIndex:v,component:a,focusVisibleClassName:Lt(E.focusVisible,d),className:Lt(E.root,y),...k,ownerState:x,classes:E})})});function SA(n){return Qi("MuiNativeSelect",n)}const kb=Wi("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),_A=n=>{const{classes:e,variant:t,disabled:i,multiple:s,open:a,error:o}=n,c={select:["select",t,i&&"disabled",s&&"multiple",o&&"error"],icon:["icon",`icon${bt(t)}`,a&&"iconOpen",i&&"disabled"]};return Ki(c,SA,e)},_x=Ke("select",{name:"MuiNativeSelect"})(({theme:n})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${kb.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(n.vars||n).palette.background.paper},variants:[{props:({ownerState:e})=>e.variant!=="filled"&&e.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(n.vars||n).shape.borderRadius,"&:focus":{borderRadius:(n.vars||n).shape.borderRadius},"&&&":{paddingRight:32}}}]})),kA=Ke(_x,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Aa,overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.select,e[t.variant],t.error&&e.error,{[`&.${kb.multiple}`]:e.multiple}]}})({}),kx=Ke("svg",{name:"MuiNativeSelect"})(({theme:n})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(n.vars||n).palette.action.active,[`&.${kb.disabled}`]:{color:(n.vars||n).palette.action.disabled},variants:[{props:({ownerState:e})=>e.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),wA=Ke(kx,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.icon,t.variant&&e[`icon${bt(t.variant)}`],t.open&&e.iconOpen]}})({}),BA=O.forwardRef(function(e,t){const{className:i,disabled:s,error:a,IconComponent:o,inputRef:c,variant:h="standard",...d}=e,p={...e,disabled:s,variant:h,error:a},g=_A(p);return V.jsxs(O.Fragment,{children:[V.jsx(kA,{ownerState:p,className:Lt(g.select,i),disabled:s,ref:c||t,...d}),e.multiple?null:V.jsx(wA,{as:o,ownerState:p,className:g.icon})]})});var cB;const TA=Ke("fieldset",{name:"MuiNotchedOutlined",shouldForwardProp:Aa})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),xA=Ke("legend",{name:"MuiNotchedOutlined",shouldForwardProp:Aa})(wi(({theme:n})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:e})=>!e.withLabel,style:{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})}},{props:({ownerState:e})=>e.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:e})=>e.withLabel&&e.notched,style:{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}}]})));function vA(n){const{children:e,classes:t,className:i,label:s,notched:a,...o}=n,c=s!=null&&s!=="",h={...n,notched:a,withLabel:c};return V.jsx(TA,{"aria-hidden":!0,className:i,ownerState:h,...o,children:V.jsx(xA,{ownerState:h,children:c?V.jsx("span",{children:s}):cB||(cB=V.jsx("span",{className:"notranslate","aria-hidden":!0,children:""}))})})}const NA=n=>{const{classes:e}=n,i=Ki({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},zM,e);return{...e,...i}},CA=Ke(dg,{shouldForwardProp:n=>Aa(n)||n==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:ug})(wi(({theme:n})=>{const e=n.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(n.vars||n).shape.borderRadius,[`&:hover .${rr.notchedOutline}`]:{borderColor:(n.vars||n).palette.text.primary},"@media (hover: none)":{[`&:hover .${rr.notchedOutline}`]:{borderColor:n.vars?n.alpha(n.vars.palette.common.onBackground,.23):e}},[`&.${rr.focused} .${rr.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(n.palette).filter(da()).map(([t])=>({props:{color:t},style:{[`&.${rr.focused} .${rr.notchedOutline}`]:{borderColor:(n.vars||n).palette[t].main}}})),{props:{},style:{[`&.${rr.error} .${rr.notchedOutline}`]:{borderColor:(n.vars||n).palette.error.main},[`&.${rr.disabled} .${rr.notchedOutline}`]:{borderColor:(n.vars||n).palette.action.disabled}}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:14}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:14}},{props:({ownerState:t})=>t.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:t,size:i})=>t.multiline&&i==="small",style:{padding:"8.5px 14px"}}]}})),EA=Ke(vA,{name:"MuiOutlinedInput",slot:"NotchedOutline"})(wi(({theme:n})=>{const e=n.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:n.vars?n.alpha(n.vars.palette.common.onBackground,.23):e}})),PA=Ke(fg,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:hg})(wi(({theme:n})=>({padding:"16.5px 14px",...!n.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:n.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:n.palette.mode==="light"?null:"#fff",caretColor:n.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...n.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[n.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:e})=>e.multiline,style:{padding:0}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}}]}))),wx=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiOutlinedInput"}),{components:s={},fullWidth:a=!1,inputComponent:o="input",label:c,multiline:h=!1,notched:d,slots:p={},slotProps:g={},type:y="text",...k}=i,_=NA(i),w=Sb(),T=bb({props:i,muiFormControl:w,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),x={...i,color:T.color||"primary",disabled:T.disabled,error:T.error,focused:T.focused,formControl:w,fullWidth:a,hiddenLabel:T.hiddenLabel,multiline:h,size:T.size,type:y},E=p.root??s.Root??CA,N=p.input??s.Input??PA,[v,L]=ua("notchedOutline",{elementType:EA,className:_.notchedOutline,shouldForwardComponentProp:!0,ownerState:x,externalForwardedProps:{slots:p,slotProps:g},additionalProps:{label:c!=null&&c!==""&&T.required?V.jsxs(O.Fragment,{children:[c,"","*"]}):c}});return V.jsx(_b,{slots:{root:E,input:N},slotProps:g,renderSuffix:A=>V.jsx(v,{...L,notched:typeof d<"u"?d:!!(A.startAdornment||A.filled||A.focused)}),fullWidth:a,inputComponent:o,multiline:h,ref:t,type:y,...k,classes:{..._,notchedOutline:null}})});wx.muiName="Input";const DA={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function Bx(n){return Qi("MuiSelect",n)}const oh=Wi("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var uB;const MA=Ke(_x,{name:"MuiSelect",slot:"Select",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[{[`&.${oh.select}`]:e.select},{[`&.${oh.select}`]:e[t.variant]},{[`&.${oh.error}`]:e.error},{[`&.${oh.multiple}`]:e.multiple}]}})({[`&.${oh.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),LA=Ke(kx,{name:"MuiSelect",slot:"Icon",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.icon,t.variant&&e[`icon${bt(t.variant)}`],t.open&&e.iconOpen]}})({}),AA=Ke("input",{shouldForwardProp:n=>lg(n)&&n!=="classes",name:"MuiSelect",slot:"NativeInput"})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function hB(n,e){return typeof e=="object"&&e!==null?n===e:String(n)===String(e)}function RA(n){return n==null||typeof n=="string"&&!n.trim()}const OA=n=>{const{classes:e,variant:t,disabled:i,multiple:s,open:a,error:o}=n,c={select:["select",t,i&&"disabled",s&&"multiple",o&&"error"],icon:["icon",`icon${bt(t)}`,a&&"iconOpen",i&&"disabled"],nativeInput:["nativeInput"]};return Ki(c,Bx,e)},FA=O.forwardRef(function(e,t){const{"aria-describedby":i,"aria-label":s,autoFocus:a,autoWidth:o,children:c,className:h,defaultOpen:d,defaultValue:p,disabled:g,displayEmpty:y,error:k=!1,IconComponent:_,inputRef:w,labelId:T,MenuProps:x={},multiple:E,name:N,onBlur:v,onChange:L,onClose:A,onFocus:D,onKeyDown:H,onMouseDown:J,onOpen:K,open:Y,readOnly:C,renderValue:Q,required:Z,SelectDisplayProps:le={},tabIndex:F,type:re,value:_e,variant:ve="standard",...Ve}=e,[R,te]=x0({controlled:_e,default:p,name:"Select"}),[we,Ee]=x0({controlled:Y,default:d,name:"Select"}),qe=O.useRef(null),je=O.useRef(null),[ze,qt]=O.useState(null),{current:Pt}=O.useRef(Y!=null),[xt,zt]=O.useState(),Ut=yn(t,w),yi=O.useCallback(dt=>{je.current=dt,dt&&qt(dt)},[]),St=ze?.parentNode;O.useImperativeHandle(Ut,()=>({focus:()=>{je.current.focus()},node:qe.current,value:R}),[R]),O.useEffect(()=>{d&&we&&ze&&!Pt&&(zt(o?null:St.clientWidth),je.current.focus())},[ze,o]),O.useEffect(()=>{a&&je.current.focus()},[a]),O.useEffect(()=>{if(!T)return;const dt=Ln(je.current).getElementById(T);if(dt){const Li=()=>{getSelection().isCollapsed&&je.current.focus()};return dt.addEventListener("click",Li),()=>{dt.removeEventListener("click",Li)}}},[T]);const ri=(dt,Li)=>{dt?K&&K(Li):A&&A(Li),Pt||(zt(o?null:St.clientWidth),Ee(dt))},Ms=dt=>{J?.(dt),dt.button===0&&(dt.preventDefault(),je.current.focus(),ri(!0,dt))},di=dt=>{ri(!1,dt)},Ni=O.Children.toArray(c),Mi=dt=>{const Li=Ni.find(_s=>_s.props.value===dt.target.value);Li!==void 0&&(te(Li.props.value),L&&L(dt,Li))},Ss=dt=>Li=>{let _s;if(Li.currentTarget.hasAttribute("tabindex")){if(E){_s=Array.isArray(R)?R.slice():[];const Nn=R.indexOf(dt.props.value);Nn===-1?_s.push(dt.props.value):_s.splice(Nn,1)}else _s=dt.props.value;if(dt.props.onClick&&dt.props.onClick(Li),R!==_s&&(te(_s),L)){const Nn=Li.nativeEvent||Li,wr=new Nn.constructor(Nn.type,Nn);Object.defineProperty(wr,"target",{writable:!0,value:{value:_s,name:N}}),L(wr,dt)}E||ri(!1,Li)}},Ci=dt=>{C||([" ","ArrowUp","ArrowDown","Enter"].includes(dt.key)&&(dt.preventDefault(),ri(!0,dt)),H?.(dt))},tt=ze!==null&&we,bn=dt=>{!tt&&v&&(Object.defineProperty(dt,"target",{writable:!0,value:{value:R,name:N}}),v(dt))};delete Ve["aria-invalid"];let Zt,He;const Me=[];let Ge=!1;(ux({value:R})||y)&&(Q?Zt=Q(R):Ge=!0);const pt=Ni.map(dt=>{if(!O.isValidElement(dt))return null;let Li;if(E){if(!Array.isArray(R))throw new Error(to(2));Li=R.some(_s=>hB(_s,dt.props.value)),Li&&Ge&&Me.push(dt.props.children)}else Li=hB(R,dt.props.value),Li&&Ge&&(He=dt.props.children);return O.cloneElement(dt,{"aria-selected":Li?"true":"false",onClick:Ss(dt),onKeyUp:_s=>{_s.key===" "&&_s.preventDefault(),dt.props.onKeyUp&&dt.props.onKeyUp(_s)},role:"option",selected:Li,value:void 0,"data-value":dt.props.value})});Ge&&(E?Me.length===0?Zt=null:Zt=Me.reduce((dt,Li,_s)=>(dt.push(Li),_s<Me.length-1&&dt.push(", "),dt),[]):Zt=He);let kt=xt;!o&&Pt&&ze&&(kt=St.clientWidth);let Et;typeof F<"u"?Et=F:Et=g?null:0;const Yt=le.id||(N?`mui-component-select-${N}`:void 0),ps={...e,variant:ve,value:R,open:tt,error:k},bi=OA(ps),Hi={...x.PaperProps,...typeof x.slotProps?.paper=="function"?x.slotProps.paper(ps):x.slotProps?.paper},Sn={...x.MenuListProps,...typeof x.slotProps?.list=="function"?x.slotProps.list(ps):x.slotProps?.list},Qs=rg();return V.jsxs(O.Fragment,{children:[V.jsx(MA,{as:"div",ref:yi,tabIndex:Et,role:"combobox","aria-controls":tt?Qs:void 0,"aria-disabled":g?"true":void 0,"aria-expanded":tt?"true":"false","aria-haspopup":"listbox","aria-label":s,"aria-labelledby":[T,Yt].filter(Boolean).join(" ")||void 0,"aria-describedby":i,"aria-required":Z?"true":void 0,"aria-invalid":k?"true":void 0,onKeyDown:Ci,onMouseDown:g||C?null:Ms,onBlur:bn,onFocus:D,...le,ownerState:ps,className:Lt(le.className,bi.select,h),id:Yt,children:RA(Zt)?uB||(uB=V.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):Zt}),V.jsx(AA,{"aria-invalid":k,value:Array.isArray(R)?R.join(","):R,name:N,ref:qe,"aria-hidden":!0,onChange:Mi,tabIndex:-1,disabled:g,className:bi.nativeInput,autoFocus:a,required:Z,...Ve,ownerState:ps}),V.jsx(LA,{as:_,className:bi.icon,ownerState:ps}),V.jsx(fA,{id:`menu-${N||""}`,anchorEl:St,open:tt,onClose:di,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...x,slotProps:{...x.slotProps,list:{"aria-labelledby":T,role:"listbox","aria-multiselectable":E?"true":void 0,disableListWrap:!0,id:Qs,...Sn},paper:{...Hi,style:{minWidth:kt,...Hi!=null?Hi.style:null}}},children:pt})]})}),IA=n=>{const{classes:e}=n,i=Ki({root:["root"]},Bx,e);return{...e,...i}},wb={name:"MuiSelect",slot:"Root",shouldForwardProp:n=>Aa(n)&&n!=="variant"},WA=Ke(gx,wb)(""),VA=Ke(wx,wb)(""),HA=Ke(px,wb)(""),Tx=O.forwardRef(function(e,t){const i=Zi({name:"MuiSelect",props:e}),{autoWidth:s=!1,children:a,classes:o={},className:c,defaultOpen:h=!1,displayEmpty:d=!1,IconComponent:p=UM,id:g,input:y,inputProps:k,label:_,labelId:w,MenuProps:T,multiple:x=!1,native:E=!1,onClose:N,onOpen:v,open:L,renderValue:A,SelectDisplayProps:D,variant:H="outlined",...J}=i,K=E?BA:FA,Y=Sb(),C=bb({props:i,muiFormControl:Y,states:["variant","error"]}),Q=C.variant||H,Z={...i,variant:Q,classes:o},le=IA(Z),{root:F,...re}=le,_e=y||{standard:V.jsx(WA,{ownerState:Z}),outlined:V.jsx(VA,{label:_,ownerState:Z}),filled:V.jsx(HA,{ownerState:Z})}[Q],ve=yn(t,ed(_e));return V.jsx(O.Fragment,{children:O.cloneElement(_e,{inputComponent:K,inputProps:{children:a,error:C.error,IconComponent:p,variant:Q,type:void 0,multiple:x,...E?{id:g}:{autoWidth:s,defaultOpen:h,displayEmpty:d,labelId:w,MenuProps:T,onClose:N,onOpen:v,open:L,renderValue:A,SelectDisplayProps:{id:g,...D}},...k,classes:k?rn(re,k.classes):re,...y?y.props.inputProps:{}},...(x&&E||d)&&Q==="outlined"?{notched:!0}:{},ref:ve,className:Lt(_e.props.className,c,le.root),...!y&&{variant:Q},...J})})});Tx.muiName="Select";function zA(n,e,t=(i,s)=>i===s){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}const GA=2;function Ac(n,e,t,i,s){return t===1?Math.min(n+e,s):Math.max(n-e,i)}function xx(n,e){return n-e}function dB(n,e){const{index:t}=n.reduce((i,s,a)=>{const o=Math.abs(e-s);return i===null||o<i.distance||o===i.distance?{distance:o,index:a}:i},null)??{};return t}function Nf(n,e){if(e.current!==void 0&&n.changedTouches){const t=n;for(let i=0;i<t.changedTouches.length;i+=1){const s=t.changedTouches[i];if(s.identifier===e.current)return{x:s.clientX,y:s.clientY}}return!1}return{x:n.clientX,y:n.clientY}}function tp(n,e,t){return(n-e)*100/(t-e)}function UA(n,e,t){return(t-e)*n+e}function YA(n){if(Math.abs(n)<1){const t=n.toExponential().split("e-"),i=t[0].split(".")[1];return(i?i.length:0)+parseInt(t[1],10)}const e=n.toString().split(".")[1];return e?e.length:0}function $A(n,e,t){const i=Math.round((n-t)/e)*e+t;return Number(i.toFixed(YA(e)))}function fB({values:n,newValue:e,index:t}){const i=n.slice();return i[t]=e,i.sort(xx)}function Cf({sliderRef:n,activeIndex:e,setActive:t}){const i=Ln(n.current);(!n.current?.contains(i.activeElement)||Number(i?.activeElement?.getAttribute("data-index"))!==e)&&n.current?.querySelector(`[type="range"][data-index="${e}"]`).focus(),t&&t(e)}function Ef(n,e){return typeof n=="number"&&typeof e=="number"?n===e:typeof n=="object"&&typeof e=="object"?zA(n,e):!1}const XA={horizontal:{offset:n=>({left:`${n}%`}),leap:n=>({width:`${n}%`})},"horizontal-reverse":{offset:n=>({right:`${n}%`}),leap:n=>({width:`${n}%`})},vertical:{offset:n=>({bottom:`${n}%`}),leap:n=>({height:`${n}%`})}},qA=n=>n;let Pf;function pB(){return Pf===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?Pf=CSS.supports("touch-action","none"):Pf=!0),Pf}function JA(n){const{"aria-labelledby":e,defaultValue:t,disabled:i=!1,disableSwap:s=!1,isRtl:a=!1,marks:o=!1,max:c=100,min:h=0,name:d,onChange:p,onChangeCommitted:g,orientation:y="horizontal",rootRef:k,scale:_=qA,step:w=1,shiftStep:T=10,tabIndex:x,value:E}=n,N=O.useRef(void 0),[v,L]=O.useState(-1),[A,D]=O.useState(-1),[H,J]=O.useState(!1),K=O.useRef(0),Y=O.useRef(null),[C,Q]=x0({controlled:E,default:t??h,name:"Slider"}),Z=p&&((He,Me,Ge)=>{const pt=He.nativeEvent||He,kt=new pt.constructor(pt.type,pt);Object.defineProperty(kt,"target",{writable:!0,value:{value:Me,name:d}}),Y.current=Me,p(kt,Me,Ge)}),le=Array.isArray(C);let F=le?C.slice().sort(xx):[C];F=F.map(He=>He==null?h:Oc(He,h,c));const re=o===!0&&w!==null?[...Array(Math.floor((c-h)/w)+1)].map((He,Me)=>({value:h+w*Me})):o||[],_e=re.map(He=>He.value),[ve,Ve]=O.useState(-1),R=O.useRef(null),te=yn(k,R),we=He=>Me=>{const Ge=Number(Me.currentTarget.getAttribute("data-index"));jf(Me.target)&&Ve(Ge),D(Ge),He?.onFocus?.(Me)},Ee=He=>Me=>{jf(Me.target)||Ve(-1),D(-1),He?.onBlur?.(Me)},qe=(He,Me)=>{const Ge=Number(He.currentTarget.getAttribute("data-index")),pt=F[Ge],kt=_e.indexOf(pt);let Et=Me;if(re&&w==null){const Yt=_e[_e.length-1];Et>=Yt?Et=Yt:Et<=_e[0]?Et=_e[0]:Et=Et<pt?_e[kt-1]:_e[kt+1]}if(Et=Oc(Et,h,c),le){s&&(Et=Oc(Et,F[Ge-1]||-1/0,F[Ge+1]||1/0));const Yt=Et;Et=fB({values:F,newValue:Et,index:Ge});let ps=Ge;s||(ps=Et.indexOf(Yt)),Cf({sliderRef:R,activeIndex:ps})}Q(Et),Ve(Ge),Z&&!Ef(Et,C)&&Z(He,Et,Ge),g&&g(He,Y.current??Et)},je=He=>Me=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(Me.key)){Me.preventDefault();const Ge=Number(Me.currentTarget.getAttribute("data-index")),pt=F[Ge];let kt=null;if(w!=null){const Et=Me.shiftKey?T:w;switch(Me.key){case"ArrowUp":kt=Ac(pt,Et,1,h,c);break;case"ArrowRight":kt=Ac(pt,Et,a?-1:1,h,c);break;case"ArrowDown":kt=Ac(pt,Et,-1,h,c);break;case"ArrowLeft":kt=Ac(pt,Et,a?1:-1,h,c);break;case"PageUp":kt=Ac(pt,T,1,h,c);break;case"PageDown":kt=Ac(pt,T,-1,h,c);break;case"Home":kt=h;break;case"End":kt=c;break}}else if(re){const Et=_e[_e.length-1],Yt=_e.indexOf(pt),ps=[a?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],bi=[a?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];ps.includes(Me.key)?Yt===0?kt=_e[0]:kt=_e[Yt-1]:bi.includes(Me.key)&&(Yt===_e.length-1?kt=Et:kt=_e[Yt+1])}kt!=null&&qe(Me,kt)}He?.onKeyDown?.(Me)};Ma(()=>{i&&R.current.contains(document.activeElement)&&document.activeElement?.blur()},[i]),i&&v!==-1&&L(-1),i&&ve!==-1&&Ve(-1);const ze=He=>Me=>{He.onChange?.(Me),qe(Me,Me.target.valueAsNumber)},qt=O.useRef(void 0);let Pt=y;a&&y==="horizontal"&&(Pt+="-reverse");const xt=({finger:He,move:Me=!1})=>{const{current:Ge}=R,{width:pt,height:kt,bottom:Et,left:Yt}=Ge.getBoundingClientRect();let ps;Pt.startsWith("vertical")?ps=(Et-He.y)/kt:ps=(He.x-Yt)/pt,Pt.includes("-reverse")&&(ps=1-ps);let bi;if(bi=UA(ps,h,c),w)bi=$A(bi,w,h);else{const Sn=dB(_e,bi);bi=_e[Sn]}bi=Oc(bi,h,c);let Hi=0;if(le){Me?Hi=qt.current:Hi=dB(F,bi),s&&(bi=Oc(bi,F[Hi-1]||-1/0,F[Hi+1]||1/0));const Sn=bi;bi=fB({values:F,newValue:bi,index:Hi}),s&&Me||(Hi=bi.indexOf(Sn),qt.current=Hi)}return{newValue:bi,activeIndex:Hi}},zt=Sr(He=>{const Me=Nf(He,N);if(!Me)return;if(K.current+=1,He.type==="mousemove"&&He.buttons===0){Ut(He);return}const{newValue:Ge,activeIndex:pt}=xt({finger:Me,move:!0});Cf({sliderRef:R,activeIndex:pt,setActive:L}),Q(Ge),!H&&K.current>GA&&J(!0),Z&&!Ef(Ge,C)&&Z(He,Ge,pt)}),Ut=Sr(He=>{const Me=Nf(He,N);if(J(!1),!Me)return;const{newValue:Ge}=xt({finger:Me,move:!0});L(-1),He.type==="touchend"&&D(-1),g&&g(He,Y.current??Ge),N.current=void 0,St()}),yi=Sr(He=>{if(i)return;pB()||He.preventDefault();const Me=He.changedTouches[0];Me!=null&&(N.current=Me.identifier);const Ge=Nf(He,N);if(Ge!==!1){const{newValue:kt,activeIndex:Et}=xt({finger:Ge});Cf({sliderRef:R,activeIndex:Et,setActive:L}),Q(kt),Z&&!Ef(kt,C)&&Z(He,kt,Et)}K.current=0;const pt=Ln(R.current);pt.addEventListener("touchmove",zt,{passive:!0}),pt.addEventListener("touchend",Ut,{passive:!0})}),St=O.useCallback(()=>{const He=Ln(R.current);He.removeEventListener("mousemove",zt),He.removeEventListener("mouseup",Ut),He.removeEventListener("touchmove",zt),He.removeEventListener("touchend",Ut)},[Ut,zt]);O.useEffect(()=>{const{current:He}=R;return He.addEventListener("touchstart",yi,{passive:pB()}),()=>{He.removeEventListener("touchstart",yi),St()}},[St,yi]),O.useEffect(()=>{i&&St()},[i,St]);const ri=He=>Me=>{if(He.onMouseDown?.(Me),i||Me.defaultPrevented||Me.button!==0)return;Me.preventDefault();const Ge=Nf(Me,N);if(Ge!==!1){const{newValue:kt,activeIndex:Et}=xt({finger:Ge});Cf({sliderRef:R,activeIndex:Et,setActive:L}),Q(kt),Z&&!Ef(kt,C)&&Z(Me,kt,Et)}K.current=0;const pt=Ln(R.current);pt.addEventListener("mousemove",zt,{passive:!0}),pt.addEventListener("mouseup",Ut)},Ms=tp(le?F[0]:h,h,c),di=tp(F[F.length-1],h,c)-Ms,Ni=(He={})=>{const Me=Sh(He),Ge={onMouseDown:ri(Me||{})},pt={...Me,...Ge};return{...He,ref:te,...pt}},Mi=He=>Me=>{He.onMouseOver?.(Me);const Ge=Number(Me.currentTarget.getAttribute("data-index"));D(Ge)},Ss=He=>Me=>{He.onMouseLeave?.(Me),D(-1)},Ci=(He={})=>{const Me=Sh(He),Ge={onMouseOver:Mi(Me||{}),onMouseLeave:Ss(Me||{})};return{...He,...Me,...Ge}},tt=He=>({pointerEvents:v!==-1&&v!==He?"none":void 0});let bn;return y==="vertical"&&(bn=a?"vertical-rl":"vertical-lr"),{active:v,axis:Pt,axisProps:XA,dragging:H,focusedThumbIndex:ve,getHiddenInputProps:(He={})=>{const Me=Sh(He),Ge={onChange:ze(Me||{}),onFocus:we(Me||{}),onBlur:Ee(Me||{}),onKeyDown:je(Me||{})},pt={...Me,...Ge};return{tabIndex:x,"aria-labelledby":e,"aria-orientation":y,"aria-valuemax":_(c),"aria-valuemin":_(h),name:d,type:"range",min:n.min,max:n.max,step:n.step===null&&n.marks?"any":n.step??void 0,disabled:i,...He,...pt,style:{...DA,direction:a?"rtl":"ltr",width:"100%",height:"100%",writingMode:bn}}},getRootProps:Ni,getThumbProps:Ci,marks:re,open:A,range:le,rootRef:te,trackLeap:di,trackOffset:Ms,values:F,getThumbStyle:tt}}const QA=n=>!n||!Uo(n);function KA(n){return Qi("MuiSlider",n)}const Pa=Wi("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),ZA=n=>{const{open:e}=n;return{offset:Lt(e&&Pa.valueLabelOpen),circle:Pa.valueLabelCircle,label:Pa.valueLabelLabel}};function jA(n){const{children:e,className:t,value:i}=n,s=ZA(n);return e?O.cloneElement(e,{className:e.props.className},V.jsxs(O.Fragment,{children:[e.props.children,V.jsx("span",{className:Lt(s.offset,t),"aria-hidden":!0,children:V.jsx("span",{className:s.circle,children:V.jsx("span",{className:s.label,children:i})})})]})):null}function gB(n){return n}const e5=Ke("span",{name:"MuiSlider",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[`color${bt(t.color)}`],t.size!=="medium"&&e[`size${bt(t.size)}`],t.marked&&e.marked,t.orientation==="vertical"&&e.vertical,t.track==="inverted"&&e.trackInverted,t.track===!1&&e.trackFalse]}})(wi(({theme:n})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${Pa.disabled}`]:{pointerEvents:"none",cursor:"default",color:(n.vars||n).palette.grey[400]},[`&.${Pa.dragging}`]:{[`& .${Pa.thumb}, & .${Pa.track}`]:{transition:"none"}},variants:[...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{color:(n.vars||n).palette[e].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),t5=Ke("span",{name:"MuiSlider",slot:"Rail"})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),i5=Ke("span",{name:"MuiSlider",slot:"Track"})(wi(({theme:n})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:n.transitions.create(["left","width","bottom","height"],{duration:n.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e,track:"inverted"},style:{...n.vars?{backgroundColor:n.vars.palette.Slider[`${e}Track`],borderColor:n.vars.palette.Slider[`${e}Track`]}:{backgroundColor:n.lighten(n.palette[e].main,.62),borderColor:n.lighten(n.palette[e].main,.62),...n.applyStyles("dark",{backgroundColor:n.darken(n.palette[e].main,.5)}),...n.applyStyles("dark",{borderColor:n.darken(n.palette[e].main,.5)})}}}))]}))),s5=Ke("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.thumb,e[`thumbColor${bt(t.color)}`],t.size!=="medium"&&e[`thumbSize${bt(t.size)}`]]}})(wi(({theme:n})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:n.transitions.create(["box-shadow","left","bottom"],{duration:n.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(n.vars||n).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${Pa.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{[`&:hover, &.${Pa.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${n.alpha((n.vars||n).palette[e].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${Pa.active}`]:{boxShadow:`0px 0px 0px 14px ${n.alpha((n.vars||n).palette[e].main,.16)}`}}}))]}))),n5=Ke(jA,{name:"MuiSlider",slot:"ValueLabel"})(wi(({theme:n})=>({zIndex:1,whiteSpace:"nowrap",...n.typography.body2,fontWeight:500,transition:n.transitions.create(["transform"],{duration:n.transitions.duration.shortest}),position:"absolute",backgroundColor:(n.vars||n).palette.grey[600],borderRadius:2,color:(n.vars||n).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${Pa.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${Pa.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:n.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),a5=Ke("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:n=>lg(n)&&n!=="markActive",overridesResolver:(n,e)=>{const{markActive:t}=n;return[e.mark,t&&e.markActive]}})(wi(({theme:n})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(n.vars||n).palette.background.paper,opacity:.8}}]}))),r5=Ke("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:n=>lg(n)&&n!=="markLabelActive"})(wi(({theme:n})=>({...n.typography.body2,color:(n.vars||n).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(n.vars||n).palette.text.primary}}]}))),o5=n=>{const{disabled:e,dragging:t,marked:i,orientation:s,track:a,classes:o,color:c,size:h}=n,d={root:["root",e&&"disabled",t&&"dragging",i&&"marked",s==="vertical"&&"vertical",a==="inverted"&&"trackInverted",a===!1&&"trackFalse",c&&`color${bt(c)}`,h&&`size${bt(h)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",e&&"disabled",h&&`thumbSize${bt(h)}`,c&&`thumbColor${bt(c)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return Ki(d,KA,o)},l5=({children:n})=>n,c5=O.forwardRef(function(e,t){const i=Zi({props:e,name:"MuiSlider"}),s=HT(),{"aria-label":a,"aria-valuetext":o,"aria-labelledby":c,component:h="span",components:d={},componentsProps:p={},color:g="primary",classes:y,className:k,disableSwap:_=!1,disabled:w=!1,getAriaLabel:T,getAriaValueText:x,marks:E=!1,max:N=100,min:v=0,name:L,onChange:A,onChangeCommitted:D,orientation:H="horizontal",shiftStep:J=10,size:K="medium",step:Y=1,scale:C=gB,slotProps:Q,slots:Z,tabIndex:le,track:F="normal",value:re,valueLabelDisplay:_e="off",valueLabelFormat:ve=gB,...Ve}=i,R={...i,isRtl:s,max:N,min:v,classes:y,disabled:w,disableSwap:_,orientation:H,marks:E,color:g,size:K,step:Y,shiftStep:J,scale:C,track:F,valueLabelDisplay:_e,valueLabelFormat:ve},{axisProps:te,getRootProps:we,getHiddenInputProps:Ee,getThumbProps:qe,open:je,active:ze,axis:qt,focusedThumbIndex:Pt,range:xt,dragging:zt,marks:Ut,values:yi,trackOffset:St,trackLeap:ri,getThumbStyle:Ms}=JA({...R,rootRef:t});R.marked=Ut.length>0&&Ut.some(os=>os.label),R.dragging=zt,R.focusedThumbIndex=Pt;const di=o5(R),Ni=Z?.root??d.Root??e5,Mi=Z?.rail??d.Rail??t5,Ss=Z?.track??d.Track??i5,Ci=Z?.thumb??d.Thumb??s5,tt=Z?.valueLabel??d.ValueLabel??n5,bn=Z?.mark??d.Mark??a5,Zt=Z?.markLabel??d.MarkLabel??r5,He=Z?.input??d.Input??"input",Me=Q?.root??p.root,Ge=Q?.rail??p.rail,pt=Q?.track??p.track,kt=Q?.thumb??p.thumb,Et=Q?.valueLabel??p.valueLabel,Yt=Q?.mark??p.mark,ps=Q?.markLabel??p.markLabel,bi=Q?.input??p.input,Hi=Gr({elementType:Ni,getSlotProps:we,externalSlotProps:Me,externalForwardedProps:Ve,additionalProps:{...QA(Ni)&&{as:h}},ownerState:{...R,...Me?.ownerState},className:[di.root,k]}),Sn=Gr({elementType:Mi,externalSlotProps:Ge,ownerState:R,className:di.rail}),Qs=Gr({elementType:Ss,externalSlotProps:pt,additionalProps:{style:{...te[qt].offset(St),...te[qt].leap(ri)}},ownerState:{...R,...pt?.ownerState},className:di.track}),dt=Gr({elementType:Ci,getSlotProps:qe,externalSlotProps:kt,ownerState:{...R,...kt?.ownerState},className:di.thumb}),Li=Gr({elementType:tt,externalSlotProps:Et,ownerState:{...R,...Et?.ownerState},className:di.valueLabel}),_s=Gr({elementType:bn,externalSlotProps:Yt,ownerState:R,className:di.mark}),Nn=Gr({elementType:Zt,externalSlotProps:ps,ownerState:R,className:di.markLabel}),wr=Gr({elementType:He,getSlotProps:Ee,externalSlotProps:bi,ownerState:R});return V.jsxs(Ni,{...Hi,children:[V.jsx(Mi,{...Sn}),V.jsx(Ss,{...Qs}),Ut.filter(os=>os.value>=v&&os.value<=N).map((os,ls)=>{const oo=tp(os.value,v,N),er=te[qt].offset(oo);let Ra;return F===!1?Ra=yi.includes(os.value):Ra=F==="normal"&&(xt?os.value>=yi[0]&&os.value<=yi[yi.length-1]:os.value<=yi[0])||F==="inverted"&&(xt?os.value<=yi[0]||os.value>=yi[yi.length-1]:os.value>=yi[0]),V.jsxs(O.Fragment,{children:[V.jsx(bn,{"data-index":ls,..._s,...!Uo(bn)&&{markActive:Ra},style:{...er,..._s.style},className:Lt(_s.className,Ra&&di.markActive)}),os.label!=null?V.jsx(Zt,{"aria-hidden":!0,"data-index":ls,...Nn,...!Uo(Zt)&&{markLabelActive:Ra},style:{...er,...Nn.style},className:Lt(di.markLabel,Nn.className,Ra&&di.markLabelActive),children:os.label}):null]},ls)}),yi.map((os,ls)=>{const oo=tp(os,v,N),er=te[qt].offset(oo),Ra=_e==="off"?l5:tt;return V.jsx(Ra,{...!Uo(Ra)&&{valueLabelFormat:ve,valueLabelDisplay:_e,value:typeof ve=="function"?ve(C(os),ls):ve,index:ls,open:je===ls||ze===ls||_e==="on",disabled:w},...Li,children:V.jsx(Ci,{"data-index":ls,...dt,className:Lt(di.thumb,dt.className,ze===ls&&di.active,Pt===ls&&di.focusVisible),style:{...er,...Ms(ls),...dt.style},children:V.jsx(He,{"data-index":ls,"aria-label":T?T(ls):a,"aria-valuenow":C(os),"aria-labelledby":c,"aria-valuetext":x?x(C(os),ls):o,value:yi[ls],...wr})})},ls)})]})}),sa=$P({createStyledComponent:Ke("div",{name:"MuiStack",slot:"Root"}),useThemeProps:n=>Zi({props:n,name:"MuiStack"})});function u5(n){return Qi("MuiToggleButton",n)}const a0=Wi("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),h5=O.createContext({}),d5=O.createContext(void 0);function f5(n,e){return e===void 0||n===void 0?!1:Array.isArray(e)?e.includes(n):n===e}const p5=n=>{const{classes:e,fullWidth:t,selected:i,disabled:s,size:a,color:o}=n,c={root:["root",i&&"selected",s&&"disabled",t&&"fullWidth",`size${bt(a)}`,o]};return Ki(c,u5,e)},g5=Ke(jh,{name:"MuiToggleButton",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n;return[e.root,e[`size${bt(t.size)}`]]}})(wi(({theme:n})=>({...n.typography.button,borderRadius:(n.vars||n).shape.borderRadius,padding:11,border:`1px solid ${(n.vars||n).palette.divider}`,color:(n.vars||n).palette.action.active,[`&.${a0.disabled}`]:{color:(n.vars||n).palette.action.disabled,border:`1px solid ${(n.vars||n).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:n.alpha((n.vars||n).palette.text.primary,(n.vars||n).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${a0.selected}`]:{color:(n.vars||n).palette.text.primary,backgroundColor:n.alpha((n.vars||n).palette.text.primary,(n.vars||n).palette.action.selectedOpacity),"&:hover":{backgroundColor:n.alpha((n.vars||n).palette.text.primary,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:n.alpha((n.vars||n).palette.text.primary,(n.vars||n).palette.action.selectedOpacity)}}}}},...Object.entries(n.palette).filter(da()).map(([e])=>({props:{color:e},style:{[`&.${a0.selected}`]:{color:(n.vars||n).palette[e].main,backgroundColor:n.alpha((n.vars||n).palette[e].main,(n.vars||n).palette.action.selectedOpacity),"&:hover":{backgroundColor:n.alpha((n.vars||n).palette[e].main,`${(n.vars||n).palette.action.selectedOpacity} + ${(n.vars||n).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:n.alpha((n.vars||n).palette[e].main,(n.vars||n).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:n.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:n.typography.pxToRem(15)}}]}))),pg=O.forwardRef(function(e,t){const{value:i,...s}=O.useContext(h5),a=O.useContext(d5),o=Jc({...s,selected:f5(e.value,i)},e),c=Zi({props:o,name:"MuiToggleButton"}),{children:h,className:d,color:p="standard",disabled:g=!1,disableFocusRipple:y=!1,fullWidth:k=!1,onChange:_,onClick:w,selected:T,size:x="medium",value:E,...N}=c,v={...c,color:p,disabled:g,disableFocusRipple:y,fullWidth:k,size:x},L=p5(v),A=H=>{w&&(w(H,E),H.defaultPrevented)||_&&_(H,E)},D=a||"";return V.jsx(g5,{className:Lt(s.className,L.root,d,D),disabled:g,focusRipple:!y,ref:t,onClick:A,onChange:_,value:E,ownerState:v,"aria-pressed":T,...N,children:h})}),m5="#aa0000",y5=og({palette:{mode:"light",primary:{main:m5},secondary:{main:"#00aaaa"},background:{default:"#fff",paper:"#fff"}},components:{MuiAppBar:{styleOverrides:{root:{backgroundColor:"#ebebebff",color:"black"}}}}}),b5=fa(V.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"})),S5=fa(V.jsx("path",{d:"M8 5v14l11-7z"})),_5=fa(V.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),k5=fa(V.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"})),mB=fa(V.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"})),vx=fa(V.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"})),Nx=fa(V.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63m2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71M4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9zM12 4 9.91 6.09 12 8.18z"})),Cx=fa(V.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"})),Ex=fa(V.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"})),w5=fa(V.jsx("path",{d:"M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"}));function B5({tracks:n,track:e}){function t(a,o){a.stopPropagation(),e.volume=o}function i(a){a.stopPropagation()}function s(){if(e.isSolo)return!1;for(let a of n)if(a.isSolo&&a!==e)return!0;return!1}return V.jsxs(sa,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[V.jsx(yx,{sx:{flex:1},children:e.name}),V.jsx(Wh,{size:"small",edge:"end",onClick:a=>{a.stopPropagation(),e.toggleSolo()},children:e.isSolo?V.jsx(Ex,{}):V.jsx(Cx,{})}),V.jsx(Wh,{size:"small",edge:"end",onClick:a=>{a.stopPropagation(),e.toggleMute()},children:e.isMute||s()?V.jsx(Nx,{}):V.jsx(vx,{})}),V.jsx(c5,{value:e.volume,max:16,onChange:t,onMouseDown:i,onTouchStart:i,style:{width:100},onClick:i,disabled:e.isMute}),V.jsx(Ya,{variant:"caption",width:"2ch",children:e.volume})]})}function Px(){return V.jsx(Ic,{sx:{"@media (max-height:500px)":{display:"none"}},children:V.jsx("img",{src:"assets/logo.svg",style:{display:"block",width:212,height:88}})})}function Dx({tabLib:n,onLoadTab:e,sx:t={}}){const i=O.useRef(null),[s,a]=O.useState(!1);function o(p){e(p)}function c(){i.current?.click()}function h(p){const g=p.target.files?.[0];if(!g)return;const y=new FileReader;y.onload=k=>{a(!1),e(k.target.result)},y.onerror=function(){a(!1)},a(!0),y.readAsArrayBuffer(g)}function d(p){return p.replace(/\.[^.]+$/,"")}return V.jsxs(sa,{alignItems:"center",spacing:1,padding:1,sx:t,children:[V.jsx(Px,{}),V.jsx(cg,{elevation:2,sx:{height:"100%",width:"100%",minHeight:100,display:"flex",flexDirection:"column",overflow:"hidden"},children:V.jsx(mx,{sx:{flexGrow:1,overflowY:"auto",minHeight:0,"& ul":{padding:0}},subheader:V.jsx("li",{}),disabled:s,children:n.map((p,g)=>V.jsxs("li",{children:[V.jsxs("ul",{children:[V.jsx(D0,{sx:{fontWeight:"bold"},color:"primary",children:p.band.toUpperCase()}),p.tabs.map(y=>V.jsx(KL,{onClick:()=>o(`${p.band} - ${y}`),disabled:s,children:V.jsx(yx,{primary:d(y)})},`${p.band}${y}`))]}),g<n.length-1&&V.jsx(L0,{sx:{mt:1,p:0,listStyle:"none"}})]},p.band))})}),V.jsxs(Ic,{children:[V.jsx("input",{type:"file",ref:i,style:{display:"none"},onChange:h,accept:".gp,.gp3,.gp4,.gp5,.gpx"}),V.jsx(oL,{variant:"outlined",onClick:c,disabled:s,children:"Load Tab File (.gp, .gpx, .gp3+)"})]})]})}Dx.propTypes={onLoadTab:ra.func.isRequired,tabLib:ra.array.isRequired,sx:ra.object};const T5=fa(V.jsx("path",{d:"m14 7-5 5 5 5z"})),x5=fa(V.jsx("path",{d:"m10 17 5-5-5-5z"}));function Mx({title:n,speed:e,maxSpeed:t,onChange:i,disabled:s=!1}){function a(o){return Math.max(.5,Math.min(t,o))}return V.jsxs(sa,{alignItems:"center",children:[V.jsx(cg,{variant:"outlined",sx:{bgcolor:"inherit"},children:V.jsxs(sa,{direction:"row",alignItems:"center",borderRadius:2,px:1,py:.5,children:[V.jsx(Wh,{onClick:()=>i(a(e-.05)),disabled:s,children:V.jsx(T5,{})}),V.jsxs(Ya,{minWidth:40,textAlign:"center",children:[(e*100).toFixed(0),"%"]}),V.jsx(Wh,{onClick:()=>i(a(e+.05)),disabled:s,children:V.jsx(x5,{})})]})}),V.jsx(Ya,{variant:"caption",children:n})]})}Mx.propTypes={title:ra.string.isRequired,speed:ra.number.isRequired,maxSpeed:ra.number.isRequired,onChange:ra.func.isRequired};function Uf({title:n=null,selected:e=!1,onChange:t,iconOn:i,iconOff:s=null,sx:a={},disabled:o=!1}){return V.jsxs(sa,{alignItems:"center",children:[V.jsx(pg,{selected:e,onChange:t,disabled:o,sx:a,children:e?i:s||i}),n!=null?V.jsx(Ya,{variant:"caption",children:n}):""]})}Uf.propTypes={title:ra.string,selected:ra.array.isRequired,iconOn:ra.object,iconOff:ra.object,onChange:ra.func.isRequired,sx:ra.func};class v5{_callback;_targets=new Set;constructor(e){this._callback=e,window.addEventListener("resize",this._onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}_onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}class N5{_callback;_elements=[];_timer=null;constructor(e){this._callback=e,window.addEventListener("resize",()=>this._check,!0),document.addEventListener("scroll",()=>this._check,!0)}_check(){this._timer||(this._timer=setTimeout(()=>{this._doCheck(),this._timer=null},100))}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this._check())}unobserve(e){this._elements=this._elements.filter(t=>t!==e)}_doCheck(){const e=[];for(const t of this._elements){const i=t.getBoundingClientRect();i.top+i.height>=0&&i.top<=window.innerHeight&&i.left+i.width>=0&&i.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}e.length&&this._callback(e,this)}}typeof Symbol.dispose>"u"&&(Symbol.dispose=Symbol("Symbol.dispose")),typeof window<"u"&&("ResizeObserver"in globalThis||(globalThis.ResizeObserver=v5),"IntersectionObserver"in globalThis||(globalThis.IntersectionObserver=N5),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...n){this.innerHTML="",this.append(...n)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren)),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(n,e){return this.replace(new RegExp(n,"g"),e)});var It;(function(n){n[n.General=0]="General",n[n.Format=1]="Format",n[n.AlphaTex=2]="AlphaTex"})(It||(It={}));class Ht extends Error{type;constructor(e,t="",i){super(t??"",{cause:i}),this.type=e}}class Fl{static version="1.7.1";static date="2025-12-02T16:54:46.381Z";static commit="e487b958158892679a115693547661dc49a78e16";static print(e){e(`alphaTab ${Fl.version}`),e(`commit: ${Fl.commit}`),e(`build date: ${Fl.date}`)}}var Oe;(function(n){n[n.PPP=0]="PPP",n[n.PP=1]="PP",n[n.P=2]="P",n[n.MP=3]="MP",n[n.MF=4]="MF",n[n.F=5]="F",n[n.FF=6]="FF",n[n.FFF=7]="FFF",n[n.PPPP=8]="PPPP",n[n.PPPPP=9]="PPPPP",n[n.PPPPPP=10]="PPPPPP",n[n.FFFF=11]="FFFF",n[n.FFFFF=12]="FFFFF",n[n.FFFFFF=13]="FFFFFF",n[n.SF=14]="SF",n[n.SFP=15]="SFP",n[n.SFPP=16]="SFPP",n[n.FP=17]="FP",n[n.RF=18]="RF",n[n.RFZ=19]="RFZ",n[n.SFZ=20]="SFZ",n[n.SFFZ=21]="SFFZ",n[n.FZ=22]="FZ",n[n.N=23]="N",n[n.PF=24]="PF",n[n.SFZP=25]="SFZP"})(Oe||(Oe={}));class ${static QuarterTime=960;static _minVelocity=15;static VelocityIncrement=16;static ticksToMillis(e,t){return e*(6e4/(t*$.QuarterTime))|0}static millisToTicks(e,t){return e/(6e4/(t*$.QuarterTime))|0}static toTicks(e){return $.valueToTicks(e)}static valueToTicks(e){let t=e;return t<0&&(t=1/-t),$.QuarterTime*(4/t)|0}static applyDot(e,t){return t?e+(e/4|0)*3:e+(e/2|0)}static applyTuplet(e,t,i){return e*i/t|0}static removeTuplet(e,t,i){return e*t/i|0}static dynamicToVelocity(e,t=0){let i=1;switch(e){case Oe.PPP:i=$._minVelocity+0*$.VelocityIncrement;break;case Oe.PP:i=$._minVelocity+1*$.VelocityIncrement;break;case Oe.P:i=$._minVelocity+2*$.VelocityIncrement;break;case Oe.MP:i=$._minVelocity+3*$.VelocityIncrement;break;case Oe.MF:i=$._minVelocity+4*$.VelocityIncrement;break;case Oe.F:i=$._minVelocity+5*$.VelocityIncrement;break;case Oe.FF:i=$._minVelocity+6*$.VelocityIncrement;break;case Oe.FFF:i=$._minVelocity+7*$.VelocityIncrement;break;case Oe.PPPP:i=10;break;case Oe.PPPPP:i=5;break;case Oe.PPPPPP:i=3;break;case Oe.FFFF:i=$._minVelocity+8*$.VelocityIncrement;break;case Oe.FFFFF:i=$._minVelocity+9*$.VelocityIncrement;break;case Oe.FFFFFF:i=$._minVelocity+10*$.VelocityIncrement;break;case Oe.SF:case Oe.SFP:case Oe.SFZP:case Oe.SFPP:case Oe.SFZ:case Oe.FZ:i=$._minVelocity+6*$.VelocityIncrement;break;case Oe.FP:i=$._minVelocity+5*$.VelocityIncrement;break;case Oe.RF:case Oe.RFZ:case Oe.SFFZ:i=$._minVelocity+5*$.VelocityIncrement;break;case Oe.N:i=1;break;case Oe.PF:i=$._minVelocity+(4.5*$.VelocityIncrement|0);break}return i+=t*$.VelocityIncrement,Math.min(Math.max(i,1),127)}}var Mt;(function(n){n[n.Tempo=0]="Tempo",n[n.Volume=1]="Volume",n[n.Instrument=2]="Instrument",n[n.Balance=3]="Balance",n[n.SyncPoint=4]="SyncPoint",n[n.Bank=4]="Bank"})(Mt||(Mt={}));class td{barOccurence=0;millisecondOffset=0}class jt{isLinear=!1;type=Mt.Tempo;value=0;syncPointValue;ratioPosition=0;text="";isVisible=!0;static buildTempoAutomation(e,t,i,s,a=!0){(s<1||s>5)&&(s=2);const o=new Float32Array([1,.5,1,1.5,2,3]),c=new jt;return c.type=Mt.Tempo,c.isLinear=e,c.ratioPosition=t,c.value=i*o[s],c.isVisible=a,c}static buildInstrumentAutomation(e,t,i){const s=new jt;return s.type=Mt.Instrument,s.isLinear=e,s.ratioPosition=t,s.value=i,s}}class ke{static MaxPosition=60;static MaxValue=12;offset;value;constructor(e=0,t=0){this.offset=e,this.value=t}}var Kt;(function(n){n[n.Default=0]="Default",n[n.Gradual=1]="Gradual",n[n.Fast=2]="Fast"})(Kt||(Kt={}));var Ae;(function(n){n[n.None=0]="None",n[n.Custom=1]="Custom",n[n.Bend=2]="Bend",n[n.Release=3]="Release",n[n.BendRelease=4]="BendRelease",n[n.Hold=5]="Hold",n[n.Prebend=6]="Prebend",n[n.PrebendBend=7]="PrebendBend",n[n.PrebendRelease=8]="PrebendRelease"})(Ae||(Ae={}));var Ne;(function(n){n[n.None=0]="None",n[n.BrushUp=1]="BrushUp",n[n.BrushDown=2]="BrushDown",n[n.ArpeggioUp=3]="ArpeggioUp",n[n.ArpeggioDown=4]="ArpeggioDown"})(Ne||(Ne={}));var Ds;(function(n){n[n.None=0]="None",n[n.Crescendo=1]="Crescendo",n[n.Decrescendo=2]="Decrescendo"})(Ds||(Ds={}));var M;(function(n){n[n.QuadrupleWhole=-4]="QuadrupleWhole",n[n.DoubleWhole=-2]="DoubleWhole",n[n.Whole=1]="Whole",n[n.Half=2]="Half",n[n.Quarter=4]="Quarter",n[n.Eighth=8]="Eighth",n[n.Sixteenth=16]="Sixteenth",n[n.ThirtySecond=32]="ThirtySecond",n[n.SixtyFourth=64]="SixtyFourth",n[n.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",n[n.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"})(M||(M={}));var De;(function(n){n[n.None=0]="None",n[n.OnBeat=1]="OnBeat",n[n.BeforeBeat=2]="BeforeBeat",n[n.BendGrace=3]="BendGrace"})(De||(De={}));var mi;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Heavy=2]="Heavy",n[n.Tenuto=3]="Tenuto"})(mi||(mi={}));var Fe;(function(n){n[n.Unknown=-2]="Unknown",n[n.NoOrDead=-1]="NoOrDead",n[n.Thumb=0]="Thumb",n[n.IndexFinger=1]="IndexFinger",n[n.MiddleFinger=2]="MiddleFinger",n[n.AnnularFinger=3]="AnnularFinger",n[n.LittleFinger=4]="LittleFinger"})(Fe||(Fe={}));var Re;(function(n){n[n.None=0]="None",n[n.Natural=1]="Natural",n[n.Artificial=2]="Artificial",n[n.Pinch=3]="Pinch",n[n.Tap=4]="Tap",n[n.Semi=5]="Semi",n[n.Feedback=6]="Feedback"})(Re||(Re={}));var Ue;(function(n){n[n.Default=0]="Default",n[n.ForceNone=1]="ForceNone",n[n.ForceNatural=2]="ForceNatural",n[n.ForceSharp=3]="ForceSharp",n[n.ForceDoubleSharp=4]="ForceDoubleSharp",n[n.ForceFlat=5]="ForceFlat",n[n.ForceDoubleFlat=6]="ForceDoubleFlat"})(Ue||(Ue={}));var Ye;(function(n){n[n._15ma=0]="_15ma",n[n._8va=1]="_8va",n[n.Regular=2]="Regular",n[n._8vb=3]="_8vb",n[n._15mb=4]="_15mb"})(Ye||(Ye={}));var Ji;(function(n){n[n.None=0]="None",n[n.IntoFromBelow=1]="IntoFromBelow",n[n.IntoFromAbove=2]="IntoFromAbove"})(Ji||(Ji={}));var $e;(function(n){n[n.None=0]="None",n[n.Shift=1]="Shift",n[n.Legato=2]="Legato",n[n.OutUp=3]="OutUp",n[n.OutDown=4]="OutDown",n[n.PickSlideDown=5]="PickSlideDown",n[n.PickSlideUp=6]="PickSlideUp"})($e||($e={}));var ct;(function(n){n[n.None=0]="None",n[n.Slight=1]="Slight",n[n.Wide=2]="Wide"})(ct||(ct={}));var aa;(function(n){n[n.Hidden=0]="Hidden",n[n.ShowWithBeams=1]="ShowWithBeams",n[n.ShowWithBars=2]="ShowWithBars",n[n.Automatic=3]="Automatic"})(aa||(aa={}));var $a;(function(n){n[n.ScoreDefault=0]="ScoreDefault",n[n.ScoreForcePiano=1]="ScoreForcePiano",n[n.SingleNoteEffectBand=2]="SingleNoteEffectBand",n[n.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano"})($a||($a={}));var Ps;(function(n){n[n.GuitarPro=0]="GuitarPro",n[n.SongBook=1]="SongBook"})(Ps||(Ps={}));var rt;(function(n){n[n.ScoreTitle=0]="ScoreTitle",n[n.ScoreSubTitle=1]="ScoreSubTitle",n[n.ScoreArtist=2]="ScoreArtist",n[n.ScoreAlbum=3]="ScoreAlbum",n[n.ScoreWords=4]="ScoreWords",n[n.ScoreMusic=5]="ScoreMusic",n[n.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",n[n.ScoreCopyright=7]="ScoreCopyright",n[n.GuitarTuning=8]="GuitarTuning",n[n.TrackNames=9]="TrackNames",n[n.ChordDiagrams=10]="ChordDiagrams",n[n.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",n[n.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",n[n.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",n[n.EffectAlternateEndings=14]="EffectAlternateEndings",n[n.EffectCapo=15]="EffectCapo",n[n.EffectChordNames=16]="EffectChordNames",n[n.EffectCrescendo=17]="EffectCrescendo",n[n.EffectDynamics=18]="EffectDynamics",n[n.EffectFadeIn=19]="EffectFadeIn",n[n.EffectFermata=20]="EffectFermata",n[n.EffectFingering=21]="EffectFingering",n[n.EffectHarmonics=22]="EffectHarmonics",n[n.EffectLetRing=23]="EffectLetRing",n[n.EffectLyrics=24]="EffectLyrics",n[n.EffectMarker=25]="EffectMarker",n[n.EffectOttavia=26]="EffectOttavia",n[n.EffectPalmMute=27]="EffectPalmMute",n[n.EffectPickSlide=28]="EffectPickSlide",n[n.EffectPickStroke=29]="EffectPickStroke",n[n.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",n[n.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",n[n.EffectTap=32]="EffectTap",n[n.EffectTempo=33]="EffectTempo",n[n.EffectText=34]="EffectText",n[n.EffectTrill=35]="EffectTrill",n[n.EffectTripletFeel=36]="EffectTripletFeel",n[n.EffectWhammyBar=37]="EffectWhammyBar",n[n.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",n[n.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",n[n.EffectLeftHandTap=40]="EffectLeftHandTap",n[n.EffectFreeTime=41]="EffectFreeTime",n[n.EffectSustainPedal=42]="EffectSustainPedal",n[n.EffectGolpe=43]="EffectGolpe",n[n.EffectWahPedal=44]="EffectWahPedal",n[n.EffectBeatBarre=45]="EffectBeatBarre",n[n.EffectNoteOrnament=46]="EffectNoteOrnament",n[n.EffectRasgueado=47]="EffectRasgueado",n[n.EffectDirections=48]="EffectDirections",n[n.EffectBeatTimer=49]="EffectBeatTimer"})(rt||(rt={}));class ip{notationMode=Ps.GuitarPro;fingeringMode=$a.ScoreDefault;elements=new Map;static defaultElements=new Map([[rt.ZerosOnDiveWhammys,!1]]);rhythmMode=aa.Automatic;rhythmHeight=15;transpositionPitches=[];displayTranspositionPitches=[];smallGraceTabNotes=!0;extendBendArrowsOnTiedNotes=!0;extendLineEffectsToBeatEnd=!1;slurHeight=5;isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):ip.defaultElements.has(e)?ip.defaultElements.get(e):!0}}class Zc{_factory;_value=void 0;get hasValue(){return this._value!==void 0}constructor(e){this._factory=e}get value(){return this._value===void 0&&(this._value=this._factory()),this._value}reset(){this._value=void 0}}var za;(function(n){n[n.None=0]="None",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warning=3]="Warning",n[n.Error=4]="Error"})(za||(za={}));class Vc{static logLevel=za.Info;static _format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...i){console.debug(Vc._format(e,t),...i)}warning(e,t,...i){console.warn(Vc._format(e,t),...i)}info(e,t,...i){console.info(Vc._format(e,t),...i)}error(e,t,...i){console.error(Vc._format(e,t),...i)}}class ee{static logLevel=za.Info;static log=new Vc;static _shouldLog(e){return ee.logLevel!==za.None&&e>=ee.logLevel}static debug(e,t,...i){ee._shouldLog(za.Debug)&&ee.log.debug(e,t,...i)}static warning(e,t,...i){ee._shouldLog(za.Warning)&&ee.log.warning(e,t,...i)}static info(e,t,...i){ee._shouldLog(za.Info)&&ee.log.info(e,t,...i)}static error(e,t,...i){ee._shouldLog(za.Error)&&ee.log.error(e,t,...i)}}var Yo;(function(n){n[n.NoBrackets=0]="NoBrackets",n[n.GroupStaves=1]="GroupStaves",n[n.GroupSimilarInstruments=2]="GroupSimilarInstruments"})(Yo||(Yo={}));var Ii;(function(n){n[n.Hidden=0]="Hidden",n[n.FirstSystem=1]="FirstSystem",n[n.AllSystems=2]="AllSystems"})(Ii||(Ii={}));var $s;(function(n){n[n.FullName=0]="FullName",n[n.ShortName=1]="ShortName"})($s||($s={}));var Xs;(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical"})(Xs||(Xs={}));class Lx{hideDynamics=!1;bracketExtendMode=Yo.GroupStaves;useSystemSignSeparator=!1;globalDisplayTuning=!0;perTrackDisplayTuning=null;globalDisplayChordDiagramsOnTop=!0;perTrackChordDiagramsOnTop=null;singleTrackTrackNamePolicy=Ii.FirstSystem;multiTrackTrackNamePolicy=Ii.FirstSystem;firstSystemTrackNameMode=$s.ShortName;otherSystemsTrackNameMode=$s.ShortName;firstSystemTrackNameOrientation=Xs.Vertical;otherSystemsTrackNameOrientation=Xs.Vertical;multiTrackMultiBarRest=!1;perTrackMultiBarRest=null}class O0{masterBars=[];opening=null;get openings(){const e=this.opening;return e?[e]:[]}closings=[];get isOpened(){return this.opening?.isRepeatStart===!0}isClosed=!1;addMasterBar(e){this.opening===null&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}class Vl{colors=new Map}var _t;(function(n){n[n.Neutral=0]="Neutral",n[n.C3=1]="C3",n[n.C4=2]="C4",n[n.F4=3]="F4",n[n.G2=4]="G2"})(_t||(_t={}));var rs;(function(n){n[n.None=0]="None",n[n.Simple=1]="Simple",n[n.FirstOfDouble=2]="FirstOfDouble",n[n.SecondOfDouble=3]="SecondOfDouble"})(rs||(rs={}));var Xt;(function(n){n[n.Cb=-7]="Cb",n[n.Gb=-6]="Gb",n[n.Db=-5]="Db",n[n.Ab=-4]="Ab",n[n.Eb=-3]="Eb",n[n.Bb=-2]="Bb",n[n.F=-1]="F",n[n.C=0]="C",n[n.G=1]="G",n[n.D=2]="D",n[n.A=3]="A",n[n.E=4]="E",n[n.B=5]="B",n[n.FSharp=6]="FSharp",n[n.CSharp=7]="CSharp"})(Xt||(Xt={}));var pn;(function(n){n[n.Major=0]="Major",n[n.Minor=1]="Minor"})(pn||(pn={}));var ai;(function(n){n[n.Down=0]="Down",n[n.Hold=1]="Hold",n[n.Up=2]="Up"})(ai||(ai={}));class Qr{ratioPosition=0;pedalType=ai.Down;bar;nextPedalMarker=null;previousPedalMarker=null}var Bt;(function(n){n[n.StandardNotationRepeats=0]="StandardNotationRepeats",n[n.GuitarTabsRepeats=1]="GuitarTabsRepeats",n[n.SlashRepeats=2]="SlashRepeats",n[n.NumberedRepeats=3]="NumberedRepeats",n[n.StandardNotationBarNumber=4]="StandardNotationBarNumber",n[n.GuitarTabsBarNumber=5]="GuitarTabsBarNumber",n[n.SlashBarNumber=6]="SlashBarNumber",n[n.NumberedBarNumber=7]="NumberedBarNumber",n[n.StandardNotationBarLines=8]="StandardNotationBarLines",n[n.GuitarTabsBarLines=9]="GuitarTabsBarLines",n[n.SlashBarLines=10]="SlashBarLines",n[n.NumberedBarLines=11]="NumberedBarLines",n[n.StandardNotationClef=12]="StandardNotationClef",n[n.GuitarTabsClef=13]="GuitarTabsClef",n[n.StandardNotationKeySignature=14]="StandardNotationKeySignature",n[n.NumberedKeySignature=15]="NumberedKeySignature",n[n.StandardNotationTimeSignature=16]="StandardNotationTimeSignature",n[n.GuitarTabsTimeSignature=17]="GuitarTabsTimeSignature",n[n.SlashTimeSignature=18]="SlashTimeSignature",n[n.NumberedTimeSignature=19]="NumberedTimeSignature",n[n.StandardNotationStaffLine=20]="StandardNotationStaffLine",n[n.GuitarTabsStaffLine=21]="GuitarTabsStaffLine",n[n.SlashStaffLine=22]="SlashStaffLine",n[n.NumberedStaffLine=23]="NumberedStaffLine"})(Bt||(Bt={}));class Ax extends Vl{}var et;(function(n){n[n.Automatic=0]="Automatic",n[n.Dashed=1]="Dashed",n[n.Dotted=2]="Dotted",n[n.Heavy=3]="Heavy",n[n.HeavyHeavy=4]="HeavyHeavy",n[n.HeavyLight=5]="HeavyLight",n[n.LightHeavy=6]="LightHeavy",n[n.LightLight=7]="LightLight",n[n.None=8]="None",n[n.Regular=9]="Regular",n[n.Short=10]="Short",n[n.Tick=11]="Tick"})(et||(et={}));class gn{static _globalBarId=0;static resetIds(){gn._globalBarId=0}id=gn._globalBarId++;index=0;nextBar=null;previousBar=null;clef=_t.G2;clefOttava=Ye.Regular;staff;voices=[];simileMark=rs.None;_filledVoices=new Set([0]);get isMultiVoice(){return this._filledVoices.size>1}get filledVoices(){return this._filledVoices}displayScale=1;displayWidth=-1;sustainPedals=[];get masterBar(){return this.staff.track.score.masterBars[this.index]}_isEmpty=!0;_isRestOnly=!0;get isEmpty(){return this._isEmpty}get hasChanges(){return this.index===0||this.keySignature!==this.previousBar.keySignature||this.keySignatureType!==this.previousBar.keySignatureType||this.clef!==this.previousBar.clef||this.clefOttava!==this.previousBar.clefOttava?!0:this.simileMark!==rs.None||this.sustainPedals.length>0||this.barLineLeft!==et.Automatic||this.barLineRight!==et.Automatic}get isRestOnly(){return this._isRestOnly}barLineLeft=et.Automatic;barLineRight=et.Automatic;keySignature=Xt.C;keySignatureType=pn.Major;getActualBarLineLeft(e){return gn._actualBarLine(this,!1,e)}getActualBarLineRight(){return gn._actualBarLine(this,!0,!1)}static _automaticToActualType(e,t,i){let s;return t?e.isRepeatEnd?s=et.LightHeavy:e.nextMasterBar?e.isFreeTime?s=et.Dashed:e.isDoubleBar?s=et.LightLight:s=et.Regular:s=et.LightHeavy:e.isRepeatStart?s=et.HeavyLight:i?s=et.Regular:s=et.None,s}static _actualBarLine(e,t,i){const s=e.masterBar,a=t?e.barLineRight:e.barLineLeft;let o;return a===et.Automatic?o=gn._automaticToActualType(s,t,i):o=a,o}style;addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,t=null){this._filledVoices.clear(),this._filledVoices.add(0),this._isEmpty=!0,this._isRestOnly=!0;for(let s=0,a=this.voices.length;s<a;s++){const o=this.voices[s];o.finish(e,t),o.isEmpty||(this._isEmpty=!1,this._filledVoices.add(s)),o.isRestOnly||(this._isRestOnly=!1)}const i=this.sustainPedals;if(i.length>0){let s=null;this.sustainPedals=[],this.previousBar&&this.previousBar.sustainPedals.length>0&&(s=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1],s.pedalType===ai.Up&&(s=null));const a=s!==null&&s.pedalType!==ai.Up;for(const o of i){if(s&&s.pedalType!==ai.Up){if(s.bar===this&&o.ratioPosition<=s.ratioPosition)continue;s.nextPedalMarker=o,o.previousPedalMarker=s}a&&o.pedalType===ai.Down&&(o.pedalType=ai.Hold),o.bar=this,this.sustainPedals.push(o),s=o}}else if(this.previousBar&&this.previousBar.sustainPedals.length>0){const s=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1];if(s.pedalType!==ai.Up){const a=new Qr;a.ratioPosition=0,a.bar=this,a.pedalType=ai.Hold,this.sustainPedals.push(a),s.nextPedalMarker=a,a.previousPedalMarker=s}}}calculateDuration(){let e=0;for(const t of this.voices){const i=t.calculateDuration();i>e&&(e=i)}return e}}class sp{beats=[];id="empty";isComplete=!1;addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=`${this.beats[0].absoluteDisplayStart}_${this.beats[0].voice.index}`)}}var jc;(function(n){n[n.Glyphs=0]="Glyphs"})(jc||(jc={}));class Rx extends Vl{}let An=class F0{_beatLookup;_isEmpty=!0;_isRestOnly=!0;static _globalVoiceId=0;static resetIds(){F0._globalVoiceId=0}id=F0._globalVoiceId++;index=0;bar;beats=[];get isEmpty(){return this._isEmpty}style;forceNonEmpty(){this._isEmpty=!1}get isRestOnly(){return this._isRestOnly}insertBeat(e,t){t.nextBeat=e.nextBeat,t.nextBeat&&(t.nextBeat.previousBeat=t),t.previousBeat=e,t.voice=this,e.nextBeat=t,this.beats.splice(e.index+1,0,t)}addBeat(e){e.voice=this,e.index=this.beats.length,this.beats.push(e),e.isEmpty||(this._isEmpty=!1),e.isRest||(this._isRestOnly=!1)}_chain(e,t=null){if(this.bar){if(e.index<this.beats.length-1)e.nextBeat=this.beats[e.index+1],e.nextBeat.previousBeat=e;else if(e.isLastOfVoice&&e.voice.bar.nextBar){const i=this.bar.nextBar.voices[this.index];i.beats.length>0&&(e.nextBeat=i.beats[0]),e.nextBeat.previousBeat=e}e.chain(t)}}addGraceBeat(e){if(this.beats.length===0){this.addBeat(e);return}const t=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(e),this.addBeat(t),this._isEmpty=!1,this._isRestOnly=!1}getBeatAtPlaybackStart(e){return this._beatLookup.has(e)?this._beatLookup.get(e):null}finish(e,t=null){this._isEmpty=!0,this._isRestOnly=!0,this._beatLookup=new Map;let i=null;for(let o=0;o<this.beats.length;o++){const c=this.beats[o];c.index=o,this._chain(c,t),c.graceType===De.None?(c.graceGroup=i,i&&(i.isComplete=!0),i=null):(i||(i=new sp),i.addBeat(c)),c.isEmpty||(this._isEmpty=!1),c.isRest||(this._isRestOnly=!1)}let s=0,a=0;for(let o=0;o<this.beats.length;o++){const c=this.beats[o];if(c.index=o,c.finish(e,t),c.graceType===De.None){if(c.graceGroup){const h=c.graceGroup.beats[0],d=c.graceGroup.beats[c.graceGroup.beats.length-1];if(h.graceType!==De.BendGrace){const p=d.playbackStart+d.playbackDuration-h.playbackStart;switch(h.graceType){case De.BeforeBeat:h.previousBeat?(h.previousBeat.playbackDuration-=p,h.previousBeat.voice===this?a=h.previousBeat.playbackStart+h.previousBeat.playbackDuration:a=-p):a=-p;for(const g of c.graceGroup.beats)this._beatLookup.delete(g.playbackStart),g.playbackStart=a,this._beatLookup.set(g.playbackStart,c),a+=g.playbackDuration;break;case De.OnBeat:c.playbackDuration-=p,d.voice===this?a=d.playbackStart+d.playbackDuration:a=-p;break}}}c.displayStart=s,c.playbackStart=a,this._beatLookup.set(c.playbackStart,c)}else c.displayStart=s,c.playbackStart=a;c.fermata?this.bar.masterBar.addFermata(c.playbackStart,c.fermata):c.fermata=this.bar.masterBar.getFermata(c),c.finishTuplet(),c.graceGroup&&c.graceGroup.finish(),s+=c.displayDuration,a+=c.playbackDuration}}calculateDuration(){if(this.isEmpty||this.beats.length===0)return 0;const e=this.beats[this.beats.length-1],t=this.beats[0];return e.playbackStart+e.playbackDuration-t.playbackStart}};var Ce;(function(n){n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right"})(Ce||(Ce={}));var Wt;(function(n){n[n.Top=0]="Top",n[n.Middle=1]="Middle",n[n.Bottom=2]="Bottom",n[n.Alphabetic=3]="Alphabetic"})(Wt||(Wt={}));class gg{width;height;constructor(e,t){this.width=e,this.height=t}}class vi{static fillMusicFontSymbolSafe(e,t,i,s,a,o){e.settings.display.resources.engravingSettings.hasSymbol(a)&&e.fillMusicFontSymbol(t,i,s,a,o)}static fillMusicFontSymbolsSafe(e,t,i,s,a,o){const c=a.filter(h=>e.settings.display.resources.engravingSettings.hasSymbol(h));c.length!==0&&e.fillMusicFontSymbols(t,i,s,c,o)}}var ye;(function(n){n[n.Title=0]="Title",n[n.SubTitle=1]="SubTitle",n[n.Artist=2]="Artist",n[n.Album=3]="Album",n[n.Words=4]="Words",n[n.Music=5]="Music",n[n.WordsAndMusic=6]="WordsAndMusic",n[n.Transcriber=7]="Transcriber",n[n.Copyright=8]="Copyright",n[n.CopyrightSecondLine=9]="CopyrightSecondLine",n[n.ChordDiagramList=10]="ChordDiagramList"})(ye||(ye={}));class wn{template;isVisible;textAlign;constructor(e="",t=void 0,i=Ce.Left){this.template=e,this.isVisible=t,this.textAlign=i}static equals(e,t){const i=e.isVisible!==void 0?e.isVisible:!0,s=t.isVisible!==void 0?t.isVisible:!0;return!(i!==s||e.template!==t.template||e.textAlign!==t.textAlign)}buildText(e){let t=!1,i=!1;const s=this.template.replace(wn._placeholderPattern,(a,o)=>{i=!0;let c="";switch(o){case"TITLE":c=e.title;break;case"SUBTITLE":c=e.subTitle;break;case"ARTIST":c=e.artist;break;case"ALBUM":c=e.album;break;case"WORDS":case"WORDSMUSIC":c=e.words;break;case"MUSIC":c=e.music;break;case"TABBER":c=e.tab;break;case"COPYRIGHT":c=e.copyright;break;default:c="";break}return c&&(t=!0),c});return i&&!t?"":s}static _placeholderPattern=/%([^%]+)%/g}class $o extends Vl{headerAndFooter=new Map;static defaultHeaderAndFooter=new Map([[ye.Title,new wn("%TITLE%",void 0,Ce.Center)],[ye.SubTitle,new wn("%SUBTITLE%",void 0,Ce.Center)],[ye.Artist,new wn("%ARTIST%",void 0,Ce.Center)],[ye.Album,new wn("%ALBUM%",void 0,Ce.Center)],[ye.Words,new wn("Words by %WORDS%",void 0,Ce.Left)],[ye.Music,new wn("Music by %MUSIC%",void 0,Ce.Right)],[ye.WordsAndMusic,new wn("Words & Music by %MUSIC%",void 0,Ce.Right)],[ye.Transcriber,new wn("Tabbed by %TABBER%",!1,Ce.Right)],[ye.Copyright,new wn("%COPYRIGHT%",void 0,Ce.Center)],[ye.CopyrightSecondLine,new wn("All Rights Reserved - International Copyright Secured",!0,Ce.Center)]])}class Qa{_currentRepeatGroup=null;_openedRepeatGroups=[];_properlyOpenedRepeatGroups=0;static resetIds(){gn.resetIds(),fs.resetIds(),An.resetIds(),es.resetIds()}album="";artist="";copyright="";instructions="";music="";notices="";subTitle="";title="";words="";tab="";get tempo(){return this.masterBars.length&&this.masterBars[0].tempoAutomations.length>0?this.masterBars[0].tempoAutomations[0].value:120}get tempoLabel(){return this.masterBars.length&&this.masterBars[0].tempoAutomations.length>0?this.masterBars[0].tempoAutomations[0].text:""}masterBars=[];tracks=[];defaultSystemsLayout=3;systemsLayout=[];stylesheet=new Lx;backingTrack;style;rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this._addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,this.masterBars.length!==0&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this._addMasterBarToRepeatGroups(e),this.masterBars.push(e)}_addMasterBarToRepeatGroups(e){e.isRepeatStart?(this._currentRepeatGroup?.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new O0,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new O0,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let i=0,s=this.tracks.length;i<s;i++)this.tracks[i].finish(e,t)}applyFlatSyncPoints(e){for(const t of this.masterBars)t.syncPoints=void 0;for(const t of e){const i=new jt;i.ratioPosition=Math.min(1,Math.max(0,t.barPosition)),i.type=Mt.SyncPoint,i.syncPointValue=new td,i.syncPointValue.millisecondOffset=t.millisecondOffset,i.syncPointValue.barOccurence=t.barOccurence,t.barIndex<this.masterBars.length&&this.masterBars[t.barIndex].addSyncPoint(i)}for(const t of this.masterBars)t.syncPoints&&t.syncPoints.sort((i,s)=>{const a=i.syncPointValue.barOccurence-s.syncPointValue.barOccurence;return a!==0?a:i.ratioPosition-s.ratioPosition})}exportFlatSyncPoints(){const e=[];for(const t of this.masterBars){const i=t.syncPoints;if(i)for(const s of i)e.push({barIndex:t.index,barOccurence:s.syncPointValue.barOccurence,barPosition:s.ratioPosition,millisecondOffset:s.syncPointValue.millisecondOffset})}return e}}var yt;(function(n){n[n.NoTripletFeel=0]="NoTripletFeel",n[n.Triplet16th=1]="Triplet16th",n[n.Triplet8th=2]="Triplet8th",n[n.Dotted16th=3]="Dotted16th",n[n.Dotted8th=4]="Dotted8th",n[n.Scottish16th=5]="Scottish16th",n[n.Scottish8th=6]="Scottish8th"})(yt||(yt={}));class Ka{static MaxAlternateEndings=8;alternateEndings=0;nextMasterBar=null;previousMasterBar=null;index=0;get hasChanges(){return this.index===0?!1:this.timeSignatureCommon!==this.previousMasterBar.timeSignatureCommon||this.timeSignatureNumerator!==this.previousMasterBar.timeSignatureNumerator||this.timeSignatureDenominator!==this.previousMasterBar.timeSignatureDenominator||this.tripletFeel!==this.previousMasterBar.tripletFeel?!0:this.alternateEndings!==0||this.isRepeatStart||this.isRepeatEnd||this.isFreeTime||this.isSectionStart||this.tempoAutomations.length>0||this.syncPoints&&this.syncPoints.length>0||this.fermata!==null&&this.fermata.size>0||this.directions!==null&&this.directions.size>0||this.isAnacrusis}get keySignature(){return this.score.tracks[0].staves[0].bars[this.index].keySignature}set keySignature(e){this.score.tracks[0].staves[0].bars[this.index].keySignature=e}get keySignatureType(){return this.score.tracks[0].staves[0].bars[this.index].keySignatureType}set keySignatureType(e){this.score.tracks[0].staves[0].bars[this.index].keySignatureType=e}isDoubleBar=!1;isRepeatStart=!1;get isRepeatEnd(){return this.repeatCount>0}repeatCount=0;repeatGroup;timeSignatureNumerator=4;timeSignatureDenominator=4;timeSignatureCommon=!1;isFreeTime=!1;tripletFeel=yt.NoTripletFeel;section=null;get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}tempoAutomations=[];syncPoints;score;fermata=null;start=0;isAnacrusis=!1;displayScale=1;displayWidth=-1;directions=null;calculateDuration(e=!0){if(this.isAnacrusis&&e){let t=0;for(const i of this.score.tracks)for(const s of i.staves){const a=this.index<s.bars.length?s.bars[this.index].calculateDuration():0;a>t&&(t=a)}return t}return this.timeSignatureNumerator*$.valueToTicks(this.timeSignatureDenominator)}addFermata(e,t){let i=this.fermata;i===null&&(i=new Map,this.fermata=i),i.set(e,t)}addDirection(e){this.directions==null&&(this.directions=new Set),this.directions.add(e)}getFermata(e){const t=this.fermata;return t===null?null:t.has(e.playbackStart)?t.get(e.playbackStart):e.index===0&&t.has(0)?t.get(0):null}addSyncPoint(e){this.syncPoints||(this.syncPoints=[]),this.syncPoints.push(e)}}class Xe{static DefaultChannelCount=17;static MetronomeChannel=Xe.DefaultChannelCount-1;static MetronomeKey=33;static AudioChannels=2;static MinVolume=0;static MinProgram=0;static MaxProgram=127;static MinPlaybackSpeed=.125;static MaxPlaybackSpeed=8;static PercussionChannel=9;static PercussionBank=128;static MaxPitchWheel=16384;static MaxPitchWheel20=4294967296;static DefaultPitchWheel=Xe.MaxPitchWheel/2;static MicroBufferCount=32;static MicroBufferSize=64}var S;(function(n){n[n.None=-1]="None",n[n.Space=32]="Space",n[n.Brace=57344]="Brace",n[n.BracketTop=57347]="BracketTop",n[n.BracketBottom=57348]="BracketBottom",n[n.SystemDivider=57351]="SystemDivider",n[n.GClef=57424]="GClef",n[n.GClef15mb=57425]="GClef15mb",n[n.GClef8vb=57426]="GClef8vb",n[n.GClef8va=57427]="GClef8va",n[n.GClef15ma=57428]="GClef15ma",n[n.CClef=57436]="CClef",n[n.CClef8vb=57437]="CClef8vb",n[n.FClef=57442]="FClef",n[n.FClef15mb=57443]="FClef15mb",n[n.FClef8vb=57444]="FClef8vb",n[n.FClef8va=57445]="FClef8va",n[n.FClef15ma=57446]="FClef15ma",n[n.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",n[n.SixStringTabClef=57453]="SixStringTabClef",n[n.FourStringTabClef=57454]="FourStringTabClef",n[n.Clef8=57469]="Clef8",n[n.Clef15=57470]="Clef15",n[n.TimeSig0=57472]="TimeSig0",n[n.TimeSig1=57473]="TimeSig1",n[n.TimeSig2=57474]="TimeSig2",n[n.TimeSig3=57475]="TimeSig3",n[n.TimeSig4=57476]="TimeSig4",n[n.TimeSig5=57477]="TimeSig5",n[n.TimeSig6=57478]="TimeSig6",n[n.TimeSig7=57479]="TimeSig7",n[n.TimeSig8=57480]="TimeSig8",n[n.TimeSig9=57481]="TimeSig9",n[n.TimeSigCommon=57482]="TimeSigCommon",n[n.TimeSigCutCommon=57483]="TimeSigCutCommon",n[n.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",n[n.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",n[n.NoteheadWhole=57506]="NoteheadWhole",n[n.NoteheadHalf=57507]="NoteheadHalf",n[n.NoteheadBlack=57508]="NoteheadBlack",n[n.NoteheadNull=57509]="NoteheadNull",n[n.NoteheadXOrnate=57514]="NoteheadXOrnate",n[n.NoteheadPlusDoubleWhole=57516]="NoteheadPlusDoubleWhole",n[n.NoteheadPlusWhole=57517]="NoteheadPlusWhole",n[n.NoteheadPlusHalf=57518]="NoteheadPlusHalf",n[n.NoteheadPlusBlack=57519]="NoteheadPlusBlack",n[n.NoteheadSquareWhite=57528]="NoteheadSquareWhite",n[n.NoteheadSquareBlack=57529]="NoteheadSquareBlack",n[n.NoteheadTriangleUpDoubleWhole=57530]="NoteheadTriangleUpDoubleWhole",n[n.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",n[n.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",n[n.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",n[n.NoteheadTriangleRightWhite=57537]="NoteheadTriangleRightWhite",n[n.NoteheadTriangleRightBlack=57538]="NoteheadTriangleRightBlack",n[n.NoteheadTriangleDownDoubleWhole=57548]="NoteheadTriangleDownDoubleWhole",n[n.NoteheadTriangleDownWhole=57540]="NoteheadTriangleDownWhole",n[n.NoteheadTriangleDownHalf=57541]="NoteheadTriangleDownHalf",n[n.NoteheadTriangleDownBlack=57543]="NoteheadTriangleDownBlack",n[n.NoteheadDiamondDoubleWhole=57559]="NoteheadDiamondDoubleWhole",n[n.NoteheadDiamondWhole=57560]="NoteheadDiamondWhole",n[n.NoteheadDiamondHalf=57561]="NoteheadDiamondHalf",n[n.NoteheadDiamondBlack=57563]="NoteheadDiamondBlack",n[n.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",n[n.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",n[n.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",n[n.NoteheadCircleXDoubleWhole=57520]="NoteheadCircleXDoubleWhole",n[n.NoteheadCircleXWhole=57521]="NoteheadCircleXWhole",n[n.NoteheadCircleXHalf=57522]="NoteheadCircleXHalf",n[n.NoteheadCircleX=57523]="NoteheadCircleX",n[n.NoteheadXDoubleWhole=57510]="NoteheadXDoubleWhole",n[n.NoteheadXWhole=57511]="NoteheadXWhole",n[n.NoteheadXHalf=57512]="NoteheadXHalf",n[n.NoteheadXBlack=57513]="NoteheadXBlack",n[n.NoteheadParenthesis=57550]="NoteheadParenthesis",n[n.NoteheadSlashedBlack1=57551]="NoteheadSlashedBlack1",n[n.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",n[n.NoteheadSlashedHalf1=57553]="NoteheadSlashedHalf1",n[n.NoteheadSlashedHalf2=57554]="NoteheadSlashedHalf2",n[n.NoteheadSlashedWhole1=57555]="NoteheadSlashedWhole1",n[n.NoteheadSlashedWhole2=57556]="NoteheadSlashedWhole2",n[n.NoteheadSlashedDoubleWhole1=57557]="NoteheadSlashedDoubleWhole1",n[n.NoteheadSlashedDoubleWhole2=57558]="NoteheadSlashedDoubleWhole2",n[n.NoteheadCircledBlack=57572]="NoteheadCircledBlack",n[n.NoteheadCircledHalf=57573]="NoteheadCircledHalf",n[n.NoteheadCircledWhole=57574]="NoteheadCircledWhole",n[n.NoteheadCircledDoubleWhole=57575]="NoteheadCircledDoubleWhole",n[n.NoteheadCircleSlash=57591]="NoteheadCircleSlash",n[n.NoteheadHeavyX=57592]="NoteheadHeavyX",n[n.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",n[n.NoteheadSlashHorizontalEnds=57601]="NoteheadSlashHorizontalEnds",n[n.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",n[n.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",n[n.NoteheadRoundWhiteWithDot=57621]="NoteheadRoundWhiteWithDot",n[n.NoteheadSquareBlackLarge=57626]="NoteheadSquareBlackLarge",n[n.NoteheadSquareBlackWhite=57627]="NoteheadSquareBlackWhite",n[n.NoteheadClusterDoubleWhole3rd=57640]="NoteheadClusterDoubleWhole3rd",n[n.NoteheadClusterWhole3rd=57641]="NoteheadClusterWhole3rd",n[n.NoteheadClusterHalf3rd=57642]="NoteheadClusterHalf3rd",n[n.NoteheadClusterQuarter3rd=57643]="NoteheadClusterQuarter3rd",n[n.NoteShapeRoundWhite=57776]="NoteShapeRoundWhite",n[n.NoteShapeRoundBlack=57777]="NoteShapeRoundBlack",n[n.NoteShapeSquareWhite=57778]="NoteShapeSquareWhite",n[n.NoteShapeSquareBlack=57779]="NoteShapeSquareBlack",n[n.NoteShapeTriangleRightWhite=57780]="NoteShapeTriangleRightWhite",n[n.NoteShapeTriangleRightBlack=57781]="NoteShapeTriangleRightBlack",n[n.NoteShapeTriangleLeftWhite=57782]="NoteShapeTriangleLeftWhite",n[n.NoteShapeTriangleLeftBlack=57783]="NoteShapeTriangleLeftBlack",n[n.NoteShapeDiamondWhite=57784]="NoteShapeDiamondWhite",n[n.NoteShapeDiamondBlack=57785]="NoteShapeDiamondBlack",n[n.NoteShapeTriangleUpWhite=57786]="NoteShapeTriangleUpWhite",n[n.NoteShapeTriangleUpBlack=57787]="NoteShapeTriangleUpBlack",n[n.NoteShapeMoonWhite=57788]="NoteShapeMoonWhite",n[n.NoteShapeMoonBlack=57789]="NoteShapeMoonBlack",n[n.NoteShapeTriangleRoundWhite=57790]="NoteShapeTriangleRoundWhite",n[n.NoteShapeTriangleRoundBlack=57791]="NoteShapeTriangleRoundBlack",n[n.NoteQuarterUp=57813]="NoteQuarterUp",n[n.Note8thUp=57815]="Note8thUp",n[n.MetNoteQuarterUp=60581]="MetNoteQuarterUp",n[n.MetNote8thUp=60583]="MetNote8thUp",n[n.MetAugmentationDot=60599]="MetAugmentationDot",n[n.ArrowheadBlackUp=60280]="ArrowheadBlackUp",n[n.ArrowheadBlackDown=60284]="ArrowheadBlackDown",n[n.AugmentationDot=57831]="AugmentationDot",n[n.TextBlackNoteLongStem=57841]="TextBlackNoteLongStem",n[n.TextBlackNoteFrac8thLongStem=57843]="TextBlackNoteFrac8thLongStem",n[n.TextBlackNoteFrac16thLongStem=57845]="TextBlackNoteFrac16thLongStem",n[n.TextBlackNoteFrac32ndLongStem=57846]="TextBlackNoteFrac32ndLongStem",n[n.TextCont8thBeamLongStem=57848]="TextCont8thBeamLongStem",n[n.TextCont16thBeamLongStem=57850]="TextCont16thBeamLongStem",n[n.TextCont32ndBeamLongStem=57851]="TextCont32ndBeamLongStem",n[n.TextAugmentationDot=57852]="TextAugmentationDot",n[n.TextTupletBracketStartLongStem=57857]="TextTupletBracketStartLongStem",n[n.TextTuplet3LongStem=57858]="TextTuplet3LongStem",n[n.TextTupletBracketEndLongStem=57859]="TextTupletBracketEndLongStem",n[n.Tremolo3=57890]="Tremolo3",n[n.Tremolo2=57889]="Tremolo2",n[n.Tremolo1=57888]="Tremolo1",n[n.Flag8thUp=57920]="Flag8thUp",n[n.Flag8thDown=57921]="Flag8thDown",n[n.Flag16thUp=57922]="Flag16thUp",n[n.Flag16thDown=57923]="Flag16thDown",n[n.Flag32ndUp=57924]="Flag32ndUp",n[n.Flag32ndDown=57925]="Flag32ndDown",n[n.Flag64thUp=57926]="Flag64thUp",n[n.Flag64thDown=57927]="Flag64thDown",n[n.Flag128thUp=57928]="Flag128thUp",n[n.Flag128thDown=57929]="Flag128thDown",n[n.Flag256thUp=57930]="Flag256thUp",n[n.Flag256thDown=57931]="Flag256thDown",n[n.AccidentalFlat=57952]="AccidentalFlat",n[n.AccidentalNatural=57953]="AccidentalNatural",n[n.AccidentalSharp=57954]="AccidentalSharp",n[n.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",n[n.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",n[n.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",n[n.AccidentalQuarterToneSharpNaturalArrowUp=57970]="AccidentalQuarterToneSharpNaturalArrowUp",n[n.AccidentalThreeQuarterTonesSharpArrowUp=57972]="AccidentalThreeQuarterTonesSharpArrowUp",n[n.RepeatDot=57412]="RepeatDot",n[n.Segno=57415]="Segno",n[n.Coda=57416]="Coda",n[n.ArticAccentAbove=58528]="ArticAccentAbove",n[n.ArticAccentBelow=58529]="ArticAccentBelow",n[n.ArticStaccatoAbove=58530]="ArticStaccatoAbove",n[n.ArticStaccatoBelow=58531]="ArticStaccatoBelow",n[n.ArticTenutoAbove=58532]="ArticTenutoAbove",n[n.ArticTenutoBelow=58533]="ArticTenutoBelow",n[n.ArticMarcatoAbove=58540]="ArticMarcatoAbove",n[n.ArticMarcatoBelow=58541]="ArticMarcatoBelow",n[n.FermataAbove=58560]="FermataAbove",n[n.FermataShortAbove=58564]="FermataShortAbove",n[n.FermataLongAbove=58566]="FermataLongAbove",n[n.RestLonga=58593]="RestLonga",n[n.RestDoubleWhole=58594]="RestDoubleWhole",n[n.RestWhole=58595]="RestWhole",n[n.RestHalf=58596]="RestHalf",n[n.RestQuarter=58597]="RestQuarter",n[n.Rest8th=58598]="Rest8th",n[n.Rest16th=58599]="Rest16th",n[n.Rest32nd=58600]="Rest32nd",n[n.Rest64th=58601]="Rest64th",n[n.Rest128th=58602]="Rest128th",n[n.Rest256th=58603]="Rest256th",n[n.RestHBarLeft=58607]="RestHBarLeft",n[n.RestHBarMiddle=58608]="RestHBarMiddle",n[n.RestHBarRight=58609]="RestHBarRight",n[n.Repeat1Bar=58624]="Repeat1Bar",n[n.Repeat2Bars=58625]="Repeat2Bars",n[n.Ottava=58640]="Ottava",n[n.OttavaAlta=58641]="OttavaAlta",n[n.OttavaBassaVb=58652]="OttavaBassaVb",n[n.Quindicesima=58644]="Quindicesima",n[n.QuindicesimaAlta=58645]="QuindicesimaAlta",n[n.DynamicPPPPPP=58663]="DynamicPPPPPP",n[n.DynamicPPPPP=58664]="DynamicPPPPP",n[n.DynamicPPPP=58665]="DynamicPPPP",n[n.DynamicPPP=58666]="DynamicPPP",n[n.DynamicPP=58667]="DynamicPP",n[n.DynamicPiano=58656]="DynamicPiano",n[n.DynamicMP=58668]="DynamicMP",n[n.DynamicMF=58669]="DynamicMF",n[n.DynamicPF=58670]="DynamicPF",n[n.DynamicForte=58658]="DynamicForte",n[n.DynamicFF=58671]="DynamicFF",n[n.DynamicFFF=58672]="DynamicFFF",n[n.DynamicFFFF=58673]="DynamicFFFF",n[n.DynamicFFFFF=58674]="DynamicFFFFF",n[n.DynamicFFFFFF=58675]="DynamicFFFFFF",n[n.DynamicFortePiano=58676]="DynamicFortePiano",n[n.DynamicNiente=58662]="DynamicNiente",n[n.DynamicSforzando1=58678]="DynamicSforzando1",n[n.DynamicSforzandoPiano=58679]="DynamicSforzandoPiano",n[n.DynamicSforzandoPianissimo=58680]="DynamicSforzandoPianissimo",n[n.DynamicSforzato=58681]="DynamicSforzato",n[n.DynamicSforzatoPiano=58682]="DynamicSforzatoPiano",n[n.DynamicSforzatoFF=58683]="DynamicSforzatoFF",n[n.DynamicRinforzando1=58684]="DynamicRinforzando1",n[n.DynamicRinforzando2=58685]="DynamicRinforzando2",n[n.DynamicForzando=58677]="DynamicForzando",n[n.DynamicCrescendoHairpin=58686]="DynamicCrescendoHairpin",n[n.GraceNoteSlashStemUp=58724]="GraceNoteSlashStemUp",n[n.GraceNoteSlashStemDown=58725]="GraceNoteSlashStemDown",n[n.OrnamentTrill=58726]="OrnamentTrill",n[n.OrnamentTurn=58727]="OrnamentTurn",n[n.OrnamentTurnInverted=58728]="OrnamentTurnInverted",n[n.OrnamentShortTrill=58732]="OrnamentShortTrill",n[n.OrnamentMordent=58733]="OrnamentMordent",n[n.StringsDownBow=58896]="StringsDownBow",n[n.StringsUpBow=58898]="StringsUpBow",n[n.KeyboardPedalPed=58960]="KeyboardPedalPed",n[n.KeyboardPedalUp=58965]="KeyboardPedalUp",n[n.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",n[n.GuitarString0=59443]="GuitarString0",n[n.GuitarString1=59444]="GuitarString1",n[n.GuitarString2=59445]="GuitarString2",n[n.GuitarString3=59446]="GuitarString3",n[n.GuitarString4=59447]="GuitarString4",n[n.GuitarString5=59448]="GuitarString5",n[n.GuitarString6=59449]="GuitarString6",n[n.GuitarString7=59450]="GuitarString7",n[n.GuitarString8=59451]="GuitarString8",n[n.GuitarString9=59452]="GuitarString9",n[n.GuitarOpenPedal=59453]="GuitarOpenPedal",n[n.GuitarClosePedal=59455]="GuitarClosePedal",n[n.GuitarGolpe=59458]="GuitarGolpe",n[n.GuitarFadeIn=59459]="GuitarFadeIn",n[n.GuitarFadeOut=59460]="GuitarFadeOut",n[n.GuitarVolumeSwell=59461]="GuitarVolumeSwell",n[n.FretboardFilledCircle=59480]="FretboardFilledCircle",n[n.FretboardX=59481]="FretboardX",n[n.FretboardO=59482]="FretboardO",n[n.Tuplet0=59520]="Tuplet0",n[n.Tuplet1=59521]="Tuplet1",n[n.Tuplet2=59522]="Tuplet2",n[n.Tuplet3=59523]="Tuplet3",n[n.Tuplet4=59524]="Tuplet4",n[n.Tuplet5=59525]="Tuplet5",n[n.Tuplet6=59526]="Tuplet6",n[n.Tuplet7=59527]="Tuplet7",n[n.Tuplet8=59528]="Tuplet8",n[n.Tuplet9=59529]="Tuplet9",n[n.TupletColon=59530]="TupletColon",n[n.WiggleTrill=60068]="WiggleTrill",n[n.GuitarVibratoStroke=60082]="GuitarVibratoStroke",n[n.GuitarWideVibratoStroke=60083]="GuitarWideVibratoStroke",n[n.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",n[n.WiggleSawtoothNarrow=60090]="WiggleSawtoothNarrow",n[n.WiggleSawtooth=60091]="WiggleSawtooth",n[n.OctaveBaselineM=60565]="OctaveBaselineM",n[n.OctaveBaselineB=60563]="OctaveBaselineB",n[n.GuitarLeftHandTapping=59456]="GuitarLeftHandTapping",n[n.Fingering0=60688]="Fingering0",n[n.Fingering1=60689]="Fingering1",n[n.Fingering2=60690]="Fingering2",n[n.Fingering3=60691]="Fingering3",n[n.Fingering4=60692]="Fingering4",n[n.Fingering5=60693]="Fingering5",n[n.FingeringPLower=60695]="FingeringPLower",n[n.FingeringTLower=60696]="FingeringTLower",n[n.FingeringILower=60697]="FingeringILower",n[n.FingeringMLower=60698]="FingeringMLower",n[n.FingeringALower=60699]="FingeringALower",n[n.FingeringCLower=60700]="FingeringCLower"})(S||(S={}));var Le;(function(n){n[n.None=0]="None",n[n.Natural=1]="Natural",n[n.Sharp=2]="Sharp",n[n.Flat=3]="Flat",n[n.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",n[n.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",n[n.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",n[n.DoubleSharp=7]="DoubleSharp",n[n.DoubleFlat=8]="DoubleFlat"})(Le||(Le={}));class C5{note=null;tone=new Ox;octave=0;get realValue(){return this.octave*12+this.tone.noteValue}}class Ox{noteValue;accidentalMode;constructor(e=0,t=Ue.Default){this.noteValue=e,this.accidentalMode=t}}class ce{static getIndex(e){return e<0?0:Math.log2(e)|0}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return e===0}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let i=0;i<t.tracks.length;i++){if(i<e.notation.displayTranspositionPitches.length)for(const s of t.tracks[i].staves)s.displayTranspositionPitch=-e.notation.displayTranspositionPitches[i];if(i<e.notation.transpositionPitches.length)for(const s of t.tracks[i].staves)s.transpositionPitch=-e.notation.transpositionPitches[i]}}static isTuning(e){return!!ce.parseTuning(e)}static tuningLetters=new Set([67,68,69,70,71,65,66,99,100,101,102,103,97,98,35]);static parseTuning(e){let t="",i="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o);if(c>=48&&c<=57){if(!t)return null;i+=String.fromCharCode(c)}else if(t.length===0)if(ce.tuningLetters.has(c))t+=String.fromCharCode(c);else return null;else t+=String.fromCharCode(c)}if(!i||!t)return null;const s=new C5;s.octave=Number.parseInt(i,10)+1,s.note=t.toLowerCase();const a=ce.getToneForText(s.note);return a===null?null:(s.tone=a,s.tone.noteValue<0&&(s.octave--,s.tone.noteValue+=12),s)}static getTuningForText(e){const t=ce.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){const t=e.substring(0,1),i=e.substring(1);let s,a;switch(t.toLowerCase()){case"c":s=0;break;case"d":s=2;break;case"e":s=4;break;case"f":s=5;break;case"g":s=7;break;case"a":s=9;break;case"b":s=11;break;default:return null}if(!ce.accidentalModeMapping.has(i))return null;switch(a=ce.parseAccidentalMode(i),a){case Ue.Default:break;case Ue.ForceNone:break;case Ue.ForceNatural:break;case Ue.ForceSharp:s++;break;case Ue.ForceDoubleSharp:s+=2;break;case Ue.ForceFlat:s--;break;case Ue.ForceDoubleFlat:s-=2;break}return new Ox(s,a)}static reverseAccidentalModeMapping=new Map([[Ue.Default,"d"],[Ue.ForceNone,"forcenone"],[Ue.ForceNatural,"forcenatural"],[Ue.ForceSharp,"#"],[Ue.ForceDoubleSharp,"x"],[Ue.ForceFlat,"b"],[Ue.ForceDoubleFlat,"bb"]]);static accidentalModeMapping=new Map([["default",Ue.Default],["d",Ue.Default],["",Ue.Default],["forcenone",Ue.ForceNone],["-",Ue.ForceNone],["forcenatural",Ue.ForceNatural],["n",Ue.ForceNatural],["forcesharp",Ue.ForceSharp],["#",Ue.ForceSharp],["forcedoublesharp",Ue.ForceDoubleSharp],["##",Ue.ForceDoubleSharp],["x",Ue.ForceDoubleSharp],["forceflat",Ue.ForceFlat],["b",Ue.ForceFlat],["forcedoubleflat",Ue.ForceDoubleFlat],["bb",Ue.ForceDoubleFlat]]);static parseAccidentalMode(e){const t=e.toLowerCase();return ce.accidentalModeMapping.has(t)?ce.accidentalModeMapping.get(t):Ue.Default}static newGuid(){return`${Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}${Math.floor((1+Math.random())*65536).toString(16).substring(1)}${Math.floor((1+Math.random())*65536).toString(16).substring(1)}`}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let i="";const s="0123456789ABCDEF";do i=String.fromCharCode(s.charCodeAt(e&15))+i,e=e>>4;while(e>0);for(;i.length<t;)i=`0${i}`;return i}static getAlternateEndingsList(e){const t=[];for(let i=0;i<Ka.MaxAlternateEndings;i++)(e&1<<i)!==0&&t.push(i);return t}static deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}static clamp(e,t,i){return e<=t?t:e>=i?i:e}static buildMultiBarRestInfo(e,t,i){if(!e)return null;const s=e[0].score.stylesheet;if(!(e.length>1?s.multiTrackMultiBarRest:s.perTrackMultiBarRest?.has(e[0].index)===!0))return null;const o=new Map,c=e[0].score;let h=t,d=c.tempo;for(;h<=i;){const p=h;let g=null;for(;h<=i;){const y=c.masterBars[h];let k=!1;for(const w of y.tempoAutomations)w.value!==d&&(k=!0),d=w.value;if(y.alternateEndings||y.isRepeatStart&&y.index!==p||y.isFreeTime||y.isAnacrusis||y.section!==null||y.index!==p&&k||y.fermata!==null&&y.fermata.size>0||y.directions!==null&&y.directions.size>0||p>t&&y.previousMasterBar&&(y.timeSignatureCommon!==y.previousMasterBar.timeSignatureCommon||y.timeSignatureNumerator!==y.previousMasterBar.timeSignatureNumerator||y.timeSignatureDenominator!==y.previousMasterBar.timeSignatureDenominator||y.tripletFeel!==y.previousMasterBar.tripletFeel))break;let _=!0;for(const w of e){for(const T of w.staves){const x=T.bars[y.index];if(!x.isRestOnly){_=!1;break}if(x.index>0&&(x.keySignature!==x.previousBar.keySignature||x.keySignatureType!==x.previousBar.keySignatureType)){_=!1;break}}if(!_)break}if(!_||(h++,y.index>p&&(g===null?g=[y.index]:g.push(y.index)),y.isRepeatEnd))break}g?o.set(p,g):h++}return o}static computeFirstDisplayedBarIndex(e,t){let i=t.display.startBar;return i--,i=Math.min(e.masterBars.length-1,Math.max(0,i)),i}static computeLastDisplayedBarIndex(e,t,i){let s=t.display.barCount;return s<0&&(s=e.masterBars.length),s=i+s-1,s=Math.min(e.masterBars.length-1,Math.max(0,s)),s}static getOrCreateHeaderFooterStyle(e,t){let i=e.style;e.style||(i=new $o,e.style=i);let s;if(i.headerAndFooter.has(t))s=i.headerAndFooter.get(t);else{if(s=new wn,$o.defaultHeaderAndFooter.has(t)){const a=$o.defaultHeaderAndFooter.get(t);s.template=a.template,s.textAlign=a.textAlign}i.headerAndFooter.set(t,s)}return s}static consolidate(e){if(e.masterBars.length===0){const i=new Ka;e.addMasterBar(i);const s=new jt;s.isLinear=!1,s.type=Mt.Tempo,s.value=e.tempo,i.tempoAutomations.push(s);const a=new gn;e.tracks[0].staves[0].addBar(a);const o=new An;a.addVoice(o);const c=new fs;c.isEmpty=!0,o.addBeat(c);return}const t=new Set([Xe.PercussionChannel]);for(const i of e.tracks){if(i.staves.length===1&&i.staves[0].isPercussion)i.playbackInfo.primaryChannel=Xe.PercussionChannel,i.playbackInfo.secondaryChannel=Xe.PercussionChannel;else{if(i.playbackInfo.primaryChannel!==Xe.PercussionChannel)for(;t.has(i.playbackInfo.primaryChannel);)i.playbackInfo.primaryChannel++;if(t.add(i.playbackInfo.primaryChannel),i.playbackInfo.secondaryChannel!==Xe.PercussionChannel)for(;t.has(i.playbackInfo.secondaryChannel);)i.playbackInfo.secondaryChannel++;t.add(i.playbackInfo.secondaryChannel)}for(const s of i.staves){for(const o of s.bars)for(const c of o.voices)if(c.isEmpty&&c.beats.length===0){const h=new fs;h.isEmpty=!0,c.addBeat(h)}const a=s.bars.length===0?1:s.bars[0].voices.length;for(;s.bars.length<e.masterBars.length;){const o=new gn;s.addBar(o);const c=o.previousBar;c&&(o.clef=c.clef,o.clefOttava=c.clefOttava,o.keySignature=o.previousBar.keySignature,o.keySignatureType=o.previousBar.keySignatureType);for(let h=0;h<a;h++){const d=new An;o.addVoice(d);const p=new fs;p.isEmpty=!0,d.addBeat(p)}}}}if(e.masterBars.length>0&&!e.masterBars[0].tempoAutomations.find(s=>s.type===Mt.Tempo&&s.ratioPosition===0)){const s=new jt;s.isLinear=!1,s.type=Mt.Tempo,s.value=e.tempo,s.text=e.tempoLabel,s.isVisible=!1,e.masterBars[0].tempoAutomations.push(s)}}static trimEmptyBarsAtEnd(e){for(;e.masterBars.length>1;){const t=e.masterBars.length-1,i=e.masterBars[t];if(i.hasChanges)return;for(const s of e.tracks)for(const a of s.staves)if(t<a.bars.length){const o=a.bars[t];if(!o.isEmpty||o.hasChanges)return}for(const s of e.tracks)for(const a of s.staves)if(t<a.bars.length){const o=a.bars[t];a.bars.pop(),o.previousBar.nextBar=null}e.masterBars.pop(),i.previousMasterBar.nextMasterBar=null}}static _allMusicFontSymbols=[];static getAllMusicFontSymbols(){return ce._allMusicFontSymbols.length===0&&(ce._allMusicFontSymbols=Object.values(S).filter(e=>typeof e=="number").map(e=>e)),ce._allMusicFontSymbols}static displayTranspositionPitches=new Map([[24,-12],[25,-12],[26,-12],[27,-12],[28,-12],[29,-12],[30,-12],[31,-12],[32,-12],[33,-12],[34,-12],[35,-12],[36,-12],[37,-12],[38,-12],[39,-12],[43,-12]]);static flooredDivision(e,t){return e-t*Math.floor(e/t)}static _translateKeyTransposeTable(e){const t=[];for(const i of e){const s=[];t.push(s);for(const a of i){const o=Number.parseInt(a.charAt(0),10)*(a.charAt(1)==="b"?-1:1);s.push(o)}}return t}static _keyTransposeTable=ce._translateKeyTransposeTable([["7b","6b","5b","4b","3b","2b","1b","0#","1#","2#","3#","4#","5#","6#","7#"],["2b","1b","0#","1#","2#","3#","4#","5#","6#","7#","4b","3b","2b","1b","0#"],["3#","4#","7b","6b","5b","4b","3b","2b","1b","0#","1#","2#","3#","4#","5#"],["4b","3b","2b","1b","0#","1#","2#","3#","4#","5#","6#","7#","4b","3b","2b"],["1#","2#","3#","4#","7b","6b","5b","4b","3b","2b","1b","0#","1#","2#","3#"],["6b","5b","4b","3b","2b","1b","0#","1#","2#","3#","4#","5#","6#","7#","4b"],["1b","0#","1#","2#","3#","4#","7b","6#","7#","4b","3b","2b","1b","0#","1#"],["4#","7b","6b","5b","4b","3b","2b","1b","0#","1#","2#","3#","4#","5#","6#"],["3b","2b","1b","0#","1#","2#","3#","4#","5#","6#","7#","4b","3b","2b","1b"],["2#","3#","4#","7b","6b","5b","4b","3b","2b","1b","0#","1#","2#","3#","4#"],["5b","4b","3b","2b","1b","0#","1#","2#","3#","4#","5#","6#","7#","4b","3b"],["0#","1#","2#","3#","4#","7b","6b","6#","4b","3b","2b","1b","0#","1#","2#"]]);static transposeKey(e,t){if(t===0)return e;if(t<0){const s=ce._keyTransposeTable[-t].indexOf(e);return s===-1?e:s-7}else return ce._keyTransposeTable[t][e+7]}static _keySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];static accidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];static computeAccidental(e,t,i,s,a=null){const c=e+7,h=i%12,d=c<7?Le.Flat:Le.Sharp,p=ce._keySignatureLookup[c][h],g=ce.accidentalNotes[h];let y=Le.None;if(s)switch(y=g?d:Le.Natural,y){case Le.Natural:y=Le.NaturalQuarterNoteUp;break;case Le.Sharp:y=Le.SharpQuarterNoteUp;break;case Le.Flat:y=Le.FlatQuarterNoteUp;break}else{switch(t){case Ue.ForceSharp:y=Le.Sharp;break;case Ue.ForceDoubleSharp:y=Le.DoubleSharp;break;case Ue.ForceFlat:y=Le.Flat;break;case Ue.ForceDoubleFlat:y=Le.DoubleFlat;break;default:g?y=d:p&&(y=Le.Natural);break}y!==Le.None?a!=null?a===y&&(y=Le.None):p&&y===d&&(y=Le.None):a!==null&&(a===Le.Natural?y=Le.None:y=Le.Natural)}return y}static toArticulationId(e){return e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}}var ds;(function(n){n[n.None=0]="None",n[n.Up=1]="Up",n[n.Down=2]="Down"})(ds||(ds={}));var Jt;(function(n){n[n.Above=0]="Above",n[n.Inside=1]="Inside",n[n.Below=2]="Below",n[n.Outside=3]="Outside"})(Jt||(Jt={}));class Pe{elementType;staffLine;noteHeadDefault;noteHeadHalf;noteHeadWhole;techniqueSymbol;techniqueSymbolPlacement;outputMidiNumber;constructor(e="",t=0,i=0,s=S.None,a=S.None,o=S.None,c=S.None,h=Jt.Inside){this.elementType=e,this.outputMidiNumber=i,this.staffLine=t,this.noteHeadDefault=s,this.noteHeadHalf=a!==S.None?a:s,this.noteHeadWhole=o!==S.None?o:s,this.techniqueSymbol=c,this.techniqueSymbolPlacement=h}getSymbol(e){switch(e){case M.Whole:return this.noteHeadWhole;case M.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class $i{static _gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]];static articulationFromElementVariation(e,t){return e<$i._gp6ElementAndVariationToArticulation.length?(t>=$i._gp6ElementAndVariationToArticulation.length&&(t=0),$i._gp6ElementAndVariationToArticulation[e][t]):38}static instrumentArticulations=new Map([[38,new Pe("snare",3,38,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[37,new Pe("snare",3,37,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[91,new Pe("snare",3,38,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[42,new Pe("hiHat",-1,42,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[92,new Pe("hiHat",-1,46,S.NoteheadCircleSlash,S.NoteheadCircleSlash,S.NoteheadCircleSlash)],[46,new Pe("hiHat",-1,46,S.NoteheadCircleX,S.NoteheadCircleX,S.NoteheadCircleX)],[44,new Pe("hiHat",9,44,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[35,new Pe("kickDrum",8,35,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[36,new Pe("kickDrum",7,36,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[50,new Pe("tom",1,50,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[48,new Pe("tom",2,48,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[47,new Pe("tom",4,47,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[45,new Pe("tom",5,45,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[43,new Pe("tom",6,43,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[93,new Pe("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.PictEdgeOfCymbal,Jt.Below)],[51,new Pe("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[53,new Pe("ride",0,53,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[94,new Pe("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,Jt.Above)],[55,new Pe("splash",-2,55,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[95,new Pe("splash",-2,55,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,Jt.Below)],[52,new Pe("china",-3,52,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat)],[96,new Pe("china",-3,52,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat)],[49,new Pe("crash",-2,49,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX)],[97,new Pe("crash",-2,49,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX,S.ArticStaccatoAbove,Jt.Below)],[57,new Pe("crash",-1,57,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX)],[98,new Pe("crash",-1,57,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX,S.ArticStaccatoAbove,Jt.Below)],[99,new Pe("cowbell",1,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[100,new Pe("cowbell",1,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[56,new Pe("cowbell",0,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[101,new Pe("cowbell",0,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[102,new Pe("cowbell",-1,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[103,new Pe("cowbell",-1,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[77,new Pe("woodblock",-9,77,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[76,new Pe("woodblock",-10,76,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[60,new Pe("bongo",-4,60,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[104,new Pe("bongo",-5,60,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,Jt.Inside)],[105,new Pe("bongo",-6,60,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[61,new Pe("bongo",-7,61,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[106,new Pe("bongo",-8,61,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,Jt.Inside)],[107,new Pe("bongo",-16,61,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[66,new Pe("timbale",10,66,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[65,new Pe("timbale",9,65,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[68,new Pe("agogo",12,68,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[67,new Pe("agogo",11,67,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[64,new Pe("conga",17,64,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[108,new Pe("conga",16,64,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[109,new Pe("conga",15,64,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,Jt.Inside)],[63,new Pe("conga",14,63,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[110,new Pe("conga",13,63,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[62,new Pe("conga",19,62,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,Jt.Inside)],[72,new Pe("whistle",-11,72,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[71,new Pe("whistle",-17,71,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[73,new Pe("guiro",38,73,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[74,new Pe("guiro",37,74,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[86,new Pe("surdo",36,86,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[87,new Pe("surdo",35,87,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadParenthesis,Jt.Inside)],[54,new Pe("tambourine",3,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[111,new Pe("tambourine",2,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.StringsUpBow,Jt.Below)],[112,new Pe("tambourine",1,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.StringsDownBow,Jt.Below)],[113,new Pe("tambourine",-7,54,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[79,new Pe("cuica",30,79,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[78,new Pe("cuica",29,78,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[58,new Pe("vibraslap",28,58,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[81,new Pe("triangle",27,81,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[80,new Pe("triangle",26,80,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadParenthesis,Jt.Inside)],[114,new Pe("grancassa",25,43,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[115,new Pe("piatti",18,49,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[116,new Pe("piatti",24,49,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[69,new Pe("cabasa",23,69,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[117,new Pe("cabasa",22,69,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,Jt.Below)],[85,new Pe("castanets",21,85,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[75,new Pe("claves",20,75,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[70,new Pe("maraca",-12,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[118,new Pe("maraca",-13,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,Jt.Below)],[119,new Pe("maraca",-14,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[120,new Pe("maraca",-15,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,Jt.Below)],[82,new Pe("shaker",-23,54,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[122,new Pe("shaker",-24,54,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,Jt.Below)],[84,new Pe("bellTree",-18,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[123,new Pe("bellTree",-19,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,Jt.Below)],[83,new Pe("jingleBell",-20,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[124,new Pe("unpitched",-21,62,S.NoteheadNull,S.NoteheadNull,S.NoteheadNull,S.GuitarGolpe,Jt.Above)],[125,new Pe("unpitched",-22,62,S.NoteheadNull,S.NoteheadNull,S.NoteheadNull,S.GuitarGolpe,Jt.Below)],[39,new Pe("handClap",3,39,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[40,new Pe("snare",3,40,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[31,new Pe("snare",3,40,S.NoteheadSlashedBlack2,S.NoteheadSlashedBlack2,S.NoteheadSlashedBlack2)],[41,new Pe("tom",5,41,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[59,new Pe("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.PictEdgeOfCymbal,Jt.Below)],[126,new Pe("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[127,new Pe("ride",2,59,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[29,new Pe("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,Jt.Above)],[30,new Pe("crash",-3,49,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[33,new Pe("snare",3,37,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[34,new Pe("snare",3,38,S.NoteheadBlack,S.NoteheadBlack,S.NoteheadBlack)]]);static instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Bongo high (hit)",60],["Bongo low (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);static getArticulationName(e){const t=$i.getArticulation(e);let i=e.percussionArticulation;t&&(i=t.outputMidiNumber);for(const[s,a]of $i.instrumentArticulationNames)if(a===i)return s;return"unknown"}static getArticulation(e){const t=e.percussionArticulation;if(t<0)return null;const i=e.beat.voice.bar.staff.track.percussionArticulations;return t<i.length?i[t]:$i.getArticulationByInputMidiNumber(t)}static getElementAndVariation(e){const t=$i.getArticulation(e);if(!t)return[-1,-1];for(let i=0;i<$i._gp6ElementAndVariationToArticulation.length;i++){const s=$i._gp6ElementAndVariationToArticulation[i];for(let a=0;a<s.length;a++)if($i.getArticulationByInputMidiNumber(s[a])?.outputMidiNumber===t.outputMidiNumber)return[i,a]}return[-1,-1]}static getArticulationByInputMidiNumber(e){return $i.instrumentArticulations.has(e)?$i.instrumentArticulations.get(e):null}}var fi;(function(n){n[n.None=0]="None",n[n.InvertedTurn=1]="InvertedTurn",n[n.Turn=2]="Turn",n[n.UpperMordent=3]="UpperMordent",n[n.LowerMordent=4]="LowerMordent"})(fi||(fi={}));class Lo{tieDestinationNoteId=-1;tieOriginNoteId=-1;slurDestinationNoteId=-1;slurOriginNoteId=-1;hammerPullDestinationNoteId=-1;hammerPullOriginNoteId=-1;slideTargetNoteId=-1;slideOriginNoteId=-1}var Js;(function(n){n[n.Effects=0]="Effects",n[n.StandardNotationNoteHead=1]="StandardNotationNoteHead",n[n.StandardNotationAccidentals=2]="StandardNotationAccidentals",n[n.StandardNotationEffects=3]="StandardNotationEffects",n[n.GuitarTabFretNumber=4]="GuitarTabFretNumber",n[n.GuitarTabEffects=5]="GuitarTabEffects",n[n.SlashNoteHead=6]="SlashNoteHead",n[n.SlashEffects=7]="SlashEffects",n[n.NumberedNumber=8]="NumberedNumber",n[n.NumberedAccidentals=9]="NumberedAccidentals",n[n.NumberedEffects=10]="NumberedEffects"})(Js||(Js={}));class Bb extends Vl{noteHead;noteHeadCenterOnStem}class es{static globalNoteId=0;static resetIds(){es.globalNoteId=0}id=es.globalNoteId++;index=0;accentuated=mi.None;bendType=Ae.None;bendStyle=Kt.Default;bendOrigin=null;isContinuedBend=!1;bendPoints=null;maxBendPoint=null;get hasBend(){return this.bendPoints!==null&&this.bendType!==Ae.None}get isStringed(){return this.string>=0}fret=-1;string=-1;showStringNumber=!1;get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}octave=-1;tone=-1;get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?$i.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?$i.getElementAndVariation(this)[1]:-1}percussionArticulation=-1;isVisible=!0;isLeftHandTapped=!1;isHammerPullOrigin=!1;get isHammerPullDestination(){return!!this.hammerPullOrigin}hammerPullOrigin=null;hammerPullDestination=null;get isSlurOrigin(){return!!this.slurDestination}isSlurDestination=!1;slurOrigin=null;slurDestination=null;get isHarmonic(){return this.harmonicType!==Re.None}harmonicType=Re.None;harmonicValue=0;isGhost=!1;isLetRing=!1;letRingDestination=null;isPalmMute=!1;palmMuteDestination=null;isDead=!1;isStaccato=!1;slideInType=Ji.None;slideOutType=$e.None;slideTarget=null;slideOrigin=null;vibrato=ct.None;tieOrigin=null;tieDestination=null;isTieDestination=!1;get isTieOrigin(){return this.tieDestination!==null}leftHandFinger=Fe.Unknown;rightHandFinger=Fe.Unknown;get isFingering(){return this.leftHandFinger!==Fe.Unknown||this.rightHandFinger!==Fe.Unknown}trillValue=-1;get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}trillSpeed=M.ThirtySecond;durationPercent=1;accidentalMode=Ue.Default;beat;dynamics=Oe.F;isEffectSlurOrigin=!1;hasEffectSlur=!1;get isEffectSlurDestination(){return!!this.effectSlurOrigin}effectSlurOrigin=null;effectSlurDestination=null;ornament=fi.None;style;get stringTuning(){return this.beat.voice.bar.staff.capo+es.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,t){return e.tuning.length>0?e.tuning[e.tuning.length-(t-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,t){const i=e?this.beat.voice.bar.staff.transpositionPitch:0;if(t){let s=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===Re.Natural?s=this.harmonicPitch+this.stringTuning-i:s+=this.harmonicPitch),s}return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-i:this.isPiano?this.octave*12+this.tone-i:0}get harmonicPitch(){if(this.harmonicType===Re.None||!this.isStringed)return 0;const e=this.harmonicValue;return ce.isAlmostEqualTo(e,2.4)?36:ce.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==Re.Natural&&this.harmonicType!==Re.None&&(e-=this.harmonicPitch),this.beat.ottava){case Ye._15ma:e-=24;break;case Ye._8va:e-=12;break;case Ye.Regular:break;case Ye._8vb:e+=12;break;case Ye._15mb:e+=24;break}switch(this.beat.voice.bar.clefOttava){case Ye._15ma:e-=24;break;case Ye._8va:e-=12;break;case Ye.Regular:break;case Ye._8vb:e+=12;break;case Ye._15mb:e+=24;break}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!==0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!==0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!==0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!==0:!1}addBendPoint(e){let t=this.bendPoints;t===null&&(t=[],this.bendPoints=t),t.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===Ae.None&&(this.bendType=Ae.Custom)}finish(e,t=null){const i=new Zc(()=>es.nextNoteOnSameLine(this)),s=e&&e.notation.notationMode===Ps.SongBook;if(this.isTieDestination&&(this.chain(t),s&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(!i.value||!i.value.isLetRing?this.letRingDestination=this:this.letRingDestination=i.value,s&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(!i.value||!i.value.isPalmMute?this.palmMuteDestination=this:this.palmMuteDestination=i.value),this.isHammerPullOrigin){const h=es.findHammerPullDestination(this);h?(this.hammerPullDestination=h,h.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case $e.Shift:case $e.Legato:this.slideTarget||(this.slideTarget=i.value),this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=$e.None;break}let a=null;this.isHammerPullOrigin&&this.hammerPullDestination?a=this.hammerPullDestination:this.slideOutType===$e.Legato&&this.slideTarget&&(a=this.slideTarget),a&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===ds.None?(this.effectSlurOrigin.effectSlurDestination=a,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=a,this.effectSlurDestination.effectSlurOrigin=this));const o=this.bendPoints,c=o!=null&&o.length>0;if(c){const h=this.isTieDestination&&this.tieOrigin.hasBend;this.isContinuedBend=h}else this.bendType=Ae.None;if(c&&this.bendType===Ae.Custom){if(o.length===4){const h=o[0],d=o[1],p=o[2],g=o[3];d.value===p.value?g.value>h.value?d.value>g.value?this.bendType=Ae.BendRelease:!this.isContinuedBend&&h.value>0?(this.bendType=Ae.PrebendBend,o.splice(2,1),o.splice(1,1)):(this.bendType=Ae.Bend,o.splice(2,1),o.splice(1,1)):g.value<h.value?this.isContinuedBend?(this.bendType=Ae.Release,o.splice(2,1),o.splice(1,1)):(this.bendType=Ae.PrebendRelease,o.splice(2,1),o.splice(1,1)):d.value>h.value?this.bendType=Ae.BendRelease:h.value>0&&!this.isContinuedBend?(this.bendType=Ae.Prebend,o.splice(2,1),o.splice(1,1)):(this.bendType=Ae.Hold,o.splice(2,1),o.splice(1,1)):ee.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(o.length===2){const h=o[0],d=o[1];d.value>h.value?!this.isContinuedBend&&h.value>0?this.bendType=Ae.PrebendBend:this.bendType=Ae.Bend:d.value<h.value?this.isContinuedBend?this.bendType=Ae.Release:this.bendType=Ae.PrebendRelease:h.value>0&&!this.isContinuedBend?this.bendType=Ae.Prebend:this.bendType=Ae.Hold}}this.initialBendValue>0&&(this.accidentalMode=Ue.Default)}static _maxOffsetForSameLineSearch=3;static nextNoteOnSameLine(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+es._maxOffsetForSameLineSearch;){const i=t.getNoteOnString(e.string);if(i)return i;t=t.nextBeat}return null}static findHammerPullDestination(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+es._maxOffsetForSameLineSearch;){let i=t.getNoteOnString(e.string);if(i)return i;for(let s=e.string;s>0;s--)if(i=t.getNoteOnString(s),i){if(i.isLeftHandTapped)return i;break}for(let s=e.string;s<=e.beat.voice.bar.staff.tuning.length;s++)if(i=t.getNoteOnString(s),i){if(i.isLeftHandTapped)return i;break}t=t.nextBeat}return null}static findTieOrigin(e){let t=e.beat.previousBeat;for(;t&&t.voice.bar.index>=e.beat.voice.bar.index-es._maxOffsetForSameLineSearch;){if(e.isStringed){const i=t.getNoteOnString(e.string);if(i)return i}else if(e.octave===-1&&e.tone===-1){if(e.index<t.notes.length)return t.notes[e.index]}else{const i=t.getNoteWithRealValue(e.realValue);if(i)return i}t=t.previousBeat}return null}static _noteIdLookupKey="NoteIdLookup";_noteIdBag=null;chain(e=null){if(e!==null)if(this._noteIdBag!==null){let t;e.has(es._noteIdLookupKey)?t=e.get(es._noteIdLookupKey):(t=new Map,e.set(es._noteIdLookupKey,t)),(this._noteIdBag.hammerPullDestinationNoteId!==-1||this._noteIdBag.tieDestinationNoteId!==-1||this._noteIdBag.slurDestinationNoteId!==-1||this._noteIdBag.slideTargetNoteId!==-1)&&t.set(this.id,this),this._noteIdBag.hammerPullOriginNoteId!==-1&&(this.hammerPullOrigin=t.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),this._noteIdBag.tieOriginNoteId!==-1&&(this.tieOrigin=t.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),this._noteIdBag.slurOriginNoteId!==-1&&(this.slurOrigin=t.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),this._noteIdBag.slideOriginNoteId!==-1&&(this.slideOrigin=t.get(this._noteIdBag.slideOriginNoteId),this.slideOrigin.slideTarget=this),this._noteIdBag=null}else{if(!this.isTieDestination&&this.tieOrigin===null)return;const t=this.tieOrigin??es.findTieOrigin(this);t?(t.tieDestination=this,this.tieOrigin=t,this.fret=t.fret,this.octave=t.octave,this.tone=t.tone,t.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){this.tieDestination!==null&&e.set("tiedestinationnoteid",this.tieDestination.id),this.tieOrigin!==null&&e.set("tieoriginnoteid",this.tieOrigin.id),this.slurDestination!==null&&e.set("slurdestinationnoteid",this.slurDestination.id),this.slurOrigin!==null&&e.set("sluroriginnoteid",this.slurOrigin.id),this.hammerPullOrigin!==null&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),this.hammerPullDestination!==null&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id),this.slideTarget!==null&&e.set("slidetargetnoteid",this.slideTarget.id),this.slideOrigin!==null&&e.set("slideoriginnoteid",this.slideOrigin.id)}setProperty(e,t){switch(e){case"tiedestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.tieDestinationNoteId=t,!0;case"tieoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.tieOriginNoteId=t,!0;case"slurdestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.slurDestinationNoteId=t,!0;case"sluroriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.slurOriginNoteId=t,!0;case"hammerpulloriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.hammerPullOriginNoteId=t,!0;case"hammerpulldestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.hammerPullDestinationNoteId=t,!0;case"slidetargetnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.slideTargetNoteId=t,!0;case"slideoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Lo),this._noteIdBag.slideOriginNoteId=t,!0}return!1}}class xa{static _halfTicks=1920;static _quarterTicks=960;static _eighthTicks=480;static _sixteenthTicks=240;static _thirtySecondTicks=120;static _sixtyFourthTicks=60;static _oneHundredTwentyEighthTicks=30;static _twoHundredFiftySixthTicks=15;static _allTicks=[xa._halfTicks,xa._quarterTicks,xa._eighthTicks,xa._sixteenthTicks,xa._thirtySecondTicks,xa._sixtyFourthTicks,xa._oneHundredTwentyEighthTicks,xa._twoHundredFiftySixthTicks];_isEqualLengthTuplet=!0;totalDuration=0;beats=[];voice;isFull=!1;constructor(e){this.voice=e}check(e){if(this.beats.length===0)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==De.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{const t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(const i of xa._allTicks)if(this.totalDuration===i*t){this.isFull=!0;break}}return!0}}var Dt;(function(n){n[n.None=0]="None",n[n.Custom=1]="Custom",n[n.Dive=2]="Dive",n[n.Dip=3]="Dip",n[n.Hold=4]="Hold",n[n.Predive=5]="Predive",n[n.PrediveDive=6]="PrediveDive"})(Dt||(Dt={}));var qs;(function(n){n[n.None=0]="None",n[n.Thumb=1]="Thumb",n[n.Finger=2]="Finger"})(qs||(qs={}));var Xi;(function(n){n[n.None=0]="None",n[n.FadeIn=1]="FadeIn",n[n.FadeOut=2]="FadeOut",n[n.VolumeSwell=3]="VolumeSwell"})(Xi||(Xi={}));var an;(function(n){n[n.None=0]="None",n[n.Open=1]="Open",n[n.Closed=2]="Closed"})(an||(an={}));var Yn;(function(n){n[n.None=0]="None",n[n.Full=1]="Full",n[n.Half=2]="Half"})(Yn||(Yn={}));var We;(function(n){n[n.None=0]="None",n[n.Ii=1]="Ii",n[n.Mi=2]="Mi",n[n.MiiTriplet=3]="MiiTriplet",n[n.MiiAnapaest=4]="MiiAnapaest",n[n.PmpTriplet=5]="PmpTriplet",n[n.PmpAnapaest=6]="PmpAnapaest",n[n.PeiTriplet=7]="PeiTriplet",n[n.PeiAnapaest=8]="PeiAnapaest",n[n.PaiTriplet=9]="PaiTriplet",n[n.PaiAnapaest=10]="PaiAnapaest",n[n.AmiTriplet=11]="AmiTriplet",n[n.AmiAnapaest=12]="AmiAnapaest",n[n.Ppp=13]="Ppp",n[n.Amii=14]="Amii",n[n.Amip=15]="Amip",n[n.Eami=16]="Eami",n[n.Eamii=17]="Eamii",n[n.Peami=18]="Peami"})(We||(We={}));var ei;(function(n){n[n.Auto=0]="Auto",n[n.ForceSplitToNext=1]="ForceSplitToNext",n[n.ForceMergeWithNext=2]="ForceMergeWithNext",n[n.ForceSplitOnSecondaryToNext=3]="ForceSplitOnSecondaryToNext"})(ei||(ei={}));var ti;(function(n){n[n.Effects=0]="Effects",n[n.StandardNotationStem=1]="StandardNotationStem",n[n.StandardNotationFlags=2]="StandardNotationFlags",n[n.StandardNotationBeams=3]="StandardNotationBeams",n[n.StandardNotationTuplet=4]="StandardNotationTuplet",n[n.StandardNotationEffects=5]="StandardNotationEffects",n[n.StandardNotationRests=6]="StandardNotationRests",n[n.GuitarTabStem=7]="GuitarTabStem",n[n.GuitarTabFlags=8]="GuitarTabFlags",n[n.GuitarTabBeams=9]="GuitarTabBeams",n[n.GuitarTabTuplet=10]="GuitarTabTuplet",n[n.GuitarTabEffects=11]="GuitarTabEffects",n[n.GuitarTabRests=12]="GuitarTabRests",n[n.SlashStem=13]="SlashStem",n[n.SlashFlags=14]="SlashFlags",n[n.SlashBeams=15]="SlashBeams",n[n.SlashTuplet=16]="SlashTuplet",n[n.SlashRests=17]="SlashRests",n[n.SlashEffects=18]="SlashEffects",n[n.NumberedDuration=19]="NumberedDuration",n[n.NumberedEffects=20]="NumberedEffects",n[n.NumberedRests=21]="NumberedRests",n[n.NumberedTuplet=22]="NumberedTuplet"})(ti||(ti={}));class Fx extends Vl{}class fs{static _globalBeatId=0;static resetIds(){fs._globalBeatId=0}id=fs._globalBeatId++;index=0;previousBeat=null;nextBeat=null;get isLastOfVoice(){return this.index===this.voice.beats.length-1}voice;notes=[];noteStringLookup=new Map;noteValueLookup=new Map;isEmpty=!1;whammyStyle=Kt.Default;ottava=Ye.Regular;fermata=null;isLegatoOrigin=!1;get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}minNote=null;maxNote=null;maxStringNote=null;minStringNote=null;duration=M.Quarter;get isRest(){return this.isEmpty||!this.deadSlapped&&this.notes.length===0}get isFullBarRest(){return this.isRest&&this.voice.beats.length===1&&this.duration===M.Whole}isLetRing=!1;isPalmMute=!1;automations=[];dots=0;get fadeIn(){return this.fade===Xi.FadeIn}set fadeIn(e){this.fade=e?Xi.FadeIn:Xi.None}fade=Xi.None;lyrics=null;get hasRasgueado(){return this.rasgueado!==We.None}pop=!1;slap=!1;tap=!1;text=null;slashed=!1;deadSlapped=!1;brushType=Ne.None;brushDuration=0;tupletDenominator=-1;tupletNumerator=-1;get hasTuplet(){return!(this.tupletDenominator===-1&&this.tupletNumerator===-1)&&!(this.tupletDenominator===1&&this.tupletNumerator===1)}tupletGroup=null;isContinuedWhammy=!1;whammyBarType=Dt.None;whammyBarPoints=null;maxWhammyPoint=null;minWhammyPoint=null;get hasWhammyBar(){return this.whammyBarPoints!==null&&this.whammyBarType!==Dt.None}vibrato=ct.None;chordId=null;get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}graceType=De.None;graceGroup=null;graceIndex=-1;pickStroke=ds.None;get isTremolo(){return!!this.tremoloSpeed}tremoloSpeed=null;crescendo=Ds.None;displayStart=0;get displayEnd(){return this.displayStart+this.displayDuration}playbackStart=0;displayDuration=0;playbackDuration=0;overrideDisplayDuration;golpe=qs.None;get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}dynamics=Oe.F;invertBeamDirection=!1;preferredBeamDirection=null;isEffectSlurOrigin=!1;get isEffectSlurDestination(){return!!this.effectSlurOrigin}effectSlurOrigin=null;effectSlurDestination=null;beamingMode=ei.Auto;wahPedal=an.None;barreFret=-1;barreShape=Yn.None;get isBarre(){return this.barreShape!==Yn.None&&this.barreFret>=0}rasgueado=We.None;showTimer=!1;timer=null;style;addWhammyBarPoint(e){let t=this.whammyBarPoints;t===null&&(t=[],this.whammyBarPoints=t),t.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===Dt.None&&(this.whammyBarType=Dt.Custom)}removeWhammyBarPoint(e){const t=this.whammyBarPoints;if(t===null||e<0||e>=t.length)return;t.splice(e,1);const i=t[e];if(i===this.maxWhammyPoint){this.maxWhammyPoint=null;for(const s of t)(!this.maxWhammyPoint||s.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=s)}if(i===this.minWhammyPoint){this.minWhammyPoint=null;for(const s of t)(!this.minWhammyPoint||s.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=s)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){const t=this.notes.indexOf(e);t>=0&&(this.notes.splice(t,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let t=0,i=this.automations.length;t<i;t++){const s=this.automations[t];if(s.type===e)return s}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}_calculateDuration(){if(this.overrideDisplayDuration!==void 0)return this.overrideDisplayDuration;if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=$.toTicks(this.duration);return this.dots===2?e=$.applyDot(e,!0):this.dots===1&&(e=$.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=$.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){const e=this._calculateDuration();switch(this.playbackDuration=e,this.graceType){case De.BeforeBeat:case De.OnBeat:switch(this.duration){case M.Sixteenth:this.playbackDuration=$.toTicks(M.SixtyFourth);break;case M.ThirtySecond:this.playbackDuration=$.toTicks(M.OneHundredTwentyEighth);break;default:this.playbackDuration=$.toTicks(M.ThirtySecond);break}this.displayDuration=0;break;case De.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;const t=this.previousBeat;t&&t.graceType===De.BendGrace&&(this.playbackDuration=t.playbackDuration);break}}finishTuplet(){const e=this.previousBeat;let t=e?e.tupletGroup:null;(this.hasTuplet||this.graceType!==De.None&&t)&&((!e||!t||!t.check(this))&&(t=new xa(this.voice),t.check(this)),this.tupletGroup=t);const i=this.voice.bar.masterBar.calculateDuration(!1),s=[];for(const a of this.automations)a.ratioPosition===0&&(a.ratioPosition=this.playbackStart/i),a.type!==Mt.Tempo&&s.push(a);this.automations=s}finish(e,t=null){switch(this.getAutomation(Mt.Instrument)===null&&this.index===0&&this.voice.index===0&&this.voice.bar.index===0&&this.voice.bar.staff.index===0&&this.automations.push(jt.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case De.OnBeat:case De.BeforeBeat:const p=this.graceGroup.beats.length;p===1?this.duration=M.Eighth:p===2?this.duration=M.Sixteenth:this.duration=M.ThirtySecond;break}this.brushType===Ne.None&&(this.brushDuration=0);const i=e?e.notation.notationMode:Ps.GuitarPro;let s=this.text==="grad"||this.text==="grad.";s&&i===Ps.SongBook&&(this.text="");let a=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let o=0,c=!1;for(let p=0,g=this.notes.length;p<g;p++){const y=this.notes[p];if(y.dynamics=this.dynamics,y.finish(e,t),y.isLetRing&&(this.isLetRing=!0),y.isPalmMute&&(this.isPalmMute=!0),i===Ps.SongBook&&y.hasBend&&this.graceType!==De.BendGrace){if(!y.isTieOrigin)switch(y.bendType){case Ae.Bend:case Ae.PrebendRelease:case Ae.PrebendBend:a=!0;break}s||y.bendStyle===Kt.Gradual?(s=!0,y.bendStyle=Kt.Gradual,a=!1):y.bendStyle=Kt.Fast}y.isVisible&&(o++,(!this.minNote||y.realValue<this.minNote.realValue)&&(this.minNote=y),(!this.maxNote||y.realValue>this.maxNote.realValue)&&(this.maxNote=y),(!this.minStringNote||y.string<this.minStringNote.string)&&(this.minStringNote=y),(!this.maxStringNote||y.string>this.maxStringNote.string)&&(this.maxStringNote=y),y.hasEffectSlur&&(c=!0))}if(c&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&o===0&&(this.isEmpty=!0),!this.isRest&&(!this.isLetRing||!this.isPalmMute)){let p=this.previousBeat;for(;p&&p.isRest;)this.isLetRing||(p.isLetRing=!1),this.isPalmMute||(p.isPalmMute=!1),p=p.previousBeat}else this.isRest&&this.previousBeat&&e&&e.notation.notationMode===Ps.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));const h=this.whammyBarPoints,d=h!==null&&h.length>0;if(d){const p=!!this.previousBeat&&this.previousBeat.hasWhammyBar;this.isContinuedWhammy=p}else this.whammyBarType=Dt.None;if(d&&this.whammyBarType===Dt.Custom){if(i===Ps.SongBook&&(this.whammyStyle=s?Kt.Gradual:Kt.Fast),h.length===4){const p=h[0],g=h[1],y=h[2],k=h[3];g.value===y.value&&(p.value<g.value&&g.value<k.value||p.value>g.value&&g.value>k.value?(p.value!==0&&!this.isContinuedWhammy?this.whammyBarType=Dt.PrediveDive:this.whammyBarType=Dt.Dive,h.splice(2,1),h.splice(1,1)):p.value>g.value&&g.value<k.value||p.value<g.value&&g.value>k.value?(this.whammyBarType=Dt.Dip,(g.offset===y.offset||i===Ps.SongBook)&&h.splice(2,1)):p.value===g.value&&g.value===k.value&&(p.value!==0&&!this.isContinuedWhammy?this.whammyBarType=Dt.Predive:this.whammyBarType=Dt.Hold,h.splice(2,1),h.splice(1,1)))}else if(h.length===2){const p=h[0],g=h[1];p.value<g.value||p.value>g.value?p.value!==0&&!this.isContinuedWhammy?this.whammyBarType=Dt.PrediveDive:this.whammyBarType=Dt.Dive:p.value===g.value&&(p.value!==0&&!this.isContinuedWhammy?this.whammyBarType=Dt.Predive:this.whammyBarType=Dt.Hold)}}if(this.updateDurations(),a){const p=Tb.clone(this);p.id=fs._globalBeatId++,p.pickStroke=ds.None;for(let g=0,y=p.notes.length;g<y;g++){const k=p.notes[g],_=this.notes[g];if(k.bendType=Ae.None,k.maxBendPoint=null,k.bendPoints=null,k.bendStyle=Kt.Default,k.id=es.globalNoteId++,_.isTieOrigin&&(k.tieDestination=_.tieDestination,_.tieDestination.tieOrigin=k),_.isTieDestination&&(k.tieOrigin=_.tieOrigin?_.tieOrigin:null,_.tieOrigin.tieDestination=k),_.hasBend&&_.isTieOrigin){const w=es.findTieOrigin(_);if(w&&w.hasBend){k.bendType=Ae.Hold;const T=_.bendPoints[_.bendPoints.length-1];k.addBendPoint(new ke(0,T.value)),k.addBendPoint(new ke(ke.MaxPosition,T.value))}}k.isTieDestination=!0}this.graceType=De.BendGrace,this.graceGroup=new sp,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,p),p.graceGroup=new sp,p.graceGroup.addBeat(this),p.graceGroup.isComplete=!0,p.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const t of this.notes)this.noteValueLookup.set(t.realValue,t),t.chain(e)}}class Ix{static clone(e){const t=new ke;return t.offset=e.offset,t.value=e.value,t}}class Wx{static clone(e){const t=new es;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const i of e.bendPoints)t.addBendPoint(Ix.clone(i))}return t.fret=e.fret,t.string=e.string,t.showStringNumber=e.showStringNumber,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t.ornament=e.ornament,t}}class E5{static clone(e){const t=new td;return t.barOccurence=e.barOccurence,t.millisecondOffset=e.millisecondOffset,t}}class P5{static clone(e){const t=new jt;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.syncPointValue=e.syncPointValue?E5.clone(e.syncPointValue):void 0,t.ratioPosition=e.ratioPosition,t.text=e.text,t.isVisible=e.isVisible,t}}class Tb{static clone(e){const t=new fs;t.index=e.index,t.notes=[];for(const i of e.notes)t.addNote(Wx.clone(i));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const i of e.automations)t.automations.push(P5.clone(i));if(t.dots=e.dots,t.fade=e.fade,t.lyrics=e.lyrics?e.lyrics.slice():null,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.slashed=e.slashed,t.deadSlapped=e.deadSlapped,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const i of e.whammyBarPoints)t.addWhammyBarPoint(Ix.clone(i))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.overrideDisplayDuration=e.overrideDisplayDuration,t.golpe=e.golpe,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t.wahPedal=e.wahPedal,t.barreFret=e.barreFret,t.barreShape=e.barreShape,t.rasgueado=e.rasgueado,t.showTimer=e.showTimer,t.timer=e.timer,t}}class xe{static _reverse(e){const t=new Map;for(const[i,s]of e)t.has(s)||t.set(s,i);return t}static whammyType=new Map([["custom",1],["dive",2],["dip",3],["hold",4],["predive",5],["predivedive",6]]);static whammyTypeReversed=xe._reverse(xe.whammyType);static bendStyle=new Map([["default",0],["gradual",1],["fast",2]]);static bendStyleReversed=xe._reverse(xe.bendStyle);static graceType=new Map([["onbeat",1],["beforebeat",2],["bendgrace",3],["ob",1],["bb",2],["b",3]]);static graceTypeReversed=xe._reverse(xe.graceType);static fermataType=new Map([["short",0],["medium",1],["long",2]]);static fermataTypeReversed=xe._reverse(xe.fermataType);static alphaTexAccidentalMode=new Map([["auto",0],["explicit",1]]);static alphaTexAccidentalModeReversed=xe._reverse(xe.alphaTexAccidentalMode);static noteAccidentalMode=new Map([["default",0],["forcenone",1],["forcenatural",2],["forcesharp",3],["forcedoublesharp",4],["forceflat",5],["forcedoubleflat",6],["d",0],["-",1],["n",2],["#",3],["##",4],["x",4],["b",5],["bb",6]]);static noteAccidentalModeReversed=xe._reverse(xe.noteAccidentalMode);static barreShape=new Map([["full",1],["half",2]]);static barreShapeReversed=xe._reverse(xe.barreShape);static ottavia=new Map([["15ma",0],["8va",1],["regular",2],["8vb",3],["15mb",4],["15ma",0],["8va",1],["8vb",3],["15mb",4]]);static ottaviaReversed=xe._reverse(xe.ottavia);static rasgueado=new Map([["ii",1],["mi",2],["miitriplet",3],["miianapaest",4],["pmptriplet",5],["pmpanapaest",6],["peitriplet",7],["peianapaest",8],["paitriplet",9],["paianapaest",10],["amitriplet",11],["amianapaest",12],["ppp",13],["amii",14],["amip",15],["eami",16],["eamii",17],["peami",18]]);static rasgueadoReversed=xe._reverse(xe.rasgueado);static dynamicValue=new Map([["ppp",0],["pp",1],["p",2],["mp",3],["mf",4],["f",5],["ff",6],["fff",7],["pppp",8],["ppppp",9],["pppppp",10],["ffff",11],["fffff",12],["ffffff",13],["sf",14],["sfp",15],["sfpp",16],["fp",17],["rf",18],["rfz",19],["sfz",20],["sffz",21],["fz",22],["n",23],["pf",24],["sfzp",25]]);static dynamicValueReversed=xe._reverse(xe.dynamicValue);static bracketExtendMode=new Map([["nobrackets",0],["groupstaves",1],["groupsimilarinstruments",2]]);static bracketExtendModeReversed=xe._reverse(xe.bracketExtendMode);static trackNamePolicy=new Map([["hidden",0],["firstsystem",1],["allsystems",2]]);static trackNamePolicyReversed=xe._reverse(xe.trackNamePolicy);static trackNameOrientation=new Map([["horizontal",0],["vertical",1]]);static trackNameOrientationReversed=xe._reverse(xe.trackNameOrientation);static trackNameMode=new Map([["fullname",0],["shortname",1]]);static trackNameModeReversed=xe._reverse(xe.trackNameMode);static textAlign=new Map([["left",0],["center",1],["right",2]]);static textAlignReversed=xe._reverse(xe.textAlign);static bendType=new Map([["custom",1],["bend",2],["release",3],["bendrelease",4],["hold",5],["prebend",6],["prebendbend",7],["prebendrelease",8]]);static bendTypeReversed=xe._reverse(xe.bendType);static keySignature=new Map([["cb",-7],["gb",-6],["db",-5],["ab",-4],["eb",-3],["bb",-2],["f",-1],["c",0],["g",1],["d",2],["a",3],["e",4],["b",5],["f#",6],["c#",7],["cbmajor",-7],["abminor",-7],["gbmajor",-6],["ebminor",-6],["dbmajor",-5],["bbminor",-5],["abmajor",-4],["fminor",-4],["ebmajor",-3],["cminor",-3],["bbmajor",-2],["gminor",-2],["fmajor",-1],["dminor",-1],["cmajor",0],["aminor",0],["gmajor",1],["eminor",1],["dmajor",2],["bminor",2],["amajor",3],["f#minor",3],["emajor",4],["c#minor",4],["bmajor",5],["g#minor",5],["f#major",6],["d#minor",6],["f#",6],["c#major",7],["a#minor",7],["c#",7]]);static keySignatureReversed=xe._reverse(xe.keySignature);static keySignatureType=new Map([["major",0],["minor",1],["cb",0],["cbmajor",0],["gb",0],["gbmajor",0],["db",0],["dbmajor",0],["ab",0],["abmajor",0],["eb",0],["ebmajor",0],["bb",0],["bbmajor",0],["f",0],["fmajor",0],["c",0],["cmajor",0],["g",0],["gmajor",0],["d",0],["dmajor",0],["a",0],["amajor",0],["e",0],["emajor",0],["b",0],["bmajor",0],["f#",0],["f#major",0],["c#",0],["c#major",0],["abminor",1],["ebminor",1],["bbminor",1],["fminor",1],["cminor",1],["gminor",1],["dminor",1],["aminor",1],["eminor",1],["bminor",1],["f#minor",1],["c#minor",1],["g#minor",1],["d#minor",1],["a#minor",1]]);static keySignatureTypeReversed=xe._reverse(xe.keySignatureType);static clef=new Map([["neutral",0],["c3",1],["c4",2],["f4",3],["g2",4],["n",0],["alto",1],["tenor",2],["bass",3],["treble",4]]);static clefReversed=xe._reverse(xe.clef);static tripletFeel=new Map([["none",0],["triplet16th",1],["triplet8th",2],["dotted16th",3],["dotted8th",4],["scottish16th",5],["scottish8th",6],["none",0],["no",0],["notripletfeel",0],["t16",1],["triplet-16th",1],["t8",2],["triplet-8th",2],["d16",3],["dotted-16th",3],["d8",4],["dotted-8th",4],["s16",5],["scottish-16th",5],["s8",6],["scottish-8th",6]]);static tripletFeelReversed=xe._reverse(xe.tripletFeel);static barLineStyle=new Map([["automatic",0],["dashed",1],["dotted",2],["heavy",3],["heavyheavy",4],["heavylight",5],["lightheavy",6],["lightlight",7],["none",8],["regular",9],["short",10],["tick",11]]);static barLineStyleReversed=xe._reverse(xe.barLineStyle);static simileMark=new Map([["none",0],["simple",1],["firstofdouble",2],["secondofdouble",3]]);static simileMarkReversed=xe._reverse(xe.simileMark);static direction=new Map([["fine",0],["segno",1],["segnosegno",2],["coda",3],["doublecoda",4],["dacapo",5],["dacapoalcoda",6],["dacapoaldoublecoda",7],["dacapoalfine",8],["dalsegno",9],["dalsegnoalcoda",10],["dalsegnoaldoublecoda",11],["dalsegnoalfine",12],["dalsegnosegno",13],["dalsegnosegnoalcoda",14],["dalsegnosegnoaldoublecoda",15],["dalsegnosegnoalfine",16],["dacoda",17],["dadoublecoda",18]]);static directionReversed=xe._reverse(xe.direction);static keySignaturesMinorReversed=new Map([[-7,"abminor"],[-6,"ebminor"],[-5,"bbminor"],[-4,"fminor"],[-3,"cminor"],[-2,"gminor"],[-1,"dminor"],[0,"aminor"],[1,"eminor"],[2,"bminor"],[3,"f#minor"],[4,"c#minor"],[5,"g#minor"],[6,"d#minor"],[7,"a#minor"]]);static keySignaturesMajorReversed=new Map([[-7,"cb"],[-6,"gb"],[-5,"db"],[-4,"ab"],[-3,"eb"],[-2,"bb"],[-1,"f"],[0,"c"],[1,"g"],[2,"d"],[3,"a"],[4,"e"],[5,"b"],[6,"f#"],[7,"c#"]])}class Ft{static _param(e){return e?{expectedTypes:new Set(e[0]),parseMode:e[1],allowedValues:e.length>2&&e[2]&&e[2].length>0?new Set(e[2]):void 0,reservedIdentifiers:e.length>3&&e[3]&&e[3].length>0?new Set(e[3]):void 0}:null}static _simple(e){return e==null?null:e.map(t=>({isStrict:t.length>0&&t[0]===null,parameters:t.map(Ft._param).filter(i=>i!==null)}))}static _metaProps(e){return new Map(e.map(t=>[t[0],t[1]===null?null:new Map(t[1].map(i=>[i[0],Ft._simple(i[1])]))]))}static _props(e){return new Map(e.map(t=>[t[0],Ft._simple(t[1])]))}static _signatures(e){return new Map(e.map(t=>[t[0],Ft._simple(t[1])]))}static scoreMetaDataSignatures=Ft._signatures([["title",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["subtitle",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["artist",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["album",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["words",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["music",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["wordsandmusic",[[[[17],0],[[10,17],1,["left","center","right"]]]]],["copyright",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["copyright2",[[[[17],0],[[10,17],1,["left","center","right"]]]]],["instructions",[[[[17,10],0]]]],["notices",[[[[17,10],0]]]],["tab",[[[[17,10],0],[[17],1],[[10,17],1,["left","center","right"]]]]],["systemslayout",[[[[16],5]]]],["defaultsystemslayout",[[[[16],0]]]],["showdynamics",null],["hidedynamics",null],["usesystemsignseparator",null],["multibarrest",null],["bracketextendmode",[[[[10,17],0,["nobrackets","groupstaves","groupsimilarinstruments"]]]]],["singletracktracknamepolicy",[[[[10,17],0,["hidden","firstsystem","allsystems"]]]]],["multitracktracknamepolicy",[[[[10,17],0,["hidden","firstsystem","allsystems"]]]]],["firstsystemtracknamemode",[[[[10,17],0,["fullname","shortname"]]]]],["othersystemstracknamemode",[[[[10,17],0,["fullname","shortname"]]]]],["firstsystemtracknameorientation",[[[[10,17],0,["horizontal","vertical"]]]]],["othersystemstracknameorientation",[[[[10,17],0,["horizontal","vertical"]]]]]]);static staffMetaDataSignatures=Ft._signatures([["tuning",[[[[10,17],0,["piano","none","voice"]]],[[[10,17],5]]]],["chord",[[[[17,10],0],[[10,17,16],5]]]],["capo",[[[[16],0]]]],["lyrics",[[[[17],0]],[[[16],0],[[17],0]]]],["articulation",[[[[10],0,["defaults"]]],[[[17,10],0],[[16],0]]]],["displaytranspose",[[[[16],0]]]],["transpose",[[[[16],0]]]],["instrument",[[[[16],0]],[[[17,10],0]],[[[10],0,["percussion"]]]]]]);static structuralMetaDataSignatures=Ft._signatures([["track",[[[[17],1],[[17],1]]]],["staff",null],["voice",null]]);static barMetaDataSignatures=Ft._signatures([["ts",[[[[10,17],0,["common"]]],[[[16],0],[[16],0]]]],["ro",null],["rc",[[[[16],0]]]],["ae",[[[[16,13],4]]]],["ks",[[[[10,17],0,["cb","gb","db","ab","eb","bb","f","c","g","d","a","e","b","f#","c#","cbmajor","abminor","gbmajor","ebminor","dbmajor","bbminor","abmajor","fminor","ebmajor","cminor","bbmajor","gminor","fmajor","dminor","cmajor","aminor","gmajor","eminor","dmajor","bminor","amajor","f#minor","emajor","c#minor","bmajor","g#minor","f#major","d#minor","f#","c#major","a#minor","c#"]]]]],["clef",[[[[10,16,17],0,["neutral","c3","c4","f4","g2","n","alto","tenor","bass","treble"]]]]],["ottava",[[[[10,17],0,["15ma","8va","regular","8vb","15mb","15ma","8va","8vb","15mb"]]]]],["tempo",[[[[16],2],[[17],1]],[null,[[16],2],[[17],0],[[16],1],[[10],1,["hide"]]]]],["tf",[[[[10,16,17],0,["none","triplet16th","triplet8th","dotted16th","dotted8th","scottish16th","scottish8th","none","no","notripletfeel","t16","triplet-16th","t8","triplet-8th","d16","dotted-16th","d8","dotted-8th","s16","scottish-16th","s8","scottish-8th"]]]]],["ac",null],["section",[[[[17,10],0]],[[[17,10],0],[[17,10],0,null,["x","-","r"]]]]],["jump",[[[[10,17],0,["fine","segno","segnosegno","coda","doublecoda","dacapo","dacapoalcoda","dacapoaldoublecoda","dacapoalfine","dalsegno","dalsegnoalcoda","dalsegnoaldoublecoda","dalsegnoalfine","dalsegnosegno","dalsegnosegnoalcoda","dalsegnosegnoaldoublecoda","dalsegnosegnoalfine","dacoda","dadoublecoda"]]]]],["ft",null],["simile",[[[[10,17],0,["none","simple","firstofdouble","secondofdouble"]]]]],["barlineleft",[[[[10,17],0,["automatic","dashed","dotted","heavy","heavyheavy","heavylight","lightheavy","lightlight","none","regular","short","tick"]]]]],["barlineright",[[[[10,17],0,["automatic","dashed","dotted","heavy","heavyheavy","heavylight","lightheavy","lightlight","none","regular","short","tick"]]]]],["scale",[[[[16],2]]]],["width",[[[[16],2]]]],["sync",[[[[16],0],[[16],0],[[16],0],[[16],3]]]],["accidentals",[[[[10,17],0,["auto","explicit"]]]]],["spd",[[[[16],2]]]],["sph",[[[[16],2]]]],["spu",[[[[16],2]]]],["db",null]]);static metaDataProperties=Ft._metaProps([["track",[["color",[[[[17],0]]]],["systemslayout",[[[[16],5]]]],["defaultsystemslayout",[[[[16],0]]]],["solo",null],["mute",null],["volume",[[[[16],0]]]],["balance",[[[[16],0]]]],["instrument",[[[[16],0]],[[[17,10],0]],[[[10],0,["percussion"]]]]],["bank",[[[[16],0]]]],["multibarrest",null]]],["staff",[["score",[[[[16],1]]]],["tabs",null],["slash",null],["numbered",null]]],["voice",null],["title",null],["subtitle",null],["artist",null],["album",null],["words",null],["music",null],["wordsandmusic",null],["copyright",null],["copyright2",null],["instructions",null],["notices",null],["tab",null],["systemslayout",null],["defaultsystemslayout",null],["showdynamics",null],["hidedynamics",null],["usesystemsignseparator",null],["multibarrest",null],["bracketextendmode",null],["singletracktracknamepolicy",null],["multitracktracknamepolicy",null],["firstsystemtracknamemode",null],["othersystemstracknamemode",null],["firstsystemtracknameorientation",null],["othersystemstracknameorientation",null],["tuning",[["hide",null],["label",[[[[17],0]]]]]],["chord",[["firstfret",[[[[16],0]]]],["barre",[[[[16],5]]]],["showdiagram",[[],[[[17],0,["true","false"]]],[[[10],0,["true","false"]]],[[[16],0,["1","0"]]]]],["showfingering",[[],[[[17],0,["true","false"]]],[[[10],0,["true","false"]]],[[[16],0,["1","0"]]]]],["showname",[[],[[[17],0,["true","false"]]],[[[10],0,["true","false"]]],[[[16],0,["1","0"]]]]]]],["capo",null],["lyrics",null],["articulation",null],["displaytranspose",null],["transpose",null],["instrument",null],["ts",null],["ro",null],["rc",null],["ae",null],["ks",null],["clef",null],["ottava",null],["tempo",null],["tf",null],["ac",null],["section",null],["jump",null],["ft",null],["simile",null],["barlineleft",null],["barlineright",null],["scale",null],["width",null],["sync",null],["accidentals",null],["spd",null],["sph",null],["spu",null],["db",null]]);static metaDataSignatures=[Ft.scoreMetaDataSignatures,Ft.staffMetaDataSignatures,Ft.structuralMetaDataSignatures,Ft.barMetaDataSignatures];static durationChangeProperties=Ft._props([["tu",[[[[16],0,["3","5","6","7","9","10","12"]]],[[[16],0],[[16],0]]]]]);static beatProperties=Ft._props([["f",null],["fo",null],["vs",null],["v",null],["vw",null],["s",null],["p",null],["tt",null],["d",null],["dd",null],["su",null],["sd",null],["cre",null],["dec",null],["spd",null],["sph",null],["spu",null],["spe",null],["slashed",null],["ds",null],["glpf",null],["glpt",null],["waho",null],["wahc",null],["legatoorigin",null],["timer",null],["tu",[[[[16],0,["3","5","6","7","9","10","12"]]],[[[16],0],[[16],0]]]],["txt",[[[[17,10],0]]]],["lyrics",[[[[17],0]],[[[16],0],[[17],0]]]],["tb",[[[[16],5]],[[[10,17],0,["custom","dive","dip","hold","predive","predivedive"]],[[16],5]],[[[10,17],0,["default","gradual","fast"]],[[16],5]],[[[10,17],0,["custom","dive","dip","hold","predive","predivedive"]],[[10,17],0,["default","gradual","fast"]],[[16],5]]]],["tbe",[[[[16],5]],[[[10,17],0,["custom","dive","dip","hold","predive","predivedive"]],[[16],5]],[[[10,17],0,["default","gradual","fast"]],[[16],5]],[[[10,17],0,["custom","dive","dip","hold","predive","predivedive"]],[[10,17],0,["default","gradual","fast"]],[[16],5]]]],["bu",[[[[16],1]]]],["bd",[[[[16],1]]]],["au",[[[[16],1]]]],["ad",[[[[16],1]]]],["ch",[[[[17,10],0]]]],["gr",[[[[10,17],1,["onbeat","beforebeat","bendgrace","ob","bb","b"]]]]],["dy",[[[[10,17],0,["ppp","pp","p","mp","mf","f","ff","fff","pppp","ppppp","pppppp","ffff","fffff","ffffff","sf","sfp","sfpp","fp","rf","rfz","sfz","sffz","fz","n","pf","sfzp"]]]]],["tempo",[[[[16],0],[[10],1,["hide"]]],[[[16],0],[[17],0],[[10],1,["hide"]]]]],["volume",[[[[16],0]]]],["balance",[[[[16],0]]]],["tp",[[[[16],0,["8","16","32"]]]]],["barre",[[[[16],0],[[10,17],1,["full","half"]]]]],["rasg",[[[[10,17],0,["ii","mi","miitriplet","miianapaest","pmptriplet","pmpanapaest","peitriplet","peianapaest","paitriplet","paianapaest","amitriplet","amianapaest","ppp","amii","amip","eami","eamii","peami"]]]]],["ot",[[[[10,17],0,["15ma","8va","regular","8vb","15mb","15ma","8va","8vb","15mb"]]]]],["instrument",[[[[16],0]],[[[17,10],0]],[[[10],0,["percussion"]]]]],["bank",[[[[16],0]]]],["fermata",[[[[10,17],0,["short","medium","long"]],[[16],3]]]],["beam",[[[[10,17],0,["invert","up","down","auto","split","merge","splitsecondary"]]]]]]);static noteProperties=Ft._props([["nh",null],["ah",[[[[16],1]]]],["th",[[[[16],1]]]],["ph",[[[[16],1]]]],["sh",[[[[16],1]]]],["fh",[[[[16],1]]]],["v",null],["vw",null],["sl",null],["ss",null],["sib",null],["sia",null],["sou",null],["sod",null],["psu",null],["psd",null],["h",null],["lht",null],["g",null],["ac",null],["hac",null],["ten",null],["tr",[[[[16],0],[[16],1,["16","32","64"]]]]],["pm",null],["st",null],["lr",null],["x",null],["t",null],["turn",null],["iturn",null],["umordent",null],["lmordent",null],["string",null],["hide",null],["b",[[[[16],5]],[[[10,17],0,["custom","bend","release","bendrelease","hold","prebend","prebendbend","prebendrelease"]],[[16],5]],[[[10,17],0,["default","gradual","fast"]],[[16],5]],[[[10,17],0,["custom","bend","release","bendrelease","hold","prebend","prebendbend","prebendrelease"]],[[10,17],0,["default","gradual","fast"]],[[16],5]]]],["be",[[[[16],5]],[[[10,17],0,["custom","bend","release","bendrelease","hold","prebend","prebendbend","prebendrelease"]],[[16],5]],[[[10,17],0,["default","gradual","fast"]],[[16],5]],[[[10,17],0,["custom","bend","release","bendrelease","hold","prebend","prebendbend","prebendrelease"]],[[10,17],0,["default","gradual","fast"]],[[16],5]]]],["lf",[[[[16],0,["1","2","3","4","5"]]]]],["rf",[[[[16],0,["1","2","3","4","5"]]]]],["acc",[[[[10,17],0,["default","forcenone","forcenatural","forcesharp","forcedoublesharp","forceflat","forcedoubleflat","d","-","n","#","##","x","b","bb"]]]]],["slur",[[[[17],0]],[[[10],0]]]],["-",null]])}var oe;(function(n){n[n.Dot=0]="Dot",n[n.Backslash=1]="Backslash",n[n.DoubleBackslash=2]="DoubleBackslash",n[n.Pipe=3]="Pipe",n[n.LBrace=4]="LBrace",n[n.RBrace=5]="RBrace",n[n.LParen=6]="LParen",n[n.RParen=7]="RParen",n[n.Colon=8]="Colon",n[n.Asterisk=9]="Asterisk",n[n.Ident=10]="Ident",n[n.Tag=11]="Tag",n[n.Meta=12]="Meta",n[n.Arguments=13]="Arguments",n[n.Props=14]="Props",n[n.Prop=15]="Prop",n[n.Number=16]="Number",n[n.String=17]="String",n[n.Score=18]="Score",n[n.Bar=19]="Bar",n[n.Beat=20]="Beat",n[n.Duration=21]="Duration",n[n.NoteList=22]="NoteList",n[n.Note=23]="Note"})(oe||(oe={}));var Ze;(function(n){n[n.Hint=0]="Hint",n[n.Warning=1]="Warning",n[n.Error=2]="Error"})(Ze||(Ze={}));var at;(function(n){n[n.AT001=1]="AT001",n[n.AT002=2]="AT002",n[n.AT003=3]="AT003",n[n.AT004=4]="AT004",n[n.AT005=5]="AT005",n[n.AT006=6]="AT006",n[n.AT200=200]="AT200",n[n.AT201=201]="AT201",n[n.AT202=202]="AT202",n[n.AT203=203]="AT203",n[n.AT204=204]="AT204",n[n.AT205=205]="AT205",n[n.AT206=206]="AT206",n[n.AT207=207]="AT207",n[n.AT208=208]="AT208",n[n.AT209=209]="AT209",n[n.AT210=210]="AT210",n[n.AT211=211]="AT211",n[n.AT212=212]="AT212",n[n.AT213=213]="AT213",n[n.AT214=214]="AT214",n[n.AT215=215]="AT215",n[n.AT216=216]="AT216",n[n.AT217=217]="AT217",n[n.AT218=218]="AT218",n[n.AT219=219]="AT219",n[n.AT220=220]="AT220",n[n.AT300=300]="AT300",n[n.AT301=301]="AT301",n[n.AT302=302]="AT302",n[n.AT303=303]="AT303",n[n.AT304=304]="AT304",n[n.AT305=305]="AT305",n[n.AT306=306]="AT306",n[n.AT400=400]="AT400"})(at||(at={}));class xb{_hasErrors=!1;items=[];get errors(){return this.items.filter(e=>e.severity===Ze.Error)}get hasErrors(){return this._hasErrors}push(e){this.items.push(e),e.severity===Ze.Error&&(this._hasErrors=!0)}[Symbol.iterator](){return this.items[Symbol.iterator]()}}var np;(function(n){n[n.Auto=0]="Auto",n[n.Explicit=1]="Explicit"})(np||(np={}));var tn;(function(n){n[n.Pitched=0]="Pitched",n[n.Fretted=1]="Fretted",n[n.Articulation=2]="Articulation"})(tn||(tn={}));var bs;(function(n){n[n.Required=0]="Required",n[n.Optional=1]="Optional",n[n.RequiredAsFloat=2]="RequiredAsFloat",n[n.OptionalAsFloat=3]="OptionalAsFloat",n[n.RequiredAsValueList=4]="RequiredAsValueList",n[n.ValueListWithoutParenthesis=5]="ValueListWithoutParenthesis"})(bs||(bs={}));class it{static _conversionBuffer=new ArrayBuffer(8);static _conversionByteArray=new Uint8Array(it._conversionBuffer);static _dataView=new DataView(it._conversionBuffer);static float64ToBytes(e){return it._dataView.setFloat64(0,e,!0),it._conversionByteArray}static bytesToInt64LE(e){it._conversionByteArray.set(e,0);const t=it._dataView.getBigInt64(0,!0);return t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?Number(t):Number.MAX_SAFE_INTEGER}static bytesToFloat64LE(e){return it._conversionByteArray.set(e,0),it._dataView.getFloat64(0,!0)}static bytesToFloat32LE(e){return it._conversionByteArray.set(e,0),it._dataView.getFloat32(0,!0)}static float32BEToBytes(e){return it._dataView.setFloat32(0,e,!1),it._conversionByteArray.slice(0,4)}static uint16ToInt16(e){return it._dataView.setUint16(0,e,!0),it._dataView.getInt16(0,!0)}static int16ToUint32(e){return it._dataView.setInt16(0,e,!0),it._dataView.getUint32(0,!0)}static int32ToUint16(e){return it._dataView.setInt32(0,e,!0),it._dataView.getUint16(0,!0)}static int32ToInt16(e){return it._dataView.setInt32(0,e,!0),it._dataView.getInt16(0,!0)}static int32ToUint32(e){return it._dataView.setInt32(0,e,!0),it._dataView.getUint32(0,!0)}static uint8ToInt8(e){return it._dataView.setUint8(0,e),it._dataView.getInt8(0)}}class U{static readInt32BE(e){const t=e.readByte(),i=e.readByte(),s=e.readByte(),a=e.readByte();return t<<24|i<<16|s<<8|a}static readFloat32BE(e){const t=new Uint8Array(4);return e.read(t,0,t.length),t.reverse(),it.bytesToFloat32LE(t)}static readFloat64BE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),t.reverse(),it.bytesToFloat64LE(t)}static readInt32LE(e){const t=e.readByte(),i=e.readByte(),s=e.readByte();return e.readByte()<<24|s<<16|i<<8|t}static readInt64LE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),it.bytesToInt64LE(t)}static readUInt32LE(e){const t=e.readByte(),i=e.readByte(),s=e.readByte();return e.readByte()<<24|s<<16|i<<8|t}static decodeUInt32LE(e,t){const i=e[t],s=e[t+1],a=e[t+2];return e[t+3]<<24|a<<16|s<<8|i}static readUInt16LE(e){const t=e.readByte(),i=e.readByte();return it.int32ToUint16(i<<8|t)}static readInt16LE(e){const t=e.readByte(),i=e.readByte();return it.int32ToInt16(i<<8|t)}static readUInt32BE(e){const t=e.readByte(),i=e.readByte(),s=e.readByte(),a=e.readByte();return it.int32ToUint32(t<<24|i<<16|s<<8|a)}static readUInt16BE(e){const t=e.readByte(),i=e.readByte();return it.int32ToInt16(t<<8|i)}static readInt16BE(e){const t=e.readByte(),i=e.readByte();return it.int32ToInt16(t<<8|i)}static readByteArray(e,t){const i=new Uint8Array(t);return e.read(i,0,t),i}static read8BitChars(e,t){const i=new Uint8Array(t);return e.read(i,0,i.length),U.toString(i,"utf-8")}static read8BitString(e){let t="",i=e.readByte();for(;i!==0;)t+=String.fromCharCode(i),i=e.readByte();return t}static read8BitStringLength(e,t){let i="",s=-1;for(let o=0;o<t;o++){const c=e.readByte();c===0&&s===-1&&(s=o),i+=String.fromCharCode(c)}const a=i;return s>=0?a.substr(0,s):a}static readSInt8(e){const t=e.readByte();return((t&255)>>7)*-256+(t&255)}static readInt24(e,t){let i=e[t]|e[t+1]<<8|e[t+2]<<16;return(i&8388608)===8388608&&(i=i|255<<24),i}static readInt16(e,t){return it.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){const i=U._detectEncoding(e);return i&&(t=i),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static _detectEncoding(e){return e.length>2&&e[0]===254&&e[1]===255?"utf-16be":e.length>2&&e[0]===255&&e[1]===254?"utf-16le":e.length>4&&e[0]===0&&e[1]===0&&e[2]===254&&e[3]===255?"utf-32be":e.length>4&&e[0]===255&&e[1]===254&&e[2]===0&&e[3]===0?"utf-32le":null}static stringToBytes(e){return new TextEncoder().encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeInt32LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeFloat32BE(e,t){const i=it.float32BEToBytes(t);e.write(i,0,i.length)}static*iterateCodepoints(e){let t=0;for(;t<e.length;){let i=e.charCodeAt(t);U.isLeadingSurrogate(i)&&t+1<e.length&&(t++,i=(i-55296)*1024+(e.charCodeAt(t)-56320)+65536),t++,yield i}}static isLeadingSurrogate(e){return e>=55296&&e<=56319}static isTrailingSurrogate(e){return e>=56320&&e<=57343}}class Pi{static _eof=0;_codepoints;_codepoint=Pi._eof;_offset=0;_line=1;_col=1;fatalError=!1;_tokenStart={line:0,col:0,offset:0};_leadingComments;_trailingCommentNode;_previousToken;_peekedToken;lexerDiagnostics=new xb;constructor(e){this._codepoints=[...U.iterateCodepoints(e)],this._offset=0,this._line=1,this._col=1,this._codepoint=this._codepoints.length>0?this._codepoints[0]:Pi._eof}peekToken(){if(this.fatalError)return;let e=this._peekedToken;return e||(e=this._readToken(),this._peekedToken=e,e)}extendToFloat(e){if(this._codepoint!==46||this._offset+1>=this._codepoints.length||!Pi._isDigit(this._codepoints[this._offset+1]))return e;let t=this._offset+2;for(;t<this._codepoints.length&&Pi._isDigit(this._codepoints[t]);)t++;if(t<this._codepoints.length&&Pi._isIdentifierCharacter(this._codepoints[t]))return e;const i=t-this._offset-1;return this._offset+=i,this._col+=i,this._nextCodepoint(),e.end=this._currentLexerLocation(),e.value=Number.parseFloat(String.fromCodePoint(...this._codepoints.slice(e.start.offset,e.end.offset))),e}advance(){this._previousToken=this._peekedToken,this._peekedToken=void 0}_nextCodepoint(){const e=this._codepoints;let t=this._offset;if(t<e.length-1){e[t]===10?(this._trailingCommentNode=void 0,++this._line,this._col=1):++this._col,++t;const s=e[t];return this._codepoint=s,this._offset=t,s}else this._codepoint!==Pi._eof&&(this._codepoint=Pi._eof,++this._col,this._offset=e.length);return Pi._eof}previousTokenEndLocation(){return this._previousToken?.end??this._currentLexerLocation()}currentTokenLocation(){return this._peekedToken?.start??this._currentLexerLocation()}_currentLexerLocation(){return{line:this._line,col:this._col,offset:this._offset}}_readToken(){for(this._leadingComments=void 0;this._codepoint!==Pi._eof&&!this.fatalError;)if(this._tokenStart=this._currentLexerLocation(),Pi._terminalTokens.has(this._codepoint)){const e=Pi._terminalTokens.get(this._codepoint)(this);if(e)return this._trailingCommentNode=e,e}else if(Pi._isIdentifierCharacter(this._codepoint)){const e=this._numberOrIdentifier();return this._trailingCommentNode=e,e}else this._codepoint=this._nextCodepoint()}_comment(){this._codepoint=this._nextCodepoint(),this._codepoint===47?this._singleLineComment():this._codepoint===42?this._multiLineComment():(this.lexerDiagnostics.push({code:at.AT001,message:`Unexpected character at comment start, expected '//' or '/*' but found '/${String.fromCodePoint(this._codepoint)}'`,severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()}),this.fatalError=!0)}static _terminalTokens=new Map([[47,e=>e._comment()],[34,e=>e._string()],[39,e=>e._string()],[45,e=>e._numberOrIdentifier()],[46,e=>e._token({nodeType:oe.Dot})],[58,e=>e._token({nodeType:oe.Colon})],[40,e=>e._token({nodeType:oe.LParen})],[41,e=>e._token({nodeType:oe.RParen})],[123,e=>e._token({nodeType:oe.LBrace})],[125,e=>e._token({nodeType:oe.RBrace})],[124,e=>e._token({nodeType:oe.Pipe})],[42,e=>e._token({nodeType:oe.Asterisk})],[92,e=>e._metaCommand()],[9,e=>e._whitespace()],[10,e=>e._whitespace()],[11,e=>e._whitespace()],[13,e=>e._whitespace()],[32,e=>e._whitespace()]]);_metaCommand(){const e=this._currentLexerLocation();this._codepoint=this._nextCodepoint();let t,i;this._codepoint===92?(this._codepoint=this._nextCodepoint(),i=this._currentLexerLocation(),t={nodeType:oe.DoubleBackslash,start:e,end:i}):(i=this._currentLexerLocation(),t={nodeType:oe.Backslash,start:e,end:i});let s="";for(;Pi._isIdentifierCharacter(this._codepoint);)s+=String.fromCodePoint(this._codepoint),this._codepoint=this._nextCodepoint();if(s.length===0){this.lexerDiagnostics.push({code:at.AT002,message:"Missing identifier after meta data start",severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()});return}return{nodeType:oe.Tag,leadingComments:this._leadingComments,start:this._tokenStart,end:this._currentLexerLocation(),prefix:t,tag:{nodeType:oe.Ident,text:s,start:i,end:this._currentLexerLocation()}}}_token(e){return e.leadingComments=this._leadingComments,e.start=this._tokenStart,this._codepoint=this._nextCodepoint(),e.end=this._currentLexerLocation(),e}_string(){const e=this._codepoint;this._codepoint=this._nextCodepoint();let t="",i=-1;for(;this._codepoint!==e&&this._codepoint!==Pi._eof;){let a=-1;if(this._codepoint===92)if(this._codepoint=this._nextCodepoint(),this._codepoint===92)a=92;else if(this._codepoint===e)a=e;else if(this._codepoint===82||this._codepoint===114)a=13;else if(this._codepoint===78||this._codepoint===110)a=10;else if(this._codepoint===84||this._codepoint===116)a=9;else if(this._codepoint===117){let o="";for(let c=0;c<4;c++){if(this._codepoint=this._nextCodepoint(),this._codepoint===Pi._eof){this.lexerDiagnostics.push({code:at.AT003,message:"Unexpected end of file. Need 4 hex characters on a \\uXXXX escape sequence",severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()}),this.fatalError=!0;return}o+=String.fromCodePoint(this._codepoint)}if(a=Number.parseInt(o,16),Number.isNaN(a)){this.lexerDiagnostics.push({code:at.AT004,message:"Invalid unicode value. Need 4 hex characters on a \\uXXXX escape sequence.",severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()}),this.fatalError=!0;return}}else{this.lexerDiagnostics.push({code:at.AT005,message:`Unsupported escape sequence. Expected '\\n', '\\r', '\\t', or '\\uXXXX' but found '\\${String.fromCodePoint(this._codepoint)}'.`,severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()}),this.fatalError=!0;return}else a=this._codepoint;U.isLeadingSurrogate(i)&&U.isTrailingSurrogate(a)?(a=(i-55296)*1024+(a-56320)+65536,t+=String.fromCodePoint(a)):U.isLeadingSurrogate(a)||(U.isLeadingSurrogate(i)&&(t+=String.fromCodePoint(i)),a>0&&(t+=String.fromCodePoint(a))),i=a,this._codepoint=this._nextCodepoint()}if(this._codepoint===Pi._eof){this.lexerDiagnostics.push({code:at.AT006,message:"Unexpected end of file. String not closed.",severity:Ze.Error,start:this._tokenStart,end:this._currentLexerLocation()}),this.fatalError=!0;return}const s={nodeType:oe.String,text:t,leadingComments:this._leadingComments,start:this._tokenStart,end:this._currentLexerLocation()};return this._codepoint=this._nextCodepoint(),s}_multiLineComment(){const e=this._trailingCommentNode,t={start:this._tokenStart,end:this._currentLexerLocation(),text:"",multiLine:!0};for(;this._codepoint!==Pi._eof;)if(this._codepoint===42)if(this._codepoint=this._nextCodepoint(),this._codepoint===47){this._codepoint=this._nextCodepoint();break}else t.text+=`*${String.fromCodePoint(this._codepoint)}`,t.end.line=this._line,t.end.col=this._col,t.end.offset=this._offset;else this._codepoint=this._nextCodepoint(),t.text+=String.fromCodePoint(this._codepoint),t.end.line=this._line,t.end.col=this._col,t.end.offset=this._offset;e?(e.trailingComments??=[],e.trailingComments.push(t)):(this._leadingComments??=[],this._leadingComments.push(t))}_numberOrIdentifier(){let e="",t=!0,i=this._codepoint;i===45&&(e+=String.fromCodePoint(i),i=this._nextCodepoint(),Pi._isDigit(i)||(t=!1));let s=!0;do t?Pi._isDigit(i)?(e+=String.fromCodePoint(i),i=this._nextCodepoint(),s=!0):Pi._isIdentifierCharacter(i)?(t=!1,e+=String.fromCodePoint(i),i=this._nextCodepoint(),s=!0):s=!1:Pi._isIdentifierCharacter(i)?(e+=String.fromCodePoint(i),i=this._nextCodepoint(),s=!0):s=!1;while(s);return t?{nodeType:oe.Number,leadingComments:this._leadingComments,start:this._tokenStart,end:this._currentLexerLocation(),value:Number.parseInt(e,10)}:{nodeType:oe.Ident,leadingComments:this._leadingComments,start:this._tokenStart,end:this._currentLexerLocation(),text:e}}_singleLineComment(){const e=this._trailingCommentNode,t={start:this._tokenStart,end:this._currentLexerLocation(),text:"",multiLine:!1};let i=this._codepoint;for(;i!==Pi._eof&&(i=this._nextCodepoint(),i!==10&&i!==Pi._eof);)t.text+=String.fromCodePoint(i),t.end.line=this._line,t.end.col=this._col,t.end.offset=this._offset;e?(e.trailingComments??=[],e.trailingComments.push(t)):(this._leadingComments??=[],this._leadingComments.push(t))}_whitespace(){let e=this._codepoint;for(;Pi._isWhiteSpace(e);)e===10&&(this._trailingCommentNode=void 0),e=this._nextCodepoint()}static _isDigit(e){return e>=48&&e<=57}static _buildNonIdentifierChars(){const e=new Set;for(const t of Pi._terminalTokens.keys())e.add(t);return e.delete(45),e.add(Pi._eof),e}static _nonIdentifierChars=Pi._buildNonIdentifierChars();static _isIdentifierCharacter(e){return!Pi._nonIdentifierChars.has(e)}static _isWhiteSpace(e){return e===32||e===10||e===13||e===9||e===11}}var eu;(function(n){n[n.ForModelImport=0]="ForModelImport",n[n.Full=1]="Full"})(eu||(eu={}));class yB{lexer;_scoreNode;_metaDataReader=ws.instance;mode=eu.ForModelImport;get lexerDiagnostics(){return this.lexer.lexerDiagnostics}parserDiagnostics=new xb;addParserDiagnostic(e){this.parserDiagnostics.push(e)}unexpectedToken(e,t,i){e?this.addParserDiagnostic({code:at.AT202,message:`Unexpected '${oe[e.nodeType]}' token. Expected one of following: ${t.map(s=>oe[s]).join(",")}`,severity:Ze.Error,start:e.start,end:e.end}):this.addParserDiagnostic({code:at.AT203,start:this.lexer.currentTokenLocation(),end:this.lexer.currentTokenLocation(),severity:Ze.Error,message:"Unexpected end of file."}),i&&(this.lexer.fatalError=!0)}constructor(e){this.lexer=new Pi(e)}read(){return this._score(),this._scoreNode}_score(){this._scoreNode={nodeType:oe.Score,bars:[],start:this.lexer.currentTokenLocation()};try{this._bars()}finally{this._scoreNode.end=this.lexer.previousTokenEndLocation()}}_bars(){let e=this.lexer.peekToken();for(;e;)this._bar(),e=this.lexer.peekToken()}_bar(){const e={nodeType:oe.Bar,metaData:[],beats:[],pipe:void 0,start:this.lexer.currentTokenLocation()};this._scoreNode.bars.push(e);try{this._barMetaData(e),this._barBeats(e);const t=this.lexer.peekToken();t?.nodeType===oe.Pipe&&(e.pipe=t,this.lexer.advance()),(e.metaData.length>0||e.beats.length>0||e.pipe)&&(e.end=this.lexer.previousTokenEndLocation())}finally{e.end=this.lexer.previousTokenEndLocation()}}_barMetaData(e){let t=this.lexer.peekToken();for(;t&&(t.nodeType===oe.Tag||t.nodeType===oe.Dot);)t.nodeType===oe.Dot?(this.lexer.advance(),this.addParserDiagnostic({code:at.AT400,message:"The dots separating score metadata, score contents and the sync points can be removed.",severity:Ze.Hint,start:t.start,end:t.end})):this._metaData(e.metaData),t=this.lexer.peekToken()}_barBeats(e){let t=this.lexer.peekToken();for(;t&&t.nodeType!==oe.Pipe&&t.nodeType!==oe.Dot&&t.nodeType!==oe.Tag;){const i=this._beat();i&&e.beats.push(i),t=this.lexer.peekToken()}}_beat(){const e={nodeType:oe.Beat,durationChange:void 0,notes:void 0,rest:void 0,beatEffects:void 0,beatMultiplier:void 0,beatMultiplierValue:void 0,start:this.lexer.peekToken()?.start};try{if(this._beatDurationChange(e),this._beatContent(e),!e.notes&&!e.rest)return e;this._beatDuration(e),this._beatMultiplier(e),e.beatEffects=this._properties(t=>this._metaDataReader.readBeatPropertyArguments(this,t)),e.beatMultiplierValue!==void 0&&e.beatEffects?.openBrace&&this.addParserDiagnostic({code:at.AT304,message:"The beat multiplier should be specified after the beat effects.",severity:Ze.Warning,start:e.beatMultiplier.start,end:e.beatMultiplierValue.end}),this._beatMultiplier(e)}finally{e.end=this.lexer.previousTokenEndLocation()}return e}_beatDuration(e){const t=this.lexer.peekToken();if(t?.nodeType!==oe.Dot)return;e.durationDot=t,this.lexer.advance();const i=this.lexer.peekToken();if(i?.nodeType===oe.Number){e.durationValue=i,this.lexer.advance();return}else if(i?.nodeType===oe.Tag){e.durationDot=void 0;return}else if(i)this.unexpectedToken(i,[oe.Number],!0);else return}_beatDurationChange(e){const t=this.lexer.peekToken();if(t?.nodeType!==oe.Colon)return;this.lexer.advance();const i={nodeType:oe.Duration,colon:t,value:void 0,properties:void 0,start:t.start};e.durationChange=i;try{const s=this.lexer.peekToken();if(!s||s.nodeType!==oe.Number){this.addParserDiagnostic({code:at.AT201,message:"Missing duration value after ':'.",severity:Ze.Error,start:t.start,end:t.end});return}this.lexer.advance(),i.value=s,i.properties=this._properties(a=>this._metaDataReader.readDurationChangePropertyArguments(this,a))}finally{i.end=this.lexer.previousTokenEndLocation()}}_beatContent(e){const t=this.lexer.peekToken();if(t)if(t.nodeType===oe.Ident&&t.text==="r")e.rest=t,this.lexer.advance();else if(t.nodeType===oe.LParen)e.notes=this._noteList(t);else{const i=this._note(t);i&&(e.notes={nodeType:oe.NoteList,openParenthesis:void 0,notes:[i],closeParenthesis:void 0,start:i.start,end:i.end})}}_beatMultiplier(e){const t=this.lexer.peekToken();if(!t||t.nodeType!==oe.Asterisk)return;this.lexer.advance(),e.beatMultiplier=t;const i=this.lexer.peekToken();if(!i||i.nodeType!==oe.Number){this.addParserDiagnostic({code:at.AT200,message:"Missing beat multiplier value after '*'.",severity:Ze.Error,start:e.beatMultiplier.start,end:e.beatMultiplier.end});return}e.beatMultiplierValue=i,this.lexer.advance()}_noteList(e){const t={nodeType:oe.NoteList,openParenthesis:void 0,notes:[],closeParenthesis:void 0,start:this.lexer.currentTokenLocation()};try{t.openParenthesis=e,this.lexer.advance();let i=this.lexer.peekToken();for(;i&&i.nodeType!==oe.RParen;){const a=this._note(i);if(a)t.notes.push(a);else break;i=this.lexer.peekToken()}const s=this.lexer.peekToken();s?.nodeType===oe.RParen?(t.closeParenthesis=s,this.lexer.advance()):this.addParserDiagnostic({code:at.AT206,message:"Unexpected end of file. Group not closed.",severity:Ze.Error,start:s?.start??this.lexer.currentTokenLocation(),end:s?.end??this.lexer.currentTokenLocation()})}finally{t.end=this.lexer.previousTokenEndLocation()}return t}_note(e){const t={nodeType:oe.Note,noteValue:{nodeType:oe.Ident,text:""},start:e.start};try{let i=!1;switch(e.nodeType){case oe.Number:t.noteValue=e,this.lexer.advance(),i=!0;break;case oe.String:switch(t.noteValue=e,this.lexer.advance(),t.noteValue.text){case"x":case"-":i=!0;break}break;case oe.Ident:switch(t.noteValue=e,this.lexer.advance(),t.noteValue.text){case"x":case"-":i=!0;break}break;default:this.unexpectedToken(e,[oe.Number,oe.String,oe.Ident],!0);return}if(i){const s=this.lexer.peekToken();if(s?.nodeType===oe.Dot){const a=s;this.lexer.advance();const o=this.lexer.peekToken();if(!o){this.unexpectedToken(o,[oe.Number],!0);return}if(o.nodeType===oe.Tag)return t;if(o.nodeType===oe.Number)t.noteStringDot=a,t.noteString=o,this.lexer.advance();else{this.unexpectedToken(o,[oe.Number],!0);return}}}t.noteEffects=this._properties(s=>this._metaDataReader.readNotePropertyArguments(this,s))}finally{t.end=this.lexer.previousTokenEndLocation()}return t}_metaData(e){const t=this.lexer.peekToken();if(!t||t.nodeType!==oe.Tag)return;const i={nodeType:oe.Meta,tag:t,start:t.start,properties:void 0,propertiesBeforeArguments:!1};this.lexer.advance(),e.push(i);try{this.lexer.peekToken()?.nodeType===oe.LBrace?(i.propertiesBeforeArguments=!0,i.properties=this._properties(a=>this._metaDataReader.readMetaDataPropertyArguments(this,i.tag,a)),i.arguments=this.argumentList(),i.arguments||(i.arguments=this._metaDataReader.readMetaDataArguments(this,i.tag),i.arguments&&i.arguments.arguments.length>1&&(this.addParserDiagnostic({code:at.AT301,message:"Metadata arguments should be wrapped into parenthesis.",severity:Ze.Warning,start:i.arguments?.start??i.start,end:i.arguments?.end??i.end}),this.addParserDiagnostic({code:at.AT302,message:"Metadata arguments should be placed before metadata properties.",severity:Ze.Warning,start:i.arguments?.start??i.start,end:i.arguments?.end??i.end})))):(i.arguments=this.argumentList(),i.arguments||(i.arguments=this._metaDataReader.readMetaDataArguments(this,i.tag),i.arguments&&i.arguments.arguments.length>1&&this.addParserDiagnostic({code:at.AT301,message:"Metadata arguments should be wrapped into parenthesis.",severity:Ze.Warning,start:i.arguments?.start??i.start,end:i.arguments?.end??i.end})),i.properties=this._properties(a=>this._metaDataReader.readMetaDataPropertyArguments(this,i.tag,a)))}finally{i.end=this.lexer.previousTokenEndLocation()}return i}_properties(e){const t=this.lexer.peekToken();if(!t||t.nodeType!==oe.LBrace)return;const i={nodeType:oe.Props,openBrace:t,properties:[],closeBrace:void 0,start:t.start};this.lexer.advance();try{let s=this.lexer.peekToken();for(;s?.nodeType===oe.Ident;)i.properties.push(this._property(s,e)),s=this.lexer.peekToken();const a=this.lexer.peekToken();a?.nodeType===oe.RBrace?(i.closeBrace=a,this.lexer.advance()):this.addParserDiagnostic({code:at.AT206,message:"Unexpected end of file. Group not closed.",severity:Ze.Error,start:this.lexer.currentTokenLocation(),end:this.lexer.currentTokenLocation()})}finally{i.end=this.lexer.previousTokenEndLocation()}return i}_property(e,t){const i={nodeType:oe.Prop,property:e,arguments:void 0};this.lexer.advance(),i.start=i.property.start;try{i.arguments=this.argumentList(),i.arguments||(i.arguments=t(i),i.arguments&&i.arguments.arguments.length>1&&this.addParserDiagnostic({code:at.AT303,message:"Property args should be wrapped into parenthesis.",severity:Ze.Warning,start:i.arguments.start,end:i.arguments.end}))}finally{i.end=this.lexer.previousTokenEndLocation()}return i}argumentList(){const e=this.lexer.peekToken();if(e?.nodeType!==oe.LParen)return;const t={nodeType:oe.Arguments,openParenthesis:e,arguments:[],closeParenthesis:void 0,start:e.start};this.lexer.advance();try{let i=this.lexer.peekToken();for(;i&&i?.nodeType!==oe.RParen;){switch(i.nodeType){case oe.Ident:t.arguments.push(i),this.lexer.advance();break;case oe.String:t.arguments.push(i),this.lexer.advance();break;case oe.Number:t.arguments.push(this.lexer.extendToFloat(i)),this.lexer.advance();break;default:this.unexpectedToken(i,[oe.Ident,oe.String,oe.Number],!1),this.lexer.advance();break}i=this.lexer.peekToken()}const s=this.lexer.peekToken();s?.nodeType===oe.RParen?(t.closeParenthesis=s,this.lexer.advance()):this.addParserDiagnostic({code:at.AT206,message:"Unexpected end of file. Group not closed.",severity:Ze.Error,start:this.lexer.currentTokenLocation(),end:this.lexer.currentTokenLocation()})}finally{t.end=this.lexer.previousTokenEndLocation()}return t}}class I{static ident(e){return{nodeType:oe.Ident,text:e}}static string(e){return{nodeType:oe.String,text:e}}static number(e){return{nodeType:oe.Number,value:e}}static meta(e,t,i){return{nodeType:oe.Meta,tag:{nodeType:oe.Tag,prefix:{nodeType:oe.Backslash},tag:{nodeType:oe.Ident,text:e}},arguments:t,properties:i,propertiesBeforeArguments:!1}}static identMeta(e,t){return I.meta(e,I.identValue(t))}static numberMeta(e,t){return I.meta(e,I.numberValue(t))}static args(e,t=void 0){const i={nodeType:oe.Arguments,arguments:e.filter(a=>a!==void 0)};if((t===void 0?i.arguments.length>1:t)&&(i.openParenthesis={nodeType:oe.LParen},i.closeParenthesis={nodeType:oe.RParen}),i.arguments.length!==0)return i}static stringValue(e){return I.args([I.string(e)])}static identValue(e){return I.args([I.ident(e)])}static numberValue(e){return I.args([I.number(e)])}static props(e){const t={nodeType:oe.Props,properties:[],openBrace:{nodeType:oe.LBrace},closeBrace:{nodeType:oe.RBrace}};for(const i of e)i&&t.properties.push({nodeType:oe.Prop,property:I.ident(i[0]),arguments:i[1]});return t}static prop(e,t,i){e.push({nodeType:oe.Prop,property:I.ident(t),arguments:i})}}class ws{static instance=new ws;static _argumentTypes=new Set([oe.LParen,oe.String,oe.Ident,oe.Number]);readMetaDataArguments(e,t){const i=t.tag.text.toLowerCase();for(const s of Ft.metaDataSignatures)if(s.has(i)){const a=s.get(i);return a?this._readArguments(e,a):void 0}e.addParserDiagnostic({code:at.AT204,message:`Unrecognized metadata '${t.tag.text}'.`,severity:Ze.Error,start:t.start,end:t.end}),e.lexer.fatalError=!0}readMetaDataPropertyArguments(e,t,i){const s=t.tag.text.toLowerCase();if(!Ft.metaDataProperties.has(s))return;const a=Ft.metaDataProperties.get(s);return this._readPropertyArguments(e,[a],i)}readBeatPropertyArguments(e,t){return this._readPropertyArguments(e,[Ft.beatProperties],t)}readDurationChangePropertyArguments(e,t){return this._readPropertyArguments(e,[Ft.durationChangeProperties],t)}readNotePropertyArguments(e,t){return this._readPropertyArguments(e,[Ft.noteProperties,Ft.beatProperties],t)}_readPropertyArguments(e,t,i){const s=i.property.text.toLowerCase(),a=new Set([oe.Ident,oe.RBrace]);for(const c of t)if(c.has(s)){const h=c.get(s);if(h)return this._readArguments(e,h,a);this._skipRemainingArguments(e,[],a);return}let o=e.lexer.peekToken();for(;o&&o.nodeType!==oe.Ident&&o.nodeType!==oe.RBrace;)e.lexer.advance(),o=e.lexer.peekToken();e.addParserDiagnostic({code:at.AT205,message:`Unrecognized property '${i.property.text}'.`,severity:Ze.Error,start:i.property.start,end:o?.start??e.lexer.currentTokenLocation()})}_readArguments(e,t,i){if(t.length===1&&t[0].parameters.length===0)return;const s=[],a=e.lexer.peekToken()?.start,o=i!==void 0,c=new Map(t.map((p,g)=>[g,{signature:p,parameterIndex:0,parameterHasValues:!1,parameterValueMatches:0}])),h=this._filterCandidates(e,c,s,i),d=this._validateArguments(e,c,s,i,t,a);return o&&this._skipRemainingArguments(e,t,i),this._createArgumentList(s,a,e.lexer.previousTokenEndLocation(),d,h)}_validateArguments(e,t,i,s,a,o){const c=e.lexer.peekToken();let h=!1;return t.size!==1&&c===void 0?(e.addParserDiagnostic({code:at.AT203,start:e.lexer.currentTokenLocation(),end:e.lexer.currentTokenLocation(),severity:Ze.Error,message:"Unexpected end of file."}),h=!0):t.size===0&&(c!==void 0&&i.length===0&&s&&!s.has(c.nodeType)&&(i.push(e.lexer.peekToken()),e.lexer.advance()),e.addParserDiagnostic({code:at.AT219,message:`Error parsing arguments: no overload matched arguments ${ws.generateSignaturesFromArguments(i)}. Signatures:
${ws.generateSignatures(a)}`,severity:Ze.Error,start:o,end:e.lexer.previousTokenEndLocation()}),h=!0),h}_createArgumentList(e,t,i,s,a){if(e.length===0)return;const o=I.args(e,!1);return o.start=t,o.end=i,o.validated=!s,a&&(a.length>1&&ws.sortCandidates(a),o.signatureCandidateIndices=a.map(c=>c[0])),o}_filterCandidates(e,t,i,s){const a=e.mode===eu.Full,o=(p,g)=>{const y=t.get(g);if(p.nodeType===oe.LParen){const k=e.argumentList();if(k)for(const _ of k.arguments)a&&(_.parameterIndices||(_.parameterIndices=new Map),_.parameterIndices.set(g,y.parameterIndex)),i.push(_)}else{const k=p;a&&(k.parameterIndices||(k.parameterIndices=new Map),k.parameterIndices.set(g,y.parameterIndex)),(i.length===0||i[i.length-1]!==k)&&(i.push(k),e.lexer.advance())}},c=p=>{e.lexer.extendToFloat(p)},h=ws._argumentTypes;for(;t.size>1||t.size>0&&!ws._hasExactMatch(t);){const p=e.lexer.peekToken();if(!p||!h.has(p.nodeType)||!ws.filterSignatureCandidates(t,p,s!==void 0&&s.has(p.nodeType),o,c))break}const d=e.mode===eu.Full?Array.from(t.entries()):void 0;return ws.filterIncompleteCandidates(t),d}static sortCandidates(e){e.length<2||e.sort((t,i)=>{const s=Math.abs(t[1].parameterIndex-t[1].signature.parameters.length),a=Math.abs(i[1].parameterIndex-i[1].signature.parameters.length);if(s===a){const o=t[1].parameterValueMatches;return i[1].parameterValueMatches-o}return s-a})}_skipRemainingArguments(e,t,i){const s=e.lexer.currentTokenLocation();let a=e.lexer.peekToken(),o=!1;const c=ws._argumentTypes;for(;a&&!i.has(a.nodeType);)c.has(a.nodeType)?(e.lexer.advance(),o=!0,a=e.lexer.peekToken()):a=void 0;o&&e.addParserDiagnostic({code:at.AT220,message:`Error parsing arguments: unexpected additional arguments. Signatures:
${ws.generateSignatures(t)}`,severity:Ze.Error,start:s,end:e.lexer.previousTokenEndLocation()})}static _hasExactMatch(e){for(const t of e.values())if(t.parameterIndex===t.signature.parameters.length)return!0;return!1}static filterIncompleteCandidates(e){const t=new Set;for(const[i,s]of e)for(let a=s.parameterIndex;a<s.signature.parameters.length;a++)switch(s.signature.parameters[a].parseMode){case bs.Required:case bs.RequiredAsFloat:t.add(i);break}for(const i of t)e.delete(i)}static generateSignaturesFromArguments(e){return e?`(${e.map(t=>oe[t.nodeType]).join(", ")})`:"()"}static generateSignatures(e,t){return e.length===0?"()":e.map((i,s)=>ws._generateSignature(i,t!==void 0&&t.size>1&&t.has(s))).join(`
`)}static _generateSignature(e,t){const i=t?" ~":"";return`(${e.parameters.map(ws._generateSignatureParameter).join(", ")})${i}`}static _generateSignatureParameter(e,t){const i=Array.from(e.expectedTypes);let s=`v${t}`;switch(e.parseMode){case bs.Optional:case bs.OptionalAsFloat:s+="?";break}if(e.allowedValues&&e.allowedValues.size<5){const a=Array.from(e.allowedValues);switch(i[0]){case oe.String:s=a.map(o=>`"${o}"`).join("|");break;default:s=a.join("|");break}}else s=Array.from(e.expectedTypes).map(a=>oe[a]).join("|");switch(e.parseMode){case bs.RequiredAsValueList:case bs.ValueListWithoutParenthesis:s+="[]";break}return s}static filterSignatureCandidates(e,t,i,s,a){const o=new Set;let c=!1;for(const[h,d]of e){let p=!1;for(;!p;){const g=d.parameterIndex<d.signature.parameters.length?d.signature.parameters[d.parameterIndex]:void 0;if(!g)i||o.add(h),p=!0;else if(d.signature.isStrict&&d.parameterIndex>0)o.add(h),p=!0;else if((g.expectedTypes.has(t.nodeType)||ws._isValueListMatch(t,g))&&ws._checkArgumentMatch(t,g,a))switch(p=!0,c=!0,s(t,h),g.allowedValues&&d.parameterValueMatches++,g.parseMode){case bs.ValueListWithoutParenthesis:d.parameterHasValues=!0;break;case bs.RequiredAsValueList:d.parameterIndex++,d.parameterHasValues=!1;break;default:d.parameterIndex++,d.parameterHasValues=!1;break}else switch(g.parseMode){case bs.ValueListWithoutParenthesis:d.parameterIndex++,d.parameterHasValues=!1;break;case bs.Required:case bs.RequiredAsFloat:o.add(h),p=!0;break;case bs.Optional:case bs.OptionalAsFloat:d.parameterIndex++,d.parameterHasValues=!1;break;case bs.RequiredAsValueList:d.parameterIndex++,d.parameterHasValues=!1;break}}}if(c)for(const h of o)e.delete(h);return c}static _checkArgumentMatch(e,t,i){switch(e.nodeType){case oe.Ident:const s=e;return t?.allowedValues?t.allowedValues.has(s.text.toLowerCase()):t?.reservedIdentifiers?!t.reservedIdentifiers.has(s.text.toLowerCase()):!0;case oe.String:const a=e;return t?.allowedValues?t.allowedValues.has(a.text.toLowerCase()):!0;case oe.Number:switch(t?.parseMode??bs.Optional){case bs.RequiredAsFloat:case bs.OptionalAsFloat:return i?.(e),!0;default:return!0}case oe.LParen:return!0}return!1}static _isValueListMatch(e,t){return e.nodeType!==oe.LParen?!1:t.expectedTypes.has(oe.Arguments)||t.parseMode===bs.ValueListWithoutParenthesis||t.parseMode===bs.RequiredAsValueList}}var z;(function(n){n[n.Applied=0]="Applied",n[n.NotAppliedSemanticError=1]="NotAppliedSemanticError",n[n.NotAppliedUnrecognizedMarker=2]="NotAppliedUnrecognizedMarker"})(z||(z={}));var ur;(function(n){n[n.AppliedNewTrack=0]="AppliedNewTrack",n[n.AppliedNewStaff=1]="AppliedNewStaff",n[n.AppliedNewVoice=2]="AppliedNewVoice",n[n.NotAppliedSemanticError=3]="NotAppliedSemanticError",n[n.NotAppliedUnrecognizedMarker=4]="NotAppliedUnrecognizedMarker"})(ur||(ur={}));class vn{static _values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);static getValue(e){return vn._values||(vn._values=new Map),e=e.toLowerCase().replaceAll(" ",""),vn._values.has(e)?vn._values.get(e):0}static getName(e){for(const[t,i]of vn._values)if(i===e)return t;return e.toString()}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||e===105||e===43}static isBass(e){return e>=32&&e<=39}static bankToLsbMsb(e){const t=e&127,i=e>>7&127;return[t,i]}}class so{name="";firstFret=1;strings=[];barreFrets=[];staff;showName=!0;showDiagram=!0;showFingering=!0;get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}class Rs extends Ht{constructor(e){super(It.Format,e)}}class Tt{static BlackRgb="#000000";constructor(e,t,i,s=255){this.raw=(s&255)<<24|(e&255)<<16|(t&255)<<8|i&255,this.updateRgba()}updateRgba(){this.a===255?this.rgba=`#${ce.toHexString(this.r,2)}${ce.toHexString(this.g,2)}${ce.toHexString(this.b,2)}`:this.rgba=`rgba(${this.r},${this.g},${this.b},${this.a/255})`}raw=0;get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return this.raw&255}rgba;static random(e=100){return new Tt(Math.random()*255|0,Math.random()*255|0,Math.random()*255|0,e)}static fromJson(e){if(e instanceof Tt)return e;switch(typeof e){case"number":{const t=new Tt(0,0,0,0);return t.raw=e,t.updateRgba(),t}case"string":{const t=e;if(t.startsWith("#")){if(t.length===4)return new Tt(Number.parseInt(t[1],16)*17,Number.parseInt(t[2],16)*17,Number.parseInt(t[3],16)*17);if(t.length===5)return new Tt(Number.parseInt(t[1],16)*17,Number.parseInt(t[2],16)*17,Number.parseInt(t[3],16)*17,Number.parseInt(t[4],16)*17);if(t.length===7)return new Tt(Number.parseInt(t.substring(1,3),16),Number.parseInt(t.substring(3,5),16),Number.parseInt(t.substring(5,7),16));if(t.length===9)return new Tt(Number.parseInt(t.substring(1,3),16),Number.parseInt(t.substring(3,5),16),Number.parseInt(t.substring(5,7),16),Number.parseInt(t.substring(7,9),16))}else if(t.startsWith("rgba")||t.startsWith("rgb")){const i=t.indexOf("("),s=t.lastIndexOf(")");if(i===-1||s===-1)throw new Rs("No values specified for rgb/rgba function");const a=t.substring(i+1,s).split(",");if(a.length===3)return new Tt(Number.parseInt(a[0],10),Number.parseInt(a[1],10),Number.parseInt(a[2],10));if(a.length===4)return new Tt(Number.parseInt(a[0],10),Number.parseInt(a[1],10),Number.parseInt(a[2],10),Number.parseFloat(a[3])*255)}return null}}throw new Rs("Unsupported format for color")}static toJson(e){return e===null?null:e.raw}}var mn;(function(n){n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long"})(mn||(mn={}));class ru{type=mn.Short;length=0}var js;(function(n){n[n.IgnoreSpaces=0]="IgnoreSpaces",n[n.Begin=1]="Begin",n[n.Text=2]="Text",n[n.Comment=3]="Comment",n[n.Dash=4]="Dash"})(js||(js={}));class sn{static _charCodeLF=10;static _charCodeTab=9;static _charCodeCR=13;static _charCodeSpace=32;static _charCodeBrackedClose=93;static _charCodeBrackedOpen=91;static _charCodeDash=45;startBar=0;text="";chunks;finish(e=!1){this.chunks=[],this._parse(this.text,0,this.chunks,e)}_parse(e,t,i,s){if(!e)return;let a=js.Begin,o=js.Begin,c=!1,h=0;for(;t<e.length;){const d=e.charCodeAt(t);switch(a){case js.IgnoreSpaces:switch(d){case sn._charCodeLF:case sn._charCodeCR:case sn._charCodeTab:break;case sn._charCodeSpace:if(!c){a=o;continue}break;default:c=!1,a=o;continue}break;case js.Begin:switch(d){case sn._charCodeBrackedOpen:a=js.Comment;break;default:h=t,a=js.Text;continue}break;case js.Comment:switch(d){case sn._charCodeBrackedClose:a=js.Begin;break}break;case js.Text:switch(d){case sn._charCodeDash:a=js.Dash;break;case sn._charCodeCR:case sn._charCodeLF:case sn._charCodeSpace:const p=e.substr(h,t-h);this._addChunk(p,s),a=js.IgnoreSpaces,o=js.Begin;break}break;case js.Dash:switch(d){case sn._charCodeDash:break;default:const p=e.substr(h,t-h);this._addChunk(p,s),c=!0,a=js.IgnoreSpaces,o=js.Begin;continue}break}t+=1}a===js.Text&&t!==h&&this._addChunk(e.substr(h,t-h),s)}_addChunk(e,t){e=this._prepareChunk(e),(!t||e.length>0&&e!=="-")&&this.chunks.push(e)}_prepareChunk(e){const t=e.split("+").join(" ");let i=t.length;for(;i>0&&t.charAt(i-1)==="_";)i--;return i!==t.length?t.substr(0,i):t}}class ou{marker="";text=""}class de{static _sevenStrings=[];static _sixStrings=[];static _fiveStrings=[];static _fourStrings=[];static _defaultTunings=new Map;static noteNames=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];static getTextForTuning(e,t){const i=de.getTextPartsForTuning(e);return t?i.join(""):i[0]}static getTextPartsForTuning(e,t=-1){const i=e/12|0,s=e%12;return[de.noteNames[s],(i+t).toString()]}static getDefaultTuningFor(e){if(de._defaultTunings.has(e)){const t=de._defaultTunings.get(e);return new de(t.name,t.tunings,t.isStandard)}return null}static getPresetsFor(e){switch(e){case 7:return de._sevenStrings;case 6:return de._sixStrings;case 5:return de._fiveStrings;case 4:return de._fourStrings}return[]}static initialize(){de._defaultTunings.set(7,new de("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),de._sevenStrings.push(de._defaultTunings.get(7)),de._defaultTunings.set(6,new de("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),de._sixStrings.push(de._defaultTunings.get(6)),de._sixStrings.push(new de("Guitar Tune down  step",[63,58,54,49,44,39],!1)),de._sixStrings.push(new de("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),de._sixStrings.push(new de("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),de._sixStrings.push(new de("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),de._sixStrings.push(new de("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),de._sixStrings.push(new de("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),de._sixStrings.push(new de("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),de._sixStrings.push(new de("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),de._sixStrings.push(new de("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),de._sixStrings.push(new de("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),de._sixStrings.push(new de("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),de._sixStrings.push(new de("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),de._sixStrings.push(new de("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),de._sixStrings.push(new de("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),de._sixStrings.push(new de("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),de._sixStrings.push(new de("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),de._sixStrings.push(new de("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),de._sixStrings.push(new de("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),de._sixStrings.push(new de("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),de._sixStrings.push(new de("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),de._sixStrings.push(new de("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),de._sixStrings.push(new de("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),de._sixStrings.push(new de("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),de._sixStrings.push(new de("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),de._sixStrings.push(new de("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),de._sixStrings.push(new de("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),de._sixStrings.push(new de("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),de._sixStrings.push(new de("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),de._sixStrings.push(new de("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),de._sixStrings.push(new de("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),de._defaultTunings.set(5,new de("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),de._fiveStrings.push(de._defaultTunings.get(5)),de._fiveStrings.push(new de("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),de._fiveStrings.push(new de("Banjo Open D Tuning",[62,57,54,50,69],!1)),de._fiveStrings.push(new de("Banjo Open G Tuning",[62,59,55,50,67],!1)),de._fiveStrings.push(new de("Banjo G Minor Tuning",[62,58,55,50,67],!1)),de._fiveStrings.push(new de("Banjo G Modal Tuning",[62,57,55,50,67],!1)),de._defaultTunings.set(4,new de("Bass Standard Tuning",[43,38,33,28],!0)),de._fourStrings.push(de._defaultTunings.get(4)),de._fourStrings.push(new de("Bass Tune down  step",[42,37,32,27],!1)),de._fourStrings.push(new de("Bass Tune down 1 step",[41,36,31,26],!1)),de._fourStrings.push(new de("Bass Tune down 2 step",[39,34,29,24],!1)),de._fourStrings.push(new de("Bass Dropped D Tuning",[43,38,33,26],!1)),de._fourStrings.push(new de("Ukulele C Tuning",[45,40,36,43],!1)),de._fourStrings.push(new de("Ukulele G Tuning",[52,47,43,38],!1)),de._fourStrings.push(new de("Mandolin Standard Tuning",[64,57,50,43],!1)),de._fourStrings.push(new de("Mandolin or Violin Tuning",[76,69,62,55],!1)),de._fourStrings.push(new de("Viola Tuning",[69,62,55,48],!1)),de._fourStrings.push(new de("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){const t=de.getPresetsFor(e.length);for(let i=0,s=t.length;i<s;i++){const a=t[i];let o=!0;for(let c=0,h=e.length;c<h;c++)if(e[c]!==a.tunings[c]){o=!1;break}if(o)return new de(a.name,a.tunings,a.isStandard)}return null}isStandard;name;tunings;constructor(e="",t=null,i=!1){this.isStandard=i,this.name=e,this.tunings=t??[]}reset(){this.isStandard=!1,this.name="",this.tunings=[]}finish(){const e=de.findTuning(this.tunings);e&&(this.name.length===0&&(this.name=e.name),this.isStandard=e.isStandard)}}de.initialize();class el{static DefaultStandardNotationLineCount=5;index=0;track;bars=[];chords=null;capo=0;transpositionPitch=0;displayTranspositionPitch=0;stringTuning=new de("",[],!1);get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}showSlash=!1;showNumbered=!1;showTablature=!0;showStandardNotation=!0;isPercussion=!1;standardNotationLineCount=el.DefaultStandardNotationLineCount;_filledVoices=new Set([0]);get filledVoices(){return this._filledVoices}finish(e,t=null){this.isPercussion&&(this.stringTuning.tunings=[],this.showTablature=!1,this.displayTranspositionPitch=0),this.stringTuning.finish();for(let i=0,s=this.bars.length;i<s;i++){this.bars[i].finish(e,t);for(const a of this.bars[i].filledVoices)this._filledVoices.add(a)}}addChord(e,t){t.staff=this;let i=this.chords;i===null&&(i=new Map,this.chords=i),i.set(e,t)}hasChord(e){return this.chords?.has(e)??!1}getChord(e){return this.chords?.get(e)??null}addBar(e){const t=this.bars;e.staff=this,e.index=t.length,t.length>0&&(e.previousBar=t[t.length-1],e.previousBar.nextBar=e),t.push(e)}}class vb{volume=15;balance=8;port=1;program=0;bank=0;primaryChannel=0;secondaryChannel=0;isMute=!1;isSolo=!1}var Xa;(function(n){n[n.TrackName=0]="TrackName",n[n.BracesAndBrackets=1]="BracesAndBrackets",n[n.SystemSeparator=2]="SystemSeparator",n[n.StringTuning=3]="StringTuning"})(Xa||(Xa={}));class Vx extends Vl{}class Za{static _shortNameMaxLength=10;index=0;score;staves=[];playbackInfo=new vb;color=new Tt(200,0,0,255);name="";isVisibleOnMultiTrack=!0;shortName="";defaultSystemsLayout=3;systemsLayout=[];lineBreaks;get isPercussion(){return this.staves.some(e=>e.isPercussion)}addLineBreaks(e){this.lineBreaks||(this.lineBreaks=new Set),this.lineBreaks.add(e)}percussionArticulations=[];style;ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new el)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,t=null){this.shortName||(this.shortName=this.name,this.shortName.length>Za._shortNameMaxLength&&(this.shortName=this.shortName.substr(0,Za._shortNameMaxLength)));for(const i of this.staves)i.finish(e,t),i.isPercussion&&(this.playbackInfo.program=0)}applyLyrics(e){for(const i of e)i.finish();const t=this.staves[0];for(let i=0;i<e.length;i++){const s=e[i];if(s.startBar>=0&&s.startBar<t.bars.length){let a=t.bars[s.startBar].voices[0].beats[0];for(let o=0;o<s.chunks.length&&a;o++){for(;a&&(a.isEmpty||a.isRest);)a=a.nextBeat;a&&(a.lyrics||(a.lyrics=new Array(e.length),a.lyrics.fill("")),a.lyrics[i]=s.chunks[o],a=a.nextBeat)}}}}}class Wo{id=ce.newGuid();x=0;y=0;width=0;height=0;totalWidth=0;totalHeight=0;firstMasterBarIndex=-1;lastMasterBarIndex=-1;renderResult=null}var jr;(function(n){n[n.Page=0]="Page",n[n.Horizontal=1]="Horizontal"})(jr||(jr={}));class qi{_listeners=[];_fireOnRegister;constructor(e=void 0){this._fireOnRegister=e}on(e){return this._listeners.push(e),this._fireOnRegister?.()&&e(),()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class ot{_listeners=[];_fireOnRegister;constructor(e=void 0){this._fireOnRegister=e}on(e){if(this._listeners.push(e),this._fireOnRegister){const t=this._fireOnRegister();t!==null&&e(t)}return()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class Hx{masterBarBounds;visualBounds;realBounds;bar;beats=[];addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(const i of this.beats)if(!t||i.realBounds.x<e)t=i;else if(i.realBounds.x>e)break;return t}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.beats.sort((t,i)=>t.realBounds.x-i.realBounds.x);for(const t of this.beats)t.finish(e)}}class zx{barBounds;visualBounds;onNotesX=0;realBounds;beat;notes=null;addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const i=this.notes;if(!i)return null;for(const s of i){const a=s.noteHeadBounds.y+s.noteHeadBounds.h,o=s.noteHeadBounds.x+s.noteHeadBounds.w;if(s.noteHeadBounds.x<=e&&s.noteHeadBounds.y<=t&&e<=o&&t<=a)return s.note}return null}finish(e=1){if(this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.onNotesX*=e,this.notes)for(const t of this.notes)t.finish(e)}}class Os{x=0;y=0;w=0;h=0;scaleWith(e){this.x*=e,this.y*=e,this.w*=e,this.h*=e}}class Gx{index=0;isFirstOfLine=!1;visualBounds;realBounds;lineAlignedBounds;bars=[];staffSystemBounds=null;get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e){let t=null;const i=1e7;for(const s of this.bars){const a=s.findBeatAtPos(e);if(a&&(!t||t.realBounds.x<a.realBounds.x)){const o=Math.abs(a.realBounds.x-e);(!t||o<i)&&(t=a)}}return t?t.beat:null}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.lineAlignedBounds.scaleWith(e),this.bars.sort((t,i)=>t.realBounds.y<i.realBounds.y?-1:t.realBounds.y>i.realBounds.y?1:t.realBounds.x<i.realBounds.x?-1:t.realBounds.x>i.realBounds.x?1:0);for(const t of this.bars)t.finish(e)}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class id{beatBounds;noteHeadBounds;note;finish(e=1){this.noteHeadBounds.scaleWith(e)}}class Ux{index=0;visualBounds;realBounds;bars=[];boundsLookup;finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e);for(const t of this.bars)t.finish(e)}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(const i of this.bars)if(!t||i.realBounds.x<e)t=i;else if(e>i.realBounds.x+i.realBounds.w)break;return t}}class Mn{toJson(){const e={},t=[];e.staffSystems=t;for(const i of this.staffSystems){const s={};s.visualBounds=this._boundsToJson(i.visualBounds),s.realBounds=this._boundsToJson(i.realBounds),s.bars=[];for(const a of i.bars){const o={};o.lineAlignedBounds=this._boundsToJson(a.lineAlignedBounds),o.visualBounds=this._boundsToJson(a.visualBounds),o.realBounds=this._boundsToJson(a.realBounds),o.index=a.index,o.bars=[];for(const c of a.bars){const h={};h.visualBounds=this._boundsToJson(c.visualBounds),h.realBounds=this._boundsToJson(c.realBounds),h.beats=[];for(const d of c.beats){const p={};p.visualBounds=this._boundsToJson(d.visualBounds),p.realBounds=this._boundsToJson(d.realBounds),p.onNotesX=d.onNotesX;const g=p;if(g.beatIndex=d.beat.index,g.voiceIndex=d.beat.voice.index,g.barIndex=d.beat.voice.bar.index,g.staffIndex=d.beat.voice.bar.staff.index,g.trackIndex=d.beat.voice.bar.staff.track.index,d.notes){const y=[];p.notes=y;for(const k of d.notes){const _={},w=_;w.index=k.note.index,_.noteHeadBounds=this._boundsToJson(k.noteHeadBounds),y.push(_)}}h.beats.push(p)}o.bars.push(h)}s.bars.push(o)}t.push(s)}return e}static fromJson(e,t){const i=new Mn,s=e.staffSystems;for(const a of s){const o=new Ux;o.visualBounds=Mn._boundsFromJson(a.visualBounds),o.realBounds=Mn._boundsFromJson(a.realBounds),i.addStaffSystem(o);for(const c of a.bars){const h=new Gx;h.index=c.index,h.isFirstOfLine=c.isFirstOfLine,h.lineAlignedBounds=Mn._boundsFromJson(c.lineAlignedBounds),h.visualBounds=Mn._boundsFromJson(c.visualBounds),h.realBounds=Mn._boundsFromJson(c.realBounds),o.addBar(h);for(const d of c.bars){const p=new Hx;p.visualBounds=Mn._boundsFromJson(d.visualBounds),p.realBounds=Mn._boundsFromJson(d.realBounds),h.addBar(p);for(const g of d.beats){const y=new zx;y.visualBounds=Mn._boundsFromJson(g.visualBounds),y.realBounds=Mn._boundsFromJson(g.realBounds),y.onNotesX=g.onNotesX;const k=g;if(y.beat=t.tracks[k.trackIndex].staves[k.staffIndex].bars[k.barIndex].voices[k.voiceIndex].beats[k.beatIndex],g.notes){y.notes=[];for(const _ of g.notes){const w=new id,T=_;w.note=y.beat.notes[T.index],w.noteHeadBounds=Mn._boundsFromJson(_.noteHeadBounds),y.addNote(w)}}p.addBeat(y)}}}}return i}static _boundsFromJson(e){const t=new Os;return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}_boundsToJson(e){const t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}_beatLookup=new Map;_masterBarLookup=new Map;_currentStaffSystem=null;staffSystems=[];isFinished=!1;finish(e=1){for(const t of this.staffSystems)t.finish(e);this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),this._beatLookup.get(e.beat.id)?.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){const t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){const t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let i=0,s=this.staffSystems.length-1,a=-1;for(;i<=s;){const h=(s+i)/2|0,d=this.staffSystems[h];if(t>=d.realBounds.y&&t<=d.realBounds.y+d.realBounds.h){a=h;break}t<d.realBounds.y?s=h-1:i=h+1}if(a===-1)return null;const c=this.staffSystems[a].findBarAtPos(e);return c?c.findBeatAtPos(e):null}getNoteAtPos(e,t,i){const s=this.findBeats(e);if(s)for(const a of s){const o=a.findNoteAtPos(t,i);if(o)return o}return null}}class ph{_currentLayoutMode=jr.Page;_currentRenderEngine=null;_renderedTracks=null;canvas=null;score=null;tracks=null;layout=null;settings;boundsLookup=null;width=0;constructor(e){this.settings=e,this._recreateCanvas(),this._recreateLayout()}destroy(){this.score=null,this.canvas?.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}_recreateCanvas(){return this._currentRenderEngine!==this.settings.core.engine?(this.canvas?.destroy(),this.canvas=ne.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0):!1}_recreateLayout(){return!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode?(this.layout=ne.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0):!1}renderScore(e,t){try{this.score=e;let i=null;if(e!=null&&t!=null){if(!t)i=e.tracks.slice(0);else{i=[];for(const s of t)s>=0&&s<e.tracks.length&&i.push(e.tracks[s])}i.length===0&&e.tracks.length>0&&i.push(e.tracks[0])}this.tracks=i,this.render()}catch(i){this.error.trigger(i)}}renderTracks(e){e.length===0?this.score=null:this.score=e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(ee.debug("Rendering",`Request render of lazy partial ${e}`),t.renderLazyPartial(e)):ee.warning("Rendering",`Request render of lazy partial ${e} ignored, no layout exists`)}catch(t){this.error.trigger(t)}}render(){if(this.width===0){ee.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null);return}if(this.boundsLookup=new Mn,this._recreateCanvas(),this.canvas.lineWidth=1,this.canvas.settings=this.settings,!this.tracks||this.tracks.length===0||!this.score)ee.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this._onRenderFinished(),this.postRenderFinished.trigger(),ee.debug("Rendering","Clearing finished");else{ee.debug("Rendering",`Rendering ${this.tracks.length} tracks`);for(let e=0;e<this.tracks.length;e++){const t=this.tracks[e];ee.debug("Rendering",`Track ${e}: ${t.name}`)}this.preRender.trigger(!1),this._recreateLayout(),this._layoutAndRender(),ee.debug("Rendering","Rendering finished")}}resizeRender(){this._recreateLayout()||this._recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(ee.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(ee.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new Mn,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this._onRenderFinished(),this.postRenderFinished.trigger()):ee.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),ee.debug("Rendering","Resize finished")}_layoutAndRender(){ee.debug("Rendering",`Rendering at scale ${this.settings.display.scale} with layout ${this.layout.name}`,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this._onRenderFinished(),this.postRenderFinished.trigger()}preRender=new ot;renderFinished=new ot;partialRenderFinished=new ot;partialLayoutFinished=new ot;postRenderFinished=new qi;error=new ot;_onRenderFinished(){this.boundsLookup?.finish(this.settings.display.scale);const e=new Wo;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}var j;(function(n){n[n.Up=0]="Up",n[n.Down=1]="Down"})(j||(j={}));class Ie{static instance=new Ie;applyScoreMetaData(e,t,i){const s=this._checkArgumentTypes(e,[Ft.scoreMetaDataSignatures],i,i.tag.tag.text.toLowerCase(),i.arguments);if(s!==void 0)return s;switch(i.tag.tag.text.toLowerCase()){case"title":return t.title=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Title,i),z.Applied;case"subtitle":return t.subTitle=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.SubTitle,i),z.Applied;case"artist":return t.artist=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Artist,i),z.Applied;case"album":return t.album=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Album,i),z.Applied;case"words":return t.words=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Words,i),z.Applied;case"music":return t.music=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Music,i),z.Applied;case"copyright":return t.copyright=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Copyright,i),z.Applied;case"instructions":return t.instructions=i.arguments.arguments[0].text,z.Applied;case"notices":return t.notices=i.arguments.arguments[0].text,z.Applied;case"tab":return t.tab=i.arguments.arguments[0].text,this._headerFooterStyle(e,t,ye.Transcriber,i),z.Applied;case"copyright2":return this._headerFooterStyle(e,t,ye.CopyrightSecondLine,i,0),z.Applied;case"wordsandmusic":return this._headerFooterStyle(e,t,ye.WordsAndMusic,i,0),z.Applied;case"defaultsystemslayout":return t.defaultSystemsLayout=i.arguments.arguments[0].value,z.Applied;case"systemslayout":for(const y of i.arguments.arguments)t.systemsLayout.push(y.value);return z.Applied;case"hidedynamics":return t.stylesheet.hideDynamics=!0,z.Applied;case"showdynamics":return t.stylesheet.hideDynamics=!1,z.Applied;case"bracketextendmode":const a=Ie._parseEnumValue(e,i.arguments,"bracket extend mode",xe.bracketExtendMode);return a===void 0?z.NotAppliedSemanticError:(t.stylesheet.bracketExtendMode=a,z.Applied);case"usesystemsignseparator":return t.stylesheet.useSystemSignSeparator=!0,z.Applied;case"multibarrest":return t.stylesheet.multiTrackMultiBarRest=!0,z.Applied;case"singletracktracknamepolicy":const o=Ie._parseEnumValue(e,i.arguments,"track name policy",xe.trackNamePolicy);return o===void 0?z.NotAppliedSemanticError:(t.stylesheet.singleTrackTrackNamePolicy=o,z.Applied);case"multitracktracknamepolicy":const c=Ie._parseEnumValue(e,i.arguments,"track name policy",xe.trackNamePolicy);return c===void 0?z.NotAppliedSemanticError:(t.stylesheet.multiTrackTrackNamePolicy=c,z.Applied);case"firstsystemtracknamemode":const h=Ie._parseEnumValue(e,i.arguments,"track name mode",xe.trackNameMode);return h===void 0?z.NotAppliedSemanticError:(t.stylesheet.firstSystemTrackNameMode=h,z.Applied);case"othersystemstracknamemode":const d=Ie._parseEnumValue(e,i.arguments,"track name mode",xe.trackNameMode);return d===void 0?z.NotAppliedSemanticError:(t.stylesheet.otherSystemsTrackNameMode=d,z.Applied);case"firstsystemtracknameorientation":const p=Ie._parseEnumValue(e,i.arguments,"track name orientation",xe.trackNameOrientation);return p===void 0?z.NotAppliedSemanticError:(t.stylesheet.firstSystemTrackNameOrientation=p,z.Applied);case"othersystemstracknameorientation":const g=Ie._parseEnumValue(e,i.arguments,"track name orientation",xe.trackNameOrientation);return g===void 0?z.NotAppliedSemanticError:(t.stylesheet.otherSystemsTrackNameOrientation=g,z.Applied);default:return z.NotAppliedUnrecognizedMarker}}_checkArgumentTypes(e,t,i,s,a){const o=t.find(h=>h.has(s));if(!o)return z.NotAppliedUnrecognizedMarker;const c=o.get(s);if(!c){a&&e.addSemanticDiagnostic({code:at.AT300,message:"Expected no arguments, but found some.",start:a.start,end:a.end,severity:Ze.Warning});return}if(!this._validateArgumentTypes(e,c,i,a))return z.NotAppliedSemanticError}applyStaffMetaData(e,t,i){const s=this._checkArgumentTypes(e,[Ft.staffMetaDataSignatures],i,i.tag.tag.text.toLowerCase(),i.arguments);if(s!==void 0)return s;switch(i.tag.tag.text.toLowerCase()){case"capo":return t.capo=i.arguments.arguments[0].value,z.Applied;case"tuning":const a=[];let o=!1,c="";for(let y=0;y<i.arguments.arguments.length;y++){const k=i.arguments.arguments[y],_=k.text;switch(_){case"piano":case"none":case"voice":e.applyStaffNoteKind(t,tn.Pitched),y=i.arguments.arguments.length;break;case"hide":o=!0,e.addSemanticDiagnostic({code:at.AT305,message:"This value should be rather specified via the properties.",start:k.start,end:k.end,severity:Ze.Warning});break;default:const w=ce.parseTuning(_);if(w)a.push(w.realValue);else if(y===i.arguments.arguments.length-1&&a.length>0)c=_,e.addSemanticDiagnostic({code:at.AT305,message:"This value should be rather specified via the properties.",start:k.start,end:k.end,severity:Ze.Warning});else{const T=Array.from(ce.tuningLetters).join(","),x=Array.from(ce.accidentalModeMapping.keys()).join(",");e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected tuning value '${_}', expected: <note><accidental><octave> where <note>=oneOf(${T}) <accidental>=oneOf(${x}), <octave>=number`,start:k.start,end:k.end,severity:Ze.Error})}break}}return e.state.staffHasExplicitTuning.add(t),e.state.staffTuningApplied.delete(t),t.stringTuning=new de,t.stringTuning.tunings=a,t.stringTuning.name=c,this._tuningProperties(e,t,t.stringTuning,i),o&&(t.track.score.stylesheet.perTrackDisplayTuning||(t.track.score.stylesheet.perTrackDisplayTuning=new Map),t.track.score.stylesheet.perTrackDisplayTuning.set(t.track.index,!1)),z.Applied;case"instrument":return e.state.staffTuningApplied.delete(t),this._readTrackInstrument(e,t.track,i.arguments),z.Applied;case"bank":return t.track.playbackInfo.bank=i.arguments.arguments[0].value,z.Applied;case"lyrics":const h=new sn;return h.startBar=0,h.text="",i.arguments.arguments.length===2?(h.startBar=i.arguments.arguments[0].value,h.text=i.arguments.arguments[1].text):h.text=i.arguments.arguments[0].text,e.state.lyrics.get(t.track.index).push(h),z.Applied;case"chord":const d=new so;this._chordProperties(e,d,i),d.name=i.arguments.arguments[0].text;for(let y=1;y<i.arguments.arguments.length;y++){const k=i.arguments.arguments[y];if(k.nodeType===oe.Number)d.strings.push(k.value);else if(k.nodeType===oe.Ident){const _=k.text;_==="x"?d.strings.push(-1):e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected chord value '${_}', expected: 'x'`,severity:Ze.Error,start:k.start,end:k.end})}}return t.addChord(Ie._getChordId(t,d.name),d),z.Applied;case"articulation":const p=e.state.percussionArticulationNames,g=i.arguments.arguments[0].text;if(g==="defaults"){for(const[y,k]of $i.instrumentArticulationNames)p.set(y.toLowerCase(),k),p.set(ce.toArticulationId(y),k);return z.Applied}if(i.arguments.arguments.length===2){const y=i.arguments.arguments[1].value;if($i.instrumentArticulations.has(y))return p.set(g.toLowerCase(),y),z.Applied;{const k=Array.from($i.instrumentArticulations.keys()).map(_=>`${_}`).join(",");return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected articulation value '${y}', expected: ${k}`,start:i.arguments.arguments[1].start,end:i.arguments.arguments[1].end,severity:Ze.Error}),z.NotAppliedSemanticError}}return z.Applied;case"accidentals":return Ie._handleAccidentalMode(e,i.arguments);case"displaytranspose":return t.displayTranspositionPitch=i.arguments.arguments[0].value*-1,e.state.staffHasExplicitDisplayTransposition.add(t),z.Applied;case"transpose":return t.transpositionPitch=i.arguments.arguments[0].value*-1,z.Applied;default:return z.NotAppliedUnrecognizedMarker}}applyBarMetaData(e,t,i){const s=this._checkArgumentTypes(e,[Ft.barMetaDataSignatures],i,i.tag.tag.text.toLowerCase(),i.arguments);if(s!==void 0)return s;switch(i.tag.tag.text.toLowerCase()){case"sync":const a=this._buildSyncPoint(i);return e.state.syncPoints.push(a),z.Applied;case"tempo":let o=0;const c=i.arguments.arguments[o++].value;let h="",d=!0,p=0;for(;o<i.arguments.arguments.length;){switch(i.arguments.arguments[o].nodeType){case oe.Ident:case oe.String:const D=i.arguments.arguments[o].text;D==="hide"?d=!1:h=D;break;case oe.Number:p=i.arguments.arguments[o].value;break}o++}let g=t.masterBar.tempoAutomations.find(D=>D.ratioPosition===p);return g||(g=new jt,t.masterBar.tempoAutomations.push(g)),g.isLinear=!1,g.type=Mt.Tempo,g.value=c,g.text=h,g.ratioPosition=p,g.isVisible=d,z.Applied;case"rc":return t.masterBar.repeatCount=i.arguments.arguments[0].value,z.Applied;case"ae":for(const D of i.arguments.arguments)if(D.nodeType===oe.Number){const H=D.value;if(H<1||H>31)return e.addSemanticDiagnostic({code:at.AT211,message:"Value is out of valid range. Allowed range: %s, Actual Value: %s",severity:Ze.Error,start:D.start,end:D.end}),z.NotAppliedSemanticError;t.masterBar.alternateEndings|=1<<H-1}else e.addSemanticDiagnostic({code:at.AT202,message:`Unexpected '${oe[D.nodeType]}' token. Expected one of following: ${oe[oe.Number]}`,severity:Ze.Error,start:D.start,end:D.end});return z.Applied;case"ts":switch(i.arguments.arguments[0].nodeType){case oe.Number:t.masterBar.timeSignatureNumerator=i.arguments.arguments[0].value,t.masterBar.timeSignatureDenominator=i.arguments.arguments[1].value;break;case oe.Ident:case oe.String:const D=i.arguments.arguments[0].text;if(D.toLowerCase()==="common")t.masterBar.timeSignatureCommon=!0,t.masterBar.timeSignatureNumerator=4,t.masterBar.timeSignatureDenominator=4;else return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected time signature value '${D}', expected: common or two numbers`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),z.NotAppliedSemanticError;break}return z.Applied;case"ks":const y=Ie._parseEnumValue(e,i.arguments,"key signature",xe.keySignature);if(y===void 0)return z.NotAppliedSemanticError;const k=Ie._parseEnumValue(e,i.arguments,"key signature type",xe.keySignatureType);return k===void 0?z.NotAppliedSemanticError:(t.keySignature=y,t.keySignatureType=k,z.Applied);case"clef":switch(i.arguments.arguments[0].nodeType){case oe.Ident:case oe.String:const D=Ie._parseEnumValue(e,i.arguments,"clef",xe.clef);if(D===void 0)return z.NotAppliedSemanticError;t.clef=D;break;case oe.Number:const H=i.arguments.arguments[0].value;switch(H){case 0:t.clef=_t.Neutral;break;case 43:t.clef=_t.G2;break;case 65:t.clef=_t.F4;break;case 48:t.clef=_t.C3;break;case 60:t.clef=_t.C4;break;default:return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected clef value '${H}', expected: ${Array.from(xe.clef.keys()).join(",")}`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),z.NotAppliedSemanticError}break}return z.Applied;case"section":const _=new ou;return i.arguments.arguments.length===1?_.text=i.arguments.arguments[0].text:(_.marker=i.arguments.arguments[0].text,_.text=i.arguments.arguments[1].text),t.masterBar.section=_,z.Applied;case"tf":switch(i.arguments.arguments[0].nodeType){case oe.Ident:case oe.String:const D=Ie._parseEnumValue(e,i.arguments,"triplet feel",xe.tripletFeel);if(D===void 0)return z.NotAppliedSemanticError;t.masterBar.tripletFeel=D;break;case oe.Number:const H=i.arguments.arguments[0].value;switch(H){case 0:t.masterBar.tripletFeel=yt.NoTripletFeel;break;case 1:t.masterBar.tripletFeel=yt.Triplet16th;break;case 2:t.masterBar.tripletFeel=yt.Triplet8th;break;case 3:t.masterBar.tripletFeel=yt.Dotted16th;break;case 4:t.masterBar.tripletFeel=yt.Dotted8th;break;case 5:t.masterBar.tripletFeel=yt.Scottish16th;break;case 6:t.masterBar.tripletFeel=yt.Scottish8th;break;default:return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected triplet feel value '${H}', expected: ${Array.from(xe.tripletFeel.keys()).join(",")}`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),z.NotAppliedSemanticError}break}return z.Applied;case"barlineleft":const w=Ie._parseEnumValue(e,i.arguments,"bar line",xe.barLineStyle);return w===void 0?z.NotAppliedSemanticError:(t.barLineLeft=w,z.Applied);case"barlineright":const T=Ie._parseEnumValue(e,i.arguments,"bar line",xe.barLineStyle);return T===void 0?z.NotAppliedSemanticError:(t.barLineRight=T,z.Applied);case"accidentals":return Ie._handleAccidentalMode(e,i.arguments);case"jump":const x=Ie._parseEnumValue(e,i.arguments,"direction",xe.direction);return x===void 0?z.NotAppliedSemanticError:(t.masterBar.addDirection(x),z.Applied);case"ottava":const E=Ie._parseEnumValue(e,i.arguments,"clef ottava",xe.ottavia);return E===void 0?z.NotAppliedSemanticError:(t.clefOttava=E,z.Applied);case"simile":const N=Ie._parseEnumValue(e,i.arguments,"simile mark",xe.simileMark);return N===void 0?z.NotAppliedSemanticError:(t.simileMark=N,z.Applied);case"width":return t.masterBar.displayWidth=i.arguments.arguments[0].value,t.displayWidth=t.masterBar.displayWidth,z.Applied;case"scale":return t.masterBar.displayScale=i.arguments.arguments[0].value,t.displayScale=t.masterBar.displayScale,z.Applied;case"spd":const v=new Qr;return v.pedalType=ai.Down,v.ratioPosition=i.arguments.arguments[0].value,t.sustainPedals.push(v),z.Applied;case"spu":const L=new Qr;return L.pedalType=ai.Up,L.ratioPosition=i.arguments.arguments[0].value,t.sustainPedals.push(L),z.Applied;case"sph":const A=new Qr;return A.pedalType=ai.Hold,A.ratioPosition=i.arguments.arguments[0].value,t.sustainPedals.push(A),z.Applied;case"ft":return t.masterBar.isFreeTime=!0,z.Applied;case"ro":return t.masterBar.isRepeatStart=!0,z.Applied;case"ac":return t.masterBar.isAnacrusis=!0,z.Applied;case"db":return t.masterBar.isDoubleBar=!0,t.barLineRight=et.LightLight,z.Applied;default:return z.NotAppliedUnrecognizedMarker}}static _handleAccidentalMode(e,t){const i=Ie._parseEnumValue(e,t,"accidental mode",xe.alphaTexAccidentalMode);return i===void 0?z.NotAppliedSemanticError:(e.state.accidentalMode=i,z.Applied)}static _getChordId(e,t){return t.toLowerCase()+e.index+e.track.index}_buildSyncPoint(e){const t=e.arguments.arguments[0].value,i=e.arguments.arguments[1].value,s=e.arguments.arguments[2].value;let a=0;return e.arguments.arguments.length>3&&(a=e.arguments.arguments[3].value),{barIndex:t,barOccurence:i,barPosition:a,millisecondOffset:s}}_validateArgumentTypes(e,t,i,s){if(!s)return t.some(g=>g.parameters.length===0||!g.parameters.some(y=>y.parseMode===bs.Required||y.parseMode===bs.RequiredAsFloat||y.parseMode===bs.RequiredAsValueList))?!0:(e.addSemanticDiagnostic({code:at.AT219,message:`Error parsing arguments: no overload matched arguments ${ws.generateSignaturesFromArguments(void 0)}. Signatures: ${ws.generateSignatures(t)}`,severity:Ze.Error,start:i.start,end:i.end}),!1);if(s.validated)return!0;let a=!1;const o=new Map(t.map((p,g)=>[g,{signature:p,parameterIndex:0,parameterValueMatches:0,parameterHasValues:!1}])),c=e.parseMode===eu.Full,h=c?(p,g)=>{const y=o.get(g),k=p;k.parameterIndices||(k.parameterIndices=new Map),k.parameterIndices.set(g,y.parameterIndex)}:(p,g)=>{};for(const p of s.arguments)if(ws.filterSignatureCandidates(o,p,!1,h),o.size===0)break;const d=c?Array.from(o.entries()):void 0;return ws.filterIncompleteCandidates(o),o.size===0&&(e.addSemanticDiagnostic({code:at.AT219,message:`Error parsing arguments: no overload matched arguments ${ws.generateSignaturesFromArguments(s.arguments)}. Signatures:
${ws.generateSignatures(t)}`,severity:Ze.Error,start:s.start,end:s.end}),a=!0),d&&(ws.sortCandidates(d),s.signatureCandidateIndices=d.map(p=>p[0])),!a}_headerFooterStyle(e,t,i,s,a=1){const o=s.arguments.arguments.length-a;if(o<1)return;const c=ce.getOrCreateHeaderFooterStyle(t,i);c.isVisible===void 0&&(c.isVisible=!0);const h=s.arguments.arguments[a].text;if(h?c.template=h:c.isVisible=!1,o<2)return;const d=Ie._parseEnumValue(e,s.arguments,"textAlign",xe.textAlign,a+1);d!==void 0&&(c.textAlign=d)}_readTrackInstrument(e,t,i){switch(i.arguments[0].nodeType){case oe.Number:const s=i.arguments[0].value;s>=0&&s<=127?t.playbackInfo.program=s:e.addSemanticDiagnostic({code:at.AT211,message:`Value is out of valid range. Allowed range: 0-127, Actual Value: ${s}`,start:i.arguments[0].start,end:i.arguments[0].end,severity:Ze.Error});break;case oe.Ident:case oe.String:const a=i.arguments[0].text.toLowerCase();if(a==="percussion"){for(const o of t.staves)e.applyStaffNoteKind(o,tn.Articulation);t.playbackInfo.primaryChannel=Xe.PercussionChannel,t.playbackInfo.secondaryChannel=Xe.PercussionChannel}else t.playbackInfo.program=vn.getValue(a);break}}_chordProperties(e,t,i){if(i.properties){for(const s of i.properties.properties)if(this._checkProperty(e,[Ft.metaDataProperties.get("chord")],s))switch(s.property.text.toLowerCase()){case"firstfret":t.firstFret=s.arguments.arguments[0].value;break;case"showdiagram":t.showDiagram=Ie._booleanLikeValue(s.arguments.arguments,0);break;case"showfingering":t.showFingering=Ie._booleanLikeValue(s.arguments.arguments,0);break;case"showname":t.showName=Ie._booleanLikeValue(s.arguments.arguments,0);break;case"barre":t.barreFrets=s.arguments.arguments.map(a=>a.value);break}}}_tuningProperties(e,t,i,s){if(s.properties){for(const a of s.properties.properties)if(this._checkProperty(e,[Ft.metaDataProperties.get("tuning")],a))switch(a.property.text.toLowerCase()){case"hide":t.track.score.stylesheet.perTrackDisplayTuning||(t.track.score.stylesheet.perTrackDisplayTuning=new Map),t.track.score.stylesheet.perTrackDisplayTuning.set(t.track.index,!1);break;case"label":i.name=a.arguments.arguments[0].text;break}}}static _booleanLikeValue(e,t){if(t>=e.length)return!0;const i=e[t];switch(i.nodeType){case oe.String:case oe.Ident:return i.text!=="false";case oe.Number:return i.value!==0;default:return!1}}applyStructuralMetaData(e,t){const i=this._checkArgumentTypes(e,[Ft.structuralMetaDataSignatures],t,t.tag.tag.text.toLowerCase(),t.arguments);if(i!==void 0)switch(i){case z.NotAppliedSemanticError:return ur.NotAppliedSemanticError;case z.NotAppliedUnrecognizedMarker:return ur.NotAppliedUnrecognizedMarker}switch(t.tag.tag.text.toLowerCase()){case"staff":const s=e.startNewStaff();return this._staffProperties(e,s,t),ur.AppliedNewStaff;case"track":const a=e.startNewTrack();return t.arguments&&t.arguments.arguments.length>0&&(a.name=t.arguments.arguments[0].text,t.arguments.arguments.length>1&&(a.shortName=t.arguments.arguments[1].text)),this._trackProperties(e,a,t),ur.AppliedNewTrack;case"voice":return e.startNewVoice(),ur.AppliedNewVoice;default:return ur.NotAppliedUnrecognizedMarker}}_checkProperty(e,t,i){const s=this._checkArgumentTypes(e,t,i,i.property.text.toLowerCase(),i.arguments);if(s!==void 0)switch(s){case z.Applied:case z.NotAppliedSemanticError:return!1;case z.NotAppliedUnrecognizedMarker:const a=t.flatMap(o=>Array.from(o.keys()));return e.addSemanticDiagnostic({code:at.AT212,message:`Unrecogized property '${i.property.text}', expected one of ${a}`,severity:Ze.Error,start:i.start,end:i.end}),!1}return!0}_staffProperties(e,t,i){if(!i.properties)return;let s=!1,a=!1,o=!1,c=!1;for(const h of i.properties.properties)if(this._checkProperty(e,[Ft.metaDataProperties.get("staff")],h))switch(h.property.text.toLowerCase()){case"score":s=!0,h.arguments&&h.arguments.arguments.length>0&&(t.standardNotationLineCount=h.arguments.arguments[0].value);break;case"tabs":a=!0;break;case"slash":o=!0;break;case"numbered":c=!0;break}(s||a||o||c)&&(t.showStandardNotation=s,t.showTablature=a,t.showSlash=o,t.showNumbered=c)}_trackProperties(e,t,i){if(i.properties){for(const s of i.properties.properties)if(this._checkProperty(e,[Ft.metaDataProperties.get("track")],s))switch(s.property.text.toLowerCase()){case"color":try{t.color=Tt.fromJson(s.arguments.arguments[0].text)}catch{e.addSemanticDiagnostic({code:at.AT213,message:"Invalid format for color",severity:Ze.Error,start:s.arguments.arguments[0].start,end:s.arguments.arguments[0].end})}break;case"defaultsystemslayout":t.defaultSystemsLayout=s.arguments.arguments[0].value;break;case"systemslayout":t.systemsLayout=s.arguments.arguments.map(a=>a.value);break;case"volume":t.playbackInfo.volume=s.arguments.arguments[0].value;break;case"balance":t.playbackInfo.balance=s.arguments.arguments[0].value;break;case"mute":t.playbackInfo.isMute=!0;break;case"solo":t.playbackInfo.isSolo=!0;break;case"multibarrest":t.score.stylesheet.perTrackMultiBarRest||(t.score.stylesheet.perTrackMultiBarRest=new Set),t.score.stylesheet.perTrackMultiBarRest.add(t.index);break;case"instrument":this._readTrackInstrument(e,t,s.arguments);break;case"bank":t.playbackInfo.bank=s.arguments.arguments[0].value;break}}}applyBeatDurationProperty(e,t){const i=this._checkArgumentTypes(e,[Ft.durationChangeProperties],t,t.property.text.toLowerCase(),t.arguments);if(i!==void 0)return i;switch(t.property.text.toLowerCase()){case"tu":if(t.arguments.arguments.length===2)e.state.currentTupletNumerator=t.arguments.arguments[0].value,e.state.currentTupletDenominator=t.arguments.arguments[1].value;else{const s=t.arguments.arguments[0].value;e.state.currentTupletNumerator=s;const a=Ie._getTupletDenominator(s);a<0?(e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected default tuplet value '${s}', expected: 3, 5, 6, 7, 9, 10, 11 or 12`,severity:Ze.Error,start:t.arguments.arguments[0].start,end:t.arguments.arguments[0].end}),e.state.currentTupletNumerator=-1,e.state.currentTupletDenominator=-1):e.state.currentTupletDenominator=a}return z.Applied}return z.NotAppliedUnrecognizedMarker}static _getTupletDenominator(e){switch(e){case 3:return 2;case 5:return 4;case 6:return 4;case 7:return 4;case 9:return 8;case 10:return 8;case 11:return 8;case 12:return 8;default:return-1}}_allKnownBarMetaDataTags=void 0;get allKnownMetaDataTags(){if(!this._allKnownBarMetaDataTags){this._allKnownBarMetaDataTags=new Set;const e=[Ft.scoreMetaDataSignatures.keys(),Ft.structuralMetaDataSignatures.keys(),Ft.staffMetaDataSignatures.keys(),Ft.barMetaDataSignatures.keys()];for(const t of e)for(const i of t)this._allKnownBarMetaDataTags.add(i)}return this._allKnownBarMetaDataTags}_knownScoreMetaDataTags=void 0;get knownScoreMetaDataTags(){return this._knownScoreMetaDataTags||(this._knownScoreMetaDataTags=new Set(Ft.scoreMetaDataSignatures.keys())),this._knownScoreMetaDataTags}_knownStructuralMetaDataTags=void 0;get knownStructuralMetaDataTags(){return this._knownStructuralMetaDataTags||(this._knownStructuralMetaDataTags=new Set(Ft.structuralMetaDataSignatures.keys())),this._knownStructuralMetaDataTags}_knownBarMetaDataTags=void 0;get knownBarMetaDataTags(){return this._knownBarMetaDataTags||(this._knownBarMetaDataTags=new Set(Ft.barMetaDataSignatures.keys())),this._knownBarMetaDataTags}_knownStaffMetaDataTags=void 0;get knownStaffMetaDataTags(){return this._knownStaffMetaDataTags||(this._knownStaffMetaDataTags=new Set(Ft.staffMetaDataSignatures.keys())),this._knownStaffMetaDataTags}_knownBeatDurationProperties=void 0;get knownBeatDurationProperties(){return this._knownBeatDurationProperties||(this._knownBeatDurationProperties=new Set(Ft.durationChangeProperties.keys())),this._knownBeatDurationProperties}_knownBeatProperties=void 0;get knownBeatProperties(){return this._knownBeatProperties||(this._knownBeatProperties=new Set(Ft.beatProperties.keys())),this._knownBeatProperties}_knownNoteProperties=void 0;get knownNoteProperties(){return this._knownNoteProperties||(this._knownNoteProperties=new Set(Ft.noteProperties.keys())),this._knownNoteProperties}applyBeatProperty(e,t,i){const s=i.property.text.toLowerCase(),a=this._checkArgumentTypes(e,[Ft.beatProperties],i,s,i.arguments);if(a!==void 0)return a;switch(s){case"f":return t.fade=Xi.FadeIn,z.Applied;case"fo":return t.fade=Xi.FadeOut,z.Applied;case"vs":return t.fade=Xi.VolumeSwell,z.Applied;case"v":return t.vibrato=ct.Slight,z.Applied;case"vw":return t.vibrato=ct.Wide,z.Applied;case"s":return t.slap=!0,z.Applied;case"p":return t.pop=!0,z.Applied;case"tt":return t.tap=!0,z.Applied;case"txt":return t.text=i.arguments.arguments[0].text,z.Applied;case"lyrics":let o=0,c="";for(i.arguments.arguments.length===2?(o=i.arguments.arguments[0].value,c=i.arguments.arguments[1].text):c=i.arguments.arguments[0].text,t.lyrics||(t.lyrics=[]);t.lyrics.length<=o;)t.lyrics.push("");return t.lyrics[o]=c,z.Applied;case"dd":return t.dots=2,z.Applied;case"d":return t.dots=1,z.Applied;case"su":return t.pickStroke=ds.Up,z.Applied;case"sd":return t.pickStroke=ds.Down,z.Applied;case"tu":if(i.arguments.arguments.length===2)t.tupletNumerator=i.arguments.arguments[0].value,t.tupletDenominator=i.arguments.arguments[1].value;else{const Q=i.arguments.arguments[0].value;t.tupletNumerator=Q;const Z=Ie._getTupletDenominator(Q);if(Z<0)return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected default tuplet value '${Q}', expected: 3, 5, 6, 7, 9, 10, 11 or 12`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),t.tupletNumerator=-1,t.tupletDenominator=-1,z.NotAppliedSemanticError;t.tupletDenominator=Z}return z.Applied;case"tb":case"tbe":let h=0,d=!0,p=!1;for(;d;)switch(i.arguments.arguments[h].nodeType){case oe.Ident:case oe.String:const Q=i.arguments.arguments[h].text.toLowerCase();if(xe.whammyType.has(Q))t.whammyBarType=xe.whammyType.get(Q),p=!0,h++;else if(xe.bendStyle.has(Q))t.whammyStyle=xe.bendStyle.get(Q),h++;else return p?Ie._parseEnumValue(e,i.arguments,"whammy style",xe.bendStyle,h):Ie._parseEnumValue(e,i.arguments,"whammy type",xe.whammyType,h),z.NotAppliedSemanticError;break;default:d=!1;break}const g=this._getBendPoints(e,i,h,s==="tbe");if(g)for(const Q of g)t.addWhammyBarPoint(Q);return z.Applied;case"bu":return Ie._applyBrush(t,i,Ne.BrushUp,.25),z.Applied;case"bd":return Ie._applyBrush(t,i,Ne.BrushDown,.25),z.Applied;case"au":return Ie._applyBrush(t,i,Ne.ArpeggioUp,1),z.Applied;case"ad":return Ie._applyBrush(t,i,Ne.ArpeggioDown,1),z.Applied;case"ch":const y=i.arguments.arguments[0].text,k=Ie._getChordId(t.voice.bar.staff,y);if(!t.voice.bar.staff.hasChord(k)){const Q=new so;Q.showDiagram=!1,Q.name=y,t.voice.bar.staff.addChord(k,Q)}return t.chordId=k,z.Applied;case"gr":if(i.arguments&&i.arguments.arguments.length>0){const Q=Ie._parseEnumValue(e,i.arguments,"whammy style",xe.graceType);if(Q===void 0)return z.NotAppliedSemanticError;t.graceType=Q}else t.graceType=De.BeforeBeat;return z.Applied;case"dy":const _=Ie._parseEnumValue(e,i.arguments,"dynamic",xe.dynamicValue);return _===void 0?z.NotAppliedSemanticError:(t.dynamics=_,e.state.currentDynamics=_,z.Applied);case"cre":return t.crescendo=Ds.Crescendo,z.Applied;case"dec":return t.crescendo=Ds.Decrescendo,z.Applied;case"tempo":const w=i.arguments.arguments[0].value;let T="",x=!0;if(i.arguments.arguments.length>2){T=i.arguments.arguments[1].text;const Q=i.arguments.arguments[2].text;if(Q==="hide")x=!1;else return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected third tempo property value '${Q}', expected: 'hide'`,severity:Ze.Error,start:i.arguments.arguments[2].start,end:i.arguments.arguments[2].end}),z.NotAppliedSemanticError}else i.arguments.arguments.length>1&&(T=i.arguments.arguments[1].text,T==="hide"&&(x=!1,T=""));const E=new jt;return E.isLinear=!1,E.type=Mt.Tempo,E.value=w,E.text=T,E.isVisible=x,t.automations.push(E),t.voice.bar.masterBar.tempoAutomations.push(E),z.Applied;case"volume":const N=new jt;return N.isLinear=!0,N.type=Mt.Volume,N.value=i.arguments.arguments[0].value,t.automations.push(N),z.Applied;case"balance":const v=new jt;return v.isLinear=!0,v.type=Mt.Balance,v.value=ce.clamp(i.arguments.arguments[0].value,0,16),t.automations.push(v),z.Applied;case"tp":if(t.tremoloSpeed=M.Eighth,i.arguments&&i.arguments.arguments.length>0){const Q=i.arguments.arguments[0].value;switch(Q){case 8:t.tremoloSpeed=M.Eighth;break;case 16:t.tremoloSpeed=M.Sixteenth;break;case 32:t.tremoloSpeed=M.ThirtySecond;break;default:return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected tremolo speed value '${Q}, expected: 8, 16 or 32`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),z.NotAppliedSemanticError}}return z.Applied;case"spd":return Ie._applySustainPedal(e,t,ai.Down),z.Applied;case"sph":return Ie._applySustainPedal(e,t,ai.Hold),z.Applied;case"spu":return Ie._applySustainPedal(e,t,ai.Up),z.Applied;case"spe":return Ie._applySustainPedal(e,t,ai.Up,!0),z.Applied;case"slashed":return t.slashed=!0,z.Applied;case"ds":return t.deadSlapped=!0,t.notes.length===1&&t.notes[0].isDead&&t.removeNote(t.notes[0]),z.Applied;case"glpf":return t.golpe=qs.Finger,z.Applied;case"glpt":return t.golpe=qs.Thumb,z.Applied;case"waho":return t.wahPedal=an.Open,z.Applied;case"wahc":return t.wahPedal=an.Closed,z.Applied;case"barre":if(t.barreFret=i.arguments.arguments[0].value,t.barreShape=Yn.Full,i.arguments.arguments.length>1){const Q=Ie._parseEnumValue(e,i.arguments,"barre shape",xe.barreShape,1);if(Q===void 0)return z.NotAppliedSemanticError;t.barreShape=Q}return z.Applied;case"rasg":const L=Ie._parseEnumValue(e,i.arguments,"rasgueado pattern",xe.rasgueado);return L===void 0?z.NotAppliedSemanticError:(t.rasgueado=L,z.Applied);case"ot":const A=Ie._parseEnumValue(e,i.arguments,"ottava",xe.ottavia);return A===void 0?z.NotAppliedSemanticError:(t.ottava=A,z.Applied);case"legatoorigin":return t.isLegatoOrigin=!0,z.Applied;case"instrument":let D=0;switch(i.arguments.arguments[0].nodeType){case oe.Ident:case oe.String:D=vn.getValue(i.arguments.arguments[0].text);break;case oe.Number:D=i.arguments.arguments[0].value;break}const H=new jt;return H.isLinear=!1,H.type=Mt.Instrument,H.value=D,t.automations.push(H),z.Applied;case"bank":const J=new jt;return J.isLinear=!1,J.type=Mt.Bank,J.value=i.arguments.arguments[0].value,t.automations.push(J),z.Applied;case"fermata":const K=Ie._parseEnumValue(e,i.arguments,"fermata",xe.fermataType);if(K===void 0)return z.NotAppliedSemanticError;const Y=new ru;return Y.type=K,i.arguments.arguments.length>1&&(Y.length=i.arguments.arguments[1].value),t.fermata=Y,z.Applied;case"beam":const C=i.arguments.arguments[0].text;switch(C.toLowerCase()){case"invert":t.invertBeamDirection=!0;break;case"up":t.preferredBeamDirection=j.Up;break;case"down":t.preferredBeamDirection=j.Down;break;case"auto":t.beamingMode=ei.Auto;break;case"split":t.beamingMode=ei.ForceSplitToNext;break;case"merge":t.beamingMode=ei.ForceMergeWithNext;break;case"splitsecondary":t.beamingMode=ei.ForceSplitOnSecondaryToNext;break;default:const Q=["invert","up","down","auto","split","merge","splitsecondary"];return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected beam value '${C}', expected: ${Q.join(",")}`,severity:Ze.Error,start:i.arguments.arguments[0].start,end:i.arguments.arguments[0].end}),z.NotAppliedSemanticError}return z.Applied;case"timer":return t.showTimer=!0,z.Applied}return z.NotAppliedUnrecognizedMarker}static _applySustainPedal(e,t,i,s=!1){const a=new Qr;a.pedalType=i,s?a.ratioPosition=1:a.ratioPosition=.001*t.voice.bar.sustainPedals.length,e.state.sustainPedalToBeat.set(a,t),t.voice.bar.sustainPedals.push(a)}static _applyBrush(e,t,i,s){e.brushType=i,t.arguments&&t.arguments.arguments.length>0?e.brushDuration=t.arguments.arguments[0].value:(e.updateDurations(),e.brushDuration=e.playbackDuration*s/e.notes.length)}applyNoteProperty(e,t,i){const s=i.property.text.toLowerCase(),a=this._checkArgumentTypes(e,[Ft.noteProperties],i,s,i.arguments);if(a!==void 0)return a;switch(s){case"b":case"be":let o=0,c=!0,h=!1;for(;c;)switch(i.arguments.arguments[o].nodeType){case oe.Ident:case oe.String:const w=i.arguments.arguments[o].text.toLowerCase();if(xe.bendType.has(w))t.bendType=xe.bendType.get(w),h=!0,o++;else if(xe.bendStyle.has(w))t.bendStyle=xe.bendStyle.get(w),o++;else return h?Ie._parseEnumValue(e,i.arguments,"bend style",xe.bendStyle,o):Ie._parseEnumValue(e,i.arguments,"bend type",xe.bendType,o),z.NotAppliedSemanticError;break;default:c=!1;break}const d=this._getBendPoints(e,i,o,s==="be");if(d)for(const w of d)t.addBendPoint(w);return z.Applied;case"nh":return t.harmonicType=Re.Natural,t.harmonicValue=ce.deltaFretToHarmonicValue(t.fret),z.Applied;case"ah":return t.harmonicType=Re.Artificial,t.harmonicValue=Ie._harmonicValue(i.arguments,t.harmonicValue),z.Applied;case"th":return t.harmonicType=Re.Tap,t.harmonicValue=Ie._harmonicValue(i.arguments,t.harmonicValue),z.Applied;case"ph":return t.harmonicType=Re.Pinch,t.harmonicValue=Ie._harmonicValue(i.arguments,t.harmonicValue),z.Applied;case"sh":return t.harmonicType=Re.Semi,t.harmonicValue=Ie._harmonicValue(i.arguments,t.harmonicValue),z.Applied;case"fh":return t.harmonicType=Re.Feedback,t.harmonicValue=Ie._harmonicValue(i.arguments,t.harmonicValue),z.Applied;case"tr":const p=i.arguments.arguments[0].value;let g=M.Sixteenth;if(i.arguments.arguments.length>1){const w=i.arguments.arguments[1].value;switch(w){case 16:g=M.Sixteenth;break;case 32:g=M.ThirtySecond;break;case 64:g=M.SixtyFourth;break;default:return e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected trill duration value '${w}', expected: 16, 32 or 64`,severity:Ze.Error,start:i.arguments.arguments[1].start,end:i.arguments.arguments[1].end}),z.NotAppliedSemanticError}}return t.trillValue=p+t.stringTuning,t.trillSpeed=g,z.Applied;case"v":return t.vibrato=ct.Slight,z.Applied;case"vw":return t.vibrato=ct.Wide,z.Applied;case"sl":return t.slideOutType=$e.Legato,z.Applied;case"ss":return t.slideOutType=$e.Shift,z.Applied;case"sib":return t.slideInType=Ji.IntoFromBelow,z.Applied;case"sia":return t.slideInType=Ji.IntoFromAbove,z.Applied;case"sou":return t.slideOutType=$e.OutUp,z.Applied;case"sod":return t.slideOutType=$e.OutDown,z.Applied;case"psd":return t.slideOutType=$e.PickSlideDown,z.Applied;case"psu":return t.slideOutType=$e.PickSlideUp,z.Applied;case"h":return t.isHammerPullOrigin=!0,z.Applied;case"lht":return t.isLeftHandTapped=!0,z.Applied;case"g":return t.isGhost=!0,z.Applied;case"ac":return t.accentuated=mi.Normal,z.Applied;case"hac":return t.accentuated=mi.Heavy,z.Applied;case"ten":return t.accentuated=mi.Tenuto,z.Applied;case"pm":return t.isPalmMute=!0,z.Applied;case"st":return t.isStaccato=!0,z.Applied;case"lr":return t.isLetRing=!0,z.Applied;case"x":return t.isDead=!0,z.Applied;case"-":case"t":return t.isTieDestination=!0,z.Applied;case"lf":let y=Fe.Thumb;if(i.arguments&&i.arguments.arguments.length>0){const w=Ie._toFinger(e,i.arguments);if(w===void 0)return z.NotAppliedSemanticError;y=w}return t.leftHandFinger=y,z.Applied;case"rf":let k=Fe.Thumb;if(i.arguments&&i.arguments.arguments.length>0){const w=Ie._toFinger(e,i.arguments);if(w===void 0)return z.NotAppliedSemanticError;k=w}return t.rightHandFinger=k,z.Applied;case"acc":return t.accidentalMode=ce.parseAccidentalMode(i.arguments.arguments[0].text),z.Applied;case"turn":return t.ornament=fi.Turn,z.Applied;case"iturn":return t.ornament=fi.InvertedTurn,z.Applied;case"umordent":return t.ornament=fi.UpperMordent,z.Applied;case"lmordent":return t.ornament=fi.LowerMordent,z.Applied;case"string":return t.showStringNumber=!0,z.Applied;case"hide":return t.isVisible=!1,z.Applied;case"slur":const _=i.arguments.arguments[0].text;if(e.state.slurs.has(_)){const w=e.state.slurs.get(_);w.slurDestination=t,t.slurOrigin=w,t.isSlurDestination=!0}else e.state.slurs.set(_,t);return z.Applied;default:return this.applyBeatProperty(e,t.beat,i)}return z.NotAppliedUnrecognizedMarker}static _toFinger(e,t){const i=t.arguments[0].value;switch(i){case 1:return Fe.Thumb;case 2:return Fe.IndexFinger;case 3:return Fe.MiddleFinger;case 4:return Fe.AnnularFinger;case 5:return Fe.LittleFinger;default:e.addSemanticDiagnostic({code:at.AT211,message:`Value is out of valid range. Allowed range: 1-5, Actual Value: ${i}`,start:t.arguments[0].start,end:t.arguments[0].end,severity:Ze.Error});return}}static _harmonicValue(e,t){return e&&(t=e.arguments[0].value),t}_getBendPoints(e,t,i,s){let a=t.arguments.arguments,o=a.length-i,c=t.arguments;o>0&&a[i].nodeType===oe.Arguments&&(a=a[i].arguments,i=0,o=a.length,c=a[i]);const h=s?2:1;if(o%h!==0){const g=Math.ceil(o/h),y=g*h;e.addSemanticDiagnostic({code:at.AT214,message:`The '${t.property.text}' effect needs ${h} arguments per item. With ${g} points, ${y} arguments are needed, only ${o} arguments found.`,severity:Ze.Error,start:c.end,end:c.end});return}const d=[];let p=i;for(;p<a.length;){let g=0,y=0;s?(g=a[p++].value,y=a[p++].value):(g=0,y=a[p++].value),d.push(new ke(g,y))}if(d.length>0){if(d.length>60&&d.splice(60,d.length-60),s)d.sort((g,y)=>g.offset-y.offset);else{const g=d.length,y=ke.MaxPosition/(g-1)|0;let k=0;for(;k<g;)d[k].offset=Math.min(ke.MaxPosition,k*y),k++}return d}else return}static _parseEnumValue(e,t,i,s,a=0){if(a>=t.arguments.length)return;const o=t.arguments[a].text;if(s.has(o.toLowerCase()))return s.get(o.toLowerCase());e.addSemanticDiagnostic({code:at.AT209,message:`Unexpected ${i} value '${o}', expected: ${Array.from(s.keys()).join(",")}`,severity:Ze.Error,start:t.arguments[a].start,end:t.arguments[a].end})}static _defaultScore=new Qa;static _defaultTrack=new Za;buildScoreMetaDataNodes(e){const t=[];return Ie._buildScoreInfoMeta(t,"album",e,e.album,ye.Album),Ie._buildScoreInfoMeta(t,"artist",e,e.artist,ye.Artist),Ie._buildScoreInfoMeta(t,"copyright",e,e.copyright,ye.Copyright),Ie._buildScoreInfoMeta(t,"copyright2",e,void 0,ye.CopyrightSecondLine),Ie._buildScoreInfoMeta(t,"wordsandmusic",e,void 0,ye.WordsAndMusic,!0),Ie._buildScoreInfoMeta(t,"instructions",e,e.instructions,void 0),Ie._buildScoreInfoMeta(t,"music",e,e.music,ye.Music),Ie._buildScoreInfoMeta(t,"notices",e,e.notices,void 0),Ie._buildScoreInfoMeta(t,"subtitle",e,e.subTitle,ye.SubTitle),Ie._buildScoreInfoMeta(t,"title",e,e.title,ye.Title),Ie._buildScoreInfoMeta(t,"words",e,e.words,ye.Words),Ie._buildScoreInfoMeta(t,"tab",e,e.tab,ye.Transcriber),e.defaultSystemsLayout!==Ie._defaultScore.defaultSystemsLayout&&t.push(I.numberMeta("defaultSystemsLayout",e.defaultSystemsLayout)),e.systemsLayout.length>0&&t.push(I.meta("systemsLayout",I.args(e.systemsLayout.map(i=>I.number(i))))),Ie._buildStyleSheetMetaData(t,e.stylesheet),t.length>0&&(t[0].leadingComments=[{text:"Score Metadata",multiLine:!1}]),t}static _buildStyleSheetMetaData(e,t){const i=e.length;t.hideDynamics&&e.push(I.meta("hideDynamics")),t.bracketExtendMode!==Ie._defaultScore.stylesheet.bracketExtendMode&&e.push(I.identMeta("bracketExtendMode",xe.bracketExtendModeReversed.get(t.bracketExtendMode))),t.useSystemSignSeparator&&e.push(I.meta("useSystemSignSeparator")),t.multiTrackMultiBarRest&&e.push(I.meta("multiBarRest")),t.singleTrackTrackNamePolicy!==Ie._defaultScore.stylesheet.singleTrackTrackNamePolicy&&e.push(I.identMeta("singleTrackTrackNamePolicy",xe.trackNamePolicyReversed.get(t.singleTrackTrackNamePolicy))),t.multiTrackTrackNamePolicy!==Ie._defaultScore.stylesheet.multiTrackTrackNamePolicy&&e.push(I.identMeta("multiTrackTrackNamePolicy",xe.trackNamePolicyReversed.get(t.multiTrackTrackNamePolicy))),t.firstSystemTrackNameMode!==Ie._defaultScore.stylesheet.firstSystemTrackNameMode&&e.push(I.identMeta("firstSystemTrackNameMode",xe.trackNameModeReversed.get(t.firstSystemTrackNameMode))),t.otherSystemsTrackNameMode!==Ie._defaultScore.stylesheet.otherSystemsTrackNameMode&&e.push(I.identMeta("otherSystemsTrackNameMode",xe.trackNameModeReversed.get(t.otherSystemsTrackNameMode))),t.firstSystemTrackNameOrientation!==Ie._defaultScore.stylesheet.firstSystemTrackNameOrientation&&e.push(I.identMeta("firstSystemTrackNameOrientation",xe.trackNameOrientationReversed.get(t.firstSystemTrackNameOrientation))),t.otherSystemsTrackNameOrientation!==Ie._defaultScore.stylesheet.otherSystemsTrackNameOrientation&&e.push(I.identMeta("otherSystemsTrackNameOrientation",xe.trackNameOrientationReversed.get(t.otherSystemsTrackNameOrientation))),i<e.length&&(e[i].leadingComments=[{multiLine:!1,text:"Score Stylesheet"}])}static _buildScoreInfoMeta(e,t,i,s,a,o=!1){if(s!==void 0&&s.length===0&&!o)return;const c=[];if(s!==void 0&&c.push(I.string(s)),a!==void 0){const h=i.style&&i.style.headerAndFooter.has(a)?i.style.headerAndFooter.get(a):void 0,d=$o.defaultHeaderAndFooter.has(a)?$o.defaultHeaderAndFooter.get(a):void 0;h&&(!d||!wn.equals(d,h))&&(c.push(I.string(h.isVisible===!1?"":h.template)),c.push(I.ident(xe.textAlignReversed.get(h.textAlign))))}s===void 0&&c.length===0||s!==void 0&&s.length===0&&c.length===1||e.push(I.meta(t,I.args(c)))}buildSyncPointNodes(e){const t=[],i=e.exportFlatSyncPoints();for(const s of i)t.push(I.meta("sync",I.args([I.number(s.barIndex),I.number(s.barOccurence),I.number(s.millisecondOffset),s.barPosition>0?I.number(s.barPosition):void 0])));return t}buildBarMetaDataNodes(e,t,i,s){const a=[];if(Ie._buildStructuralMetaDataNodes(t,e,a,s,i),!t)return a;i===0&&e.index===0&&e.track.index===0&&Ie._buildMasterBarMetaDataNodes(a,t.masterBar);const o=a.length;i===0&&t.index===0&&e.index===0&&e.track.index===0&&a.push(I.identMeta("accidentals","auto")),(t.index===0||t.clef!==t.previousBar?.clef)&&a.push(I.identMeta("clef",xe.clefReversed.get(t.clef))),(t.index===0&&t.clefOttava!==Ye.Regular||t.clefOttava!==t.previousBar?.clefOttava)&&a.push(I.identMeta("ottava",xe.ottaviaReversed.get(t.clefOttava))),(t.index===0&&t.simileMark!==rs.None||t.simileMark!==t.previousBar?.simileMark)&&a.push(I.identMeta("simile",xe.simileMarkReversed.get(t.simileMark))),t.displayScale!==1&&a.push(I.numberMeta("scale",t.displayScale)),t.displayWidth>0&&a.push(I.numberMeta("width",t.displayWidth));for(const c of t.sustainPedals){let h="";switch(c.pedalType){case ai.Down:h="spd";break;case ai.Hold:h="sph";break;case ai.Up:h="spu";break}h&&a.push(I.numberMeta(h,c.ratioPosition))}if(t.barLineLeft!==et.Automatic&&a.push(I.identMeta("barLineLeft",xe.barLineStyleReversed.get(t.barLineLeft))),t.barLineRight!==et.Automatic&&a.push(I.identMeta("barLineRight",xe.barLineStyleReversed.get(t.barLineRight))),t.index===0||t.keySignature!==t.previousBar.keySignature||t.keySignatureType!==t.previousBar.keySignatureType){let c="";t.keySignatureType===pn.Minor?c=xe.keySignaturesMinorReversed.get(t.keySignature):c=xe.keySignaturesMajorReversed.get(t.keySignature),a.push(I.identMeta("ks",c))}return o<a.length&&(a[o].leadingComments=[{multiLine:!1,text:`Bar ${t.index+1} Metadata`}]),a}static _buildStaffMetaDataNodes(e,t){const i=e.length;if(t.capo!==0&&e.push(I.numberMeta("capo",t.capo)),t.isPercussion)e.push(I.identMeta("articulation","defaults"));else if(t.isStringed){const a=I.meta("tuning",I.args(t.stringTuning.tunings.map(o=>I.ident(de.getTextForTuning(o,!0)))));e.push(a),t.track.score.stylesheet.perTrackDisplayTuning&&t.track.score.stylesheet.perTrackDisplayTuning.has(t.track.index)&&(a.properties=I.props([["hide",void 0]])),t.stringTuning.name.length>0&&(a.properties??=I.props([]),I.prop(a.properties.properties,"label",I.stringValue(t.stringTuning.name)))}t.transpositionPitch!==0&&e.push(I.numberMeta("transpose",-t.transpositionPitch));const s=ce.displayTranspositionPitches.has(t.track.playbackInfo.program)?ce.displayTranspositionPitches.get(t.track.playbackInfo.program):0;if(t.displayTranspositionPitch!==s&&e.push(I.numberMeta("displaytranspose",-t.displayTranspositionPitch)),t.chords!=null)for(const[a,o]of t.chords)e.push(Ie._buildChordNode(o));i<e.length&&(e[i].leadingComments=[{multiLine:!1,text:`Staff ${t.index+1} Metadata`}])}static _buildChordNode(e){const t=I.meta("chord",I.args([I.string(e.name)],!0),I.props([e.firstFret>=0?["firstfret",I.numberValue(e.firstFret)]:void 0,["showdiagram",I.identValue(e.showDiagram?"true":"false")],["showfingering",I.identValue(e.showFingering?"true":"false")],["showname",I.identValue(e.showName?"true":"false")],e.barreFrets.length>0?["barre",I.args(e.barreFrets.map(i=>I.number(i)))]:void 0]));for(let i=0;i<e.staff.tuning.length;i++)i<e.strings.length&&e.strings[i]>=0?t.arguments.arguments.push(I.number(e.strings[i])):t.arguments.arguments.push(I.ident("x"));return t}static _buildMasterBarMetaDataNodes(e,t){const i=e.length;if(t.alternateEndings!==0&&e.push(I.meta("ae",I.args(ce.getAlternateEndingsList(t.alternateEndings).map(s=>I.number(s+1))))),t.isRepeatStart&&e.push(I.meta("ro")),t.isRepeatEnd&&e.push(I.numberMeta("rc",t.repeatCount)),(t.index===0||t.timeSignatureCommon!==t.previousMasterBar?.timeSignatureCommon||t.timeSignatureNumerator!==t.previousMasterBar.timeSignatureNumerator||t.timeSignatureDenominator!==t.previousMasterBar.timeSignatureDenominator)&&(t.timeSignatureCommon?e.push(I.identMeta("ts","common")):e.push(I.meta("ts",I.args([I.number(t.timeSignatureNumerator),I.number(t.timeSignatureDenominator)])))),(t.index>0&&t.tripletFeel!==t.previousMasterBar?.tripletFeel||t.index===0&&t.tripletFeel!==yt.NoTripletFeel)&&e.push(I.identMeta("tf",xe.tripletFeelReversed.get(t.tripletFeel))),t.isFreeTime&&e.push(I.meta("ft")),t.section!=null&&e.push(I.meta("section",I.args([I.string(t.section.marker),I.string(t.section.text)]))),t.isAnacrusis&&e.push(I.meta("ac")),t.displayScale!==1&&e.push(I.numberMeta("scale",t.displayScale)),t.displayWidth>0&&e.push(I.numberMeta("width",t.displayWidth)),t.directions)for(const s of t.directions)e.push(I.identMeta("jump",xe.directionReversed.get(s)));for(const s of t.tempoAutomations){const a=I.meta("tempo",I.args([I.number(s.value),s.text?I.string(s.text):void 0,s.ratioPosition>0?I.number(s.ratioPosition):void 0,s.isVisible?void 0:I.ident("hide")]));a.arguments.arguments.length===1&&(a.arguments.openParenthesis=void 0,a.arguments.closeParenthesis=void 0),e.push(a)}i<e.length&&(e[i].leadingComments=[{multiLine:!1,text:`Masterbar ${t.index+1} Metadata`}])}static _buildStructuralMetaDataNodes(e,t,i,s,a){if((e===void 0||e.index===0)&&(a===0&&(t.index===0&&i.push(Ie._buildNewTrackNode(t.track)),i.push(Ie._buildNewStaffNode(t)),Ie._buildStaffMetaDataNodes(i,t)),s)){const o=I.meta("voice");o.trailingComments=[{multiLine:!0,text:`Voice ${a+1}`}],i.push(o)}}static _buildNewStaffNode(e){const t=I.meta("staff",void 0,I.props([e.showStandardNotation?["score",I.args([e.standardNotationLineCount!==el.DefaultStandardNotationLineCount?I.number(e.standardNotationLineCount):void 0])]:void 0,e.showTablature?["tabs",void 0]:void 0,e.showSlash?["slash",void 0]:void 0,e.showNumbered?["numbered",void 0]:void 0]));return t.properties&&t.properties.properties.length>0&&(t.properties.properties[0].leadingComments=[{multiLine:!1,text:"Staff Properties"}]),t}static _buildNewTrackNode(e){const t=I.meta("track",I.args([I.string(e.name),e.shortName.length>0?I.string(e.shortName):void 0]),I.props([e.color.rgba!==Ie._defaultTrack.color.rgba?["color",I.stringValue(e.color.rgba)]:void 0,e.defaultSystemsLayout!==Ie._defaultTrack.defaultSystemsLayout?["defaultSystemsLayout",I.numberValue(e.defaultSystemsLayout)]:void 0,e.systemsLayout.length?["systemsLayout",I.args(e.systemsLayout.map(i=>I.number(i)))]:void 0,["volume",I.numberValue(e.playbackInfo.volume)],["balance",I.numberValue(e.playbackInfo.balance)],e.playbackInfo.isMute?["mute",void 0]:void 0,e.playbackInfo.isSolo?["solo",void 0]:void 0,e.score.stylesheet.perTrackMultiBarRest&&e.score.stylesheet.perTrackMultiBarRest.has(e.index)?["multiBarRest",void 0]:void 0,["instrument",I.identValue(e.isPercussion?"percussion":vn.getName(e.playbackInfo.program))],e.playbackInfo.bank>0?["bank",I.numberValue(e.playbackInfo.bank)]:void 0]));return t.properties&&t.properties.properties.length>0&&(t.properties.properties[0].leadingComments=[{multiLine:!1,text:"Track Properties"}]),t}buildNoteEffects(e){const t=[];if(e.hasBend){const s=I.args([I.ident(xe.bendTypeReversed.get(e.bendType)),e.bendStyle!==Kt.Default?I.ident(xe.bendStyleReversed.get(e.bendStyle)):void 0],!0);for(const a of e.bendPoints)s.arguments.push(I.number(a.offset)),s.arguments.push(I.number(a.value));I.prop(t,"be",s)}let i="";switch(e.harmonicType){case Re.Natural:I.prop(t,"nh");break;case Re.Artificial:i="ah";break;case Re.Pinch:i="ph";break;case Re.Tap:i="th";break;case Re.Semi:i="sh";break;case Re.Feedback:i="fh";break}switch(i&&I.prop(t,i,I.numberValue(e.harmonicValue)),e.showStringNumber&&I.prop(t,"string"),e.isTrill&&I.prop(t,"tr",I.args([I.number(e.trillFret),I.number(e.trillSpeed)])),e.vibrato){case ct.Slight:I.prop(t,"v");break;case ct.Wide:I.prop(t,"vw");break}switch(e.slideInType){case Ji.IntoFromBelow:I.prop(t,"sib");break;case Ji.IntoFromAbove:I.prop(t,"sia");break}switch(e.slideOutType){case $e.Shift:I.prop(t,"ss");break;case $e.Legato:I.prop(t,"sl");break;case $e.OutUp:I.prop(t,"sou");break;case $e.OutDown:I.prop(t,"sod");break;case $e.PickSlideDown:I.prop(t,"psd");break;case $e.PickSlideUp:I.prop(t,"psu");break}switch(e.isHammerPullOrigin&&I.prop(t,"h"),e.isLeftHandTapped&&I.prop(t,"lht"),e.isGhost&&I.prop(t,"g"),e.accentuated){case mi.Normal:I.prop(t,"ac");break;case mi.Heavy:I.prop(t,"hac");break;case mi.Tenuto:I.prop(t,"ten");break}if(e.isPalmMute&&I.prop(t,"pm"),e.isStaccato&&I.prop(t,"st"),e.isLetRing&&I.prop(t,"lr"),e.isDead&&I.prop(t,"x"),e.isTieDestination&&I.prop(t,"t"),e.leftHandFinger>=Fe.Thumb&&I.prop(t,"lf",I.numberValue(e.leftHandFinger+1)),e.rightHandFinger>=Fe.Thumb&&I.prop(t,"rf",I.numberValue(e.rightHandFinger+1)),e.isVisible||I.prop(t,"hide"),e.isSlurOrigin){const s=`s${e.id}`;I.prop(t,"slur",I.identValue(s))}if(e.isSlurDestination){const s=`s${e.slurOrigin.id}`;I.prop(t,"slur",I.identValue(s))}switch(e.accidentalMode!==Ue.Default&&I.prop(t,"acc",I.identValue(ce.reverseAccidentalModeMapping.get(e.accidentalMode))),e.ornament){case fi.InvertedTurn:I.prop(t,"iturn");break;case fi.Turn:I.prop(t,"turn");break;case fi.UpperMordent:I.prop(t,"umordent");break;case fi.LowerMordent:I.prop(t,"lmordent");break}return t}buildBeatEffects(e){const t=[];switch(e.fade){case Xi.FadeIn:I.prop(t,"f");break;case Xi.FadeOut:I.prop(t,"fo");break;case Xi.VolumeSwell:I.prop(t,"vs");break}if(e.vibrato===ct.Slight?I.prop(t,"v"):e.vibrato===ct.Wide&&I.prop(t,"vw"),e.slap&&I.prop(t,"s"),e.pop&&I.prop(t,"p"),e.tap&&I.prop(t,"tt"),e.dots>=2?I.prop(t,"dd"):e.dots>0&&I.prop(t,"d"),e.pickStroke===ds.Up?I.prop(t,"su"):e.pickStroke===ds.Down&&I.prop(t,"sd"),e.hasTuplet&&I.prop(t,"tu",I.args([I.number(e.tupletNumerator),I.number(e.tupletDenominator)])),e.hasWhammyBar){const o=I.args([I.ident(xe.whammyTypeReversed.get(e.whammyBarType)),I.ident(xe.bendStyleReversed.get(e.whammyStyle))],!0);for(const c of e.whammyBarPoints)o.arguments.push(I.number(c.offset)),o.arguments.push(I.number(c.value));I.prop(t,"tbe",o)}let i="";switch(e.brushType){case Ne.BrushUp:i="bu";break;case Ne.BrushDown:i="bd";break;case Ne.ArpeggioUp:i="au";break;case Ne.ArpeggioDown:i="ad";break}if(i&&I.prop(t,i,I.numberValue(e.brushDuration)),e.chord!=null&&I.prop(t,"ch",I.stringValue(e.chord.name)),e.ottava!==Ye.Regular&&I.prop(t,"ot",I.identValue(xe.ottaviaReversed.get(e.ottava))),e.hasRasgueado&&I.prop(t,"rasg",I.identValue(xe.rasgueadoReversed.get(e.rasgueado))),e.text!=null&&I.prop(t,"txt",I.stringValue(e.text)),e.lyrics!=null&&e.lyrics.length>0)if(e.lyrics.length>1)for(let o=0;o<e.lyrics.length;o++)I.prop(t,"lyrics",I.args([I.number(o),I.string(e.lyrics[o])]));else I.prop(t,"lyrics",I.stringValue(e.lyrics[0]));switch(e.graceType!==De.None&&I.prop(t,"gr",e.graceType===De.BeforeBeat?void 0:I.identValue(xe.graceTypeReversed.get(e.graceType))),e.isTremolo&&I.prop(t,"tp",I.numberValue(e.tremoloSpeed)),e.crescendo){case Ds.Crescendo:I.prop(t,"cre");break;case Ds.Decrescendo:I.prop(t,"dec");break}(e.voice.bar.index===0&&e.index===0||e.dynamics!==e.previousBeat?.dynamics)&&I.prop(t,"dy",I.identValue(xe.dynamicValueReversed.get(e.dynamics))),e.fermata!=null&&I.prop(t,"fermata",I.args([I.ident(xe.fermataTypeReversed.get(e.fermata.type)),I.number(e.fermata.length)])),e.isLegatoOrigin&&I.prop(t,"legatoorigin");for(const o of e.automations)switch(o.type){case Mt.Tempo:I.prop(t,"tempo",I.args([I.number(o.value),o.text.length===0?void 0:I.string(o.text)]));break;case Mt.Volume:I.prop(t,"volume",I.numberValue(o.value));break;case Mt.Instrument:e.voice.bar.staff.isPercussion||I.prop(t,"instrument",I.identValue(vn.getName(o.value)));break;case Mt.Balance:I.prop(t,"balance",I.numberValue(o.value));break}switch(e.wahPedal){case an.Open:I.prop(t,"waho");break;case an.Closed:I.prop(t,"wahc");break}switch(e.isBarre&&I.prop(t,"barre",I.args([I.number(e.barreFret),I.ident(xe.barreShapeReversed.get(e.barreShape))])),e.slashed&&I.prop(t,"slashed"),e.deadSlapped&&I.prop(t,"ds"),e.golpe){case qs.Thumb:I.prop(t,"glpt");break;case qs.Finger:I.prop(t,"glpf");break}e.invertBeamDirection?I.prop(t,"beam",I.identValue("invert")):e.preferredBeamDirection!==null&&I.prop(t,"beam",I.identValue(j[e.preferredBeamDirection]));let a="";switch(e.beamingMode){case ei.ForceSplitToNext:a="split";break;case ei.ForceMergeWithNext:a="merge";break;case ei.ForceSplitOnSecondaryToNext:a="splitsecondary";break}return a&&I.prop(t,"beam",I.identValue(a)),e.showTimer&&I.prop(t,"timer"),t}}class lu{data;settings;init(e,t){this.data=e,this.settings=t,Qa.resetIds()}}class is extends Ht{constructor(e=null,t){super(It.Format,e??"Unsupported format",t)}}class ss{_buffer;length=0;position=0;get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return ss.withCapacity(0)}static withCapacity(e){const t=new ss;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){const t=new ss;return t._buffer=e,t.length=e.length,t}static fromString(e){const t=U.stringToBytes(e);return ss.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,i){let s=this.length-this.position;return s>i&&(s=i),s<=0?0:(e.set(this._buffer.subarray(this.position,this.position+s),t),this.position+=s,s)}writeByte(e){const t=this.position+1;this._ensureCapacity(t),this._buffer[this.position]=e&255,t>this.length&&(this.length=t),this.position=t}write(e,t,i){const s=this.position+i;this._ensureCapacity(s);const a=Math.min(i,e.length-t);this._buffer.set(e.subarray(t,t+a),this.position),s>this.length&&(this.length=s),this.position=s}_ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<this._buffer.length*2&&(t=this._buffer.length*2);const i=new Uint8Array(t);this.length>0&&i.set(this._buffer.subarray(0,0+this.length),0),this._buffer=i}}readAll(){return this.toArray()}toArray(){const e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}class Ll extends Ht{lexerDiagnostics;parserDiagnostics;semanticDiagnostics;*iterateDiagnostics(){if(this.lexerDiagnostics)for(const e of this.lexerDiagnostics.items)yield e;if(this.parserDiagnostics)for(const e of this.parserDiagnostics.items)yield e;if(this.semanticDiagnostics)for(const e of this.semanticDiagnostics.items)yield e}constructor(e,t,i,s){super(It.AlphaTex,e),this.lexerDiagnostics=t,this.parserDiagnostics=i,this.semanticDiagnostics=s}toString(){return[this.message,"lexer diagnostics:",Ll._diagnosticsToString(this.lexerDiagnostics,"  "),"parser diagnostics:",Ll._diagnosticsToString(this.parserDiagnostics,"  "),"semantic diagnostics:",Ll._diagnosticsToString(this.semanticDiagnostics,"  ")].join(`
`)}static _diagnosticsToString(e,t){return e?e.items.map(i=>`${t}${Ze[i.severity]} AT${i.code.toString().padStart(3,"0")}${Ll._locationToString(i)}: ${i.message}`).join(`
`):`${t}none`}static _locationToString(e){let t="";return e.start&&(t+=`(${e.start.line},${e.start.col})`),e.end&&(t.length>0&&(t+="->"),t+=`(${e.end.line},${e.end.col})`),t}}class bB{trackChannel=0;score;currentTrack;currentStaff;barIndex=0;voiceIndex=0;ignoredInitialVoice=!1;ignoredInitialStaff=!1;ignoredInitialTrack=!1;currentDuration=M.Quarter;articulationValueToIndex=new Map;hasAnyProperData=!1;percussionArticulationNames=new Map;slurs=new Map;lyrics=new Map;sustainPedalToBeat=new Map;staffTuningApplied=new Set;staffNoteKind=new Map;staffHasExplicitTuning=new Set;staffHasExplicitDisplayTransposition=new Set;staffDisplayTranspositionApplied=new Set;staffInitialClef=new Map;syncPoints=[];currentDynamics=Oe.F;accidentalMode=np.Explicit;currentTupletNumerator=-1;currentTupletDenominator=-1;scoreNode}class Nb extends lu{_parser;_handler=Ie.instance;_state=new bB;get state(){return this._state}get scoreNode(){return this._state.scoreNode}get name(){return"AlphaTex"}get lexerDiagnostics(){return this._parser.lexerDiagnostics}get parserDiagnostics(){return this._parser.parserDiagnostics}get parser(){return this._parser}get parseMode(){return this._parser.mode}logErrors=!1;semanticDiagnostics=new xb;addSemanticDiagnostic(e){this.semanticDiagnostics.push(e)}initFromString(e,t){this.data=ss.empty(),this._parser=new yB(e),this.settings=t,Qa.resetIds()}readScore(){this._state=new bB,this._createDefaultScore(),this.data.length>0&&(this._parser=new yB(U.toString(this.data.readAll(),this.settings.importer.encoding)));let e;try{e=this._parser.read(),this._state.scoreNode=e}catch(t){throw this.logErrors&&ee.error("AlphaTex",`Error while parsing alphaTex: ${t.toString()}`),new is("Error parsing alphaTex, check inner error for details",t)}if(this._parser.parserDiagnostics.hasErrors||this._parser.lexer.lexerDiagnostics.hasErrors){const t=new Ll("There are errors in the parsed alphaTex, check the diagnostics for details",this.lexerDiagnostics,this.parserDiagnostics,this.semanticDiagnostics);throw this.logErrors&&ee.error("AlphaTex",`Error while parsing alphaTex: ${t.toString()}`),new is("Error parsing alphaTex, check diagnostics on inner error for details",t)}if(e.bars.length===0)throw new is("No alphaTex data found");if(this._bars(e),this.semanticDiagnostics.hasErrors)if(this._state.hasAnyProperData){const t=new Ll("There are errors in the parsed alphaTex, check the diagnostics for details",this.lexerDiagnostics,this.parserDiagnostics,this.semanticDiagnostics);throw this.logErrors&&ee.error("AlphaTex",`Error while parsing alphaTex: ${t.toString()}`),t}else throw new is("No alphaTex data found");ce.consolidate(this._state.score),this._state.score.finish(this.settings),ce.trimEmptyBarsAtEnd(this._state.score),this._state.score.rebuildRepeatGroups(),this._state.score.applyFlatSyncPoints(this._state.syncPoints);for(const[t,i]of this._state.lyrics)this._state.score.tracks[t].applyLyrics(i);for(const[t,i]of this._state.sustainPedalToBeat)if(t.ratioPosition<1){const s=i.voice.bar.masterBar.calculateDuration();t.ratioPosition=i.playbackStart/s}return this._state.score}_createDefaultScore(){this._state.score=new Qa,this._newTrack()}_newTrack(){this._state.currentTrack=new Za,this._state.currentTrack.ensureStaveCount(1),this._state.currentTrack.playbackInfo.program=25,this._state.currentTrack.playbackInfo.primaryChannel=this._state.trackChannel++,this._state.currentTrack.playbackInfo.secondaryChannel=this._state.trackChannel++;const e=this._state.currentTrack.staves[0];e.displayTranspositionPitch=0,e.stringTuning=de.getDefaultTuningFor(6),this._state.articulationValueToIndex.clear(),this._beginStaff(e),this._state.score.addTrack(this._state.currentTrack),this._state.lyrics.set(this._state.currentTrack.index,[]),this._state.currentDynamics=Oe.F,this._state.currentTupletDenominator=-1,this._state.currentTupletNumerator=-1}_beginStaff(e){this._state.currentStaff&&(this._detectTuningForStaff(this._state.currentStaff),this._handleTransposition(this._state.currentStaff)),this._state.currentStaff=e,this._state.slurs.clear(),this._state.barIndex=0,this._state.voiceIndex=0}_bars(e){if(e.bars.length>0)for(const t of e.bars)this._bar(t);else this._newBar(this._state.currentStaff),this._detectTuningForStaff(this._state.currentStaff),this._handleTransposition(this._state.currentStaff)}_bar(e){const t=this._barMeta(e);this._detectTuningForStaff(this._state.currentStaff),this._handleTransposition(this._state.currentStaff),t.index===0&&this._state.staffInitialClef.has(this._state.currentStaff)&&(t.clef=this._state.staffInitialClef.get(this._state.currentStaff));const i=t.voices[this._state.voiceIndex];for(const s of e.beats)this._beat(i,s);if(i.beats.length===0){const s=new fs;s.isEmpty=!0,i.addBeat(s)}}_beat(e,t){if(t.durationChange&&this._beatDuration(t.durationChange),!t.notes&&!t.rest)return;const i=new fs;if(e.addBeat(i),t.notes)for(const a of t.notes.notes)this._note(i,a);else t.rest;t.durationValue&&(this._state.currentDuration=this._parseDuration(t.durationValue)),i.duration=this._state.currentDuration,i.dynamics=this._state.currentDynamics,this._state.currentTupletNumerator!==-1&&!i.hasTuplet&&(i.tupletNumerator=this._state.currentTupletNumerator,i.tupletDenominator=this._state.currentTupletDenominator);let s=1;t.beatMultiplierValue!==void 0&&(s=t.beatMultiplierValue.value),t.beatEffects&&this._beatEffects(i,t.beatEffects);for(let a=0;a<s-1;a++)e.addBeat(Tb.clone(i))}_beatEffects(e,t){for(const i of t.properties)switch(this._handler.applyBeatProperty(this,e,i)){case z.Applied:case z.NotAppliedSemanticError:this._state.hasAnyProperData=!0;break;case z.NotAppliedUnrecognizedMarker:const a=Array.from(this._handler.knownBeatProperties).join(",");this.addSemanticDiagnostic({code:at.AT212,message:`Unrecogized property '${i.property.text}', expected one of ${a}`,severity:Ze.Error,start:i.start,end:i.end});break}}_beatDuration(e){if(e.value&&(this._state.currentDuration=this._parseDuration(e.value)),this._state.currentTupletNumerator=-1,this._state.currentTupletDenominator=-1,e.properties)for(const t of e.properties.properties)switch(this._handler.applyBeatDurationProperty(this,t)){case z.Applied:case z.NotAppliedSemanticError:this._state.hasAnyProperData=!0;break;case z.NotAppliedUnrecognizedMarker:const s=Array.from(this._handler.knownBeatDurationProperties).join(",");this.addSemanticDiagnostic({code:at.AT212,message:`Unrecogized property '${t.property.text}', expected one of ${s}`,severity:Ze.Error,start:t.start,end:t.end});break}}_parseDuration(e){switch(e.value){case-4:return M.QuadrupleWhole;case-2:return M.DoubleWhole;case 1:return M.Whole;case 2:return M.Half;case 4:return M.Quarter;case 8:return M.Eighth;case 16:return M.Sixteenth;case 32:return M.ThirtySecond;case 64:return M.SixtyFourth;case 128:return M.OneHundredTwentyEighth;case 256:return M.TwoHundredFiftySixth;default:return this.addSemanticDiagnostic({code:at.AT209,message:`Unexpected duration value '${e.value}', expected: -4, -2, 1, 2, 4, 8, 16, 32, 64, 128 or 256`,severity:Ze.Error,start:e.start,end:e.end}),this._state.currentDuration}}_note(e,t){let i=!1,s=!1,a=-1,o=-1,c=-1,h=Ue.Default;const d=t.noteValue;let p,g=this._state.staffNoteKind.has(this._state.currentStaff)?this._state.staffNoteKind.get(this._state.currentStaff):void 0;switch(d.nodeType){case oe.Number:a=d.value,t.noteString!==void 0?p=tn.Fretted:p=tn.Articulation;break;case oe.String:case oe.Ident:const k=d.text;if(i=k==="x",s=k==="-",s||i)a=0,t.noteStringDot&&t.noteString?p=tn.Fretted:p=void 0;else{const _=ce.parseTuning(k);if(_)p=tn.Pitched,o=_.octave,c=_.tone.noteValue,this._state.accidentalMode===np.Explicit&&(h=_.tone.accidentalMode);else{p=tn.Articulation;const w=k.toLowerCase(),T=this._state.percussionArticulationNames;if(g===void 0&&T.size===0)for(const[x,E]of $i.instrumentArticulationNames)T.set(x.toLowerCase(),E),T.set(ce.toArticulationId(x),E);if(T.has(w))a=T.get(w);else{this.addSemanticDiagnostic({code:at.AT209,message:`Unexpected percussion articulation value '${w}', expected: oneOf(${Array.from(this._state.percussionArticulationNames.keys()).join(",")}).`,severity:Ze.Error,start:d.start,end:d.end}),a=Array.from($i.instrumentArticulationNames.values())[0];return}}}break}p!==void 0?g===void 0?(g=p,this.applyStaffNoteKind(this._state.currentStaff,g)):g!==p&&this.addSemanticDiagnostic({code:at.AT218,message:`Wrong note kind '${tn[p]}' for staff with note kind ''${tn[g]}'. Do not mix incompatible staves and notes.`,severity:Ze.Error,start:d.start,end:d.end}):g!==void 0&&(p=g);const y=new es;if(y.isDead=i,(i||s)&&(y.fret=a),y.isTieDestination=s,p!==void 0&&p===g)switch(p){case tn.Pitched:y.octave=o,y.tone=c,y.accidentalMode=h;break;case tn.Fretted:if(!t.noteString){this.addSemanticDiagnostic({code:at.AT207,message:"Missing string for fretted note.",severity:Ze.Error,start:d.end,end:d.end});return}const k=t.noteString.value;if(k<1||k>this._state.currentStaff.tuning.length){this.addSemanticDiagnostic({code:at.AT208,message:`Note string is out of range. Available range: 1-${this._state.currentStaff.tuning.length}`,severity:Ze.Error,start:d.end,end:d.end});return}y.string=this._state.currentStaff.tuning.length-(k-1),s||(y.fret=a);break;case tn.Articulation:let _=0;if(this._state.articulationValueToIndex.has(a))_=this._state.articulationValueToIndex.get(a);else{_=this._state.currentTrack.percussionArticulations.length;const w=$i.getArticulationByInputMidiNumber(a);if(w===null){this.addSemanticDiagnostic({code:at.AT209,message:`Unexpected articulation value '${a}', expected: oneOf(${Array.from($i.instrumentArticulations.keys()).join(",")}).`,severity:Ze.Error,start:d.end,end:d.end});return}this._state.currentTrack.percussionArticulations.push(w),this._state.articulationValueToIndex.set(a,_)}y.percussionArticulation=_;break}e.addNote(y),this._state.hasAnyProperData=!0,t.noteEffects&&this._noteEffects(y,t.noteEffects)}getStaffNoteKind(e){return this._state.staffNoteKind.has(e)?this._state.staffNoteKind.get(e):void 0}applyStaffNoteKind(e,t){switch(this._state.staffNoteKind.set(e,t),t){case tn.Pitched:e.isPercussion=!1,e.stringTuning.reset(),this._state.staffHasExplicitDisplayTransposition.has(e)||(e.displayTranspositionPitch=0);break;case tn.Fretted:e.isPercussion=!1,this._detectTuningForStaff(e),this._handleTransposition(e);break;case tn.Articulation:e.isPercussion=!0,e.stringTuning.reset(),this._state.staffHasExplicitDisplayTransposition.has(e)||(e.displayTranspositionPitch=0);break}}_noteEffects(e,t){for(const i of t.properties){let s=this._handler.applyNoteProperty(this,e,i);switch(s===z.NotAppliedUnrecognizedMarker&&(s=this._handler.applyBeatProperty(this,e.beat,i)),s){case z.Applied:case z.NotAppliedSemanticError:break;case z.NotAppliedUnrecognizedMarker:const a=Array.from(this._handler.knownNoteProperties).concat(Array.from(this._handler.knownBeatProperties)).join(",");this.addSemanticDiagnostic({code:at.AT212,message:`Unrecogized property '${i.property.text}', expected one of ${a}`,severity:Ze.Error,start:i.start,end:i.end});break}}}_handleTransposition(e){if(!this._state.staffDisplayTranspositionApplied.has(e)&&!this._state.staffHasExplicitDisplayTransposition.has(e)){const t=e.track.playbackInfo.program;ce.displayTranspositionPitches.has(t)?e.displayTranspositionPitch=ce.displayTranspositionPitches.get(t):this._state.currentStaff.displayTranspositionPitch=0,this._state.staffDisplayTranspositionApplied.add(e)}}_detectTuningForStaff(e){const t=e.track.playbackInfo.program;!this._state.staffTuningApplied.has(e)&&!this._state.staffHasExplicitTuning.has(e)&&(e.stringTuning.reset(),t===15||t>=24&&t<=31?e.stringTuning.tunings=de.getDefaultTuningFor(6).tunings:t>=32&&t<=39?(e.stringTuning.tunings=[43,38,33,28],this._state.staffInitialClef.set(e,_t.F4)):t===40||t===44||t===45||t===48||t===49||t===50||t===51?e.stringTuning.tunings=[52,57,50,43]:t===41?e.stringTuning.tunings=[57,50,43,36]:t===42?e.stringTuning.tunings=[45,38,31,24]:t===43?e.stringTuning.tunings=[43,38,33,28]:t===105?e.stringTuning.tunings=[50,47,43,38,55]:t===106?e.stringTuning.tunings=[57,52,45]:t===107?e.stringTuning.tunings=[52,45,38,31]:t===110?e.stringTuning.tunings=[64,57,50,43]:this._state.staffNoteKind.has(e)&&this._state.staffNoteKind.get(e)===tn.Fretted&&(e.stringTuning=de.getDefaultTuningFor(6)),this._state.staffTuningApplied.add(e))}_barMeta(e){let t=this._state.score.masterBars.length>0?void 0:[],i=this._state.currentStaff,s=!1,a=!1,o=!1;const c=()=>{t&&(t=void 0,i=this._state.currentStaff,s=!1,a=!1,o=!1)},h=new Zc(()=>{const d=this._newBar(this._state.currentStaff);if(t){for(const p of t)this._handler.applyBarMetaData(this,d,p);c()}return d});for(const d of e.metaData){const p=d.tag.tag.text.toLowerCase();if(this._handler.knownStructuralMetaDataTags.has(p)){switch(this._state.hasAnyProperData=!0,this._handler.applyStructuralMetaData(this,d)){case ur.AppliedNewTrack:a||s?o=!0:(s=!0,i=this._state.currentStaff),h.reset();break;case ur.AppliedNewStaff:a?o=!0:(a=!0,i=this._state.currentStaff),h.reset();break}if(t&&o)if(i.bars.length===0){const y=new gn;i.addBar(y);const k=new An;if(y.addVoice(k),i.bars.length>this._state.score.masterBars.length){const _=new Ka;this._state.score.addMasterBar(_)}for(const _ of t)this._handler.applyBarMetaData(this,y,_);c()}else throw new Ht(It.AlphaTex,"Unexpected internal error, didn't expect a filled staff after multiple \\track and/or \\staff tags. Please report this problem providing the input alphaTex.")}else if(this._handler.knownScoreMetaDataTags.has(d.tag.tag.text.toLowerCase()))this._state.hasAnyProperData=!0,this._handler.applyScoreMetaData(this,this._state.score,d);else if(this._handler.knownStaffMetaDataTags.has(d.tag.tag.text.toLowerCase()))this._state.hasAnyProperData=!0,this._handler.applyStaffMetaData(this,this._state.currentStaff,d);else if(this._handler.knownBarMetaDataTags.has(d.tag.tag.text.toLowerCase()))this._state.hasAnyProperData=!0,t?t.push(d):this._handler.applyBarMetaData(this,h.value,d);else{const g=Array.from(this._handler.allKnownMetaDataTags).join(",");this.addSemanticDiagnostic({code:at.AT204,message:`Unrecognized metadata '${d.tag.tag.text}', expected one of: ${g}`,severity:Ze.Error,start:d.tag.start,end:d.tag.end})}}return h.value}_newBar(e){if(this._state.barIndex<e.bars.length){const s=e.bars[this._state.barIndex];return this._state.barIndex++,s}const t=e.bars.length===0?1:e.bars[0].voices.length,i=new gn;e.addBar(i),i.previousBar&&(i.clef=i.previousBar.clef,i.clefOttava=i.previousBar.clefOttava,i.keySignature=i.previousBar.keySignature,i.keySignatureType=i.previousBar.keySignatureType),this._state.barIndex++,i.index>0&&(i.clef=i.previousBar.clef);for(let s=0;s<t;s++){const a=new An;i.addVoice(a)}if(this._state.currentStaff.bars.length>this._state.score.masterBars.length){const s=new Ka;this._state.score.addMasterBar(s),s.index>0&&(s.timeSignatureDenominator=s.previousMasterBar.timeSignatureDenominator,s.timeSignatureNumerator=s.previousMasterBar.timeSignatureNumerator,s.tripletFeel=s.previousMasterBar.tripletFeel)}return i}startNewStaff(){if(this._state.ignoredInitialVoice=!1,this._state.ignoredInitialStaff||this._state.currentTrack.staves[0].bars.length>0){const e=this._state.currentStaff.isPercussion;this._state.currentTrack.ensureStaveCount(this._state.currentTrack.staves.length+1);const t=this._state.currentTrack.staves[this._state.currentTrack.staves.length-1];this._beginStaff(t),e&&this.applyPercussionStaff(this._state.currentStaff),this._state.currentDynamics=Oe.F}else this._state.ignoredInitialStaff=!0;return this._state.currentStaff}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1,e.track.playbackInfo.program=0}startNewTrack(){return this._state.ignoredInitialVoice=!1,this._state.ignoredInitialStaff=!1,this._state.ignoredInitialTrack||this._state.score.masterBars.length>0?this._newTrack():this._state.ignoredInitialTrack=!0,this._state.currentTrack}startNewVoice(){if(this._state.voiceIndex===0&&(this._state.currentStaff.bars.length===0||this._state.currentStaff.bars.length===1&&this._state.currentStaff.bars[0].isEmpty&&!this._state.ignoredInitialVoice)){this._state.ignoredInitialVoice=!0;return}for(const e of this._state.currentStaff.bars){const t=new An;e.addVoice(t)}this._state.voiceIndex++,this._state.barIndex=0,this._state.currentTupletDenominator=-1,this._state.currentTupletNumerator=-1}}let Cb=class{};class Yf extends Cb{n;constructor(e){super(),this.n=e}}class vl extends Cb{left;right;constructor(e,t){super(),this.left=e,this.right=t}}class I0 extends Cb{n;table;constructor(e,t){super(),this.n=e,this.table=t}}class zs{static make(e,t,i,s){const a=[],o=[];if(s>32)throw new Rs("Invalid huffman");for(let d=0;d<s;d++)a.push(0),o.push(0);for(let d=0;d<i;d++){const p=e[d+t];if(p>=s)throw new Rs("Invalid huffman");a[p]++}let c=0;for(let d=1;d<s-1;d++)c=c+a[d]<<1,o[d]=c;const h=new Map;for(let d=0;d<i;d++){const p=e[d+t];if(p!==0){const g=o[p-1];o[p-1]=g+1,h.set(g<<5|p,d)}}return zs._treeCompress(new vl(zs._treeMake(h,s,0,1),zs._treeMake(h,s,1,1)))}static _treeMake(e,t,i,s){if(s>t)throw new Rs("Invalid huffman");const a=i<<5|s;return e.has(a)?new Yf(e.get(a)):(i=i<<1,s+=1,new vl(zs._treeMake(e,t,i,s),zs._treeMake(e,t,i|1,s)))}static _treeCompress(e){const t=zs._treeDepth(e);if(t===0)return e;if(t===1){if(e instanceof vl)return new vl(zs._treeCompress(e.left),zs._treeCompress(e.right));throw new Rs("assert")}const i=1<<t,s=[];for(let a=0;a<i;a++)s.push(new Yf(-1));return zs._treeWalk(s,0,0,t,e),new I0(t,s)}static _treeWalk(e,t,i,s,a){a instanceof vl&&s>0?(zs._treeWalk(e,t,i+1,s-1,a.left),zs._treeWalk(e,t|1<<i,i+1,s-1,a.right)):e[t]=zs._treeCompress(a)}static _treeDepth(e){if(e instanceof Yf)return 0;if(e instanceof I0)throw new Rs("assert");if(e instanceof vl){const t=zs._treeDepth(e.left),i=zs._treeDepth(e.right);return 1+(t<i?t:i)}return 0}}var ys;(function(n){n[n.Head=0]="Head",n[n.Block=1]="Block",n[n.CData=2]="CData",n[n.Flat=3]="Flat",n[n.Crc=4]="Crc",n[n.Dist=5]="Dist",n[n.DistOne=6]="DistOne",n[n.Done=7]="Done"})(ys||(ys={}));class Ur{static _size=32768;static _bufferSize=65536;buffer=new Uint8Array(Ur._bufferSize);pos=0;slide(){const e=new Uint8Array(Ur._bufferSize);this.pos-=Ur._size,e.set(this.buffer.subarray(Ur._size,Ur._size+this.pos),0),this.buffer=e}addBytes(e,t,i){this.pos+i>Ur._bufferSize&&this.slide(),this.buffer.set(e.subarray(t,t+i),this.pos),this.pos+=i}addByte(e){this.pos===Ur._bufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}class Va{static _lenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];static _lenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];static _distExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];static _distBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];static _codeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];static _fixedHuffman=Va._buildFixedHuffman();static _buildFixedHuffman(){const e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return zs.make(e,0,288,10)}_nbits=0;_bits=0;_state=ys.Block;_isFinal=!1;_huffman=Va._fixedHuffman;_huffdist=null;_len=0;_dist=0;_needed=0;_output=null;_outpos=0;_input;_lengths=[];_window=new Ur;constructor(e){this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,i){if(this._needed=i,this._outpos=t,this._output=e,i>0)for(;this._inflateLoop(););return i-this._needed}_inflateLoop(){switch(this._state){case ys.Head:const e=this._input.readByte();if((e&15)!==8)throw new Rs("Invalid data");const i=this._input.readByte(),s=(i&32)!==0;if(((e<<8)+i)%31!==0)throw new Rs("Invalid data");if(s)throw new Rs("Unsupported dictionary");return this._state=ys.Block,!0;case ys.Crc:return this._state=ys.Done,!0;case ys.Done:return!1;case ys.Block:switch(this._isFinal=this._getBit(),this._getBits(2)){case 0:if(this._len=U.readUInt16LE(this._input),U.readUInt16LE(this._input)!==65535-this._len)throw new Rs("Invalid data");this._state=ys.Flat;const p=this._inflateLoop();return this._resetBits(),p;case 1:return this._huffman=Va._fixedHuffman,this._huffdist=null,this._state=ys.CData,!0;case 2:const g=this._getBits(5)+257,y=this._getBits(5)+1,k=this._getBits(4)+4;for(let w=0;w<k;w++)this._lengths[Va._codeLengthsPos[w]]=this._getBits(3);for(let w=k;w<19;w++)this._lengths[Va._codeLengthsPos[w]]=0;this._huffman=zs.make(this._lengths,0,19,8);const _=[];for(let w=0;w<g+y;w++)_.push(0);return this._inflateLengths(_,g+y),this._huffdist=zs.make(_,g,y,16),this._huffman=zs.make(_,0,g,16),this._state=ys.CData,!0;default:throw new Rs("Invalid data")}case ys.Flat:{const d=this._len<this._needed?this._len:this._needed,p=U.readByteArray(this._input,d);return this._len-=d,this._addBytes(p,0,d),this._len===0&&(this._state=this._isFinal?ys.Crc:ys.Block),this._needed>0}case ys.DistOne:{const d=this._len<this._needed?this._len:this._needed;return this._addDistOne(d),this._len-=d,this._len===0&&(this._state=ys.CData),this._needed>0}case ys.Dist:for(;this._len>0&&this._needed>0;){const d=this._len<this._dist?this._len:this._dist,p=this._needed<d?this._needed:d;this._addDist(this._dist,p),this._len-=p}return this._len===0&&(this._state=ys.CData),this._needed>0;case ys.CData:let a=this._applyHuffman(this._huffman);if(a<256)return this._addByte(a),this._needed>0;if(a===256)return this._state=this._isFinal?ys.Crc:ys.Block,!0;a=a-257&255;let o=Va._lenExtraBitsTbl[a];if(o===-1)throw new Rs("Invalid data");this._len=Va._lenBaseValTbl[a]+this._getBits(o);const c=this._huffdist,h=c?this._applyHuffman(c):this._getRevBits(5);if(o=Va._distExtraBitsTbl[h],o===-1)throw new Rs("Invalid data");if(this._dist=Va._distBaseValTbl[h]+this._getBits(o),this._dist>this._window.available())throw new Rs("Invalid data");return this._state=this._dist===1?ys.DistOne:ys.Dist,!0}return!1}_addDistOne(e){const t=this._window.getLastChar();for(let i=0;i<e;i++)this._addByte(t)}_addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}_addDist(e,t){this._addBytes(this._window.buffer,this._window.pos-e,t)}_getBit(){this._nbits===0&&(this._nbits=8,this._bits=this._input.readByte());const e=(this._bits&1)===1;return this._nbits--,this._bits=this._bits>>1,e}_getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;const t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}_getRevBits(e){return e===0?0:this._getBit()?1<<e-1|this._getRevBits(e-1):this._getRevBits(e-1)}_resetBits(){this._bits=0,this._nbits=0}_addBytes(e,t,i){this._window.addBytes(e,t,i),this._output.set(e.subarray(t,t+i),this._outpos),this._needed-=i,this._outpos+=i}_inflateLengths(e,t){let i=0,s=0;for(;i<t;){const a=this._applyHuffman(this._huffman);switch(a){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:s=a,e[i]=a,i++;break;case 16:const o=i+3+this._getBits(2);if(o>t)throw new Rs("Invalid data");for(;i<o;)e[i]=s,i++;break;case 17:if(i+=3+this._getBits(3),i>t)throw new Rs("Invalid data");break;case 18:if(i+=11+this._getBits(7),i>t)throw new Rs("Invalid data");break;default:throw new Rs("Invalid data")}}}_applyHuffman(e){if(e instanceof Yf)return e.n;if(e instanceof vl)return this._applyHuffman(this._getBit()?e.right:e.left);if(e instanceof I0)return this._applyHuffman(e.table[this._getBits(e.n)]);throw new Rs("Invalid data")}}class Df{static OptionalDataDescriptorSignature=134695760;static CompressionMethodDeflate=8;static LocalFileHeaderSignature=67324752;static CentralFileHeaderSignature=33639248;static EndOfCentralDirSignature=101010256;fullName;fileName;data;constructor(e,t){this.fullName=e;const i=e.lastIndexOf("/");this.fileName=i===-1||i===e.length-1?this.fullName:e.substr(i+1),this.data=t}}class Eb{_readable;constructor(e){this._readable=e}read(){const e=[];for(;;){const t=this._readEntry();if(!t)break;e.push(t)}return e}_readEntry(){const e=this._readable;if(U.readInt32LE(e)!==Df.LocalFileHeaderSignature)return null;U.readUInt16LE(e);const i=U.readUInt16LE(e),s=U.readUInt16LE(e),a=s!==0;if(a&&s!==Df.CompressionMethodDeflate)return null;U.readInt16LE(this._readable),U.readInt16LE(this._readable),U.readInt32LE(e),U.readInt32LE(e);const o=U.readInt32LE(e),c=U.readInt16LE(e),h=U.readInt16LE(e),d=U.toString(U.readByteArray(e,c),"utf-8");e.skip(h);let p;if(a){const g=ss.empty(),y=new Va(this._readable),k=new Uint8Array(65536);for(;;){const _=y.readBytes(k,0,k.length);if(g.write(k,0,_),_<k.length)break}p=g.toArray()}else p=U.readByteArray(this._readable,o);return(i&8)!==0&&(U.readInt32LE(this._readable)===Df.OptionalDataDescriptorSignature&&U.readInt32LE(this._readable),U.readInt32LE(this._readable),U.readInt32LE(this._readable)),new Df(d,p)}}var gi;(function(n){n[n.None=0]="None",n[n.Element=1]="Element",n[n.Text=2]="Text",n[n.CDATA=3]="CDATA",n[n.Document=4]="Document",n[n.DocumentType=5]="DocumentType",n[n.Comment=6]="Comment"})(gi||(gi={}));class oa{nodeType=gi.None;localName=null;value=null;childNodes=[];attributes=new Map;firstChild=null;firstElement=null;*childElements(){for(const e of this.childNodes)e.nodeType===gi.Element&&(yield e)}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===gi.Element||e.nodeType===gi.CDATA)&&(this.firstElement=e)}getAttribute(e,t=""){return this.attributes.has(e)?this.attributes.get(e):t}getElementsByTagName(e,t=!1){const i=[];return this._searchElementsByTagName(this.childNodes,i,e,t),i}_searchElementsByTagName(e,t,i,s=!1){for(const a of e)a&&a.nodeType===gi.Element&&a.localName===i&&t.push(a),s&&this._searchElementsByTagName(a.childNodes,t,i,!0)}findChildElement(e){for(const t of this.childNodes)if(t&&t.nodeType===gi.Element&&t.localName===e)return t;return null}addElement(e){const t=new oa;return t.nodeType=gi.Element,t.localName=e,this.addChild(t),t}get innerText(){if(this.nodeType===gi.Element||this.nodeType===gi.Document){if(this.firstElement&&this.firstElement.nodeType===gi.CDATA)return this.firstElement.innerText;let e="";for(const i of this.childNodes)e+=i.innerText?.toString();return e.trim()}return this.value??""}set innerText(e){const t=new oa;t.nodeType=gi.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new oa;t.nodeType=gi.CDATA,t.value=e,this.childNodes=[t]}}class ta extends Ht{xml;pos=0;constructor(e,t,i){super(It.Format,e),this.xml=t,this.pos=i}}var Qe;(function(n){n[n.IgnoreSpaces=0]="IgnoreSpaces",n[n.Begin=1]="Begin",n[n.BeginNode=2]="BeginNode",n[n.TagName=3]="TagName",n[n.Body=4]="Body",n[n.AttribName=5]="AttribName",n[n.Equals=6]="Equals",n[n.AttvalBegin=7]="AttvalBegin",n[n.AttribVal=8]="AttribVal",n[n.Childs=9]="Childs",n[n.Close=10]="Close",n[n.WaitEnd=11]="WaitEnd",n[n.WaitEndRet=12]="WaitEndRet",n[n.Pcdata=13]="Pcdata",n[n.Header=14]="Header",n[n.Comment=15]="Comment",n[n.Doctype=16]="Doctype",n[n.Cdata=17]="Cdata",n[n.Escape=18]="Escape"})(Qe||(Qe={}));class ut{static CharCodeLF=10;static CharCodeTab=9;static CharCodeCR=13;static CharCodeSpace=32;static CharCodeLowerThan=60;static CharCodeAmp=38;static CharCodeBrackedClose=93;static CharCodeBrackedOpen=91;static CharCodeGreaterThan=62;static CharCodeExclamation=33;static CharCodeUpperD=68;static CharCodeLowerD=100;static CharCodeMinus=45;static CharCodeQuestion=63;static CharCodeSlash=47;static CharCodeEquals=61;static CharCodeDoubleQuote=34;static CharCodeSingleQuote=39;static CharCodeSharp=35;static CharCodeLowerX=120;static CharCodeLowerA=97;static CharCodeLowerZ=122;static CharCodeUpperA=65;static CharCodeUpperZ=90;static CharCode0=48;static CharCode9=57;static CharCodeColon=58;static CharCodeDot=46;static CharCodeUnderscore=95;static CharCodeSemi=59;static _escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);static parse(e,t,i){let s=e.charCodeAt(t),a=Qe.Begin,o=Qe.Begin,c=0,h="",d=Qe.Begin,p=null,g=null,y=0,k=0;for(;t<e.length;){switch(s=e.charCodeAt(t),a){case Qe.IgnoreSpaces:switch(s){case ut.CharCodeLF:case ut.CharCodeCR:case ut.CharCodeTab:case ut.CharCodeSpace:break;default:a=o;continue}break;case Qe.Begin:switch(s){case ut.CharCodeLowerThan:a=Qe.IgnoreSpaces,o=Qe.BeginNode;break;default:c=t,a=Qe.Pcdata;continue}break;case Qe.Pcdata:if(s===ut.CharCodeLowerThan){h+=e.substr(c,t-c);const _=new oa;_.nodeType=gi.Text,_.value=h,h="",i.addChild(_),a=Qe.IgnoreSpaces,o=Qe.BeginNode}else s===ut.CharCodeAmp&&(h+=e.substr(c,t-c),a=Qe.Escape,d=Qe.Pcdata,c=t+1);break;case Qe.Cdata:if(s===ut.CharCodeBrackedClose&&e.charCodeAt(t+1)===ut.CharCodeBrackedClose&&e.charCodeAt(t+2)===ut.CharCodeGreaterThan){const _=new oa;_.nodeType=gi.CDATA,_.value=e.substr(c,t-c),i.addChild(_),t+=2,a=Qe.Begin}break;case Qe.BeginNode:switch(s){case ut.CharCodeExclamation:if(e.charCodeAt(t+1)===ut.CharCodeBrackedOpen){if(t+=2,e.substr(t,6).toUpperCase()!=="CDATA[")throw new ta("Expected <![CDATA[",e,t);t+=5,a=Qe.Cdata,c=t+1}else if(e.charCodeAt(t+1)===ut.CharCodeUpperD||e.charCodeAt(t+1)===ut.CharCodeLowerD){if(e.substr(t+2,6).toUpperCase()!=="OCTYPE")throw new ta("Expected <!DOCTYPE",e,t);t+=8,a=Qe.Doctype,c=t+1}else{if(e.charCodeAt(t+1)!==ut.CharCodeMinus||e.charCodeAt(t+2)!==ut.CharCodeMinus)throw new ta("Expected <!--",e,t);t+=2,a=Qe.Comment,c=t+1}break;case ut.CharCodeQuestion:a=Qe.Header,c=t;break;case ut.CharCodeSlash:if(!i)throw new ta("Expected node name",e,t);c=t+1,a=Qe.IgnoreSpaces,o=Qe.Close;break;default:a=Qe.TagName,c=t;continue}break;case Qe.TagName:if(!ut._isValidChar(s)){if(t===c)throw new ta("Expected node name",e,t);p=new oa,p.nodeType=gi.Element,p.localName=e.substr(c,t-c),i.addChild(p),a=Qe.IgnoreSpaces,o=Qe.Body;continue}break;case Qe.Body:switch(s){case ut.CharCodeSlash:a=Qe.WaitEnd;break;case ut.CharCodeGreaterThan:a=Qe.Childs;break;default:a=Qe.AttribName,c=t;continue}break;case Qe.AttribName:if(!ut._isValidChar(s)){if(c===t)throw new ta("Expected attribute name",e,t);if(g=e.substr(c,t-c),p.attributes.has(g))throw new ta(`Duplicate attribute [${g}]`,e,t);a=Qe.IgnoreSpaces,o=Qe.Equals;continue}break;case Qe.Equals:switch(s){case ut.CharCodeEquals:a=Qe.IgnoreSpaces,o=Qe.AttvalBegin;break;default:throw new ta("Expected =",e,t)}break;case Qe.AttvalBegin:switch(s){case ut.CharCodeDoubleQuote:case ut.CharCodeSingleQuote:h="",a=Qe.AttribVal,c=t+1,k=s;break}break;case Qe.AttribVal:switch(s){case ut.CharCodeAmp:h+=e.substr(c,t-c),a=Qe.Escape,d=Qe.AttribVal,c=t+1;break;default:if(s===k){h+=e.substr(c,t-c);const _=h;h="",p.attributes.set(g,_),a=Qe.IgnoreSpaces,o=Qe.Body}break}break;case Qe.Childs:t=ut.parse(e,t,p),c=t,a=Qe.Begin;break;case Qe.WaitEnd:switch(s){case ut.CharCodeGreaterThan:a=Qe.Begin;break;default:throw new ta("Expected >",e,t)}break;case Qe.WaitEndRet:switch(s){case ut.CharCodeGreaterThan:return t;default:throw new ta("Expected >",e,t)}case Qe.Close:if(!ut._isValidChar(s)){if(c===t)throw new ta("Expected node name",e,t);if(e.substr(c,t-c)!==i.localName)throw new ta(`Expected </${i.localName}>`,e,t);a=Qe.IgnoreSpaces,o=Qe.WaitEndRet;continue}break;case Qe.Comment:s===ut.CharCodeMinus&&e.charCodeAt(t+1)===ut.CharCodeMinus&&e.charCodeAt(t+2)===ut.CharCodeGreaterThan&&(t+=2,a=Qe.Begin);break;case Qe.Doctype:if(s===ut.CharCodeBrackedOpen)y++;else if(s===ut.CharCodeBrackedClose)y--;else if(s===ut.CharCodeGreaterThan&&y===0){const _=new oa;_.nodeType=gi.DocumentType,_.value=e.substr(c,t-c),i.addChild(_),a=Qe.Begin}break;case Qe.Header:s===ut.CharCodeQuestion&&e.charCodeAt(t+1)===ut.CharCodeGreaterThan&&(t++,a=Qe.Begin);break;case Qe.Escape:if(s===ut.CharCodeSemi){const _=e.substr(c,t-c);if(_.charCodeAt(0)===ut.CharCodeSharp){const w=_.charCodeAt(1)===ut.CharCodeLowerX?Number.parseInt(`0${_.substr(1,_.length-1)}`,10):Number.parseInt(_.substr(1,_.length-1),10);h+=String.fromCharCode(w)}else ut._escapes.has(_)?h+=ut._escapes.get(_):h+=`&${_};`?.toString();c=t+1,a=d}else!ut._isValidChar(s)&&s!==ut.CharCodeSharp&&(h+="&",h+=e.substr(c,t-c),t--,c=t+1,a=d);break}t++}if(a===Qe.Begin&&(c=t,a=Qe.Pcdata),a===Qe.Pcdata){if(t!==c){h+=e.substr(c,t-c);const _=new oa;_.nodeType=gi.Text,_.value=h,i.addChild(_)}return t}if(a===Qe.Escape&&d===Qe.Pcdata){h+="&",h+=e.substr(c,t-c);const _=new oa;return _.nodeType=gi.Text,_.value=h,i.addChild(_),t}throw new ta("Unexpected end",e,t)}static _isValidChar(e){return e>=ut.CharCodeLowerA&&e<=ut.CharCodeLowerZ||e>=ut.CharCodeUpperA&&e<=ut.CharCodeUpperZ||e>=ut.CharCode0&&e<=ut.CharCode9||e===ut.CharCodeColon||e===ut.CharCodeDot||e===ut.CharCodeUnderscore||e===ut.CharCodeMinus}}class Pb{_result=[];_indention;_xmlHeader;_isStartOfLine;_currentIndention;constructor(e,t){this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case gi.None:break;case gi.Element:this._result.length>0&&this._writeLine(),this._write(`<${e.localName}`);for(const[t,i]of e.attributes)this._write(` ${t}="`),this._writeAttributeValue(i),this._write('"');if(e.childNodes.length===0)this._write("/>");else{if(this._write(">"),e.childNodes.length===1&&!e.firstElement)this.writeNode(e.childNodes[0]);else{this._indent();for(const t of e.childNodes)(t.nodeType===gi.Element||t.nodeType===gi.Comment)&&this.writeNode(t);this._unindend(),this._writeLine()}this._write(`</${e.localName}>`)}break;case gi.Text:e.value&&this._write(e.value);break;case gi.CDATA:e.value!==null&&this._write(`<![CDATA[${e.value}]]>`);break;case gi.Document:this._xmlHeader&&this._write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case gi.DocumentType:this._write(`<!DOCTYPE ${e.value}>`);break;case gi.Comment:this._write(`<!-- ${e.value} -->`);break}}_unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}_indent(){this._currentIndention+=this._indention}_writeAttributeValue(e){for(let t=0;t<e.length;t++){const i=e.charAt(t);switch(i){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(i);break}}}static write(e,t,i){const s=new Pb(t,i);return s.writeNode(e),s.toString()}_write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}_writeLine(e=null){e&&this._write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push(`
`),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class Vh extends oa{constructor(){super(),this.nodeType=gi.Document}parse(e){ut.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return Pb.write(this,e,t)}}class ao{noteRange=1;x=0;y=0}var Al;(function(n){n[n.None=0]="None",n[n.Rectangle=1]="Rectangle",n[n.Ellipse=2]="Ellipse",n[n.Circle=3]="Circle"})(Al||(Al={}));class r0 extends ao{align=Ce.Left;frame=Al.None;text="";fontFace="";weight=0;height=0}class SB extends ao{chord=new so}class _B extends ao{}class kB extends ao{}class D5 extends ao{number=0}class wB extends ao{decrescendo=!1}class o0 extends ao{allNumbers=!1;firstNumber=0;lastNumber=0}class M5 extends ao{octave=1}class L5 extends ao{}class A5{defaultClef=_t.G2;description="";percussion=!1;instrument=0;volume=0;transpose=0;index=0}class R5{from=0;to=0;curly=!1}class O5{currentBarIndex=-1;currentBarComplete=!0;currentBarDuration=0;currentPosition=0;voiceStemDir=null;repeatCount=0;repeatEnd=null}class ap{score;_trackChannel=0;_beamingMode=ei.Auto;_galleryObjects;_voiceCounts;_isFirstSystem=!0;_initialTempo=-1;parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;const i=new Vh;try{i.parse(e)}catch(s){throw new is("Could not parse XML",s)}this._parseDom(i),this._consolidate(),this.score.finish(t)}_consolidate(){ce.consolidate(this.score),ap._applyEffectRange(this._slurs,(e,t)=>{t.isLegatoOrigin=!0}),ap._applyEffectRange(this._crescendo,(e,t)=>{t.crescendo=e.decrescendo?Ds.Decrescendo:Ds.Crescendo})}static _applyEffectRange(e,t){for(const[i,s]of e){const a=s.noteRange;let o=i;for(let c=0;c<a;c++)if(t(s,o),o.index+1<o.voice.beats.length)o=o.voice.beats[o.index+1];else if(o.voice.bar.index+1<o.voice.bar.staff.bars.length)o=o.voice.bar.staff.bars[o.voice.bar.index+1].voices[o.voice.index].beats[0];else break}}_parseDom(e){const t=e.firstElement;if(!t)throw new is("No valid XML");if(t.localName==="score"){this.score=new Qa;for(const i of t.childElements())switch(i.localName){case"info":this._parseInfo(i);break;case"layout":this._parseLayout(i);break;case"gallery":this._parseGallery(i);break;case"pageObjects":this._parsePageObjects(i);break;case"systems":this._parseSystems(i);break}}else throw new is('Root node of XML was not "score"')}_staffLookup=new Map;_parseLayout(e){for(const a of e.childElements())switch(a.localName){case"staves":this._parseLayoutStaves(a);break;case"brackets":this._parseBrackets(a);break}const t=this._brackets.filter(a=>!!a.curly);t.sort((a,o)=>a.from-o.from);let i=0,s=null;for(let a=0;a<this._staffLayouts.length;a++){const o=this._staffLayouts[a];for(;i<t.length&&a>t[i].to;)i++;s&&i<t.length&&a>t[i].from&&a<=t[i].to?s.ensureStaveCount(s.staves.length+1):(s=new Za,s.ensureStaveCount(1),s.name=o.description,s.playbackInfo.volume=Math.floor(o.volume/128*16),s.playbackInfo.program=o.instrument,o.percussion?(s.playbackInfo.primaryChannel=9,s.playbackInfo.secondaryChannel=9):(s.playbackInfo.primaryChannel=this._trackChannel++,s.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(s));const c=s.staves[s.staves.length-1];c.isPercussion=o.percussion,c.transpositionPitch=o.transpose,c.displayTranspositionPitch=0,c.showTablature=!1,this._staffLookup.set(o.index,c)}}_brackets=[];_parseBrackets(e){for(const t of e.childElements())switch(t.localName){case"bracket":this._parseBracket(t);break}}_parseBracket(e){const t=new R5;t.from=Number.parseInt(e.getAttribute("from"),10),t.to=Number.parseInt(e.getAttribute("to"),10),e.attributes.has("curly")&&(t.curly=e.attributes.get("curly")==="true"),this._brackets.push(t)}_parseLayoutStaves(e){for(const t of e.childElements())switch(t.localName){case"staffLayout":this._parseStaffLayout(t);break}}_staffLayoutLookup=new Map;_staffLayouts=[];_parseStaffLayout(e){const t=new A5;t.description=e.getAttribute("description");for(const i of e.childElements())switch(i.localName){case"notation":i.attributes.has("defaultClef")&&(t.defaultClef=this._parseClef(i.attributes.get("defaultClef")));break;case"sound":i.attributes.has("percussion")&&(t.percussion=i.attributes.get("percussion")==="true"),i.attributes.has("instr")&&(t.instrument=Number.parseInt(i.attributes.get("instr"),10)),i.attributes.has("volume")&&(t.volume=Number.parseInt(i.attributes.get("volume"),10)),i.attributes.has("transpose")&&(t.transpose=Number.parseInt(i.attributes.get("transpose"),10));break}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}_parseClef(e){switch(e){case"treble":return _t.G2;case"bass":return _t.F4;case"alto":return _t.C4;case"tenor":return _t.C4}return _t.G2}_parseClefOttava(e){return e.endsWith("-")?Ye._8vb:e.endsWith("+")?Ye._8va:Ye.Regular}_parseSystems(e){for(const t of e.childElements())switch(t.localName){case"system":this._parseSystem(t);break}}_parseSystem(e){e.attributes.has("tempo")&&this.score.masterBars.length===0&&(this._initialTempo=Number.parseInt(e.attributes.get("tempo"),10)),e.getAttribute("beamGrouping")==="0"&&(this._beamingMode=ei.ForceSplitToNext);for(const t of e.childElements())switch(t.localName){case"staves":this._parseStaves(e,t);break}this._isFirstSystem=!1}_parseStaves(e,t){const i=this.score.masterBars.length;for(const s of t.childElements())switch(s.localName){case"staff":this._parseStaff(e,i,s);break}}_timeSignature=new Ka;_currentStaffLayout;_parseStaff(e,t,i){const s=i.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(s),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this._parseTime(i.getAttribute("defaultTime"));const a=this._staffLookup.get(this._currentStaffLayout.index);for(;a.bars.length<t;)this._addNewBar(a);for(const o of i.childElements())switch(o.localName){case"voices":this._parseVoices(s,a,e,t,o);break}}_parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=Number.parseInt(t[0],10),this._timeSignature.timeSignatureDenominator=Number.parseInt(t[1],10),this._timeSignature.timeSignatureCommon=!1}break}}_parseVoices(e,t,i,s,a){let o=0;for(const c of a.childElements())switch(c.localName){case"voice":this._parseVoice(e,t,i,o,s,c),o++;break}}_getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this._addNewBar(e)}_addNewBar(e){const t=new gn;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava,t.keySignature=e.bars[e.bars.length-1].keySignature,t.keySignatureType=e.bars[e.bars.length-1].keySignatureType):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){const i=new Ka;this.score.addMasterBar(i),i.index>0?i.tripletFeel=i.previousMasterBar.tripletFeel:this._initialTempo>0&&i.tempoAutomations.push(jt.buildTempoAutomation(!1,0,this._initialTempo,0)),i.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,i.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,i.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}_voiceStates=new Map;_currentVoiceState;_currentBar;_currentVoice;_newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this._getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this._ensureVoice(e,t)}_parseVoice(e,t,i,s,a,o){const c=`${e}_${s}`;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(c)?(this._currentVoiceState=this._voiceStates.get(c),this._currentBar=this._getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this._ensureVoice(t,s)):(this._currentVoiceState=new O5,this._currentVoiceState.currentBarIndex=a-1,this._voiceStates.set(c,this._currentVoiceState),this._newBar(t,s)),o.attributes.has("stemDir"))switch(o.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=j.Up;break;case"down":this._currentVoiceState.voiceStemDir=j.Down;break;default:this._currentVoiceState.voiceStemDir=null;break}else this._currentVoiceState.voiceStemDir=null;const h=o.findChildElement("noteObjects");if(i.attributes.has("tempo")){const d=new jt;d.isLinear=!0,d.type=Mt.Tempo,d.value=Number.parseInt(i.attributes.get("tempo"),10),d.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(d)}if(h)for(const d of h.childElements())switch(this._currentVoiceState.currentBarComplete&&d.localName!=="barline"&&this._newBar(t,s),d.localName){case"clefSign":this._currentBar.clef=this._parseClef(d.getAttribute("clef")),this._currentBar.clefOttava=this._parseClefOttava(d.getAttribute("clef"));break;case"keySign":this._currentBar.keySignature=Number.parseInt(d.getAttribute("fifths"),10);break;case"timeSign":this._parseTime(d.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(d.getAttribute("type")){case"double":this._currentBar.barLineRight=et.LightLight,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this._parseBarDrawObject(d),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this._newBar(t,s),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this._parseBarDrawObject(d),this._newBar(t,s),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break}break;case"chord":const p=new fs;this._initFromPreviousBeat(p,this._currentVoice),p.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(p.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this._parseDuration(p,d.findChildElement("duration")),p.updateDurations(),this._currentVoiceState.currentPosition+=p.playbackDuration,this._currentVoice.addBeat(p),this._parseChord(p,d),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const g=this._parseRestDurations(d.findChildElement("duration"));g&&(this._initFromPreviousBeat(g,this._currentVoice),g.updateDurations(),this._currentVoiceState.currentPosition+=g.playbackDuration,this._currentVoice.addBeat(g),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0));break}}_initFromPreviousBeat(e,t){const i=this._getLastBeat(t);i&&(e.dynamics=i.dynamics)}_getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length){const i=t.voices[e.index];return this._getLastBeat(i)}}return null}_ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new An);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}_parseChord(e,t){const i=new es;for(const s of t.childElements())switch(s.localName){case"stem":switch(s.getAttribute("dir")){case"up":e.preferredBeamDirection=j.Up;break;case"down":e.preferredBeamDirection=j.Down;break}break;case"articulation":switch(s.getAttribute("type")){case"staccato":i.isStaccato=!0;break;case"normalAccent":i.accentuated=mi.Normal;break;case"strongAccent":i.accentuated=mi.Heavy;break}break;case"lyric":this._parseLyric(e,s);break;case"drawObjects":this._parseBeatDrawObject(e,s);break;case"heads":this._parseHeads(e,i,s);break;case"beam":switch(s.getAttribute("group")){case"force":e.beamingMode=ei.ForceMergeWithNext;break;case"divide":e.beamingMode=ei.ForceSplitToNext;break}break}}_parseHeads(e,t,i){for(const s of i.childElements())switch(s.localName){case"head":this._parseHead(e,t,s);break}}_tieStarts;_tieStartIds;_slurs;_crescendo;_parseHead(e,t,i){const s=new es,a=ce.parseTuning(i.getAttribute("pitch"));s.octave=a.octave-1,s.tone=a.tone.noteValue,s.isStaccato=t.isStaccato,s.accentuated=t.accentuated,e.addNote(s);for(const o of i.childElements())switch(o.localName){case"alter":o.attributes.has("step")&&(s.tone+=Number.parseInt(o.attributes.get("step"),10));break;case"tie":o.attributes.has("begin")?this._tieStartIds.has(s.id)||(this._tieStartIds.set(s.id,!0),this._tieStarts.push(s)):o.attributes.has("end")&&this._tieStarts.length>0&&!s.isTieDestination&&(s.isTieDestination=!0,s.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(s.id));break}}_parseBeatDrawObject(e,t){for(const i of t.childElements())switch(i.localName){case"drawObj":const s=this._parseDrawObj(i);if(s){if(s instanceof r0)s.fontFace.startsWith("capella")?s.text==="u"?(e.fermata=new ru,e.fermata.type=mn.Medium):s.text==="f"?e.dynamics=Oe.F:s.text==="j"&&(e.dynamics=Oe.MF):this._isFirstSystem&&this.score.title===""&&s.align===Ce.Center&&s.height>16&&s.weight>400?this.score.title=s.text:this._isFirstSystem&&this.score.artist===""&&s.align===Ce.Center&&s.y<0?this.score.artist=s.text:this._isFirstSystem&&this.score.music===""&&s.align===Ce.Right&&s.y<0?this.score.music=s.text:s.text.startsWith("by capella")||(e.text=s.text);else if(!(s instanceof SB))if(s instanceof kB)e.vibrato=ct.Slight;else if(s instanceof wB)e.crescendo=s.decrescendo?Ds.Decrescendo:Ds.Crescendo,s.noteRange++,this._crescendo.set(e,s);else if(s instanceof _B){const a=s;this._slurs.set(e,a)}else s instanceof o0&&this._applyVolta(s)}break}}_parseBarDrawObject(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this._parseDrawObj(t);i&&i instanceof o0&&this._applyVolta(i);break}}_applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let i=e.firstNumber;i<=e.lastNumber;i++)t=t|1<<i-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}_parseLyric(e,t){for(const i of t.childElements())switch(i.localName){case"verse":e.lyrics||(e.lyrics=[]);let s=i.innerText;i.getAttribute("hyphen")==="true"&&(s+="-"),e.lyrics.push(s);break}}_parseRestDurations(e){const t=e.getAttribute("base");if(t.indexOf("/")!==-1){const s=new fs;return s.beamingMode=this._beamingMode,this._parseDuration(s,e),s}if(Number.parseInt(t,10)===1){const s=new fs;return s.beamingMode=this._beamingMode,s.duration=M.Whole,s}return ee.warning("Importer","Multi-Bar rests are not supported"),null}_parseDurationValue(e){switch(e){case"2/1":return M.DoubleWhole;case"1/1":return M.Whole;case"1/2":return M.Half;case"1/4":return M.Quarter;case"1/8":return M.Eighth;case"1/16":return M.Sixteenth;case"1/32":return M.ThirtySecond;case"1/64":return M.SixtyFourth;case"1/128":return M.OneHundredTwentyEighth;default:return ee.warning("Importer","Unsupported duration"),M.Quarter}}_parseDuration(e,t){const i=t.getAttribute("base");e.duration=this._parseDurationValue(i),t.attributes.has("dots")&&(e.dots=Number.parseInt(t.attributes.get("dots"),10));const s=t.findChildElement("tuplet");if(s){e.tupletNumerator=Number.parseInt(s.getAttribute("count"),10);const a=s.getAttribute("tripartite")==="true"?3:1,o=s.getAttribute("prolong")==="true"?0:1;let c=0;for(;a*Math.pow(2,c+o)<e.tupletNumerator;)c++;e.tupletDenominator=a*Math.pow(2,c)}}_parsePageObjects(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this._parseDrawObj(t);if(i&&i instanceof r0)switch(i.align){case Ce.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case Ce.Right:this.score.artist||(this.score.artist=t.innerText);break}break}}_parseGallery(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this._parseDrawObj(t);i&&this._galleryObjects.set(t.getAttribute("name"),i);break}}_parseDrawObj(e){let t=null,i=1;for(const s of e.childElements())switch(s.localName){case"text":t=this._parseText(s);break;case"guitar":t=this._parseGuitar(s);break;case"slur":t=this._parseSlur(s);break;case"wavyLine":t=this._parseWavyLine(s);break;case"bracket":t=this._parseTupletBracket(s);break;case"wedge":t=this._parseWedge(s);break;case"volta":t=this._parseVolta(s);break;case"octaveClef":t=this._parseOctaveClef(s);break;case"trill":t=this._parseTrill(s);break;case"basic":s.attributes.has("noteRange")&&(i=Number.parseInt(s.attributes.get("noteRange"),10));break}return t&&(t.noteRange=i),t}_parseTrill(e){return new L5}_parseOctaveClef(e){const t=new M5;return e.attributes.has("octave")&&(t.octave=Number.parseInt(e.attributes.get("octave"),10)),t}_parseVolta(e){const t=new o0;return t.allNumbers=e.attributes.get("allNumbers")==="true",e.attributes.has("firstNumber")&&(t.firstNumber=Number.parseInt(e.attributes.get("firstNumber"),10)),e.attributes.has("lastNumber")&&(t.lastNumber=Number.parseInt(e.attributes.get("lastNumber"),10)),t}_parseWedge(e){const t=new wB;return t.decrescendo=e.attributes.get("decrescendo")==="true",t}_parseTupletBracket(e){const t=new D5;return e.attributes.has("number")&&(t.number=Number.parseInt(e.attributes.get("number"),10)),t}_parseWavyLine(e){return new kB}_parseSlur(e){return new _B}_parseGuitar(e){const t=new SB,i=e.innerText.trim();for(let s=0;s<i.length;s++)i.charAt(s)==="/"?t.chord.strings.push(0):t.chord.strings.push(Number.parseInt(i.charAt(s),10));return t}_parseText(e){const t=new r0;switch(e.attributes.has("x")&&(t.x=Number.parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=Number.parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=Ce.Left;break;case"center":t.align=Ce.Center;break;case"right":t.align=Ce.Right;break}switch(e.getAttribute("frame")){case"rectangle":t.frame=Al.Rectangle;break;case"ellipse":t.frame=Al.Ellipse;break;case"circle":t.frame=Al.Circle;break;case"none":t.frame=Al.None;break}if(e.firstElement)for(const i of e.childElements())switch(i.localName){case"font":t.fontFace=i.getAttribute("face"),i.attributes.has("weight")&&(t.weight=Number.parseInt(i.attributes.get("weight"),10)),i.attributes.has("height")&&(t.height=Number.parseInt(i.attributes.get("height"),10));break;case"content":t.text=i.innerText;break}else t.text=e.innerText;return t}_parseInfo(e){for(const t of e.childElements())switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText;break}}}class F5 extends lu{get name(){return"Capella"}readScore(){ee.debug(this.name,"Loading ZIP entries");const e=new Eb(this.data);let t,i=null;if(t=e.read(),ee.debug(this.name,"Zip entries loaded"),t.length>0)for(const s of t)switch(s.fileName){case"score.xml":i=U.toString(s.data,this.settings.importer.encoding);break}else this.data.reset(),i=U.toString(this.data.readAll(),this.settings.importer.encoding);if(!i)throw new is("No valid capella file");ee.debug(this.name,"Start Parsing score.xml");try{const s=new ap;return s.parseXml(i,this.settings),ee.debug(this.name,"score.xml parsed"),s.score}catch(s){throw new is("Failed to parse CapXML",s)}}}var Te;(function(n){n[n.TargetFine=0]="TargetFine",n[n.TargetSegno=1]="TargetSegno",n[n.TargetSegnoSegno=2]="TargetSegnoSegno",n[n.TargetCoda=3]="TargetCoda",n[n.TargetDoubleCoda=4]="TargetDoubleCoda",n[n.JumpDaCapo=5]="JumpDaCapo",n[n.JumpDaCapoAlCoda=6]="JumpDaCapoAlCoda",n[n.JumpDaCapoAlDoubleCoda=7]="JumpDaCapoAlDoubleCoda",n[n.JumpDaCapoAlFine=8]="JumpDaCapoAlFine",n[n.JumpDalSegno=9]="JumpDalSegno",n[n.JumpDalSegnoAlCoda=10]="JumpDalSegnoAlCoda",n[n.JumpDalSegnoAlDoubleCoda=11]="JumpDalSegnoAlDoubleCoda",n[n.JumpDalSegnoAlFine=12]="JumpDalSegnoAlFine",n[n.JumpDalSegnoSegno=13]="JumpDalSegnoSegno",n[n.JumpDalSegnoSegnoAlCoda=14]="JumpDalSegnoSegnoAlCoda",n[n.JumpDalSegnoSegnoAlDoubleCoda=15]="JumpDalSegnoSegnoAlDoubleCoda",n[n.JumpDalSegnoSegnoAlFine=16]="JumpDalSegnoSegnoAlFine",n[n.JumpDaCoda=17]="JumpDaCoda",n[n.JumpDaDoubleCoda=18]="JumpDaDoubleCoda"})(Te||(Te={}));class Ro extends lu{static _versionString="FICHIER GUITAR PRO ";_versionNumber=0;_score;_globalTripletFeel=yt.NoTripletFeel;_lyricsTrack=0;_lyrics=[];_barCount=0;_trackCount=0;_playbackInfos=[];_doubleBars=new Set;_clefsPerTrack=new Map;_keySignatures=new Map;_beatTextChunksByTrack=new Map;_directionLookup=new Map;_initialTempo;get name(){return"Guitar Pro 3-5"}readScore(){if(this._directionLookup.clear(),this.readVersion(),this._score=new Qa,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Nt.gpReadBool(this.data)?yt.Triplet8th:yt.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._initialTempo=jt.buildTempoAutomation(!1,0,0,0),this._versionNumber>=500&&(this.readPageSetup(),this._initialTempo.text=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._initialTempo.value=U.readInt32LE(this.data),this._versionNumber>=510&&Nt.gpReadBool(this.data),U.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this._readDirection(Te.TargetCoda),this._readDirection(Te.TargetDoubleCoda),this._readDirection(Te.TargetSegno),this._readDirection(Te.TargetSegnoSegno),this._readDirection(Te.TargetFine),this._readDirection(Te.JumpDaCapo),this._readDirection(Te.JumpDaCapoAlCoda),this._readDirection(Te.JumpDaCapoAlDoubleCoda),this._readDirection(Te.JumpDaCapoAlFine),this._readDirection(Te.JumpDalSegno),this._readDirection(Te.JumpDalSegnoAlCoda),this._readDirection(Te.JumpDalSegnoAlDoubleCoda),this._readDirection(Te.JumpDalSegnoAlFine),this._readDirection(Te.JumpDalSegnoSegno),this._readDirection(Te.JumpDalSegnoSegnoAlCoda),this._readDirection(Te.JumpDalSegnoSegnoAlDoubleCoda),this._readDirection(Te.JumpDalSegnoSegnoAlFine),this._readDirection(Te.JumpDaCoda),this._readDirection(Te.JumpDaDoubleCoda),this.data.skip(4)),this._barCount=U.readInt32LE(this.data),this._trackCount=U.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const e=jt.buildTempoAutomation(!1,0,this._score.tempo,2);e.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(e)}return ce.consolidate(this._score),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}_readDirection(e){let t=U.readInt16LE(this.data);if(t===-1)return;t--;let i;this._directionLookup.has(t)?i=this._directionLookup.get(t):(i=[],this._directionLookup.set(t,i)),i.push(e)}readVersion(){let e=Nt.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(Ro._versionString))throw new is("Unsupported format");e=e.substr(Ro._versionString.length+1);const t=e.indexOf(".");this._versionNumber=100*Number.parseInt(e.substr(0,t),10)+Number.parseInt(e.substr(t+1),10),ee.debug(this.name,`Guitar Pro version ${e} detected`)}readScoreInformation(){this._score.title=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding);const e=U.readInt32LE(this.data);let t="";for(let i=0;i<e;i++)i>0&&(t+=`\r
`),t+=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding)?.toString();this._score.notices=t}readLyrics(){this._lyrics=[],this._lyricsTrack=U.readInt32LE(this.data)-1;for(let e=0;e<5;e++){const t=new sn;t.startBar=U.readInt32LE(this.data)-1,t.text=Nt.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(t)}}readPageSetup(){this.data.skip(28);const e=U.readInt16LE(this.data);ce.getOrCreateHeaderFooterStyle(this._score,ye.Title).isVisible=(e&1)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Title).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.SubTitle).isVisible=(e&2)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.SubTitle).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.Artist).isVisible=(e&4)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Artist).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.Album).isVisible=(e&8)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Album).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.Words).isVisible=(e&16)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Words).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.Music).isVisible=(e&32)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Music).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.WordsAndMusic).isVisible=(e&64)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.WordsAndMusic).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.Copyright).isVisible=(e&128)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.Copyright).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),ce.getOrCreateHeaderFooterStyle(this._score,ye.CopyrightSecondLine).isVisible=(e&128)!==0,ce.getOrCreateHeaderFooterStyle(this._score,ye.CopyrightSecondLine).template=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];let e=0;for(let t=0;t<64;t++){const i=new vb;i.primaryChannel=e++,i.secondaryChannel=e++,i.program=U.readInt32LE(this.data),i.volume=this.data.readByte(),i.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(i)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);const t=new Ka;!e&&this._initialTempo.value>0&&t.tempoAutomations.push(this._initialTempo);const i=this.data.readByte();if((i&1)!==0?t.timeSignatureNumerator=this.data.readByte():e&&(t.timeSignatureNumerator=e.timeSignatureNumerator),(i&2)!==0?t.timeSignatureDenominator=this.data.readByte():e&&(t.timeSignatureDenominator=e.timeSignatureDenominator),t.isRepeatStart=(i&4)!==0,(i&8)!==0&&(t.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),(i&16)!==0&&this._versionNumber<500){let o=e,c=0;for(;o&&!(o.isRepeatEnd&&o!==e||o.isRepeatStart);)c=c|o.alternateEndings,o=o.previousMasterBar;let h=0;const d=this.data.readByte();for(let p=0;p<8;p++){const g=1<<p;d>p&&(c&g)===0&&(h=h|g)}t.alternateEndings=h}if((i&32)!==0){const o=new ou;o.text=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),o.marker="",Nt.gpReadColor(this.data,!1),t.section=o}if((i&64)!==0&&this._keySignatures.set(this._score.masterBars.length,[U.readSInt8(this.data),this.data.readByte()]),this._versionNumber>=500&&(i&3)!==0&&this.data.skip(4),this._versionNumber>=500&&(t.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:t.tripletFeel=yt.Triplet8th;break;case 2:t.tripletFeel=yt.Triplet16th;break}this.data.readByte()}else t.tripletFeel=this._globalTripletFeel;const s=(i&128)!==0;t.isDoubleBar=s;const a=this._score.masterBars.length;if(this._directionLookup.has(a))for(const o of this._directionLookup.get(a))t.addDirection(o);this._score.addMasterBar(t),s&&this._doubleBars.add(t.index)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){const e=new Za;e.ensureStaveCount(1),this._score.addTrack(e);const t=e.staves[0],i=this.data.readByte();e.name=Nt.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),(i&1)!==0&&(t.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=(i&8)!==0),this._score.stylesheet.perTrackDisplayTuning===null&&(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(e.index,(i&128)!==0);const s=U.readInt32LE(this.data),a=[];for(let d=0;d<7;d++){const p=U.readInt32LE(this.data);s>d&&a.push(p)}t.stringTuning.tunings=a;const o=U.readInt32LE(this.data),c=U.readInt32LE(this.data)-1,h=U.readInt32LE(this.data)-1;if(this.data.skip(4),c>=0&&c<this._playbackInfos.length){const d=this._playbackInfos[c];d.port=o,d.isSolo=(i&16)!==0,d.isMute=(i&32)!==0,d.secondaryChannel=h,vn.isGuitar(d.program)&&(t.displayTranspositionPitch=-12),e.playbackInfo=d}if(t.capo=U.readInt32LE(this.data),e.color=Nt.gpReadColor(this.data,!1),this._versionNumber>=500){const d=this.data.readByte();t.showTablature=(d&1)!==0,t.showStandardNotation=(d&2)!==0;const p=(d&100)!==0;this._score.stylesheet.perTrackChordDiagramsOnTop===null&&(this._score.stylesheet.perTrackChordDiagramsOnTop=new Map),this._score.stylesheet.perTrackChordDiagramsOnTop.set(e.index,p),this.data.readByte(),this.data.readByte(),e.playbackInfo.bank=this.data.readByte(),this.data.readByte(),U.readInt32LE(this.data)===12?this._clefsPerTrack.set(c,_t.F4):this._clefsPerTrack.set(c,_t.G2),U.readInt32LE(this.data),U.readInt32LE(this.data),this.data.skip(10),this.data.readByte(),this.data.readByte(),this._readRseBank(),this._versionNumber>=510&&(this.data.skip(4),Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding))}else vn.isBass(e.playbackInfo.program)?this._clefsPerTrack.set(c,_t.F4):this._clefsPerTrack.set(c,_t.G2)}readBars(){for(let e=0;e<this._barCount;e++)for(let t=0;t<this._trackCount;t++)this.readBar(this._score.tracks[t])}readBar(e){const t=new gn,i=e.staves[0];if(i.isPercussion?t.clef=_t.Neutral:this._clefsPerTrack.has(e.index)&&(t.clef=this._clefsPerTrack.get(e.index)),i.addBar(t),this._keySignatures.has(t.index)){const a=this._keySignatures.get(t.index);t.keySignature=a[0],t.keySignatureType=a[1]}else t.index>0&&(t.keySignature=t.previousBar.keySignature,t.keySignatureType=t.previousBar.keySignatureType);this._doubleBars.has(t.index)&&(t.barLineRight=et.LightLight);let s=1;this._versionNumber>=500&&(this.data.readByte(),s=2);for(let a=0;a<s;a++)this.readVoice(e,t)}readVoice(e,t){const i=U.readInt32LE(this.data);if(i===0)return;const s=new An;t.addVoice(s);for(let a=0;a<i;a++)this.readBeat(e,t,s)}readBeat(e,t,i){const s=new fs,a=this.data.readByte();if((a&1)!==0&&(s.dots=1),(a&64)!==0){const p=this.data.readByte();s.isEmpty=(p&2)===0}switch(i.addBeat(s),U.readSInt8(this.data)){case-2:s.duration=M.Whole;break;case-1:s.duration=M.Half;break;case 0:s.duration=M.Quarter;break;case 1:s.duration=M.Eighth;break;case 2:s.duration=M.Sixteenth;break;case 3:s.duration=M.ThirtySecond;break;case 4:s.duration=M.SixtyFourth;break;default:s.duration=M.Quarter;break}if((a&32)!==0)switch(s.tupletNumerator=U.readInt32LE(this.data),s.tupletNumerator){case 1:s.tupletDenominator=1;break;case 3:s.tupletDenominator=2;break;case 5:case 6:case 7:s.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:s.tupletDenominator=8;break;case 2:case 4:case 8:break;default:s.tupletNumerator=1,s.tupletDenominator=1;break}(a&2)!==0&&this.readChord(s);const c=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if((a&4)!==0){const p=Nt.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(c){const g=new sn;g.text=p.trim(),g.finish(!0);const y=[];for(let k=g.chunks.length-1;k>=0;k--)y.push(g.chunks[k]);this._beatTextChunksByTrack.set(e.index,y)}else s.text=p}let h=Re.None;(a&8)!==0&&(h=this.readBeatEffects(s)),(a&16)!==0&&this.readMixTableChange(s);const d=this.data.readByte();for(let p=6;p>=0;p--)if((d&1<<p)!==0&&6-p<t.staff.tuning.length){const g=this.readNote(e,t,i,s,6-p);h!==Re.None&&(g.harmonicType=h,g.harmonicType===Re.Natural&&(g.harmonicValue=ce.deltaFretToHarmonicValue(g.fret)))}if(this._versionNumber>=500){const p=U.readInt16LE(this.data);if((p&1)!==0&&s.index>0&&(i.beats[s.index-1].beamingMode=ei.ForceSplitToNext),(p&2)!==0&&(s.preferredBeamDirection=j.Down),(p&4)!==0&&s.index>0&&(i.beats[s.index-1].beamingMode=ei.ForceMergeWithNext),(p&8)!==0&&(s.preferredBeamDirection=j.Up),(p&16)!==0&&(s.ottava=Ye._8va),(p&32)!==0&&(s.ottava=Ye._8vb),(p&64)!==0&&(s.ottava=Ye._15ma),(p&256)!==0&&(s.ottava=Ye._15mb),(p&2048)!==0){const g=this.data.readByte()!==0;s.index>0&&g&&(i.beats[s.index-1].beamingMode=ei.ForceSplitOnSecondaryToNext)}}c&&!s.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(s.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){const t=new so,i=ce.newGuid();if(this._versionNumber>=500){this.data.skip(17),t.name=Nt.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=U.readInt32LE(this.data);for(let o=0;o<7;o++){const c=U.readInt32LE(this.data);o<e.voice.bar.staff.tuning.length&&t.strings.push(c)}const s=this.data.readByte(),a=new Uint8Array(5);this.data.read(a,0,a.length);for(let o=0;o<s;o++)t.barreFrets.push(a[o]);this.data.skip(26)}else if(this.data.readByte()!==0)if(this._versionNumber>=400){this.data.skip(16),t.name=Nt.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=U.readInt32LE(this.data);for(let o=0;o<7;o++){const c=U.readInt32LE(this.data);o<e.voice.bar.staff.tuning.length&&t.strings.push(c)}const s=this.data.readByte(),a=new Uint8Array(5);this.data.read(a,0,a.length);for(let o=0;o<s;o++)t.barreFrets.push(a[o]);this.data.skip(26)}else{this.data.skip(25),t.name=Nt.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),t.firstFret=U.readInt32LE(this.data);for(let s=0;s<6;s++){const a=U.readInt32LE(this.data);s<e.voice.bar.staff.tuning.length&&t.strings.push(a)}this.data.skip(36)}else{const s=this._versionNumber>=406?7:6;if(t.name=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),t.firstFret=U.readInt32LE(this.data),t.firstFret>0)for(let a=0;a<s;a++){const o=U.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}}t.name&&(e.chordId=i,e.voice.bar.staff.addChord(e.chordId,t))}readBeatEffects(e){const t=this.data.readByte();let i=0;if(this._versionNumber>=400&&(i=this.data.readByte()),(t&16)!==0&&(e.fade=Xi.FadeIn),(this._versionNumber<400&&(t&1)!==0||(t&2)!==0)&&(e.vibrato=ct.Slight),(i&1)!==0&&(e.rasgueado=We.Ii),(t&32)!==0&&this._versionNumber>=400)switch(U.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}else if((t&32)!==0){switch(U.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}this.data.skip(4)}if((i&4)!==0&&this.readTremoloBarEffect(e),(t&64)!==0){let s=0,a=0;this._versionNumber<500?(a=this.data.readByte(),s=this.data.readByte()):(s=this.data.readByte(),a=this.data.readByte()),s>0?(e.brushType=Ne.BrushUp,e.brushDuration=Ro._toStrokeValue(s)):a>0&&(e.brushType=Ne.BrushDown,e.brushDuration=Ro._toStrokeValue(a))}if((i&2)!==0)switch(U.readSInt8(this.data)){case 0:e.pickStroke=ds.None;break;case 1:e.pickStroke=ds.Up;break;case 2:e.pickStroke=ds.Down;break}if(this._versionNumber<400){if((t&4)!==0)return Re.Natural;if((t&8)!==0)return Re.Artificial}return Re.None}readTremoloBarEffect(e){this.data.readByte(),U.readInt32LE(this.data);const t=U.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){const s=new ke(0,0);s.offset=U.readInt32LE(this.data),s.value=U.readInt32LE(this.data)/Ro._bendStep|0,Nt.gpReadBool(this.data),e.addWhammyBarPoint(s)}}static _toStrokeValue(e){switch(e){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}_readRseBank(){this.data.skip(4),this.data.skip(4),this.data.skip(4),this.data.skip(4)}readMixTableChange(e){const t=new I5;t.instrument=U.readSInt8(this.data),this._versionNumber>=500&&this._readRseBank(),t.volume=U.readSInt8(this.data),t.balance=U.readSInt8(this.data);const i=U.readSInt8(this.data),s=U.readSInt8(this.data),a=U.readSInt8(this.data),o=U.readSInt8(this.data);if(this._versionNumber>=500&&(t.tempoName=Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.tempo=U.readInt32LE(this.data),t.volume>=0&&this.data.readByte(),t.balance>=0&&this.data.readByte(),i>=0&&this.data.readByte(),s>=0&&this.data.readByte(),a>=0&&this.data.readByte(),o>=0&&this.data.readByte(),t.tempo>=0&&(t.duration=U.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500){const c=U.readSInt8(this.data);c>=100?e.wahPedal=an.Closed:c>=0&&(e.wahPedal=an.Open)}if(this._versionNumber>=510&&(Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding),Nt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.volume>=0){const c=new jt;c.isLinear=!0,c.type=Mt.Volume,c.value=t.volume,e.automations.push(c)}if(t.balance>=0){const c=new jt;c.isLinear=!0,c.type=Mt.Balance,c.value=t.balance,e.automations.push(c)}if(t.instrument>=0){const c=new jt;c.isLinear=!0,c.type=Mt.Instrument,c.value=t.instrument,e.automations.push(c)}if(t.tempo>=0){const c=new jt;c.isLinear=!0,c.type=Mt.Tempo,c.value=t.tempo,e.automations.push(c),e.voice.bar.masterBar.tempoAutomations.some(h=>h.ratioPosition===c.ratioPosition&&h.value===c.value)||e.voice.bar.masterBar.tempoAutomations.push(c)}}readNote(e,t,i,s,a){const o=new es;o.string=t.staff.tuning.length-a;const c=this.data.readByte();if((c&2)!==0?o.accentuated=mi.Heavy:(c&64)!==0&&(o.accentuated=mi.Normal),o.isGhost=(c&4)!==0,(c&32)!==0){const d=this.data.readByte();d===3?o.isDead=!0:d===2&&(o.isTieDestination=!0)}if((c&1)!==0&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),(c&16)!==0){const d=U.readSInt8(this.data);o.dynamics=this.toDynamicValue(d),s.dynamics=o.dynamics}(c&32)!==0&&(o.fret=U.readSInt8(this.data)),(c&128)!==0&&(o.leftHandFinger=U.readSInt8(this.data),o.rightHandFinger=U.readSInt8(this.data));let h=!1;if(this._versionNumber>=500&&((c&1)!==0&&(o.durationPercent=U.readFloat64BE(this.data)),h=(this.data.readByte()&2)!==0),s.addNote(o),(c&8)!==0&&this.readNoteEffects(e,i,s,o),t.staff.isPercussion&&(o.percussionArticulation=o.fret,o.string=-1,o.fret=-1),h){const d=ce.computeAccidental(t.keySignature,Ue.Default,o.realValueWithoutHarmonic,!1);d===Le.Sharp?o.accidentalMode=Ue.ForceFlat:d===Le.Flat&&(o.accidentalMode=Ue.ForceSharp)}return o}toDynamicValue(e){switch(e){case 1:return Oe.PPP;case 2:return Oe.PP;case 3:return Oe.P;case 4:return Oe.MP;case 5:return Oe.MF;case 6:return Oe.F;case 7:return Oe.FF;case 8:return Oe.FFF;default:return Oe.F}}readNoteEffects(e,t,i,s){const a=this.data.readByte();let o=0;this._versionNumber>=400&&(o=this.data.readByte()),(a&1)!==0&&this.readBend(s),(a&16)!==0&&this.readGrace(t,s),(o&4)!==0&&this.readTremoloPicking(i),(o&8)!==0?this.readSlide(s):this._versionNumber<400&&(a&4)!==0&&(s.slideOutType=$e.Shift),(o&16)!==0&&this.readArtificialHarmonic(s),(o&32)!==0&&this.readTrill(s),s.isLetRing=(a&8)!==0,s.isHammerPullOrigin=(a&2)!==0,(o&64)!==0&&(s.vibrato=ct.Slight),s.isPalmMute=(o&2)!==0,s.isStaccato=(o&1)!==0}static _bendStep=25;readBend(e){this.data.readByte(),U.readInt32LE(this.data);const t=U.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){const s=new ke(0,0);s.offset=U.readInt32LE(this.data),s.value=U.readInt32LE(this.data)/Ro._bendStep|0,Nt.gpReadBool(this.data),e.addBendPoint(s)}}readGrace(e,t){const i=new fs,s=new es;switch(s.string=t.string,s.fret=U.readSInt8(this.data),i.duration=M.ThirtySecond,i.dynamics=this.toDynamicValue(U.readSInt8(this.data)),U.readSInt8(this.data)){case 0:break;case 1:s.slideOutType=$e.Legato,s.slideTarget=t;break;case 2:break;case 3:s.isHammerPullOrigin=!0;break}if(s.dynamics=i.dynamics,this.data.skip(1),this._versionNumber<500)i.graceType=De.BeforeBeat;else{const o=this.data.readByte();s.isDead=(o&1)!==0,i.graceType=(o&2)!==0?De.OnBeat:De.BeforeBeat}e.addGraceBeat(i),i.addNote(s)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=M.Eighth;break;case 2:e.tremoloSpeed=M.Sixteenth;break;case 3:e.tremoloSpeed=M.ThirtySecond;break}}readSlide(e){if(this._versionNumber>=500){const t=U.readSInt8(this.data);(t&1)!==0?e.slideOutType=$e.Shift:(t&2)!==0?e.slideOutType=$e.Legato:(t&4)!==0?e.slideOutType=$e.OutDown:(t&8)!==0&&(e.slideOutType=$e.OutUp),(t&16)!==0?e.slideInType=Ji.IntoFromBelow:(t&32)!==0&&(e.slideInType=Ji.IntoFromAbove)}else switch(U.readSInt8(this.data)){case 1:e.slideOutType=$e.Shift;break;case 2:e.slideOutType=$e.Legato;break;case 3:e.slideOutType=$e.OutDown;break;case 4:e.slideOutType=$e.OutUp;break;case-1:e.slideInType=Ji.IntoFromBelow;break;case-2:e.slideInType=Ji.IntoFromAbove;break}}readArtificialHarmonic(e){const t=this.data.readByte();if(this._versionNumber>=500)switch(t){case 1:e.harmonicType=Re.Natural,e.harmonicValue=ce.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=Re.Artificial;break;case 3:e.harmonicType=Re.Tap,e.harmonicValue=ce.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=Re.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=Re.Semi,e.harmonicValue=12;break}else if(this._versionNumber>=400)switch(t){case 1:e.harmonicType=Re.Natural;break;case 3:e.harmonicType=Re.Tap;break;case 4:e.harmonicType=Re.Pinch;break;case 5:e.harmonicType=Re.Semi;break;case 15:e.harmonicType=Re.Artificial;break;case 17:e.harmonicType=Re.Artificial;break;case 22:e.harmonicType=Re.Artificial;break}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=M.Sixteenth;break;case 2:e.trillSpeed=M.ThirtySecond;break;case 3:e.trillSpeed=M.SixtyFourth;break}}}class Nt{static gpReadColor(e,t=!1){const i=e.readByte(),s=e.readByte(),a=e.readByte();let o=255;return t?o=e.readByte():e.skip(1),new Tt(i,s,a,o)}static gpReadBool(e){return e.readByte()!==0}static gpReadStringIntUnused(e,t){return e.skip(4),Nt.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return Nt.gpReadString(e,U.readInt32LE(e),t)}static gpReadStringIntByte(e,t){const i=U.readInt32LE(e)-1;return e.readByte(),Nt.gpReadString(e,i,t)}static gpReadString(e,t,i){const s=new Uint8Array(t);return e.read(s,0,s.length),U.toString(s,i)}static gpWriteString(e,t){const i=U.stringToBytes(t);e.writeByte(t.length),e.write(i,0,i.length)}static gpReadStringByteLength(e,t,i){const s=e.readByte(),a=Nt.gpReadString(e,s,i);return s<t&&e.skip(t-s),a}}class I5{volume=-1;balance=-1;instrument=-1;tempoName="";tempo=-1;duration=-1}var Ot;(function(n){n[n.Boolean=0]="Boolean",n[n.Integer=1]="Integer",n[n.Float=2]="Float",n[n.String=3]="String",n[n.Point=4]="Point",n[n.Size=5]="Size",n[n.Rectangle=6]="Rectangle",n[n.Color=7]="Color"})(Ot||(Ot={}));class zn{_types=new Map;raw=new Map;constructor(e){e&&this._read(e)}_read(e){const t=ss.fromBuffer(e),i=U.readInt32BE(t);for(let s=0;s<i;s++){const a=Nt.gpReadString(t,t.readByte(),"utf-8"),o=t.readByte();switch(this._types.set(a,o),o){case Ot.Boolean:const c=t.readByte()===1;this.addValue(a,c);break;case Ot.Integer:const h=U.readInt32BE(t);this.addValue(a,h);break;case Ot.Float:const d=U.readFloat32BE(t);this.addValue(a,d);break;case Ot.String:const p=Nt.gpReadString(t,U.readInt16BE(t),"utf-8");this.addValue(a,p);break;case Ot.Point:const g=U.readInt32BE(t),y=U.readInt32BE(t);this.addValue(a,new ke(g,y));break;case Ot.Size:const k=U.readInt32BE(t),_=U.readInt32BE(t);this.addValue(a,new ke(k,_));break;case Ot.Rectangle:const w=new Os;w.x=U.readInt32BE(t),w.y=U.readInt32BE(t),w.w=U.readInt32BE(t),w.h=U.readInt32BE(t),this.addValue(a,w);break;case Ot.Color:const T=Nt.gpReadColor(t,!0);this.addValue(a,T);break}}}apply(e){for(const[t,i]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=i;break;case"System/bracketExtendMode":e.stylesheet.bracketExtendMode=i;break;case"Global/useSystemSignSeparator":e.stylesheet.useSystemSignSeparator=i;break;case"Global/DisplayTuning":e.stylesheet.globalDisplayTuning=i;break;case"Global/DrawChords":e.stylesheet.globalDisplayChordDiagramsOnTop=i;break;case"System/showTrackNameSingle":i||(e.stylesheet.singleTrackTrackNamePolicy=Ii.Hidden);break;case"System/showTrackNameMulti":i||(e.stylesheet.multiTrackTrackNamePolicy=Ii.Hidden);break;case"System/trackNameModeSingle":if(e.stylesheet.singleTrackTrackNamePolicy!==Ii.Hidden)switch(i){case 0:e.stylesheet.singleTrackTrackNamePolicy=Ii.FirstSystem;break;case 1:e.stylesheet.singleTrackTrackNamePolicy=Ii.FirstSystem;break;case 2:e.stylesheet.singleTrackTrackNamePolicy=Ii.AllSystems;break}break;case"System/trackNameModeMulti":if(e.stylesheet.multiTrackTrackNamePolicy!==Ii.Hidden)switch(i){case 0:e.stylesheet.multiTrackTrackNamePolicy=Ii.FirstSystem;break;case 1:e.stylesheet.multiTrackTrackNamePolicy=Ii.FirstSystem;break;case 2:e.stylesheet.multiTrackTrackNamePolicy=Ii.AllSystems;break}break;case"System/shortTrackNameOnFirstSystem":i?e.stylesheet.firstSystemTrackNameMode=$s.ShortName:e.stylesheet.firstSystemTrackNameMode=$s.FullName;break;case"System/shortTrackNameOnOtherSystems":i?e.stylesheet.otherSystemsTrackNameMode=$s.ShortName:e.stylesheet.otherSystemsTrackNameMode=$s.FullName;break;case"System/horizontalTrackNameOnFirstSystem":i?e.stylesheet.firstSystemTrackNameOrientation=Xs.Horizontal:e.stylesheet.firstSystemTrackNameOrientation=Xs.Vertical;break;case"System/horizontalTrackNameOnOtherSystems":i?e.stylesheet.otherSystemsTrackNameOrientation=Xs.Horizontal:e.stylesheet.otherSystemsTrackNameOrientation=Xs.Vertical;break;case"Header/Title":ce.getOrCreateHeaderFooterStyle(e,ye.Title).template=i;break;case"Header/TitleAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Title).textAlign=this._toTextAlign(i);break;case"Header/drawTitle":ce.getOrCreateHeaderFooterStyle(e,ye.Title).isVisible=i;break;case"Header/Subtitle":ce.getOrCreateHeaderFooterStyle(e,ye.SubTitle).template=i;break;case"Header/SubtitleAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.SubTitle).textAlign=this._toTextAlign(i);break;case"Header/drawSubtitle":ce.getOrCreateHeaderFooterStyle(e,ye.SubTitle).isVisible=i;break;case"Header/Artist":ce.getOrCreateHeaderFooterStyle(e,ye.Artist).template=i;break;case"Header/ArtistAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Artist).textAlign=this._toTextAlign(i);break;case"Header/drawArtist":ce.getOrCreateHeaderFooterStyle(e,ye.Artist).isVisible=i;break;case"Header/Album":ce.getOrCreateHeaderFooterStyle(e,ye.Album).template=i;break;case"Header/AlbumAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Album).textAlign=this._toTextAlign(i);break;case"Header/drawAlbum":ce.getOrCreateHeaderFooterStyle(e,ye.Album).isVisible=i;break;case"Header/Words":ce.getOrCreateHeaderFooterStyle(e,ye.Words).template=i;break;case"Header/WordsAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Words).textAlign=this._toTextAlign(i);break;case"Header/drawWords":ce.getOrCreateHeaderFooterStyle(e,ye.Words).isVisible=i;break;case"Header/Music":ce.getOrCreateHeaderFooterStyle(e,ye.Music).template=i;break;case"Header/MusicAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Music).textAlign=this._toTextAlign(i);break;case"Header/drawMusic":ce.getOrCreateHeaderFooterStyle(e,ye.Music).isVisible=i;break;case"Header/WordsAndMusic":ce.getOrCreateHeaderFooterStyle(e,ye.WordsAndMusic).template=i;break;case"Header/WordsAndMusicAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.WordsAndMusic).textAlign=this._toTextAlign(i);break;case"Header/drawWordsAndMusic":ce.getOrCreateHeaderFooterStyle(e,ye.WordsAndMusic).isVisible=i;break;case"Header/Tabber":ce.getOrCreateHeaderFooterStyle(e,ye.Transcriber).template=i;break;case"Header/TabberAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Transcriber).textAlign=this._toTextAlign(i);break;case"Header/drawTabber":ce.getOrCreateHeaderFooterStyle(e,ye.Transcriber).isVisible=i;break;case"Footer/Copyright":ce.getOrCreateHeaderFooterStyle(e,ye.Copyright).template=i;break;case"Footer/CopyrightAlignment":ce.getOrCreateHeaderFooterStyle(e,ye.Copyright).textAlign=this._toTextAlign(i);break;case"Footer/drawCopyright":ce.getOrCreateHeaderFooterStyle(e,ye.Copyright).isVisible=i;break;case"Footer/Copyright2":ce.getOrCreateHeaderFooterStyle(e,ye.CopyrightSecondLine).template=i;break;case"Footer/Copyright2Alignment":ce.getOrCreateHeaderFooterStyle(e,ye.CopyrightSecondLine).textAlign=this._toTextAlign(i);break;case"Footer/drawCopyright2":ce.getOrCreateHeaderFooterStyle(e,ye.CopyrightSecondLine).isVisible=i;break}}_toTextAlign(e){switch(e){case 0:return Ce.Left;case 1:return Ce.Center;case 2:return Ce.Right}return Ce.Left}addValue(e,t,i){this.raw.set(e,t),i!==void 0&&this._types.set(e,i)}writeTo(e){U.writeInt32BE(e,this.raw.size);for(const[t,i]of this.raw){const s=this._getDataType(t,i);switch(Nt.gpWriteString(e,t),e.writeByte(s),s){case Ot.Boolean:e.writeByte(i?1:0);break;case Ot.Integer:U.writeInt32BE(e,i);break;case Ot.Float:U.writeFloat32BE(e,i);break;case Ot.String:const a=U.stringToBytes(i);U.writeInt16BE(e,a.length),e.write(a,0,a.length);break;case Ot.Point:U.writeInt32BE(e,i.offset),U.writeInt32BE(e,i.value);break;case Ot.Size:U.writeInt32BE(e,i.offset),U.writeInt32BE(e,i.value);break;case Ot.Rectangle:U.writeInt32BE(e,i.x),U.writeInt32BE(e,i.y),U.writeInt32BE(e,i.w),U.writeInt32BE(e,i.h);break;case Ot.Color:e.writeByte(i.r),e.writeByte(i.g),e.writeByte(i.b),e.writeByte(i.a);break}}}_getDataType(e,t){if(this._types.has(e))return this._types.get(e);const i=typeof t;switch(typeof t){case"string":return Ot.String;case"number":const s=t|0;return t===s?Ot.Integer:Ot.Float;case"object":if(t instanceof ke)return Ot.Point;if(t instanceof Os)return Ot.Rectangle;if(t instanceof Tt)return Ot.Color;break}throw new Ht(It.General,`Unknown value type in BinaryStylesheet: ${i}`)}static writeForScore(e){const t=new zn;switch(t.addValue("StandardNotation/hideDynamics",e.stylesheet.hideDynamics,Ot.Boolean),t.addValue("System/bracketExtendMode",e.stylesheet.bracketExtendMode,Ot.Integer),t.addValue("Global/useSystemSignSeparator",e.stylesheet.useSystemSignSeparator,Ot.Boolean),t.addValue("Global/DisplayTuning",e.stylesheet.globalDisplayTuning,Ot.Boolean),t.addValue("Global/DrawChords",e.stylesheet.globalDisplayChordDiagramsOnTop,Ot.Boolean),e.stylesheet.singleTrackTrackNamePolicy){case Ii.Hidden:t.addValue("System/showTrackNameSingle",!1,Ot.Boolean);break;case Ii.FirstSystem:t.addValue("System/trackNameModeSingle",0,Ot.Integer);break;case Ii.AllSystems:t.addValue("System/trackNameModeSingle",2,Ot.Integer);break}switch(e.stylesheet.multiTrackTrackNamePolicy){case Ii.Hidden:t.addValue("System/showTrackNameMulti",!1,Ot.Boolean);break;case Ii.FirstSystem:t.addValue("System/trackNameModeMulti",0,Ot.Integer);break;case Ii.AllSystems:t.addValue("System/trackNameModeMulti",2,Ot.Integer);break}switch(e.stylesheet.firstSystemTrackNameMode){case $s.FullName:t.addValue("System/shortTrackNameOnFirstSystem",!1,Ot.Boolean);break;case $s.ShortName:t.addValue("System/shortTrackNameOnFirstSystem",!0,Ot.Boolean);break}switch(e.stylesheet.otherSystemsTrackNameMode){case $s.FullName:t.addValue("System/shortTrackNameOnOtherSystems",!1,Ot.Boolean);break;case $s.ShortName:t.addValue("System/shortTrackNameOnOtherSystems",!0,Ot.Boolean);break}switch(e.stylesheet.firstSystemTrackNameOrientation){case Xs.Horizontal:t.addValue("System/horizontalTrackNameOnFirstSystem",!0,Ot.Boolean);break;case Xs.Vertical:t.addValue("System/horizontalTrackNameOnFirstSystem",!1,Ot.Boolean);break}switch(e.stylesheet.otherSystemsTrackNameOrientation){case Xs.Horizontal:t.addValue("System/horizontalTrackNameOnOtherSystems",!0,Ot.Boolean);break;case Xs.Vertical:t.addValue("System/horizontalTrackNameOnOtherSystems",!1,Ot.Boolean);break}const i=e.style;if(i)for(const[a,o]of i.headerAndFooter)switch(a){case ye.Title:zn._addHeaderAndFooter(t,o,"Header/","Title");break;case ye.SubTitle:zn._addHeaderAndFooter(t,o,"Header/","Subtitle");break;case ye.Artist:zn._addHeaderAndFooter(t,o,"Header/","Artist");break;case ye.Album:zn._addHeaderAndFooter(t,o,"Header/","Album");break;case ye.Words:zn._addHeaderAndFooter(t,o,"Header/","Words");break;case ye.Music:zn._addHeaderAndFooter(t,o,"Header/","Music");break;case ye.WordsAndMusic:zn._addHeaderAndFooter(t,o,"Header/","WordsAndMusic");break;case ye.Transcriber:zn._addHeaderAndFooter(t,o,"Header/","Tabber");break;case ye.Copyright:zn._addHeaderAndFooter(t,o,"Footer/","Copyright");break;case ye.CopyrightSecondLine:zn._addHeaderAndFooter(t,o,"Footer/","Copyright2");break}const s=ss.withCapacity(128);return t.writeTo(s),s.toArray()}static _addHeaderAndFooter(e,t,i,s){e.addValue(`${i}${s}`,t.template,Ot.String),e.addValue(`${i}${s}Alignment`,t.textAlign,Ot.Integer),t.isVisible!==void 0&&e.addValue(`${i}draw${s}`,t.isVisible,Ot.Boolean)}}class Db{rawAudioFile}class W5{id="";dots=0;tupletDenominator=-1;tupletNumerator=-1;value=M.Quarter}class V5{name="";path="";role="";get uniqueId(){return`${this.path};${this.name};${this.role}`}program=0;bank=0}class Se{static _invalidId="-1";static _bendPointPositionFactor=ke.MaxPosition/100;static _bendPointValueFactor=1/25;static _sampleRate=44100;score;_backingTrackAssetId;_masterTrackAutomations;_automationsPerTrackIdAndBarIndex;_sustainPedalsPerTrackIdAndBarIndex;_tracksMapping;_tracksById;_masterBars;_barsOfMasterBar;_barsById;_voicesOfBar;_voiceById;_beatsOfVoice;_rhythmOfBeat;_beatById;_rhythmById;_noteById;_notesOfBeat;_tappedNotes;_lyricsByTrack;_soundsByTrack;_hasAnacrusis=!1;_articulationByName;_skipApplyLyrics=!1;_backingTrackPadding=0;_doubleBars=new Set;_keySignatures=new Map;loadAsset;parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._sustainPedalsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;const i=new Vh;try{i.parse(e)}catch(s){throw new is("Could not parse XML",s)}if(this._parseDom(i),this._buildModel(),ce.consolidate(this.score),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[s,a]of this._lyricsByTrack)this._tracksById.get(s).applyLyrics(a)}_parseDom(e){const t=e.firstElement;if(t)if(t.localName==="GPIF"){this.score=new Qa;for(const i of t.childElements())switch(i.localName){case"Score":this._parseScoreNode(i);break;case"MasterTrack":this._parseMasterTrackNode(i);break;case"BackingTrack":this._parseBackingTrackNode(i);break;case"Tracks":this._parseTracksNode(i);break;case"MasterBars":this._parseMasterBarsNode(i);break;case"Bars":this._parseBars(i);break;case"Voices":this._parseVoices(i);break;case"Beats":this._parseBeats(i);break;case"Notes":this._parseNotes(i);break;case"Rhythms":this._parseRhythms(i);break;case"Assets":this._parseAssets(i);break}}else throw new is("Root node of XML was not GPIF")}_parseAssets(e){for(const t of e.childElements())switch(t.localName){case"Asset":t.getAttribute("id")===this._backingTrackAssetId&&this._parseBackingTrackAsset(t);break}}_parseBackingTrackAsset(e){let t="";for(const s of e.childElements())switch(s.localName){case"EmbeddedFilePath":t=s.innerText;break}const i=this.loadAsset;if(i){const s=i(t);s?this.score.backingTrack.rawAudioFile=s:this.score.backingTrack=void 0}}_parseScoreNode(e){for(const t of e.childElements())switch(t.localName){case"Title":this.score.title=t.innerText;break;case"SubTitle":this.score.subTitle=t.innerText;break;case"Artist":this.score.artist=t.innerText;break;case"Album":this.score.album=t.innerText;break;case"Words":this.score.words=t.innerText;break;case"Music":this.score.music=t.innerText;break;case"WordsAndMusic":const i=t.innerText;i!==""&&(i&&!this.score.words&&(this.score.words=i),i&&!this.score.music&&(this.score.music=i));break;case"Copyright":this.score.copyright=t.innerText;break;case"Tabber":this.score.tab=t.innerText;break;case"Instructions":this.score.instructions=t.innerText;break;case"Notices":this.score.notices=t.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=Se._parseIntSafe(t.innerText,4);break;case"ScoreSystemsLayout":this.score.systemsLayout=Se._splitSafe(t.innerText).map(s=>Se._parseIntSafe(s,4));break}}static _parseIntSafe(e,t){if(!e)return t;const i=Number.parseInt(e,10);return Number.isNaN(i)?t:i}static _parseFloatSafe(e,t){if(!e)return t;const i=Number.parseFloat(e);return Number.isNaN(i)?t:i}static _splitSafe(e,t=" "){return e?e.split(t).map(i=>i.trim()).filter(i=>i.length>0):[]}_parseBackingTrackNode(e){const t=new Db;let i=!1,s="",a="";for(const o of e.childElements())switch(o.localName){case"Enabled":i=o.innerText==="true";break;case"Source":s=o.innerText;break;case"AssetId":a=o.innerText;break;case"FramePadding":this._backingTrackPadding=Se._parseIntSafe(o.innerText,0)/Se._sampleRate*1e3;break}i&&s==="Local"&&(this.score.backingTrack=t,this._backingTrackAssetId=a)}_parseMasterTrackNode(e){for(const t of e.childElements())switch(t.localName){case"Automations":this._parseAutomations(t,this._masterTrackAutomations,null,null);break;case"Tracks":this._tracksMapping=Se._splitSafe(t.innerText);break;case"Anacrusis":this._hasAnacrusis=!0;break}}_parseAutomations(e,t,i,s){for(const a of e.childElements())switch(a.localName){case"Automation":this._parseAutomation(a,t,i,s);break}}_parseAutomation(e,t,i,s){let a=null,o=!1,c=-1,h=0,d=0,p=null,g=0,y=null,k,_=!0;for(const T of e.childElements())switch(T.localName){case"Type":a=T.innerText;break;case"Linear":o=T.innerText.toLowerCase()==="true";break;case"Bar":c=Se._parseIntSafe(T.innerText,0);break;case"Position":h=Se._parseFloatSafe(T.innerText,0);break;case"Value":if(T.firstElement&&T.firstElement.nodeType===gi.CDATA)p=T.innerText;else if(T.firstElement&&T.firstElement.nodeType===gi.Element&&a==="SyncPoint"){k=new td;for(const x of T.childElements())switch(x.localName){case"BarIndex":c=Se._parseIntSafe(x.innerText,0);break;case"BarOccurrence":k.barOccurence=Se._parseIntSafe(x.innerText,0);break;case"FrameOffset":const E=Se._parseFloatSafe(x.innerText,0);k.millisecondOffset=E/Se._sampleRate*1e3;break}}else{const x=Se._splitSafe(T.innerText);x.length===1?(d=Se._parseFloatSafe(x[0],0),g=1):(d=Se._parseFloatSafe(x[0],0),g=Se._parseIntSafe(x[1],0))}break;case"Text":y=T.innerText;break;case"Visible":_=T.innerText.toLowerCase()==="true";break}if(!a)return;const w=[];switch(a){case"Tempo":w.push(jt.buildTempoAutomation(o,h,d,g,_));break;case"SyncPoint":const T=new jt;T.type=Mt.SyncPoint,T.isLinear=o,T.ratioPosition=h,T.syncPointValue=k,T.isVisible=_,w.push(T);break;case"Sound":if(p&&i&&i.has(p)){const x=new jt;x.type=Mt.Bank,x.ratioPosition=h,x.value=i.get(p).bank,x.isVisible=_,w.push(x);const E=jt.buildInstrumentAutomation(o,h,i.get(p).program);w.push(E)}break;case"SustainPedal":if(s){let x;s.has(c)?x=s.get(c):(x=[],s.set(c,x));const E=new Qr;switch(E.ratioPosition=h,g){case 1:E.pedalType=ai.Down;break;case 3:E.pedalType=ai.Up;break}x.push(E)}break}if(w.length){if(y)for(const T of w)T.text=y;if(c>=0){t.has(c)||t.set(c,[]);for(const T of w)t.get(c).push(T)}}}_parseTracksNode(e){for(const t of e.childElements())switch(t.localName){case"Track":this._parseTrack(t);break}}_parseTrack(e){this._articulationByName=new Map;const t=new Za;t.ensureStaveCount(1);const i=t.staves[0];i.showStandardNotation=!0;const s=e.getAttribute("id");for(const a of e.childElements())switch(a.localName){case"Name":t.name=a.innerText;break;case"Color":const o=Se._splitSafe(a.innerText);if(o.length>=3){const d=Se._parseIntSafe(o[0],0),p=Se._parseIntSafe(o[1],0),g=Se._parseIntSafe(o[2],0);t.color=new Tt(d,p,g,255)}break;case"Instrument":const c=a.getAttribute("ref");(c.endsWith("-gs")||c.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this._parseInstrumentSet(t,a);break;case"NotationPatch":this._parseNotationPatch(t,a);break;case"ShortName":t.shortName=a.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=Se._parseIntSafe(a.innerText,4);break;case"SystemsLayout":t.systemsLayout=Se._splitSafe(a.innerText).map(d=>Se._parseIntSafe(d,4));break;case"Lyrics":this._parseLyrics(s,a);break;case"Properties":this._parseTrackProperties(t,a);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this._parseGeneralMidi(t,a);break;case"Sounds":this._parseSounds(s,t,a);break;case"PlaybackState":const h=a.innerText;t.playbackInfo.isSolo=h==="Solo",t.playbackInfo.isMute=h==="Mute";break;case"PartSounding":this._parsePartSounding(s,t,a);break;case"Staves":this._parseStaves(t,a);break;case"Transpose":this._parseTranspose(s,t,a);break;case"RSE":this._parseRSE(t,a);break;case"Automations":this._parseTrackAutomations(s,a);break}this._tracksById.set(s,t)}_parseTrackAutomations(e,t){const i=new Map;this._automationsPerTrackIdAndBarIndex.set(e,i);const s=new Map;this._sustainPedalsPerTrackIdAndBarIndex.set(e,s),this._parseAutomations(t,i,this._soundsByTrack.get(e),s)}_parseNotationPatch(e,t){for(const i of t.childElements())switch(i.localName){case"LineCount":const s=Se._parseIntSafe(i.innerText,5);for(const a of e.staves)a.standardNotationLineCount=s;break;case"Elements":this._parseElements(e,i);break}}_parseInstrumentSet(e,t){for(const i of t.childElements())switch(i.localName){case"Type":if(i.innerText==="drumKit")for(const a of e.staves)a.isPercussion=!0;break;case"Elements":this._parseElements(e,i);break;case"LineCount":const s=Se._parseIntSafe(i.innerText,5);for(const a of e.staves)a.standardNotationLineCount=s;break}}_parseElements(e,t){for(const i of t.childElements())switch(i.localName){case"Element":this._parseElement(e,i);break}}_parseElement(e,t){const i=t.findChildElement("Type")?.innerText??"";for(const s of t.childElements())switch(s.localName){case"Name":case"Articulations":this._parseArticulations(e,s,i);break}}_parseArticulations(e,t,i){for(const s of t.childElements())switch(s.localName){case"Articulation":this._parseArticulation(e,s,i);break}}_parseArticulation(e,t,i){const s=new Pe;s.outputMidiNumber=-1,s.elementType=i;let a="";for(const o of t.childElements()){const c=o.innerText;switch(o.localName){case"Name":a=o.innerText;break;case"OutputMidiNumber":s.outputMidiNumber=Se._parseIntSafe(c,0);break;case"TechniqueSymbol":s.techniqueSymbol=this._parseTechniqueSymbol(c);break;case"TechniquePlacement":switch(c){case"outside":s.techniqueSymbolPlacement=Jt.Outside;break;case"inside":s.techniqueSymbolPlacement=Jt.Inside;break;case"above":s.techniqueSymbolPlacement=Jt.Above;break;case"below":s.techniqueSymbolPlacement=Jt.Below;break}break;case"Noteheads":const h=Se._splitSafe(c);h.length>=1&&(s.noteHeadDefault=this._parseNoteHead(h[0])),h.length>=2&&(s.noteHeadHalf=this._parseNoteHead(h[1])),h.length>=3&&(s.noteHeadWhole=this._parseNoteHead(h[2])),s.noteHeadHalf===S.None&&(s.noteHeadHalf=s.noteHeadDefault),s.noteHeadWhole===S.None&&(s.noteHeadWhole=s.noteHeadDefault);break;case"StaffLine":s.staffLine=Se._parseIntSafe(c,0);break}}s.outputMidiNumber!==-1?(e.percussionArticulations.push(s),a.length>0&&this._articulationByName.set(a,s)):a.length>0&&this._articulationByName.has(a)&&(this._articulationByName.get(a).staffLine=s.staffLine)}_parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return S.PictEdgeOfCymbal;case"articStaccatoAbove":return S.ArticStaccatoAbove;case"noteheadParenthesis":return S.NoteheadParenthesis;case"stringsUpBow":return S.StringsUpBow;case"stringsDownBow":return S.StringsDownBow;case"guitarGolpe":return S.GuitarGolpe;default:return S.None}}_parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return S.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return S.NoteheadDoubleWhole;case"noteheadWhole":return S.NoteheadWhole;case"noteheadHalf":return S.NoteheadHalf;case"noteheadBlack":return S.NoteheadBlack;case"noteheadNull":return S.NoteheadNull;case"noteheadXOrnate":return S.NoteheadXOrnate;case"noteheadTriangleUpWhole":return S.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return S.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return S.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return S.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return S.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return S.NoteheadDiamondWhiteWide;case"noteheadCircleX":return S.NoteheadCircleX;case"noteheadXWhole":return S.NoteheadXWhole;case"noteheadXHalf":return S.NoteheadXHalf;case"noteheadXBlack":return S.NoteheadXBlack;case"noteheadParenthesis":return S.NoteheadParenthesis;case"noteheadSlashedBlack2":return S.NoteheadSlashedBlack2;case"noteheadCircleSlash":return S.NoteheadCircleSlash;case"noteheadHeavyX":return S.NoteheadHeavyX;case"noteheadHeavyXHat":return S.NoteheadHeavyXHat;default:return ee.warning("GPIF","Unknown notehead symbol",e),S.None}}_parseStaves(e,t){let i=0;for(const s of t.childElements())switch(s.localName){case"Staff":e.ensureStaveCount(i+1);const a=e.staves[i];this._parseStaff(a,s),i++;break}}_parseStaff(e,t){for(const i of t.childElements())switch(i.localName){case"Properties":this._parseStaffProperties(e,i);break}}_parseStaffProperties(e,t){for(const i of t.childElements())switch(i.localName){case"Property":this._parseStaffProperty(e,i);break}}_parseStaffProperty(e,t){switch(t.getAttribute("name")){case"Tuning":for(const a of t.childElements())switch(a.localName){case"Pitches":const o=Se._splitSafe(t.findChildElement("Pitches")?.innerText),c=new Array(o.length);for(let h=0;h<c.length;h++)c[c.length-1-h]=Se._parseIntSafe(o[h],0);e.stringTuning.tunings=c;break;case"Label":e.stringTuning.name=a.innerText;break}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this._parseDiagramCollectionForStaff(e,t);break;case"CapoFret":const s=Se._parseIntSafe(t.findChildElement("Fret")?.innerText,0);e.capo=s;break}}_parseLyrics(e,t){const i=[];for(const s of t.childElements())switch(s.localName){case"Line":i.push(this._parseLyricsLine(s));break}this._lyricsByTrack.set(e,i)}_parseLyricsLine(e){const t=new sn;for(const i of e.childElements())switch(i.localName){case"Offset":t.startBar=Se._parseIntSafe(i.innerText,0);break;case"Text":t.text=i.innerText;break}return t}_parseDiagramCollectionForTrack(e,t){const i=t.findChildElement("Items");if(i)for(const s of i.childElements())switch(s.localName){case"Item":this._parseDiagramItemForTrack(e,s);break}}_parseDiagramCollectionForStaff(e,t){const i=t.findChildElement("Items");if(i)for(const s of i.childElements())switch(s.localName){case"Item":this._parseDiagramItemForStaff(e,s);break}}_parseDiagramItemForTrack(e,t){const i=new so,s=t.getAttribute("id");for(const a of e.staves)a.addChord(s,i);this._parseDiagramItemForChord(i,t)}_parseDiagramItemForStaff(e,t){const i=new so,s=t.getAttribute("id");e.addChord(s,i),this._parseDiagramItemForChord(i,t)}_parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");const i=t.findChildElement("Diagram");if(!i){e.showDiagram=!1,e.showFingering=!1;return}const s=Se._parseIntSafe(i.getAttribute("stringCount"),6),a=Se._parseIntSafe(i.getAttribute("baseFret"),0);e.firstFret=a+1;for(let o=0;o<s;o++)e.strings.push(-1);for(const o of i.childElements())switch(o.localName){case"Fret":const c=Se._parseIntSafe(o.getAttribute("string"),0);e.strings[s-c-1]=a+Se._parseIntSafe(o.getAttribute("fret"),0);break;case"Fingering":const h=new Map;for(const d of o.childElements())switch(d.localName){case"Position":let p=Fe.Unknown;const g=a+Se._parseIntSafe(d.getAttribute("fret"),0);switch(d.getAttribute("finger")){case"Index":p=Fe.IndexFinger;break;case"Middle":p=Fe.MiddleFinger;break;case"Rank":p=Fe.AnnularFinger;break;case"Pinky":p=Fe.LittleFinger;break;case"Thumb":p=Fe.Thumb;break}p!==Fe.Unknown&&(h.has(p)?e.barreFrets.push(g):h.set(p,!0));break}break;case"Property":switch(o.getAttribute("name")){case"ShowName":e.showName=o.getAttribute("value")==="true";break;case"ShowDiagram":e.showDiagram=o.getAttribute("value")==="true";break;case"ShowFingering":e.showFingering=o.getAttribute("value")==="true";break}break}}_parseTrackProperties(e,t){for(const i of t.childElements())switch(i.localName){case"Property":this._parseTrackProperty(e,i);break}}_parseTrackProperty(e,t){switch(t.getAttribute("name")){case"Tuning":const s=Se._splitSafe(t.findChildElement("Pitches")?.innerText),a=new Array(s.length);for(let c=0;c<a.length;c++)a[a.length-1-c]=Se._parseIntSafe(s[c],0);for(const c of e.staves)c.stringTuning.tunings=a,c.showStandardNotation=!0,c.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this._parseDiagramCollectionForTrack(e,t);break;case"CapoFret":const o=Se._parseIntSafe(t.findChildElement("Fret")?.innerText,0);for(const c of e.staves)c.capo=o;break}}_parseGeneralMidi(e,t){for(const s of t.childElements())switch(s.localName){case"Program":e.playbackInfo.program=Se._parseIntSafe(s.innerText,0);break;case"Port":e.playbackInfo.port=Se._parseIntSafe(s.innerText,0);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=Se._parseIntSafe(s.innerText,0);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=Se._parseIntSafe(s.innerText,0);break}if(t.getAttribute("table")==="Percussion")for(const s of e.staves)s.isPercussion=!0}_parseSounds(e,t,i){for(const s of i.childElements())switch(s.localName){case"Sound":this._parseSound(e,t,s);break}}_parseSound(e,t,i){const s=new V5;for(const a of i.childElements())switch(a.localName){case"Name":s.name=a.innerText;break;case"Path":s.path=a.innerText;break;case"Role":s.role=a.innerText;break;case"MIDI":this._parseSoundMidi(s,a);break}this._soundsByTrack.has(e)||(this._soundsByTrack.set(e,new Map),t.playbackInfo.program=s.program,t.playbackInfo.bank=s.bank),this._soundsByTrack.get(e).set(s.uniqueId,s)}_parseSoundMidi(e,t){let i=0,s=0;for(const a of t.childElements())switch(a.localName){case"Program":e.program=Se._parseIntSafe(a.innerText,0);break;case"MSB":i=Se._parseIntSafe(a.innerText,0);break;case"LSB":s=Se._parseIntSafe(a.innerText,0);break}e.bank=(i&127)<<7|s}_parsePartSounding(e,t,i){for(const s of i.childElements())switch(s.localName){case"TranspositionPitch":for(const o of t.staves)o.displayTranspositionPitch=Se._parseIntSafe(s.innerText,0);break;case"NominalKey":const a=Math.max(0,de.noteNames.indexOf(s.innerText));this._transposeKeySignaturePerTrack.set(e,a);break}}_transposeKeySignaturePerTrack=new Map;_parseTranspose(e,t,i){let s=0,a=0;for(const h of i.childElements())switch(h.localName){case"Chromatic":a=Se._parseIntSafe(h.innerText,0);break;case"Octave":s=Se._parseIntSafe(h.innerText,0);break}const o=s*12+a;for(const h of t.staves)h.displayTranspositionPitch=o;const c=ce.flooredDivision(o,12);this._transposeKeySignaturePerTrack.set(e,c)}_parseRSE(e,t){for(const i of t.childElements())switch(i.localName){case"ChannelStrip":this._parseChannelStrip(e,i);break}}_parseChannelStrip(e,t){for(const i of t.childElements())switch(i.localName){case"Parameters":this._parseChannelStripParameters(e,i);break}}_parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){const i=Se._splitSafe(t.firstChild.value);i.length>=12&&(e.playbackInfo.balance=Math.floor(Se._parseFloatSafe(i[11],.5)*16),e.playbackInfo.volume=Math.floor(Se._parseFloatSafe(i[12],.9)*16))}}_parseMasterBarsNode(e){for(const t of e.childElements())switch(t.localName){case"MasterBar":this._parseMasterBar(t);break}}_parseMasterBar(e){const t=new Ka;this._masterBars.length===0&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(const i of e.childElements())switch(i.localName){case"Time":const s=i.innerText.split("/");t.timeSignatureNumerator=Se._parseIntSafe(s[0],4),t.timeSignatureDenominator=Se._parseIntSafe(s[1],4);break;case"FreeTime":t.isFreeTime=!0;break;case"DoubleBar":t.isDoubleBar=!0,this._doubleBars.add(t);break;case"Section":t.section=new ou,t.section.marker=i.findChildElement("Letter")?.innerText??"",t.section.text=i.findChildElement("Text")?.innerText??"";break;case"Repeat":i.getAttribute("start").toLowerCase()==="true"&&(t.isRepeatStart=!0),i.getAttribute("end").toLowerCase()==="true"&&i.getAttribute("count")&&(t.repeatCount=Se._parseIntSafe(i.getAttribute("count"),1));break;case"AlternateEndings":const a=Se._splitSafe(i.innerText);let o=0;for(let p=0;p<a.length;p++)o=o|1<<-1+Se._parseIntSafe(a[p],0);t.alternateEndings=o;break;case"Bars":this._barsOfMasterBar.push(Se._splitSafe(i.innerText));break;case"TripletFeel":switch(i.innerText){case"NoTripletFeel":t.tripletFeel=yt.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=yt.Triplet8th;break;case"Triplet16th":t.tripletFeel=yt.Triplet16th;break;case"Dotted8th":t.tripletFeel=yt.Dotted8th;break;case"Dotted16th":t.tripletFeel=yt.Dotted16th;break;case"Scottish8th":t.tripletFeel=yt.Scottish8th;break;case"Scottish16th":t.tripletFeel=yt.Scottish16th;break}break;case"Key":const c=Se._parseIntSafe(i.findChildElement("AccidentalCount")?.innerText,0),h=i.findChildElement("Mode");let d=pn.Major;if(h)switch(h.innerText.toLowerCase()){case"major":d=pn.Major;break;case"minor":d=pn.Minor;break}this._keySignatures.set(this._masterBars.length,[c,d]);break;case"Fermatas":this._parseFermatas(t,i);break;case"XProperties":this._parseMasterBarXProperties(t,i);break;case"Directions":this._parseDirections(t,i);break}this._masterBars.push(t)}_parseDirections(e,t){for(const i of t.childElements())switch(i.localName){case"Target":switch(i.innerText){case"Coda":e.addDirection(Te.TargetCoda);break;case"DoubleCoda":e.addDirection(Te.TargetDoubleCoda);break;case"Segno":e.addDirection(Te.TargetSegno);break;case"SegnoSegno":e.addDirection(Te.TargetSegnoSegno);break;case"Fine":e.addDirection(Te.TargetFine);break}break;case"Jump":switch(i.innerText){case"DaCapo":e.addDirection(Te.JumpDaCapo);break;case"DaCapoAlCoda":e.addDirection(Te.JumpDaCapoAlCoda);break;case"DaCapoAlDoubleCoda":e.addDirection(Te.JumpDaCapoAlDoubleCoda);break;case"DaCapoAlFine":e.addDirection(Te.JumpDaCapoAlFine);break;case"DaSegno":e.addDirection(Te.JumpDalSegno);break;case"DaSegnoAlCoda":e.addDirection(Te.JumpDalSegnoAlCoda);break;case"DaSegnoAlDoubleCoda":e.addDirection(Te.JumpDalSegnoAlDoubleCoda);break;case"DaSegnoAlFine":e.addDirection(Te.JumpDalSegnoAlFine);break;case"DaSegnoSegno":e.addDirection(Te.JumpDalSegnoSegno);break;case"DaSegnoSegnoAlCoda":e.addDirection(Te.JumpDalSegnoSegnoAlCoda);break;case"DaSegnoSegnoAlDoubleCoda":e.addDirection(Te.JumpDalSegnoSegnoAlDoubleCoda);break;case"DaSegnoSegnoAlFine":e.addDirection(Te.JumpDalSegnoSegnoAlFine);break;case"DaCoda":e.addDirection(Te.JumpDaCoda);break;case"DaDoubleCoda":e.addDirection(Te.JumpDaDoubleCoda);break}break}}_parseFermatas(e,t){for(const i of t.childElements())switch(i.localName){case"Fermata":this._parseFermata(e,i);break}}_parseFermata(e,t){let i=0;const s=new ru;for(const a of t.childElements())switch(a.localName){case"Type":switch(a.innerText){case"Short":s.type=mn.Short;break;case"Medium":s.type=mn.Medium;break;case"Long":s.type=mn.Long;break}break;case"Length":s.length=Se._parseFloatSafe(a.innerText,0);break;case"Offset":const o=a.innerText.split("/");if(o.length===2){const c=Se._parseIntSafe(o[0],4),h=Se._parseIntSafe(o[1],4);i=c/h*$.QuarterTime|0}break}e.addFermata(i,s)}_parseBars(e){for(const t of e.childElements())switch(t.localName){case"Bar":this._parseBar(t);break}}_parseBar(e){const t=new gn,i=e.getAttribute("id");for(const s of e.childElements())switch(s.localName){case"Voices":this._voicesOfBar.set(i,Se._splitSafe(s.innerText));break;case"Clef":switch(s.innerText){case"Neutral":t.clef=_t.Neutral;break;case"G2":t.clef=_t.G2;break;case"F4":t.clef=_t.F4;break;case"C4":t.clef=_t.C4;break;case"C3":t.clef=_t.C3;break}break;case"Ottavia":switch(s.innerText){case"8va":t.clefOttava=Ye._8va;break;case"15ma":t.clefOttava=Ye._15ma;break;case"8vb":t.clefOttava=Ye._8vb;break;case"15mb":t.clefOttava=Ye._15mb;break}break;case"SimileMark":switch(s.innerText){case"Simple":t.simileMark=rs.Simple;break;case"FirstOfDouble":t.simileMark=rs.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=rs.SecondOfDouble;break}break;case"XProperties":this._parseBarXProperties(s,t);break}this._barsById.set(i,t)}_parseVoices(e){for(const t of e.childElements())switch(t.localName){case"Voice":this._parseVoice(t);break}}_parseVoice(e){const t=new An,i=e.getAttribute("id");for(const s of e.childElements())switch(s.localName){case"Beats":this._beatsOfVoice.set(i,Se._splitSafe(s.innerText));break}this._voiceById.set(i,t)}_parseBeats(e){for(const t of e.childElements())switch(t.localName){case"Beat":this._parseBeat(t);break}}_parseBeat(e){const t=new fs,i=e.getAttribute("id");for(const s of e.childElements())switch(s.localName){case"Notes":this._notesOfBeat.set(i,Se._splitSafe(s.innerText));break;case"Rhythm":this._rhythmOfBeat.set(i,s.getAttribute("ref"));break;case"Fadding":switch(s.innerText){case"FadeIn":t.fade=Xi.FadeIn;break;case"FadeOut":t.fade=Xi.FadeOut;break;case"VolumeSwell":t.fade=Xi.VolumeSwell;break}break;case"Tremolo":switch(s.innerText){case"1/2":t.tremoloSpeed=M.Eighth;break;case"1/4":t.tremoloSpeed=M.Sixteenth;break;case"1/8":t.tremoloSpeed=M.ThirtySecond;break}break;case"Chord":t.chordId=s.innerText;break;case"Hairpin":switch(s.innerText){case"Crescendo":t.crescendo=Ds.Crescendo;break;case"Decrescendo":t.crescendo=Ds.Decrescendo;break}break;case"Arpeggio":s.innerText==="Up"?t.brushType=Ne.ArpeggioUp:t.brushType=Ne.ArpeggioDown;break;case"Properties":this._parseBeatProperties(s,t);break;case"XProperties":this._parseBeatXProperties(s,t);break;case"FreeText":t.text=s.innerText;break;case"TransposedPitchStemOrientation":switch(s.innerText){case"Upward":t.preferredBeamDirection=j.Up;break;case"Downward":t.preferredBeamDirection=j.Down;break}break;case"Dynamic":switch(s.innerText){case"PPP":t.dynamics=Oe.PPP;break;case"PP":t.dynamics=Oe.PP;break;case"P":t.dynamics=Oe.P;break;case"MP":t.dynamics=Oe.MP;break;case"MF":t.dynamics=Oe.MF;break;case"F":t.dynamics=Oe.F;break;case"FF":t.dynamics=Oe.FF;break;case"FFF":t.dynamics=Oe.FFF;break}break;case"GraceNotes":switch(s.innerText){case"OnBeat":t.graceType=De.OnBeat;break;case"BeforeBeat":t.graceType=De.BeforeBeat;break}break;case"Legato":s.getAttribute("origin")==="true"&&(t.isLegatoOrigin=!0);break;case"Whammy":const a=new ke(0,0);a.value=this._toBendValue(Se._parseFloatSafe(s.getAttribute("originValue"),0)),a.offset=this._toBendOffset(Se._parseFloatSafe(s.getAttribute("originOffset"),0)),t.addWhammyBarPoint(a);const o=new ke(0,0);o.value=this._toBendValue(Se._parseFloatSafe(s.getAttribute("middleValue"),0)),o.offset=this._toBendOffset(Se._parseFloatSafe(s.getAttribute("middleOffset1"),0)),t.addWhammyBarPoint(o);const c=new ke(0,0);c.value=this._toBendValue(Se._parseFloatSafe(s.getAttribute("middleValue"),0)),c.offset=this._toBendOffset(Se._parseFloatSafe(s.getAttribute("middleOffset2"),0)),t.addWhammyBarPoint(c);const h=new ke(0,0);h.value=this._toBendValue(Se._parseFloatSafe(s.getAttribute("destinationValue"),0)),h.offset=this._toBendOffset(Se._parseFloatSafe(s.getAttribute("destinationOffset"),0)),t.addWhammyBarPoint(h);break;case"Ottavia":switch(s.innerText){case"8va":t.ottava=Ye._8va;break;case"8vb":t.ottava=Ye._8vb;break;case"15ma":t.ottava=Ye._15ma;break;case"15mb":t.ottava=Ye._15mb;break}break;case"Lyrics":t.lyrics=this._parseBeatLyrics(s),this._skipApplyLyrics=!0;break;case"Slashed":t.slashed=!0;break;case"DeadSlapped":t.deadSlapped=!0;break;case"Golpe":switch(s.innerText){case"Finger":t.golpe=qs.Finger;break;case"Thumb":t.golpe=qs.Thumb;break}break;case"Wah":switch(s.innerText){case"Open":t.wahPedal=an.Open;break;case"Closed":t.wahPedal=an.Closed;break}break;case"UserTransposedPitchStemOrientation":switch(s.innerText){case"Downward":t.preferredBeamDirection=j.Down;break;case"Upward":t.preferredBeamDirection=j.Up;break}break;case"Timer":t.showTimer=!0,t.timer=Se._parseIntSafe(s.innerText,-1),t.timer<0&&(t.timer=null);break}this._beatById.set(i,t)}_parseBeatLyrics(e){const t=[];for(const i of e.childElements())switch(i.localName){case"Line":t.push(i.innerText);break}return t}_parseBeatXProperties(e,t){for(const i of e.childElements())switch(i.localName){case"XProperty":const s=i.getAttribute("id");let a=0;switch(s){case"1124204546":switch(a=Se._parseIntSafe(i.findChildElement("Int")?.innerText,0),a){case 1:t.beamingMode=ei.ForceMergeWithNext;break;case 2:t.beamingMode=ei.ForceSplitToNext;break}break;case"1124204552":switch(a=Se._parseIntSafe(i.findChildElement("Int")?.innerText,0),a){case 1:t.beamingMode!==ei.ForceSplitToNext&&(t.beamingMode=ei.ForceSplitOnSecondaryToNext);break}break;case"1124204545":a=Se._parseIntSafe(i.findChildElement("Int")?.innerText,0),t.invertBeamDirection=a===1;break;case"687935489":a=Se._parseIntSafe(i.findChildElement("Int")?.innerText,0),t.brushDuration=a;break}break}}_parseBarXProperties(e,t){for(const i of e.childElements())switch(i.localName){case"XProperty":switch(i.getAttribute("id")){case"1124139520":const a=i.findChildElement("Double")??i.findChildElement("Float");t.displayScale=Se._parseFloatSafe(a?.innerText,1);break}break}}_parseMasterBarXProperties(e,t){for(const i of t.childElements())switch(i.localName){case"XProperty":switch(i.getAttribute("id")){case"1124073984":e.displayScale=Se._parseFloatSafe(i.findChildElement("Double")?.innerText,1);break}break}}_parseBeatProperties(e,t){let i=!1,s=null,a=null,o=null,c=null,h=null;for(const d of e.childElements())switch(d.localName){case"Property":switch(d.getAttribute("name")){case"Brush":d.findChildElement("Direction")?.innerText==="Up"?t.brushType=Ne.BrushUp:t.brushType=Ne.BrushDown;break;case"PickStroke":d.findChildElement("Direction")?.innerText==="Up"?t.pickStroke=ds.Up:t.pickStroke=ds.Down;break;case"Slapped":d.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":d.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch(d.findChildElement("Strength")?.innerText){case"Wide":t.vibrato=ct.Wide;break;case"Slight":t.vibrato=ct.Slight;break}break;case"WhammyBar":i=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":s||(s=new ke(0,0)),s.value=this._toBendValue(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarOriginOffset":s||(s=new ke(0,0)),s.offset=this._toBendOffset(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleValue":a=this._toBendValue(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset1":o=this._toBendOffset(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset2":c=this._toBendOffset(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationValue":h||(h=new ke(ke.MaxPosition,0)),h.value=this._toBendValue(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationOffset":h||(h=new ke(0,0)),h.offset=this._toBendOffset(Se._parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BarreFret":t.barreFret=Se._parseIntSafe(d.findChildElement("Fret")?.innerText,0);break;case"BarreString":switch(d.findChildElement("String")?.innerText){case"0":t.barreShape=Yn.Full;break;case"1":t.barreShape=Yn.Half;break}break;case"Rasgueado":switch(d.findChildElement("Rasgueado")?.innerText){case"ii_1":t.rasgueado=We.Ii;break;case"mi_1":t.rasgueado=We.Mi;break;case"mii_1":t.rasgueado=We.MiiTriplet;break;case"mii_2":t.rasgueado=We.MiiAnapaest;break;case"pmp_1":t.rasgueado=We.PmpTriplet;break;case"pmp_2":t.rasgueado=We.PmpAnapaest;break;case"pei_1":t.rasgueado=We.PeiTriplet;break;case"pei_2":t.rasgueado=We.PeiAnapaest;break;case"pai_1":t.rasgueado=We.PaiTriplet;break;case"pai_2":t.rasgueado=We.PaiAnapaest;break;case"ami_1":t.rasgueado=We.AmiTriplet;break;case"ami_2":t.rasgueado=We.AmiAnapaest;break;case"ppp_1":t.rasgueado=We.Ppp;break;case"amii_1":t.rasgueado=We.Amii;break;case"amip_1":t.rasgueado=We.Amip;break;case"eami_1":t.rasgueado=We.Eami;break;case"eamii_1":t.rasgueado=We.Eamii;break;case"peami_1":t.rasgueado=We.Peami;break}break}break}i&&(s||(s=new ke(0,0)),h||(h=new ke(ke.MaxPosition,0)),t.addWhammyBarPoint(s),o&&a&&t.addWhammyBarPoint(new ke(o,a)),c&&a&&t.addWhammyBarPoint(new ke(c,a)),!o&&!c&&a&&t.addWhammyBarPoint(new ke(ke.MaxPosition/2|0,a)),t.addWhammyBarPoint(h))}_parseNotes(e){for(const t of e.childElements())switch(t.localName){case"Note":this._parseNote(t);break}}_parseNote(e){const t=new es,i=e.getAttribute("id");for(const s of e.childElements())switch(s.localName){case"Properties":this._parseNoteProperties(s,t,i);break;case"AntiAccent":s.innerText.toLowerCase()==="normal"&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=Se._parseIntSafe(s.innerText,-1),t.trillSpeed=M.Sixteenth;break;case"Accent":const a=Se._parseIntSafe(s.innerText,0);(a&1)!==0&&(t.isStaccato=!0),(a&4)!==0&&(t.accentuated=mi.Heavy),(a&8)!==0&&(t.accentuated=mi.Normal),(a&16)!==0&&(t.accentuated=mi.Tenuto);break;case"Tie":s.getAttribute("destination").toLowerCase()==="true"&&(t.isTieDestination=!0);break;case"Vibrato":switch(s.innerText){case"Slight":t.vibrato=ct.Slight;break;case"Wide":t.vibrato=ct.Wide;break}break;case"LeftFingering":switch(s.innerText){case"P":t.leftHandFinger=Fe.Thumb;break;case"I":t.leftHandFinger=Fe.IndexFinger;break;case"M":t.leftHandFinger=Fe.MiddleFinger;break;case"A":t.leftHandFinger=Fe.AnnularFinger;break;case"C":t.leftHandFinger=Fe.LittleFinger;break}break;case"RightFingering":switch(s.innerText){case"P":t.rightHandFinger=Fe.Thumb;break;case"I":t.rightHandFinger=Fe.IndexFinger;break;case"M":t.rightHandFinger=Fe.MiddleFinger;break;case"A":t.rightHandFinger=Fe.AnnularFinger;break;case"C":t.rightHandFinger=Fe.LittleFinger;break}break;case"InstrumentArticulation":t.percussionArticulation=Se._parseIntSafe(s.innerText,0);break;case"Ornament":switch(s.innerText){case"Turn":t.ornament=fi.Turn;break;case"InvertedTurn":t.ornament=fi.InvertedTurn;break;case"UpperMordent":t.ornament=fi.UpperMordent;break;case"LowerMordent":t.ornament=fi.LowerMordent;break}break}this._noteById.set(i,t)}_parseNoteProperties(e,t,i){let s=!1,a=null,o=null,c=null,h=null,d=null,p=-1,g=-1,y=!1;for(const k of e.childElements())switch(k.localName){case"Property":switch(k.getAttribute("name")){case"ShowStringNumber":k.findChildElement("Enable")&&(t.showStringNumber=!0);break;case"String":t.string=Se._parseIntSafe(k.findChildElement("String")?.innerText,0)+1;break;case"Fret":t.fret=Se._parseIntSafe(k.findChildElement("Fret")?.innerText,0);break;case"Element":p=Se._parseIntSafe(k.findChildElement("Element")?.innerText,0);break;case"Variation":g=Se._parseIntSafe(k.findChildElement("Variation")?.innerText,0);break;case"Tapped":this._tappedNotes.set(i,!0);break;case"HarmonicType":const w=k.findChildElement("HType");if(w)switch(w.innerText){case"NoHarmonic":t.harmonicType=Re.None;break;case"Natural":t.harmonicType=Re.Natural;break;case"Artificial":t.harmonicType=Re.Artificial;break;case"Pinch":t.harmonicType=Re.Pinch;break;case"Tap":t.harmonicType=Re.Tap;break;case"Semi":t.harmonicType=Re.Semi;break;case"Feedback":t.harmonicType=Re.Feedback;break}break;case"HarmonicFret":const T=k.findChildElement("HFret");T&&(t.harmonicValue=Se._parseFloatSafe(T.innerText,0));break;case"Muted":k.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":k.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=Se._parseIntSafe(k.findChildElement("Number")?.innerText,0),t.tone===-1&&(t.tone=0);break;case"Tone":t.tone=Se._parseIntSafe(k.findChildElement("Step")?.innerText,0);break;case"ConcertPitch":y||this._parseConcertPitch(k,t);break;case"TransposedPitch":t.accidentalMode=Ue.Default,this._parseConcertPitch(k,t),y=!0;break;case"Bended":s=!0;break;case"BendOriginValue":a||(a=new ke(0,0)),a.value=this._toBendValue(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendOriginOffset":a||(a=new ke(0,0)),a.offset=this._toBendOffset(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendMiddleValue":o=this._toBendValue(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset1":c=this._toBendOffset(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset2":h=this._toBendOffset(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendDestinationValue":d||(d=new ke(ke.MaxPosition,0)),d.value=this._toBendValue(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"BendDestinationOffset":d||(d=new ke(0,0)),d.offset=this._toBendOffset(Se._parseFloatSafe(k.findChildElement("Float")?.innerText,0));break;case"HopoOrigin":k.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":const x=Se._parseIntSafe(k.findChildElement("Flags")?.innerText,0);(x&1)!==0?t.slideOutType=$e.Shift:(x&2)!==0?t.slideOutType=$e.Legato:(x&4)!==0?t.slideOutType=$e.OutDown:(x&8)!==0&&(t.slideOutType=$e.OutUp),(x&16)!==0?t.slideInType=Ji.IntoFromBelow:(x&32)!==0&&(t.slideInType=Ji.IntoFromAbove),(x&64)!==0?t.slideOutType=$e.PickSlideDown:(x&128)!==0&&(t.slideOutType=$e.PickSlideUp);break}break}s&&(a||(a=new ke(0,0)),d||(d=new ke(ke.MaxPosition,0)),t.addBendPoint(a),c&&o&&t.addBendPoint(new ke(c,o)),h&&o&&t.addBendPoint(new ke(h,o)),!c&&!h&&o&&t.addBendPoint(new ke(ke.MaxPosition/2|0,o)),t.addBendPoint(d)),p!==-1&&g!==-1&&(t.percussionArticulation=$i.articulationFromElementVariation(p,g))}_parseConcertPitch(e,t){const i=e.findChildElement("Pitch");if(i)for(const s of i.childElements())switch(s.localName){case"Accidental":switch(s.innerText){case"x":t.accidentalMode=Ue.ForceDoubleSharp;break;case"#":t.accidentalMode=Ue.ForceSharp;break;case"b":t.accidentalMode=Ue.ForceFlat;break;case"bb":t.accidentalMode=Ue.ForceDoubleFlat;break}break}}_toBendValue(e){return e*Se._bendPointValueFactor|0}_toBendOffset(e){return e*Se._bendPointPositionFactor}_parseRhythms(e){for(const t of e.childElements())switch(t.localName){case"Rhythm":this._parseRhythm(t);break}}_parseRhythm(e){const t=new W5,i=e.getAttribute("id");t.id=i;for(const s of e.childElements())switch(s.localName){case"NoteValue":switch(s.innerText){case"Long":t.value=M.QuadrupleWhole;break;case"DoubleWhole":t.value=M.DoubleWhole;break;case"Whole":t.value=M.Whole;break;case"Half":t.value=M.Half;break;case"Quarter":t.value=M.Quarter;break;case"Eighth":t.value=M.Eighth;break;case"16th":t.value=M.Sixteenth;break;case"32nd":t.value=M.ThirtySecond;break;case"64th":t.value=M.SixtyFourth;break;case"128th":t.value=M.OneHundredTwentyEighth;break;case"256th":t.value=M.TwoHundredFiftySixth;break}break;case"PrimaryTuplet":t.tupletNumerator=Se._parseIntSafe(s.getAttribute("num"),-1),t.tupletDenominator=Se._parseIntSafe(s.getAttribute("den"),-1);break;case"AugmentationDot":t.dots=Se._parseIntSafe(s.getAttribute("count"),0);break}this._rhythmById.set(i,t)}_buildModel(){for(let s=0,a=this._masterBars.length;s<a;s++){const o=this._masterBars[s];this.score.addMasterBar(o)}const e=this._masterBars[this._masterBars.length-1];this._doubleBars.has(e)&&(this._doubleBars.delete(e),e.isDoubleBar=!1);const t=[];for(const s of this._tracksMapping){if(!s)continue;const a=this._tracksById.get(s);this.score.addTrack(a),t.push(s)}let i;for(const s of this._barsOfMasterBar){let a=0,o=0;i=[Xt.C,pn.Major],this._transposeKeySignaturePerTrack.has(t[0])&&(i=[ce.transposeKey(i[0],this._transposeKeySignaturePerTrack.get(t[0])),i[1]]);for(let c=0;c<s.length&&o<this.score.tracks.length;c++){const h=s[c];if(h!==Se._invalidId){const d=this._barsById.get(h),p=this.score.tracks[o],g=p.staves[a];g.addBar(d);const y=g.bars.length-1;if(this._keySignatures.has(y)&&(i=this._keySignatures.get(y),this._transposeKeySignaturePerTrack.has(t[o])&&(i=[ce.transposeKey(i[0],this._transposeKeySignaturePerTrack.get(t[o])),i[1]])),d.keySignature=i[0],d.keySignatureType=i[1],this._doubleBars.has(d.masterBar)&&(d.barLineRight=et.LightLight),this._voicesOfBar.has(h))for(const k of this._voicesOfBar.get(h))if(k!==Se._invalidId){const _=this._voiceById.get(k);if(d.addVoice(_),this._beatsOfVoice.has(k)){for(const w of this._beatsOfVoice.get(k))if(w!==Se._invalidId){const T=Tb.clone(this._beatById.get(w));_.addBeat(T);const x=this._rhythmOfBeat.get(w),E=this._rhythmById.get(x);if(T.duration=E.value,T.dots=E.dots,T.tupletNumerator=E.tupletNumerator,T.tupletDenominator=E.tupletDenominator,this._notesOfBeat.has(w)){for(const N of this._notesOfBeat.get(w))if(N!==Se._invalidId){const v=Wx.clone(this._noteById.get(N));g.isPercussion?(v.fret=-1,v.string=-1):v.percussionArticulation=-1,T.addNote(v),this._tappedNotes.has(N)&&(T.tap=!0)}}}}}else{const _=new An;d.addVoice(_);const w=new fs;w.isEmpty=!0,w.duration=M.Quarter,_.addBeat(w)}a===p.staves.length-1?(o++,a=0):a++,i=[Xt.C,pn.Major],o<t.length&&this._transposeKeySignaturePerTrack.has(t[o])&&(i=[ce.transposeKey(i[0],this._transposeKeySignaturePerTrack.get(t[o])),i[1]])}else o++}}for(const s of this._tracksMapping){if(!s)continue;const a=this._tracksById.get(s);let o=!1;for(const c of a.staves)if(c.isPercussion){o=!0;break}if(o||(a.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(s)){const c=this._automationsPerTrackIdAndBarIndex.get(s);for(const[h,d]of c)if(a.staves.length>0&&h<a.staves[0].bars.length){const p=a.staves[0].bars[h];if(p.voices.length>0&&p.voices[0].beats.length>0){const g=p.voices[0].beats[0];for(const y of d)y.type===Mt.Bank&&y.value===0&&p.index===0||g.automations.push(y)}}}if(this._sustainPedalsPerTrackIdAndBarIndex.has(s)){const c=this._sustainPedalsPerTrackIdAndBarIndex.get(s);for(const[h,d]of c)if(a.staves.length>0&&h<a.staves[0].bars.length){const p=a.staves[0].bars[h];p.sustainPedals=d}}}for(const[s,a]of this._masterTrackAutomations){const o=this.score.masterBars[s];for(let c=0,h=a.length;c<h;c++){const d=a[c];switch(d.type){case Mt.Tempo:o.tempoAutomations.push(d);break;case Mt.SyncPoint:d.syncPointValue.millisecondOffset-=this._backingTrackPadding,o.addSyncPoint(d);break}}}}}class l0{isMultiRest=!1;trackViewGroups=[]}class BB{showNumbered=!1;showSlash=!1;showStandardNotation=!1;showTablature=!1}class Yx{scoreViews=[];apply(e){if(this.scoreViews.length>0){let t=0;e.stylesheet.multiTrackMultiBarRest=this.scoreViews[0].isMultiRest;for(const i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const s=e.tracks[t];for(const a of s.staves)a.isPercussion||(a.showTablature=i.showTablature),a.showStandardNotation=i.showStandardNotation,a.showSlash=i.showSlash,a.showNumbered=i.showNumbered}t++}for(let i=1;i<this.scoreViews.length;i++)this.scoreViews[i].isMultiRest&&(e.stylesheet.perTrackMultiBarRest||(e.stylesheet.perTrackMultiBarRest=new Set),t=i-1,e.stylesheet.perTrackMultiBarRest.add(t))}}constructor(e){const t=ss.fromBuffer(e),i=U.readInt32BE(t);for(let s=0;s<i;s++){const a=new l0;this.scoreViews.push(a),a.isMultiRest=Nt.gpReadBool(t);const o=U.readInt32BE(t);for(let c=0;c<o;c++){let h=t.readByte();h===0&&(h=1);const d=new BB;d.showStandardNotation=(h&1)!==0,d.showTablature=(h&2)!==0,d.showSlash=(h&4)!==0,d.showNumbered=(h&8)!==0,a.trackViewGroups.push(d)}}}static writeForScore(e){const t=ss.withCapacity(128),i=[new l0];i[0].isMultiRest=e.stylesheet.multiTrackMultiBarRest;for(const s of e.tracks){const a=new BB;a.showStandardNotation=s.staves[0].showStandardNotation,a.showTablature=s.staves[0].showTablature,a.showSlash=s.staves[0].showSlash,a.showNumbered=s.staves[0].showNumbered,i[0].trackViewGroups.push(a);const o=new l0;o.isMultiRest=e.stylesheet.perTrackMultiBarRest?.has(s.index)===!0,o.trackViewGroups.push(a),i.push(o)}U.writeInt32BE(t,i.length);for(const s of i){t.writeByte(s.isMultiRest?1:0),U.writeInt32BE(t,s.trackViewGroups.length);for(const a of s.trackViewGroups){let o=0;a.showStandardNotation&&(o=o|1),a.showTablature&&(o=o|2),a.showSlash&&(o=o|4),a.showNumbered&&(o=o|8),t.writeByte(o)}}return U.writeInt32BE(t,1),t.toArray()}}class H5{trackViewGroups=[]}class z5{isVisible=!1}var W0;(function(n){n[n.PageVertical=0]="PageVertical",n[n.PageGrid=1]="PageGrid",n[n.PageParchment=2]="PageParchment",n[n.ScreenVertical=3]="ScreenVertical",n[n.ScreenHorizontal=4]="ScreenHorizontal",n[n.PageHorizontal=5]="PageHorizontal"})(W0||(W0={}));class $x{zoomLevel=4;view=W0.PageVertical;muiltiVoiceCursor=!1;scoreViews=[];constructor(e,t){const i=ss.fromBuffer(t);this.zoomLevel=U.readInt32BE(i),this.view=i.readByte(),this.muiltiVoiceCursor=i.readByte()!==0;const s=e.scoreViews.length;for(let a=0;a<s;a++){const o=new H5;this.scoreViews.push(o);const c=e.scoreViews[a];for(let h=0;h<c.trackViewGroups.length;h++){const d=new z5;d.isVisible=i.readByte()!==0,o.trackViewGroups.push(d)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(const i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const s=e.tracks[t];s.isVisibleOnMultiTrack=i.isVisible}t++}}}static writeForScore(e){const t=ss.withCapacity(128);U.writeInt32BE(t,4),t.writeByte(0);const i=e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice;t.writeByte(i?255:0);for(const s of e.tracks)t.writeByte(s.isVisibleOnMultiTrack?255:0);for(const s of e.tracks)t.writeByte(255);return t.toArray()}}class G5 extends lu{get name(){return"Guitar Pro 7-8"}readScore(){ee.debug(this.name,"Loading ZIP entries");const e=new Eb(this.data);let t;try{t=e.read()}catch(g){throw new is("No Zip archive",g)}ee.debug(this.name,"Zip entries loaded");let i=null,s=null,a=null,o=null;const c=new Map;for(const g of t)switch(c.set(g.fullName,g),g.fileName){case"score.gpif":i=U.toString(g.data,this.settings.importer.encoding);break;case"BinaryStylesheet":s=g.data;break;case"PartConfiguration":a=g.data;break;case"LayoutConfiguration":o=g.data;break}if(!i)throw new is("No score.gpif found in zip archive");ee.debug(this.name,"Start Parsing score.gpif");const h=new Se;h.loadAsset=g=>{if(c.has(g))return c.get(g).data},h.parseXml(i,this.settings),ee.debug(this.name,"score.gpif parsed");const d=h.score;s&&(ee.debug(this.name,"Start Parsing BinaryStylesheet"),new zn(s).apply(d),ee.debug(this.name,"BinaryStylesheet parsed"));let p=null;return a&&(ee.debug(this.name,"Start Parsing Part Configuration"),p=new Yx(a),p.apply(d),ee.debug(this.name,"Part Configuration parsed")),o&&p!=null&&(ee.debug(this.name,"Start Parsing Layout Configuration"),new $x(p,o).apply(d),ee.debug(this.name,"Layout Configuration parsed")),d}}class V0 extends Ht{constructor(){super(It.Format,"Unexpected end of data within reader")}}class rp{static _byteSize=8;_currentByte=0;_position=rp._byteSize;_source;constructor(e){this._source=e}readByte(){return this.readBits(8)}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte()&255;return t}readBits(e){let t=0,i=e-1;for(;i>=0;)t=t|this.readBit()<<i,i--;return t}readBitsReversed(e){let t=0;for(let i=0;i<e;i++)t=t|this.readBit()<<i;return t}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),this._currentByte===-1)throw new V0;this._position=0}const e=this._currentByte>>rp._byteSize-this._position-1&1;return this._position++,e}readAll(){const e=ss.empty();try{for(;;)e.writeByte(this.readByte()&255)}catch(t){if(!(t instanceof V0))throw t}return e.toArray()}}class U5{fileName="";fileSize=0;data=null}class Y5{static HeaderBcFs="BCFS";static HeaderBcFz="BCFZ";fileFilter;files=[];constructor(){this.files=[],this.fileFilter=e=>!0}load(e){const t=new rp(e);this._readBlock(t)}readHeader(e){return this._getString(e.readBytes(4),0,4)}decompress(e,t=!1){const i=ss.empty();let s;const a=this._getInteger(e.readBytes(4),0);try{for(;i.length<a;)if(e.readBits(1)===1){const g=e.readBits(4),y=e.readBitsReversed(g),k=e.readBitsReversed(g),_=i.length-y,w=Math.min(y,k);s=i.getBuffer(),i.write(s,_,w)}else{const g=e.readBitsReversed(2);for(let y=0;y<g;y++)i.writeByte(e.readByte())}}catch(p){if(!(p instanceof V0))throw p}s=i.getBuffer();const o=t?4:0,c=i.length-o,h=new Uint8Array(c),d=c;return h.set(s.subarray(o,o+d),0),h}_readBlock(e){const t=this.readHeader(e);if(t==="BCFZ")this._readUncompressedBlock(this.decompress(e,!0));else if(t==="BCFS")this._readUncompressedBlock(e.readAll());else throw new is("Unsupported format")}_readUncompressedBlock(e){let i=4096;for(;i+3<e.length;){if(this._getInteger(e,i)===2){const a=new U5;a.fileName=this._getString(e,i+4,127),a.fileSize=this._getInteger(e,i+140);const o=!this.fileFilter||this.fileFilter(a.fileName);o&&this.files.push(a);const c=i+148;let h=0,d=0;const p=o?ss.withCapacity(a.fileSize):null;for(;h=this._getInteger(e,c+4*d++),h!==0;)i=h*4096,o&&p.write(e,i,4096);if(o){a.data=new Uint8Array(Math.min(a.fileSize,p.length));const g=p.toArray();a.data.set(g.subarray(0,0+a.data.length),0)}}i+=4096}}_getString(e,t,i){let s="";for(let a=0;a<i;a++){const o=e[t+a]&255;if(o===0)break;s+=String.fromCharCode(o)}return s}_getInteger(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}}class $5 extends lu{get name(){return"Guitar Pro 6"}readScore(){ee.debug(this.name,"Loading GPX filesystem");const e=new Y5;e.fileFilter=d=>d.endsWith("score.gpif")||d.endsWith("BinaryStylesheet")||d.endsWith("PartConfiguration")||d.endsWith("LayoutConfiguration"),e.load(this.data),ee.debug(this.name,"GPX filesystem loaded");let t=null,i=null,s=null,a=null;for(const d of e.files)switch(d.fileName){case"score.gpif":t=U.toString(d.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=d.data;break;case"PartConfiguration":s=d.data;break;case"LayoutConfiguration":a=d.data;break}if(!t)throw new is("No score.gpif found in GPX");ee.debug(this.name,"Start Parsing score.gpif");const o=new Se;o.parseXml(t,this.settings),ee.debug(this.name,"score.gpif parsed");const c=o.score;i&&(ee.debug(this.name,"Start Parsing BinaryStylesheet"),new zn(i).apply(c),ee.debug(this.name,"BinaryStylesheet parsed"));let h=null;return s&&(ee.debug(this.name,"Start Parsing Part Configuration"),h=new Yx(s),h.apply(c),ee.debug(this.name,"Part Configuration parsed")),a&&h!=null&&(ee.debug(this.name,"Start Parsing Layout Configuration"),new $x(h,a).apply(c),ee.debug(this.name,"Layout Configuration parsed")),c}}class X5{maxLine=-1e3;maxLineNote=null;minLine=-1e3;minLineNote=null}class Gs{_bar;_barRenderer;static _stepsPerOctave=7;static _octaveSteps=[38,32,30,26,38];static sharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6];static flatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6];_registeredAccidentals=new Map;_appliedScoreLines=new Map;_appliedScoreLinesByValue=new Map;_notesByValue=new Map;_beatLines=new Map;maxLineBeat=null;minLineBeat=null;maxLine=-1e3;minLine=-1e3;constructor(e){this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,t){return t<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[t].staffLine:$i.getArticulationByInputMidiNumber(t)?.staffLine??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let t=e.displayValue;switch(e.accidentalMode){case Ue.ForceDoubleFlat:t+=2;break;case Ue.ForceDoubleSharp:t-=2;break;case Ue.ForceFlat:t+=1;break;case Ue.ForceSharp:t-=1;break}return t}applyAccidental(e){const t=Gs.getNoteValue(e),i=e.hasQuarterToneOffset;return this._getAccidental(t,i,e.beat,!1,e)}applyAccidentalForValue(e,t,i,s){return this._getAccidental(t,i,e,s,null)}static computeLineWithoutAccidentals(e,t){let i=0;const s=Gs.getNoteValue(t);return t.isPercussion?i=Gs.getPercussionLine(e,s):i=Gs.calculateNoteSteps(e.keySignature,e.clef,s),i}_getAccidental(e,t,i,s,a=null){let o=0,c=Le.None;if(a!=null?a.isPercussion:this._bar.staff.isPercussion)o=Gs.getPercussionLine(this._bar,e);else{const d=a?a.accidentalMode:Ue.Default;o=Gs.calculateNoteSteps(this._bar.keySignature,this._bar.clef,e);const p=this._registeredAccidentals.has(o)?this._registeredAccidentals.get(o):null;c=ce.computeAccidental(this._bar.keySignature,d,e,t,p);let g=!1;switch(c){case Le.NaturalQuarterNoteUp:case Le.SharpQuarterNoteUp:case Le.FlatQuarterNoteUp:break;default:if(a&&a.isTieDestination&&a.beat.index===0){const y=this._barRenderer.scoreRenderer.layout?.getRendererForBar(this._barRenderer.staff.staffId,a.tieOrigin.beat.voice.bar);y&&y.staff===this._barRenderer.staff&&y.accidentalHelper.getNoteLine(a.tieOrigin)===o&&(g=!0)}g?c=Le.None:c!==Le.None&&this._registeredAccidentals.set(o,c);break}}return a?(this._appliedScoreLines.set(a.id,o),this._notesByValue.set(e,a)):this._appliedScoreLinesByValue.set(e,o),(this.minLine===-1e3||this.minLine<o)&&(this.minLine=o,this.minLineBeat=i),(this.maxLine===-1e3||this.maxLine>o)&&(this.maxLine=o,this.maxLineBeat=i),s||this._registerLine(i,o,a),c}_registerLine(e,t,i){let s;this._beatLines.has(e.id)?s=this._beatLines.get(e.id):(s=new X5,this._beatLines.set(e.id,s)),(s.minLine===-1e3||t<s.minLine)&&(s.minLine=t,s.minLineNote=i),(s.minLine===-1e3||t>s.maxLine)&&(s.maxLine=t,s.maxLineNote=i)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMaxLineNote(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLineNote:null}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}getMinLineNote(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLineNote:null}static calculateNoteSteps(e,t,i){const s=i,a=e,o=t,c=s%12,h=(s/12|0)-1;let d=Gs._octaveSteps[o];d-=h*Gs._stepsPerOctave;const p=ce.keySignatureIsSharp(a)||ce.keySignatureIsNatural(a)?Gs.sharpNoteSteps:Gs.flatNoteSteps;return d-=p[c],d}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,t=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):t&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}class q5{slurStarts;currentDynamics=Oe.F;tieStarts;tieStartIds;slideOrigins=new Map;transpose=0;isExplicitlyBeamed=!1;constructor(){this.tieStarts=new Set,this.tieStartIds=new Map,this.slideOrigins=new Map,this.slurStarts=new Map}}class J5 extends Pe{outputMidiChannel=-1;outputMidiProgram=-1;outputMidiBank=-1;outputVolume=-1;outputBalance=-1}class Mb{track;firstArticulation;instruments=new Map;_instrumentIdToArticulationIndex=new Map;_lyricsLine=0;_lyricsLines=new Map;constructor(e){this.track=e}getLyricLine(e){if(this._lyricsLines.has(e))return this._lyricsLines.get(e);const t=this._lyricsLine;return this._lyricsLines.set(e,t),this._lyricsLine++,t}static _defaultNoteArticulation=new Pe("Default",0,0,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole);getOrCreateArticulation(e,t){const i=t.octave*12+t.tone,s=`${e}_${i}`;if(this._instrumentIdToArticulationIndex.has(s))return this._instrumentIdToArticulationIndex.get(s);let a;this.instruments.has(e)?a=this.instruments.get(e):a=Mb._defaultNoteArticulation;const o=this.track.percussionArticulations.length,c=t.beat.voice.bar;let h;i===0?h=4:h=Gs.calculateNoteSteps(c.keySignature,c.clef,i);const g=9-(t.beat.voice.bar.staff.standardNotationLineCount*2-1),y=h-g,k=new Pe(a.elementType,y,a.outputMidiNumber,a.noteHeadDefault,a.noteHeadHalf,a.noteHeadWhole,a.techniqueSymbol,a.techniqueSymbolPlacement);return this._instrumentIdToArticulationIndex.set(s,o),this.track.percussionArticulations.push(k),o}}class Qt extends lu{_score;_idToTrackInfo=new Map;_indexToTrackInfo=new Map;_staffToContext=new Map;_divisionsPerQuarterNote=1;_currentDynamics=Oe.F;get name(){return"MusicXML"}readScore(){const e=this._extractMusicXml(),t=new Vh;try{t.parse(e)}catch(i){throw new is("Unsupported format",i)}return this._score=new Qa,this._score.stylesheet.hideDynamics=!0,this._parseDom(t),ce.consolidate(this._score),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}_extractMusicXml(){const e=new Eb(this.data);let t;try{t=e.read()}catch{t=[]}if(t.length===0)return this.data.reset(),U.toString(this.data.readAll(),this.settings.importer.encoding);const i=t.find(d=>d.fullName==="META-INF/container.xml");if(!i)throw new is("No compressed MusicXML");const s=new Vh;try{s.parse(U.toString(i.data,this.settings.importer.encoding))}catch(d){throw new is("Malformed container.xml, could not parse as XML",d)}const a=s.firstElement;if(!a||a.localName!=="container")throw new is("Malformed container.xml, root element not 'container'");const o=a.findChildElement("rootfiles");if(!o)throw new is("Malformed container.xml, 'container/rootfiles' not found");let c="";for(const d of o.childElements())if(d.localName==="rootfile"){c=d.getAttribute("full-path");break}if(!c)throw new is("Unsupported compressed MusicXML, missing rootfile");const h=t.find(d=>d.fullName===c);if(!h)throw new is(`Malformed container.xml, '${c}' not contained in zip`);return U.toString(h.data,this.settings.importer.encoding)}_parseDom(e){const t=e.firstElement;if(!t)throw new is("Unsupported format");switch(t.localName){case"score-partwise":this._parsePartwise(t);break;case"score-timewise":this._parseTimewise(t);break;default:throw new is("Unsupported format")}}_parsePartwise(e){for(const t of e.childElements())switch(t.localName){case"credit":this._parseCredit(t);break;case"identification":this._parseIdentification(t);break;case"movement-title":this._parseMovementTitle(t);break;case"part":this._parsePartwisePart(t);break;case"part-list":this._parsePartList(t);break;case"work":this._parseWork(t);break}}_parseTimewise(e){let t=0;for(const i of e.childElements())switch(i.localName){case"credit":this._parseCredit(i);break;case"identification":this._parseIdentification(i);break;case"movement-title":this._parseMovementTitle(i);break;case"part-list":this._parsePartList(i);break;case"work":this._parseWork(i);break;case"measure":this._parseTimewiseMeasure(i,t),t++;break}}_parseCredit(e){if(e.getAttribute("page","1")!=="1")return;const t=[];let i=null,s="";for(const a of e.childElements())switch(a.localName){case"credit-type":t.push(a.innerText);break;case"credit-words":i===null&&(i=a),s+=a.innerText;break}if(t.length>0)for(const a of t)switch(a){case"title":this._score.title=Qt._sanitizeDisplay(s);break;case"subtitle":this._score.subTitle=Qt._sanitizeDisplay(s);break;case"composer":this._score.artist=Qt._sanitizeDisplay(s);break;case"arranger":this._score.artist=Qt._sanitizeDisplay(s);break;case"lyricist":this._score.words=Qt._sanitizeDisplay(s);break;case"rights":this._score.copyright=Qt._sanitizeDisplay(s);break}else if(i){const a=i.getAttribute("font-size","0"),o=i.getAttribute("font-size","top"),c=i.getAttribute("halign","left");if(o==="top"){if(s.includes("copyright")||s.includes("Copyright")||s.includes("")||s.includes("(c)")||s.includes("(C)")){this._score.copyright=Qt._sanitizeDisplay(s);return}if(c==="center"||a==="center"){if(this._score.title.length===0){this._score.title=Qt._sanitizeDisplay(s);return}if(this._score.subTitle.length===0){this._score.subTitle=Qt._sanitizeDisplay(s);return}if(this._score.album.length===0){this._score.album=Qt._sanitizeDisplay(s);return}}else if((c==="right"||a==="right")&&this._score.music.length===0){this._score.music=Qt._sanitizeDisplay(s);return}if(this._score.artist.length===0){this._score.artist=Qt._sanitizeDisplay(s);return}if(this._score.words.length===0){this._score.words=Qt._sanitizeDisplay(s);return}}}}static _sanitizeDisplay(e){return e.replaceAll("\r","").replaceAll(`
`," ").replaceAll("	","").replaceAll(" ","")}_parseIdentification(e){for(const t of e.childElements())switch(t.localName){case"creator":if(t.attributes.has("type"))switch(t.attributes.get("type")){case"composer":this._score.artist=Qt._sanitizeDisplay(t.innerText);break;case"lyricist":this._score.words=Qt._sanitizeDisplay(t.innerText);break;case"arranger":this._score.music=Qt._sanitizeDisplay(t.innerText);break}else this._score.artist=Qt._sanitizeDisplay(t.innerText);break;case"rights":this._score.copyright.length>0&&(this._score.copyright+=", "),this._score.copyright+=t.innerText,t.attributes.has("type")&&(this._score.copyright+=` (${t.attributes.get("type")})`);break;case"encoding":this._parseEncoding(t);break}}_parseEncoding(e){for(const t of e.childElements())switch(t.localName){case"encoder":this._score.tab.length>0&&(this._score.tab+=", "),this._score.tab+=t.innerText,t.attributes.has("type")&&(this._score.tab+=` (${t.attributes.get("type")})`);break;case"encoding-description":this._score.notices+=Qt._sanitizeDisplay(t.innerText);break}}_parseMovementTitle(e){this._score.title.length===0?this._score.title=Qt._sanitizeDisplay(e.innerText):this._score.subTitle=Qt._sanitizeDisplay(e.innerText)}_parsePartList(e){for(const t of e.childElements())switch(t.localName){case"score-part":this._parseScorePart(t);break}}_parseScorePart(e){const t=new Za;t.ensureStaveCount(1),this._score.addTrack(t);const i=e.attributes.get("id"),s=new Mb(t);this._idToTrackInfo.set(i,s),this._indexToTrackInfo.set(t.index,s);for(const a of e.childElements())switch(a.localName){case"part-name":t.name=Qt._sanitizeDisplay(a.innerText);break;case"part-name-display":t.name=this._parsePartDisplayAsText(a);break;case"part-abbreviation":t.shortName=Qt._sanitizeDisplay(a.innerText);break;case"part-abbreviation-display":t.shortName=this._parsePartDisplayAsText(a);break;case"score-instrument":this._parseScoreInstrument(a,s);break;case"midi-device":a.attributes.has("port")&&(t.playbackInfo.port=Number.parseInt(a.attributes.get("port"),10));break;case"midi-instrument":this._parseScorePartMidiInstrument(a,s);break}s.firstArticulation&&(s.firstArticulation.outputMidiProgram>=0&&(t.playbackInfo.program=s.firstArticulation.outputMidiProgram),s.firstArticulation.outputMidiBank>=0&&(t.playbackInfo.bank=s.firstArticulation.outputMidiBank),s.firstArticulation.outputBalance>=0&&(t.playbackInfo.balance=s.firstArticulation.outputBalance),s.firstArticulation.outputVolume>=0&&(t.playbackInfo.volume=s.firstArticulation.outputVolume),s.firstArticulation.outputMidiChannel>=0&&(t.playbackInfo.primaryChannel=s.firstArticulation.outputMidiChannel,t.playbackInfo.secondaryChannel=s.firstArticulation.outputMidiChannel))}_parseScoreInstrument(e,t){const i=new J5;t.firstArticulation||(t.firstArticulation=i),t.instruments.set(e.getAttribute("id",""),i)}_parseScorePartMidiInstrument(e,t){const i=e.getAttribute("id","");if(!t.instruments.has(i))return;const s=t.instruments.get(i);for(const a of e.childElements())switch(a.localName){case"midi-channel":s.outputMidiChannel=Number.parseInt(a.innerText,10)-1;break;case"midi-bank":s.outputMidiBank=Number.parseInt(a.innerText,10)-1;break;case"midi-program":s.outputMidiProgram=Number.parseInt(a.innerText,10)-1;break;case"midi-unpitched":s.outputMidiNumber=Number.parseInt(a.innerText,10)-1;break;case"volume":s.outputVolume=Qt._interpolatePercent(Number.parseFloat(a.innerText));break;case"pan":s.outputBalance=Qt._interpolatePan(Number.parseFloat(a.innerText));break}}static _interpolatePercent(e){return Qt._interpolate(0,100,0,16,e)|0}static _interpolatePan(e){return Qt._interpolate(-90,90,0,16,e)|0}static _interpolate(e,t,i,s,a){const o=(a-e)/(t-e);return i+(s-i)*o}_parsePartDisplayAsText(e){let t="";for(const i of e.childElements())switch(i.localName){case"display-text":t+=i.innerText;break;case"accidental-text":switch(i.innerText){case"sharp":t+="";break;case"natural":t+="";break;case"flat":t+="";break;case"double-sharp":t+="";break;case"sharp-sharp":t+="";break;case"flat-flat":t+="";break;case"natural-sharp":t+="";break;case"natural-flat":t+="";break;case"sharp-down":t+="";break;case"sharp-up":t+="";break;case"natural-down":t+="";break;case"natural-up":t+="";break;case"flat-down":t+="";break;case"flat-up":t+="";break;case"arrow-down":t+="";break;case"arrow-up":t+="";break;case"triple-sharp":t+="";break;case"triple-flat":t+="";break;case"sharp-1":t+="";break;case"sharp-2":t+="";break;case"sharp-3":t+="";break;case"sharp-4":t+="";break;case"sharp-5":t+="";break;case"flat-1":t+="";break;case"flat-2":t+="";break;case"flat-3":t+="";break;case"flat-4":t+="";break;case"flat-5":t+="";break}break}return Qt._sanitizeDisplay(t)}_parseWork(e){for(const t of e.childElements())switch(t.localName){case"work-title":this._score.title=Qt._sanitizeDisplay(t.innerText);break}}_parsePartwisePart(e){const t=e.attributes.get("id");if(!t||!this._idToTrackInfo.has(t))return;const i=this._idToTrackInfo.get(t).track;let s=0;for(const a of e.childElements())switch(a.localName){case"measure":this._parsePartwiseMeasure(a,i,s),s++;break}}_parsePartwiseMeasure(e,t,i){const s=this._getOrCreateMasterBar(e,i);this._parsePartMeasure(e,s,t)}_parseTimewiseMeasure(e,t){const i=this._getOrCreateMasterBar(e,t);for(const s of e.childElements())switch(s.localName){case"part":this._parseTimewisePart(s,i);break}}_getOrCreateMasterBar(e,t){const i=e.attributes.get("implicit")==="yes";for(;this._score.masterBars.length<=t;){const a=new Ka;i&&(a.isAnacrusis=!0),this._score.addMasterBar(a),a.index>0&&(a.timeSignatureDenominator=a.previousMasterBar.timeSignatureDenominator,a.timeSignatureNumerator=a.previousMasterBar.timeSignatureNumerator,a.tripletFeel=a.previousMasterBar.tripletFeel)}return this._score.masterBars[t]}_parseTimewisePart(e,t){const i=e.attributes.get("id");if(!i||!this._idToTrackInfo.has(i))return;const s=this._idToTrackInfo.get(i).track;this._parsePartMeasure(e,t,s)}_musicalPosition=0;_lastBeat=null;_parsePartMeasure(e,t,i){this._musicalPosition=0,this._lastBeat=null,t.alternateEndings=this._nextMasterBarRepeatEnding;const s=[];for(const o of e.childElements())switch(o.localName){case"note":this._parseNote(o,t,i);break;case"backup":this._parseBackup(o);break;case"forward":this._parseForward(o);break;case"direction":this._parseDirection(o,t,i);break;case"attributes":this._parseAttributes(o,t,i);break;case"harmony":this._parseHarmony(o,i);break;case"print":this._parsePrint(o,t,i);break;case"sound":this._parseSound(o,t,i);break;case"barline":s.push(o);break}for(const o of s)this._parseBarLine(o,t,i);this._applySimileMarks(t,i);const a=this._getOrCreateStaff(i,0);this._getOrCreateBar(a,t),this._keyAllStaves=null}_parsePrint(e,t,i){(e.getAttribute("new-system","no")==="yes"||e.getAttribute("new-page","no")==="yes")&&i.addLineBreaks(t.index)}_applySimileMarks(e,t){if(this._simileMarkAllStaves!==null){for(const i of t.staves){const s=this._getOrCreateBar(i,e);s.simileMark=this._simileMarkAllStaves,s.simileMark!==rs.None&&this._clearBar(s)}this._simileMarkAllStaves===rs.FirstOfDouble?this._simileMarkAllStaves=rs.SecondOfDouble:this._simileMarkAllStaves=null}if(this._simileMarkPerStaff!==null){const i=Array.from(this._simileMarkPerStaff.keys());for(const s of i){const a=this._getOrCreateStaff(t,s),o=this._getOrCreateBar(a,e);o.simileMark=this._simileMarkPerStaff.get(s),o.simileMark!==rs.None&&this._clearBar(o),o.simileMark===rs.FirstOfDouble?this._simileMarkPerStaff.set(s,rs.SecondOfDouble):this._simileMarkPerStaff.delete(s)}this._simileMarkPerStaff.size===0&&(this._simileMarkPerStaff=null)}}_clearBar(e){for(const t of e.voices){const i=new fs;i.isEmpty=!0,t.addBeat(i)}}_parseBarLine(e,t,i){for(const s of e.childElements())switch(s.localName){case"bar-style":this._parseBarStyle(s,t,i,e.getAttribute("location","right"));break;case"ending":this._parseEnding(s,t);break;case"repeat":this._parseRepeat(s,t);break}}_parseRepeat(e,t){const i=e.getAttribute("direction");let s=Number.parseInt(e.getAttribute("times"),10);(s<0||Number.isNaN(s))&&(s=2),i==="backward"?t.repeatCount=s:i==="forward"&&(t.isRepeatStart=!0)}_nextMasterBarRepeatEnding=0;_parseEnding(e,t){const i=e.getAttribute("number").split(",").map(a=>Number.parseInt(a,10));let s=0;for(const a of i)s=s|1<<a-1&255;switch(t.alternateEndings=s,e.getAttribute("type","")){case"start":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding|s;break;case"stop":case"discontinue":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding&~s;break}}_parseBarStyle(e,t,i,s){let a=et.Automatic;switch(e.innerText){case"dashed":a=et.Dashed;break;case"dotted":a=et.Dotted;break;case"heavy":a=et.Heavy;break;case"heavy-heavy":a=et.HeavyHeavy;break;case"heavy-light":a=et.HeavyLight;break;case"light-heavy":a=et.LightHeavy;break;case"light-light":a=et.LightLight;break;case"none":a=et.None;break;case"regular":a=et.Regular;break;case"short":a=et.Short;break;case"tick":a=et.Tick;break}for(const o of i.staves){const c=this._getOrCreateBar(o,t);switch(s){case"left":c.barLineLeft=a;break;case"right":c.barLineRight=a;break}}}_parseSound(e,t,i){for(const s of e.childElements())switch(s.localName){case"midi-instrument":this._parseSoundMidiInstrument(s,t);break;case"swing":this._parseSwing(s,t);break}if(e.attributes.has("coda")&&t.addDirection(Te.TargetCoda),e.attributes.has("tocoda")&&t.addDirection(Te.JumpDaCoda),e.attributes.has("dacapo")&&t.addDirection(Te.JumpDaCapo),e.attributes.has("dalsegno")&&t.addDirection(Te.JumpDalSegno),e.attributes.has("fine")&&t.addDirection(Te.TargetFine),e.attributes.has("segno")&&t.addDirection(Te.TargetSegno),e.attributes.has("pan")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const s=new jt;s.type=Mt.Balance,s.value=Qt._interpolatePan(Number.parseFloat(e.attributes.get("pan"))),this._nextBeatAutomations.push(s)}if(e.attributes.has("tempo")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const s=new jt;s.type=Mt.Tempo,s.value=Qt._interpolatePercent(Number.parseFloat(e.attributes.get("tempo"))),this._nextBeatAutomations.push(s)}}_parseSwing(e,t){let i=0,s=0,a=null;for(const o of e.childElements())switch(o.localName){case"straight":t.tripletFeel=yt.NoTripletFeel;return;case"first":i=Number.parseInt(o.innerText,10);break;case"second":s=Number.parseInt(o.innerText,10);break;case"swing-type":a=this._parseBeatDuration(o);break}a||(a=M.Eighth),a===M.Eighth?i===2&&s===1?t.tripletFeel=yt.Triplet8th:i===3&&s===1?t.tripletFeel=yt.Dotted8th:i===1&&s===3&&(t.tripletFeel=yt.Scottish8th):a===M.Sixteenth&&(i===2&&s===1?t.tripletFeel=yt.Triplet16th:i===3&&s===1?t.tripletFeel=yt.Dotted16th:i===1&&s===3&&(t.tripletFeel=yt.Scottish16th))}_nextBeatAutomations=null;_nextBeatChord=null;_nextBeatCrescendo=null;_nextBeatLetRing=!1;_nextBeatPalmMute=!1;_nextBeatOttavia=null;_nextBeatText=null;_parseSoundMidiInstrument(e,t){let i;for(const s of e.childElements())switch(s.localName){case"midi-bank":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new jt,i.type=Mt.Bank,i.value=Number.parseInt(s.innerText,10)-1,this._nextBeatAutomations.push(i);break;case"midi-program":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new jt,i.type=Mt.Instrument,i.value=Number.parseInt(s.innerText,10)-1,this._nextBeatAutomations.push(i);break;case"volume":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new jt,i.type=Mt.Volume,i.value=Qt._interpolatePercent(Number.parseFloat(s.innerText)),this._nextBeatAutomations.push(i);break;case"pan":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new jt,i.type=Mt.Balance,i.value=Qt._interpolatePan(Number.parseFloat(s.innerText)),this._nextBeatAutomations.push(i);break}}_parseHarmony(e,t){const i=new so;let s=!1,a="";for(const o of e.childElements())switch(o.localName){case"root":i.name=this._parseHarmonyRoot(o);break;case"kind":i.name=i.name+this._parseHarmonyKind(o),o.getAttribute("parentheses-degrees","no")==="yes"&&(s=!0);break;case"frame":this._parseHarmonyFrame(o,i);break;case"degree":a+=this._parseDegree(o);break}a&&(i.name+=s?`(${a})`:a),this._nextBeatChord===null&&(this._nextBeatChord=i)}_parseDegree(e){let t="",i="",s="";for(const a of e.childElements())switch(a.localName){case"degree-value":t=a.innerText;break;case"degree-alter":switch(a.innerText){case"-1":i="";break;case"1":i="";break}break;case"degree-type":s+=a.getAttribute("text","");break}return`${s}${i}${t}`}_parseHarmonyRoot(e){let t="",i="";for(const s of e.childElements())switch(s.localName){case"root-step":t=s.innerText;break;case"root-alter":switch(Number.parseFloat(s.innerText)){case-2:i="bb";break;case-1:i="b";break;case 0:i="";break;case 1:i="#";break;case 2:i="##";break}break}return t+i}_parseHarmonyKind(e){const t=e.getAttribute("text");let i="";if(t)i=t;else{const s=e.innerText;switch(s){case"major":i="";break;case"minor":i="m";break;case"augmented":i="+";break;case"diminished":i="";break;case"dominant":i="7";break;case"major-seventh":i="7M";break;case"minor-seventh":i="m7";break;case"diminished-seventh":i="7";break;case"augmented-seventh":i="+7";break;case"half-diminished":i="";break;case"major-minor":i="mMaj";break;case"major-sixth":i="maj6";break;case"minor-sixth":i="m6";break;case"dominant-ninth":i="9";break;case"major-ninth":i="maj9";break;case"minor-ninth":i="m9";break;case"dominant-11th":i="11";break;case"major-11th":i="maj11";break;case"minor-11th":i="m11";break;case"dominant-13th":i="13";break;case"major-13th":i="maj13";break;case"minor-13th":i="m13";break;case"suspended-second":i="sus2";break;case"suspended-fourth":i="sus4";break;case"Neapolitan":i="II";break;case"Italian":i="It";break;case"French":i="Fr";break;case"German":i="Fr";break;default:i=s;break}}return i}_parseHarmonyFrame(e,t){for(const i of e.childElements())switch(i.localName){case"frame-strings":const s=Number.parseInt(i.innerText,10);t.strings=new Array(s);for(let c=0;c<s;c++)t.strings[c]=-1;break;case"first-fret":t.firstFret=Number.parseInt(i.innerText,10);break;case"frame-note":let a=null,o=null;for(const c of i.childElements())switch(c.localName){case"string":a=Number.parseInt(c.innerText,10);break;case"fret":o=Number.parseInt(c.innerText,10),a&&o>=0&&(t.strings[a-1]=o);break;case"barre":a&&o&&c.getAttribute("type")==="start"&&t.barreFrets.push(o);break}break}}_parseAttributes(e,t,i){let s,a,o;if(this._lastBeat==null)for(const c of e.childElements())switch(c.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(c.innerText);break;case"key":this._parseKey(c,t,i);break;case"time":this._parseTime(c,t);break;case"staves":i.ensureStaveCount(Number.parseInt(c.innerText,10));break;case"clef":s=Number.parseInt(c.getAttribute("number","1"),10)-1,a=this._getOrCreateStaff(i,s),o=this._getOrCreateBar(a,t),this._parseClef(c,o);break;case"staff-details":s=Number.parseInt(c.getAttribute("number","1"),10)-1,a=this._getOrCreateStaff(i,s),this._parseStaffDetails(c,a);break;case"transpose":this._parseTranspose(c,i);break;case"measure-style":this._parseMeasureStyle(c,i,!1);break}else for(const c of e.childElements())switch(c.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(c.innerText);break;case"measure-style":this._parseMeasureStyle(c,i,!0);break}}_simileMarkAllStaves=null;_simileMarkPerStaff=null;_isBeatSlash=!1;_parseMeasureStyle(e,t,i){for(const s of e.childElements())switch(s.localName){case"measure-repeat":if(!i){let a=null;switch(s.getAttribute("type")){case"start":switch(Number.parseInt(s.getAttribute("slashes","1"),10)){case 1:a=rs.Simple;break;case 2:a=rs.FirstOfDouble;break}break;case"stop":a=null;break}if(e.attributes.has("number")){this._simileMarkPerStaff=this._simileMarkPerStaff??new Map;const o=Number.parseInt(e.attributes.get("number"),10)-1;a==null?this._simileMarkPerStaff.delete(o):this._simileMarkPerStaff.set(o,a)}else this._simileMarkAllStaves=a}break;case"slash":switch(s.getAttribute("type")){case"start":this._isBeatSlash=!0;break;case"stop":this._isBeatSlash=!1;break}break}}_parseTranspose(e,t){let i=0;for(const s of e.childElements())switch(s.localName){case"chromatic":i+=Number.parseFloat(s.innerText);break;case"octave-change":i+=Number.parseFloat(s.innerText)*12;break}if(e.attributes.has("number")){const s=this._getOrCreateStaff(t,Number.parseInt(e.attributes.get("number"),10)-1);this._getStaffContext(s).transpose=i,s.displayTranspositionPitch=i}else for(const s of t.staves)this._getStaffContext(s).transpose=i,s.displayTranspositionPitch=i}_parseStaffDetails(e,t){for(const i of e.childElements())switch(i.localName){case"staff-lines":t.standardNotationLineCount=Number.parseInt(i.innerText,10);break;case"staff-tuning":this._parseStaffTuning(i,t);break;case"capo":t.capo=Number.parseInt(i.innerText,10);break}}_parseStaffTuning(e,t){t.stringTuning.tunings.length===0&&(t.showTablature=!0,t.showStandardNotation=!1,t.stringTuning.tunings=new Array(t.standardNotationLineCount).fill(0));const i=Number.parseInt(e.getAttribute("line"),10);let s="C",a="",o=0;for(const h of e.childElements())switch(h.localName){case"tuning-step":s=h.innerText;break;case"tuning-alter":o=Number.parseFloat(h.innerText);break;case"tuning-octave":a=h.innerText;break}const c=ce.getTuningForText(s+a)+o;t.tuning[t.tuning.length-i]=c}_parseClef(e,t){let i="s",s=0;for(const a of e.childElements())switch(a.localName){case"sign":i=a.innerText.toLowerCase();break;case"line":s=Number.parseInt(a.innerText,10);break;case"clef-octave-change":switch(Number.parseInt(a.innerText,10)){case-2:t.clefOttava=Ye._15mb;break;case-1:t.clefOttava=Ye._8vb;break;case 1:t.clefOttava=Ye._8va;break;case 2:t.clefOttava=Ye._15mb;break}break}switch(i){case"g":t.clef=_t.G2;break;case"f":t.clef=_t.F4;break;case"c":s===3?t.clef=_t.C3:t.clef=_t.C4;break;case"percussion":t.clef=_t.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=_t.G2,t.staff.showTablature=!0;break;default:t.clef=_t.G2;break}}_parseTime(e,t){let i=!1,s=!1;for(const a of e.childElements()){const o=a.innerText;switch(a.localName){case"beats":i||(o.indexOf("+")===-1?t.timeSignatureNumerator=Number.parseInt(o,10):t.timeSignatureNumerator=o.split("+").map(c=>Number.parseInt(c,10)).reduce((c,h)=>h+c,0),i=!0);break;case"beat-type":s||(o.indexOf("+")===-1?t.timeSignatureDenominator=Number.parseInt(o,10):t.timeSignatureDenominator=o.split("+").map(c=>Number.parseInt(c,10)).reduce((c,h)=>h+c,0),s=!0);break}}switch(e.getAttribute("symbol","")){case"common":case"cut":t.timeSignatureCommon=!0;break}}_keyAllStaves=null;_parseKey(e,t,i){let s=-Xt.C,a="";for(const h of e.childElements())switch(h.localName){case"fifths":s=Number.parseInt(h.innerText,10);break;case"mode":a=h.innerText;break}let o;-7<=s&&s<=7?o=s:o=Xt.C;let c;if(a==="minor"?c=pn.Minor:c=pn.Major,e.attributes.has("number")){const h=this._getOrCreateStaff(i,Number.parseInt(e.attributes.get("number"),10)-1),d=this._getOrCreateBar(h,t);d.keySignature=o,d.keySignatureType=c}else{this._keyAllStaves=[o,c];for(const h of i.staves)h.bars.length>t.index&&(h.bars[t.index].keySignature=o,h.bars[t.index].keySignatureType=c)}}_parseDirection(e,t,i){const s=[];let a=null,o=-1,c=-1;for(const y of e.childElements())switch(y.localName){case"direction-type":const k=y.firstElement;k&&s.push(k);break;case"offset":a=Number.parseFloat(y.innerText);break;case"voice":break;case"staff":o=Number.parseInt(y.innerText,10)-1;break;case"sound":y.attributes.has("tempo")&&(c=Number.parseFloat(y.attributes.get("tempo")));break}let h=null;o>=0?h=this._getOrCreateStaff(i,o):this._lastBeat!==null?h=this._lastBeat.voice.bar.staff:h=this._getOrCreateStaff(i,0);const d=h?this._getOrCreateBar(h,t):null,p=()=>{let y=this._musicalPosition;a!==null&&(y+=a);const k=t.calculateDuration(!1);return y/k};if(c>0){const y=new jt;y.type=Mt.Tempo,y.value=c,y.ratioPosition=p(),this._hasSameTempo(t,y)||t.tempoAutomations.push(y)}let g="";for(const y of s)switch(y.localName){case"rehearsal":t.section=new ou,t.section.marker=y.innerText;break;case"segno":t.addDirection(Te.TargetSegno);break;case"coda":t.addDirection(Te.TargetCoda);break;case"words":g=y.innerText;break;case"wedge":switch(y.getAttribute("type")){case"crescendo":this._nextBeatCrescendo=Ds.Crescendo;break;case"diminuendo":this._nextBeatCrescendo=Ds.Decrescendo;break;case"stop":this._nextBeatCrescendo=null;break}break;case"dynamics":const k=this._parseDynamics(y);k!==null&&(this._currentDynamics=k,this._score.stylesheet.hideDynamics=!1);break;case"dashes":const _=y.getAttribute("type","start");switch(g){case"LetRing":this._nextBeatLetRing=_==="start"||_==="continue";break;case"P.M.":this._nextBeatPalmMute=_==="start"||_==="continue";break}g="";break;case"pedal":const w=this._parsePedal(y);if(w&&d){w.ratioPosition=p();const T=d.sustainPedals.length>0&&d.sustainPedals[d.sustainPedals.length-1].pedalType!==ai.Up;(w.pedalType!==ai.Up||T)&&d.sustainPedals.push(w)}break;case"metronome":this._parseMetronome(y,t,p());break;case"octave-shift":this._nextBeatOttavia=this._parseOctaveShift(y);break}g&&(this._nextBeatText=g)}_parseOctaveShift(e){const t=e.getAttribute("type");switch(Number.parseInt(e.getAttribute("size","8"),10)){case 15:switch(t){case"up":return Ye._15mb;case"down":return Ye._15ma;case"stop":return Ye.Regular;case"continue":return this._nextBeatOttavia}break;case 8:switch(t){case"up":return Ye._8vb;case"down":return Ye._8va;case"stop":return Ye.Regular;case"continue":return this._nextBeatOttavia}break}return null}_parseMetronome(e,t,i){let s=null,a=-1;for(const o of e.childElements())switch(o.localName){case"beat-unit":s=this._parseBeatDuration(o);break;case"per-minute":a=Number.parseFloat(o.innerText);break}if(s!==null&&a>0){const o=new jt;o.type=Mt.Tempo,o.value=a*(s/4)|0,o.ratioPosition=i,this._hasSameTempo(t,o)||t.tempoAutomations.push(o)}}_hasSameTempo(e,t){for(const i of e.tempoAutomations)if(t.ratioPosition===i.ratioPosition&&t.value===i.value)return!0;return!1}_parsePedal(e){const t=new Qr;switch(e.getAttribute("type")){case"start":t.pedalType=ai.Down;break;case"stop":t.pedalType=ai.Up;break;case"continue":t.pedalType=ai.Hold;break;default:return null}return t}_parseDynamics(e){for(const t of e.childElements()){const i=t.localName.toUpperCase();switch(i){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":return Oe[i]}}return null}_parseForward(e){for(const t of e.childElements())switch(t.localName){case"duration":this._musicalPosition+=this._musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText));break}}_parseBackup(e){for(const t of e.childElements())switch(t.localName){case"duration":if(this._lastBeat){let s=this._musicalPosition;s-=this._musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText)),s<0&&(s=0),this._musicalPosition=s}break}}_getOrCreateStaff(e,t){for(;e.staves.length<=t;){const i=new el;e.addStaff(i),this._score.masterBars.length>0&&this._getOrCreateBar(i,this._score.masterBars[this._score.masterBars.length-1])}return e.staves[t]}_getOrCreateBar(e,t){const i=e.bars.length===0?1:e.bars[0].voices.length;for(;e.bars.length<=t.index;){const s=new gn;e.addBar(s),s.previousBar&&(s.clef=s.previousBar.clef,s.clefOttava=s.previousBar.clefOttava,s.keySignature=s.previousBar.keySignature,s.keySignatureType=s.previousBar.keySignatureType),this._keyAllStaves!=null&&(s.keySignature=this._keyAllStaves[0],s.keySignatureType=this._keyAllStaves[1]);for(let a=0;a<i;a++){const o=new An;s.addVoice(o)}}return e.bars[t.index]}_getOrCreateVoice(e,t){let i=!1;for(;e.voices.length<=t;)e.addVoice(new An),i=!0;if(i)for(const s of e.staff.bars)for(;s.voices.length<=t;)s.addVoice(new An);return e.voices[t]}_parseNote(e,t,i){let s=null,a=De.None,o=0,c=null,h=!1,d=0,p=0,g=-1,y=null,k=0,_=-1,w=-1,T=null,x=null,E=!1,N=null;const v=e.getAttribute("print-object","yes")!=="no",L=()=>{if(s!==null)return;h&&!this._lastBeat&&(ee.warning("MusicXML","Malformed MusicXML, <chord /> cannot be set on the first note of a measure"),h=!1),h&&!x&&(ee.warning("MusicXML","Cannot mix <chord /> and <rest />"),h=!1);const A=this._getOrCreateStaff(i,d);if(h){s=this._lastBeat,s.addNote(x);return}const D=this._getOrCreateBar(A,t),H=this._getOrCreateVoice(D,p),J=H.beats.length===0?0:H.beats[H.beats.length-1].displayEnd;let K=this._musicalPosition-J;if(K>0){if(this._lastBeat&&this._lastBeat.beamingMode===ei.ForceMergeWithNext&&this._lastBeat.voice.bar.staff.index!==d&&H.beats.length>0&&H.beats[H.beats.length-1].beamingMode===ei.ForceMergeWithNext){const F=H.beats[H.beats.length-1].duration;for(;K>0;){const re=this._createRestForGap(K,F);if(re!==null)this._insertBeatToVoice(re,H),K-=re.playbackDuration;else break}}if(K>0){const F=new fs;F.dynamics=this._currentDynamics,F.isEmpty=!0,F.duration=M.TwoHundredFiftySixth,F.overrideDisplayDuration=K,F.updateDurations(),this._insertBeatToVoice(F,H)}}else K<0&&ee.error("MusicXML","Unsupported forward/backup detected. Cannot fill new beats into already filled area of voice");g<0&&y!==null&&(g=$.toTicks(y),k>0&&(g=$.applyDot(g,k===2)));const Y=new fs;s=Y,c===null?Y.beamingMode=this._getStaffContext(A).isExplicitlyBeamed?ei.ForceSplitToNext:ei.Auto:(Y.beamingMode=c,this._getStaffContext(A).isExplicitlyBeamed=!0),Y.isEmpty=!1,Y.dynamics=this._currentDynamics,this._isBeatSlash&&(Y.slashed=!0);const C=this._nextBeatAutomations;if(this._nextBeatAutomations=null,C!==null)for(const F of C)Y.automations.push(F);const Q=this._nextBeatChord;this._nextBeatChord=null,Q!==null&&(Y.chordId=Q.uniqueId,H.bar.staff.hasChord(Q.uniqueId)||H.bar.staff.addChord(Y.chordId,Q));const Z=this._nextBeatCrescendo;Z!==null&&(Y.crescendo=Z);const le=this._nextBeatOttavia;if(le!==null&&(Y.ottava=le),Y.isLetRing=this._nextBeatLetRing,Y.isPalmMute=this._nextBeatPalmMute,this._nextBeatText&&(Y.text=this._nextBeatText,this._nextBeatText=null),x!==null&&Y.addNote(x),this._insertBeatToVoice(Y,H),x!==null){x.isVisible=v;const F=this._indexToTrackInfo.get(i.index);N!==null?x.percussionArticulation=F.getOrCreateArticulation(N,x):E||(x.percussionArticulation=F.getOrCreateArticulation("",x))}a!==De.None?(Y.graceType=a,this._applyBeatDurationFromTicks(Y,o,null,!1)):(Y.tupletNumerator=_,Y.tupletDenominator=w,Y.dots=k,Y.preferredBeamDirection=T,this._applyBeatDurationFromTicks(Y,g,y,!0)),this._musicalPosition=Y.displayEnd,this._lastBeat=Y};for(const A of e.childElements())switch(A.localName){case"grace":const D=Number.parseFloat(A.getAttribute("make-time","-1"));D>=0?(o=this._musicXmlDivisionsToAlphaTabTicks(D),a=De.BeforeBeat):a=De.OnBeat,A.getAttribute("slash")==="yes"&&(a=De.BeforeBeat);break;case"chord":h=!0;break;case"cue":return;case"pitch":x=this._parsePitch(A),E=!0;break;case"unpitched":x=this._parseUnpitched(A,i);break;case"rest":x=null,y===null&&(y=M.Whole);break;case"duration":g=this._parseDuration(A);break;case"instrument":N=A.getAttribute("id","");break;case"voice":p=Number.parseInt(A.innerText,10),Number.isNaN(p)?(ee.warning("MusicXML","Voices need to be specified as numbers"),p=0):p=p-1;break;case"type":y=this._parseBeatDuration(A);break;case"dot":k++;break;case"accidental":x===null?ee.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this._parseAccidental(A,x);break;case"time-modification":for(const H of A.childElements())switch(H.localName){case"actual-notes":_=Number.parseInt(H.innerText,10);break;case"normal-notes":w=Number.parseInt(H.innerText,10);break}break;case"stem":T=this._parseStem(A);break;case"notehead":x===null?ee.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this._parseNoteHead(A,x,y??M.Quarter,T??this._estimateBeamDirection(x));break;case"staff":d=Number.parseInt(A.innerText,10)-1;break;case"beam":if(A.getAttribute("number","1")==="1")switch(A.innerText){case"begin":c=ei.ForceMergeWithNext;break;case"continue":c=ei.ForceMergeWithNext;break;case"end":c=ei.ForceSplitToNext;break}break;case"notations":L(),this._parseNotations(A,x,s);break;case"lyric":L(),this._parseLyric(A,s,i);break;case"play":this._parsePlay(A,x);break}if(E){const A=this._getOrCreateStaff(i,d),D=this._getStaffContext(A).transpose;if(D!==0){const H=x.octave*12+x.tone+D;x.octave=H/12|0,x.tone=H-x.octave*12}}L()}_parsePlay(e,t){for(const i of e.childElements())switch(i.localName){case"mute":t&&i.innerText==="palm"&&(t.isPalmMute=!0);break}}static _b4Value=71;_estimateBeamDirection(e){return e.calculateRealValue(!1,!1)<Qt._b4Value?j.Down:j.Up}_parseNoteHead(e,t,i,s){e.getAttribute("parentheses","no")==="yes"&&(t.isGhost=!0);const a=e.getAttribute("filled","");let o;switch(a==="yes"?o=!0:a==="no"&&(o=!1),t.style=new Bb,e.innerText){case"arrow down":t.style.noteHeadCenterOnStem=!0,this._applyNoteHead(t,i,o,S.NoteheadTriangleDownDoubleWhole,S.NoteheadTriangleDownWhole,S.NoteheadTriangleDownHalf,S.NoteheadTriangleDownBlack);break;case"arrow up":t.style.noteHeadCenterOnStem=!0,this._applyNoteHead(t,i,o,S.NoteheadTriangleUpDoubleWhole,S.NoteheadTriangleUpWhole,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpBlack);break;case"back slashed":this._applyNoteHead(t,i,o,S.NoteheadSlashedDoubleWhole2,S.NoteheadSlashedWhole2,S.NoteheadSlashedHalf2,S.NoteheadSlashedBlack2);break;case"circle dot":t.style.noteHead=S.NoteheadRoundWhiteWithDot;break;case"circle-x":this._applyNoteHead(t,i,o,S.NoteheadCircleXDoubleWhole,S.NoteheadCircleXWhole,S.NoteheadCircleXHalf,S.NoteheadCircleX);break;case"circled":this._applyNoteHead(t,i,o,S.NoteheadCircledDoubleWhole,S.NoteheadCircledWhole,S.NoteheadCircledHalf,S.NoteheadCircledBlack);break;case"cluster":this._applyNoteHead(t,i,o,S.NoteheadClusterDoubleWhole3rd,S.NoteheadClusterWhole3rd,S.NoteheadClusterHalf3rd,S.NoteheadClusterQuarter3rd);break;case"cross":this._applyNoteHead(t,i,o,S.NoteheadPlusDoubleWhole,S.NoteheadPlusWhole,S.NoteheadPlusHalf,S.NoteheadPlusBlack);break;case"diamond":this._applyNoteHead(t,i,o,S.NoteheadDiamondDoubleWhole,S.NoteheadDiamondWhole,S.NoteheadDiamondHalf,S.NoteheadDiamondBlack);break;case"do":this._applyNoteHead(t,i,o,S.NoteShapeTriangleUpWhite,S.NoteShapeTriangleUpWhite,S.NoteShapeTriangleUpWhite,S.NoteShapeTriangleUpBlack);break;case"fa":s===j.Up?this._applyNoteHead(t,i,o,S.NoteShapeTriangleRightWhite,S.NoteShapeTriangleRightWhite,S.NoteShapeTriangleRightWhite,S.NoteShapeTriangleRightBlack):this._applyNoteHead(t,i,o,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftBlack);break;case"fa up":this._applyNoteHead(t,i,o,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftWhite,S.NoteShapeTriangleLeftBlack);break;case"inverted triangle":this._applyNoteHead(t,i,o,S.NoteheadTriangleDownDoubleWhole,S.NoteheadTriangleDownWhole,S.NoteheadTriangleDownHalf,S.NoteheadTriangleDownBlack);break;case"la":this._applyNoteHead(t,i,o,S.NoteShapeSquareWhite,S.NoteShapeSquareWhite,S.NoteShapeSquareWhite,S.NoteShapeSquareBlack);break;case"left triangle":this._applyNoteHead(t,i,o,S.NoteheadTriangleRightWhite,S.NoteheadTriangleRightWhite,S.NoteheadTriangleRightWhite,S.NoteheadTriangleRightBlack);break;case"mi":this._applyNoteHead(t,i,o,S.NoteShapeDiamondWhite,S.NoteShapeDiamondWhite,S.NoteShapeDiamondWhite,S.NoteShapeDiamondBlack);break;case"none":t.style.noteHead=S.NoteheadNull;break;case"normal":this._applyNoteHead(t,i,o,S.NoteheadDoubleWhole,S.NoteheadWhole,S.NoteheadHalf,S.NoteheadBlack);break;case"re":this._applyNoteHead(t,i,o,S.NoteShapeMoonWhite,S.NoteShapeMoonWhite,S.NoteShapeMoonWhite,S.NoteShapeMoonBlack);break;case"rectangle":this._applyNoteHead(t,i,o,S.NoteheadSquareWhite,S.NoteheadSquareWhite,S.NoteheadSquareWhite,S.NoteheadSquareBlack);break;case"slash":this._applyNoteHead(t,i,o,S.NoteheadSlashWhiteWhole,S.NoteheadSlashWhiteWhole,S.NoteheadSlashWhiteHalf,S.NoteheadSlashHorizontalEnds);break;case"slashed":this._applyNoteHead(t,i,o,S.NoteheadSlashedDoubleWhole1,S.NoteheadSlashedWhole1,S.NoteheadSlashedHalf1,S.NoteheadSlashedBlack1);break;case"so":this._applyNoteHead(t,i,o,S.NoteShapeRoundWhite,S.NoteShapeRoundWhite,S.NoteShapeRoundWhite,S.NoteShapeRoundBlack);break;case"square":this._applyNoteHead(t,i,o,S.NoteShapeSquareWhite,S.NoteShapeSquareWhite,S.NoteShapeSquareWhite,S.NoteShapeSquareBlack);break;case"ti":this._applyNoteHead(t,i,o,S.NoteShapeTriangleRoundWhite,S.NoteShapeTriangleRoundWhite,S.NoteShapeTriangleRoundWhite,S.NoteShapeTriangleRoundBlack);break;case"triangle":this._applyNoteHead(t,i,o,S.NoteheadTriangleUpDoubleWhole,S.NoteheadTriangleUpWhole,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpBlack);break;case"x":this._applyNoteHead(t,i,o,S.NoteheadXDoubleWhole,S.NoteheadXWhole,S.NoteheadXHalf,S.NoteheadXBlack);break}}_createRestForGap(e,t){let i=$.toTicks(t);for(;i>e;){if(t===M.TwoHundredFiftySixth)return null;t=t*2,i=$.toTicks(t)}const s=new fs;return s.dynamics=this._currentDynamics,s.isEmpty=!1,s.duration=t,s.overrideDisplayDuration=i,s.updateDurations(),s}_insertBeatToVoice(e,t){if(t.beats.length>0){const i=t.beats[t.beats.length-1];i.nextBeat=e,e.previousBeat=i;let s=i;for(;s!==null&&s.graceType!==De.None;)s.index>0?s=s.previousBeat:s=null;s!==null&&(e.displayStart=s.displayEnd)}t.addBeat(e)}_musicXmlDivisionsToAlphaTabTicks(e){return e*$.QuarterTime/this._divisionsPerQuarterNote}_parseBeatDuration(e){switch(e.innerText){case"1024th":return M.TwoHundredFiftySixth;case"512th":return M.TwoHundredFiftySixth;case"256th":return M.TwoHundredFiftySixth;case"128th":return M.OneHundredTwentyEighth;case"64th":return M.SixtyFourth;case"32nd":return M.ThirtySecond;case"16th":return M.Sixteenth;case"eighth":return M.Eighth;case"quarter":return M.Quarter;case"half":return M.Half;case"whole":return M.Whole;case"breve":return M.DoubleWhole;case"long":return M.QuadrupleWhole}return null}static _allDurations=[M.TwoHundredFiftySixth,M.OneHundredTwentyEighth,M.SixtyFourth,M.ThirtySecond,M.Sixteenth,M.Eighth,M.Quarter,M.Half,M.Whole,M.DoubleWhole,M.QuadrupleWhole];static _allDurationTicks=Qt._allDurations.map(e=>$.toTicks(e));_applyBeatDurationFromTicks(e,t,i,s){if(!i)for(let a=0;a<Qt._allDurations.length;a++){const o=Qt._allDurationTicks[a];if(t>=o)i=Qt._allDurations[a];else break}e.duration=i??M.Sixteenth,s&&(e.overrideDisplayDuration=t),e.updateDurations()}_parseLyric(e,t,i){const a=this._indexToTrackInfo.get(i.index).getLyricLine(e.getAttribute("number",""));for(t.lyrics===null&&(t.lyrics=[]);t.lyrics.length<=a;)t.lyrics.push("");for(const o of e.childElements())switch(o.localName){case"text":t.lyrics[a]?t.lyrics[a]+=` ${o.innerText}`:t.lyrics[a]=o.innerText;break;case"elision":t.lyrics[a]+=o.innerText;break}}_parseNotations(e,t,i){for(const s of e.childElements())switch(s.localName){case"tied":t&&this._parseTied(s,t,i.voice.bar.staff);break;case"slur":t&&this._parseSlur(s,t);break;case"glissando":t&&this._parseGlissando(s,t);break;case"slide":t&&this._parseSlide(s,t);break;case"ornaments":t&&this._parseOrnaments(s,t);break;case"technical":this._parseTechnical(s,t,i);break;case"articulations":t&&this._parseArticulations(s,t);break;case"dynamics":const a=this._parseDynamics(s);a!==null&&(i.dynamics=a,this._currentDynamics=a);break;case"fermata":this._parseFermata(s,i);break;case"arpeggiate":this._parseArpeggiate(s,i);break}}_getStaffContext(e){if(!this._staffToContext.has(e)){const t=new q5;return this._staffToContext.set(e,t),t}return this._staffToContext.get(e)}_parseGlissando(e,t){const i=e.getAttribute("type"),s=e.getAttribute("number","1"),a=this._getStaffContext(t.beat.voice.bar.staff);switch(i){case"start":a.slideOrigins.set(s,t);break;case"stop":if(a.slideOrigins.has(s)){const o=a.slideOrigins.get(s);o.slideTarget=t,t.slideOrigin=o,o.slideOutType=$e.Shift}break}}_parseSlur(e,t){const i=e.getAttribute("number","1"),s=this._getStaffContext(t.beat.voice.bar.staff);switch(e.getAttribute("type")){case"start":s.slurStarts.set(i,t);break;case"stop":if(s.slurStarts.has(i)){t.isSlurDestination=!0;const a=s.slurStarts.get(i);a.slurDestination=t,t.slurOrigin=a,s.slurStarts.delete(i)}break}}_parseArpeggiate(e,t){switch(e.getAttribute("direction","down")){case"down":t.brushType=Ne.ArpeggioDown;break;case"up":t.brushType=Ne.ArpeggioUp;break}}_parseFermata(e,t){let i;switch(e.innerText){case"normal":i=mn.Medium;break;case"angled":i=mn.Short;break;case"square":i=mn.Long;break;default:i=mn.Medium;break}t.fermata=new ru,t.fermata.type=i}_parseArticulations(e,t){for(const i of e.childElements())switch(i.localName){case"accent":t.accentuated=mi.Normal;break;case"strong-accent":t.accentuated=mi.Heavy;break;case"staccato":t.isStaccato=!0;break;case"tenuto":t.accentuated=mi.Tenuto;break}}_parseTechnical(e,t,i){const s=[];for(const a of e.childElements())switch(a.localName){case"up-bow":i.pickStroke=ds.Up;break;case"down-bow":i.pickStroke=ds.Down;break;case"harmonic":break;case"fingering":t&&(t.leftHandFinger=this._parseFingering(a));break;case"pluck":t&&(t.rightHandFinger=this._parseFingering(a));break;case"fret":t&&(t.fret=Number.parseInt(a.innerText,10));break;case"string":t&&(t.string=i.voice.bar.staff.tuning.length-Number.parseInt(a.innerText,10)+1);break;case"hammer-on":case"pull-off":t&&(t.isHammerPullOrigin=!0);break;case"bend":s.push(a);break;case"tap":i.tap=!0;break;case"smear":t&&(t.vibrato=ct.Slight);break;case"golpe":switch(a.getAttribute("placement","above")){case"above":i.golpe=qs.Finger;break;case"below":i.golpe=qs.Thumb;break}break}t&&s.length>0&&this._parseBends(s,t)}_parseBends(e,t){const i=ke.MaxPosition/e.length;let s=0,a=0,o=!0;for(const c of e){const h=c.findChildElement("bend-alter");if(h){const d=Math.round(Math.abs(Number.parseFloat(h.innerText))*2);c.findChildElement("pre-bend")?o?(s+=d,t.addBendPoint(new ke(a,s)),a+=i,t.addBendPoint(new ke(a,s)),o=!1):a+=i:c.findChildElement("release")?(o&&(s+=d),t.addBendPoint(new ke(a,s)),a+=i,s-=d,t.addBendPoint(new ke(a,s)),o=!1):(t.addBendPoint(new ke(a,s)),s+=d,a+=i,t.addBendPoint(new ke(a,s)),o=!1)}}}_parseFingering(e){switch(e.innerText){case"0":return Fe.NoOrDead;case"1":case"p":case"t":return Fe.Thumb;case"2":case"i":return Fe.IndexFinger;case"3":case"m":return Fe.MiddleFinger;case"4":case"a":return Fe.AnnularFinger;case"5":case"c":return Fe.LittleFinger}return Fe.Unknown}_currentTrillStep=-1;_parseOrnaments(e,t){let i=-1;for(const s of e.childElements())switch(s.localName){case"trill-mark":i=Number.parseInt(s.getAttribute("trill-step","2"),10),t.isStringed?t.trillValue=t.stringTuning+i:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+i);break;case"turn":t.ornament=fi.Turn;break;case"inverted-turn":t.ornament=fi.InvertedTurn;break;case"wavy-line":i>0?s.getAttribute("type")==="start"&&(this._currentTrillStep=i):this._currentTrillStep>0?s.getAttribute("type")==="stop"?this._currentTrillStep=-1:t.isStringed?t.trillValue=t.stringTuning+this._currentTrillStep:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+this._currentTrillStep):t.vibrato=ct.Slight;break;case"mordent":t.ornament=fi.LowerMordent;break;case"inverted-mordent":t.ornament=fi.UpperMordent;break;case"tremolo":switch(s.innerText){case"1":t.beat.tremoloSpeed=M.Eighth;break;case"2":t.beat.tremoloSpeed=M.Sixteenth;break;case"3":t.beat.tremoloSpeed=M.ThirtySecond;break}break}}_parseSlide(e,t){const i=e.getAttribute("type"),s=e.getAttribute("number","1"),a=this._getStaffContext(t.beat.voice.bar.staff);switch(i){case"start":a.slideOrigins.set(s,t);break;case"stop":if(a.slideOrigins.has(s)){const o=a.slideOrigins.get(s);o.slideTarget=t,t.slideOrigin=o,o.slideOutType=$e.Shift}break}}_parseTied(e,t,i){const s=e.getAttribute("type"),a=e.getAttribute("number",""),o=this._getStaffContext(i);if(s==="start"){if(a){if(o.tieStartIds.has(a)){const c=o.tieStartIds.get(a);o.tieStarts.delete(c)}o.tieStartIds.set(a,t)}o.tieStarts.add(t)}else if(s==="stop"&&!t.isTieDestination){let c=null;if(a){if(!o.tieStartIds.has(a))return;c=o.tieStartIds.get(a),o.tieStartIds.delete(a),o.tieStarts.delete(t)}else{const h=this._calculatePitchedNoteValue(t);for(const d of o.tieStarts)if(this._calculatePitchedNoteValue(d)===h){c=d,o.tieStarts.delete(c);break}}if(!c)return;t.isTieDestination=!0,t.tieOrigin=c}}_parseStem(e){switch(e.innerText){case"down":return j.Down;case"up":return j.Up;default:return null}}_parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=Ue.ForceSharp;break;case"natural":t.accidentalMode=Ue.ForceNatural;break;case"flat":t.accidentalMode=Ue.ForceFlat;break;case"double-sharp":t.accidentalMode=Ue.ForceDoubleSharp;break;case"flat-flat":t.accidentalMode=Ue.ForceDoubleFlat;break}}_calculatePitchedNoteValue(e){return e.octave*12+e.tone}_parseDuration(e){return this._musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(e.innerText))}_parseUnpitched(e,t){let i="",s=0;for(const o of e.childElements())switch(o.localName){case"display-step":i=o.innerText;break;case"display-octave":s=Number.parseInt(o.innerText,10)+1;break}const a=new es;if(i==="")a.octave=0,a.tone=0;else{const o=s*12+(ce.getToneForText(i)?.noteValue??0);a.octave=o/12|0,a.tone=o-a.octave*12}return a}_parsePitch(e){let t="",i=0,s=0;for(const c of e.childElements())switch(c.localName){case"step":t=c.innerText;break;case"alter":i=Number.parseFloat(c.innerText),Number.isNaN(i)&&(i=0);break;case"octave":s=Number.parseInt(c.innerText,10)+1;break}i=i|0;const a=s*12+(ce.getToneForText(t)?.noteValue??0)+i,o=new es;return o.octave=a/12|0,o.tone=a-o.octave*12,o}_applyNoteHead(e,t,i,s,a,o,c){if(i===void 0)switch(t){case M.QuadrupleWhole:case M.DoubleWhole:e.style.noteHead=s;break;case M.Whole:e.style.noteHead=a;break;case M.Half:e.style.noteHead=o;break;default:e.style.noteHead=c;break}else if(i===!0)e.style.noteHead=c;else switch(t){case M.QuadrupleWhole:case M.DoubleWhole:e.style.noteHead=s;break;case M.Whole:e.style.noteHead=a;break;case M.Half:e.style.noteHead=o;break;default:e.style.noteHead=o;break}}}class Lb{_buffer;_writePosition=0;_readPosition=0;count=0;constructor(e){this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,i){let s=0;i>this._buffer.length-this.count&&(i=this._buffer.length-this.count);const a=Math.min(this._buffer.length-this._writePosition,i);return this._buffer.set(e.subarray(t,t+a),this._writePosition),this._writePosition+=a,this._writePosition%=this._buffer.length,s+=a,s<i&&(this._buffer.set(e.subarray(t+s,t+s+i-s),this._writePosition),this._writePosition+=i-s,s=i),this.count+=s,s}read(e,t,i){i>this.count&&(i=this.count);let s=0;const a=Math.min(this._buffer.length-this._readPosition,i);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+a),t),s+=a,this._readPosition+=a,this._readPosition%=this._buffer.length,s<i&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+i-s),t+s),this._readPosition+=i-s,s=i),this.count-=s,s}}class Bs{static CmdOutputPrefix="alphaSynth.output.";static CmdOutputAddSamples=`${Bs.CmdOutputPrefix}addSamples`;static CmdOutputPlay=`${Bs.CmdOutputPrefix}play`;static CmdOutputPause=`${Bs.CmdOutputPrefix}pause`;static CmdOutputResetSamples=`${Bs.CmdOutputPrefix}resetSamples`;static CmdOutputStop=`${Bs.CmdOutputPrefix}stop`;static CmdOutputSampleRequest=`${Bs.CmdOutputPrefix}sampleRequest`;static CmdOutputSamplesPlayed=`${Bs.CmdOutputPrefix}samplesPlayed`;static preferredSampleRate=0;_worker;get sampleRate(){return Bs.preferredSampleRate}open(){ee.debug("AlphaSynth","Initializing synth worker"),this._worker=ne.globalThis,this._worker.addEventListener("message",this._handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}_handleMessage(e){const t=e.data;switch(t.cmd){case Bs.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case Bs.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples);break}}ready=new qi;samplesPlayed=new ot;sampleRequest=new qi;addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:ne.prepareForPostMessage(e)})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}async enumerateOutputDevices(){return[]}async setOutputDevice(e){}async getOutputDevice(){return null}}class Q5{device;constructor(e){this.device=e}get deviceId(){return this.device.deviceId}get label(){return this.device.label}isDefault=!1}class Bn{static _knownDevices=[];static findKnownDevice(e){return Bn._knownDevices.find(t=>t.deviceId===e)}static createAudioContext(){if("AudioContext"in ne.globalThis)return new AudioContext;if("webkitAudioContext"in ne.globalThis)return new webkitAudioContext;throw new Ht(It.General,"AudioContext not found")}static async checkSinkIdSupport(){return"setSinkId"in Bn.createAudioContext()?!0:(ee.warning("WebAudio","Browser does not support changing the output device"),!1)}static async enumerateOutputDevices(){try{if(!await Bn.checkSinkIdSupport())return[];try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch(c){ee.warning("WebAudio","Output device permission rejected",c)}const e=await navigator.mediaDevices.enumerateDevices();let t="",i="";const s=new Map;for(const c of e)c.kind==="audiooutput"&&(s.set(c.groupId,new Q5(c)),(c.deviceId==="default"||c.deviceId==="")&&(t=c.groupId,i=c.deviceId));const a=Array.from(s.values());let o=a.find(c=>c.deviceId===i);return o||(o=a.find(c=>c.device.groupId===t)),!o&&a.length>0&&(o=a[0]),o&&(o.isDefault=!0),Bn._knownDevices=a,a}catch(e){return ee.error("WebAudio","Failed to enumerate output devices",e),[]}}}class Ga{static BufferSize=4096;static PreferredSampleRate=44100;context=null;buffer=null;source=null;_resumeHandler;get sampleRate(){return this.context?this.context.sampleRate:Ga.PreferredSampleRate}activate(e){this.context||(this.context=Bn.createAudioContext()),(this.context.state==="suspended"||this.context.state==="interrupted")&&(ee.debug("WebAudio","Audio Context is suspended, trying resume"),this.context.resume().then(()=>{ee.debug("WebAudio",`Audio Context resume success: state=${this.context?.state}, sampleRate:${this.context?.sampleRate}`),e&&e()},t=>{ee.warning("WebAudio",`Audio Context resume failed: state=${this.context?.state}, sampleRate:${this.context?.sampleRate}, reason=${t}`)}))}_patchIosSampleRate(){const e=navigator.userAgent;if(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1){const t=Bn.createAudioContext(),i=t.createBuffer(1,1,Ga.PreferredSampleRate),s=t.createBufferSource();s.buffer=i,s.connect(t.destination),s.start(0),s.disconnect(0),t.close()}}open(e){this._patchIosSampleRate(),this.context=Bn.createAudioContext(),this.context.state==="suspended"&&this._registerResumeHandler()}_registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this._unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}_unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){const e=this.context;this.activate(),this.buffer=e.createBuffer(2,Ga.BufferSize,e.sampleRate),this.source=e.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=!0}pause(){this.source&&(this.source.stop(0),this.source.disconnect()),this.source=null}destroy(){this.pause(),this.context?.close(),this.context=null,this._unregisterResumeHandler()}ready=new qi;samplesPlayed=new ot;sampleRequest=new qi;onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}enumerateOutputDevices(){return Bn.enumerateOutputDevices()}async setOutputDevice(e){await Bn.checkSinkIdSupport()&&(e?await this.context.setSinkId(e.deviceId):await this.context.setSinkId(""))}async getOutputDevice(){if(!await Bn.checkSinkIdSupport())return null;const e=this.context.sinkId;if(typeof e!="string"||e===""||e==="default")return null;let t=Bn.findKnownDevice(e);if(t)return t;const i=await this.enumerateOutputDevices();return t=i.find(s=>s.deviceId===e),t||(ee.warning("WebAudio","Could not find output device in device list",e,i),null)}}class op{static _isRegistered=!1;static init(){op._isRegistered||(op._isRegistered=!0,registerProcessor("alphatab",class gh extends AudioWorkletProcessor{static BufferSize=4096;_outputBuffer=new Float32Array(0);_circularBuffer;_bufferCount=0;_requestedBufferCount=0;_isStopped=!1;constructor(t){super(t),ee.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(t.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/gh.BufferSize),this._circularBuffer=new Lb(gh.BufferSize*this._bufferCount),this.port.onmessage=this._handleMessage.bind(this)}_handleMessage(t){const i=t.data;switch(i.cmd){case Bs.CmdOutputAddSamples:const a=i.samples;this._circularBuffer.write(a,0,a.length),this._requestedBufferCount--;break;case Bs.CmdOutputResetSamples:this._circularBuffer.clear();break;case Bs.CmdOutputStop:this._isStopped=!0;break}}process(t,i,s){if(i.length!==1&&i[0].length!==2)return!1;const a=i[0][0],o=i[0][1];if(!a||!o)return!0;const c=a.length+o.length;let h=this._outputBuffer;h.length!==c&&(h=new Float32Array(c),this._outputBuffer=h);const d=this._circularBuffer.read(h,0,Math.min(h.length,this._circularBuffer.count));let p=0;const g=Math.min(a.length,d);for(let y=0;y<g;y++)a[y]=h[p++],o[y]=h[p++];if(d<a.length)for(let y=d;y<a.length;y++)a[y]=0,o[y]=0;return this.port.postMessage({cmd:Bs.CmdOutputSamplesPlayed,samples:d/Xe.AudioChannels}),this._requestBuffers(),this._circularBuffer.count>0||!this._isStopped}_requestBuffers(){const t=this._bufferCount/2|0,i=t*gh.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*gh.BufferSize<i){for(let a=0;a<t;a++)this.port.postMessage({cmd:Bs.CmdOutputSampleRequest});this._requestedBufferCount+=t}}}))}}class Xx extends Ga{_worklet=null;_bufferTimeInMilliseconds=0;_settings;constructor(e){super(),this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();const e=this.context;ne.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this._handleMessage.bind(this),this.source.connect(this._worklet),this.source.start(0),this._worklet.connect(e.destination)},t=>{ee.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}_handleMessage(e){const t=e.data;switch(t.cmd){case Bs.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case Bs.CmdOutputSampleRequest:this.onSampleRequest();break}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:Bs.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){this._worklet?.port.postMessage({cmd:Bs.CmdOutputAddSamples,samples:ne.prepareForPostMessage(e)})}resetSamples(){this._worklet?.port.postMessage({cmd:Bs.CmdOutputResetSamples})}}var tu;(function(n){n[n.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",n[n.MultiTrack=1]="MultiTrack"})(tu||(tu={}));class qx{events=[];addEvent(e){if(this.events.length===0||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){const t=ss.empty();let i=0;for(const o of this.events){const c=o.tick-i;Kr.writeVariableInt(t,c),o.writeTo(t),i=o.tick}const s=new Uint8Array([77,84,114,107]);e.write(s,0,s.length);const a=t.toArray();U.writeInt32BE(e,a.length),e.write(a,0,a.length)}}class Kr{format=tu.SingleTrackMultiChannel;division=$.QuarterTime;get events(){if(this.tracks.length===1)return this.tracks[0].events;const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,i)=>t.tick-i.tick),e}tracks=[];_ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new qx)}addEvent(e){this.format===tu.SingleTrackMultiChannel?(this._ensureTracks(1),this.tracks[0].addEvent(e)):(this._ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){const e=ss.empty();return this.writeTo(e),e.toArray()}writeTo(e){const t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),U.writeInt32BE(e,6),U.writeInt16BE(e,this.format),U.writeInt16BE(e,this.tracks.length),U.writeInt16BE(e,this.division);for(const i of this.tracks)i.writeTo(e)}static writeVariableInt(e,t){const i=new Uint8Array(4);let s=0;do i[s++]=t&127,t>>=7;while(t>0);for(;s>0;)s--,s>0?e.writeByte(i[s]|128):e.writeByte(i[s])}}var Rt;(function(n){n[n.TimeSignature=88]="TimeSignature",n[n.NoteOn=128]="NoteOn",n[n.NoteOff=144]="NoteOff",n[n.ControlChange=176]="ControlChange",n[n.ProgramChange=192]="ProgramChange",n[n.TempoChange=81]="TempoChange",n[n.PitchBend=224]="PitchBend",n[n.PerNotePitchBend=96]="PerNotePitchBend",n[n.EndOfTrack=47]="EndOfTrack",n[n.AlphaTabRest=241]="AlphaTabRest",n[n.AlphaTabMetronome=242]="AlphaTabMetronome",n[n.SystemExclusive=240]="SystemExclusive",n[n.SystemExclusive2=247]="SystemExclusive2",n[n.Meta=255]="Meta"})(Rt||(Rt={}));class ro{track;tick;type;constructor(e,t,i){this.track=e,this.tick=t,this.type=i}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class Jx extends ro{numerator;denominatorIndex;midiClocksPerMetronomeClick;thirtySecondNodesInQuarter;constructor(e,t,i,s,a,o){super(e,t,Rt.TimeSignature),this.track=e,this.tick=t,this.numerator=i,this.denominatorIndex=s,this.midiClocksPerMetronomeClick=a,this.thirtySecondNodesInQuarter=o}writeTo(e){e.writeByte(255),e.writeByte(88),Kr.writeVariableInt(e,4),e.writeByte(this.numerator&255),e.writeByte(this.denominatorIndex&255),e.writeByte(this.midiClocksPerMetronomeClick&255),e.writeByte(this.thirtySecondNodesInQuarter&255)}}class iu extends ro{static AlphaTabManufacturerId=125;static MetronomeEventId=0;static RestEventId=1;writeTo(e){e.writeByte(240);const t=ss.withCapacity(16);t.writeByte(iu.AlphaTabManufacturerId),this.writeEventData(t),t.writeByte(247),Kr.writeVariableInt(e,t.length),t.copyTo(e)}}class Qx extends iu{metronomeNumerator;metronomeDurationInTicks;metronomeDurationInMilliseconds;isMetronome=!0;constructor(e,t,i,s,a){super(e,t,Rt.AlphaTabMetronome),this.metronomeNumerator=i,this.metronomeDurationInMilliseconds=a,this.metronomeDurationInTicks=s}writeEventData(e){e.writeByte(iu.MetronomeEventId),e.writeByte(this.metronomeNumerator),U.writeInt32LE(e,this.metronomeDurationInTicks),U.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class Kx extends iu{channel;constructor(e,t,i){super(e,t,Rt.AlphaTabRest),this.channel=i}writeEventData(e){e.writeByte(iu.RestEventId),e.writeByte(this.channel)}}class Zx extends ro{channel;noteKey;noteVelocity;constructor(e,t,i,s,a,o){super(e,t,i),this.channel=s,this.noteKey=a,this.noteVelocity=o}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class jx extends Zx{constructor(e,t,i,s,a){super(e,t,Rt.NoteOn,i,s,a)}writeTo(e){e.writeByte(this.channel&15|144),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class ev extends Zx{constructor(e,t,i,s,a){super(e,t,Rt.NoteOff,i,s,a)}writeTo(e){e.writeByte(this.channel&15|128),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class tv extends ro{channel;controller;value;constructor(e,t,i,s,a){super(e,t,Rt.ControlChange),this.channel=i,this.controller=s,this.value=a}writeTo(e){e.writeByte(this.channel&15|176),e.writeByte(this.controller&255),e.writeByte(this.value&255)}get data1(){return this.controller}get data2(){return this.value}}class iv extends ro{channel;program;constructor(e,t,i,s){super(e,t,Rt.ProgramChange),this.channel=i,this.program=s}writeTo(e){e.writeByte(this.channel&15|192),e.writeByte(this.program&255)}get data1(){return this.program}}class sv extends ro{get microSecondsPerQuarterNote(){return 6e7/this.beatsPerMinute}set microSecondsPerQuarterNote(e){this.beatsPerMinute=6e7/e}beatsPerMinute=0;constructor(e,t){super(0,e,Rt.TempoChange),this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(this.microSecondsPerQuarterNote&255)}}class nv extends ro{channel;value;constructor(e,t,i,s){super(e,t,Rt.PitchBend),this.channel=i,this.value=s}writeTo(e){e.writeByte(this.channel&15|224),e.writeByte(this.value&127),e.writeByte(this.value>>7&127)}get data1(){return this.value&127}get data2(){return this.value>>7&127}}class av extends ro{channel;noteKey;value;constructor(e,t,i,s,a){super(e,t,Rt.PerNotePitchBend),this.channel=i,this.noteKey=s,this.value=a}writeTo(e){throw new Ht(It.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class rv extends ro{constructor(e,t){super(e,t,Rt.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class kh{eventIndex;event;isMetronome;time=0;constructor(e,t){this.eventIndex=e,this.event=t,this.isMetronome=this.event.type===Rt.AlphaTabMetronome}static newMetronomeEvent(e,t,i,s,a){const o=new Qx(0,t,i,s,a);return new kh(e,o)}}class Hc{masterBarIndex=0;masterBarOccurence=0;synthBpm=0;synthTime=0;synthTick=0;syncTime=0;syncBpm=0;updateSyncBpm(e,t){const i=e-this.synthTime,s=t-this.syncTime,a=i/s*this.synthBpm;this.syncBpm=a}}class TB{bpm;ticks;time;constructor(e,t,i){this.bpm=e,this.ticks=t,this.time=i}}class c0{tempoChanges=[];tempoChangeIndex=0;syncPoints=[];firstProgramEventPerChannel=new Map;firstTimeSignatureNumerator=0;firstTimeSignatureDenominator=0;synthData=[];division=$.QuarterTime;eventIndex=0;currentTime=0;syncPointIndex=0;playbackRange=null;playbackRangeStartTime=0;playbackRangeEndTime=0;endTick=0;endTime=0;currentTempo=0;syncPointTempo=0}class ov{_synthesizer;_currentState;_mainState;_oneTimeState=null;_countInState=null;get isPlayingMain(){return this._currentState===this._mainState}get isPlayingOneTimeMidi(){return this._currentState===this._oneTimeState}get isPlayingCountIn(){return this._currentState===this._countInState}constructor(e){this._synthesizer=e,this._mainState=new c0,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this._tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this._tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}isLooping=!1;get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}get currentTempo(){return this._currentState.currentTempo}get modifiedTempo(){return this._currentState.syncPointTempo*this.playbackSpeed}get syncPointTempo(){return this._currentState.syncPointTempo}get currentSyncPoints(){return this._currentState.syncPoints}playbackSpeed=1;mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this._mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this._mainState.syncPointIndex=0,this._mainState.tempoChangeIndex=0,this._mainState.currentTempo=this._mainState.tempoChanges[0].bpm,this._mainState.syncPointTempo=this._mainState.syncPoints.length>0?this._mainState.syncPoints[0].syncBpm:this._mainState.currentTempo,this.isPlayingMain){const t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this._mainSilentProcess(e)}}_mainSilentProcess(e){if(e<=0)return;const t=Date.now(),i=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<i;)this._fillMidiEventQueueLimited(i-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(Xe.MicroBufferSize);this._mainState.currentTime=i;const s=Date.now()-t;ee.debug("Sequencer",`Silent seek finished in ${s}ms (main)`)}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}instrumentPrograms=new Set;percussionKeys=new Set;loadMidi(e){this.instrumentPrograms.clear(),this.percussionKeys.clear(),this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new c0;this.percussionKeys.add(Xe.MetronomeKey),t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let i=120,s=0,a=0,o=0,c=0,h=0,d=0,p=0,g=0;for(const y of e.events){const k=new kh(t.synthData.length,y);t.synthData.push(k);const _=y.tick-g;if(s+=_,a+=_*(6e4/(i*e.division)),k.time=a,g=y.tick,c>0)for(;d<s;){const w=kh.newMetronomeEvent(t.synthData.length,d,Math.floor(d/c)%o,c,h);t.synthData.push(w),w.time=p,d+=c,p+=h}if(y.type===Rt.TempoChange)i=y.beatsPerMinute,t.tempoChanges.push(new TB(i,s,a)),h=c*(6e4/(i*e.division));else if(y.type===Rt.TimeSignature){const w=y,T=Math.pow(2,w.denominatorIndex);o=w.numerator,c=t.division*(4/T)|0,h=c*(6e4/(i*e.division)),t.firstTimeSignatureDenominator===0&&(t.firstTimeSignatureNumerator=w.numerator,t.firstTimeSignatureDenominator=T)}else if(y.type===Rt.ProgramChange){const w=y,T=w.channel;t.firstProgramEventPerChannel.has(T)||t.firstProgramEventPerChannel.set(T,k),T===Xe.PercussionChannel||this.instrumentPrograms.add(w.program)}else if(y.type===Rt.NoteOn){const w=y;w.channel===Xe.PercussionChannel&&this.percussionKeys.add(w.noteKey)}}return t.currentTempo=t.tempoChanges.length>0?t.tempoChanges[0].bpm:i,t.syncPointTempo=t.currentTempo,t.synthData.sort((y,k)=>y.time>k.time?1:y.time<k.time?-1:y.eventIndex-k.eventIndex),t.endTime=a,t.endTick=s,t}fillMidiEventQueue(){return this._fillMidiEventQueueLimited(-1)}fillMidiEventQueueToEndTime(e){for(;this._mainState.currentTime<e;)this._fillMidiEventQueueLimited(e-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(Xe.MicroBufferSize);let t=!1;for(this._currentState.currentTime=e;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime;){const i=this._currentState.synthData[this._currentState.eventIndex];this._synthesizer.dispatchEvent(i),this._currentState.eventIndex++,t=!0}return t}_fillMidiEventQueueLimited(e){let t=Xe.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,i=this._internalEndTime;e>0&&(e<t&&(t=e),i=Math.min(this._internalEndTime,this._currentState.currentTime+e));let s=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<i;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,s=!0;return s}mainTickPositionToTimePosition(e){return this._tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainUpdateSyncPoints(e){const t=this._mainState;if(e.sort((i,s)=>i.synthTick-s.synthTick),t.syncPoints=[],e.length>=0){let i=120,s=0,a=0,o=0;for(let c=0;c<e.length;c++){const h=e[c];let d=0,p,g,y;if(c===0)p=i,g=0,y=0;else{const k=e[c-1];p=k.syncBpm,g=k.syncTime,y=k.synthTick}for(;o<t.tempoChanges.length&&t.tempoChanges[o].ticks<=h.synthTick;){if(d=t.tempoChanges[o].ticks-s,d>0){s+=d,a+=d*(6e4/(i*t.division));const k=(h.syncTime-g)/(h.synthTick-y),_=(s-y)*k+g,w=new Hc;w.synthTick=s,w.synthBpm=i,w.synthTime=a,w.syncTime=_,w.syncBpm=p}i=t.tempoChanges[o].bpm,o++}d=h.synthTick-s,s+=d,a+=d*(6e4/(i*t.division)),t.syncPoints.push(h)}}t.syncPointIndex=0,t.syncPointTempo=t.syncPoints.length>0?t.syncPoints[0].syncBpm:t.currentTempo}currentTimePositionToTickPosition(e){const t=this._currentState;if(t.tempoChanges.length===0)return 0;e*=this.playbackSpeed,this._updateCurrentTempo(t,e);const i=t.tempoChanges[t.tempoChangeIndex],a=(e-i.time)/(6e4/(i.bpm*t.division))|0;return i.ticks+a+1}currentUpdateCurrentTempo(e){this._updateCurrentTempo(this._mainState,e*this.playbackSpeed)}_updateCurrentTempo(e,t){let i=e.tempoChangeIndex;for(t<e.tempoChanges[i].time&&(i=0);i+1<e.tempoChanges.length&&e.tempoChanges[i+1].time<=t;)i++;i!==e.tempoChangeIndex&&(e.tempoChangeIndex=i,e.currentTempo=e.tempoChanges[e.tempoChangeIndex].bpm,e.syncPoints.length===0&&(e.syncPointTempo=e.currentTempo))}currentUpdateSyncPoints(e){this._updateSyncPoints(this._mainState,e)}_updateSyncPoints(e,t){const i=e.syncPoints;if(i.length>0){let s=Math.min(e.syncPointIndex,i.length-1);for(t<i[s].syncTime&&(s=0);s+1<i.length&&i[s+1].syncTime<=t;)s++;s!==e.syncPointIndex&&(e.syncPointIndex=s,e.syncPointTempo=i[s].syncBpm)}else e.syncPointTempo=e.currentTempo}mainTimePositionFromBackingTrack(e,t){const i=this._mainState,s=i.syncPoints;if(e<0||s.length===0)return e;this._updateSyncPoints(this._mainState,e);const a=Math.min(i.syncPointIndex,s.length-1),o=s[a],c=e-o.syncTime;let h;if(a+1<s.length){const d=s[a+1],p=c/(d.syncTime-o.syncTime);h=(d.synthTime-o.synthTime)*p}else{const d=c/(t-o.syncTime);h=(i.endTime-o.synthTime)*d}return(o.synthTime+h)/this.playbackSpeed}mainTimePositionToBackingTrack(e,t){const i=this._mainState,s=i.syncPoints;if(e<0||s.length===0)return e;e*=this.playbackSpeed;let a=Math.min(i.syncPointIndex,s.length-1);for(e<s[a].synthTime&&(a=0);a+1<s.length&&s[a+1].synthTime<=e;)a++;const o=s[a],c=e-o.synthTime;let h;if(a+1<s.length){const d=s[a+1],p=c/(d.synthTime-o.synthTime),g=d.syncTime-o.syncTime;h=o.syncTime+g*p}else{const d=c/(i.endTime-o.synthTime),p=t-o.syncTime;h=o.syncTime+p*d}return h}_tickPositionToTimePositionWithSpeed(e,t,i){let s=0,a=120,o=0;for(const c of e.tempoChanges){if(t<c.ticks)break;s=c.time,a=c.bpm,o=c.ticks}return t-=o,s+=t*(6e4/(a*e.division)),s/i}get _internalEndTime(){return this.isPlayingMain?this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this._internalEndTime}stop(){this.isPlayingMain&&this.mainPlaybackRange?this._currentState.currentTime=this.mainPlaybackRange.startTick:this._currentState.currentTime=0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new c0;e.division=this._mainState.division;let t=120,i=4,s=4;this._mainState.eventIndex===0?(t=this._mainState.tempoChanges[0].bpm,i=this._mainState.firstTimeSignatureNumerator,s=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,i=this._synthesizer.timeSignatureNumerator,s=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new TB(t,0,0));const a=e.division*(4/s)|0,o=a*(6e4/(t*this._mainState.division));let c=0,h=0;for(let d=0;d<i;d++){const p=kh.newMetronomeEvent(e.synthData.length,c,d,a,o);e.synthData.push(p),p.time=h,c+=a,h+=o}e.synthData.sort((d,p)=>d.time>p.time?1:d.time<p.time?-1:d.eventIndex-p.eventIndex),e.endTime=h,e.endTick=c,e.currentTempo=t,e.syncPointTempo=t,this._countInState=e}}var Ts;(function(n){n[n.Paused=0]="Paused",n[n.Playing=1]="Playing"})(Ts||(Ts={}));class Rl{state;stopped;constructor(e,t){this.state=e,this.stopped=t}}class fr{currentTime;endTime;currentTick;endTick;isSeek;originalTempo=0;modifiedTempo=0;constructor(e,t,i,s,a,o,c){this.currentTime=e,this.endTime=t,this.currentTick=i,this.endTick=s,this.isSeek=a,this.originalTempo=o,this.modifiedTempo=c}}class Na{static HeaderSize=8;id="";size=0;static load(e,t,i){if(e&&Na.HeaderSize>e.size||i.position+Na.HeaderSize>=i.length||(t.id=U.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122)||(t.size=U.readUInt32LE(i),e&&Na.HeaderSize+t.size>e.size))return!1;e&&(e.size-=Na.HeaderSize+t.size);const s=t.id==="RIFF",a=t.id==="LIST";return s&&e?!1:!s&&!a?!0:(t.id=U.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122?!1:(t.size-=4,!0))}}class K5{packetData;isBeginningOfStream;isEndOfStream;granulePosition;constructor(e,t,i,s){this.packetData=e,this.isBeginningOfStream=t,this.isEndOfStream=i,this.granulePosition=i?s:null}addData(e){const t=this.packetData,i=new Uint8Array(t.length+e.length);i.set(t,0),i.set(e,t.length)}}var wh;(function(n){n[n.ContinuesPacket=1]="ContinuesPacket",n[n.BeginningOfStream=2]="BeginningOfStream",n[n.EndOfStream=4]="EndOfStream"})(wh||(wh={}));class Z5{_readable;constructor(e){this._readable=e}read(){const e=[];for(;this._findAndReadPage(e););return e}_findAndReadPage(e){return this._seekPageHeader()?this._readPage(e):!1}_seekPageHeader(){for(let e=0;e<65536;e++){if(U.readInt32LE(this._readable)===1399285583)return!0;this._readable.position-=3}return!1}_readPage(e){const t=this._readable.readByte();if(t===-1||t!==0)return!1;const i=this._readable.readByte(),s=U.readInt64LE(this._readable);this._readable.skip(4),this._readable.skip(4),this._readable.skip(4);const a=this._readable.readByte();if(a===-1)return!1;const o=[];let c=0;for(let h=0;h<a;h++){const d=this._readable.readByte();c===o.length&&o.push(0),o[c]+=d,d<255&&c++}for(let h=0;h<o.length;h++){const d=new Uint8Array(o[h]);if(this._readable.read(d,0,d.length)!==d.length)return!1;if((i&wh.ContinuesPacket)!==0){if(e.length===0)throw new Ht(It.Format,"OGG: Continuation page without any previous packets");e[e.length-1].addData(d)}else{const g=new K5(d,(i&wh.BeginningOfStream)!==0&&h===0,(i&wh.EndOfStream)!==0&&h===o.length-1,s);e.push(g)}}return!0}}class j5{audioChannels=0;audioSampleRate=0;samples=new Float32Array(0);bitrateMaximum=0;bitrateNominal=0;bitrateMinimum=0;blocksize0=0;blocksize1=0}class xB{value=0;bitsRead=0}class mg{static _byteSize=8;_source;_bitBucket=0n;_bitCount=0n;_overflowBits=0n;constructor(e){this._source=e}readByte(){return this.readBits(mg._byteSize)}readBit(){return this.readBits(1)===1}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte()&255;return t}readBits(e){if(e===0)return 0;const t=this.tryPeekBits(e);return this.skipBits(e),t.value}tryPeekBits(e){if(e<0||e>32)throw new Ht(It.General,"IO: Cannot read more than 32 bits in one go");if(e===0)return new xB;const t=new xB;for(;this._bitCount<e;){const s=BigInt(this._source.readByte());if(s===-1n)return t.bitsRead=Number(this._bitCount),t.value=Number(this._bitBucket),this._bitBucket=0n,this._bitCount=0n,t;this._bitBucket=(s&0xffn)<<this._bitCount|this._bitBucket,this._bitCount+=8n,this._bitCount>32&&(this._overflowBits=s>>40n-this._bitCount&0xffn)}let i=this._bitBucket;return e<64&&(i=i&(1n<<BigInt(e))-1n),t.value=Number(i),t.bitsRead=e,t}skipBits(e){let t=BigInt(e);if(e!==0)if(this._bitCount>t){if(e>31?this._bitBucket=0n:this._bitBucket=this._bitBucket>>t,this._bitCount>32){const i=this._bitCount-32n;this._bitBucket=this._bitBucket|this._overflowBits<<this._bitCount-t-i,i>e&&(this._overflowBits=this._overflowBits>>t&0xffn)}this._bitCount-=t}else if(this._bitCount===t)this._bitBucket=0n,this._bitCount=0n;else{for(t-=this._bitCount,this._bitCount=0n,this._bitBucket=0n;t>8;){if(this._source.readByte()===-1){t=0n;break}t-=8n}if(t>0){const i=BigInt(this._source.readByte());i===-1n||(this._bitBucket=i>>t,this._bitCount=8n-t)}}}}class eR{codebooks=[];timeDomainTransforms=[];floors=[];residues=[];mappings=[];modes=[]}class mr{static ilog(e){let t=0;for(;e>0;)++t,e>>=1;return t}static bitReverse(e,t=32){let i=BigInt(e);return i=(i&BigInt(2863311530))>>1n|(i&BigInt(1431655765))<<1n,i=(i&BigInt(3435973836))>>2n|(i&BigInt(858993459))<<2n,i=(i&BigInt(4042322160))>>4n|(i&BigInt(252645135))<<4n,i=(i&BigInt(4278255360))>>8n|(i&BigInt(16711935))<<8n,i=(i>>16n|i<<16n)>>32n-BigInt(t),Number(BigInt.asUintN(32,i))}static convertFromVorbisFloat32(e){const t=BigInt(e);let i=t&BigInt(2097151);const s=t&BigInt(2147483648),a=(t&BigInt(2145386496))>>21n;return s!==0n&&(i=-i),Number(i)*Math.pow(2,Number(a)-788)}}class tR{_data;constructor(e){this._data=e}get(e){return this._data[e]}}class Ab{static instance=new Ab;get(e){return e}}class iR{_lengths;_maxBits=0;_overflowList=null;_prefixList=null;_prefixBitLength=0;_lookupTable;dimensions=0;entries=0;mapType=0;constructor(e,t){if(e.readBits(24)!==5653314)throw new Ht(It.Format,"Vorbis: Book header had invalid signature!");this.dimensions=e.readBits(16),this.entries=e.readBits(24),this._lengths=new Int32Array(this.entries),this._initTree(e,t),this._initLookupTable(e)}get(e,t){return this._lookupTable[e*this.dimensions+t]}decodeScalar(e){let t=e.tryPeekBits(this._prefixBitLength);if(t.bitsRead===0)return-1;let i=this._prefixList[t.value];if(i!=null)return e.skipBits(i.length),i.value;if(t=e.tryPeekBits(this._maxBits),this._overflowList!==null)for(let s=0;s<this._overflowList.length;s++){i=this._overflowList[s];const a=t.value&i.mask;if(i.bits===a)return e.skipBits(i.length),i.value}return-1}_initTree(e,t){let i,s=0,a;if(e.readBit()){let o=e.readBits(5)+1;for(let c=0;c<this.entries;){let h=e.readBits(mr.ilog(this.entries-c));for(;--h>=0;)this._lengths[c++]=o;++o}s=0,i=!1,a=o}else{a=-1,i=e.readBit();for(let o=0;o<this.entries;o++)!i||e.readBit()?(this._lengths[o]=e.readBits(5)+1,++s):this._lengths[o]=-1,this._lengths[o]>a&&(a=this._lengths[o])}if(this._maxBits=a,a>-1){let o=null;i&&s>=this.entries>>2&&(o=new Int32Array(this.entries),o.set(this._lengths.subarray(0,this.entries),0),i=!1);let c;i?c=s:c=0;let h=null,d=null;if(i?c!==0&&(o=new Int32Array(c),d=new Int32Array(c),h=new Int32Array(c)):d=new Int32Array(this.entries),!this._computeCodewords(i,d,o,this._lengths,this.entries,h))throw new Ht(It.Format,"Vorbis: Failed to compute codewords");const p=h==null?Ab.instance:new tR(h);t.generateTable(p,o??this._lengths,d),this._prefixList=t.prefixTree,this._prefixBitLength=t.tableBits,this._overflowList=t.overflowList}}_computeCodewords(e,t,i,s,a,o){const c=new Uint32Array(32);let h=0,d=0;for(h=0;h<a&&!(s[h]>0);++h);if(h===a)return!0;this._addEntry(e,t,i,0,h,d++,s[h],o);for(let p=1;p<=s[h];++p)c[p]=1<<32-p;for(let p=h+1;p<a;++p){let g=s[p];if(g<=0)continue;for(;g>0&&c[g]===0;)--g;if(g===0)return!1;const y=c[g];if(c[g]=0,this._addEntry(e,t,i,mr.bitReverse(y),p,d++,s[p],o),g!==s[p])for(let k=s[p];k>g;--k)c[k]=y+(1<<32-k)}return!0}_addEntry(e,t,i,s,a,o,c,h){e?(t[o]=s,i[o]=c,h[o]=a):t[a]=s}_initLookupTable(e){if(this.mapType=e.readBits(4),this.mapType===0)return;const t=mr.convertFromVorbisFloat32(e.readBits(32)),i=mr.convertFromVorbisFloat32(e.readBits(32)),s=e.readBits(4)+1,a=e.readBit();let o=this.entries*this.dimensions;const c=new Float32Array(o);this.mapType===1&&(o=this._lookup1Values());const h=new Uint32Array(o);for(let d=0;d<o;d++)h[d]=e.readBits(s);if(this.mapType===1)for(let d=0;d<this.entries;d++){let p=0,g=1;for(let y=0;y<this.dimensions;y++){const k=d/g%o|0,_=h[k]*i+t+p;c[d*this.dimensions+y]=_,a&&(p=_),g*=o}}else for(let d=0;d<this.entries;d++){let p=0,g=d*this.dimensions;for(let y=0;y<this.dimensions;y++){const k=h[g]*i+t+p;c[d*this.dimensions+y]=k,a&&(p=k),++g}}this._lookupTable=c}_lookup1Values(){let e=Math.floor(Math.exp(Math.log(this.entries)/this.dimensions));return Math.floor(Math.pow(e+1,this.dimensions))<=this.entries&&++e,e}}class sR{value=0;length=0;bits=0;mask=0}class lp{static maxTableBits=10;tableBits=0;prefixTree=[];overflowList=null;generateTable(e,t,i){const s=new Array(t.length);let a=0;for(let d=0;d<s.length;d++){const p=new sR;p.value=e.get(d),p.length=t[d]<=0?99999:t[d],p.bits=i[d],p.mask=(1<<t[d])-1,s[d]=p,t[d]>0&&a<t[d]&&(a=t[d])}s.sort((d,p)=>{const g=d.length-p.length;return g===0?d.bits-p.bits:g});const o=a>lp.maxTableBits?lp.maxTableBits:a,c=[];let h=null;for(let d=0;d<s.length&&s[d].length<99999;d++){const p=s[d].length;if(p>o)for(h=[];d<s.length&&s[d].length<99999;d++)h.push(s[d]);else{const g=1<<o-p,y=s[d];for(let k=0;k<g;k++){const _=k<<p|y.bits;for(;c.length<=_;)c.push(null);c[_]=y}}}for(;c.length<1<<o;)c.push(null);this.tableBits=o,this.prefixTree=c,this.overflowList=h}}class nR{constructor(e){e.readBits(16)}}class aR{coeff;amp=0;get executeChannel(){return(this.forceEnergy||this.amp>0)&&!this.forceNoEnergy}forceEnergy=!1;forceNoEnergy=!1;constructor(e){this.coeff=e}}class cp{_order;_rate;_barkMapSize;_ampBits;_ampOfs;_ampDiv;_books;_bookBits;_wMap;_barkMaps;constructor(e,t,i,s){if(this._order=e.readBits(8),this._rate=e.readBits(16),this._barkMapSize=e.readBits(16),this._ampBits=e.readBits(6),this._ampOfs=e.readBits(8),this._books=new Array(e.readBits(4)+1),this._order<1||this._rate<1||this._barkMapSize<1||this._books.length===0)throw new Ht(It.Format,"Vorbis: Invalid Floor0 Data");this._ampDiv=(1<<this._ampBits)-1;for(let a=0;a<this._books.length;a++){const o=e.readBits(8);if(o<0||o>=s.length)throw new Ht(It.Format,"Vorbis: Invalid Floor0 Data");const c=s[o];if(c.mapType===0||c.dimensions<1)throw new Ht(It.Format,"Vorbis: Invalid Floor0 Data");this._books[a]=c}this._bookBits=mr.ilog(this._books.length),this._barkMaps=new Map([[t,this._synthesizeBarkCurve(t/2)],[i,this._synthesizeBarkCurve(i/2)]]),this._wMap=new Map([[t,this._synthesizeWDelMap(t/2)],[i,this._synthesizeWDelMap(i/2)]])}_synthesizeBarkCurve(e){const t=this._barkMapSize/cp._toBARK(this._rate/2),i=new Int32Array(e+1);for(let s=0;s<e-1;s++)i[s]=Math.min(this._barkMapSize-1,Math.floor(cp._toBARK(this._rate/2/e*s)*t));return i[e]=-1,i}static _toBARK(e){return 13.1*Math.atan(74e-5*e)+2.24*Math.atan(185e-10*e*e)+1e-4*e}_synthesizeWDelMap(e){const t=Math.PI/this._barkMapSize,i=new Float32Array(e);for(let s=0;s<e;s++)i[s]=2*Math.cos(t*s);return i}unpack(e,t,i){const s=new aR(new Float32Array(this._order+1));if(s.amp=e.readBits(this._ampBits),s.amp>0){s.amp=s.amp/this._ampDiv*this._ampOfs;const a=e.readBits(this._bookBits);if(a>=this._books.length)return s.amp=0,s;const o=this._books[a];for(let h=0;h<this._order;){const d=o.decodeScalar(e);if(d===-1)return s.amp=0,s;for(let p=0;h<this._order&&p<o.dimensions;p++,h++)s.coeff[h]=o.get(d,p)}let c=0;for(let h=0;h<this._order;){for(let d=0;h<this._order&&d<o.dimensions;h++,d++)s.coeff[h]+=c;c=s.coeff[h-1]}}return s}apply(e,t,i){const s=e,a=t/2;if(s.amp>0){const o=this._barkMaps.get(t),c=this._wMap.get(t);let h=0;for(h=0;h<this._order;h++)s.coeff[h]=2*Math.cos(s.coeff[h]);for(h=0;h<a;){let d=0;const p=o[h];let g=.5,y=.5;const k=c[p];for(d=1;d<this._order;d+=2)y*=k-s.coeff[d-1],g*=k-s.coeff[d];for(d===this._order?(y*=k-s.coeff[d-1],g*=g*(4-k*k),y*=y):(g*=g*(2-k),y*=y*(2+k)),y=s.amp/Math.sqrt(g+y)-this._ampOfs,y=Math.exp(y*.11512925),i[h]*=y;o[++h]===p;)i[h]*=y}}else i.fill(0,0,a)}}class rR{posts=new Int32Array(64);postCount=0;get executeChannel(){return(this.forceEnergy||this.postCount>0)&&!this.forceNoEnergy}forceEnergy=!1;forceNoEnergy=!1}class zc{static _rangeLookup=[256,128,86,64];static _yBitsLookup=[8,7,7,6];_partitionClass;_classDimensions;_classSubclasses;_xList;_classMasterBookIndex;_hNeigh;_lNeigh;_sortIdx;_multiplier;_range;_yBits;_classMasterbooks;_subclassBooks;_subclassBookIndex;constructor(e,t){let i=-1;this._partitionClass=new Int32Array(e.readBits(5));for(let o=0;o<this._partitionClass.length;o++)this._partitionClass[o]=e.readBits(4),this._partitionClass[o]>i&&(i=this._partitionClass[o]);++i,this._classDimensions=new Int32Array(i),this._classSubclasses=new Int32Array(i),this._classMasterbooks=new Array(i),this._classMasterBookIndex=new Int32Array(i),this._subclassBooks=new Array(i),this._subclassBookIndex=new Array(i);for(let o=0;o<i;o++){this._classDimensions[o]=e.readBits(3)+1,this._classSubclasses[o]=e.readBits(2),this._classSubclasses[o]>0&&(this._classMasterBookIndex[o]=e.readBits(8),this._classMasterbooks[o]=t[this._classMasterBookIndex[o]]),this._subclassBooks[o]=new Array(1<<this._classSubclasses[o]),this._subclassBookIndex[o]=new Int32Array(this._subclassBooks[o].length);for(let c=0;c<this._subclassBooks[o].length;c++){const h=e.readBits(8)-1;h>=0&&(this._subclassBooks[o][c]=t[h]),this._subclassBookIndex[o][c]=h}}this._multiplier=e.readBits(2),this._range=zc._rangeLookup[this._multiplier],this._yBits=zc._yBitsLookup[this._multiplier],++this._multiplier;const s=e.readBits(4),a=[];a.push(0),a.push(1<<s);for(let o=0;o<this._partitionClass.length;o++){const c=this._partitionClass[o];for(let h=0;h<this._classDimensions[c];h++)a.push(e.readBits(s))}this._xList=new Int32Array(a),this._lNeigh=new Int32Array(a.length),this._hNeigh=new Int32Array(a.length),this._sortIdx=new Int32Array(a.length),this._sortIdx[0]=0,this._sortIdx[1]=1;for(let o=2;o<this._lNeigh.length;o++){this._lNeigh[o]=0,this._hNeigh[o]=1,this._sortIdx[o]=o;for(let c=2;c<o;c++){const h=this._xList[c];h<this._xList[o]?h>this._xList[this._lNeigh[o]]&&(this._lNeigh[o]=c):h<this._xList[this._hNeigh[o]]&&(this._hNeigh[o]=c)}}for(let o=0;o<this._sortIdx.length-1;o++)for(let c=o+1;c<this._sortIdx.length;c++){if(this._xList[o]===this._xList[c])throw new Ht(It.Format,"Vorbis: Invalid Floor1 Data");if(this._xList[this._sortIdx[o]]>this._xList[this._sortIdx[c]]){const h=this._sortIdx[o];this._sortIdx[o]=this._sortIdx[c],this._sortIdx[c]=h}}}unpack(e,t,i){const s=new rR;if(e.readBit()){let a=2;s.posts[0]=e.readBits(this._yBits),s.posts[1]=e.readBits(this._yBits);for(let o=0;o<this._partitionClass.length;o++){const c=this._partitionClass[o],h=this._classDimensions[c],d=this._classSubclasses[c],p=(1<<d)-1;let g=0;if(d>0&&(g=this._classMasterbooks[c].decodeScalar(e),g===-1)){a=0;break}for(let y=0;y<h;y++){const k=this._subclassBooks[c][g&p];if(g=g>>d,k!=null&&(s.posts[a]=k.decodeScalar(e),s.posts[a]===-1)){a=0,o=this._partitionClass.length;break}++a}}s.postCount=a}return s}apply(e,t,i){const s=e,a=t/2;if(s.postCount>0){const o=this._unwrapPosts(s);let c=0,h=s.posts[0]*this._multiplier;for(let d=1;d<s.postCount;d++){const p=this._sortIdx[d];if(o[p]){const g=this._xList[p],y=s.posts[p]*this._multiplier;c<a&&this._renderLineMulti(c,h,Math.min(g,a),y,i),c=g,h=y}if(c>=a)break}c<a&&this._renderLineMulti(c,h,a,h,i)}else i.fill(0,0,a)}_unwrapPosts(e){const t=new Array(64);t.fill(!1),t[0]=!0,t[1]=!0;const i=new Int32Array(64);i[0]=e.posts[0],i[1]=e.posts[1];for(let s=2;s<e.postCount;s++){const a=this._lNeigh[s],o=this._hNeigh[s],c=this._renderPoint(this._xList[a],i[a],this._xList[o],i[o],this._xList[s]),h=e.posts[s],d=this._range-c,p=c;let g;d<p?g=d*2:g=p*2,h!==0?(t[a]=!0,t[o]=!0,t[s]=!0,h>=g?d>p?i[s]=h-p+c:i[s]=c-h+d-1:h%2===1?i[s]=c-(h+1)/2:i[s]=c+h/2):(t[s]=!1,i[s]=c)}for(let s=0;s<e.postCount;s++)e.posts[s]=i[s];return t}_renderPoint(e,t,i,s,a){const o=s-t,c=i-e,p=Math.abs(o)*(a-e)/c|0;return o<0?t-p:t+p}_renderLineMulti(e,t,i,s,a){const o=s-t,c=i-e;let h=Math.abs(o);const d=1-(o>>31&1)*2,p=o/c|0;let g=e,y=t,k=-c;for(a[e]*=zc._inverseDbTable[t],h-=Math.abs(p)*c;++g<i;)y+=p,k+=h,k>=0&&(k-=c,y+=d),a[g]*=zc._inverseDbTable[y]}static _inverseDbTable=new Float32Array([10649863e-14,11341951e-14,12079015e-14,12863978e-14,13699951e-14,14590251e-14,15538408e-14,16548181e-14,17623575e-14,18768855e-14,19988561e-14,2128753e-13,22670913e-14,24144197e-14,25713223e-14,27384213e-14,29163793e-14,31059021e-14,33077411e-14,35226968e-14,37516214e-14,39954229e-14,4255068e-13,45315863e-14,48260743e-14,51396998e-14,54737065e-14,58294187e-14,62082472e-14,66116941e-14,70413592e-14,74989464e-14,79862701e-14,8505263e-13,90579828e-14,96466216e-14,10273513e-13,10941144e-13,11652161e-13,12409384e-13,13215816e-13,14074654e-13,14989305e-13,15963394e-13,17000785e-13,18105592e-13,19282195e-13,20535261e-13,21869758e-13,23290978e-13,24804557e-13,26416497e-13,2813319e-12,29961443e-13,31908506e-13,33982101e-13,36190449e-13,38542308e-13,41047004e-13,4371447e-12,46555282e-13,49580707e-13,5280274e-12,5623416e-12,59888572e-13,63780469e-13,67925283e-13,72339451e-13,77040476e-13,82047e-10,87378876e-13,93057248e-13,99104632e-13,10554501e-12,11240392e-12,11970856e-12,12748789e-12,13577278e-12,14459606e-12,15399272e-12,16400004e-12,17465768e-12,18600792e-12,19809576e-12,21096914e-12,22467911e-12,23928002e-12,25482978e-12,27139006e-12,28902651e-12,30780908e-12,32781225e-12,34911534e-12,37180282e-12,39596466e-12,42169667e-12,4491009e-11,47828601e-12,50936773e-12,54246931e-12,57772202e-12,61526565e-12,65524908e-12,69783085e-12,74317983e-12,79147585e-12,8429104e-11,89768747e-12,95602426e-12,.00010181521,.00010843174,.00011547824,.00012298267,.00013097477,.00013948625,.00014855085,.00015820453,.00016848555,.00017943469,.00019109536,.00020351382,.00021673929,.00023082423,.00024582449,.00026179955,.00027881276,.00029693158,.00031622787,.00033677814,.00035866388,.00038197188,.00040679456,.00043323036,.00046138411,.00049136745,.00052329927,.00055730621,.00059352311,.00063209358,.00067317058,716917e-9,.0007635063,.00081312324,.00086596457,.00092223983,.00098217216,.0010459992,.0011139742,.0011863665,.0012634633,.0013455702,.0014330129,.0015261382,.0016253153,.0017309374,.0018434235,.0019632195,.0020908006,.0022266726,.0023713743,.0025254795,.0026895994,.0028643847,.0030505286,.0032487691,.0034598925,.0036847358,.0039241906,.0041792066,.004450795,.0047400328,.0050480668,.0053761186,.0057254891,.0060975636,.0064938176,.0069158225,.0073652516,.0078438871,.0083536271,.0088964928,.009474637,.010090352,.01074608,.011444421,.012188144,.012980198,.013823725,.014722068,.015678791,.016697687,.017782797,.018938423,.020169149,.021479854,.022875735,.02436233,.025945531,.027631618,.029427276,.031339626,.033376252,.035545228,.037855157,.040315199,.042935108,.045725273,.048696758,.051861348,.055231591,.05882085,.062643361,.066714279,.071049749,.075666962,.080584227,.085821044,.091398179,.097337747,.1036633,.11039993,.11757434,.12521498,.13335215,.14201813,.15124727,.16107617,.1715438,.18269168,.19456402,.20720788,.22067342,.23501402,.25028656,.26655159,.28387361,.30232132,.32196786,.34289114,.36517414,.38890521,.41417847,.44109412,.4697589,.50028648,.53279791,.56742212,.6042964,.64356699,.68538959,.72993007,.77736504,.8278826,.88168307,.9389798,1])}class oR{floor;constructor(e,t,i,s){const a=e.readBits(16);switch(a){case 0:this.floor=new cp(e,t,i,s);break;case 1:this.floor=new zc(e,s);break;default:throw new Ht(It.Format,`Vorbis: Invalid Floor type: ${a}`)}}apply(e,t,i){this.floor.apply(e,t,i)}unpack(e,t,i){return this.floor.unpack(e,t,i)}}class sd{_channels;_begin;_end;_partitionSize;_classifications;_maxStages;_books;_classBook;_cascade;_decodeMap;constructor(e,t,i){this._begin=e.readBits(24),this._end=e.readBits(24),this._partitionSize=e.readBits(24)+1,this._classifications=e.readBits(6)+1,this._classBook=i[e.readBits(8)],this._cascade=new Int32Array(this._classifications);let s=0;for(let g=0;g<this._classifications;g++){const y=e.readBits(3);e.readBit()?this._cascade[g]=e.readBits(5)<<3|y:this._cascade[g]=y,s+=sd._icount(this._cascade[g])}const a=new Int32Array(s);for(let g=0;g<s;g++)if(a[g]=e.readBits(8),i[a[g]].mapType===0)throw new Ht(It.Format,"Vorbis: Invalid Residue 0");const o=this._classBook.entries;let c=this._classBook.dimensions,h=1;for(;c>0;){if(h*=this._classifications,h>o)throw new Ht(It.Format,"Vorbis: Invalid Residue 0");--c}this._books=new Array(this._classifications),s=0;let d=0,p;for(let g=0;g<this._classifications;g++)if(p=mr.ilog(this._cascade[g]),this._books[g]=new Array(p),p>0){d=Math.max(d,p);for(let y=0;y<p;y++)(this._cascade[g]&1<<y)>0&&(this._books[g][y]=i[a[s++]])}this._maxStages=d,this._decodeMap=new Array(h);for(let g=0;g<h;g++){let y=g,k=h/this._classifications|0;this._decodeMap[g]=new Int32Array(this._classBook.dimensions);for(let _=0;_<this._classBook.dimensions;_++){const w=y/k|0;y-=w*k,k=k/this._classifications|0,this._decodeMap[g][_]=w}}this._channels=t}static _icount(e){let t=0;for(;e!==0;)t+=e&1,e>>=1;return t}decode(e,t,i,s){const o=(this._end<i/2?this._end:i/2)-this._begin;if(o>0&&t.indexOf(!1)!==-1){const c=o/this._partitionSize,h=(c+this._classBook.dimensions-1)/this._classBook.dimensions|0,d=[];for(let p=0;p<this._channels;p++)d.push(new Array(h));for(let p=0;p<this._maxStages;p++)for(let g=0,y=0;g<c;y++){if(p===0)for(let k=0;k<this._channels;k++){const _=this._classBook.decodeScalar(e);if(_>=0&&_<this._decodeMap.length)d[k][y]=this._decodeMap[_];else{g=c,p=this._maxStages;break}}for(let k=0;g<c&&k<this._classBook.dimensions;k++,g++){const _=this._begin+g*this._partitionSize;for(let w=0;w<this._channels;w++){const T=d[w][y][k];if((this._cascade[T]&1<<p)!==0){const x=this._books[T][p];if(x&&this.writeVectors(x,e,s,w,_,this._partitionSize)){g=c,p=this._maxStages;break}}}}}}}writeVectors(e,t,i,s,a,o){const c=i[s],h=o/e.dimensions,d=new Int32Array(h);for(let p=0;p<h;p++)if(d[p]=e.decodeScalar(t),d[p]===-1)return!0;for(let p=0;p<e.dimensions;p++)for(let g=0;g<h;g++,a++)c[a]+=e.get(d[g],p);return!1}}class lR extends sd{writeVectors(e,t,i,s,a,o){const c=i[s];for(let h=0;h<o;){const d=e.decodeScalar(t);if(d===-1)return!0;for(let p=0;p<e.dimensions;h++,p++)c[a+h]+=e.get(d,p)}return!1}}class cR extends sd{_realChannels;constructor(e,t,i){super(e,1,i),this._realChannels=t}decode(e,t,i,s){super.decode(e,t,i*this._realChannels,s)}writeVectors(e,t,i,s,a,o){let c=0;a/=this._realChannels;for(let h=0;h<o;){const d=e.decodeScalar(t);if(d===-1)return!0;for(let p=0;p<e.dimensions;p++,h++)i[c][a]+=e.get(d,p),++c===this._realChannels&&(c=0,a++)}return!1}}class uR{residue;constructor(e,t,i){const s=e.readBits(16);switch(s){case 0:this.residue=new sd(e,t,i);break;case 1:this.residue=new lR(e,t,i);break;case 2:this.residue=new cR(e,t,i);break;default:throw new Ht(It.Format,`Vorbis: Invalid Residue type: ${s}`)}}decode(e,t,i,s){this.residue.decode(e,t,i,s)}}class hR{_mdct;_couplingAngle;_couplingMangitude;_submapFloor;_submapResidue;_channelFloor;_channelResidue;constructor(e,t,i,s,a){if(e.readBits(16)!==0)throw new Ht(It.Format,"Vorbis: Invalid mapping type!");let c=1;e.readBit()&&(c+=e.readBits(4));let h=0;e.readBit()&&(h=e.readBits(8)+1);const d=mr.ilog(t-1);this._couplingAngle=new Int32Array(h),this._couplingMangitude=new Int32Array(h);for(let g=0;g<h;g++){const y=e.readBits(d),k=e.readBits(d);if(y===k||y>t-1||k>t-1)throw new Ht(It.Format,"Vorbis: Invalid magnitude or angle in mapping header!");this._couplingAngle[g]=k,this._couplingMangitude[g]=y}if(e.readBits(2)!==0)throw new Ht(It.Format,"Vorbis: Reserved bits not 0 in mapping header.");const p=new Int32Array(t);if(c>1){for(let g=0;g<t;g++)if(p[g]=e.readBits(4),p[g]>c)throw new Ht(It.Format,"Vorbis: Invalid channel mux submap index in mapping header!")}this._submapFloor=new Array(c),this._submapResidue=new Array(c);for(let g=0;g<c;g++){e.skipBits(8);const y=e.readBits(8);if(y>=i.length)throw new Ht(It.Format,"Vorbis: Invalid floor number in mapping header!");const k=e.readBits(8);if(k>=s.length)throw new Ht(It.Format,"Vorbis: Invalid residue number in mapping header!");this._submapFloor[g]=i[y],this._submapResidue[g]=s[k]}this._channelFloor=new Array(t),this._channelResidue=new Array(t);for(let g=0;g<t;g++)this._channelFloor[g]=this._submapFloor[p[g]],this._channelResidue[g]=this._submapResidue[p[g]];this._mdct=a}decodePacket(e,t,i){const s=t>>1,a=new Array(this._channelFloor.length),o=new Array(this._channelFloor.length);o.fill(!1);for(let c=0;c<this._channelFloor.length;c++)a[c]=this._channelFloor[c].unpack(e,t,c),o[c]=!a[c].executeChannel,i[c].fill(0,0,s);for(let c=0;c<this._couplingAngle.length;c++)(a[this._couplingAngle[c]].executeChannel||a[this._couplingMangitude[c]].executeChannel)&&(a[this._couplingAngle[c]].forceEnergy=!0,a[this._couplingMangitude[c]].forceEnergy=!0);for(let c=0;c<this._submapFloor.length;c++){for(let h=0;h<this._channelFloor.length;h++)(this._submapFloor[c]!==this._channelFloor[h]||this._submapResidue[c]!==this._channelResidue[h])&&(a[h].forceNoEnergy=!0);this._submapResidue[c].decode(e,o,t,i)}for(let c=this._couplingAngle.length-1;c>=0;c--)if(a[this._couplingAngle[c]].executeChannel||a[this._couplingMangitude[c]].executeChannel){const h=i[this._couplingMangitude[c]],d=i[this._couplingAngle[c]];for(let p=0;p<s;p++){let g,y;const k=h[p],_=d[p];k>0?_>0?(g=k,y=k-_):(y=k,g=k+_):_>0?(g=k,y=k+_):(y=k,g=k-_),h[p]=g,d[p]=y}}for(let c=0;c<this._channelFloor.length;c++)a[c].executeChannel?(this._channelFloor[c].apply(a[c],t,i[c]),this._mdct.reverse(i[c],t)):i[c].fill(0,s,s*2)}}class lv{packetStartIndex=0;packetTotalLength=0;packetValidLength=0}class dR{overlapInfo=new lv;windowIndex=0}class fR{samplePosition=null;constructor(e=null){this.samplePosition=e}}class Pn{static _piHalf=3.1415926539/2;_channels;_blockFlag;_blockSize;_mapping;_windows;_overlapInfo=null;constructor(e,t,i,s,a){if(this._channels=t,this._blockFlag=e.readBit(),e.readBits(32)!==0)throw new Ht(It.Format,"Vorbis: Mode header had invalid window or transform type!");const o=e.readBits(8);if(o>=a.length)throw new Ht(It.Format,"Vorbis: Mode header had invalid mapping index!");this._mapping=a[o],this._blockFlag?(this._blockSize=s,this._windows=[Pn._calcWindow(i,s,i),Pn._calcWindow(s,s,i),Pn._calcWindow(i,s,s),Pn._calcWindow(s,s,s)],this._overlapInfo=[Pn._calcOverlap(i,s,i),Pn._calcOverlap(s,s,i),Pn._calcOverlap(i,s,s),Pn._calcOverlap(s,s,s)]):(this._blockSize=i,this._windows=[Pn._calcWindow(i,i,i)])}decode(e,t){const i=this._getPacketInfo(e);this._mapping.decodePacket(e,this._blockSize,t);const s=this._windows[i.windowIndex];for(let a=0;a<this._blockSize;a++)for(let o=0;o<this._channels;o++)t[o][a]*=s[a];return i.overlapInfo}_getPacketInfo(e){const t=new dR;if(this._blockFlag){const i=e.readBit(),s=e.readBit();t.windowIndex=(i?1:0)+(s?2:0);const a=this._overlapInfo[t.windowIndex];t.overlapInfo.packetStartIndex=a.packetStartIndex,t.overlapInfo.packetValidLength=a.packetValidLength,t.overlapInfo.packetTotalLength=a.packetTotalLength}else t.windowIndex=0,t.overlapInfo.packetStartIndex=0,t.overlapInfo.packetValidLength=this._blockSize/2,t.overlapInfo.packetTotalLength=this._blockSize;return t}static _calcWindow(e,t,i){const s=new Float32Array(t),a=e/2,o=t,c=i/2,h=o/4-a/2,d=o-o/4-c/2;for(let p=0;p<a;p++){let g=Math.sin((p+.5)/a*Pn._piHalf);g*=g,s[h+p]=Math.sin(g*Pn._piHalf)}for(let p=h+a;p<d;p++)s[p]=1;for(let p=0;p<c;p++){let g=Math.sin((c-p-.5)/c*Pn._piHalf);g*=g,s[d+p]=Math.sin(g*Pn._piHalf)}return s}static _calcOverlap(e,t,i){const s=e/4,a=i/4,o=t/4-s,c=t/4*3+a,h=c-a*2,d=new lv;return d.packetStartIndex=o,d.packetValidLength=h,d.packetTotalLength=c,d}}class Oo{static _pi=3.141592653589793;_n;_n2;_n4;_n8;_ld;_a;_b;_c;_bitrev;constructor(e){this._n=e,this._n2=e>>1,this._n4=this._n2>>1,this._n8=this._n4>>1,this._ld=mr.ilog(e)-1,this._a=new Float32Array(this._n2),this._b=new Float32Array(this._n2),this._c=new Float32Array(this._n4);let t=0,i=0;for(;t<this._n4;++t,i+=2)this._a[i]=Math.cos(4*t*Oo._pi/e),this._a[i+1]=-Math.sin(4*t*Oo._pi/e),this._b[i]=Math.cos((i+1)*Oo._pi/e/2)*.5,this._b[i+1]=Math.sin((i+1)*Oo._pi/e/2)*.5;for(t=0,i=0;t<this._n8;++t,i+=2)this._c[i]=Math.cos(2*(i+1)*Oo._pi/e),this._c[i+1]=-Math.sin(2*(i+1)*Oo._pi/e);this._bitrev=new Uint16Array(this._n8);for(let s=0;s<this._n8;++s)this._bitrev[s]=it.int32ToUint16(mr.bitReverse(s,this._ld-3)<<2)}calcReverse(e){let t,i;const s=new Float32Array(this._n2);{let o=this._n2-2,c=0,h=0;const d=this._n2;for(;h!==d;)s[o+1]=e[h]*this._a[c]-e[h+2]*this._a[c+1],s[o]=e[h]*this._a[c+1]+e[h+2]*this._a[c],o-=2,c+=2,h+=4;for(h=this._n2-3;o>=0;)s[o+1]=-e[h+2]*this._a[c]- -e[h]*this._a[c+1],s[o]=-e[h+2]*this._a[c+1]+-e[h]*this._a[c],o-=2,c+=2,h-=4}t=e,i=s;{let o=this._n2-8,c=this._n4,h=0,d=this._n4,p=0;for(;o>=0;){let g,y;y=i[c+1]-i[h+1],g=i[c]-i[h],t[d+1]=i[c+1]+i[h+1],t[d]=i[c]+i[h],t[p+1]=y*this._a[o+4]-g*this._a[o+5],t[p]=g*this._a[o+4]+y*this._a[o+5],y=i[c+3]-i[h+3],g=i[c+2]-i[h+2],t[d+3]=i[c+3]+i[h+3],t[d+2]=i[c+2]+i[h+2],t[p+3]=y*this._a[o]-g*this._a[o+1],t[p+2]=g*this._a[o]+y*this._a[o+1],o-=8,d+=4,p+=4,c+=4,h+=4}}this._step3Iter0Loop(this._n>>4,t,this._n2-1-this._n4*0,-this._n8),this._step3Iter0Loop(this._n>>4,t,this._n2-1-this._n4*1,-this._n8),this._step3InnerRLoop(this._n>>5,t,this._n2-1-this._n8*0,-(this._n>>4),16),this._step3InnerRLoop(this._n>>5,t,this._n2-1-this._n8*1,-(this._n>>4),16),this._step3InnerRLoop(this._n>>5,t,this._n2-1-this._n8*2,-(this._n>>4),16),this._step3InnerRLoop(this._n>>5,t,this._n2-1-this._n8*3,-(this._n>>4),16);let a=2;for(;a<this._ld-3>>1;++a){const o=this._n>>a+2,c=o>>1,h=1<<a+1;for(let d=0;d<h;++d)this._step3InnerRLoop(this._n>>a+4,t,this._n2-1-o*d,-c,1<<a+3)}for(;a<this._ld-6;++a){const o=this._n>>a+2,c=1<<a+3,h=o>>1,d=this._n>>a+6,p=1<<a+1;let g=this._n2-1,y=0;for(let k=d;k>0;--k)this._step3InnerSLoop(p,t,g,-h,y,c,o),y+=c*4,g-=8}this._step3InnerSLoopLd654(this._n>>5,t,this._n2-1,this._n);{let o=0,c=this._n4-4,h=this._n2-4;for(;c>=0;){let d;d=this._bitrev[o],i[h+3]=t[d],i[h+2]=t[d+1],i[c+3]=t[d+2],i[c+2]=t[d+3],d=this._bitrev[o+1],i[h+1]=t[d],i[h]=t[d+1],i[c+1]=t[d+2],i[c]=t[d+3],c-=4,h-=4,o+=2}}{let o=0,c=0,h=this._n2-4;for(;c<h;){let d,p,g,y,k,_;d=i[c]-i[h+2],p=i[c+1]+i[h+3],g=this._c[o+1]*d+this._c[o]*p,y=this._c[o+1]*p-this._c[o]*d,k=i[c]+i[h+2],_=i[c+1]-i[h+3],i[c]=k+g,i[c+1]=_+y,i[h+2]=k-g,i[h+3]=y-_,d=i[c+2]-i[h],p=i[c+3]+i[h+1],g=this._c[o+3]*d+this._c[o+2]*p,y=this._c[o+3]*p-this._c[o+2]*d,k=i[c+2]+i[h],_=i[c+3]-i[h+1],i[c+2]=k+g,i[c+3]=_+y,i[h]=k-g,i[h+1]=y-_,o+=4,c+=4,h-=4}}{let o=this._n2-8,c=this._n2-8,h=0,d=this._n2-4,p=this._n2,g=this._n-4;for(;c>=0;){let y,k,_,w;w=s[c+6]*this._b[o+7]-s[c+7]*this._b[o+6],_=-s[c+6]*this._b[o+6]-s[c+7]*this._b[o+7],e[h]=w,e[d+3]=-w,e[p]=_,e[g+3]=_,k=s[c+4]*this._b[o+5]-s[c+5]*this._b[o+4],y=-s[c+4]*this._b[o+4]-s[c+5]*this._b[o+5],e[h+1]=k,e[d+2]=-k,e[p+1]=y,e[g+2]=y,w=s[c+2]*this._b[o+3]-s[c+3]*this._b[o+2],_=-s[c+2]*this._b[o+2]-s[c+3]*this._b[o+3],e[h+2]=w,e[d+1]=-w,e[p+2]=_,e[g+1]=_,k=s[c]*this._b[o+1]-s[c+1]*this._b[o],y=-s[c]*this._b[o]-s[c+1]*this._b[o+1],e[h+3]=k,e[d]=-k,e[p+3]=y,e[g]=y,o-=8,c-=8,h+=4,p+=4,d-=4,g-=4}}}_step3InnerRLoop(e,t,i,s,a){let o,c,h=i,d=h+s,p=0;for(let g=e>>2;g>0;--g)o=t[h]-t[d],c=t[h-1]-t[d-1],t[h]+=t[d],t[h-1]+=t[d-1],t[d]=o*this._a[p]-c*this._a[p+1],t[d-1]=c*this._a[p]+o*this._a[p+1],p+=a,o=t[h-2]-t[d-2],c=t[h-3]-t[d-3],t[h-2]+=t[d-2],t[h-3]+=t[d-3],t[d-2]=o*this._a[p]-c*this._a[p+1],t[d-3]=c*this._a[p]+o*this._a[p+1],p+=a,o=t[h-4]-t[d-4],c=t[h-5]-t[d-5],t[h-4]+=t[d-4],t[h-5]+=t[d-5],t[d-4]=o*this._a[p]-c*this._a[p+1],t[d-5]=c*this._a[p]+o*this._a[p+1],p+=a,o=t[h-6]-t[d-6],c=t[h-7]-t[d-7],t[h-6]+=t[d-6],t[h-7]+=t[d-7],t[d-6]=o*this._a[p]-c*this._a[p+1],t[d-7]=c*this._a[p]+o*this._a[p+1],p+=a,h-=8,d-=8}_step3Iter0Loop(e,t,i,s){let a=i,o=a+s,c=0;for(let h=e>>2;h>0;--h){let d,p;d=t[a]-t[o],p=t[a-1]-t[o-1],t[a]+=t[o],t[a-1]+=t[o-1],t[o]=d*this._a[c]-p*this._a[c+1],t[o-1]=p*this._a[c]+d*this._a[c+1],c+=8,d=t[a-2]-t[o-2],p=t[a-3]-t[o-3],t[a-2]+=t[o-2],t[a-3]+=t[o-3],t[o-2]=d*this._a[c]-p*this._a[c+1],t[o-3]=p*this._a[c]+d*this._a[c+1],c+=8,d=t[a-4]-t[o-4],p=t[a-5]-t[o-5],t[a-4]+=t[o-4],t[a-5]+=t[o-5],t[o-4]=d*this._a[c]-p*this._a[c+1],t[o-5]=p*this._a[c]+d*this._a[c+1],c+=8,d=t[a-6]-t[o-6],p=t[a-7]-t[o-7],t[a-6]+=t[o-6],t[a-7]+=t[o-7],t[o-6]=d*this._a[c]-p*this._a[c+1],t[o-7]=p*this._a[c]+d*this._a[c+1],c+=8,a-=8,o-=8}}_step3InnerSLoop(e,t,i,s,a,o,c){const h=this._a[a],d=this._a[a+1],p=this._a[a+o],g=this._a[a+o+1],y=this._a[a+o*2],k=this._a[a+o*2+1],_=this._a[a+o*3],w=this._a[a+o*3+1];let T,x,E=i,N=E+s;for(let v=e;v>0;--v)T=t[E]-t[N],x=t[E-1]-t[N-1],t[E]+=t[N],t[E-1]+=t[N-1],t[N]=T*h-x*d,t[N-1]=x*h+T*d,T=t[E-2]-t[N-2],x=t[E-3]-t[N-3],t[E-2]+=t[N-2],t[E-3]+=t[N-3],t[N-2]=T*p-x*g,t[N-3]=x*p+T*g,T=t[E-4]-t[N-4],x=t[E-5]-t[N-5],t[E-4]+=t[N-4],t[E-5]+=t[N-5],t[N-4]=T*y-x*k,t[N-5]=x*y+T*k,T=t[E-6]-t[N-6],x=t[E-7]-t[N-7],t[E-6]+=t[N-6],t[E-7]+=t[N-7],t[N-6]=T*_-x*w,t[N-7]=x*_+T*w,E-=c,N-=c}_step3InnerSLoopLd654(e,t,i,s){const a=s>>3,o=this._a[a];let c=i;const h=c-16*e;for(;c>h;){let d,p;d=t[c]-t[c-8],p=t[c-1]-t[c-9],t[c]+=t[c-8],t[c-1]+=t[c-9],t[c-8]=d,t[c-9]=p,d=t[c-2]-t[c-10],p=t[c-3]-t[c-11],t[c-2]+=t[c-10],t[c-3]+=t[c-11],t[c-10]=(d+p)*o,t[c-11]=(p-d)*o,d=t[c-12]-t[c-4],p=t[c-5]-t[c-13],t[c-4]+=t[c-12],t[c-5]+=t[c-13],t[c-12]=p,t[c-13]=d,d=t[c-14]-t[c-6],p=t[c-7]-t[c-15],t[c-6]+=t[c-14],t[c-7]+=t[c-15],t[c-14]=(d+p)*o,t[c-15]=(d-p)*o,this._iter54(t,c),this._iter54(t,c-8),c-=16}}_iter54(e,t){const i=e[t]-e[t-4],s=e[t]+e[t-4],a=e[t-2]+e[t-6],o=e[t-2]-e[t-6];e[t]=s+a,e[t-2]=s-a;const c=e[t-3]-e[t-7];e[t-4]=i+c,e[t-6]=i-c;const h=e[t-1]-e[t-5],d=e[t-1]+e[t-5],p=e[t-3]+e[t-7];e[t-1]=d+p,e[t-3]=d-p,e[t-5]=h-o,e[t-7]=h+o}}class pR{_setupCache=new Map;reverse(e,t){let i;this._setupCache.has(t)?i=this._setupCache.get(t):(i=new Oo(t),this._setupCache.set(t,i)),i.calcReverse(e)}}class Rb{_stream;_setup;_packets;_packetIndex=0;_nextPacketBuf;_prevPacketBuf;_prevPacketStart;_prevPacketEnd;_prevPacketStop;_currentPosition;_hasPosition;_eosFound;_modeFieldBits;constructor(e,t,i){this._stream=e,this._setup=t,this._packets=i,this._currentPosition=0,this._prevPacketBuf=null,this._prevPacketStart=0,this._prevPacketEnd=0,this._prevPacketStop=0,this._nextPacketBuf=null,this._eosFound=!1,this._hasPosition=!1,this._modeFieldBits=mr.ilog(t.modes.length-1)}decode(){let e=new Float32Array(this._packets[this._packets.length-1].granulePosition*this._stream.audioChannels);const t=new Float32Array(.2*this._stream.audioSampleRate*this._stream.audioChannels);let i=0,s=0;for(;i=this.read(t,0,t.length),i!==0;){if(s+i>=e.length){const a=new Float32Array(e.length+t.length);a.set(e,0),e=a}e.set(t.subarray(0,i),s),s+=i}return e.subarray(0,s)}read(e,t,i){if(i===0)return 0;let s=t;const a=t+i;for(;s<a;){if(this._prevPacketStart===this._prevPacketEnd){if(this._eosFound){this._nextPacketBuf=null,this._prevPacketBuf=null;break}const c=this._readNextPacket((s-t)/this._stream.audioChannels);c===null&&(this._prevPacketEnd=this._prevPacketStop),c!==null&&c.samplePosition!==null&&!this._hasPosition&&(this._hasPosition=!0,this._currentPosition=c.samplePosition-(this._prevPacketEnd-this._prevPacketStart)-(s-t)/this._stream.audioChannels)}const o=Math.min((a-s)/this._stream.audioChannels,this._prevPacketEnd-this._prevPacketStart);o>0&&(s+=this._copyBuffer(e,s,o))}return i=s-t,this._currentPosition+=i/this._stream.audioChannels,i}_copyBuffer(e,t,i){let s=t;for(;i>0;this._prevPacketStart++,i--)for(let a=0;a<this._stream.audioChannels;a++)e[s++]=this._prevPacketBuf[a][this._prevPacketStart];return s-t}_readNextPacket(e){const t=this._decodeNextPacket();if(this._eosFound=this._eosFound||t.isEndOfStream,t.curPacket==null)return null;if(t.samplePosition!==null&&t.isEndOfStream){const i=this._currentPosition+e+t.validLen-t.startIndex,s=t.samplePosition-i;s<0&&(t.validLen+=s,t.validLen<0&&(t.validLen=0))}return this._prevPacketEnd>0?(Rb._overlapBuffers(this._prevPacketBuf,t.curPacket,this._prevPacketStart,this._prevPacketStop,t.startIndex,this._stream.audioChannels),this._prevPacketStart=t.startIndex):this._prevPacketBuf==null&&(this._prevPacketStart=t.validLen),this._nextPacketBuf=this._prevPacketBuf,this._prevPacketEnd=t.validLen,this._prevPacketStop=t.totalLen,this._prevPacketBuf=t.curPacket,new fR(t.samplePosition)}static _overlapBuffers(e,t,i,s,a,o){for(;i<s;i++,a++)for(let c=0;c<o;c++)t[c][a]+=e[c][i]}_decodeNextPacket(){const e=new gR;let t=null;if(this._packetIndex>=this._packets.length)e.isEndOfStream=!0;else{t=this._packets[this._packetIndex++];const i=new mg(ss.fromBuffer(t.packetData));if(e.isEndOfStream=t.isEndOfStream,!i.readBit()){const s=this._setup.modes[i.readBits(this._modeFieldBits)];if(this._nextPacketBuf==null){this._nextPacketBuf=new Array(this._stream.audioChannels);for(let o=0;o<this._stream.audioChannels;o++)this._nextPacketBuf[o]=new Float32Array(this._stream.blocksize1)}const a=s.decode(i,this._nextPacketBuf);return e.startIndex=a.packetStartIndex,e.validLen=a.packetValidLength,e.totalLen=a.packetTotalLength,e.samplePosition=t.granulePosition,e.curPacket=this._nextPacketBuf,e}}return e}}class gR{curPacket=null;startIndex=0;validLen=0;totalLen=0;isEndOfStream=!1;samplePosition=null}var Bh;(function(n){n[n.IdentificationHeader=1]="IdentificationHeader",n[n.Comment=3]="Comment",n[n.SetupHeader=5]="SetupHeader"})(Bh||(Bh={}));class Fo{static vorbisHeaderMarker=new Uint8Array([118,111,114,98,105,115]);_packets;_packetIndex;constructor(e){this._packetIndex=-1,this._packets=e}read(){let e;for(;;){if(e=this._nextPacket(),e==null)return null;if(e.isBeginningOfStream){const t=this._readStream(e);if(t!=null)return t}}}_nextPacket(){return this._packetIndex++,this._packetIndex<this._packets.length?this._packets[this._packetIndex]:null}_readStream(e){const t=new j5;if(!this._readIdentificationHeader(t,e)||!this._readComments(this._nextPacket()))return null;const i=new eR;if(!this._readSetupHeader(t,i,this._nextPacket()))return null;const s=[];let a;for(;a=this._nextPacket(),!(a==null||(s.push(a),a.isEndOfStream)););const o=new Rb(t,i,s);return t.samples=o.decode(),t}_commonHeaderDecode(e,t){const i=new Uint8Array(7);if(t.read(i,0,i.length),i[0]!==e)return!1;for(let s=0;s<Fo.vorbisHeaderMarker.length;s++)if(i[1+s]!==Fo.vorbisHeaderMarker[s])return!1;return!0}_commonHeaderDecodeBit(e,t){const i=t.readBytes(7);if(i[0]!==e)return!1;for(let s=0;s<Fo.vorbisHeaderMarker.length;s++)if(i[1+s]!==Fo.vorbisHeaderMarker[s])return!1;return!0}_readIdentificationHeader(e,t){const i=ss.fromBuffer(t.packetData);if(!this._commonHeaderDecode(Bh.IdentificationHeader,i)||U.readUInt32LE(i)!==0||(e.audioChannels=i.readByte(),e.audioSampleRate=U.readUInt32LE(i),e.audioChannels<=0||e.audioSampleRate<=0))return!1;e.bitrateMaximum=U.readInt32LE(i),e.bitrateNominal=U.readInt32LE(i),e.bitrateMinimum=U.readInt32LE(i);const a=i.readByte();return e.blocksize0=1<<(a&15),e.blocksize1=1<<(a>>4),!(e.blocksize0>e.blocksize1||!Fo._isAllowedBlockSize(e.blocksize0)||!Fo._isAllowedBlockSize(e.blocksize0)||i.readByte()===0)}static _isAllowedBlockSize(e){switch(e){case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:return!0;default:return!1}}_readComments(e){if(e==null)return!1;const t=ss.fromBuffer(e.packetData);if(!this._commonHeaderDecode(Bh.Comment,t))return!1;const i=U.readUInt32LE(t);t.skip(i);const s=U.readUInt32LE(t);for(let o=0;o<s;o++){const c=U.readUInt32LE(t);t.skip(c)}return t.readByte()!==0}_readSetupHeader(e,t,i){if(i==null)return!1;const s=new mg(ss.fromBuffer(i.packetData)),a=new pR,o=new lp;if(!this._commonHeaderDecodeBit(Bh.SetupHeader,s))return!1;let c=s.readByte()+1;for(let h=0;h<c;h++)t.codebooks.push(new iR(s,o));c=s.readBits(6)+1;for(let h=0;h<c;h++)t.timeDomainTransforms.push(new nR(s));c=s.readBits(6)+1;for(let h=0;h<c;h++)t.floors.push(new oR(s,e.blocksize0,e.blocksize1,t.codebooks));c=s.readBits(6)+1;for(let h=0;h<c;h++)t.residues.push(new uR(s,e.audioChannels,t.codebooks));c=s.readBits(6)+1;for(let h=0;h<c;h++)t.mappings.push(new hR(s,e.audioChannels,t.floors,t.residues,a));c=s.readBits(6)+1;for(let h=0;h<c;h++)t.modes.push(new Pn(s,e.audioChannels,e.blocksize0,e.blocksize1,t.mappings));return!!s.readBit()}}class mR{streams=[];constructor(e){const i=new Z5(e).read(),s=new Fo(i);for(;;){const a=s.read();if(a==null)break;this.streams.push(a)}}}class cv{phdrs=[];pbags=[];pmods=[];pgens=[];insts=[];ibags=[];imods=[];igens=[];sHdrs=[];sampleData=new Uint8Array(0);_sampleCache=new Map;decodeSamples(e,t,i){const s=`${e}_${t}_${i}`;if(!this._sampleCache.has(s)){let a;const o=this.sampleData.slice(e,t);if(i)a=new mR(ss.fromBuffer(o)).streams[0].samples;else{const c=new DataView(o.buffer,o.byteOffset,o.length);a=new Float32Array(o.length/2);for(let h=0;h<a.length;h++)a[h]=c.getInt16(h*2,!0)/32767}return this._sampleCache.set(s,a),a}return this._sampleCache.get(s)}load(e){const t=new Na,i=new Na;if(!Na.load(null,t,e)||t.id!=="sfbk")throw new Rs("Soundfont is not a valid Soundfont2 file");for(;Na.load(t,i,e);){const s=new Na;if(i.id==="pdta")for(;Na.load(i,s,e);)switch(s.id){case"phdr":for(let a=0,o=s.size/DB.SizeInFile|0;a<o;a++)this.phdrs.push(new DB(e));break;case"pbag":for(let a=0,o=s.size/PB.SizeInFile|0;a<o;a++)this.pbags.push(new PB(e));break;case"pmod":for(let a=0,o=s.size/MB.SizeInFile|0;a<o;a++)this.pmods.push(new MB(e));break;case"pgen":for(let a=0,o=s.size/Yr.SizeInFile|0;a<o;a++)this.pgens.push(new Yr(e));break;case"inst":for(let a=0,o=s.size/EB.SizeInFile|0;a<o;a++)this.insts.push(new EB(e));break;case"ibag":for(let a=0,o=s.size/vB.SizeInFile|0;a<o;a++)this.ibags.push(new vB(e));break;case"imod":for(let a=0,o=s.size/NB.SizeInFile|0;a<o;a++)this.imods.push(new NB(e));break;case"igen":for(let a=0,o=s.size/CB.SizeInFile|0;a<o;a++)this.igens.push(new CB(e));break;case"shdr":for(let a=0,o=s.size/LB.SizeInFile|0;a<o;a++)this.sHdrs.push(new LB(e));break;default:e.position+=s.size;break}else if(i.id==="sdta")for(;Na.load(i,s,e);)switch(s.id){case"smpl":this.sampleData=new Uint8Array(s.size),e.read(this.sampleData,0,s.size);break;default:e.position+=s.size;break}else e.position+=i.size}}}class vB{static SizeInFile=4;instGenNdx;instModNdx;constructor(e){this.instGenNdx=U.readUInt16LE(e),this.instModNdx=U.readUInt16LE(e)}}class NB{static SizeInFile=10;modSrcOper;modDestOper;modAmount;modAmtSrcOper;modTransOper;constructor(e){this.modSrcOper=U.readUInt16LE(e),this.modDestOper=U.readUInt16LE(e),this.modAmount=U.readInt16LE(e),this.modAmtSrcOper=U.readUInt16LE(e),this.modTransOper=U.readUInt16LE(e)}}class CB{static SizeInFile=4;genOper;genAmount;constructor(e){this.genOper=U.readUInt16LE(e),this.genAmount=new uv(e)}}class EB{static SizeInFile=22;instName;instBagNdx;constructor(e){this.instName=U.read8BitStringLength(e,20),this.instBagNdx=U.readUInt16LE(e)}}class PB{static SizeInFile=4;genNdx;modNdx;constructor(e){this.genNdx=U.readUInt16LE(e),this.modNdx=U.readUInt16LE(e)}}class Yr{static SizeInFile=4;static GenInstrument=41;static GenKeyRange=43;static GenVelRange=44;static GenSampleId=53;genOper;genAmount;constructor(e){this.genOper=U.readUInt16LE(e),this.genAmount=new uv(e)}}class DB{static SizeInFile=38;presetName;preset;bank;presetBagNdx;library;genre;morphology;constructor(e){this.presetName=U.read8BitStringLength(e,20),this.preset=U.readUInt16LE(e),this.bank=U.readUInt16LE(e),this.presetBagNdx=U.readUInt16LE(e),this.library=U.readUInt32LE(e),this.genre=U.readUInt32LE(e),this.morphology=U.readUInt32LE(e)}}class MB{static SizeInFile=10;modSrcOper;modDestOper;modAmount;modAmtSrcOper;modTransOper;constructor(e){this.modSrcOper=U.readUInt16LE(e),this.modDestOper=U.readUInt16LE(e),this.modAmount=U.readUInt16LE(e),this.modAmtSrcOper=U.readUInt16LE(e),this.modTransOper=U.readUInt16LE(e)}}class LB{static SizeInFile=46;sampleName;start;end;startLoop;endLoop;sampleRate;originalPitch;pitchCorrection;sampleLink;sampleType;constructor(e){this.sampleName=U.read8BitStringLength(e,20),this.start=U.readUInt32LE(e),this.end=U.readUInt32LE(e),this.startLoop=U.readUInt32LE(e),this.endLoop=U.readUInt32LE(e),this.sampleRate=U.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=U.readSInt8(e),this.sampleLink=U.readUInt16LE(e),this.sampleType=U.readUInt16LE(e)}}class uv{wordAmount;get shortAmount(){return it.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return this.wordAmount&255}get highByteAmount(){return(this.wordAmount&65280)>>8&255}constructor(e){this.wordAmount=U.readUInt16LE(e)}}class yR{presetIndex=0;bank=0;pitchWheel=0;perNotePitchWheel=new Map;midiPan=0;midiVolume=0;midiExpression=0;midiRpn=0;midiData=0;panOffset=0;gainDb=0;pitchRange=0;tuning=0;mixVolume=0;mute=!1;solo=!1}class bR{activeChannel=0;channelList=[];setupVoice(e,t){const i=this.channelList[this.activeChannel],s=t.region.pan+i.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=i.mixVolume,t.noteGainDb+=i.gainDb,t.updatePitchRatio(i,e.outSampleRate),s<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):s>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-s),t.panFactorRight=Math.sqrt(.5+s))}}var Xr;(function(n){n[n.None=0]="None",n[n.Continuous=1]="Continuous",n[n.Sustain=2]="Sustain"})(Xr||(Xr={}));var Ol;(function(n){n[n.StereoInterleaved=0]="StereoInterleaved",n[n.StereoUnweaved=1]="StereoUnweaved",n[n.Mono=2]="Mono"})(Ol||(Ol={}));class SR{name="";presetNumber=0;bank=0;regions=null}class xs{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,e*.05):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}}class mh{delay=0;attack=0;hold=0;decay=0;sustain=0;release=0;keynumToHold=0;keynumToDecay=0;constructor(e){e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:xs.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:xs.timecents2Secs(this.attack),this.release=this.release<-11950?0:xs.timecents2Secs(this.release),this.keynumToHold===0&&(this.hold=this.hold<-11950?0:xs.timecents2Secs(this.hold)),this.keynumToDecay===0&&(this.decay=this.decay<-11950?0:xs.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:e?this.sustain=xs.decibelsToGain(-this.sustain/10):this.sustain=1-this.sustain/1e3}}var At;(function(n){n[n.StartAddrsOffset=0]="StartAddrsOffset",n[n.EndAddrsOffset=1]="EndAddrsOffset",n[n.StartloopAddrsOffset=2]="StartloopAddrsOffset",n[n.EndloopAddrsOffset=3]="EndloopAddrsOffset",n[n.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",n[n.ModLfoToPitch=5]="ModLfoToPitch",n[n.VibLfoToPitch=6]="VibLfoToPitch",n[n.ModEnvToPitch=7]="ModEnvToPitch",n[n.InitialFilterFc=8]="InitialFilterFc",n[n.InitialFilterQ=9]="InitialFilterQ",n[n.ModLfoToFilterFc=10]="ModLfoToFilterFc",n[n.ModEnvToFilterFc=11]="ModEnvToFilterFc",n[n.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",n[n.ModLfoToVolume=13]="ModLfoToVolume",n[n.Unused1=14]="Unused1",n[n.ChorusEffectsSend=15]="ChorusEffectsSend",n[n.ReverbEffectsSend=16]="ReverbEffectsSend",n[n.Pan=17]="Pan",n[n.Unused2=18]="Unused2",n[n.Unused3=19]="Unused3",n[n.Unused4=20]="Unused4",n[n.DelayModLFO=21]="DelayModLFO",n[n.FreqModLFO=22]="FreqModLFO",n[n.DelayVibLFO=23]="DelayVibLFO",n[n.FreqVibLFO=24]="FreqVibLFO",n[n.DelayModEnv=25]="DelayModEnv",n[n.AttackModEnv=26]="AttackModEnv",n[n.HoldModEnv=27]="HoldModEnv",n[n.DecayModEnv=28]="DecayModEnv",n[n.SustainModEnv=29]="SustainModEnv",n[n.ReleaseModEnv=30]="ReleaseModEnv",n[n.KeynumToModEnvHold=31]="KeynumToModEnvHold",n[n.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",n[n.DelayVolEnv=33]="DelayVolEnv",n[n.AttackVolEnv=34]="AttackVolEnv",n[n.HoldVolEnv=35]="HoldVolEnv",n[n.DecayVolEnv=36]="DecayVolEnv",n[n.SustainVolEnv=37]="SustainVolEnv",n[n.ReleaseVolEnv=38]="ReleaseVolEnv",n[n.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",n[n.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",n[n.Instrument=41]="Instrument",n[n.Reserved1=42]="Reserved1",n[n.KeyRange=43]="KeyRange",n[n.VelRange=44]="VelRange",n[n.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",n[n.Keynum=46]="Keynum",n[n.Velocity=47]="Velocity",n[n.InitialAttenuation=48]="InitialAttenuation",n[n.Reserved2=49]="Reserved2",n[n.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",n[n.CoarseTune=51]="CoarseTune",n[n.FineTune=52]="FineTune",n[n.SampleID=53]="SampleID",n[n.SampleModes=54]="SampleModes",n[n.Reserved3=55]="Reserved3",n[n.ScaleTuning=56]="ScaleTuning",n[n.ExclusiveClass=57]="ExclusiveClass",n[n.OverridingRootKey=58]="OverridingRootKey",n[n.Unused5=59]="Unused5",n[n.EndOper=60]="EndOper"})(At||(At={}));class $r{static _noSamples=new Float32Array(0);loopMode=Xr.None;samples=$r._noSamples;sampleRate=0;loKey=0;hiKey=0;loVel=0;hiVel=0;group=0;offset=0;end=0;loopStart=0;loopEnd=0;transpose=0;tune=0;pitchKeyCenter=0;pitchKeyTrack=0;attenuation=0;pan=0;ampEnv=new mh;modEnv=new mh;initialFilterQ=0;initialFilterFc=0;modEnvToPitch=0;modEnvToFilterFc=0;modLfoToFilterFc=0;modLfoToVolume=0;delayModLFO=0;freqModLFO=0;modLfoToPitch=0;delayVibLFO=0;freqVibLFO=0;vibLfoToPitch=0;constructor(e){e&&(this.loopMode=e.loopMode,this.samples=e.samples,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new mh(e.ampEnv),this.modEnv=new mh(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=Xr.None,this.samples=$r._noSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case At.StartAddrsOffset:this.offset+=it.int16ToUint32(t.shortAmount);break;case At.EndAddrsOffset:this.end+=it.int16ToUint32(t.shortAmount);break;case At.StartloopAddrsOffset:this.loopStart+=it.int16ToUint32(t.shortAmount);break;case At.EndloopAddrsOffset:this.loopEnd+=it.int16ToUint32(t.shortAmount);break;case At.StartAddrsCoarseOffset:this.offset+=it.int16ToUint32(t.shortAmount)*32768;break;case At.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case At.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case At.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case At.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case At.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case At.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case At.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case At.EndAddrsCoarseOffset:this.end+=it.int16ToUint32(t.shortAmount)*32768;break;case At.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case At.Pan:this.pan=t.shortAmount/1e3;break;case At.DelayModLFO:this.delayModLFO=t.shortAmount;break;case At.FreqModLFO:this.freqModLFO=t.shortAmount;break;case At.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case At.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case At.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case At.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case At.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case At.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case At.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case At.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case At.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case At.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case At.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case At.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case At.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case At.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case At.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case At.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case At.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case At.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case At.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case At.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case At.StartloopAddrsCoarseOffset:this.loopStart+=it.int16ToUint32(t.shortAmount)*32768;break;case At.InitialAttenuation:this.attenuation+=t.shortAmount*.1;break;case At.EndloopAddrsCoarseOffset:this.loopEnd+=it.int16ToUint32(t.shortAmount)*32768;break;case At.CoarseTune:this.transpose+=t.shortAmount;break;case At.FineTune:this.tune+=t.shortAmount;break;case At.SampleModes:this.loopMode=(t.wordAmount&3)===3?Xr.Sustain:(t.wordAmount&3)===1?Xr.Continuous:Xr.None;break;case At.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case At.ExclusiveClass:this.group=t.wordAmount;break;case At.OverridingRootKey:this.pitchKeyCenter=t.shortAmount;break}}}var hi;(function(n){n[n.None=0]="None",n[n.Delay=1]="Delay",n[n.Attack=2]="Attack",n[n.Hold=3]="Hold",n[n.Decay=4]="Decay",n[n.Sustain=5]="Sustain",n[n.Release=6]="Release",n[n.Done=7]="Done"})(hi||(hi={}));class up{static _fastReleaseTime=.01;level=0;slope=0;samplesUntilNextSegment=0;segment=hi.None;midiVelocity=0;parameters=null;segmentIsExponential=!1;isAmpEnv=!1;nextSegment(e,t){if(this.parameters)for(;;)switch(e){case hi.None:if(this.samplesUntilNextSegment=this.parameters.delay*t|0,this.samplesUntilNextSegment>0){this.segment=hi.Delay,this.segmentIsExponential=!1,this.level=0,this.slope=0;return}e=hi.Delay;break;case hi.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*t|0,this.samplesUntilNextSegment>0){this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*t|0),this.segment=hi.Attack,this.segmentIsExponential=!1,this.level=0,this.slope=1/this.samplesUntilNextSegment;return}e=hi.Attack;break;case hi.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*t|0,this.samplesUntilNextSegment>0){this.segment=hi.Hold,this.segmentIsExponential=!1,this.level=1,this.slope=0;return}e=hi.Hold;break;case hi.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*t|0,this.samplesUntilNextSegment>0){if(this.segment=hi.Decay,this.level=1,this.isAmpEnv){const i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/i|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*t|0,this.segmentIsExponential=!1;return}e=hi.Decay;break;case hi.Decay:this.segment=hi.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,this.segmentIsExponential=!1;return;case hi.Sustain:if(this.segment=hi.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?up._fastReleaseTime:this.parameters.release)*t|0,this.isAmpEnv){const i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;default:this.segment=hi.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,this.samplesUntilNextSegment=134217727;return}}setup(e,t,i,s,a){this.parameters=new mh(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-t),this.parameters.hold=this.parameters.hold<-1e4?0:xs.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-t),this.parameters.decay=this.parameters.decay<-1e4?0:xs.timecents2Secs(this.parameters.decay)),this.midiVelocity=i|0,this.isAmpEnv=s,this.nextSegment(hi.None,a)}process(e,t){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,t)}}class AB{samplesUntil=0;level=0;delta=0;setup(e,t,i){this.samplesUntil=e*i|0,this.delta=4*xs.cents2Hertz(t)/i,this.level=0}process(e){if(this.samplesUntil>e){this.samplesUntil-=e;return}this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level)}}class RB{qInv=0;a0=0;a1=0;b1=0;b2=0;z1=0;z2=0;active=!1;constructor(e){e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){const t=Math.tan(Math.PI*e),i=t*t,s=1/(1+t*this.qInv+i);this.a0=i*s,this.a1=2*this.a0,this.b1=2*(i-1)*s,this.b2=(1-t*this.qInv+i)*s}process(e){const t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class hp{static renderEffectSampleBlock=Xe.MicroBufferSize;playingPreset=0;playingKey=0;playingChannel=0;region=null;pitchInputTimecents=0;pitchOutputFactor=0;sourceSamplePosition=0;noteGainDb=0;panFactorLeft=0;panFactorRight=0;playIndex=0;loopStart=0;loopEnd=0;ampEnv=new up;modEnv=new up;lowPass=new RB;modLfo=new AB;vibLfo=new AB;mixVolume=0;mute=!1;updatePitchRatio(e,t){let i=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(i+=e.perNotePitchWheel.get(this.playingKey)-8192);const s=i===8192?e.tuning:i/16383*e.pitchRange*2-e.pitchRange+e.tuning;this.calcPitchRatio(s,t)}calcPitchRatio(e,t){if(!this.region)return;const i=this.playingKey+this.region.transpose+this.region.tune/100;let s=this.region.pitchKeyCenter+(i-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);e!==0&&(s+=e),this.pitchInputTimecents=s*100,this.pitchOutputFactor=this.region.sampleRate/(xs.timecents2Secs(this.region.pitchKeyCenter*100)*t)}end(e){this.region&&(this.ampEnv.nextSegment(hi.Sustain,e),this.modEnv.nextSegment(hi.Sustain,e),this.region.loopMode===Xr.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(hi.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(hi.Sustain,e)}render(e,t,i,s,a){if(!this.region)return;const o=this.region,c=o.samples;let h=0,d=e.outputMode===Ol.StereoUnweaved?s:-1;const p=o.modEnvToPitch!==0||o.modEnvToFilterFc!==0,g=this.modLfo.delta>0&&(o.modLfoToPitch!==0||o.modLfoToFilterFc!==0||o.modLfoToVolume!==0),y=this.vibLfo.delta>0&&o.vibLfoToPitch!==0,k=this.loopStart<this.loopEnd,_=this.loopStart,w=this.loopEnd,T=o.end,x=w+1;let E=this.sourceSamplePosition;const N=new RB(this.lowPass),v=o.modLfoToFilterFc!==0||o.modEnvToFilterFc!==0;let L=0,A=0,D=0,H=0;const J=o.modLfoToPitch!==0||o.modEnvToPitch!==0||o.vibLfoToPitch!==0;let K=0,Y=0,C=0,Q=0;const Z=o.modLfoToVolume!==0;let le=0,F=0;for(v?(L=e.outSampleRate,A=o.initialFilterFc,D=o.modLfoToFilterFc,H=o.modEnvToFilterFc):(L=0,A=0,D=0,H=0),J?(K=0,Y=o.modLfoToPitch,C=o.vibLfoToPitch,Q=o.modEnvToPitch):(K=xs.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,Y=0,C=0,Q=0),Z?F=o.modLfoToVolume*.1:(le=xs.decibelsToGain(this.noteGainDb),F=0);s>0;){let re,_e,ve=0,Ve=s>hp.renderEffectSampleBlock?hp.renderEffectSampleBlock:s;if(s-=Ve,v){const R=A+this.modLfo.level*D+this.modEnv.level*H;N.active=R<=13500,N.active&&N.setup(xs.cents2Hertz(R)/L)}switch(J&&(K=xs.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*Y+this.vibLfo.level*C+this.modEnv.level*Q))*this.pitchOutputFactor),Z&&(le=xs.decibelsToGain(this.noteGainDb+this.modLfo.level*F)),re=le*this.ampEnv.level,a?re=0:re*=this.mixVolume,this.ampEnv.process(Ve,e.outSampleRate),p&&this.modEnv.process(Ve,e.outSampleRate),g&&this.modLfo.process(Ve),y&&this.vibLfo.process(Ve),e.outputMode){case Ol.StereoInterleaved:for(_e=re*this.panFactorLeft,ve=re*this.panFactorRight;Ve-- >0&&E<T;){const R=E|0,te=R>=w&&k?_:R+1,we=E-R;let Ee=c[R]*(1-we)+c[te]*we;N.active&&(Ee=N.process(Ee)),t[i+h]+=Ee*_e,h++,t[i+h]+=Ee*ve,h++,E+=K,E>=x&&k&&(E-=w-_+1)}break;case Ol.StereoUnweaved:for(_e=re*this.panFactorLeft,ve=re*this.panFactorRight;Ve-- >0&&E<T;){const R=E|0,te=R>=w&&k?_:R+1,we=E-R;let Ee=c[R]*(1-we)+c[te]*we;N.active&&(Ee=N.process(Ee)),t[i+h]+=Ee*_e,h++,t[i+d]+=Ee*ve,d++,E+=K,E>=x&&k&&(E-=w-_+1)}break;case Ol.Mono:for(;Ve-- >0&&E<T;){const R=E|0,te=R>=w&&k?_:R+1,we=E-R;let Ee=c[R]*(1-we)+c[te]*we;N.active&&(Ee=N.process(Ee)),t[i+h]=Ee*re,h++,E+=K,E>=x&&k&&(E-=w-_+1)}break}if(E>=T||this.ampEnv.segment===hi.Done){this.kill();return}}this.sourceSamplePosition=E,(N.active||v)&&(this.lowPass=N)}kill(){this.playingPreset=-1}}class OB{value;next;constructor(e){this.value=e}}class Ob{_head;_tail;get isEmpty(){return this._head===void 0}clear(){this._head=void 0,this._tail=void 0}enqueue(e){const t=new OB(e);this._tail?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t)}enqueueFront(e){const t=new OB(e);t.next=this._head,this._head?this._head=t:(this._head=t,this._tail=t)}peek(){const e=this._head;if(e)return e.value}dequeue(){const e=this._head;if(!e)return;const t=e.next;return this._head=t,t||(this._tail=void 0),e.value}}var ni;(function(n){n[n.BankSelectCoarse=0]="BankSelectCoarse",n[n.ModulationCoarse=1]="ModulationCoarse",n[n.DataEntryCoarse=6]="DataEntryCoarse",n[n.VolumeCoarse=7]="VolumeCoarse",n[n.PanCoarse=10]="PanCoarse",n[n.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",n[n.BankSelectFine=32]="BankSelectFine",n[n.ModulationFine=33]="ModulationFine",n[n.DataEntryFine=38]="DataEntryFine",n[n.VolumeFine=39]="VolumeFine",n[n.PanFine=42]="PanFine",n[n.ExpressionControllerFine=43]="ExpressionControllerFine",n[n.HoldPedal=64]="HoldPedal",n[n.LegatoPedal=68]="LegatoPedal",n[n.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",n[n.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",n[n.RegisteredParameterFine=100]="RegisteredParameterFine",n[n.RegisteredParameterCourse=101]="RegisteredParameterCourse",n[n.AllSoundOff=120]="AllSoundOff",n[n.ResetControllers=121]="ResetControllers",n[n.AllNotesOff=123]="AllNotesOff"})(ni||(ni={}));class yg{_midiEventQueue=new Ob;_mutedChannels=new Map;_soloChannels=new Map;_isAnySolo=!1;_transpositionPitches=new Map;_liveTranspositionPitches=new Map;currentTempo=0;timeSignatureNumerator=0;timeSignatureDenominator=0;constructor(e){this.outSampleRate=e}synthesize(e,t,i){return this._fillWorkingBuffer(e,t,i)}synthesizeSilent(e){this._fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){const i=this._channelInit(e);for(const s of this._voices)s.playingChannel===e&&s.playingPreset!==-1&&(s.mixVolume=t);i.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(e,t){let i=0;this._liveTranspositionPitches.has(e)&&(i=this._liveTranspositionPitches.get(e)),t===0?this._liveTranspositionPitches.delete(e):this._liveTranspositionPitches.set(e,t);for(const s of this._voices)if(s.playingChannel===e&&s.playingChannel!==9){let a=0;a-=i,a+=t,s.playingKey+=a,this._channels&&s.updatePitchRatio(this._channels.channelList[s.playingChannel],this.outSampleRate)}}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const i of this._voices)if(i.playingChannel>=0&&i.playingChannel!==9){let s=0;t.has(i.playingChannel)&&(s-=t.get(i.playingChannel)),e.has(i.playingChannel)&&(s+=e.get(i.playingChannel)),i.playingKey+=s,this._channels&&i.updatePitchRatio(this._channels.channelList[i.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}_fillWorkingBuffer(e,t,i){const s=this._isAnySolo,a=[];for(;!this._midiEventQueue.isEmpty;){const o=this._midiEventQueue.dequeue();o.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(Xe.MetronomeChannel,Xe.MetronomeKey),this.channelNoteOn(Xe.MetronomeChannel,Xe.MetronomeKey,95/127)):o.event&&this.processMidiMessage(o.event),a.push(o)}for(const o of this._voices)if(o.playingPreset!==-1){const c=o.playingChannel,h=this._mutedChannels.has(c)||s&&c!==Xe.MetronomeChannel&&!this._soloChannels.has(c);e?o.render(this,e,t,i,h):o.kill()}return a}processMidiMessage(e){switch(e.type){case Rt.TimeSignature:const i=e;this.timeSignatureNumerator=i.numerator,this.timeSignatureDenominator=Math.pow(2,i.denominatorIndex);break;case Rt.NoteOn:const s=e;this.channelNoteOn(s.channel,s.noteKey,s.noteVelocity/127);break;case Rt.NoteOff:const a=e;this.channelNoteOff(a.channel,a.noteKey);break;case Rt.ControlChange:const o=e;this.channelMidiControl(o.channel,o.controller,o.value);break;case Rt.ProgramChange:const c=e;this.channelSetPresetNumber(c.channel,c.program,c.channel===9);break;case Rt.TempoChange:const h=e;this.currentTempo=h.beatsPerMinute;break;case Rt.PitchBend:const d=e;this.channelSetPitchWheel(d.channel,d.value);break;case Rt.PerNotePitchBend:const p=e;let g=p.value;g=g*Xe.MaxPitchWheel/Xe.MaxPitchWheel20,this.channelSetPerNotePitchWheel(p.channel,p.noteKey,g);break}}get metronomeVolume(){return this.channelGetMixVolume(Xe.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(Xe.MetronomeChannel,e),e>0&&(this.channelSetVolume(Xe.MetronomeChannel,1),this.channelSetPresetNumber(Xe.MetronomeChannel,0,!0))}get masterVolume(){return xs.decibelsToGain(this.globalGainDb)}set masterVolume(e){const t=xs.gainToDecibels(e),i=t-this.globalGainDb;if(i!==0){for(const s of this._voices)s.playingPreset!==-1&&(s.noteGainDb+=i);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<hi.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}presets=null;_voices=[];_channels=null;_voicePlayIndex=0;get presetCount(){return this.presets?.length??0}outputMode=Ol.StereoInterleaved;outSampleRate=0;globalGainDb=0;reset(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<hi.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,i){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=i}noteOn(e,t,i){if(!this.presets)return;const s=i*127|0;if(e<0||e>=this.presets.length)return;if(i<=0){this.noteOff(e,t);return}const a=this._voicePlayIndex++;for(const o of this.presets[e].regions){if(t<o.loKey||t>o.hiKey||s<o.loVel||s>o.hiVel)continue;let c=null;if(o.group!==0)for(const p of this._voices)p.playingPreset===e&&p.region.group===o.group?p.endQuick(this.outSampleRate):p.playingPreset===-1&&!c&&(c=p);else for(const p of this._voices)p.playingPreset===-1&&(c=p);if(!c){for(let p=0;p<4;p++){const g=new hp;g.playingPreset=-1,this._voices.push(g)}c=this._voices[this._voices.length-4]}c.region=o,c.playingPreset=e,c.playingKey=t,c.playIndex=a,c.noteGainDb=this.globalGainDb-o.attenuation-xs.gainToDecibels(1/i),this._channels?this._channels.setupVoice(this,c):(c.calcPitchRatio(0,this.outSampleRate),c.panFactorLeft=Math.sqrt(.5-o.pan),c.panFactorRight=Math.sqrt(.5+o.pan)),c.sourceSamplePosition=o.offset;const h=o.loopMode!==Xr.None&&o.loopStart<o.loopEnd;c.loopStart=h?o.loopStart:0,c.loopEnd=h?o.loopEnd:0,c.ampEnv.setup(o.ampEnv,t,s,!0,this.outSampleRate),c.modEnv.setup(o.modEnv,t,s,!1,this.outSampleRate);const d=o.initialFilterQ/10;c.lowPass.qInv=1/Math.pow(10,d/20),c.lowPass.z1=0,c.lowPass.z2=0,c.lowPass.active=o.initialFilterFc<=13500,c.lowPass.active&&c.lowPass.setup(xs.cents2Hertz(o.initialFilterFc)/this.outSampleRate),c.modLfo.setup(o.delayModLFO,o.freqModLFO,this.outSampleRate),c.vibLfo.setup(o.delayVibLFO,o.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,i,s){const a=this._getPresetIndex(e,t);return a===-1?!1:(this.noteOn(a,i,s),!0)}noteOff(e,t){let i=null,s=null;const a=[];for(const o of this._voices)o.playingPreset!==e||o.playingKey!==t||o.ampEnv.segment>=hi.Release||(!i||o.playIndex<i.playIndex?(i=o,s=o,a.push(o)):o.playIndex===i.playIndex&&(s=o,a.push(o)));if(i)for(const o of a)o!==i&&o!==s&&(o.playIndex!==i.playIndex||o.playingPreset!==e||o.playingKey!==t||o.ampEnv.segment>=hi.Release)||o.end(this.outSampleRate)}bankNoteOff(e,t,i){const s=this._getPresetIndex(e,t);return s===-1?!1:(this.noteOff(s,i),!0)}noteOffAll(e){for(const t of this._voices)t.playingPreset!==-1&&(e?t.endQuick(this.outSampleRate):t.ampEnv.segment<hi.Release&&t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)t.playingPreset!==-1&&e++;return e}_channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new bR);for(let t=this._channels.channelList.length;t<=e;t++){const i=new yR;i.presetIndex=0,i.bank=0,i.pitchWheel=8192,i.midiPan=8192,i.midiVolume=16383,i.midiExpression=16383,i.midiRpn=65535,i.midiData=0,i.panOffset=0,i.gainDb=0,i.pitchRange=2,i.tuning=0,i.mixVolume=1,this._channels.channelList.push(i)}return this._channels.channelList[e]}_getPresetIndex(e,t){if(!this.presets)return-1;for(let i=this.presets.length-1;i>=0;i--){const s=this.presets[i];if(s.presetNumber===t&&s.bank===e)return i}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this._getPresetIndex(e,t))}channelNoteOn(e,t,i){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,i))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const i=[];let s=null,a=null;for(const c of this._voices)c.playingPreset===-1||c.playingChannel!==e||c.playingKey!==t||c.ampEnv.segment>=hi.Release||(!s||c.playIndex<s.playIndex?(s=c,a=c,i.push(c)):c.playIndex===s.playIndex&&(a=c,i.push(c)));if(this._channelInit(e).perNotePitchWheel.delete(t),!!s)for(const c of i)c!==s&&c!==a&&(c.playIndex!==s.playIndex||c.playingPreset===-1||c.playingChannel!==e||c.playingKey!==t||c.ampEnv.segment>=hi.Release)||c.end(this.outSampleRate)}channelNoteOffAll(e){this._channelInit(e).perNotePitchWheel.clear();for(const i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&i.ampEnv.segment<hi.Release&&i.end(this.outSampleRate)}channelSoundsOffAll(e){this._channelInit(e).perNotePitchWheel.clear();for(const i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&(i.ampEnv.segment<hi.Release||i.ampEnv.parameters.release===0)&&i.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this._channelInit(e).presetIndex=it.int32ToUint16(t)}channelSetPresetNumber(e,t,i=!1){const s=this._channelInit(e);let a=0;return i?(a=this._getPresetIndex(128|s.bank&32767,t),a===-1&&(a=this._getPresetIndex(128,t)),a===-1&&(a=this._getPresetIndex(128,0)),a===-1&&(a=this._getPresetIndex(s.bank&2047,t))):a=this._getPresetIndex(s.bank&2047,t),s.presetIndex=a,a!==-1}channelSetBank(e,t){this._channelInit(e).bank=it.int32ToUint16(t)}channelSetBankPreset(e,t,i){const s=this._channelInit(e),a=this._getPresetIndex(t,i);return a===-1?!1:(s.presetIndex=it.int32ToUint16(a),s.bank=it.int32ToUint16(t),!0)}channelSetPan(e,t){for(const i of this._voices)if(i.playingChannel===e&&i.playingPreset!==-1){const s=i.region.pan+t-.5;s<=-.5?(i.panFactorLeft=1,i.panFactorRight=0):s>=.5?(i.panFactorLeft=0,i.panFactorRight=1):(i.panFactorLeft=Math.sqrt(.5-s),i.panFactorRight=Math.sqrt(.5+s))}this._channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const i=this._channelInit(e),s=xs.gainToDecibels(t),a=s-i.gainDb;if(a!==0){for(const o of this._voices)o.playingChannel===e&&o.playingPreset!==-1&&(o.noteGainDb+=a);i.gainDb=s}}channelSetPitchWheel(e,t){const i=this._channelInit(e);i.pitchWheel!==t&&(i.pitchWheel=it.int32ToUint16(t),this._channelApplyPitch(e,i))}channelSetPerNotePitchWheel(e,t,i){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const s=this._channelInit(e);s.perNotePitchWheel.has(t)&&s.perNotePitchWheel.get(t)===i||(s.perNotePitchWheel.set(t,i),this._channelApplyPitch(e,s,t))}_channelApplyPitch(e,t,i=-1){for(const s of this._voices)s.playingChannel===e&&s.playingPreset!==-1&&(i===-1||s.playingKey===i)&&s.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const i=this._channelInit(e);i.pitchRange!==t&&(i.pitchRange=t,i.pitchWheel!==8192&&this._channelApplyPitch(e,i))}channelSetTuning(e,t){const i=this._channelInit(e);i.tuning!==t&&(i.tuning=t,this._channelApplyPitch(e,i))}channelMidiControl(e,t,i){const s=this._channelInit(e);switch(t){case ni.DataEntryFine:s.midiData=it.int32ToUint16(s.midiData&16256|i),s.midiRpn===0?this.channelSetPitchRange(e,(s.midiData>>7)+.01*(s.midiData&127)):s.midiRpn===1?this.channelSetTuning(e,(s.tuning|0)+(s.midiData-8192)/8192):s.midiRpn===2&&this.channelSetTuning(e,i-64+(s.tuning-(s.tuning|0)));return;case ni.VolumeCoarse:s.midiVolume=it.int32ToUint16(s.midiVolume&127|i<<7),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case ni.VolumeFine:s.midiVolume=it.int32ToUint16(s.midiVolume&16256|i),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case ni.ExpressionControllerCoarse:s.midiExpression=it.int32ToUint16(s.midiExpression&127|i<<7),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case ni.ExpressionControllerFine:s.midiExpression=it.int32ToUint16(s.midiExpression&16256|i),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case ni.PanCoarse:s.midiPan=it.int32ToUint16(s.midiPan&127|i<<7),this.channelSetPan(e,s.midiPan/16383);return;case ni.PanFine:s.midiPan=it.int32ToUint16(s.midiPan&16256|i),this.channelSetPan(e,s.midiPan/16383);return;case ni.DataEntryCoarse:s.midiData=it.int32ToUint16(s.midiData&127|i<<7),s.midiRpn===0?this.channelSetPitchRange(e,(s.midiData>>7)+.01*(s.midiData&127)):s.midiRpn===1?this.channelSetTuning(e,(s.tuning|0)+(s.midiData-8192)/8192):s.midiRpn===2&&t===ni.DataEntryCoarse&&this.channelSetTuning(e,i-64+(s.tuning-(s.tuning|0)));return;case ni.BankSelectCoarse:s.bank=it.int32ToUint16(32768|i);return;case ni.BankSelectFine:s.bank=it.int32ToUint16(((s.bank&32768)!==0?(s.bank&127)<<7:0)|i);return;case ni.RegisteredParameterCourse:s.midiRpn=it.int32ToUint16((s.midiRpn===65535?0:s.midiRpn)&127|i<<7);return;case ni.RegisteredParameterFine:s.midiRpn=it.int32ToUint16((s.midiRpn===65535?0:s.midiRpn)&16256|i);return;case ni.NonRegisteredParameterFine:s.midiRpn=65535;return;case ni.NonRegisteredParameterCourse:s.midiRpn=65535;return;case ni.AllSoundOff:this.channelSoundsOffAll(e);return;case ni.AllNotesOff:this.channelNoteOffAll(e);return;case ni.ResetControllers:s.midiVolume=16383,s.midiExpression=16383,s.midiPan=8192,s.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),this.channelSetPitchRange(e,2);return}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].bank&32767:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?xs.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t,i,s){const a=[];for(let o=0;o<e.phdrs.length-1;o++){const c=e.phdrs[o];let h=0;const d=new SR;a.push(d),d.name=c.presetName,d.bank=c.bank,d.presetNumber=c.preset;let p=0;for(let y=c.presetBagNdx;y<e.phdrs[o+1].presetBagNdx;y++){const k=e.pbags[y];let _=0,w=127,T=0,x=127;for(let E=k.genNdx;E<e.pbags[y+1].genNdx;E++){const N=e.pgens[E];if(N.genOper===Yr.GenKeyRange){_=N.genAmount.lowByteAmount,w=N.genAmount.highByteAmount;continue}if(N.genOper===Yr.GenVelRange){T=N.genAmount.lowByteAmount,x=N.genAmount.highByteAmount;continue}if(N.genOper!==Yr.GenInstrument||N.genAmount.wordAmount>=e.insts.length)continue;const v=e.insts[N.genAmount.wordAmount];for(let L=v.instBagNdx;L<e.insts[N.genAmount.wordAmount+1].instBagNdx;L++){const A=e.ibags[L];let D=0,H=127,J=0,K=127;for(let Y=A.instGenNdx;Y<e.ibags[L+1].instGenNdx;Y++){const C=e.igens[Y];if(C.genOper===Yr.GenKeyRange){D=C.genAmount.lowByteAmount,H=C.genAmount.highByteAmount;continue}if(C.genOper===Yr.GenVelRange){J=C.genAmount.lowByteAmount,K=C.genAmount.highByteAmount;continue}C.genOper===53&&H>=_&&D<=w&&K>=T&&J<=x&&p++}}}}d.regions=new Array(p);let g=new $r;g.clear(!0);for(let y=c.presetBagNdx;y<e.phdrs[o+1].presetBagNdx;y++){const k=e.pbags[y],_=new $r(g);let w=!1;for(let T=k.genNdx;T<e.pbags[y+1].genNdx;T++){const x=e.pgens[T];if(x.genOper===Yr.GenInstrument){const E=x.genAmount.wordAmount;if(E>=e.insts.length)continue;let N=new $r;N.clear(!1);const v=e.insts[E];for(let L=v.instBagNdx;L<e.insts[E+1].instBagNdx;L++){const A=e.ibags[L],D=new $r(N);let H=!1;for(let J=A.instGenNdx;J<e.ibags[L+1].instGenNdx;J++){const K=e.igens[J];if(K.genOper===Yr.GenSampleId){if(D.hiKey<_.loKey||D.loKey>_.hiKey||D.hiVel<_.loVel||D.loVel>_.hiVel)continue;_.loKey>D.loKey&&(D.loKey=_.loKey),_.hiKey<D.hiKey&&(D.hiKey=_.hiKey),_.loVel>D.loVel&&(D.loVel=_.loVel),_.hiVel<D.hiVel&&(D.hiVel=_.hiVel),D.offset+=_.offset,D.end+=_.end,D.loopStart+=_.loopStart,D.loopEnd+=_.loopEnd,D.transpose+=_.transpose,D.tune+=_.tune,D.pitchKeyTrack+=_.pitchKeyTrack,D.attenuation+=_.attenuation,D.pan+=_.pan,D.ampEnv.delay+=_.ampEnv.delay,D.ampEnv.attack+=_.ampEnv.attack,D.ampEnv.hold+=_.ampEnv.hold,D.ampEnv.decay+=_.ampEnv.decay,D.ampEnv.sustain+=_.ampEnv.sustain,D.ampEnv.release+=_.ampEnv.release,D.modEnv.delay+=_.modEnv.delay,D.modEnv.attack+=_.modEnv.attack,D.modEnv.hold+=_.modEnv.hold,D.modEnv.decay+=_.modEnv.decay,D.modEnv.sustain+=_.modEnv.sustain,D.modEnv.release+=_.modEnv.release,D.initialFilterQ+=_.initialFilterQ,D.initialFilterFc+=_.initialFilterFc,D.modEnvToPitch+=_.modEnvToPitch,D.modEnvToFilterFc+=_.modEnvToFilterFc,D.delayModLFO+=_.delayModLFO,D.freqModLFO+=_.freqModLFO,D.modLfoToPitch+=_.modLfoToPitch,D.modLfoToFilterFc+=_.modLfoToFilterFc,D.modLfoToVolume+=_.modLfoToVolume,D.delayVibLFO+=_.delayVibLFO,D.freqVibLFO+=_.freqVibLFO,D.vibLfoToPitch+=_.vibLfoToPitch,D.ampEnv.envToSecs(!0),D.modEnv.envToSecs(!1),D.delayModLFO=D.delayModLFO<-11950?0:xs.timecents2Secs(D.delayModLFO),D.delayVibLFO=D.delayVibLFO<-11950?0:xs.timecents2Secs(D.delayVibLFO),D.pan<-.5?D.pan=-.5:D.pan>.5&&(D.pan=.5),(D.initialFilterQ<1500||D.initialFilterQ>13500)&&(D.initialFilterQ=0);const Y=e.sHdrs[K.genAmount.wordAmount];D.offset+=Y.start,D.end+=Y.end,D.loopStart+=Y.startLoop,D.loopEnd+=Y.endLoop,Y.endLoop>0&&(D.loopEnd-=1),D.pitchKeyCenter===-1&&(D.pitchKeyCenter=Y.originalPitch),D.tune+=Y.pitchCorrection,D.sampleRate=Y.sampleRate;const C=c.bank===Xe.PercussionBank;C&&yg._setContainsRange(i,D.loKey,D.hiKey)||!C&&t.has(c.preset)?(Y.sampleType&1)!==0?(ee.debug("AlphaSynth",`Loading of used sample ${Y.sampleName} for preset ${c.presetName} (bank ${d.bank} program ${d.presetNumber})`),(Y.sampleType&16)!==0?D.samples=e.decodeSamples(Y.start,Y.end,!0):(D.samples=e.decodeSamples(D.offset*2,D.end*2,!1),D.loopStart>0&&(D.loopStart-=D.offset),D.loopEnd>0&&(D.loopEnd-=D.offset)),D.offset=0,D.end=D.samples.length-1):(ee.warning("AlphaSynth",`Skipping load of unsupported sample ${Y.sampleName} for preset ${c.presetName}, sample type ${Y.sampleType} is not supported (bank ${d.bank} program ${d.presetNumber})`),D.samples=new Float32Array(0)):(ee.debug("AlphaSynth",`Skipping load of unused sample ${Y.sampleName} for preset ${c.presetName} (bank ${d.bank} program ${d.presetNumber})`),D.samples=new Float32Array(0)),d.regions[h]=new $r(D),h++,H=!0}else D.operator(K.genOper,K.genAmount)}A===e.ibags[v.instBagNdx]&&!H&&(N=new $r(D))}w=!0}else _.operator(x.genOper,x.genAmount)}k===e.pbags[c.presetBagNdx]&&!w&&(g=_)}}if(!s||!this.presets)this.presets=a;else for(const o of a)this.presets.push(o)}static _setContainsRange(e,t,i){for(let s=t;s<=i;s++)if(e.has(s))return!0;return!1}hasSamplesForProgram(e){const t=this.presets;if(!t)return!1;for(const i of t)if(i.presetNumber===e){for(const s of i.regions)if(s.samples.length>0)return!0}return!1}hasSamplesForPercussion(e){const t=this.presets;if(!t)return!1;for(const i of t)if(i.bank===Xe.PercussionBank){for(const s of i.regions)if(s.loKey>=e&&s.hiKey<=e&&s.samples.length>0)return!0}return!1}}class Fb{events;constructor(e){this.events=e}}class Hh{playbackRange;constructor(e){this.playbackRange=e}}class hv{soundFonts;sampleRate=44100;useSyncPoints=!1;masterVolume=1;metronomeVolume=0;playbackRange;trackVolume=new Map;trackTranspositionPitches=new Map}class dv{samples;currentTime=0;endTime=0;currentTick=0;endTick=0}class Ib{sequencer;synthesizer;isSoundFontLoaded=!1;_isMidiLoaded=!1;_tickPosition=0;_timePosition=0;_metronomeVolume=0;_countInVolume=0;playedEventsQueue=new Ob;midiEventsPlayedFilterSet=new Set;_notPlayedSamples=0;_synthStopping=!1;_output;_loadedMidiInfo;_currentPosition=new fr(0,0,0,0,!1,120,120);get output(){return this._output}isReady=!1;get isReadyForPlayback(){return this.isReady&&this.isSoundFontLoaded&&this._isMidiLoaded}state=Ts.Paused;get logLevel(){return ee.logLevel}set logLevel(e){ee.logLevel=e}get masterVolume(){return this.synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,Xe.MinVolume),this.updateMasterVolume(e)}updateMasterVolume(e){this.synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,Xe.MinVolume),this._metronomeVolume=e,this.synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,Xe.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this.midiEventsPlayedFilterSet)}set midiEventsPlayedFilter(e){this.midiEventsPlayedFilterSet=new Set(e)}get playbackSpeed(){return this.sequencer.playbackSpeed}set playbackSpeed(e){e=ce.clamp(e,Xe.MinPlaybackSpeed,Xe.MaxPlaybackSpeed),this.updatePlaybackSpeed(e)}updatePlaybackSpeed(e){const t=this.sequencer.playbackSpeed;this.sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get loadedMidiInfo(){return this._loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this.sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){ee.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this.sequencer.mainSeek(e),this.updateTimePosition(e,!0),this.sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this.sequencer.mainPlaybackRange}set playbackRange(e){this.sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new Hh(e))}get isLooping(){return this.sequencer.isLooping}set isLooping(e){this.sequencer.isLooping=e}destroy(){ee.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t,i){ee.debug("AlphaSynth","Initializing player"),this.state=Ts.Paused,this.ready=new qi(()=>this.isReady),this.readyForPlayback=new qi(()=>this.isReadyForPlayback),this.midiLoaded=new ot(()=>this._loadedMidiInfo?this._loadedMidiInfo:null),this.stateChanged=new ot(()=>new Rl(this.state,!1)),this.positionChanged=new ot(()=>this._currentPosition),this.playbackRangeChanged=new ot(()=>this.playbackRange?new Hh(this.playbackRange):null),ee.debug("AlphaSynth","Creating output"),this._output=e,ee.debug("AlphaSynth","Creating synthesizer"),this.synthesizer=t,this.sequencer=new ov(this.synthesizer),ee.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this._checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{this.onSampleRequest()}),this.output.samplesPlayed.on(this._onSamplesPlayed.bind(this)),this.output.open(i)}onSampleRequest(){if(this.state===Ts.Playing&&(!this.sequencer.isFinished||this.synthesizer.activeVoiceCount>0)){let e=new Float32Array(Xe.MicroBufferSize*Xe.MicroBufferCount*Xe.AudioChannels),t=0;for(let i=0;i<Xe.MicroBufferCount;i++){this.sequencer.fillMidiEventQueue();const s=this.synthesizer.synthesize(e,t,Xe.MicroBufferSize);t+=Xe.MicroBufferSize*Xe.AudioChannels;for(const a of s)this.midiEventsPlayedFilterSet.has(a.event.type)&&this.playedEventsQueue.enqueue(a);if(this.sequencer.isFinished)break}t<e.length&&(e=e.subarray(0,t)),this._notPlayedSamples+=e.length,this.output.addSamples(e)}else{const e=new Float32Array(0);this.output.addSamples(e)}}play(){return this.state!==Ts.Paused||!this._isMidiLoaded?!1:(this.output.activate(),this._playInternal(),this._countInVolume>0&&(ee.debug("AlphaSynth","Starting countin"),this.sequencer.startCountIn(),this.synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),!0)}_playInternal(){this.sequencer.isPlayingOneTimeMidi&&(ee.debug("AlphaSynth","Cancelling one time midi"),this._stopOneTimeMidi()),ee.debug("AlphaSynth","Starting playback"),this.synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=Ts.Playing,this.stateChanged.trigger(new Rl(this.state,!1))}pause(){this.state===Ts.Paused||!this._isMidiLoaded||(ee.debug("AlphaSynth","Pausing playback"),this.state=Ts.Paused,this.stateChanged.trigger(new Rl(this.state,!1)),this.output.pause(),this.synthesizer.noteOffAll(!1))}playPause(){this.state!==Ts.Paused||!this._isMidiLoaded?this.pause():this.play()}stop(){this._isMidiLoaded&&(ee.debug("AlphaSynth","Stopping playback"),this.state=Ts.Paused,this.output.pause(),this._notPlayedSamples=0,this.sequencer.stop(),this.synthesizer.noteOffAll(!0),this.tickPosition=this.sequencer.mainPlaybackRange?this.sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new Rl(this.state,!0)))}playOneTimeMidiFile(e){this.sequencer.isPlayingOneTimeMidi?this._stopOneTimeMidi():this.pause(),this.sequencer.loadOneTimeMidi(e),this.synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this.synthesizer.resetPresets(),this._loadedSoundFonts=[],this.isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}_loadedSoundFonts=[];loadSoundFont(e,t){this.pause();const i=ss.fromBuffer(e);try{ee.debug("AlphaSynth","Loading soundfont from bytes");const s=new cv;s.load(i),t||(this._loadedSoundFonts=[]),this._loadedSoundFonts.push(s),this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),ee.debug("AlphaSynth","soundFont successfully loaded"),this._checkReadyForPlayback()}catch(s){ee.error("AlphaSynth",`Could not load soundfont from bytes ${s}`),this.soundFontLoadFailed.trigger(s)}}_checkReadyForPlayback(){if(this.isReadyForPlayback){this.synthesizer.setupMetronomeChannel(this.metronomeVolume);const e=this.sequencer.instrumentPrograms,t=this.sequencer.percussionKeys;let i=!1;for(const s of this._loadedSoundFonts)this.synthesizer.loadPresets(s,e,t,i),i=!0;this.readyForPlayback.trigger()}}loadMidiFile(e){this.stop();try{ee.debug("AlphaSynth","Loading midi from model"),this.sequencer.loadMidi(e),this._isMidiLoaded=!0,this._loadedMidiInfo=new fr(0,this.sequencer.currentEndTime,0,this.sequencer.currentEndTick,!1,this.sequencer.currentTempo,this.sequencer.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo),ee.debug("AlphaSynth","Midi successfully loaded"),this._checkReadyForPlayback(),this.tickPosition=0}catch(t){ee.error("AlphaSynth",`Could not load midi from model ${t}`),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this.synthesizer.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this.synthesizer.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this.synthesizer.channelSetMute(e,t)}resetChannelStates(){this.synthesizer.resetChannelStates()}setChannelSolo(e,t){this.synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,Xe.MinVolume),this.synthesizer.channelSetMixVolume(e,t)}_onSamplesPlayed(e){if(e===0)return;const t=e/this.synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*Xe.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this.sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this.sequencer.currentEndTick,this._tickPosition>=t&&(this._notPlayedSamples<=0?(this._notPlayedSamples=0,this.sequencer.isPlayingCountIn?(ee.debug("AlphaSynth","Finished playback (count-in)"),this.sequencer.resetCountIn(),this.timePosition=this.sequencer.currentTime,this._playInternal(),this.output.resetSamples()):this.sequencer.isPlayingOneTimeMidi?(ee.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=Ts.Paused,this._stopOneTimeMidi()):this.isLooping?(ee.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=e,this._synthStopping=!1):this.synthesizer.activeVoiceCount>0?this._synthStopping||(ee.debug("AlphaSynth","Signaling synth to stop all voices (all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,ee.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop())):this._synthStopping||(ee.debug("AlphaSynth","Signaling synth to stop all voices (not all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0))}_stopOneTimeMidi(){this.output.pause(),this.synthesizer.noteOffAll(!0),this.sequencer.resetOneTimeMidi(),this.timePosition=this.sequencer.currentTime}_createPositionChangedEventArgs(e){let t=this._timePosition,i=this.sequencer.currentTimePositionToTickPosition(t);const s=this.sequencer.currentEndTime,a=this.sequencer.currentEndTick;return t>s&&(t=s,i=a),new fr(t,s,i,a,e,this.sequencer.currentTempo,this.sequencer.modifiedTempo)}updateTimePosition(e,t){this._timePosition=e;const i=this._createPositionChangedEventArgs(t);this._tickPosition=i.currentTick;const s=this.sequencer.isPlayingMain?"main":this.sequencer.isPlayingCountIn?"count-in":"one-time";if(ee.debug("AlphaSynth",`Position changed: (time: ${i.currentTime}/${i.endTime}, tick: ${i.currentTick}/${i.endTick}, Active Voices: ${this.synthesizer.activeVoiceCount} (${s}), Tempo original: ${this.sequencer.currentTempo}, Tempo modified: ${this.sequencer.modifiedTempo})`),this.sequencer.isPlayingMain&&(this._currentPosition=i,this.positionChanged.trigger(i)),t)this.playedEventsQueue.clear();else{const a=[];for(;!this.playedEventsQueue.isEmpty&&this.playedEventsQueue.peek().time<i.currentTime;){const o=this.playedEventsQueue.dequeue();a.push(o.event)}a.length>0&&(a.reverse(),this.midiEventsPlayed.trigger(new Fb(a)))}}ready;readyForPlayback=new qi;finished=new qi;soundFontLoaded=new qi;soundFontLoadFailed=new ot;midiLoaded;midiLoadFailed=new ot;stateChanged;positionChanged;midiEventsPlayed=new ot;playbackRangeChanged;hasSamplesForProgram(e){return this.synthesizer.hasSamplesForProgram(e)}hasSamplesForPercussion(e){return this.synthesizer.hasSamplesForPercussion(e)}loadBackingTrack(e){}updateSyncPoints(e){}}class fv extends Ib{constructor(e,t){super(e,new yg(e.sampleRate),t)}exportAudio(e,t,i,s){const a=new _R(e);a.loadMidiFile(t),e.useSyncPoints&&a.updateSyncPoints(i),a.applyTranspositionPitches(s);for(const[o,c]of e.trackTranspositionPitches)a.setChannelTranspositionPitch(o,c);for(const[o,c]of e.trackVolume)a.channelSetMixVolume(o,c);if(e.soundFonts)for(const o of e.soundFonts)a.loadSoundFont(o);else a.loadPresets(this.synthesizer.presets);return e.playbackRange&&a.limitExport(e.playbackRange),a.setup(),a}}class _R{_synth;_sequencer;constructor(e){this._synth=new yg(e.sampleRate),this._sequencer=new ov(this._synth),this._synth.masterVolume=Math.max(e.masterVolume,Xe.MinVolume),this._synth.metronomeVolume=Math.max(e.metronomeVolume,Xe.MinVolume)}loadSoundFont(e){const t=ss.fromBuffer(e),i=new cv;i.load(t);const s=this._sequencer.instrumentPrograms,a=this._sequencer.percussionKeys;this._synth.loadPresets(i,s,a,!0)}loadPresets(e){this._synth.presets=e}limitExport(e){this._sequencer.mainPlaybackRange=e,this._sequencer.mainSeek(this._sequencer.mainTickPositionToTimePosition(e.startTick))}setChannelTranspositionPitch(e,t){this._synth.setChannelTranspositionPitch(e,t)}applyTranspositionPitches(e){this._synth.applyTranspositionPitches(e)}loadMidiFile(e){this._sequencer.loadMidi(e)}updateSyncPoints(e){this._sequencer.mainUpdateSyncPoints(e)}channelSetMixVolume(e,t){t=Math.max(t,Xe.MinVolume),this._synth.channelSetMixVolume(e,t)}_generatedAudioCurrentTime=0;_generatedAudioEndTime=0;setup(){this._synth.setupMetronomeChannel(this._synth.metronomeVolume);const e=this._sequencer.currentSyncPoints,t=this._sequencer.currentEndTime;if(e.length===0)this._generatedAudioEndTime=t;else{const i=e[e.length-1];let s=i.syncTime;const a=this._sequencer.currentEndTick-i.synthTick;a>0&&(s+=$.ticksToMillis(a,i.syncBpm)),this._generatedAudioEndTime=s}}render(e){if(this._sequencer.isFinished)return;const t=Xe.MicroBufferSize*1e3/this._synth.outSampleRate,i=Math.ceil(e/t);let s=new Float32Array(Xe.MicroBufferSize*i*Xe.AudioChannels);const a=this._sequencer.currentSyncPoints;let o=0,c=this._generatedAudioCurrentTime;for(let d=0;d<i;d++){if(a.length>0){this._sequencer.currentUpdateSyncPoints(c),this._sequencer.currentUpdateCurrentTempo(this._sequencer.currentTime);const p=this._sequencer.syncPointTempo/this._sequencer.currentTempo;this._sequencer.playbackSpeed!==p&&(this._sequencer.playbackSpeed=p)}if(this._sequencer.fillMidiEventQueue(),this._synth.synthesize(s,o,Xe.MicroBufferSize),o+=Xe.MicroBufferSize*Xe.AudioChannels,c+=t,this._sequencer.isFinished)break}o<s.length&&(s=s.subarray(0,o));const h=new dv;return h.currentTime=this._generatedAudioCurrentTime,h.endTime=this._generatedAudioEndTime,h.currentTick=this._sequencer.currentTimePositionToTickPosition(this._sequencer.currentTime),h.endTick=this._sequencer.currentEndTick,this._generatedAudioCurrentTime+=e,h.samples=s,this._sequencer.isFinished&&this._synth.noteOffAll(!0),h}}class q{static parseEnum(e,t){switch(typeof e){case"string":const i=Number.parseInt(e,10);return Number.isNaN(i)?t[Object.keys(t).find(s=>s.toLowerCase()===e.toLowerCase())]:i;case"number":return e;case"undefined":case"object":return}throw new Ht(It.Format,`Could not parse enum value '${e}'`)}static parseEnumExact(e,t){if(e in t)return t[e]}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if(typeof e=="object")for(const i in e)t(e[i],i)}static getValue(e,t){return e instanceof Map?e.get(t):typeof e=="object"?e[t]:null}}class kR{startPos;endPos;text;constructor(e,t,i){this.text=e,this.startPos=t,this.endPos=i}}class Gc{style="normal";variant="normal";weight="normal";stretch="normal";lineHeight="normal";size="1rem";families=[];parseOnlyFamilies=!1;_tokens;_currentTokenIndex=-1;_input="";_currentToken=null;constructor(e){this._input=e,this._tokens=this._splitToTokens(e)}_splitToTokens(e){const t=[];let i=0;for(;i<e.length;){let s=i;for(;s<e.length&&e.charAt(s)!==" ";)s++;s>i&&t.push(new kR(e.substring(i,s),i,s)),i=s+1}return t}parse(){if(this._reset(),this._tokens.length===1)switch(this._currentToken?.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this._fontStyleVariantWeight(),this._fontSizeLineHeight()),this._fontFamily()}static parseFamilies(e){const t=new Gc(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}_fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){const i=e.charAt(t);if(i===" "||i===",")t++;else if(i==='"'||i==="'"){const s=this._findEndOfQuote(e,t+1,i);this.families.push(e.substring(t+1,s).split(`\\${i}`).join(i)),t=s+1}else{const s=this._findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,s).trim()),t=s+1}}}_findEndOfQuote(e,t,i){let s=!1;for(;t<e.length;){const a=e.charAt(t);if(!s&&a===i)return t;!s&&a==="\\"?s=!0:s=!1,t+=1}return e.length}_fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this._nextToken(),e.length>=2)if(e[1]==="/"){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this._nextToken()}else this.size=e[0],this.lineHeight=e[1];else if(e.length>=1){if(this.size=e[0],this._currentToken&&this._currentToken.text.indexOf("/")===0)if(this._currentToken.text==="/"){if(this._nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this._nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this._nextToken()}else throw new Error("Missing font size")}_nextToken(){this._currentTokenIndex++,this._currentTokenIndex<this._tokens.length?this._currentToken=this._tokens[this._currentTokenIndex]:this._currentToken=null}_fontStyleVariantWeight(){let e=!1,t=!1,i=!1,s=3;const a=[];for(;;){if(!this._currentToken)return;const o=this._currentToken.text;switch(o){case"normal":case"inherit":a.push(o),s--,this._nextToken();break;case"italic":case"oblique":this.style=o,e=!0,s--,this._nextToken();break;case"small-caps":this.variant=o,t=!0,s--,this._nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=o,i=!0,s--,this._nextToken();break;default:return}if(s===0)break}for(;a.length>0;){const o=a.pop();i?t?e||(this.style=o):this.variant=o:this.weight=o}}_reset(){this._currentTokenIndex=-1,this._nextToken()}static quoteFont(e){return e.indexOf(" ")===-1?e:`"${e.replaceAll('"','\\"')}"`}}var pi;(function(n){n[n.Plain=0]="Plain",n[n.Italic=1]="Italic"})(pi||(pi={}));var fn;(function(n){n[n.Regular=0]="Regular",n[n.Bold=1]="Bold"})(fn||(fn={}));class nt{_css;_cssScale=0;_families;_style;_weight;_size;_reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=Gc.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this._reset()}get size(){return this._size}set size(e){this._size=e,this._reset()}get style(){return this._style}set style(e){this._style=e,this._reset()}get weight(){return this._weight}set weight(e){this._weight=e,this._reset()}get isBold(){return this.weight===fn.Bold}get isItalic(){return this.style===pi.Italic}constructor(e,t,i=pi.Plain,s=fn.Regular){this._families=Gc.parseFamilies(e),this._size=t,this._style=i,this._weight=s,this._css=this.toCssString()}withSize(e){return nt.withFamilyList(this._families,e,this._style,this._weight)}static withFamilyList(e,t,i=pi.Plain,s=fn.Regular){const a=new nt("",t,i,s);return a.families=e,a}toCssString(e=1){if(!this._css||!(Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(i=>Gc.quoteFont(i)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof nt)return e;switch(typeof e){case"undefined":return;case"object":{const t=e,i=t.get("families"),s=t.get("size"),a=q.parseEnum(t.get("style"),pi),o=q.parseEnum(t.get("weight"),fn);return nt.withFamilyList(i,s,a,o)}case"string":{const t=new Gc(e);t.parse();const i=t.families,s=t.size.toLowerCase();let a=0;switch(s){case"xx-small":a=7;break;case"x-small":a=10;break;case"small":case"smaller":a=13;break;case"medium":a=16;break;case"large":case"larger":a=18;break;case"x-large":a=24;break;case"xx-large":a=32;break;default:try{s.endsWith("em")?a=Number.parseFloat(s.substr(0,s.length-2))*16:s.endsWith("pt")?a=Number.parseFloat(s.substr(0,s.length-2))*16/12:s.endsWith("px")?a=Number.parseFloat(s.substr(0,s.length-2)):a=12}catch{a=12}break}let o=pi.Plain;t.style==="italic"&&(o=pi.Italic);let c=fn.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:c=fn.Bold;break}return nt.withFamilyList(i,a,o,c)}default:return}}static toJson(e){if(!e)return;const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}class wR{static clone(e){const t=new Ha;return t.musicFontSize=e.musicFontSize,t.oneStaffSpace=e.oneStaffSpace,t.tabLineSpacing=e.tabLineSpacing,t.arrowShaftThickness=e.arrowShaftThickness,t.barlineSeparation=e.barlineSeparation,t.beamSpacing=e.beamSpacing,t.beamThickness=e.beamThickness,t.bracketThickness=e.bracketThickness,t.dashedBarlineDashLength=e.dashedBarlineDashLength,t.dashedBarlineGapLength=e.dashedBarlineGapLength,t.dashedBarlineThickness=e.dashedBarlineThickness,t.hairpinThickness=e.hairpinThickness,t.legerLineThickness=e.legerLineThickness,t.legerLineExtension=e.legerLineExtension,t.octaveLineThickness=e.octaveLineThickness,t.pedalLineThickness=e.pedalLineThickness,t.repeatBarlineDotSeparation=e.repeatBarlineDotSeparation,t.repeatEndingLineThickness=e.repeatEndingLineThickness,t.slurMidpointThickness=e.slurMidpointThickness,t.staffLineThickness=e.staffLineThickness,t.stemThickness=e.stemThickness,t.thickBarlineThickness=e.thickBarlineThickness,t.thinBarlineThickness=e.thinBarlineThickness,t.thinThickBarlineSeparation=e.thinThickBarlineSeparation,t.tieMidpointThickness=e.tieMidpointThickness,t.tupletBracketThickness=e.tupletBracketThickness,t.stemUp=new Map(e.stemUp),t.stemDown=new Map(e.stemDown),t.repeatOffsetX=new Map(e.repeatOffsetX),t.standardStemLength=e.standardStemLength,t.stemFlagOffsets=new Map(e.stemFlagOffsets),t.glyphTop=new Map(e.glyphTop),t.glyphBottom=new Map(e.glyphBottom),t.glyphWidths=new Map(e.glyphWidths),t.glyphHeights=new Map(e.glyphHeights),t.numberedBarRendererBarSize=e.numberedBarRendererBarSize,t.numberedBarRendererBarSpacing=e.numberedBarRendererBarSpacing,t.numberedDashGlyphPadding=e.numberedDashGlyphPadding,t.numberedDashGlyphWidth=e.numberedDashGlyphWidth,t.lineRangedGlyphDashGap=e.lineRangedGlyphDashGap,t.lineRangedGlyphDashSize=e.lineRangedGlyphDashSize,t.preNoteEffectPadding=e.preNoteEffectPadding,t.postNoteEffectPadding=e.postNoteEffectPadding,t.onNoteEffectPadding=e.onNoteEffectPadding,t.stringNumberCirclePadding=e.stringNumberCirclePadding,t.rowContainerPadding=e.rowContainerPadding,t.rowContainerGap=e.rowContainerGap,t.alternateEndingsPadding=e.alternateEndingsPadding,t.sustainPedalLinePadding=e.sustainPedalLinePadding,t.tieHeight=e.tieHeight,t.beatTimerPadding=e.beatTimerPadding,t.bendNoteHeadElementPadding=e.bendNoteHeadElementPadding,t.ghostParenthesisWidth=e.ghostParenthesisWidth,t.ghostParenthesisPadding=e.ghostParenthesisPadding,t.brokenBeamWidth=e.brokenBeamWidth,t.tabWhammyTextPadding=e.tabWhammyTextPadding,t.tabWhammyPerHalfHeight=e.tabWhammyPerHalfHeight,t.tabWhammyDashSize=e.tabWhammyDashSize,t.songBookWhammyDipHeight=e.songBookWhammyDipHeight,t.deadSlappedLineWidth=e.deadSlappedLineWidth,t.leftHandTabTieWidth=e.leftHandTabTieWidth,t.tabBendDashSize=e.tabBendDashSize,t.tabBendPerValueHeight=e.tabBendPerValueHeight,t.tabBendLabelPadding=e.tabBendLabelPadding,t.simpleSlideWidth=e.simpleSlideWidth,t.simpleSlideHeight=e.simpleSlideHeight,t.chordDiagramPaddingX=e.chordDiagramPaddingX,t.chordDiagramPaddingY=e.chordDiagramPaddingY,t.chordDiagramStringSpacing=e.chordDiagramStringSpacing,t.chordDiagramFretSpacing=e.chordDiagramFretSpacing,t.chordDiagramNutHeight=e.chordDiagramNutHeight,t.chordDiagramFretHeight=e.chordDiagramFretHeight,t.chordDiagramLineWidth=e.chordDiagramLineWidth,t.tripletFeelBracketPadding=e.tripletFeelBracketPadding,t.accidentalPadding=e.accidentalPadding,t.preBeatGlyphSpacing=e.preBeatGlyphSpacing,t.tempoNoteScale=e.tempoNoteScale,t.tuningGlyphCircleNumberScale=e.tuningGlyphCircleNumberScale,t.tuningGlyphStringColumnScale=e.tuningGlyphStringColumnScale,t.tuningGlyphStringRowPadding=e.tuningGlyphStringRowPadding,t.directionsScale=e.directionsScale,t}}class dp{topY=0;bottomY=0;x=0}class Ha{static _bravuraDefaults;static get bravuraDefaults(){let e=Ha._bravuraDefaults;return e||(e=new Ha,e.fillFromSmufl(Ha.bravuraMetadata),Ha._bravuraDefaults=e),wR.clone(e)}musicFontSize=0;oneStaffSpace=0;tabLineSpacing=0;arrowShaftThickness=0;barlineSeparation=0;beamSpacing=0;beamThickness=0;bracketThickness=0;dashedBarlineDashLength=0;dashedBarlineGapLength=0;dashedBarlineThickness=0;hairpinThickness=0;legerLineThickness=0;legerLineExtension=0;octaveLineThickness=0;pedalLineThickness=0;repeatBarlineDotSeparation=0;repeatEndingLineThickness=0;slurMidpointThickness=0;staffLineThickness=0;stemThickness=0;thickBarlineThickness=0;thinBarlineThickness=0;thinThickBarlineSeparation=0;tieMidpointThickness=0;tupletBracketThickness=0;stemUp=new Map;stemDown=new Map;repeatOffsetX=new Map;standardStemLength=0;stemFlagOffsets=new Map;glyphTop=new Map;glyphBottom=new Map;glyphWidths=new Map;glyphHeights=new Map;hasSymbol(e){return this.glyphWidths.get(e)>0&&this.glyphHeights.get(e)>0}fillFromSmufl(e,t=36){this.musicFontSize=t,this.oneStaffSpace=t/4,this.tabLineSpacing=Math.floor(this.oneStaffSpace*1.5),this.arrowShaftThickness=e.engravingDefaults.arrowShaftThickness*this.oneStaffSpace,this.barlineSeparation=e.engravingDefaults.barlineSeparation*this.oneStaffSpace,this.beamSpacing=e.engravingDefaults.beamSpacing*this.oneStaffSpace,this.beamThickness=e.engravingDefaults.beamThickness*this.oneStaffSpace,this.bracketThickness=e.engravingDefaults.bracketThickness*this.oneStaffSpace,this.dashedBarlineDashLength=e.engravingDefaults.dashedBarlineDashLength*this.oneStaffSpace,this.dashedBarlineGapLength=e.engravingDefaults.dashedBarlineGapLength*this.oneStaffSpace,this.dashedBarlineThickness=e.engravingDefaults.dashedBarlineThickness*this.oneStaffSpace,this.hairpinThickness=e.engravingDefaults.hairpinThickness*this.oneStaffSpace,this.legerLineExtension=e.engravingDefaults.legerLineExtension*this.oneStaffSpace,this.legerLineThickness=e.engravingDefaults.legerLineThickness*this.oneStaffSpace,this.octaveLineThickness=e.engravingDefaults.octaveLineThickness*this.oneStaffSpace,this.pedalLineThickness=e.engravingDefaults.pedalLineThickness*this.oneStaffSpace,this.repeatBarlineDotSeparation=e.engravingDefaults.repeatBarlineDotSeparation*this.oneStaffSpace,this.repeatEndingLineThickness=e.engravingDefaults.repeatEndingLineThickness*this.oneStaffSpace,this.slurMidpointThickness=e.engravingDefaults.slurMidpointThickness*this.oneStaffSpace,this.staffLineThickness=e.engravingDefaults.staffLineThickness*this.oneStaffSpace,this.stemThickness=e.engravingDefaults.stemThickness*this.oneStaffSpace,this.thickBarlineThickness=e.engravingDefaults.thickBarlineThickness*this.oneStaffSpace,this.thinBarlineThickness=e.engravingDefaults.thinBarlineThickness*this.oneStaffSpace,typeof e.engravingDefaults.thinThickBarlineSeparation=="number"?this.thinThickBarlineSeparation=e.engravingDefaults.thinThickBarlineSeparation*this.oneStaffSpace:this.thinThickBarlineSeparation=e.engravingDefaults.barlineSeparation*this.oneStaffSpace,this.tieMidpointThickness=e.engravingDefaults.tieMidpointThickness*this.oneStaffSpace,this.tupletBracketThickness=e.engravingDefaults.tupletBracketThickness*this.oneStaffSpace;const i=3*this.oneStaffSpace;this.standardStemLength=i,this.stemFlagOffsets.set(M.QuadrupleWhole,0),this.stemFlagOffsets.set(M.DoubleWhole,0),this.stemFlagOffsets.set(M.Whole,0),this.stemFlagOffsets.set(M.Half,0),this.stemFlagOffsets.set(M.Quarter,0),this.stemFlagOffsets.set(M.Eighth,0),this.stemFlagOffsets.set(M.Sixteenth,0),this.stemFlagOffsets.set(M.ThirtySecond,0),this.stemFlagOffsets.set(M.SixtyFourth,0),this.stemFlagOffsets.set(M.OneHundredTwentyEighth,0),this.stemFlagOffsets.set(M.TwoHundredFiftySixth,0);for(const[c,h]of Object.entries(e.glyphsWithAnchors)){const d=Ha._smuflNameToMusicFontSymbol(c);if(d){if(h.stemDownNW){const p=new dp;p.x=h.stemDownNW[0]*this.oneStaffSpace,p.topY=h.stemDownNW[1]*this.oneStaffSpace,h.stemDownSW?p.bottomY=h.stemDownSW[1]*this.oneStaffSpace:p.bottomY=0,this.stemDown.set(d,p)}if(h.stemUpSE){const p=new dp,g=h.stemUpSE[0]*this.oneStaffSpace;p.bottomY=h.stemUpSE[1]*this.oneStaffSpace,h.stemUpNW?(p.x=h.stemUpNW[0]*this.oneStaffSpace,p.topY=h.stemUpNW[1]*this.oneStaffSpace):(p.x=g-this.stemThickness,p.topY=0),this.stemUp.set(d,p)}if(h.repeatOffset&&this.repeatOffsetX.set(d,h.repeatOffset[0]*this.oneStaffSpace),h.stemUpNW){const p=h.stemUpNW[1]*this.oneStaffSpace;switch(d){case S.Flag8thUp:this.stemFlagOffsets.set(M.Eighth,p);break;case S.Flag16thUp:this.stemFlagOffsets.set(M.Sixteenth,p);break;case S.Flag32ndUp:this.stemFlagOffsets.set(M.ThirtySecond,p);break;case S.Flag64thUp:this.stemFlagOffsets.set(M.SixtyFourth,p);break;case S.Flag128thUp:this.stemFlagOffsets.set(M.OneHundredTwentyEighth,p);break;case S.Flag256thUp:this.stemFlagOffsets.set(M.TwoHundredFiftySixth,p);break}}}}const s=new Set,a=e.glyphBBoxes;if(a)for(const[c,h]of Object.entries(a)){const d=Ha._smuflNameToMusicFontSymbol(c);d&&(s.add(d),this.glyphTop.set(d,h.bBoxNE[1]*this.oneStaffSpace),this.glyphBottom.set(d,h.bBoxSW[1]*this.oneStaffSpace),this.glyphWidths.set(d,(h.bBoxNE[0]-h.bBoxSW[0])*this.oneStaffSpace),this.glyphHeights.set(d,(h.bBoxNE[1]-h.bBoxSW[1])*this.oneStaffSpace))}const o=new Set([S.None,S.Space,S.NoteheadNull]);for(const c of ce.getAllMusicFontSymbols())s.has(c)||(o.has(c)||ee.warning("SmuFL",`The provided SmuFL font is missing the glyph ${S[c]} needed by alphaTab, the music notation might not show all details`),this.glyphTop.set(c,0),this.glyphBottom.set(c,0),this.glyphWidths.set(c,0),this.glyphHeights.set(c,0));this.numberedBarRendererBarSize=this.staffLineThickness*2,this.numberedBarRendererBarSpacing=this.beamSpacing+this.numberedBarRendererBarSize,this.preNoteEffectPadding=.4*this.oneStaffSpace,this.postNoteEffectPadding=.2*this.oneStaffSpace,this.lineRangedGlyphDashGap=.5*this.oneStaffSpace,this.lineRangedGlyphDashSize=1*this.oneStaffSpace,this.numberedDashGlyphPadding=.3*this.oneStaffSpace,this.numberedDashGlyphPadding=.3*this.oneStaffSpace,this.stringNumberCirclePadding=.3*this.oneStaffSpace,this.rowContainerPadding=Math.ceil(.3*this.oneStaffSpace),this.rowContainerGap=Math.ceil(1*this.oneStaffSpace),this.onNoteEffectPadding=.2*this.oneStaffSpace,this.alternateEndingsPadding=.3*this.oneStaffSpace,this.sustainPedalLinePadding=.5*this.oneStaffSpace,this.tieHeight=1.2*this.oneStaffSpace,this.beatTimerPadding=.22*this.oneStaffSpace,this.bendNoteHeadElementPadding=.22*this.oneStaffSpace,this.ghostParenthesisWidth=.6*this.oneStaffSpace,this.ghostParenthesisPadding=.3*this.oneStaffSpace,this.brokenBeamWidth=1*this.oneStaffSpace,this.tabWhammyTextPadding=.4*this.oneStaffSpace,this.tabWhammyDashSize=.4*this.oneStaffSpace,this.tabBendDashSize=.4*this.oneStaffSpace,this.songBookWhammyDipHeight=.6*this.oneStaffSpace,this.tabWhammyPerHalfHeight=.6*this.oneStaffSpace,this.tabBendPerValueHeight=.6*this.oneStaffSpace,this.tabBendLabelPadding=.3*this.oneStaffSpace,this.leftHandTabTieWidth=2.2*this.oneStaffSpace,this.numberedDashGlyphWidth=1.5*this.oneStaffSpace,this.deadSlappedLineWidth=.25*this.oneStaffSpace,this.simpleSlideWidth=1.3*this.oneStaffSpace,this.simpleSlideHeight=.3*this.oneStaffSpace,this.chordDiagramPaddingX=Math.ceil(.5*this.oneStaffSpace),this.chordDiagramPaddingY=Math.ceil(.2*this.oneStaffSpace),this.chordDiagramStringSpacing=Math.ceil(1.1*this.oneStaffSpace),this.chordDiagramFretSpacing=Math.ceil(1.3*this.oneStaffSpace),this.chordDiagramNutHeight=Math.ceil(.33*this.oneStaffSpace),this.chordDiagramFretHeight=Math.ceil(.1*this.oneStaffSpace),this.chordDiagramLineWidth=Math.ceil(.11*this.oneStaffSpace),this.tripletFeelBracketPadding=.2*this.oneStaffSpace,this.accidentalPadding=.1*this.oneStaffSpace,this.preBeatGlyphSpacing=.5*this.oneStaffSpace,this.tuningGlyphStringRowPadding=.2*this.oneStaffSpace}static smuflNameToGlyphNameMapping=new Map([["4stringTabClef","FourStringTabClef"],["6stringTabClef","SixStringTabClef"]]);static _smuflNameToMusicFontSymbol(e){const t=Ha.smuflNameToGlyphNameMapping.has(e)?Ha.smuflNameToGlyphNameMapping.get(e):e.substring(0,1).toUpperCase()+e.substring(1);return q.parseEnumExact(t,S)}numberedBarRendererBarSize=0;numberedBarRendererBarSpacing=0;numberedDashGlyphPadding=0;numberedDashGlyphWidth=0;lineRangedGlyphDashGap=0;lineRangedGlyphDashSize=0;preNoteEffectPadding=0;postNoteEffectPadding=0;onNoteEffectPadding=0;stringNumberCirclePadding=0;rowContainerPadding=0;rowContainerGap=0;alternateEndingsPadding=0;sustainPedalLinePadding=0;tieHeight=0;beatTimerPadding=0;bendNoteHeadElementPadding=0;ghostParenthesisWidth=0;ghostParenthesisPadding=0;brokenBeamWidth=0;tabWhammyTextPadding=0;tabWhammyPerHalfHeight=0;tabWhammyDashSize=0;songBookWhammyDipHeight=0;deadSlappedLineWidth=0;leftHandTabTieWidth=0;tabBendDashSize=0;tabBendPerValueHeight=0;tabBendLabelPadding=0;simpleSlideWidth=0;simpleSlideHeight=0;chordDiagramPaddingX=0;chordDiagramPaddingY=0;chordDiagramStringSpacing=0;chordDiagramFretSpacing=0;chordDiagramNutHeight=0;chordDiagramFretHeight=0;chordDiagramLineWidth=0;tripletFeelBracketPadding=0;accidentalPadding=0;preBeatGlyphSpacing=0;tempoNoteScale=.7;tuningGlyphCircleNumberScale=.7;tuningGlyphStringColumnScale=1.5;tuningGlyphStringRowPadding=0;directionsScale=.6;static bravuraMetadata={engravingDefaults:{arrowShaftThickness:.16,barlineSeparation:.4,beamSpacing:.25,beamThickness:.5,bracketThickness:.5,dashedBarlineDashLength:.5,dashedBarlineGapLength:.25,dashedBarlineThickness:.16,hairpinThickness:.16,legerLineExtension:.4,legerLineThickness:.16,lyricLineThickness:.16,octaveLineThickness:.16,pedalLineThickness:.16,repeatBarlineDotSeparation:.16,repeatEndingLineThickness:.16,slurEndpointThickness:.1,slurMidpointThickness:.22,staffLineThickness:.13,stemThickness:.12,subBracketThickness:.16,textEnclosureThickness:.16,thickBarlineThickness:.5,thinBarlineThickness:.16,tieEndpointThickness:.1,tieMidpointThickness:.22,thinThickBarlineSeparation:.4,tupletBracketThickness:.16},glyphBBoxes:{FourStringTabClef:{bBoxNE:[1.088,2.016],bBoxSW:[-.012,-2.032]},SixStringTabClef:{bBoxNE:[1.632,3.056],bBoxSW:[-.012,-2.992]},accidentalDoubleFlat:{bBoxNE:[1.644,1.748],bBoxSW:[0,-.7]},accidentalDoubleSharp:{bBoxNE:[.988,.508],bBoxSW:[0,-.5]},accidentalFlat:{bBoxNE:[.904,1.756],bBoxSW:[0,-.7]},accidentalNatural:{bBoxNE:[.672,1.364],bBoxSW:[0,-1.34]},accidentalQuarterToneFlatArrowUp:{bBoxNE:[.992,2.316],bBoxSW:[-.168,-.708]},accidentalQuarterToneSharpNaturalArrowUp:{bBoxNE:[.848,2.188],bBoxSW:[-.104,-1.36]},accidentalSharp:{bBoxNE:[.996,1.4],bBoxSW:[0,-1.392]},accidentalThreeQuarterTonesSharpArrowUp:{bBoxNE:[1.1,2.12],bBoxSW:[0,-1.388]},arrowheadBlackDown:{bBoxNE:[.912,1.196],bBoxSW:[0,0]},arrowheadBlackUp:{bBoxNE:[.912,1.196],bBoxSW:[0,0]},articAccentAbove:{bBoxNE:[1.356,.98],bBoxSW:[0,.004]},articAccentBelow:{bBoxNE:[1.356,0],bBoxSW:[0,-.976]},articMarcatoAbove:{bBoxNE:[.94,1.012],bBoxSW:[-.004,-.004]},articMarcatoBelow:{bBoxNE:[.94,0],bBoxSW:[-.004,-1.016]},articStaccatoAbove:{bBoxNE:[.336,.336],bBoxSW:[0,0]},articStaccatoBelow:{bBoxNE:[.336,0],bBoxSW:[0,-.336]},articTenutoAbove:{bBoxNE:[1.352,.192],bBoxSW:[-.004,0]},articTenutoBelow:{bBoxNE:[1.352,0],bBoxSW:[-.004,-.192]},augmentationDot:{bBoxNE:[.4,.2],bBoxSW:[0,-.2]},brace:{bBoxNE:[.328,3.988],bBoxSW:[.008,0]},bracketBottom:{bBoxNE:[1.876,0],bBoxSW:[0,-1.18]},bracketTop:{bBoxNE:[1.876,1.18],bBoxSW:[0,0]},cClef:{bBoxNE:[2.796,2.024],bBoxSW:[0,-2.024]},cClef8vb:{bBoxNE:[2.796,2.024],bBoxSW:[0,-2.964]},clef15:{bBoxNE:[1.436,1.02],bBoxSW:[0,-.012]},clef8:{bBoxNE:[.82,.988],bBoxSW:[0,0]},coda:{bBoxNE:[3.82,3.592],bBoxSW:[-.016,-.632]},dynamicCrescendoHairpin:{bBoxNE:[2.944,1.424],bBoxSW:[.016,.372]},dynamicFF:{bBoxNE:[2.44,1.776],bBoxSW:[-.54,-.608]},dynamicFFF:{bBoxNE:[3.32,1.776],bBoxSW:[-.62,-.608]},dynamicFFFF:{bBoxNE:[4.28,1.776],bBoxSW:[-.62,-.608]},dynamicFFFFF:{bBoxNE:[5.24,1.776],bBoxSW:[-.62,-.608]},dynamicFFFFFF:{bBoxNE:[6.2,1.776],bBoxSW:[-.62,-.608]},dynamicForte:{bBoxNE:[1.456,1.776],bBoxSW:[-.564,-.608]},dynamicFortePiano:{bBoxNE:[2.476,1.776],bBoxSW:[-.564,-.608]},dynamicForzando:{bBoxNE:[1.988,1.776],bBoxSW:[-.564,-.608]},dynamicMF:{bBoxNE:[3.272,1.724],bBoxSW:[-.08,-.66]},dynamicMP:{bBoxNE:[3.3,1.096],bBoxSW:[-.08,-.568]},dynamicNiente:{bBoxNE:[1.232,1.096],bBoxSW:[-.092,-.04]},dynamicPF:{bBoxNE:[3.08,1.776],bBoxSW:[-.288,-.608]},dynamicPP:{bBoxNE:[2.912,1.096],bBoxSW:[-.328,-.568]},dynamicPPP:{bBoxNE:[4.292,1.096],bBoxSW:[-.368,-.568]},dynamicPPPP:{bBoxNE:[5.672,1.096],bBoxSW:[-.408,-.568]},dynamicPPPPP:{bBoxNE:[7.092,1.096],bBoxSW:[-.408,-.568]},dynamicPPPPPP:{bBoxNE:[8.512,1.096],bBoxSW:[-.408,-.568]},dynamicPiano:{bBoxNE:[1.464,1.096],bBoxSW:[-.356,-.568]},dynamicRinforzando1:{bBoxNE:[2.5,1.776],bBoxSW:[-.08,-.608]},dynamicRinforzando2:{bBoxNE:[2.976,1.776],bBoxSW:[-.08,-.608]},dynamicSforzando1:{bBoxNE:[2.416,1.776],bBoxSW:[0,-.608]},dynamicSforzandoPianissimo:{bBoxNE:[4.796,1.776],bBoxSW:[0,-.608]},dynamicSforzandoPiano:{bBoxNE:[3.38,1.776],bBoxSW:[0,-.608]},dynamicSforzato:{bBoxNE:[2.932,1.776],bBoxSW:[0,-.608]},dynamicSforzatoFF:{bBoxNE:[3.856,1.776],bBoxSW:[0,-.608]},dynamicSforzatoPiano:{bBoxNE:[4.304,1.776],bBoxSW:[0,-.608]},fClef:{bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.54]},fClef15ma:{bBoxNE:[2.736,1.984],bBoxSW:[-.02,-2.54]},fClef15mb:{bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.968]},fClef8va:{bBoxNE:[2.736,1.98],bBoxSW:[-.02,-2.54]},fClef8vb:{bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.976]},fermataAbove:{bBoxNE:[2.42,1.316],bBoxSW:[.012,-.012]},fermataLongAbove:{bBoxNE:[2.412,1.332],bBoxSW:[0,-.004]},fermataShortAbove:{bBoxNE:[2.416,1.364],bBoxSW:[0,0]},fingering0:{bBoxNE:[.94,1.004],bBoxSW:[.08,-.004]},fingering1:{bBoxNE:[.548,1.016],bBoxSW:[.08,0]},fingering2:{bBoxNE:[.888,1.012],bBoxSW:[.08,-.012]},fingering3:{bBoxNE:[.82,1.008],bBoxSW:[.08,0]},fingering4:{bBoxNE:[.864,1.012],bBoxSW:[.08,.004]},fingering5:{bBoxNE:[.82,1.032],bBoxSW:[.08,0]},fingeringALower:{bBoxNE:[1.068,1.032],bBoxSW:[0,-.02]},fingeringCLower:{bBoxNE:[.888,1.044],bBoxSW:[0,-.028]},fingeringILower:{bBoxNE:[.656,1.54],bBoxSW:[-.052,-.028]},fingeringMLower:{bBoxNE:[1.66,1.028],bBoxSW:[-.032,-.016]},fingeringPLower:{bBoxNE:[1.088,1.028],bBoxSW:[-.216,-.612]},fingeringTLower:{bBoxNE:[.604,1.484],bBoxSW:[0,-.028]},flag128thDown:{bBoxNE:[1.092,3.248],bBoxSW:[0,-2.32]},flag128thUp:{bBoxNE:[1.044,2.132],bBoxSW:[0,-3.248]},flag16thDown:{bBoxNE:[1.1635806326044895,3.2480256],bBoxSW:[0,-.036]},flag16thUp:{bBoxNE:[1.116,.008],bBoxSW:[0,-3.252]},flag256thDown:{bBoxNE:[1.196,3.252],bBoxSW:[0,-3.004]},flag256thUp:{bBoxNE:[1.056,2.816],bBoxSW:[0,-3.248]},flag32ndDown:{bBoxNE:[1.092,3.248],bBoxSW:[0,-.688]},flag32ndUp:{bBoxNE:[1.044,.596],bBoxSW:[0,-3.248]},flag64thDown:{bBoxNE:[1.092,3.248],bBoxSW:[0,-1.504]},flag64thUp:{bBoxNE:[1.044,1.388],bBoxSW:[0,-3.248]},flag8thDown:{bBoxNE:[1.224,3.232896633157715],bBoxSW:[0,-.056]},flag8thUp:{bBoxNE:[1.056,.036],bBoxSW:[0,-3.240768470618394]},fretboardFilledCircle:{bBoxNE:[.564,.564],bBoxSW:[0,0]},fretboardO:{bBoxNE:[.564,.564],bBoxSW:[0,0]},fretboardX:{bBoxNE:[.596,.596],bBoxSW:[0,0]},gClef:{bBoxNE:[2.684,4.392],bBoxSW:[0,-2.632]},gClef15ma:{bBoxNE:[2.684,5.276],bBoxSW:[0,-2.632]},gClef15mb:{bBoxNE:[2.684,4.392],bBoxSW:[0,-3.524]},gClef8va:{bBoxNE:[2.684,5.28],bBoxSW:[0,-2.632]},gClef8vb:{bBoxNE:[2.684,4.392],bBoxSW:[0,-3.512]},graceNoteSlashStemDown:{bBoxNE:[2.02,0],bBoxSW:[0,-1.604]},graceNoteSlashStemUp:{bBoxNE:[2.02,1.604],bBoxSW:[0,0]},guitarClosePedal:{bBoxNE:[1.144,1.14],bBoxSW:[0,-.004]},guitarFadeIn:{bBoxNE:[1.448,1.46],bBoxSW:[0,0]},guitarFadeOut:{bBoxNE:[1.448,1.46],bBoxSW:[0,0]},guitarGolpe:{bBoxNE:[1.08,1.128],bBoxSW:[.004,0]},guitarLeftHandTapping:{bBoxNE:[1.588,1.364],bBoxSW:[0,-.224]},guitarOpenPedal:{bBoxNE:[1.144,1.144],bBoxSW:[0,0]},guitarString0:{bBoxNE:[2.164,2.156],bBoxSW:[.004,0]},guitarString1:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString2:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString3:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString4:{bBoxNE:[2.164,2.156],bBoxSW:[.004,0]},guitarString5:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString6:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString7:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString8:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarString9:{bBoxNE:[2.16,2.156],bBoxSW:[0,0]},guitarVibratoStroke:{bBoxNE:[.668,.476],bBoxSW:[-.056,0]},guitarVolumeSwell:{bBoxNE:[2.896,1.46],bBoxSW:[0,0]},guitarWideVibratoStroke:{bBoxNE:[.908,.896],bBoxSW:[-.096,0]},keyboardPedalPed:{bBoxNE:[4.076,2.22],bBoxSW:[0,-.032]},keyboardPedalUp:{bBoxNE:[1.8,1.8],bBoxSW:[0,0]},metAugmentationDot:{bBoxNE:[.4,.2],bBoxSW:[0,-.2]},metNote8thUp:{bBoxNE:[2.132,2.784],bBoxSW:[0,-.564]},metNoteQuarterUp:{bBoxNE:[1.328,2.752],bBoxSW:[0,-.564]},note8thUp:{bBoxNE:[2.264,3.492],bBoxSW:[0,-.552]},noteQuarterUp:{bBoxNE:[1.328,3.5],bBoxSW:[0,-.564]},noteShapeDiamondBlack:{bBoxNE:[1.444,.548],bBoxSW:[0,-.552]},noteShapeDiamondWhite:{bBoxNE:[1.444,.544],bBoxSW:[0,-.556]},noteShapeMoonBlack:{bBoxNE:[1.444,.5],bBoxSW:[0,-.5]},noteShapeMoonWhite:{bBoxNE:[1.444,.5],bBoxSW:[0,-.5]},noteShapeRoundBlack:{bBoxNE:[1.456,.552],bBoxSW:[0,-.552]},noteShapeRoundWhite:{bBoxNE:[1.464,.548],bBoxSW:[0,-.548]},noteShapeSquareBlack:{bBoxNE:[1.44,.46],bBoxSW:[0,-.46]},noteShapeSquareWhite:{bBoxNE:[1.44,.46],bBoxSW:[0,-.46]},noteShapeTriangleLeftBlack:{bBoxNE:[1.44,.5],bBoxSW:[0,-.5]},noteShapeTriangleLeftWhite:{bBoxNE:[1.44,.5],bBoxSW:[0,-.5]},noteShapeTriangleRightBlack:{bBoxNE:[1.44,.5],bBoxSW:[0,-.5]},noteShapeTriangleRightWhite:{bBoxNE:[1.44,.5],bBoxSW:[0,-.5]},noteShapeTriangleRoundBlack:{bBoxNE:[1.424,.5],bBoxSW:[0,-.5]},noteShapeTriangleRoundWhite:{bBoxNE:[1.424,.5],bBoxSW:[0,-.5]},noteShapeTriangleUpBlack:{bBoxNE:[1.424,.5],bBoxSW:[0,-.5]},noteShapeTriangleUpWhite:{bBoxNE:[1.424,.5],bBoxSW:[0,-.5]},noteheadBlack:{bBoxNE:[1.18,.5],bBoxSW:[0,-.5]},noteheadCircleSlash:{bBoxNE:[1,.5],bBoxSW:[0,-.5]},noteheadCircleX:{bBoxNE:[.996,.5],bBoxSW:[0,-.5]},noteheadCircleXDoubleWhole:{bBoxNE:[1.688,.62],bBoxSW:[0,-.62]},noteheadCircleXHalf:{bBoxNE:[1,.5],bBoxSW:[0,-.5]},noteheadCircleXWhole:{bBoxNE:[.996,.5],bBoxSW:[0,-.5]},noteheadCircledBlack:{bBoxNE:[1.284,.668],bBoxSW:[-.084,-.684]},noteheadCircledDoubleWhole:{bBoxNE:[2.412,.852],bBoxSW:[0,-.872]},noteheadCircledHalf:{bBoxNE:[1.244,.668],bBoxSW:[-.072,-.648]},noteheadCircledWhole:{bBoxNE:[1.748,.844],bBoxSW:[0,-.9]},noteheadClusterDoubleWhole3rd:{bBoxNE:[2.428,1.62],bBoxSW:[0,-.62]},noteheadClusterHalf3rd:{bBoxNE:[1.264,1.5],bBoxSW:[0,-.5]},noteheadClusterQuarter3rd:{bBoxNE:[1.44,1.5],bBoxSW:[0,-.5]},noteheadClusterWhole3rd:{bBoxNE:[1.7,1.5],bBoxSW:[0,-.5]},noteheadDiamondBlack:{bBoxNE:[1,.5],bBoxSW:[0,-.5]},noteheadDiamondBlackWide:{bBoxNE:[1.4,.5],bBoxSW:[0,-.5]},noteheadDiamondDoubleWhole:{bBoxNE:[1.728,.62],bBoxSW:[0,-.62]},noteheadDiamondHalf:{bBoxNE:[1.004,.5],bBoxSW:[0,-.5]},noteheadDiamondWhite:{bBoxNE:[1,.5],bBoxSW:[0,-.5]},noteheadDiamondWhiteWide:{bBoxNE:[1.4,.5],bBoxSW:[0,-.5]},noteheadDiamondWhole:{bBoxNE:[1.08,.5],bBoxSW:[0,-.5]},noteheadDoubleWhole:{bBoxNE:[2.396,.62],bBoxSW:[0,-.62]},noteheadDoubleWholeSquare:{bBoxNE:[1.664,.792],bBoxSW:[0,-.76]},noteheadHalf:{bBoxNE:[1.18,.5],bBoxSW:[0,-.5]},noteheadHeavyX:{bBoxNE:[1.54,.5],bBoxSW:[0,-.5]},noteheadHeavyXHat:{bBoxNE:[1.828,1.04],bBoxSW:[-.292,-.5]},noteheadParenthesis:{bBoxNE:[1.472,.728],bBoxSW:[-.292,-.72]},noteheadPlusBlack:{bBoxNE:[.996,.5],bBoxSW:[-.004,-.5]},noteheadPlusDoubleWhole:{bBoxNE:[1.892,.62],bBoxSW:[0,-.62]},noteheadPlusHalf:{bBoxNE:[1.044,.5],bBoxSW:[0,-.5]},noteheadPlusWhole:{bBoxNE:[1.14,.5],bBoxSW:[0,-.5]},noteheadRoundWhiteWithDot:{bBoxNE:[1.004,.5],bBoxSW:[0,-.5]},noteheadSlashHorizontalEnds:{bBoxNE:[2.12,1],bBoxSW:[0,-1]},noteheadSlashWhiteHalf:{bBoxNE:[3.12,1],bBoxSW:[0,-1]},noteheadSlashWhiteWhole:{bBoxNE:[3.92,1],bBoxSW:[0,-1]},noteheadSlashedBlack1:{bBoxNE:[1.5,.668],bBoxSW:[-.32,-.66]},noteheadSlashedBlack2:{bBoxNE:[1.504,.672],bBoxSW:[-.316,-.656]},noteheadSlashedDoubleWhole1:{bBoxNE:[2.384,.672],bBoxSW:[0,-.716]},noteheadSlashedDoubleWhole2:{bBoxNE:[2.384,.676],bBoxSW:[0,-.712]},noteheadSlashedHalf1:{bBoxNE:[1.544,.64],bBoxSW:[-.268,-.568]},noteheadSlashedHalf2:{bBoxNE:[1.52,.672],bBoxSW:[-.292,-.536]},noteheadSlashedWhole1:{bBoxNE:[1.732,.592],bBoxSW:[-.088,-.628]},noteheadSlashedWhole2:{bBoxNE:[1.744,.604],bBoxSW:[-.072,-.616]},noteheadSquareBlack:{bBoxNE:[1.252,.5],bBoxSW:[0,-.5]},noteheadSquareBlackLarge:{bBoxNE:[2,1],bBoxSW:[0,-1]},noteheadSquareBlackWhite:{bBoxNE:[2,1],bBoxSW:[0,-1]},noteheadSquareWhite:{bBoxNE:[1.252,.5],bBoxSW:[0,-.5]},noteheadTriangleDownBlack:{bBoxNE:[1.168,.5],bBoxSW:[0,-.5]},noteheadTriangleDownDoubleWhole:{bBoxNE:[1.932,.62],bBoxSW:[0,-.62]},noteheadTriangleDownHalf:{bBoxNE:[1.14,.5],bBoxSW:[0,-.5]},noteheadTriangleDownWhole:{bBoxNE:[1.276,.5],bBoxSW:[0,-.5]},noteheadTriangleRightBlack:{bBoxNE:[1.356,.5],bBoxSW:[0,-.5]},noteheadTriangleRightWhite:{bBoxNE:[1.356,.5],bBoxSW:[0,-.5]},noteheadTriangleUpBlack:{bBoxNE:[1.172,.5],bBoxSW:[0,-.5]},noteheadTriangleUpDoubleWhole:{bBoxNE:[1.932,.62],bBoxSW:[0,-.62]},noteheadTriangleUpHalf:{bBoxNE:[1.14,.5],bBoxSW:[0,-.5]},noteheadTriangleUpWhole:{bBoxNE:[1.276,.5],bBoxSW:[0,-.5]},noteheadWhole:{bBoxNE:[1.688,.5],bBoxSW:[0,-.5]},noteheadXBlack:{bBoxNE:[1.16,.5],bBoxSW:[0,-.5]},noteheadXDoubleWhole:{bBoxNE:[2.184,.62],bBoxSW:[0,-.62]},noteheadXHalf:{bBoxNE:[1.336,.5],bBoxSW:[0,-.5]},noteheadXOrnate:{bBoxNE:[.988,.504],bBoxSW:[0,-.504]},noteheadXWhole:{bBoxNE:[1.508,.5],bBoxSW:[0,-.5]},octaveBaselineB:{bBoxNE:[.796,1.352],bBoxSW:[0,-.04]},octaveBaselineM:{bBoxNE:[1.524,.928],bBoxSW:[0,-.02]},ornamentMordent:{bBoxNE:[2.916,1.276],bBoxSW:[.004,-.292]},ornamentShortTrill:{bBoxNE:[2.9,.98],bBoxSW:[0,0]},ornamentTrill:{bBoxNE:[2.084,1.56],bBoxSW:[0,-.04]},ornamentTurn:{bBoxNE:[1.84,.872],bBoxSW:[0,0]},ornamentTurnInverted:{bBoxNE:[1.828,.872],bBoxSW:[-.012,0]},ottava:{bBoxNE:[1.544,1.852],bBoxSW:[0,-.04]},ottavaAlta:{bBoxNE:[3.54,1.852],bBoxSW:[0,-.04]},ottavaBassaVb:{bBoxNE:[3.184,1.852],bBoxSW:[0,-.04]},pictEdgeOfCymbal:{bBoxNE:[4.828,2.14],bBoxSW:[.004,0]},quindicesima:{bBoxNE:[2.668,1.844],bBoxSW:[0,-.04]},quindicesimaAlta:{bBoxNE:[5.26,1.844],bBoxSW:[0,-.04]},repeat1Bar:{bBoxNE:[2.128,1.116],bBoxSW:[0,-1]},repeat2Bars:{bBoxNE:[3.048,1.116],bBoxSW:[0,-1]},repeatDot:{bBoxNE:[.4,.2],bBoxSW:[0,-.2]},rest128th:{bBoxNE:[1.94,2.756],bBoxSW:[0,-3]},rest16th:{bBoxNE:[1.28,.716],bBoxSW:[0,-2]},rest256th:{bBoxNE:[2.164,2.784],bBoxSW:[0,-4]},rest32nd:{bBoxNE:[1.452,1.704],bBoxSW:[0,-2]},rest64th:{bBoxNE:[1.692,1.72],bBoxSW:[0,-3.012]},rest8th:{bBoxNE:[.988,.696],bBoxSW:[0,-1.004]},restDoubleWhole:{bBoxNE:[.5,1],bBoxSW:[0,0]},restHBarLeft:{bBoxNE:[1.5,1.048],bBoxSW:[0,-1.08]},restHBarMiddle:{bBoxNE:[1.42,.384],bBoxSW:[-.108,-.416]},restHBarRight:{bBoxNE:[1.5,1.048],bBoxSW:[0,-1.08]},restHalf:{bBoxNE:[1.128,.568],bBoxSW:[0,-.008]},restLonga:{bBoxNE:[.5,1],bBoxSW:[0,-.996]},restQuarter:{bBoxNE:[1.08,1.492],bBoxSW:[.004,-1.5]},restWhole:{bBoxNE:[1.128,.036],bBoxSW:[0,-.54]},segno:{bBoxNE:[2.2,3.036],bBoxSW:[.016,-.108]},stringsDownBow:{bBoxNE:[1.248,1.272],bBoxSW:[0,0]},stringsUpBow:{bBoxNE:[.996,1.98],bBoxSW:[.004,.004]},systemDivider:{bBoxNE:[4.232,4.24],bBoxSW:[0,-.272]},textAugmentationDot:{bBoxNE:[.4,.256],bBoxSW:[0,-.144]},textBlackNoteFrac16thLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,-.56]},textBlackNoteFrac32ndLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,-.56]},textBlackNoteFrac8thLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,-.56]},textBlackNoteLongStem:{bBoxNE:[1.328,3.512],bBoxSW:[0,-.564]},textCont16thBeamLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,2.264]},textCont32ndBeamLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,1.504]},textCont8thBeamLongStem:{bBoxNE:[1.368,3.512],bBoxSW:[0,3.012]},textTuplet3LongStem:{bBoxNE:[.94,5.3],bBoxSW:[0,4.2]},textTupletBracketEndLongStem:{bBoxNE:[1.272,4.764],bBoxSW:[0,3.94]},textTupletBracketStartLongStem:{bBoxNE:[1.272,4.764],bBoxSW:[0,3.94]},timeSig0:{bBoxNE:[1.8,1.004],bBoxSW:[.08,-1]},timeSig1:{bBoxNE:[1.256,1.004],bBoxSW:[.08,-1]},timeSig2:{bBoxNE:[1.704,1.016],bBoxSW:[.08,-1.028]},timeSig3:{bBoxNE:[1.604,.996],bBoxSW:[.08,-1.004]},timeSig4:{bBoxNE:[1.8,1.004],bBoxSW:[.08,-1]},timeSig5:{bBoxNE:[1.532,.984],bBoxSW:[.08,-1.004]},timeSig6:{bBoxNE:[1.656,1.004],bBoxSW:[.08,-.996]},timeSig7:{bBoxNE:[1.684,.996],bBoxSW:[.08,-1]},timeSig8:{bBoxNE:[1.664,1.036],bBoxSW:[.08,-1.036]},timeSig9:{bBoxNE:[1.656,1.004],bBoxSW:[.08,-.996]},timeSigCommon:{bBoxNE:[1.696,1.004],bBoxSW:[.02,-.996]},timeSigCutCommon:{bBoxNE:[1.672,1.444],bBoxSW:[0,-1.436]},tremolo1:{bBoxNE:[.6,.376],bBoxSW:[-.6,-.372]},tremolo2:{bBoxNE:[.596,.748],bBoxSW:[-.604,-.748]},tremolo3:{bBoxNE:[.6,1.112],bBoxSW:[-.6,-1.12]},tuplet0:{bBoxNE:[1.2731041262817027,1.5],bBoxSW:[-.001204330173715796,-.032]},tuplet1:{bBoxNE:[1.024,1.488],bBoxSW:[.04,0]},tuplet2:{bBoxNE:[1.316,1.5],bBoxSW:[.04,-.024]},tuplet3:{bBoxNE:[1.224,1.5],bBoxSW:[.04,-.032]},tuplet4:{bBoxNE:[1.252,1.488],bBoxSW:[.04,0]},tuplet5:{bBoxNE:[1.308,1.492],bBoxSW:[.04,-.032]},tuplet6:{bBoxNE:[1.256,1.5],bBoxSW:[.04105974105482295,-.032]},tuplet7:{bBoxNE:[1.332,1.488],bBoxSW:[.12,-.016]},tuplet8:{bBoxNE:[1.292,1.5],bBoxSW:[.04,-.032]},tuplet9:{bBoxNE:[1.254940258945177,1.5],bBoxSW:[.04,-.032]},tupletColon:{bBoxNE:[.484,1.072],bBoxSW:[.04,.232]},unpitchedPercussionClef1:{bBoxNE:[1.528,1],bBoxSW:[0,-1]},wiggleSawtooth:{bBoxNE:[3.06,1.06],bBoxSW:[-.068,-1.068]},wiggleSawtoothNarrow:{bBoxNE:[2.06,1.064],bBoxSW:[-.072,-1.064]},wiggleTrill:{bBoxNE:[1.08,.836],bBoxSW:[-.144,.392]},wiggleVibratoMediumFast:{bBoxNE:[1.292,.8],bBoxSW:[-.104,-.164]}},glyphsWithAnchors:{accidentalDoubleFlat:{cutOutNE:[.988,.644],cutOutSE:[1.336,-.396]},accidentalFlat:{cutOutNE:[.252,.656],cutOutSE:[.504,-.476]},accidentalNatural:{cutOutNE:[.192,.776],cutOutSW:[.476,-.828]},accidentalQuarterToneFlatArrowUp:{cutOutNE:[.604,.664],cutOutSE:[.62,-.452]},accidentalQuarterToneSharpNaturalArrowUp:{cutOutSW:[.616,-.868]},accidentalSharp:{cutOutNE:[.84,.896],cutOutNW:[.144,.568],cutOutSE:[.84,-.596],cutOutSW:[.144,-.896]},accidentalThreeQuarterTonesSharpArrowUp:{cutOutNW:[.272,1.304],cutOutSE:[.86,-.584],cutOutSW:[.132,-.888]},dynamicFF:{opticalCenter:[1.852,0]},dynamicFFF:{opticalCenter:[2.472,0]},dynamicFFFF:{opticalCenter:[2.824,0]},dynamicFFFFF:{opticalCenter:[2.976,0]},dynamicFFFFFF:{opticalCenter:[3.504,0]},dynamicForte:{opticalCenter:[1.256,0]},dynamicFortePiano:{opticalCenter:[1.5,0]},dynamicForzando:{opticalCenter:[1.352,0]},dynamicMF:{opticalCenter:[1.796,0]},dynamicMP:{opticalCenter:[1.848,0]},dynamicNiente:{opticalCenter:[.616,0]},dynamicPF:{opticalCenter:[1.68,0]},dynamicPP:{opticalCenter:[1.708,0]},dynamicPPP:{opticalCenter:[2.368,0]},dynamicPPPP:{opticalCenter:[3.004,0]},dynamicPPPPP:{opticalCenter:[3.552,0]},dynamicPPPPPP:{opticalCenter:[4.248,0]},dynamicPiano:{opticalCenter:[1.22,0]},dynamicRinforzando1:{opticalCenter:[1.564,0]},dynamicRinforzando2:{opticalCenter:[2.084,0]},dynamicSforzando1:{opticalCenter:[1.3,0]},dynamicSforzandoPianissimo:{opticalCenter:[1.972,0]},dynamicSforzandoPiano:{opticalCenter:[1.904,0]},dynamicSforzato:{opticalCenter:[1.76,0]},dynamicSforzatoFF:{opticalCenter:[2.276,0]},dynamicSforzatoPiano:{opticalCenter:[1.848,0]},flag128thDown:{stemDownSW:[0,-2.076]},flag128thUp:{stemUpNW:[0,1.9]},flag16thDown:{stemDownSW:[0,.128]},flag16thUp:{stemUpNW:[0,-.088]},flag256thDown:{stemDownSW:[0,-2.812]},flag256thUp:{stemUpNW:[0,2.592]},flag32ndDown:{stemDownSW:[0,-.448]},flag32ndUp:{stemUpNW:[0,.376]},flag64thDown:{stemDownSW:[0,-1.244]},flag64thUp:{stemUpNW:[0,1.172]},flag8thDown:{graceNoteSlashNW:[-.596,2.168],graceNoteSlashSE:[1.328,.628],stemDownSW:[0,.132]},flag8thUp:{graceNoteSlashNE:[1.284,-.796],graceNoteSlashSW:[-.644,-2.456],stemUpNW:[0,-.04]},guitarVibratoStroke:{repeatOffset:[.608,0]},guitarWideVibratoStroke:{repeatOffset:[.82,0]},noteShapeDiamondBlack:{stemDownNW:[0,0],stemUpSE:[1.444,0]},noteShapeDiamondWhite:{stemDownNW:[0,0],stemUpSE:[1.436,0]},noteShapeMoonBlack:{stemDownNW:[0,.068],stemUpSE:[1.44,.068]},noteShapeMoonWhite:{stemDownNW:[0,.072],stemUpSE:[1.444,.068]},noteShapeRoundBlack:{stemDownNW:[0,-.168],stemUpSE:[1.444,.184]},noteShapeRoundWhite:{stemDownNW:[0,-.168],stemUpSE:[1.456,.192]},noteShapeSquareBlack:{stemDownNW:[0,.46],stemUpSE:[1.44,-.46]},noteShapeSquareWhite:{stemDownNW:[0,.46],stemUpSE:[1.44,-.46]},noteShapeTriangleLeftBlack:{stemDownNW:[0,.5],stemUpSE:[1.436,-.5]},noteShapeTriangleLeftWhite:{stemDownNW:[0,.5],stemUpSE:[1.436,-.5]},noteShapeTriangleRightBlack:{stemDownNW:[0,.476],stemUpSE:[1.44,-.5]},noteShapeTriangleRightWhite:{stemDownNW:[0,.476],stemUpSE:[1.44,-.5]},noteShapeTriangleRoundBlack:{stemDownNW:[0,.172],stemUpSE:[1.424,.172]},noteShapeTriangleRoundWhite:{stemDownNW:[0,.172],stemUpSE:[1.424,.172]},noteShapeTriangleUpBlack:{stemDownNW:[0,-.5],stemUpSE:[1.424,-.5]},noteShapeTriangleUpWhite:{stemDownNW:[0,-.5],stemUpSE:[1.424,-.5]},noteheadBlack:{cutOutNW:[.208,.3],cutOutSE:[.94,-.296],splitStemDownNE:[.968,-.248],splitStemDownNW:[.12,-.416],splitStemUpSE:[1.092,.392],splitStemUpSW:[.312,.356],stemDownNW:[0,-.168],stemUpSE:[1.18,.168]},noteheadCircleSlash:{stemDownNW:[.004,0],stemUpSE:[1,0]},noteheadCircleX:{stemDownNW:[0,0],stemUpSE:[.996,0]},noteheadCircleXDoubleWhole:{noteheadOrigin:[.352,0]},noteheadCircleXHalf:{stemDownNW:[0,0],stemUpSE:[1,0]},noteheadCircledBlack:{stemDownNW:[0,-.164],stemUpSE:[1.18,.168]},noteheadCircledDoubleWhole:{noteheadOrigin:[.356,0]},noteheadCircledHalf:{stemDownNW:[0,-.144],stemUpSE:[1.172,.156]},noteheadClusterDoubleWhole3rd:{noteheadOrigin:[.364,0]},noteheadClusterHalf3rd:{stemDownNW:[0,-.164],stemUpSE:[1.264,1.144]},noteheadClusterQuarter3rd:{stemDownNW:[0,.26],stemUpSE:[1.44,.744]},noteheadDiamondBlack:{stemDownNW:[0,0],stemUpSE:[1,0]},noteheadDiamondBlackWide:{stemDownNW:[0,0],stemUpSE:[1.4,0]},noteheadDiamondDoubleWhole:{noteheadOrigin:[.324,0]},noteheadDiamondHalf:{stemDownNW:[0,0],stemUpSE:[1.004,0]},noteheadDiamondWhite:{stemDownNW:[0,0],stemUpSE:[1,0]},noteheadDiamondWhiteWide:{stemDownNW:[0,.004],stemUpSE:[1.4,0]},noteheadDoubleWhole:{noteheadOrigin:[.36,0]},noteheadHalf:{cutOutNW:[.204,.296],cutOutSE:[.98,-.3],splitStemDownNE:[.956,-.3],splitStemDownNW:[.128,-.428],splitStemUpSE:[1.108,.372],splitStemUpSW:[.328,.38],stemDownNW:[0,-.168],stemUpSE:[1.18,.168]},noteheadHeavyX:{stemDownNW:[0,-.436],stemUpSE:[1.54,.44]},noteheadHeavyXHat:{stemDownNW:[0,-.436],stemUpSE:[1.54,.456]},noteheadPlusBlack:{stemDownNW:[-.004,0],stemUpSE:[.996,0]},noteheadPlusDoubleWhole:{noteheadOrigin:[.372,0]},noteheadPlusHalf:{stemDownNW:[0,-.112],stemUpSE:[1.044,.088]},noteheadRoundWhiteWithDot:{stemDownNW:[0,0],stemUpSE:[1.004,0]},noteheadSlashHorizontalEnds:{stemDownNW:[0,-1],stemUpSE:[2.12,1]},noteheadSlashWhiteHalf:{stemDownNW:[0,-1],stemUpSE:[3.12,1]},noteheadSlashedBlack1:{stemDownNW:[0,-.172],stemUpSE:[1.18,.164]},noteheadSlashedBlack2:{stemDownNW:[0,-.172],stemUpSE:[1.18,.164]},noteheadSlashedDoubleWhole1:{noteheadOrigin:[.356,0]},noteheadSlashedDoubleWhole2:{noteheadOrigin:[.356,0]},noteheadSlashedHalf1:{stemDownNW:[0,-.168],stemUpSE:[1.168,.164]},noteheadSlashedHalf2:{stemDownNW:[0,-.164],stemUpSE:[1.172,.168]},noteheadSquareBlack:{stemDownNW:[0,-.5],stemUpSE:[1.252,.5]},noteheadSquareBlackLarge:{stemDownNW:[0,0],stemUpSE:[2,0]},noteheadSquareBlackWhite:{stemDownNW:[0,-1],stemUpSE:[2,1]},noteheadSquareWhite:{stemDownNW:[0,-.5],stemUpSE:[1.252,.5]},noteheadTriangleDownBlack:{stemDownNW:[0,.5],stemUpSE:[1.168,.5]},noteheadTriangleDownDoubleWhole:{noteheadOrigin:[.384,0]},noteheadTriangleDownHalf:{stemDownNW:[0,.464],stemUpSE:[1.14,.464]},noteheadTriangleRightBlack:{stemDownNW:[0,-.5],stemUpSE:[1.356,.5]},noteheadTriangleRightWhite:{stemDownNW:[0,-.5],stemUpSE:[1.356,.5]},noteheadTriangleUpBlack:{stemDownNW:[0,-.5],stemUpSE:[1.172,-.5]},noteheadTriangleUpDoubleWhole:{noteheadOrigin:[.34,0]},noteheadTriangleUpHalf:{stemDownNW:[0,-.46],stemUpSE:[1.14,-.46]},noteheadWhole:{cutOutNW:[.172,.332],cutOutSE:[1.532,-.364]},noteheadXBlack:{stemDownNW:[0,-.44],stemUpSE:[1.16,.444]},noteheadXDoubleWhole:{noteheadOrigin:[.348,0]},noteheadXHalf:{stemDownNW:[0,-.412],stemUpSE:[1.336,.412]},noteheadXOrnate:{stemDownNW:[0,-.312],stemUpSE:[.988,.316]},wiggleSawtooth:{repeatOffset:[2.992,0]},wiggleSawtoothNarrow:{repeatOffset:[1.996,0]},wiggleTrill:{repeatOffset:[.948,0]},wiggleVibratoMediumFast:{repeatOffset:[1.18,0]}}}}class en{static _sansFont="Arial, sans-serif";static _serifFont="Georgia, serif";smuflFontFamilyName;engravingSettings=Ha.bravuraDefaults;copyrightFont=new nt(en._sansFont,12,pi.Plain,fn.Bold);titleFont=new nt(en._serifFont,32,pi.Plain);subTitleFont=new nt(en._serifFont,20,pi.Plain);wordsFont=new nt(en._serifFont,15,pi.Plain);effectFont=new nt(en._serifFont,12,pi.Italic);timerFont=new nt(en._serifFont,12,pi.Plain);directionsFont=new nt(en._serifFont,14,pi.Plain);fretboardNumberFont=new nt(en._sansFont,11,pi.Plain);numberedNotationFont=new nt(en._sansFont,16,pi.Plain);numberedNotationGraceFont=new nt(en._sansFont,14,pi.Plain);tablatureFont=new nt(en._sansFont,14,pi.Plain);graceFont=new nt(en._sansFont,12,pi.Plain);staffLineColor=new Tt(165,165,165,255);barSeparatorColor=new Tt(34,34,17,255);barNumberFont=new nt(en._sansFont,11,pi.Plain);barNumberColor=new Tt(200,0,0,255);fingeringFont=new nt(en._serifFont,14,pi.Plain);inlineFingeringFont=new nt(en._serifFont,12,pi.Plain);markerFont=new nt(en._serifFont,14,pi.Plain,fn.Bold);mainGlyphColor=new Tt(0,0,0,255);secondaryGlyphColor=new Tt(0,0,0,100);scoreInfoColor=new Tt(0,0,0,255);getFontForElement(e){switch(e){case ye.Title:return this.titleFont;case ye.SubTitle:case ye.Artist:case ye.Album:return this.subTitleFont;case ye.Words:case ye.Music:case ye.WordsAndMusic:case ye.Transcriber:return this.wordsFont;case ye.Copyright:case ye.CopyrightSecondLine:return this.copyrightFont}return this.wordsFont}}var qr;(function(n){n[n.Default=0]="Default",n[n.ScoreTab=1]="ScoreTab",n[n.Score=2]="Score",n[n.Tab=3]="Tab",n[n.TabMixed=4]="TabMixed"})(qr||(qr={}));var Qo;(function(n){n[n.Automatic=0]="Automatic",n[n.UseModelLayout=1]="UseModelLayout"})(Qo||(Qo={}));class BR{scale=1;stretchForce=1;layoutMode=jr.Page;staveProfile=qr.Default;barsPerRow=-1;startBar=1;barCount=-1;barCountPerPartial=10;justifyLastSystem=!1;resources=new en;padding=[35,35];firstSystemPaddingTop=5;systemPaddingTop=10;systemPaddingBottom=10;lastSystemPaddingBottom=0;systemLabelPaddingLeft=0;systemLabelPaddingRight=3;accoladeBarPaddingRight=3;notationStaffPaddingTop=5;notationStaffPaddingBottom=5;effectStaffPaddingTop=0;effectStaffPaddingBottom=0;firstStaffPaddingLeft=6;staffPaddingLeft=2;effectBandPaddingBottom=2;systemsLayoutMode=Qo.Automatic}class TR{encoding="utf-8";mergePartGroupsInMusicXml=!1;beatTextAsLyrics=!1}var pr;(function(n){n[n.Off=0]="Off",n[n.Continuous=1]="Continuous",n[n.OffScreen=2]="OffScreen"})(pr||(pr={}));class xR{noteWideLength=240;noteWideAmplitude=1;noteSlightLength=360;noteSlightAmplitude=.5;beatWideLength=480;beatWideAmplitude=2;beatSlightLength=480;beatSlightAmplitude=2}class vR{simpleSlidePitchOffset=6;simpleSlideDurationRatio=.25;shiftSlideDurationRatio=.5}var zh;(function(n){n[n.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",n[n.WebAudioScriptProcessor=1]="WebAudioScriptProcessor"})(zh||(zh={}));var nn;(function(n){n[n.Disabled=0]="Disabled",n[n.EnabledAutomatic=1]="EnabledAutomatic",n[n.EnabledSynthesizer=2]="EnabledSynthesizer",n[n.EnabledBackingTrack=3]="EnabledBackingTrack",n[n.EnabledExternalMedia=4]="EnabledExternalMedia"})(nn||(nn={}));class NR{soundFont=null;scrollElement="html,body";outputMode=zh.WebAudioAudioWorklets;enablePlayer=!1;playerMode=nn.Disabled;enableCursor=!0;enableAnimatedBeatCursor=!0;enableElementHighlighting=!0;enableUserInteraction=!0;scrollOffsetX=0;scrollOffsetY=0;scrollMode=pr.Continuous;scrollSpeed=300;nativeBrowserSmoothScroll=!0;songBookBendDuration=75;songBookDipDuration=150;vibrato=new xR;slide=new vR;playTripletFeel=!0;bufferTimeInMilliseconds=500}class Th{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Th.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),e.smuflFontSources!==null){const i=new Map;t.set("smuflfontsources",i);for(const[s,a]of e.smuflFontSources)i.set(s.toString(),a)}return t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,i){switch(t){case"scriptfile":return e.scriptFile=i,!0;case"fontdirectory":return e.fontDirectory=i,!0;case"smuflfontsources":return e.smuflFontSources=new Map,q.forEach(i,(s,a)=>{e.smuflFontSources.set(q.parseEnum(a,Ea),s)}),!0;case"file":return e.file=i,!0;case"tex":return e.tex=i,!0;case"tracks":return e.tracks=i,!0;case"enablelazyloading":return e.enableLazyLoading=i,!0;case"engine":return e.engine=i,!0;case"loglevel":return e.logLevel=q.parseEnum(i,za),!0;case"useworkers":return e.useWorkers=i,!0;case"includenotebounds":return e.includeNoteBounds=i,!0}return!1}}class Uc{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Uc.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("topy",e.topY),t.set("bottomy",e.bottomY),t.set("x",e.x),t}static setProperty(e,t,i){switch(t){case"topy":return e.topY=i,!0;case"bottomy":return e.bottomY=i,!0;case"x":return e.x=i,!0}return!1}}class fp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>fp.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;t.set("musicfontsize",e.musicFontSize),t.set("onestaffspace",e.oneStaffSpace),t.set("tablinespacing",e.tabLineSpacing),t.set("arrowshaftthickness",e.arrowShaftThickness),t.set("barlineseparation",e.barlineSeparation),t.set("beamspacing",e.beamSpacing),t.set("beamthickness",e.beamThickness),t.set("bracketthickness",e.bracketThickness),t.set("dashedbarlinedashlength",e.dashedBarlineDashLength),t.set("dashedbarlinegaplength",e.dashedBarlineGapLength),t.set("dashedbarlinethickness",e.dashedBarlineThickness),t.set("hairpinthickness",e.hairpinThickness),t.set("legerlinethickness",e.legerLineThickness),t.set("legerlineextension",e.legerLineExtension),t.set("octavelinethickness",e.octaveLineThickness),t.set("pedallinethickness",e.pedalLineThickness),t.set("repeatbarlinedotseparation",e.repeatBarlineDotSeparation),t.set("repeatendinglinethickness",e.repeatEndingLineThickness),t.set("slurmidpointthickness",e.slurMidpointThickness),t.set("stafflinethickness",e.staffLineThickness),t.set("stemthickness",e.stemThickness),t.set("thickbarlinethickness",e.thickBarlineThickness),t.set("thinbarlinethickness",e.thinBarlineThickness),t.set("thinthickbarlineseparation",e.thinThickBarlineSeparation),t.set("tiemidpointthickness",e.tieMidpointThickness),t.set("tupletbracketthickness",e.tupletBracketThickness);{const i=new Map;t.set("stemup",i);for(const[s,a]of e.stemUp)i.set(s.toString(),Uc.toJson(a))}{const i=new Map;t.set("stemdown",i);for(const[s,a]of e.stemDown)i.set(s.toString(),Uc.toJson(a))}{const i=new Map;t.set("repeatoffsetx",i);for(const[s,a]of e.repeatOffsetX)i.set(s.toString(),a)}t.set("standardstemlength",e.standardStemLength);{const i=new Map;t.set("stemflagoffsets",i);for(const[s,a]of e.stemFlagOffsets)i.set(s.toString(),a)}{const i=new Map;t.set("glyphtop",i);for(const[s,a]of e.glyphTop)i.set(s.toString(),a)}{const i=new Map;t.set("glyphbottom",i);for(const[s,a]of e.glyphBottom)i.set(s.toString(),a)}{const i=new Map;t.set("glyphwidths",i);for(const[s,a]of e.glyphWidths)i.set(s.toString(),a)}{const i=new Map;t.set("glyphheights",i);for(const[s,a]of e.glyphHeights)i.set(s.toString(),a)}return t.set("numberedbarrendererbarsize",e.numberedBarRendererBarSize),t.set("numberedbarrendererbarspacing",e.numberedBarRendererBarSpacing),t.set("numbereddashglyphpadding",e.numberedDashGlyphPadding),t.set("numbereddashglyphwidth",e.numberedDashGlyphWidth),t.set("linerangedglyphdashgap",e.lineRangedGlyphDashGap),t.set("linerangedglyphdashsize",e.lineRangedGlyphDashSize),t.set("prenoteeffectpadding",e.preNoteEffectPadding),t.set("postnoteeffectpadding",e.postNoteEffectPadding),t.set("onnoteeffectpadding",e.onNoteEffectPadding),t.set("stringnumbercirclepadding",e.stringNumberCirclePadding),t.set("rowcontainerpadding",e.rowContainerPadding),t.set("rowcontainergap",e.rowContainerGap),t.set("alternateendingspadding",e.alternateEndingsPadding),t.set("sustainpedallinepadding",e.sustainPedalLinePadding),t.set("tieheight",e.tieHeight),t.set("beattimerpadding",e.beatTimerPadding),t.set("bendnoteheadelementpadding",e.bendNoteHeadElementPadding),t.set("ghostparenthesiswidth",e.ghostParenthesisWidth),t.set("ghostparenthesispadding",e.ghostParenthesisPadding),t.set("brokenbeamwidth",e.brokenBeamWidth),t.set("tabwhammytextpadding",e.tabWhammyTextPadding),t.set("tabwhammyperhalfheight",e.tabWhammyPerHalfHeight),t.set("tabwhammydashsize",e.tabWhammyDashSize),t.set("songbookwhammydipheight",e.songBookWhammyDipHeight),t.set("deadslappedlinewidth",e.deadSlappedLineWidth),t.set("lefthandtabtiewidth",e.leftHandTabTieWidth),t.set("tabbenddashsize",e.tabBendDashSize),t.set("tabbendpervalueheight",e.tabBendPerValueHeight),t.set("tabbendlabelpadding",e.tabBendLabelPadding),t.set("simpleslidewidth",e.simpleSlideWidth),t.set("simpleslideheight",e.simpleSlideHeight),t.set("chorddiagrampaddingx",e.chordDiagramPaddingX),t.set("chorddiagrampaddingy",e.chordDiagramPaddingY),t.set("chorddiagramstringspacing",e.chordDiagramStringSpacing),t.set("chorddiagramfretspacing",e.chordDiagramFretSpacing),t.set("chorddiagramnutheight",e.chordDiagramNutHeight),t.set("chorddiagramfretheight",e.chordDiagramFretHeight),t.set("chorddiagramlinewidth",e.chordDiagramLineWidth),t.set("tripletfeelbracketpadding",e.tripletFeelBracketPadding),t.set("accidentalpadding",e.accidentalPadding),t.set("prebeatglyphspacing",e.preBeatGlyphSpacing),t.set("temponotescale",e.tempoNoteScale),t.set("tuningglyphcirclenumberscale",e.tuningGlyphCircleNumberScale),t.set("tuningglyphstringcolumnscale",e.tuningGlyphStringColumnScale),t.set("tuningglyphstringrowpadding",e.tuningGlyphStringRowPadding),t.set("directionsscale",e.directionsScale),t}static setProperty(e,t,i){switch(t){case"musicfontsize":return e.musicFontSize=i,!0;case"onestaffspace":return e.oneStaffSpace=i,!0;case"tablinespacing":return e.tabLineSpacing=i,!0;case"arrowshaftthickness":return e.arrowShaftThickness=i,!0;case"barlineseparation":return e.barlineSeparation=i,!0;case"beamspacing":return e.beamSpacing=i,!0;case"beamthickness":return e.beamThickness=i,!0;case"bracketthickness":return e.bracketThickness=i,!0;case"dashedbarlinedashlength":return e.dashedBarlineDashLength=i,!0;case"dashedbarlinegaplength":return e.dashedBarlineGapLength=i,!0;case"dashedbarlinethickness":return e.dashedBarlineThickness=i,!0;case"hairpinthickness":return e.hairpinThickness=i,!0;case"legerlinethickness":return e.legerLineThickness=i,!0;case"legerlineextension":return e.legerLineExtension=i,!0;case"octavelinethickness":return e.octaveLineThickness=i,!0;case"pedallinethickness":return e.pedalLineThickness=i,!0;case"repeatbarlinedotseparation":return e.repeatBarlineDotSeparation=i,!0;case"repeatendinglinethickness":return e.repeatEndingLineThickness=i,!0;case"slurmidpointthickness":return e.slurMidpointThickness=i,!0;case"stafflinethickness":return e.staffLineThickness=i,!0;case"stemthickness":return e.stemThickness=i,!0;case"thickbarlinethickness":return e.thickBarlineThickness=i,!0;case"thinbarlinethickness":return e.thinBarlineThickness=i,!0;case"thinthickbarlineseparation":return e.thinThickBarlineSeparation=i,!0;case"tiemidpointthickness":return e.tieMidpointThickness=i,!0;case"tupletbracketthickness":return e.tupletBracketThickness=i,!0;case"stemup":return e.stemUp=new Map,q.forEach(i,(s,a)=>{const o=new dp;Uc.fromJson(o,s),e.stemUp.set(q.parseEnum(a,S),o)}),!0;case"stemdown":return e.stemDown=new Map,q.forEach(i,(s,a)=>{const o=new dp;Uc.fromJson(o,s),e.stemDown.set(q.parseEnum(a,S),o)}),!0;case"repeatoffsetx":return e.repeatOffsetX=new Map,q.forEach(i,(s,a)=>{e.repeatOffsetX.set(q.parseEnum(a,S),s)}),!0;case"standardstemlength":return e.standardStemLength=i,!0;case"stemflagoffsets":return e.stemFlagOffsets=new Map,q.forEach(i,(s,a)=>{e.stemFlagOffsets.set(q.parseEnum(a,M),s)}),!0;case"glyphtop":return e.glyphTop=new Map,q.forEach(i,(s,a)=>{e.glyphTop.set(q.parseEnum(a,S),s)}),!0;case"glyphbottom":return e.glyphBottom=new Map,q.forEach(i,(s,a)=>{e.glyphBottom.set(q.parseEnum(a,S),s)}),!0;case"glyphwidths":return e.glyphWidths=new Map,q.forEach(i,(s,a)=>{e.glyphWidths.set(q.parseEnum(a,S),s)}),!0;case"glyphheights":return e.glyphHeights=new Map,q.forEach(i,(s,a)=>{e.glyphHeights.set(q.parseEnum(a,S),s)}),!0;case"numberedbarrendererbarsize":return e.numberedBarRendererBarSize=i,!0;case"numberedbarrendererbarspacing":return e.numberedBarRendererBarSpacing=i,!0;case"numbereddashglyphpadding":return e.numberedDashGlyphPadding=i,!0;case"numbereddashglyphwidth":return e.numberedDashGlyphWidth=i,!0;case"linerangedglyphdashgap":return e.lineRangedGlyphDashGap=i,!0;case"linerangedglyphdashsize":return e.lineRangedGlyphDashSize=i,!0;case"prenoteeffectpadding":return e.preNoteEffectPadding=i,!0;case"postnoteeffectpadding":return e.postNoteEffectPadding=i,!0;case"onnoteeffectpadding":return e.onNoteEffectPadding=i,!0;case"stringnumbercirclepadding":return e.stringNumberCirclePadding=i,!0;case"rowcontainerpadding":return e.rowContainerPadding=i,!0;case"rowcontainergap":return e.rowContainerGap=i,!0;case"alternateendingspadding":return e.alternateEndingsPadding=i,!0;case"sustainpedallinepadding":return e.sustainPedalLinePadding=i,!0;case"tieheight":return e.tieHeight=i,!0;case"beattimerpadding":return e.beatTimerPadding=i,!0;case"bendnoteheadelementpadding":return e.bendNoteHeadElementPadding=i,!0;case"ghostparenthesiswidth":return e.ghostParenthesisWidth=i,!0;case"ghostparenthesispadding":return e.ghostParenthesisPadding=i,!0;case"brokenbeamwidth":return e.brokenBeamWidth=i,!0;case"tabwhammytextpadding":return e.tabWhammyTextPadding=i,!0;case"tabwhammyperhalfheight":return e.tabWhammyPerHalfHeight=i,!0;case"tabwhammydashsize":return e.tabWhammyDashSize=i,!0;case"songbookwhammydipheight":return e.songBookWhammyDipHeight=i,!0;case"deadslappedlinewidth":return e.deadSlappedLineWidth=i,!0;case"lefthandtabtiewidth":return e.leftHandTabTieWidth=i,!0;case"tabbenddashsize":return e.tabBendDashSize=i,!0;case"tabbendpervalueheight":return e.tabBendPerValueHeight=i,!0;case"tabbendlabelpadding":return e.tabBendLabelPadding=i,!0;case"simpleslidewidth":return e.simpleSlideWidth=i,!0;case"simpleslideheight":return e.simpleSlideHeight=i,!0;case"chorddiagrampaddingx":return e.chordDiagramPaddingX=i,!0;case"chorddiagrampaddingy":return e.chordDiagramPaddingY=i,!0;case"chorddiagramstringspacing":return e.chordDiagramStringSpacing=i,!0;case"chorddiagramfretspacing":return e.chordDiagramFretSpacing=i,!0;case"chorddiagramnutheight":return e.chordDiagramNutHeight=i,!0;case"chorddiagramfretheight":return e.chordDiagramFretHeight=i,!0;case"chorddiagramlinewidth":return e.chordDiagramLineWidth=i,!0;case"tripletfeelbracketpadding":return e.tripletFeelBracketPadding=i,!0;case"accidentalpadding":return e.accidentalPadding=i,!0;case"prebeatglyphspacing":return e.preBeatGlyphSpacing=i,!0;case"temponotescale":return e.tempoNoteScale=i,!0;case"tuningglyphcirclenumberscale":return e.tuningGlyphCircleNumberScale=i,!0;case"tuningglyphstringcolumnscale":return e.tuningGlyphStringColumnScale=i,!0;case"tuningglyphstringrowpadding":return e.tuningGlyphStringRowPadding=i,!0;case"directionsscale":return e.directionsScale=i,!0}return!1}}class xh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>xh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("smuflfontfamilyname",e.smuflFontFamilyName),t.set("engravingsettings",fp.toJson(e.engravingSettings)),t.set("copyrightfont",nt.toJson(e.copyrightFont)),t.set("titlefont",nt.toJson(e.titleFont)),t.set("subtitlefont",nt.toJson(e.subTitleFont)),t.set("wordsfont",nt.toJson(e.wordsFont)),t.set("effectfont",nt.toJson(e.effectFont)),t.set("timerfont",nt.toJson(e.timerFont)),t.set("directionsfont",nt.toJson(e.directionsFont)),t.set("fretboardnumberfont",nt.toJson(e.fretboardNumberFont)),t.set("numberednotationfont",nt.toJson(e.numberedNotationFont)),t.set("numberednotationgracefont",nt.toJson(e.numberedNotationGraceFont)),t.set("tablaturefont",nt.toJson(e.tablatureFont)),t.set("gracefont",nt.toJson(e.graceFont)),t.set("stafflinecolor",Tt.toJson(e.staffLineColor)),t.set("barseparatorcolor",Tt.toJson(e.barSeparatorColor)),t.set("barnumberfont",nt.toJson(e.barNumberFont)),t.set("barnumbercolor",Tt.toJson(e.barNumberColor)),t.set("fingeringfont",nt.toJson(e.fingeringFont)),t.set("inlinefingeringfont",nt.toJson(e.inlineFingeringFont)),t.set("markerfont",nt.toJson(e.markerFont)),t.set("mainglyphcolor",Tt.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",Tt.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",Tt.toJson(e.scoreInfoColor)),t}static setProperty(e,t,i){switch(t){case"smuflfontfamilyname":return e.smuflFontFamilyName=i,!0;case"copyrightfont":return e.copyrightFont=nt.fromJson(i),!0;case"titlefont":return e.titleFont=nt.fromJson(i),!0;case"subtitlefont":return e.subTitleFont=nt.fromJson(i),!0;case"wordsfont":return e.wordsFont=nt.fromJson(i),!0;case"effectfont":return e.effectFont=nt.fromJson(i),!0;case"timerfont":return e.timerFont=nt.fromJson(i),!0;case"directionsfont":return e.directionsFont=nt.fromJson(i),!0;case"fretboardnumberfont":return e.fretboardNumberFont=nt.fromJson(i),!0;case"numberednotationfont":return e.numberedNotationFont=nt.fromJson(i),!0;case"numberednotationgracefont":return e.numberedNotationGraceFont=nt.fromJson(i),!0;case"tablaturefont":return e.tablatureFont=nt.fromJson(i),!0;case"gracefont":return e.graceFont=nt.fromJson(i),!0;case"stafflinecolor":return e.staffLineColor=Tt.fromJson(i),!0;case"barseparatorcolor":return e.barSeparatorColor=Tt.fromJson(i),!0;case"barnumberfont":return e.barNumberFont=nt.fromJson(i),!0;case"barnumbercolor":return e.barNumberColor=Tt.fromJson(i),!0;case"fingeringfont":return e.fingeringFont=nt.fromJson(i),!0;case"inlinefingeringfont":return e.inlineFingeringFont=nt.fromJson(i),!0;case"markerfont":return e.markerFont=nt.fromJson(i),!0;case"mainglyphcolor":return e.mainGlyphColor=Tt.fromJson(i),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=Tt.fromJson(i),!0;case"scoreinfocolor":return e.scoreInfoColor=Tt.fromJson(i),!0}return["engravingsettings"].indexOf(t)>=0?(fp.fromJson(e.engravingSettings,i),!0):!1}}class vh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>vh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",xh.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("firststaffpaddingleft",e.firstStaffPaddingLeft),t.set("staffpaddingleft",e.staffPaddingLeft),t.set("effectbandpaddingbottom",e.effectBandPaddingBottom),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,i){switch(t){case"scale":return e.scale=i,!0;case"stretchforce":return e.stretchForce=i,!0;case"layoutmode":return e.layoutMode=q.parseEnum(i,jr),!0;case"staveprofile":return e.staveProfile=q.parseEnum(i,qr),!0;case"barsperrow":return e.barsPerRow=i,!0;case"startbar":return e.startBar=i,!0;case"barcount":return e.barCount=i,!0;case"barcountperpartial":return e.barCountPerPartial=i,!0;case"justifylastsystem":return e.justifyLastSystem=i,!0;case"padding":return e.padding=i,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=i,!0;case"systempaddingtop":return e.systemPaddingTop=i,!0;case"systempaddingbottom":return e.systemPaddingBottom=i,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=i,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=i,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=i,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=i,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=i,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=i,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=i,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=i,!0;case"firststaffpaddingleft":return e.firstStaffPaddingLeft=i,!0;case"staffpaddingleft":return e.staffPaddingLeft=i,!0;case"effectbandpaddingbottom":return e.effectBandPaddingBottom=i,!0;case"systemslayoutmode":return e.systemsLayoutMode=q.parseEnum(i,Qo),!0}if(["resources"].indexOf(t)>=0)return xh.fromJson(e.resources,i),!0;for(const s of["resources"])if(t.indexOf(s)===0&&xh.setProperty(e.resources,t.substring(s.length),i))return!0;return!1}}class Nh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Nh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const i=new Map;t.set("elements",i);for(const[s,a]of e.elements)i.set(s.toString(),a)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,i){switch(t){case"notationmode":return e.notationMode=q.parseEnum(i,Ps),!0;case"fingeringmode":return e.fingeringMode=q.parseEnum(i,$a),!0;case"elements":return e.elements=new Map,q.forEach(i,(s,a)=>{e.elements.set(q.parseEnum(a,rt),s)}),!0;case"rhythmmode":return e.rhythmMode=q.parseEnum(i,aa),!0;case"rhythmheight":return e.rhythmHeight=i,!0;case"transpositionpitches":return e.transpositionPitches=i,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=i,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=i,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=i,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=i,!0;case"slurheight":return e.slurHeight=i,!0}return!1}}class Ch{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ch.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,i){switch(t){case"encoding":return e.encoding=i,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=i,!0;case"beattextaslyrics":return e.beatTextAsLyrics=i,!0}return!1}}class Eh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Eh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,i){switch(t){case"notewidelength":return e.noteWideLength=i,!0;case"notewideamplitude":return e.noteWideAmplitude=i,!0;case"noteslightlength":return e.noteSlightLength=i,!0;case"noteslightamplitude":return e.noteSlightAmplitude=i,!0;case"beatwidelength":return e.beatWideLength=i,!0;case"beatwideamplitude":return e.beatWideAmplitude=i,!0;case"beatslightlength":return e.beatSlightLength=i,!0;case"beatslightamplitude":return e.beatSlightAmplitude=i,!0}return!1}}class Ph{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ph.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,i){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=i,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=i,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=i,!0}return!1}}class Dh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Dh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("playermode",e.playerMode),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",Eh.toJson(e.vibrato)),t.set("slide",Ph.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,i){switch(t){case"soundfont":return e.soundFont=i,!0;case"scrollelement":return e.scrollElement=i,!0;case"outputmode":return e.outputMode=q.parseEnum(i,zh),!0;case"enableplayer":return e.enablePlayer=i,!0;case"playermode":return e.playerMode=q.parseEnum(i,nn),!0;case"enablecursor":return e.enableCursor=i,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=i,!0;case"enableelementhighlighting":return e.enableElementHighlighting=i,!0;case"enableuserinteraction":return e.enableUserInteraction=i,!0;case"scrolloffsetx":return e.scrollOffsetX=i,!0;case"scrolloffsety":return e.scrollOffsetY=i,!0;case"scrollmode":return e.scrollMode=q.parseEnum(i,pr),!0;case"scrollspeed":return e.scrollSpeed=i,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=i,!0;case"songbookbendduration":return e.songBookBendDuration=i,!0;case"songbookdipduration":return e.songBookDipDuration=i,!0;case"playtripletfeel":return e.playTripletFeel=i,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=i,!0}if(["vibrato"].indexOf(t)>=0)return Eh.fromJson(e.vibrato,i),!0;for(const s of["vibrato"])if(t.indexOf(s)===0&&Eh.setProperty(e.vibrato,t.substring(s.length),i))return!0;if(["slide"].indexOf(t)>=0)return Ph.fromJson(e.slide,i),!0;for(const s of["slide"])if(t.indexOf(s)===0&&Ph.setProperty(e.slide,t.substring(s.length),i))return!0;return!1}}class Mh{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Mh.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("indent",e.indent),t.set("comments",e.comments),t}static setProperty(e,t,i){switch(t){case"indent":return e.indent=i,!0;case"comments":return e.comments=i,!0}return!1}}class Ko{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ko.setProperty(e,s.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",Th.toJson(e.core)),t.set("display",vh.toJson(e.display)),t.set("notation",Nh.toJson(e.notation)),t.set("importer",Ch.toJson(e.importer)),t.set("player",Dh.toJson(e.player)),t.set("exporter",Mh.toJson(e.exporter)),t}static setProperty(e,t,i){if(["core",""].indexOf(t)>=0)return Th.fromJson(e.core,i),!0;for(const s of["core",""])if(t.indexOf(s)===0&&Th.setProperty(e.core,t.substring(s.length),i))return!0;if(["display",""].indexOf(t)>=0)return vh.fromJson(e.display,i),!0;for(const s of["display",""])if(t.indexOf(s)===0&&vh.setProperty(e.display,t.substring(s.length),i))return!0;if(["notation"].indexOf(t)>=0)return Nh.fromJson(e.notation,i),!0;for(const s of["notation"])if(t.indexOf(s)===0&&Nh.setProperty(e.notation,t.substring(s.length),i))return!0;if(["importer"].indexOf(t)>=0)return Ch.fromJson(e.importer,i),!0;for(const s of["importer"])if(t.indexOf(s)===0&&Ch.setProperty(e.importer,t.substring(s.length),i))return!0;if(["player"].indexOf(t)>=0)return Dh.fromJson(e.player,i),!0;for(const s of["player"])if(t.indexOf(s)===0&&Dh.setProperty(e.player,t.substring(s.length),i))return!0;if(["exporter"].indexOf(t)>=0)return Mh.fromJson(e.exporter,i),!0;for(const s of["exporter"])if(t.indexOf(s)===0&&Mh.setProperty(e.exporter,t.substring(s.length),i))return!0;return!1}}class CR{indent=2;comments=!1}class Zo{core=new vv;display=new BR;notation=new ip;importer=new TR;player=new NR;exporter=new CR;setSongBookModeSettings(){this.notation.notationMode=Ps.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=$a.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(rt.ParenthesisOnTiedBends,!1),this.notation.elements.set(rt.TabNotesOnTiedBends,!1),this.notation.elements.set(rt.ZerosOnDiveWhammys,!0)}static get songBook(){const e=new Zo;return e.setSongBookModeSettings(),e}fillFromJson(e){Ko.fromJson(this,e)}handleBackwardsCompatibility(){this.player.playerMode===nn.Disabled&&this.player.enablePlayer&&(this.player.playerMode=nn.EnabledAutomatic)}}class pp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>pp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,i){switch(t){case"marker":return e.marker=i,!0;case"text":return e.text=i,!0}return!1}}class gp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>gp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("baroccurence",e.barOccurence),t.set("millisecondoffset",e.millisecondOffset),t}static setProperty(e,t,i){switch(t){case"baroccurence":return e.barOccurence=i,!0;case"millisecondoffset":return e.millisecondOffset=i,!0}return!1}}class Vo{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Vo.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),e.syncPointValue&&t.set("syncpointvalue",gp.toJson(e.syncPointValue)),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t.set("isvisible",e.isVisible),t}static setProperty(e,t,i){switch(t){case"islinear":return e.isLinear=i,!0;case"type":return e.type=q.parseEnum(i,Mt),!0;case"value":return e.value=i,!0;case"syncpointvalue":return i?(e.syncPointValue=new td,gp.fromJson(e.syncPointValue,i)):e.syncPointValue=void 0,!0;case"ratioposition":return e.ratioPosition=i,!0;case"text":return e.text=i,!0;case"isvisible":return e.isVisible=i,!0}return!1}}class mp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>mp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,i){switch(t){case"type":return e.type=q.parseEnum(i,mn),!0;case"length":return e.length=i,!0}return!1}}class yp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>yp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("isfreetime",e.isFreeTime),t.set("tripletfeel",e.tripletFeel),e.section&&t.set("section",pp.toJson(e.section)),t.set("tempoautomations",e.tempoAutomations.map(i=>Vo.toJson(i))),e.syncPoints!==void 0&&t.set("syncpoints",e.syncPoints?.map(i=>Vo.toJson(i))),e.fermata!==null){const i=new Map;t.set("fermata",i);for(const[s,a]of e.fermata)i.set(s.toString(),mp.toJson(a))}if(t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),e.directions!==null){const i=[];t.set("directions",i);for(const s of e.directions)i.push(s)}return t}static setProperty(e,t,i){switch(t){case"alternateendings":return e.alternateEndings=i,!0;case"isdoublebar":return e.isDoubleBar=i,!0;case"isrepeatstart":return e.isRepeatStart=i,!0;case"repeatcount":return e.repeatCount=i,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=i,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=i,!0;case"timesignaturecommon":return e.timeSignatureCommon=i,!0;case"isfreetime":return e.isFreeTime=i,!0;case"tripletfeel":return e.tripletFeel=q.parseEnum(i,yt),!0;case"section":return i?(e.section=new ou,pp.fromJson(e.section,i)):e.section=null,!0;case"tempoautomations":e.tempoAutomations=[];for(const s of i){const a=new jt;Vo.fromJson(a,s),e.tempoAutomations.push(a)}return!0;case"syncpoints":if(i){e.syncPoints=[];for(const s of i){const a=new jt;Vo.fromJson(a,s),e.addSyncPoint(a)}}return!0;case"fermata":return e.fermata=new Map,q.forEach(i,(s,a)=>{const o=new ru;mp.fromJson(o,s),e.addFermata(Number.parseInt(a),o)}),!0;case"start":return e.start=i,!0;case"isanacrusis":return e.isAnacrusis=i,!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0;case"directions":for(const s of i)e.addDirection(q.parseEnum(s,Te));return!0}return!1}}class su{static fromJson(e,t){t&&q.forEach(t,(i,s)=>su.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,i){switch(t){case"offset":return e.offset=i,!0;case"value":return e.value=i,!0}return!1}}class bp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>bp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;t.set("notehead",e.noteHead),t.set("noteheadcenteronstem",e.noteHeadCenterOnStem);{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"notehead":return e.noteHead=q.parseEnum(i,S),!0;case"noteheadcenteronstem":return e.noteHeadCenterOnStem=i,!0;case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,Js),Tt.fromJson(s))}),!0}return!1}}class Sp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Sp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),e.bendPoints!==null&&t.set("bendpoints",e.bendPoints?.map(i=>su.toJson(i))),t.set("fret",e.fret),t.set("string",e.string),t.set("showstringnumber",e.showStringNumber),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),t.set("ornament",e.ornament),e.style&&t.set("style",bp.toJson(e.style)),e.toJson(t),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"accentuated":return e.accentuated=q.parseEnum(i,mi),!0;case"bendtype":return e.bendType=q.parseEnum(i,Ae),!0;case"bendstyle":return e.bendStyle=q.parseEnum(i,Kt),!0;case"iscontinuedbend":return e.isContinuedBend=i,!0;case"bendpoints":if(i){e.bendPoints=[];for(const s of i){const a=new ke;su.fromJson(a,s),e.addBendPoint(a)}}return!0;case"fret":return e.fret=i,!0;case"string":return e.string=i,!0;case"showstringnumber":return e.showStringNumber=i,!0;case"octave":return e.octave=i,!0;case"tone":return e.tone=i,!0;case"percussionarticulation":return e.percussionArticulation=i,!0;case"isvisible":return e.isVisible=i,!0;case"islefthandtapped":return e.isLeftHandTapped=i,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=i,!0;case"isslurdestination":return e.isSlurDestination=i,!0;case"harmonictype":return e.harmonicType=q.parseEnum(i,Re),!0;case"harmonicvalue":return e.harmonicValue=i,!0;case"isghost":return e.isGhost=i,!0;case"isletring":return e.isLetRing=i,!0;case"ispalmmute":return e.isPalmMute=i,!0;case"isdead":return e.isDead=i,!0;case"isstaccato":return e.isStaccato=i,!0;case"slideintype":return e.slideInType=q.parseEnum(i,Ji),!0;case"slideouttype":return e.slideOutType=q.parseEnum(i,$e),!0;case"vibrato":return e.vibrato=q.parseEnum(i,ct),!0;case"istiedestination":return e.isTieDestination=i,!0;case"lefthandfinger":return e.leftHandFinger=q.parseEnum(i,Fe),!0;case"righthandfinger":return e.rightHandFinger=q.parseEnum(i,Fe),!0;case"trillvalue":return e.trillValue=i,!0;case"trillspeed":return e.trillSpeed=q.parseEnum(i,M),!0;case"durationpercent":return e.durationPercent=i,!0;case"accidentalmode":return e.accidentalMode=q.parseEnum(i,Ue),!0;case"dynamics":return e.dynamics=q.parseEnum(i,Oe),!0;case"ornament":return e.ornament=q.parseEnum(i,fi),!0;case"style":return i?(e.style=new Bb,bp.fromJson(e.style,i)):e.style=void 0,!0}return e.setProperty(t,i)}}class _p{static fromJson(e,t){t&&q.forEach(t,(i,s)=>_p.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,ti),Tt.fromJson(s))}),!0}return!1}}class kp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>kp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(i=>Sp.toJson(i))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(i=>Vo.toJson(i))),t.set("dots",e.dots),t.set("fade",e.fade),t.set("lyrics",e.lyrics),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("slashed",e.slashed),t.set("deadslapped",e.deadSlapped),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),e.whammyBarPoints!==null&&t.set("whammybarpoints",e.whammyBarPoints?.map(i=>su.toJson(i))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("overridedisplayduration",e.overrideDisplayDuration),t.set("golpe",e.golpe),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t.set("wahpedal",e.wahPedal),t.set("barrefret",e.barreFret),t.set("barreshape",e.barreShape),t.set("rasgueado",e.rasgueado),t.set("showtimer",e.showTimer),t.set("timer",e.timer),e.style&&t.set("style",_p.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"notes":e.notes=[];for(const s of i){const a=new es;Sp.fromJson(a,s),e.addNote(a)}return!0;case"isempty":return e.isEmpty=i,!0;case"whammystyle":return e.whammyStyle=q.parseEnum(i,Kt),!0;case"ottava":return e.ottava=q.parseEnum(i,Ye),!0;case"islegatoorigin":return e.isLegatoOrigin=i,!0;case"duration":return e.duration=q.parseEnum(i,M),!0;case"automations":e.automations=[];for(const s of i){const a=new jt;Vo.fromJson(a,s),e.automations.push(a)}return!0;case"dots":return e.dots=i,!0;case"fade":return e.fade=q.parseEnum(i,Xi),!0;case"lyrics":return e.lyrics=i,!0;case"pop":return e.pop=i,!0;case"slap":return e.slap=i,!0;case"tap":return e.tap=i,!0;case"text":return e.text=i,!0;case"slashed":return e.slashed=i,!0;case"deadslapped":return e.deadSlapped=i,!0;case"brushtype":return e.brushType=q.parseEnum(i,Ne),!0;case"brushduration":return e.brushDuration=i,!0;case"tupletdenominator":return e.tupletDenominator=i,!0;case"tupletnumerator":return e.tupletNumerator=i,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=i,!0;case"whammybartype":return e.whammyBarType=q.parseEnum(i,Dt),!0;case"whammybarpoints":if(i){e.whammyBarPoints=[];for(const s of i){const a=new ke;su.fromJson(a,s),e.addWhammyBarPoint(a)}}return!0;case"vibrato":return e.vibrato=q.parseEnum(i,ct),!0;case"chordid":return e.chordId=i,!0;case"gracetype":return e.graceType=q.parseEnum(i,De),!0;case"pickstroke":return e.pickStroke=q.parseEnum(i,ds),!0;case"tremolospeed":return e.tremoloSpeed=q.parseEnum(i,M)??null,!0;case"crescendo":return e.crescendo=q.parseEnum(i,Ds),!0;case"displaystart":return e.displayStart=i,!0;case"playbackstart":return e.playbackStart=i,!0;case"displayduration":return e.displayDuration=i,!0;case"playbackduration":return e.playbackDuration=i,!0;case"overridedisplayduration":return e.overrideDisplayDuration=i,!0;case"golpe":return e.golpe=q.parseEnum(i,qs),!0;case"dynamics":return e.dynamics=q.parseEnum(i,Oe),!0;case"invertbeamdirection":return e.invertBeamDirection=i,!0;case"preferredbeamdirection":return e.preferredBeamDirection=q.parseEnum(i,j)??null,!0;case"beamingmode":return e.beamingMode=q.parseEnum(i,ei),!0;case"wahpedal":return e.wahPedal=q.parseEnum(i,an),!0;case"barrefret":return e.barreFret=i,!0;case"barreshape":return e.barreShape=q.parseEnum(i,Yn),!0;case"rasgueado":return e.rasgueado=q.parseEnum(i,We),!0;case"showtimer":return e.showTimer=i,!0;case"timer":return e.timer=i,!0;case"style":return i?(e.style=new Fx,_p.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class wp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>wp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,jc),Tt.fromJson(s))}),!0}return!1}}class Bp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Bp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(i=>kp.toJson(i))),e.style&&t.set("style",wp.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"beats":e.beats=[];for(const s of i){const a=new fs;kp.fromJson(a,s),e.addBeat(a)}return!0;case"style":return i?(e.style=new Rx,wp.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class Tp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Tp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("ratioposition",e.ratioPosition),t.set("pedaltype",e.pedalType),t}static setProperty(e,t,i){switch(t){case"ratioposition":return e.ratioPosition=i,!0;case"pedaltype":return e.pedalType=q.parseEnum(i,ai),!0}return!1}}class xp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>xp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,Bt),Tt.fromJson(s))}),!0}return!1}}class vp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>vp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(i=>Bp.toJson(i))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t.set("sustainpedals",e.sustainPedals.map(i=>Tp.toJson(i))),t.set("barlineleft",e.barLineLeft),t.set("barlineright",e.barLineRight),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),e.style&&t.set("style",xp.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"clef":return e.clef=q.parseEnum(i,_t),!0;case"clefottava":return e.clefOttava=q.parseEnum(i,Ye),!0;case"voices":e.voices=[];for(const s of i){const a=new An;Bp.fromJson(a,s),e.addVoice(a)}return!0;case"similemark":return e.simileMark=q.parseEnum(i,rs),!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0;case"sustainpedals":e.sustainPedals=[];for(const s of i){const a=new Qr;Tp.fromJson(a,s),e.sustainPedals.push(a)}return!0;case"barlineleft":return e.barLineLeft=q.parseEnum(i,et),!0;case"barlineright":return e.barLineRight=q.parseEnum(i,et),!0;case"keysignature":return e.keySignature=q.parseEnum(i,Xt),!0;case"keysignaturetype":return e.keySignatureType=q.parseEnum(i,pn),!0;case"style":return i?(e.style=new Ax,xp.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class Np{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Np.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,i){switch(t){case"name":return e.name=i,!0;case"firstfret":return e.firstFret=i,!0;case"strings":return e.strings=i,!0;case"barrefrets":return e.barreFrets=i,!0;case"showname":return e.showName=i,!0;case"showdiagram":return e.showDiagram=i,!0;case"showfingering":return e.showFingering=i,!0}return!1}}class Cp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Cp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,i){switch(t){case"isstandard":return e.isStandard=i,!0;case"name":return e.name=i,!0;case"tunings":return e.tunings=i,!0}return!1}}class Ep{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ep.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(i=>vp.toJson(i))),e.chords!==null){const i=new Map;t.set("chords",i);for(const[s,a]of e.chords)i.set(s.toString(),Np.toJson(a))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",Cp.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("shownumbered",e.showNumbered),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,i){switch(t){case"bars":e.bars=[];for(const s of i){const a=new gn;vp.fromJson(a,s),e.addBar(a)}return!0;case"chords":return e.chords=new Map,q.forEach(i,(s,a)=>{const o=new so;Np.fromJson(o,s),e.addChord(a,o)}),!0;case"capo":return e.capo=i,!0;case"transpositionpitch":return e.transpositionPitch=i,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=i,!0;case"stringtuning":return Cp.fromJson(e.stringTuning,i),!0;case"showslash":return e.showSlash=i,!0;case"shownumbered":return e.showNumbered=i,!0;case"showtablature":return e.showTablature=i,!0;case"showstandardnotation":return e.showStandardNotation=i,!0;case"ispercussion":return e.isPercussion=i,!0;case"standardnotationlinecount":return e.standardNotationLineCount=i,!0}return!1}}class Pp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Pp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("bank",e.bank),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,i){switch(t){case"volume":return e.volume=i,!0;case"balance":return e.balance=i,!0;case"port":return e.port=i,!0;case"program":return e.program=i,!0;case"bank":return e.bank=i,!0;case"primarychannel":return e.primaryChannel=i,!0;case"secondarychannel":return e.secondaryChannel=i,!0;case"ismute":return e.isMute=i,!0;case"issolo":return e.isSolo=i,!0}return!1}}class Dp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Dp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,i){switch(t){case"elementtype":return e.elementType=i,!0;case"staffline":return e.staffLine=i,!0;case"noteheaddefault":return e.noteHeadDefault=q.parseEnum(i,S),!0;case"noteheadhalf":return e.noteHeadHalf=q.parseEnum(i,S),!0;case"noteheadwhole":return e.noteHeadWhole=q.parseEnum(i,S),!0;case"techniquesymbol":return e.techniqueSymbol=q.parseEnum(i,S),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=q.parseEnum(i,Jt),!0;case"outputmidinumber":return e.outputMidiNumber=i,!0}return!1}}class Mp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Mp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,Xa),Tt.fromJson(s))}),!0}return!1}}class Lp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Lp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("staves",e.staves.map(i=>Ep.toJson(i))),t.set("playbackinfo",Pp.toJson(e.playbackInfo)),t.set("color",Tt.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),e.lineBreaks!==void 0){const i=[];t.set("linebreaks",i);for(const s of e.lineBreaks)i.push(s)}return t.set("percussionarticulations",e.percussionArticulations.map(i=>Dp.toJson(i))),e.style&&t.set("style",Mp.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"staves":e.staves=[];for(const s of i){const a=new el;Ep.fromJson(a,s),e.addStaff(a)}return!0;case"playbackinfo":return Pp.fromJson(e.playbackInfo,i),!0;case"color":return e.color=Tt.fromJson(i),!0;case"name":return e.name=i,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=i,!0;case"shortname":return e.shortName=i,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0;case"linebreaks":for(const s of i)e.addLineBreaks(s);return!0;case"percussionarticulations":e.percussionArticulations=[];for(const s of i){const a=new Pe;Dp.fromJson(a,s),e.percussionArticulations.push(a)}return!0;case"style":return i?(e.style=new Vx,Mp.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class Ap{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ap.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("hidedynamics",e.hideDynamics),t.set("bracketextendmode",e.bracketExtendMode),t.set("usesystemsignseparator",e.useSystemSignSeparator),t.set("globaldisplaytuning",e.globalDisplayTuning),e.perTrackDisplayTuning!==null){const i=new Map;t.set("pertrackdisplaytuning",i);for(const[s,a]of e.perTrackDisplayTuning)i.set(s.toString(),a)}if(t.set("globaldisplaychorddiagramsontop",e.globalDisplayChordDiagramsOnTop),e.perTrackChordDiagramsOnTop!==null){const i=new Map;t.set("pertrackchorddiagramsontop",i);for(const[s,a]of e.perTrackChordDiagramsOnTop)i.set(s.toString(),a)}if(t.set("singletracktracknamepolicy",e.singleTrackTrackNamePolicy),t.set("multitracktracknamepolicy",e.multiTrackTrackNamePolicy),t.set("firstsystemtracknamemode",e.firstSystemTrackNameMode),t.set("othersystemstracknamemode",e.otherSystemsTrackNameMode),t.set("firstsystemtracknameorientation",e.firstSystemTrackNameOrientation),t.set("othersystemstracknameorientation",e.otherSystemsTrackNameOrientation),t.set("multitrackmultibarrest",e.multiTrackMultiBarRest),e.perTrackMultiBarRest!==null){const i=[];t.set("pertrackmultibarrest",i);for(const s of e.perTrackMultiBarRest)i.push(s)}return t}static setProperty(e,t,i){switch(t){case"hidedynamics":return e.hideDynamics=i,!0;case"bracketextendmode":return e.bracketExtendMode=q.parseEnum(i,Yo),!0;case"usesystemsignseparator":return e.useSystemSignSeparator=i,!0;case"globaldisplaytuning":return e.globalDisplayTuning=i,!0;case"pertrackdisplaytuning":return e.perTrackDisplayTuning=new Map,q.forEach(i,(s,a)=>{e.perTrackDisplayTuning.set(Number.parseInt(a),s)}),!0;case"globaldisplaychorddiagramsontop":return e.globalDisplayChordDiagramsOnTop=i,!0;case"pertrackchorddiagramsontop":return e.perTrackChordDiagramsOnTop=new Map,q.forEach(i,(s,a)=>{e.perTrackChordDiagramsOnTop.set(Number.parseInt(a),s)}),!0;case"singletracktracknamepolicy":return e.singleTrackTrackNamePolicy=q.parseEnum(i,Ii),!0;case"multitracktracknamepolicy":return e.multiTrackTrackNamePolicy=q.parseEnum(i,Ii),!0;case"firstsystemtracknamemode":return e.firstSystemTrackNameMode=q.parseEnum(i,$s),!0;case"othersystemstracknamemode":return e.otherSystemsTrackNameMode=q.parseEnum(i,$s),!0;case"firstsystemtracknameorientation":return e.firstSystemTrackNameOrientation=q.parseEnum(i,Xs),!0;case"othersystemstracknameorientation":return e.otherSystemsTrackNameOrientation=q.parseEnum(i,Xs),!0;case"multitrackmultibarrest":return e.multiTrackMultiBarRest=i,!0;case"pertrackmultibarrest":return e.perTrackMultiBarRest=new Set(i),!0}return!1}}class Rp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Rp.setProperty(e,s,i))}static toJson(e){return e?new Map:null}static setProperty(e,t,i){return!1}}class Op{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Op.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("template",e.template),t.set("isvisible",e.isVisible),t.set("textalign",e.textAlign),t}static setProperty(e,t,i){switch(t){case"template":return e.template=i,!0;case"isvisible":return e.isVisible=i,!0;case"textalign":return e.textAlign=q.parseEnum(i,Ce),!0}return!1}}class Fp{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Fp.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("headerandfooter",i);for(const[s,a]of e.headerAndFooter)i.set(s.toString(),Op.toJson(a))}{const i=new Map;t.set("colors",i);for(const[s,a]of e.colors)i.set(s.toString(),Tt.toJson(a))}return t}static setProperty(e,t,i){switch(t){case"headerandfooter":return e.headerAndFooter=new Map,q.forEach(i,(s,a)=>{const o=new wn;Op.fromJson(o,s),e.headerAndFooter.set(q.parseEnum(a,ye),o)}),!0;case"colors":return e.colors=new Map,q.forEach(i,(s,a)=>{e.colors.set(q.parseEnum(a,ye),Tt.fromJson(s))}),!0}return!1}}class Ip{static fromJson(e,t){t&&q.forEach(t,(i,s)=>Ip.setProperty(e,s,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("masterbars",e.masterBars.map(i=>yp.toJson(i))),t.set("tracks",e.tracks.map(i=>Lp.toJson(i))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",Ap.toJson(e.stylesheet)),e.backingTrack&&t.set("backingtrack",Rp.toJson(e.backingTrack)),e.style&&t.set("style",Fp.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"album":return e.album=i,!0;case"artist":return e.artist=i,!0;case"copyright":return e.copyright=i,!0;case"instructions":return e.instructions=i,!0;case"music":return e.music=i,!0;case"notices":return e.notices=i,!0;case"subtitle":return e.subTitle=i,!0;case"title":return e.title=i,!0;case"words":return e.words=i,!0;case"tab":return e.tab=i,!0;case"masterbars":e.masterBars=[];for(const s of i){const a=new Ka;yp.fromJson(a,s),e.addMasterBar(a)}return!0;case"tracks":e.tracks=[];for(const s of i){const a=new Za;Lp.fromJson(a,s),e.addTrack(a)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0;case"stylesheet":return Ap.fromJson(e.stylesheet,i),!0;case"backingtrack":return i?(e.backingTrack=new Db,Rp.fromJson(e.backingTrack,i)):e.backingTrack=void 0,!0;case"style":return i?(e.style=new $o,Fp.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class ts{static _jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);const i={};for(const[s,a]of t)i[s]=a;return i}return ArrayBuffer.isView(t)?Array.apply([],[t]):t}static scoreToJson(e){const t=ts.scoreToJsObject(e);return JSON.stringify(t,ts._jsonReplacer)}static jsonToScore(e,t){return ts.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return Ip.toJson(e)}static jsObjectToScore(e,t){const i=new Qa;return Ip.fromJson(i,e),i.finish(t??new Zo),i}static settingsToJson(e){const t=ts.settingsToJsObject(e);return JSON.stringify(t,ts._jsonReplacer)}static jsonToSettings(e){return ts.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return Ko.toJson(e)}static jsObjectToSettings(e){const t=new Zo;return Ko.fromJson(t,e),t}static jsObjectToMidiFile(e){const t=new Kr;return q.forEach(e,(i,s)=>{switch(s){case"division":t.division=i;break;case"tracks":for(const a of i){const o=ts._jsObjectToMidiTrack(a);t.tracks.push(o)}break}}),t}static _jsObjectToMidiTrack(e){const t=new qx;return q.forEach(e,(i,s)=>{switch(s){case"events":for(const a of i){const o=ts.jsObjectToMidiEvent(a);t.events.push(o)}break}}),t}static jsObjectToMidiEvent(e){const t=q.getValue(e,"track"),i=q.getValue(e,"tick"),s=q.getValue(e,"type");switch(s){case Rt.TimeSignature:return new Jx(t,i,q.getValue(e,"numerator"),q.getValue(e,"denominatorIndex"),q.getValue(e,"midiClocksPerMetronomeClick"),q.getValue(e,"thirdySecondNodesInQuarter"));case Rt.AlphaTabRest:return new Kx(t,i,q.getValue(e,"channel"));case Rt.AlphaTabMetronome:return new Qx(t,i,q.getValue(e,"metronomeNumerator"),q.getValue(e,"metronomeDurationInTicks"),q.getValue(e,"metronomeDurationInMilliseconds"));case Rt.NoteOn:return new jx(t,i,q.getValue(e,"channel"),q.getValue(e,"noteKey"),q.getValue(e,"noteVelocity"));case Rt.NoteOff:return new ev(t,i,q.getValue(e,"channel"),q.getValue(e,"noteKey"),q.getValue(e,"noteVelocity"));case Rt.ControlChange:return new tv(t,i,q.getValue(e,"channel"),q.getValue(e,"controller"),q.getValue(e,"value"));case Rt.ProgramChange:return new iv(t,i,q.getValue(e,"channel"),q.getValue(e,"program"));case Rt.TempoChange:const a=new sv(i,0);return a.beatsPerMinute=q.getValue(e,"beatsPerMinute"),a;case Rt.PitchBend:return new nv(t,i,q.getValue(e,"channel"),q.getValue(e,"value"));case Rt.PerNotePitchBend:return new av(t,i,q.getValue(e,"channel"),q.getValue(e,"noteKey"),q.getValue(e,"value"));case Rt.EndOfTrack:return new rv(t,i)}throw new Ht(It.Format,`Unknown Midi Event type: ${s}`)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const i=[];for(const s of e.tracks)i.push(ts._midiTrackToJsObject(s));return t.set("tracks",i),t}static _midiTrackToJsObject(e){const t=new Map,i=[];for(const s of e.events)i.push(ts.midiEventToJsObject(s));return t.set("events",i),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case Rt.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case Rt.AlphaTabRest:t.set("channel",e.channel);break;case Rt.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case Rt.NoteOn:case Rt.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case Rt.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case Rt.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case Rt.TempoChange:t.set("beatsPerMinute",e.beatsPerMinute);break;case Rt.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case Rt.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value);break;case Rt.EndOfTrack:break}return t}}class Wb{_player;_main;_exporter=new Map;constructor(e,t){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new fv(new Bs,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){const e=ne.globalThis;e.addEventListener("message",t=>{const i=t.data;switch(i.cmd){case"alphaSynth.initialize":Bs.preferredSampleRate=i.sampleRate,ee.logLevel=i.logLevel,ne.globalThis.alphaSynthWebWorker=new Wb(e,i.bufferTimeInMilliseconds);break}})}handleMessage(e){const t=e.data,i=t.cmd;switch(i){case"alphaSynth.setLogLevel":ee.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(ts.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(ts.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(t.channel,t.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)));break}i.startsWith("alphaSynth.exporter")&&this._handleExporterMessage(e)}_handleExporterMessage(e){const t=e.data,i=t.cmd;try{switch(i){case"alphaSynth.exporter.initialize":const s=this._player.exportAudio(t.options,ts.jsObjectToMidiFile(t.midi),t.syncPoints,t.transpositionPitches);this._exporter.set(t.exporterId,s),this._main.postMessage({cmd:"alphaSynth.exporter.initialized",exporterId:t.exporterId});break;case"alphaSynth.exporter.render":if(this._exporter.has(t.exporterId)){const o=this._exporter.get(t.exporterId).render(t.milliseconds);this._main.postMessage({cmd:"alphaSynth.exporter.rendered",exporterId:t.exporterId,chunk:o})}else this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:new Error("Unknown exporter ID")});break;case"alphaSynth.exporter.destroy":this._exporter.delete(t.exporterId);break}}catch(s){this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:s})}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this._serializeException(ne.prepareForPostMessage(e))})}_serializeException(e){const t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this._serializeException(ne.prepareForPostMessage(e))})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(ts.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var Tn;(function(n){n[n.Browser=0]="Browser",n[n.NodeJs=1]="NodeJs",n[n.BrowserModule=2]="BrowserModule"})(Tn||(Tn={}));class FB{characterWidths;characterHeights;constructor(e,t){this.characterWidths=e,this.characterHeights=t}}class Gn{static fontSizeLookupTables=new Map;static ControlChars=32;static generateFontLookup(e){if(!Gn.fontSizeLookupTables.has(e))if(!ne.isRunningInWorker&&ne.webPlatform!==Tn.NodeJs){const i=document.createElement("canvas").getContext("2d"),s=11;i.font=`${s}px ${e}`;const a=[],o=[];for(let h=Gn.ControlChars;h<255;h++){const d=String.fromCharCode(h),p=i.measureText(d);a.push(p.width);const g=p.actualBoundingBoxDescent+p.actualBoundingBoxAscent;o.push(g)}const c=new FB(new Uint8Array(a),new Uint8Array(o));Gn.fontSizeLookupTables.set(e,c)}else{const t=new FB(new Uint8Array([8]),new Uint8Array([10]));Gn.fontSizeLookupTables.set(e,t)}}static measureString(e,t,i,s,a){let o,h=t[0];for(let y=0;y<t.length;y++)if(Gn.fontSizeLookupTables.has(t[y])){h=t[y];break}Gn.fontSizeLookupTables.has(h)||Gn.generateFontLookup(h),o=Gn.fontSizeLookupTables.get(h);let d=1;s===pi.Italic&&(d*=1.1),a===fn.Bold&&(d*=1.1);let p=0,g=0;for(let y=0;y<e.length;y++){const k=Math.min(o.characterWidths.length-1,e.charCodeAt(y)-Gn.ControlChars);k>=0&&(p+=o.characterWidths[k]*i/11,g=Math.max(g,o.characterHeights[k]*i/11))}return d*=1.07,new gg(p*d,g)}}class Vb{_renderer;_main;constructor(e){this._main=e,this._main.addEventListener("message",this._handleMessage.bind(this),!1)}static init(){ne.globalThis.alphaTabWebWorker=new Vb(ne.globalThis)}_handleMessage(e){const t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":const s=ts.jsObjectToSettings(t.settings);ee.logLevel=s.core.logLevel,this._renderer=new ph(s),this._renderer.partialRenderFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:o})}),this._renderer.partialLayoutFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:o})}),this._renderer.renderFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:o})}),this._renderer.postRenderFinished.on(()=>{this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:this._renderer.boundsLookup?.toJson()??null})}),this._renderer.preRender.on(o=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:o})}),this._renderer.error.on(this._error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this._updateFontSizes(t.fontSizes);const a=t.score==null?null:ts.jsObjectToScore(t.score,this._renderer.settings);this._renderMultiple(a,t.trackIndexes);break;case"alphaTab.updateSettings":this._updateSettings(t.settings);break}}_updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const i in t)e.set(i,t[i])}if(e)for(const[t,i]of e)Gn.fontSizeLookupTables.set(t,i)}_updateSettings(e){Ko.fromJson(this._renderer.settings,e)}_renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(i){this._error(i)}}_error(e){ee.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class ER{_measureCanvas;_measureContext;_canvas=null;_context;_color=new Tt(0,0,0,255);_font=new nt("Arial",10,pi.Plain);_musicFont;_lineWidth=0;settings;constructor(){this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._musicFont=new nt(this.settings.display.resources.smuflFontFamilyName,this.settings.display.resources.engravingSettings.musicFontSize,pi.Plain,fn.Regular);const i=this.settings.display.scale;this._canvas=document.createElement("canvas"),this._canvas.width=e*ne.highDpiFactor|0,this._canvas.height=t*ne.highDpiFactor|0,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`,this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(ne.highDpiFactor*i,ne.highDpiFactor*i),this._context.lineWidth=this._lineWidth}endRender(){const e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,i,s){i>0&&this._context.fillRect(e,t,i,s)}strokeRect(e,t,i,s){const a=this.lineWidth%2===0?0:.5;this._context.strokeRect(e+a,t+a,i,s)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,i,s){this._context.quadraticCurveTo(e,t,i,s)}bezierCurveTo(e,t,i,s,a,o){this._context.bezierCurveTo(e,t,i,s,a,o)}fillCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.fill()}strokeCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(1)),this._measureContext.font=e.toCssString(1)}get textAlign(){switch(this._context.textAlign){case"left":return Ce.Left;case"center":return Ce.Center;case"right":return Ce.Right;default:return Ce.Left}}set textAlign(e){switch(e){case Ce.Left:this._context.textAlign="left";break;case Ce.Center:this._context.textAlign="center";break;case Ce.Right:this._context.textAlign="right";break}}get textBaseline(){switch(this._context.textBaseline){case"hanging":return Wt.Top;case"middle":return Wt.Middle;case"bottom":return Wt.Bottom;case"alphabetic":return Wt.Alphabetic;default:return Wt.Top}}set textBaseline(e){switch(e){case Wt.Top:this._context.textBaseline="hanging";break;case Wt.Middle:this._context.textBaseline="middle";break;case Wt.Bottom:this._context.textBaseline="bottom";break;case Wt.Alphabetic:this._context.textBaseline="alphabetic";break}}beginGroup(e){}endGroup(){}fillText(e,t,i){this._context.fillText(e,t,i)}measureText(e){const t=this._measureContext.measureText(e);return new gg(t.width,t.actualBoundingBoxDescent+t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,i,s,a=!1){s!==S.None&&this._fillMusicFontSymbolText(e,t,i,String.fromCharCode(s),a)}fillMusicFontSymbols(e,t,i,s,a=!1){let o="";for(const c of s)c!==S.None&&(o+=String.fromCharCode(c));this._fillMusicFontSymbolText(e,t,i,o,a)}_fillMusicFontSymbolText(e,t,i,s,a){const o=this._context.textAlign,c=this._context.textBaseline,h=this._context.font;this._context.font=this._musicFont.toCssString(i),this._context.textBaseline="alphabetic",a?this._context.textAlign="center":this._context.textAlign="left",this._context.fillText(s,e,t),this._context.textBaseline=c,this._context.font=h,this._context.textAlign=o}beginRotate(e,t,i){this._context.save(),this._context.translate(e,t),this._context.rotate(i*Math.PI/180)}endRotate(){this._context.restore()}}class Ua{_midiFile;_smf1Mode;constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,i){let s=0,a=i;for(;a=a>>1,a>0;)s++;this._midiFile.addEvent(new Jx(0,e,t,s,48,8))}addRest(e,t,i){this._smf1Mode||this._midiFile.addEvent(new Kx(e,t,i))}addNote(e,t,i,s,a,o){this._midiFile.addEvent(new jx(e,t,o,Ua._fixValue(s),Ua._fixValue(a))),this._midiFile.addEvent(new ev(e,t+i,o,Ua._fixValue(s),Ua._fixValue(a)))}static _fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,i,s,a){this._midiFile.addEvent(new tv(e,t,i,s,Ua._fixValue(a)))}addProgramChange(e,t,i,s){this._midiFile.addEvent(new iv(e,t,i,s))}addTempo(e,t){const i=new sv(e,0);i.beatsPerMinute=t,this._midiFile.addEvent(i)}addBend(e,t,i,s){s>=Xe.MaxPitchWheel?s=Xe.MaxPitchWheel:s=Math.floor(s),this._midiFile.addEvent(new nv(e,t,i,s))}addNoteBend(e,t,i,s,a){this._smf1Mode?this.addBend(e,t,i,a):(a=a*Xe.MaxPitchWheel20/Xe.MaxPitchWheel,this._midiFile.addEvent(new av(e,t,i,s,a)))}finishTrack(e,t){(this._midiFile.format===tu.MultiTrack||e===0)&&this._midiFile.addEvent(new rv(e,t))}}class PR{group;opening;iterations;closingIndex=0;constructor(e,t){this.group=e,this.opening=t,e.closings=e.closings.sort((i,s)=>i.index-s.index),this.iterations=e.closings.map(i=>0)}}var ks;(function(n){n[n.PlayingNormally=0]="PlayingNormally",n[n.DirectionJumped=1]="DirectionJumped",n[n.DirectionJumpedAlCoda=2]="DirectionJumpedAlCoda",n[n.DirectionJumpedAlDoubleCoda=3]="DirectionJumpedAlDoubleCoda",n[n.DirectionJumpedAlFine=4]="DirectionJumpedAlFine"})(ks||(ks={}));class DR{_score;_repeatStack=[];_groupsOnStack=new Set;_previousAlternateEndings=0;_state=ks.PlayingNormally;shouldPlay=!0;index=0;currentTick=0;get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._score=e}processCurrent(){const e=this._score.masterBars[this.index];if(this._state===ks.PlayingNormally){let t=e.alternateEndings;if(t===0&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const i=new PR(e.repeatGroup,e);this._repeatStack.push(i),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(this._repeatStack.length===0||t===0)this.shouldPlay=!0;else{const i=this._repeatStack[this._repeatStack.length-1],s=i.iterations[i.closingIndex];this._previousAlternateEndings=t,(t&1<<s)===0?this.shouldPlay=!1:this.shouldPlay=!0}}else this.shouldPlay=!0;this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){this._moveNextWithDirections()||this._moveNextWithNormalRepeats()}_resetRepeats(){this._groupsOnStack.clear(),this._previousAlternateEndings=0,this._repeatStack=[]}_handleDaCapo(e,t,i){return e.has(t)?(this.index=0,this._state=i,this._resetRepeats(),!0):!1}_handleDalSegno(e,t,i,s){if(e.has(t)){const a=this._findJumpTarget(s,this.index,!0);return a===-1?!1:(this.index=a,this._state=i,this._resetRepeats(),!0)}return!1}_handleDaCoda(e,t,i){if(e.has(t)){const s=this._findJumpTarget(i,this.index,!1);return s===-1?(this.index++,!0):(this.index=s,this._state=ks.PlayingNormally,!0)}return!1}_moveNextWithDirections(){const e=this._score.masterBars[this.index],t=e.directions!==null&&e.directions.size>0;if(this._state===ks.PlayingNormally&&!t)return!1;if(!t)return this.index++,!0;switch(this._state){case ks.PlayingNormally:return!!(this._handleDaCapo(e.directions,Te.JumpDaCapo,ks.DirectionJumped)||this._handleDaCapo(e.directions,Te.JumpDaCapoAlCoda,ks.DirectionJumpedAlCoda)||this._handleDaCapo(e.directions,Te.JumpDaCapoAlDoubleCoda,ks.DirectionJumpedAlDoubleCoda)||this._handleDaCapo(e.directions,Te.JumpDaCapoAlFine,ks.DirectionJumpedAlFine)||this._handleDalSegno(e.directions,Te.JumpDalSegno,ks.DirectionJumped,Te.TargetSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoAlCoda,ks.DirectionJumpedAlCoda,Te.TargetSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoAlDoubleCoda,ks.DirectionJumpedAlDoubleCoda,Te.TargetSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoAlFine,ks.DirectionJumpedAlFine,Te.TargetSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoSegno,ks.DirectionJumped,Te.TargetSegnoSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoSegnoAlCoda,ks.DirectionJumpedAlCoda,Te.TargetSegnoSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoSegnoAlDoubleCoda,ks.DirectionJumpedAlDoubleCoda,Te.TargetSegnoSegno)||this._handleDalSegno(e.directions,Te.JumpDalSegnoSegnoAlFine,ks.DirectionJumpedAlFine,Te.TargetSegnoSegno));case ks.DirectionJumped:return this.index++,!0;case ks.DirectionJumpedAlCoda:return this._handleDaCoda(e.directions,Te.JumpDaCoda,Te.TargetCoda)||this.index++,!0;case ks.DirectionJumpedAlDoubleCoda:return this._handleDaCoda(e.directions,Te.JumpDaDoubleCoda,Te.TargetDoubleCoda)||this.index++,!0;case ks.DirectionJumpedAlFine:return e.directions.has(Te.TargetFine)?(this.index=this._score.masterBars.length,!0):(this.index++,!0)}return!0}_findJumpTarget(e,t,i){let s;return i?(s=this._findJumpTargetBackwards(e,t),s===-1&&(s=this._findJumpTargetForwards(e,t)),s):(s=this._findJumpTargetForwards(e,t),s===-1&&(s=this._findJumpTargetBackwards(e,t)),s)}_findJumpTargetForwards(e,t){let i=t;for(;i<this._score.masterBars.length;){const s=this._score.masterBars[i].directions;if(s&&s.has(e))return i;i++}return-1}_findJumpTargetBackwards(e,t){let i=t;for(;i>=0;){const s=this._score.masterBars[i].directions;if(s&&s.has(e))return i;i--}return-1}_moveNextWithNormalRepeats(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const i=this._repeatStack[this._repeatStack.length-1];if(i.iterations[i.closingIndex]<t){this.index=i.opening.index,i.iterations[i.closingIndex]++;for(let a=0;a<i.closingIndex;a++)i.iterations[a]=0;i.closingIndex=0,this._previousAlternateEndings=0}else i.closingIndex<i.group.closings.length-1?(i.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(i.group),this.index++)}else this.index++}}class MR{beat;playbackStart;constructor(e,t){this.beat=e,this.playbackStart=t}}class Ta{_highlightedBeats=new Map;start;end;highlightedBeats=[];nextBeat=null;previousBeat=null;get duration(){return this.end-this.start}constructor(e,t){this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new MR(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart===this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class Mf{tick;tempo;constructor(e,t){this.tick=e,this.tempo=t}}class pv{start=0;end=0;get tempo(){return this.tempoChanges[0].tempo}tempoChanges=[];masterBar;firstBeat=null;lastBeat=null;_insertAfter(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e===this.lastBeat&&(this.lastBeat=t))}_insertBefore(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e===this.firstBeat&&(this.firstBeat=t))}nextMasterBar=null;previousMasterBar=null;addBeat(e,t,i,s){const a=i+s;if(this.firstBeat==null){const o=new Ta(i,a);o.highlightBeat(e,t),this._insertAfter(this.firstBeat,o)}else if(i>=this.lastBeat.end){const o=new Ta(this.lastBeat.end,a);o.highlightBeat(e,t),this._insertAfter(this.lastBeat,o)}else{let o=null;if(i<this.firstBeat.start)o=this.firstBeat;else{let c=this.firstBeat;for(;c!=null;){if(i>=c.start&&i<c.end){o=c;break}c=c.nextBeat}if(o===null)throw new Ht(It.General,"Error on building lookup, unknown variant")}if(i<o.start)if(a===o.start){const c=new Ta(i,o.start);c.highlightBeat(e,t),this._insertBefore(this.firstBeat,c)}else if(a<o.end){const c=new Ta(i,o.start);c.highlightBeat(e,t),this._insertBefore(o,c);const h=new Ta(o.start,a);for(const d of o.highlightedBeats)h.highlightBeat(d.beat,d.playbackStart);h.highlightBeat(e,t),this._insertBefore(o,h),o.start=a}else if(a===o.end){const c=new Ta(i,o.start);c.highlightBeat(e,t),o.highlightBeat(e,t),this._insertBefore(o,c)}else{const c=new Ta(i,o.start);c.highlightBeat(e,t),o.highlightBeat(e,t),this._insertBefore(o,c),this.addBeat(e,t,o.end,a-o.end)}else if(i>o.start)if(a===o.end){const c=new Ta(o.start,i);for(const h of o.highlightedBeats)c.highlightBeat(h.beat,h.playbackStart);o.start=i,o.highlightBeat(e,t),this._insertBefore(o,c)}else if(a<o.end){const c=new Ta(o.start,i);this._insertBefore(o,c);const h=new Ta(i,a);this._insertBefore(o,h);for(const d of o.highlightedBeats)c.highlightBeat(d.beat,d.playbackStart),h.highlightBeat(d.beat,d.playbackStart);h.highlightBeat(e,t),o.start=a}else{const c=new Ta(o.start,i);for(const h of o.highlightedBeats)c.highlightBeat(h.beat,h.playbackStart);o.start=i,o.highlightBeat(e,t),this._insertBefore(o,c),this.addBeat(e,t,o.end,a-o.end)}else if(a===o.end)o.highlightBeat(e,t);else if(a<o.end){const c=new Ta(o.start,a);for(const h of o.highlightedBeats)c.highlightBeat(h.beat,h.playbackStart);c.highlightBeat(e,t),o.start=a,this._insertBefore(o,c)}else o.highlightBeat(e,t),this.addBeat(e,t,o.end,a-o.end)}}}var na;(function(n){n[n.Unknown=0]="Unknown",n[n.ToNextBext=1]="ToNextBext",n[n.ToEndOfBar=2]="ToEndOfBar"})(na||(na={}));class LR{beat;masterBar;beatLookup;nextBeat=null;tickDuration=0;duration=0;cursorMode=na.Unknown;get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.masterBar=e}calculateDuration(){if(this.masterBar.tempoChanges.length===1)this.duration=$.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let e=0,t=this.start,i=this.masterBar.tempoChanges[0].tempo;const s=this.end;for(const a of this.masterBar.tempoChanges)if(a.tick<t)i=a.tempo;else{if(a.tick>s)break;e+=$.ticksToMillis(a.tick-t,i),i=a.tempo,t=a.tick}s>t&&(e+=$.ticksToMillis(s-t,i)),this.duration=e}}}class AR{_currentMasterBar=null;masterBarLookup=new Map;masterBars=[];multiBarRestInfo=null;findBeat(e,t,i=null){let s=null;return i&&(s=this._findBeatFast(e,i,t)),s||(s=this._findBeatSlow(e,i,t,!1)),s}_findBeatFast(e,t,i){if(i>=t.start&&i<t.end)return t;if(t.nextBeat&&i>=t.nextBeat.start&&i<t.nextBeat.end){const s=t.nextBeat;return this._fillNextBeat(s,e),s}return null}_fillNextBeatMultiBarRest(e,t){const i=this.multiBarRestInfo.get(e.masterBar.masterBar.index);let s=e.masterBar;for(let a=0;a<i.length&&s;a++)s=s.nextMasterBar;s?s.nextMasterBar?(e.nextBeat=this._firstBeatInMasterBar(t,s.nextMasterBar,s.nextMasterBar.start,!0),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=na.ToNextBext,e.nextBeat.masterBar.masterBar.index!==s.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==s.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=na.ToEndOfBar)):(e.tickDuration=s.nextMasterBar.end-e.start,e.cursorMode=na.ToEndOfBar)):(e.tickDuration=s.end-e.start,e.cursorMode=na.ToEndOfBar):(ee.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain fill-next)"),e.tickDuration=(e.masterBar.end-e.masterBar.start)*(i.length+1),e.cursorMode=na.ToEndOfBar),e.calculateDuration()}_fillNextBeat(e,t){this._isMultiBarRestResult(e)?this._fillNextBeatMultiBarRest(e,t):this._fillNextBeatDefault(e,t)}_fillNextBeatDefault(e,t){e.nextBeat=this._findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!0),e.nextBeat==null&&(e.nextBeat=this._findBeatSlow(t,e,e.end,!0)),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=na.ToNextBext,e.calculateDuration()):(e.tickDuration=e.masterBar.end-e.start,e.cursorMode=na.ToEndOfBar,e.calculateDuration()),e.nextBeat&&e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=na.ToEndOfBar)}_isMultiBarRestResult(e){return this._internalIsMultiBarRestResult(e.masterBar.masterBar.index,e.beat)}_internalIsMultiBarRestResult(e,t){return this.multiBarRestInfo&&this.multiBarRestInfo.has(e)&&t.isRest&&t.voice.bar.isRestOnly}_findBeatSlow(e,t,i,s){let a=null;return t!=null&&(t.masterBar.start<=i&&t.masterBar.end>i?a=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=i&&t.masterBar.nextMasterBar.end>i&&(a=t.masterBar.nextMasterBar)),a||(a=this._findMasterBar(i)),a?this._firstBeatInMasterBar(e,a,i,s):null}_firstBeatInMasterBar(e,t,i,s){let a=t;for(;a;){if(a.firstBeat){const o=this._findBeatInMasterBar(a,a.firstBeat,i,e,s);if(o)return o}a=a.nextMasterBar}return null}_findBeatInMasterBar(e,t,i,s,a){if(!t)return null;let o=null,c=null;const h=i-e.start;for(;t!=null&&c==null;){if((t.start<=h||a&&h<0)&&h<t.end){if(o=t,c=t.getVisibleBeatAtStart(s),!c)if(a){let p=e;for(;p!=null&&c==null;){for(;t!=null;){if(c=t.getVisibleBeatAtStart(s),c){o=t,e=p;break}t=t.nextBeat}(!c||!o)&&(p=p.nextMasterBar,t=p?.firstBeat??null)}}else{let p=e;for(;p!=null&&c==null;){for(;t!=null;){if(c=t.getVisibleBeatAtStart(s),c){o=t,e=p;break}t=t.previousBeat}(!c||!o)&&(p=p.previousMasterBar,t=p?.firstBeat??null)}}}else if(t.end>h)break;t=t?.nextBeat??null}return c==null?null:this._createResult(e,o,c,a,s)}_createResult(e,t,i,s,a){const o=new LR(e);if(o.beat=i,o.beatLookup=t,o.tickDuration=t.end-t.start,!s)this._fillNextBeat(o,a);else if(this._isMultiBarRestResult(o)){const c=this.multiBarRestInfo.get(e.masterBar.index);let h=e;for(let d=0;d<c.length&&h;d++)h=h.nextMasterBar;h?h.nextMasterBar?o.tickDuration=h.nextMasterBar.start-t.start:o.tickDuration=h.end-t.start:ee.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain stretch-result)")}return o.calculateDuration(),o}_findMasterBar(e){const t=this.masterBars;let i=0,s=t.length-1;for(;i<=s;){const a=(s+i)/2|0,o=t[a];if(e>=o.start&&e<o.end)return o;e<o.start?s=a-1:i=a+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new pv;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,i){const s=this._currentMasterBar;if(s)if(t<0&&s.previousMasterBar){const a=s.previousMasterBar.end-s.previousMasterBar.start,o=a+t,c=o+i;if(s.previousMasterBar.addBeat(e,o,o,i),c>a){const h=i+t;s.addBeat(e,t,0,h)}}else s.addBeat(e,t,t,i)}}class RR{noteOnly=0;untilTieOrSlideEnd=0;letRingEnd=0}class OR{firstBeatDuration=0;secondBeatStartOffset=0;secondBeatDuration=0}class FR{durations=[];brushInfos=[]}class IR{synthTick=0;synthTime=0;currentTempo=0;automationToSyncPoint=new Map;syncPoints;createNewSyncPoints=!1}class mt{static _defaultDurationDead=30;static _defaultDurationPalmMute=80;_score;_settings;_handler;_programsPerChannel=new Map;_currentTime=0;_calculatedBeatTimers=new Set;tickLookup=new AR;applyTranspositionPitches=!0;syncPoints=[];transpositionPitches=new Map;constructor(e,t,i){this._score=e,this._settings=t||new Zo,this._handler=i}generate(){this.transpositionPitches.clear(),this._calculatedBeatTimers.clear(),this._currentTime=0;for(const e of this._score.tracks)this._generateTrack(e);ee.debug("Midi","Begin midi generation"),this.syncPoints=[],mt._playThroughSong(this._score,this.syncPoints,!1,(e,t,i,s,a)=>{this._generateMasterBar(e,t,i,s,a)},(e,t,i)=>{for(const s of this._score.tracks)for(const a of s.staves)e<a.bars.length&&this._generateBar(a.bars[e],t,i)},e=>{for(const t of this._score.tracks)this._handler.finishTrack(t.index,e)}),ee.debug("Midi","Midi generation done")}_generateTrack(e){this._generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this._generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}_addProgramChange(e,t,i,s){(!this._programsPerChannel.has(i)||this._programsPerChannel.get(i)!==s)&&(this._handler.addProgramChange(e.index,t,i,s),this._programsPerChannel.set(i,s))}_addBankChange(e,t,i,s){const a=vn.bankToLsbMsb(s);this._handler.addControlChange(e.index,t,i,ni.BankSelectCoarse,a[1]),this._handler.addControlChange(e.index,t,i,ni.BankSelectFine,a[0])}static buildTranspositionPitches(e,t){const i=new Map;for(const s of e.tracks){const a=s.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[s.index]:-s.staves[0].transpositionPitch;i.set(s.playbackInfo.primaryChannel,a),i.set(s.playbackInfo.secondaryChannel,a)}return i}_generateChannel(e,t,i){const s=e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:-e.staves[0].transpositionPitch;this.transpositionPitches.set(t,s);const a=mt._toChannelShort(i.volume),o=mt._toChannelShort(i.balance);this._handler.addControlChange(e.index,0,t,ni.VolumeCoarse,a),this._handler.addControlChange(e.index,0,t,ni.PanCoarse,o),this._handler.addControlChange(e.index,0,t,ni.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,ni.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,ni.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,ni.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,ni.DataEntryCoarse,mt._pitchBendRangeInSemitones),this._addBankChange(e,0,t,i.bank),this._addProgramChange(e,0,t,i.program)}static generateSyncPoints(e,t=!1){const i=[];return mt._playThroughSong(e,i,t,(s,a,o,c,h)=>{},(s,a,o)=>{},s=>{}),i}static buildModifiedTempoLookup(e){const t=[];return mt._playThroughSong(e,t,!1,(s,a,o,c,h)=>{},(s,a,o)=>{},s=>{}).automationToSyncPoint}static _playThroughSong(e,t,i,s,a,o){const c=new DR(e),h=new IR;h.currentTempo=e.tempo,h.syncPoints=t,h.createNewSyncPoints=i;let d=null;const p=new Map;for(;!c.finished;){const g=c.index,y=e.masterBars[g],k=c.currentTick;if(c.processCurrent(),c.shouldPlay){let _=p.has(g)?p.get(g):-1;_++,p.set(g,_),s(y,d,k,h.currentTempo,_);const w=y.tempoAutomations.length>0?y.tempoAutomations[0].value:h.currentTempo;a(g,k,w),h.synthTick=k,mt._processBarTime(y,_,h)}c.moveNext(),d=y}if(t.length>0){const g=t[t.length-1],y=c.currentTick-g.synthTick;if(y>0){const k=new Hc;k.masterBarIndex=d.index,k.masterBarOccurence=p.get(d.index)-1,k.synthTick=c.currentTick,k.synthBpm=h.currentTempo,h.createNewSyncPoints?(k.syncBpm=g.synthBpm,k.synthBpm=g.synthBpm):t.length===1?k.syncBpm=g.synthBpm:k.syncBpm=t[t.length-2].syncBpm,k.synthTime=g.synthTime+$.ticksToMillis(y,g.synthBpm),k.syncTime=g.syncTime+$.ticksToMillis(y,k.syncBpm),h.createNewSyncPoints||g.updateSyncBpm(k.synthTime,k.syncTime),t.push(k)}}return o(c.currentTick),h}static _processBarTime(e,t,i){const s=e.calculateDuration(),a=e.syncPoints,o=i.synthTick;i.createNewSyncPoints?mt._processBarTimeWithNewSyncPoints(e,t,i):a?mt._processBarTimeWithSyncPoints(e,t,i):mt._processBarTimeNoSyncPoints(e,i);const c=o+s,h=c-i.synthTick;h>0&&(i.synthTime+=$.ticksToMillis(h,i.currentTempo),i.synthTick=c)}static _processBarTimeWithNewSyncPoints(e,t,i){const s=i.synthTick;if(e.index===0&&t===0){i.currentTempo=e.score.tempo;const o=new Hc;o.masterBarIndex=e.index,o.masterBarOccurence=t,o.synthTick=s,o.synthBpm=i.currentTempo,o.synthTime=i.synthTime,o.syncBpm=i.currentTempo,o.syncTime=i.synthTime,i.syncPoints.push(o)}const a=e.calculateDuration();for(const o of e.tempoAutomations){const c=s+o.ratioPosition*a,h=c-i.synthTick;if(h>0&&(i.synthTick=c,i.synthTime+=$.ticksToMillis(h,i.currentTempo)),o.value!==i.currentTempo){i.currentTempo=o.value;const d=new Hc;d.masterBarIndex=e.index,d.masterBarOccurence=t,d.synthTick=c,d.synthBpm=i.currentTempo,d.synthTime=i.synthTime,d.syncBpm=i.currentTempo,d.syncTime=i.synthTime,i.syncPoints.push(d)}}}static _processBarTimeWithSyncPoints(e,t,i){const s=i.synthTick,a=e.calculateDuration();let o=0,c;for(const h of e.syncPoints){if(h.syncPointValue.barOccurence!==t)continue;const d=s+h.ratioPosition*a;for(;o<e.tempoAutomations.length&&e.tempoAutomations[o].ratioPosition<=h.ratioPosition;){const g=e.tempoAutomations[o],y=s+g.ratioPosition*a;c=y-i.synthTick,c>0&&(i.synthTick=y,i.synthTime+=$.ticksToMillis(c,i.currentTempo)),i.currentTempo=g.value,o++}c=d-i.synthTick,c>0&&(i.synthTick=d,i.synthTime+=$.ticksToMillis(c,i.currentTempo)),i.syncPoints.length>0&&i.syncPoints[i.syncPoints.length-1].updateSyncBpm(i.synthTime,h.syncPointValue.millisecondOffset);const p=new Hc;p.masterBarIndex=e.index,p.masterBarOccurence=t,p.synthTick=d,p.synthBpm=i.currentTempo,p.synthTime=i.synthTime,p.syncTime=h.syncPointValue.millisecondOffset,p.syncBpm=0,i.syncPoints.push(p),i.automationToSyncPoint.set(h,p)}for(;o<e.tempoAutomations.length;){const h=e.tempoAutomations[o],d=s+h.ratioPosition*a;c=d-i.synthTick,c>0&&(i.synthTick=d,i.synthTime+=$.ticksToMillis(c,i.currentTempo)),i.currentTempo=h.value,o++}}static _processBarTimeNoSyncPoints(e,t){const i=t.synthTick,s=e.calculateDuration();for(const a of e.tempoAutomations){const o=i+a.ratioPosition*s,c=o-t.synthTick;c>0&&(t.synthTick=o,t.synthTime+=$.ticksToMillis(c,t.currentTempo)),t.currentTempo=a.value}}static _toChannelShort(e){const t=Math.max(-32768,Math.min(32767,e*8-1));return Math.max(t,-1)+1}_generateMasterBar(e,t,i,s,a){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(i,e.timeSignatureNumerator,e.timeSignatureDenominator);const o=e.calculateDuration(),c=new pv;if(e.tempoAutomations.length>0){e.tempoAutomations[0].ratioPosition>0&&c.tempoChanges.push(new Mf(i,s));for(const h of e.tempoAutomations){const d=i+o*h.ratioPosition;this._handler.addTempo(d,h.value),c.tempoChanges.push(new Mf(d,h.value))}}else t?c.tempoChanges.push(new Mf(i,s)):(this._handler.addTempo(i,e.score.tempo),c.tempoChanges.push(new Mf(i,e.score.tempo)));c.masterBar=e,c.start=i,c.end=c.start+o,this.tickLookup.addMasterBar(c)}_generateBar(e,t,i){const s=this._getPlaybackBar(e),a=this._currentTime;for(const d of s.voices)this._currentTime=a,this._generateVoice(d,t,e,i);const o=s.masterBar,c=o.calculateDuration(),h=o.tempoAutomations.slice();if(h.length===0)this._currentTime=a+$.ticksToMillis(c,i);else{this._currentTime=a;let d=t,p=i;const g=t+c;for(const k of h){const w=c*k.ratioPosition-d;w>0&&(this._currentTime+=$.ticksToMillis(w,p)),p=k.value,d+=w}const y=g-d;y>0&&(this._currentTime+=$.ticksToMillis(y,p))}s.id!==e.id&&this.tickLookup.addBeat(e.voices[0].beats[0],0,c)}_getPlaybackBar(e){switch(e.simileMark){case rs.Simple:e.previousBar&&(e=this._getPlaybackBar(e.previousBar));break;case rs.FirstOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this._getPlaybackBar(e.previousBar.previousBar));break;case rs.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this._getPlaybackBar(e.previousBar.previousBar));break}return e}_generateVoice(e,t,i,s){if(e.isEmpty&&(!e.bar.isEmpty||e.index!==0))return;const a=i.masterBar.tempoAutomations.slice();let o=s;const c=i.masterBar.calculateDuration();for(const h of e.beats){const d=h.playbackStart/c;for(;a.length>0&&a[0].ratioPosition<=d;)o=a.shift().value;this._generateBeat(h,t,i,o)}}_currentTripletFeel=null;_generateBeat(e,t,i,s){let a=e.playbackStart,o=e.playbackDuration;const c=e.voice.bar.masterBar.calculateDuration();e.voice.bar.isEmpty?o=c:e.voice.bar.masterBar.tripletFeel!==yt.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(a-=this._currentTripletFeel.secondBeatStartOffset,o=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=mt._calculateTripletFeelInfo(a,o,e),this._currentTripletFeel&&(o=this._currentTripletFeel.firstBeatDuration))),e.showTimer&&!this._calculatedBeatTimers.has(e.id)&&(e.timer=this._currentTime,this._calculatedBeatTimers.add(e.id)),this._currentTime+=$.ticksToMillis(o,s),i===e.voice.bar&&this.tickLookup.addBeat(e,a,o);const h=e.voice.bar.staff.track;for(const d of e.automations)this._generateNonTempoAutomation(e,d,t);if(e.isRest)this._handler.addRest(h.index,t+a,h.playbackInfo.primaryChannel);else if(e.deadSlapped)this._generateDeadSlap(e,t+a);else{const d=this._getBrushInfo(e),p=this._getRasgueadoInfo(e,o);for(const g of e.notes)this._generateNote(g,t+a,o,s,d,p)}if(e.fade!==Xi.None&&this._generateFade(e,t+a,o),e.vibrato!==ct.None){let d=240,p=3;switch(e.vibrato){case ct.Slight:d=this._settings.player.vibrato.beatSlightLength,p=this._settings.player.vibrato.beatSlightAmplitude;break;case ct.Wide:d=this._settings.player.vibrato.beatWideLength,p=this._settings.player.vibrato.beatWideAmplitude;break}this._generateVibratorWithParams(t+a,e.playbackDuration,d,0,p,(g,y)=>{this._handler.addBend(e.voice.bar.staff.track.index,g,h.playbackInfo.secondaryChannel,y)})}}static _calculateTripletFeelInfo(e,t,i){let s;switch(i.voice.bar.masterBar.tripletFeel){case yt.Triplet8th:case yt.Dotted8th:case yt.Scottish8th:s=M.Eighth;break;case yt.Triplet16th:case yt.Dotted16th:case yt.Scottish16th:s=M.Sixteenth;break;default:return null}const a=$.toTicks(s);if(t!==a||e%a!==0||!i.nextBeat||i.nextBeat.voice!==i.voice||i.playbackDuration!==a)return null;const o=new OR;switch(i.voice.bar.masterBar.tripletFeel){case yt.Triplet8th:o.firstBeatDuration=$.applyTuplet($.toTicks(M.Quarter),3,2),o.secondBeatDuration=$.applyTuplet($.toTicks(M.Eighth),3,2);break;case yt.Dotted8th:o.firstBeatDuration=$.applyDot($.toTicks(M.Eighth),!1),o.secondBeatDuration=$.toTicks(M.Sixteenth);break;case yt.Scottish8th:o.firstBeatDuration=$.toTicks(M.Sixteenth),o.secondBeatDuration=$.applyDot($.toTicks(M.Eighth),!1);break;case yt.Triplet16th:o.firstBeatDuration=$.applyTuplet($.toTicks(M.Eighth),3,2),o.secondBeatDuration=$.applyTuplet($.toTicks(M.Sixteenth),3,2);break;case yt.Dotted16th:o.firstBeatDuration=$.applyDot($.toTicks(M.Sixteenth),!1),o.secondBeatDuration=$.toTicks(M.ThirtySecond);break;case yt.Scottish16th:o.firstBeatDuration=$.toTicks(M.ThirtySecond),o.secondBeatDuration=$.applyDot($.toTicks(M.Sixteenth),!1);break}return o.secondBeatStartOffset=t-o.firstBeatDuration,o}_generateDeadSlap(e,t){const i=$.toTicks(M.SixtyFourth),s=e.voice.bar.staff;if(s.tuning.length>0)for(const a of s.tuning)this._handler.addNote(s.track.index,t,i,a,$.dynamicToVelocity(Oe.F),s.track.playbackInfo.primaryChannel)}_needsSecondaryChannel(e){return e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==ct.None}_determineChannel(e,t){if(this._needsSecondaryChannel(t))return e.playbackInfo.secondaryChannel;let i=t;for(;i.isTieDestination;)if(i=i.tieOrigin,this._needsSecondaryChannel(i))return e.playbackInfo.secondaryChannel;for(i=t;i.isTieOrigin;)if(i=i.tieDestination,this._needsSecondaryChannel(i))return e.playbackInfo.secondaryChannel;return e.playbackInfo.primaryChannel}_generateNote(e,t,i,s,a,o){const c=e.beat.voice.bar.staff.track,h=e.beat.voice.bar.staff;let d=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const x=$i.getArticulation(e);x&&(d=x.outputMidiNumber)}const p=o==null&&e.isStringed&&e.string<=a.length?a[e.string-1]:0,g=t+p,y=this._getNoteDuration(e,i,s);y.untilTieOrSlideEnd-=p,y.noteOnly-=p,y.letRingEnd-=p;const k=mt._getNoteVelocity(e),_=this._determineChannel(c,e);let w=0;const T=Math.max(y.untilTieOrSlideEnd,y.letRingEnd);if(e.hasBend?w=mt.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?w=mt.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===$e.Legato?w=-1:w=mt.getPitchWheel(0),w>=0&&this._handler.addNoteBend(c.index,g,_,d,w),e.beat.hasRasgueado){this._generateRasgueado(c,e,g,d,k,_,o);return}if(e.ornament!==fi.None){this._generateOrnament(c,e,g,T,d,k,_);return}if(e.isTrill&&!h.isPercussion){this._generateTrill(e,g,y,d,k,_);return}if(e.beat.isTremolo){this._generateTremoloPicking(e,g,y,d,k,_);return}e.hasBend?this._generateBend(e,g,y,d,_,s):e.beat.hasWhammyBar&&e.index===0?this._generateWhammy(e.beat,g,y,_,s):e.slideInType!==Ji.None||e.slideOutType!==$e.None?this._generateSlide(e,g,y,d,_,s):(e.vibrato!==ct.None||e.isTieDestination&&e.tieOrigin.vibrato!==ct.None)&&this._generateVibrato(e,g,y,d,_),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==$e.Legato)&&this._handler.addNote(c.index,g,T,d,k,_)}static _ornamentKeysUp=[2,2,2,1,1,2,2,2,2,2,1,1];static ornamentKeysDown=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];_generateOrnament(e,t,i,s,a,o,c){let h,d;const p=a%12,g=1/3;switch(t.ornament){case fi.Turn:h=[a+mt._ornamentKeysUp[p],a,a+mt.ornamentKeysDown[p]],d=[$.toTicks(M.Sixteenth)*g,$.toTicks(M.Sixteenth)*g,$.toTicks(M.Sixteenth)*g];break;case fi.InvertedTurn:h=[a+mt.ornamentKeysDown[p],a,a+mt._ornamentKeysUp[p]],d=[$.toTicks(M.Sixteenth)*g,$.toTicks(M.Sixteenth)*g,$.toTicks(M.Sixteenth)*g];break;case fi.UpperMordent:h=[a,a+mt._ornamentKeysUp[p]],d=[$.toTicks(M.ThirtySecond),$.toTicks(M.ThirtySecond)];break;case fi.LowerMordent:h=[a,a+mt.ornamentKeysDown[p]],d=[$.toTicks(M.ThirtySecond),$.toTicks(M.ThirtySecond)];break;default:return}let y=1;s<$.QuarterTime&&(y=s/$.QuarterTime),o-=$.VelocityIncrement;let k=0;for(let w=0;w<h.length;w++){const T=d[w]*y;this._handler.addNote(e.index,i,T,h[w],o,c),i+=T,k+=T}const _=s-k;this._handler.addNote(e.index,i,_,a,o,c)}_getNoteDuration(e,t,i){const s=new RR;if(s.noteOnly=t,s.untilTieOrSlideEnd=t,s.letRingEnd=t,e.isDead)return s.noteOnly=this._applyStaticDuration(mt._defaultDurationDead,t,i),s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(e.isPalmMute)return s.noteOnly=this._applyStaticDuration(mt._defaultDurationPalmMute,t,i),s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(e.isStaccato)return s.noteOnly=t/2|0,s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(e.isTieOrigin){const a=e.tieDestination;if(a)if(e.isTieDestination){const o=this._getNoteDuration(a,a.beat.playbackDuration,i);s.untilTieOrSlideEnd=t+o.untilTieOrSlideEnd}else{const o=e.beat.absolutePlaybackStart,c=this._getNoteDuration(a,a.beat.playbackDuration,i),h=a.beat.absolutePlaybackStart+c.untilTieOrSlideEnd;s.untilTieOrSlideEnd=h-o}}else if(e.slideOutType===$e.Legato){const a=e.slideTarget;if(a){const o=e.beat.absolutePlaybackStart,c=this._getNoteDuration(a,a.beat.playbackDuration,i),h=a.beat.absolutePlaybackStart+c.untilTieOrSlideEnd;s.untilTieOrSlideEnd=h-o}}if(e.isLetRing&&this._settings.notation.notationMode===Ps.GuitarPro){let a=e.beat,o=0;const c=e.beat.voice.bar.masterBar.calculateDuration();for(;a.nextBeat;){const h=a.nextBeat;if(h.isRest||e.isStringed&&h.hasNoteOnString(e.string))break;if(a=a.nextBeat,o=a.absolutePlaybackStart-e.beat.absolutePlaybackStart+a.playbackDuration,o>c){o=c;break}}a===e.beat?s.letRingEnd=t:s.letRingEnd=o}else s.letRingEnd=s.untilTieOrSlideEnd;return s}_applyStaticDuration(e,t,i){const s=i*e/ke.MaxPosition|0;return Math.min(s,t)}static _getNoteVelocity(e){let t=0;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case mi.Normal:t++;break;case mi.Heavy:t+=2;break}return $.dynamicToVelocity(e.dynamics,t)}_generateFade(e,t,i){const s=e.voice.bar.staff.track;switch(e.fade){case Xi.FadeIn:this._generateFadeSteps(s,t,i,0,mt._toChannelShort(s.playbackInfo.volume));break;case Xi.FadeOut:this._generateFadeSteps(s,t,i,mt._toChannelShort(s.playbackInfo.volume),0);break;case Xi.VolumeSwell:const a=i/2|0;this._generateFadeSteps(s,t,a,0,mt._toChannelShort(s.playbackInfo.volume)),this._generateFadeSteps(s,t+a,a,mt._toChannelShort(s.playbackInfo.volume),0);break}}_generateFadeSteps(e,t,i,s,a){i=i*.8|0;const c=(a-s)/i,h=i/120+1|0,d=t+i;for(let p=0;p<h;p++){const g=p===h-1,y=g?d:t+p*120,k=g?a:Math.round(s+(y-t)*c);this._handler.addControlChange(e.index,y,e.playbackInfo.primaryChannel,ni.VolumeCoarse,k),this._handler.addControlChange(e.index,y,e.playbackInfo.secondaryChannel,ni.VolumeCoarse,k)}}_generateVibrato(e,t,i,s,a){let o=0,c=0;switch(e.vibrato!==ct.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:ct.Slight){case ct.Slight:o=this._settings.player.vibrato.noteSlightLength,c=this._settings.player.vibrato.noteSlightAmplitude;break;case ct.Wide:o=this._settings.player.vibrato.noteWideLength,c=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const d=e.beat.voice.bar.staff.track;let p=0;if(e.isTieDestination&&e.tieOrigin.hasBend){const g=e.tieOrigin.bendPoints;p=g[g.length-1].value}this._generateVibratorWithParams(t,i.noteOnly,o,p,c,(g,y)=>{this._handler.addNoteBend(d.index,g,a,s,y)})}vibratoResolution=16;_generateVibratorWithParams(e,t,i,s,a,o){const c=this.vibratoResolution,h=i/2|0,d=e+t;for(;e<d;){let p=0;const g=e+i<d?i:d-e;for(;p<g;){const y=s+a*Math.sin(p*Math.PI/h);o(e+p|0,mt.getPitchWheel(y)),p+=c}e+=i}o(d|0,mt.getPitchWheel(s))}static _pitchBendRangeInSemitones=16;static _pitchValuePerSemitone=Xe.DefaultPitchWheel/mt._pitchBendRangeInSemitones;static _minBreakpointsPerSemitone=6;static _millisecondsPerBreakpoint=150;static getPitchWheel(e){return Xe.DefaultPitchWheel+e/2*mt._pitchValuePerSemitone}_generateSlide(e,t,i,s,a,o){const c=e.slideOutType===$e.Legato?i.noteOnly:i.untilTieOrSlideEnd,h=[],d=e.beat.voice.bar.staff.track,p=this._settings.player.slide.simpleSlidePitchOffset,g=Math.floor(ke.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),y=Math.floor(ke.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case Ji.IntoFromAbove:h.push(new ke(0,p)),h.push(new ke(g,0));break;case Ji.IntoFromBelow:h.push(new ke(0,-p)),h.push(new ke(g,0));break}switch(e.slideOutType){case $e.Legato:case $e.Shift:h.push(new ke(y,0));const k=(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0))*2;h.push(new ke(ke.MaxPosition,k));break;case $e.OutDown:h.push(new ke(ke.MaxPosition-g,0)),h.push(new ke(ke.MaxPosition,-p));break;case $e.OutUp:h.push(new ke(ke.MaxPosition-g,0)),h.push(new ke(ke.MaxPosition,p));break}this._generateWhammyOrBend(t,c,h,o,(k,_)=>{this._handler.addNoteBend(d.index,k,a,s,_)})}_generateBend(e,t,i,s,a,o){const c=e.bendPoints,h=e.beat.voice.bar.staff.track,d=(_,w)=>{this._handler.addNoteBend(h.index,_,a,s,w)};let p=null,g;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let _=e;for(;_.isTieOrigin&&!_.tieDestination.hasBend&&_.tieDestination.vibrato===ct.None;)_=_.tieDestination;g=_.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this._getNoteDuration(_,_.beat.playbackDuration,o).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==De.None){switch(e.tieDestination.bendType){case Ae.Bend:case Ae.BendRelease:case Ae.PrebendBend:p=e.tieDestination.bendPoints[1].value;break;case Ae.Prebend:case Ae.PrebendRelease:p=e.tieDestination.bendPoints[0].value;break}g=Math.max(i.noteOnly,$.millisToTicks(this._settings.player.songBookBendDuration,o))}else g=i.noteOnly;c[0].value>0&&!e.isContinuedBend&&t>0&&t--;const y=Math.min(g,$.millisToTicks(this._settings.player.songBookBendDuration,o));let k=[];switch(e.bendType){case Ae.Custom:k=c;break;case Ae.Bend:case Ae.Release:switch(e.bendStyle){case Kt.Default:k=c;break;case Kt.Gradual:k.push(new ke(0,e.bendPoints[0].value)),(!p||p<e.bendPoints[1].value)&&(p=e.bendPoints[1].value),k.push(new ke(ke.MaxPosition,p));break;case Kt.Fast:(!p||p<e.bendPoints[1].value)&&(p=e.bendPoints[1].value),e.beat.graceType===De.BendGrace?this._generateSongBookWhammyOrBend(t,g,!0,[e.bendPoints[0].value,p],y,o,d):this._generateSongBookWhammyOrBend(t,g,!1,[e.bendPoints[0].value,p],y,o,d);return}break;case Ae.BendRelease:switch(e.bendStyle){case Kt.Default:k=c;break;case Kt.Gradual:k.push(new ke(0,e.bendPoints[0].value)),k.push(new ke(ke.MaxPosition/2|0,e.bendPoints[1].value)),k.push(new ke(ke.MaxPosition,e.bendPoints[2].value));break;case Kt.Fast:this._generateSongBookWhammyOrBend(t,g,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],y,o,d);return}break;case Ae.Hold:k=c;break;case Ae.Prebend:k=c;break;case Ae.PrebendBend:switch(e.bendStyle){case Kt.Default:k=c;break;case Kt.Gradual:k.push(new ke(0,e.bendPoints[0].value)),k.push(new ke(ke.MaxPosition,e.bendPoints[1].value));break;case Kt.Fast:const _=mt.getPitchWheel(e.bendPoints[0].value);d(t,_|0),(!p||p<e.bendPoints[1].value)&&(p=e.bendPoints[1].value),this._generateSongBookWhammyOrBend(t,g,!1,[e.bendPoints[0].value,p],y,o,d);return}break;case Ae.PrebendRelease:switch(e.bendStyle){case Kt.Default:k=c;break;case Kt.Gradual:k.push(new ke(0,e.bendPoints[0].value)),k.push(new ke(ke.MaxPosition,e.bendPoints[1].value));break;case Kt.Fast:const _=mt.getPitchWheel(e.bendPoints[0].value);d(t,_|0),this._generateSongBookWhammyOrBend(t,g,!1,[e.bendPoints[0].value,e.bendPoints[1].value],y,o,d);return}break}this._generateWhammyOrBend(t,g,k,o,d)}_generateSongBookWhammyOrBend(e,t,i,s,a,o,c){const h=i?e:e+t-a,d=a/(s.length-1);for(let p=0;p<s.length-1;p++){const g=mt.getPitchWheel(s[p]),y=mt.getPitchWheel(s[p+1]),k=h+d*p;this._generateBendValues(k,d,g,y,o,c)}}_generateWhammy(e,t,i,s,a){const o=e.whammyBarPoints,c=e.voice.bar.staff.track,h=i.noteOnly;o[0].value>0&&!e.isContinuedWhammy&&t--;const d=(g,y)=>{this._handler.addBend(c.index,g,s,y)};let p=[];switch(e.whammyBarType){case Dt.Custom:p=o;break;case Dt.Dive:switch(e.whammyStyle){case Kt.Default:p=o;break;case Kt.Gradual:p.push(new ke(0,o[0].value)),p.push(new ke(ke.MaxPosition,o[1].value));break;case Kt.Fast:const g=Math.min(h,$.millisToTicks(this._settings.player.songBookBendDuration,a));this._generateSongBookWhammyOrBend(t,h,!1,[o[0].value,o[1].value],g,a,d);return}break;case Dt.Dip:switch(e.whammyStyle){case Kt.Default:p=o;break;case Kt.Gradual:p.push(new ke(0,o[0].value)),p.push(new ke(ke.MaxPosition/2|0,o[1].value)),p.push(new ke(ke.MaxPosition,o[2].value));break;case Kt.Fast:const g=Math.min(h,$.millisToTicks(this._settings.player.songBookDipDuration,a));this._generateSongBookWhammyOrBend(t,h,!0,[o[0].value,o[1].value,o[2].value],g,a,d);return}break;case Dt.Hold:p=o;break;case Dt.Predive:p=o;break;case Dt.PrediveDive:switch(e.whammyStyle){case Kt.Default:p=o;break;case Kt.Gradual:p.push(new ke(0,o[0].value)),p.push(new ke(ke.MaxPosition/2|0,o[0].value)),p.push(new ke(ke.MaxPosition,o[1].value));break;case Kt.Fast:const g=mt.getPitchWheel(o[0].value);this._handler.addBend(c.index,t,s,g|0);const y=Math.min(h,$.millisToTicks(this._settings.player.songBookBendDuration,a));this._generateSongBookWhammyOrBend(t,h,!1,[o[0].value,o[1].value],y,a,d);return}break}this._generateWhammyOrBend(t,h,p,a,d)}_generateWhammyOrBend(e,t,i,s,a){const o=t/ke.MaxPosition;for(let c=0;c<i.length-1;c++){const h=i[c],d=i[c+1],p=mt.getPitchWheel(h.value),g=mt.getPitchWheel(d.value),y=o*(d.offset-h.offset),k=e+o*h.offset;this._generateBendValues(k,y,p,g,s,a)}}_generateBendValues(e,t,i,s,a,o){const c=$.ticksToMillis(t,a),h=Math.abs(s-i)/mt._pitchValuePerSemitone,d=Math.max(mt._minBreakpointsPerSemitone*h,c/mt._millisecondsPerBreakpoint),p=t/d,g=(s-i)/d,y=e+t;for(let k=0;k<d;k++)o(e|0,Math.round(i)),i+=g,e+=p;o(y|0,s)}_generateRasgueado(e,t,i,s,a,o,c){let h=i;for(let d=0;d<c.durations.length;d++){const p=c.brushInfos[d],g=t.isStringed&&t.string<=p.length?p[t.string-1]:0,y=c.durations[d];this._handler.addNote(e.index,h+g,y-g,s,a,o),h+=y}}_generateTrill(e,t,i,s,a,o){const c=e.beat.voice.bar.staff.track,h=e.stringTuning+e.trillFret;let d=$.toTicks(e.trillSpeed),p=!0,g=t;const y=t+i.untilTieOrSlideEnd;for(;g+10<y;)g+d>=y&&(d=y-g),this._handler.addNote(c.index,g,d,p?h:s,a,o),p=!p,g+=d}_generateTremoloPicking(e,t,i,s,a,o){const c=e.beat.voice.bar.staff.track;let h=$.toTicks(e.beat.tremoloSpeed),d=t;const p=t+i.untilTieOrSlideEnd;for(;d+10<p;)d+h>=p&&(h=p-d),this._handler.addNote(c.index,d,h,s,a,o),d+=h}static _rasgueadoDirections=new Map([[We.Ii,[Ne.BrushDown,Ne.BrushUp]],[We.Mi,[Ne.BrushDown,Ne.BrushDown]],[We.MiiTriplet,[Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]],[We.MiiAnapaest,[Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]],[We.PmpTriplet,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.PmpAnapaest,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.PeiTriplet,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.PeiAnapaest,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.PaiTriplet,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.PaiAnapaest,[Ne.BrushUp,Ne.BrushDown,Ne.BrushDown]],[We.AmiTriplet,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown]],[We.AmiAnapaest,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown]],[We.Ppp,[Ne.None,Ne.BrushDown,Ne.BrushUp]],[We.Amii,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]],[We.Amip,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]],[We.Eami,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushDown]],[We.Eamii,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]],[We.Peami,[Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushDown,Ne.BrushUp]]]);static _rasgueadoDurations=new Map([[We.Ii,[$.toTicks(M.Eighth),$.toTicks(M.Eighth)]],[We.Mi,[$.toTicks(M.Eighth),$.toTicks(M.Eighth)]],[We.MiiTriplet,[$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3]],[We.MiiAnapaest,[$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth),$.toTicks(M.Eighth)]],[We.PmpTriplet,[$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3]],[We.PmpAnapaest,[$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Eighth)/3]],[We.PeiTriplet,[$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3]],[We.PeiAnapaest,[$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth),$.toTicks(M.Eighth)]],[We.PaiTriplet,[$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3]],[We.PaiAnapaest,[$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth),$.toTicks(M.Eighth)]],[We.AmiTriplet,[$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3,$.toTicks(M.Eighth)/3]],[We.AmiAnapaest,[$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Eighth)/3]],[We.Ppp,[$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Eighth)/3]],[We.Amii,[$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Eighth)]],[We.Amip,[$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Sixteenth)/3,$.toTicks(M.Eighth)]],[We.Eami,[$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth),$.toTicks(M.Sixteenth)]],[We.Eamii,[$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5]],[We.Peami,[$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5,$.toTicks(M.Sixteenth)/5]]]);_getRasgueadoInfo(e,t){if(!e.hasRasgueado)return null;const i=new FR,a=mt._rasgueadoDurations.get(e.rasgueado).reduce((p,g)=>p+g,0);i.durations=mt._rasgueadoDurations.get(e.rasgueado).map(p=>t*p/a),i.brushInfos=new Array(i.durations.length);const o=$.toTicks(M.Sixteenth);let c=0,h=0;for(const p of e.notes)p.isTieDestination||(c|=1<<p.string-1,h++);const d=mt._rasgueadoDirections.get(e.rasgueado);for(let p=0;p<i.durations.length;p++){const g=i.durations[p]*o/$.QuarterTime,y=new Int32Array(e.voice.bar.staff.tuning.length);i.brushInfos[p]=y;const k=d[p];k!==Ne.None&&this._fillBrushInfo(e,y,k===Ne.ArpeggioDown||k===Ne.BrushDown,c,h,g)}return i}_getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType){let i=0,s=0;for(const a of e.notes)a.isTieDestination||(i|=1<<a.string-1,s++);this._fillBrushInfo(e,t,e.brushType===Ne.ArpeggioDown||e.brushType===Ne.BrushDown,i,s,e.brushDuration)}return t}_fillBrushInfo(e,t,i,s,a,o){if(e.notes.length>0){let c=0;const h=o/(a-1)|0;for(let d=0;d<e.voice.bar.staff.tuning.length;d++){const p=i?d:t.length-1-d;(s&1<<p)!==0&&(t[p]=c,c+=h)}}return t}_generateNonTempoAutomation(e,t,i){switch(t.type){case Mt.Instrument:this._addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,(t.value|0)&255),this._addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,(t.value|0)&255);break;case Mt.Bank:this._addBankChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,t.value),this._addBankChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,t.value);break;case Mt.Balance:const s=mt._toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,ni.PanCoarse,s),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,ni.PanCoarse,s);break;case Mt.Volume:const a=mt._toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,ni.VolumeCoarse,a),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,ni.VolumeCoarse,a);break}}prepareSingleBeat(e){let t=-1,i=-1,s=e;for(;s&&(t===-1||i===-1);){for(const p of e.automations)switch(p.type){case Mt.Instrument:i=p.value;break;case Mt.Tempo:t=p.value;break}s=s.previousBeat}const a=e.voice.bar.staff.track,o=e.voice.bar.masterBar;t===-1&&(t=o.score.tempo);const c=e.playbackStart/o.calculateDuration();for(const p of o.tempoAutomations)if(p.ratioPosition<=c)t=p.value;else break;i===-1&&(i=a.playbackInfo.program);const h=a.playbackInfo.volume;this._generateTrack(a),this._handler.addTimeSignature(0,o.timeSignatureNumerator,o.timeSignatureDenominator),this._handler.addTempo(0,t);const d=mt._toChannelShort(h);return this._handler.addControlChange(0,0,a.playbackInfo.primaryChannel,ni.VolumeCoarse,d),this._handler.addControlChange(0,0,a.playbackInfo.secondaryChannel,ni.VolumeCoarse,d),t}generateSingleBeat(e){const t=this.prepareSingleBeat(e);this._generateBeat(e,-e.playbackStart,e.voice.bar,t)}generateSingleNote(e){const t=this.prepareSingleBeat(e.beat);this._generateNote(e,0,e.beat.playbackDuration,t,new Int32Array(e.beat.voice.bar.staff.tuning.length),null)}}class IB{oldWidth=0;newWidth=0;settings=null}class Vi{x;y;width=0;height=0;renderer;constructor(e,t){this.x=e,this.y=t}getBoundingBoxTop(){return this.y}doLayout(){}paint(e,t,i){}}class Xn extends Vi{beat=null;nextGlyph=null;previousGlyph=null;constructor(e=0,t=0){super(e,t)}}class ns extends Xn{glyphScale=0;symbol;center=!1;colorOverride;offsetX=0;offsetY=0;constructor(e,t,i,s){super(e,t),this.glyphScale=i,this.symbol=s}getBoundingBoxTop(){const e=this.renderer.smuflMetrics.glyphTop.get(this.symbol);return this.y-this.offsetY-e}doLayout(){this.width=this.renderer.smuflMetrics.glyphWidths.get(this.symbol)*this.glyphScale,this.height=this.renderer.smuflMetrics.glyphHeights.get(this.symbol)*this.glyphScale}paint(e,t,i){if(this.width===0&&this.height===0)return;const s=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillMusicFontSymbol(e+this.x+this.offsetX,t+this.y+this.offsetY,this.glyphScale,this.symbol,this.center),i.color=s}}class WR extends Xn{glyphScale=0;symbols;center=!1;colorOverride;offsetX=0;offsetY=0;constructor(e,t,i,s){super(e,t),this.glyphScale=i,this.symbols=s}getBoundingBoxTop(){let e=0;for(let t=0;t<this.symbols.length;t++){const i=this.renderer.smuflMetrics.glyphTop.get(this.symbols[t]);(t===0||i<e)&&(e=i)}return this.y-this.offsetY-e}doLayout(){this.width=0,this.height=0;for(let e=0;e<this.symbols.length;e++){const t=this.renderer.smuflMetrics.glyphWidths.get(this.symbols[e])*this.glyphScale,i=this.renderer.smuflMetrics.glyphHeights.get(this.symbols[e])*this.glyphScale;(e===0||t>this.width)&&(this.width=t),(e===0||i>this.height)&&(this.height=i)}}paint(e,t,i){if(this.width===0&&this.height===0)return;const s=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillMusicFontSymbols(e+this.x+this.offsetX,t+this.y+this.offsetY,this.glyphScale,this.symbols,this.center),i.color=s}}class Ct extends ns{static GraceScale=.75;centerOnStem=!1;constructor(e,t,i,s){super(e,t,s?Ct.GraceScale:1,Ct.getSymbol(i))}paint(e,t,i){this.centerOnStem&&(this.center=!0),super.paint(e,t,i)}static getSymbol(e){switch(e){case M.QuadrupleWhole:return S.NoteheadDoubleWholeSquare;case M.DoubleWhole:return S.NoteheadDoubleWhole;case M.Whole:return S.NoteheadWhole;case M.Half:return S.NoteheadHalf;default:return S.NoteheadBlack}}}class bg extends ns{constructor(e,t,i,s,a){super(e,t,a?Ct.GraceScale:1,bg.getSymbol(i,s,a))}static getSymbol(e,t,i){if(i&&(e=M.Eighth),t===j.Up)switch(e){case M.Eighth:return S.Flag8thUp;case M.Sixteenth:return S.Flag16thUp;case M.ThirtySecond:return S.Flag32ndUp;case M.SixtyFourth:return S.Flag64thUp;case M.OneHundredTwentyEighth:return S.Flag128thUp;case M.TwoHundredFiftySixth:return S.Flag256thUp;default:return S.Flag8thUp}switch(e){case M.Eighth:return S.Flag8thDown;case M.Sixteenth:return S.Flag16thDown;case M.ThirtySecond:return S.Flag32ndDown;case M.SixtyFourth:return S.Flag64thDown;case M.OneHundredTwentyEighth:return S.Flag128thDown;case M.TwoHundredFiftySixth:return S.Flag128thDown;default:return S.Flag8thDown}}}class Da extends Vi{voiceContainer;beat;preNotes;onNotes;ties=[];minWidth=0;get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,t){super(0,0),this.beat=e,this.ties=[],this.voiceContainer=t}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){const t=this.preNotes.computedWidth+this.onNotes.centerX;let i=this.onNotes.computedWidth-this.onNotes.centerX;const s=this.renderer.helpers.getBeamingHelperForBeat(this.beat);this.beat.graceType!==De.None?i+=this.renderer.smuflMetrics.glyphWidths.get(S.Flag8thUp)*Ct.GraceScale:s&&this.drawBeamHelperAsFlags(s)&&(i+=this.renderer.smuflMetrics.glyphWidths.get(S.Flag8thUp)*Ct.GraceScale);for(const a of this.ties)i+=a.width;e.addBeatSpring(this.beat,t,i)}applyLayoutingInfo(e){this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout(),this.onNotes.updateBeamingHelper();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest&&this.onNotes.beamingHelper.beats.length===1&&this.beat.duration>=M.Eighth){const t=bg.getSymbol(this.beat.duration,this.onNotes.beamingHelper.direction,this.beat.graceType!==De.None);this.minWidth+=this.renderer.smuflMetrics.glyphWidths.get(t)}let e=0;for(const t of this.ties)t.width>e&&(e=t.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return`b${e.id}`}paint(e,t,i){if(this.preNotes.isEmpty&&this.onNotes.isEmpty&&this.ties.length===0)return;i.beginGroup(Da.getGroupId(this.beat)),this.preNotes.paint(e+this.x,t+this.y,i),this.onNotes.paint(e+this.x,t+this.y,i);const a=e-this.voiceContainer.x-this.renderer.x,o=t-this.voiceContainer.y-this.renderer.y;for(let c=0,h=this.ties.length;c<h;c++){const d=this.ties[c];d.renderer=this.renderer,d.paint(a,o,i)}i.endGroup()}buildBoundingsLookup(e,t,i,s){const a=new zx;if(a.beat=this.beat,this.beat.isEmpty)a.visualBounds=new Os,a.visualBounds.x=t+this.x,a.visualBounds.y=e.visualBounds.y,a.visualBounds.w=this.width,a.visualBounds.h=e.visualBounds.h,a.realBounds=new Os,a.realBounds.x=t+this.x,a.realBounds.y=e.realBounds.y,a.realBounds.w=this.width,a.realBounds.h=e.realBounds.h,a.onNotesX=t+this.x+this.onNotes.centerX;else{a.visualBounds=new Os,a.visualBounds.x=t+this.x,this.preNotes.isEmpty?this.onNotes.isEmpty?a.visualBounds.x=t+this.x:a.visualBounds.x=t+this.x+this.onNotes.x:a.visualBounds.x=t+this.x+this.preNotes.x;let o=0;this.onNotes.isEmpty?this.preNotes.isEmpty?o=t+this.x+this.width:o=t+this.x+this.preNotes.x+this.preNotes.width:o=t+this.x+this.onNotes.x+this.onNotes.width,a.visualBounds.w=o-a.visualBounds.x;const c=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(c&&this.drawBeamHelperAsFlags(c)||this.beat.graceType!==De.None)&&(a.visualBounds.w+=this.renderer.smuflMetrics.glyphWidths.get(S.Flag8thUp)*(this.beat.graceType!==De.None?Ct.GraceScale:1)),a.visualBounds.y=e.visualBounds.y,a.visualBounds.h=e.visualBounds.h,a.realBounds=new Os,a.realBounds.x=t+this.x,a.realBounds.y=e.realBounds.y,a.realBounds.w=this.width,a.realBounds.h=e.realBounds.h,a.onNotesX=t+this.x+this.onNotes.x+this.onNotes.centerX}e.addBeat(a),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(a,t+this.x,i+this.y)}}class VR{_instance;_instanceEventUnregister;_settings;_width=0;_score=null;_trackIndexes=null;get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const i of t)i();if(e){const i=[];i.push(e.preRender.on(s=>this.preRender.trigger(s))),i.push(e.renderFinished.on(s=>this.renderFinished.trigger(s))),i.push(e.partialRenderFinished.on(s=>this.partialRenderFinished.trigger(s))),i.push(e.partialLayoutFinished.on(s=>this.partialLayoutFinished.trigger(s))),i.push(e.postRenderFinished.on(()=>this.postRenderFinished.trigger())),i.push(e.error.on(s=>this.error.trigger(s))),this._instanceEventUnregister=i,this._settings&&e.updateSettings(this._settings),e.width=this._width,this._score!==null&&e.renderScore(this._score,this._trackIndexes)}else this._instanceEventUnregister=void 0}get boundsLookup(){return this._instance?this._instance.boundsLookup:null}get width(){return this._instance?this._instance.width:0}set width(e){this._width=e,this._instance&&(this._instance.width=e)}render(){this._instance?.render()}resizeRender(){this._instance?.resizeRender()}renderScore(e,t){this._score=e,this._trackIndexes=t,this._instance?.renderScore(e,t)}renderResult(e){this._instance?.renderResult(e)}updateSettings(e){this._settings=e,this._instance?.updateSettings(e)}destroy(){this._instance?.destroy(),this._instance=void 0}preRender=new ot;renderFinished=new ot;partialRenderFinished=new ot;partialLayoutFinished=new ot;postRenderFinished=new qi;error=new ot}class H0{activeBeats;constructor(e){this.activeBeats=e}}class HR{_masterVolume=1;_metronomeVolume=0;_countInVolume=0;_playbackSpeed=1;_isLooping=!1;_midiEventsPlayedFilter=[];_instance;_instanceEventUnregister;constructor(){this.ready=new qi(()=>this.isReady),this.readyForPlayback=new qi(()=>this.isReadyForPlayback),this.midiLoaded=new ot(()=>this._instance?.loadedMidiInfo??null),this.stateChanged=new ot(()=>new Rl(this.state,!1)),this.positionChanged=new ot(()=>this.currentPosition),this.playbackRangeChanged=new ot(()=>{const e=this.playbackRange;return e?new Hh(e):null})}get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const i of t)i();if(e){const i=[];i.push(e.ready.on(()=>this.ready.trigger())),i.push(e.readyForPlayback.on(()=>this.readyForPlayback.trigger())),i.push(e.finished.on(()=>this.finished.trigger())),i.push(e.soundFontLoaded.on(()=>this.soundFontLoaded.trigger())),i.push(e.soundFontLoadFailed.on(s=>this.soundFontLoadFailed.trigger(s))),i.push(e.midiLoaded.on(s=>{this.midiLoaded.trigger(s)})),i.push(e.midiLoadFailed.on(s=>this.midiLoadFailed.trigger(s))),i.push(e.stateChanged.on(s=>this.stateChanged.trigger(s))),i.push(e.positionChanged.on(s=>{this.positionChanged.trigger(s)})),i.push(e.midiEventsPlayed.on(s=>this.midiEventsPlayed.trigger(s))),i.push(e.playbackRangeChanged.on(s=>this.playbackRangeChanged.trigger(s))),this._instanceEventUnregister=i,this.isReady?(e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter,this.ready.trigger()):i.push(e.ready.on(()=>{e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter}))}else this._instanceEventUnregister=void 0}get output(){return this._instance.output}get isReady(){return this._instance?this._instance.isReady:!1}get isReadyForPlayback(){return this._instance?this._instance.isReadyForPlayback:!1}get state(){return this._instance?this._instance.state:Ts.Paused}get logLevel(){return ee.logLevel}set logLevel(e){ee.logLevel=e,this._instance&&(this._instance.logLevel=e)}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,Xe.MinVolume),this._masterVolume=e,this._instance&&(this._instance.masterVolume=e)}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,Xe.MinVolume),this._metronomeVolume=e,this._instance&&(this._instance.metronomeVolume=e)}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._instance&&(this._instance.playbackSpeed=e)}get loadedMidiInfo(){return this._instance?this._instance.loadedMidiInfo:void 0}get currentPosition(){return this._instance?this._instance.currentPosition:new fr(0,0,0,0,!1,120,120)}get tickPosition(){return this._instance?this._instance.tickPosition:0}set tickPosition(e){this._instance&&(this._instance.tickPosition=e)}get timePosition(){return this._instance?this._instance.timePosition:0}set timePosition(e){this._instance&&(this._instance.timePosition=e)}get playbackRange(){return this._instance?this._instance.playbackRange:null}set playbackRange(e){this._instance&&(this._instance.playbackRange=e)}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._instance&&(this._instance.isLooping=e)}get countInVolume(){return this._countInVolume}set countInVolume(e){this._countInVolume=e,this._instance&&(this._instance.countInVolume=e)}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._instance&&(this._instance.midiEventsPlayedFilter=e)}destroy(){this._instance&&(this._instance.destroy(),this._instance=void 0)}play(){return this._instance?this._instance.play():!1}pause(){this._instance&&this._instance.pause()}playPause(){this._instance&&this._instance.playPause()}stop(){this._instance&&this._instance.stop()}playOneTimeMidiFile(e){this._instance&&this._instance.playOneTimeMidiFile(e)}loadSoundFont(e,t){this._instance&&this._instance.loadSoundFont(e,t)}resetSoundFonts(){this._instance&&this._instance.resetSoundFonts()}loadMidiFile(e){this._instance&&this._instance.loadMidiFile(e)}loadBackingTrack(e){this._instance&&this._instance.loadBackingTrack(e)}updateSyncPoints(e){this._instance&&this._instance.updateSyncPoints(e)}applyTranspositionPitches(e){this._instance&&this._instance.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this._instance&&this._instance.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this._instance&&this._instance.setChannelMute(e,t)}resetChannelStates(){this._instance&&this._instance.resetChannelStates()}setChannelSolo(e,t){this._instance&&this._instance.setChannelSolo(e,t)}setChannelVolume(e,t){this._instance&&this._instance.setChannelVolume(e,t)}ready;readyForPlayback;finished=new qi;soundFontLoaded=new qi;soundFontLoadFailed=new ot;midiLoaded;midiLoadFailed=new ot;stateChanged;positionChanged;midiEventsPlayed=new ot;playbackRangeChanged}class zR{_midiEventQueue=new Ob;masterVolume=1;metronomeVolume=0;outSampleRate=44100;currentTempo=120;timeSignatureNumerator=4;timeSignatureDenominator=4;activeVoiceCount=0;output;noteOffAll(e){}resetSoft(){}resetPresets(){}loadPresets(e,t,i,s){}setupMetronomeChannel(e){}synthesizeSilent(e){this.fakeSynthesize()}_processMidiMessage(e){}dispatchEvent(e){this._midiEventQueue.enqueue(e)}synthesize(e,t,i){return this.fakeSynthesize()}fakeSynthesize(){const e=[];for(;!this._midiEventQueue.isEmpty;){const t=this._midiEventQueue.dequeue();t.isMetronome&&this.metronomeVolume>0||t.event&&this._processMidiMessage(t.event),e.push(t)}return e}applyTranspositionPitches(e){}setChannelTranspositionPitch(e,t){}channelSetMute(e,t){}channelSetSolo(e,t){}resetChannelStates(){}channelSetMixVolume(e,t){}hasSamplesForProgram(e){return!0}hasSamplesForPercussion(e){return!0}}class gv extends Ib{_backingTrackOutput;constructor(e,t){super(e,new zR,t),this.synthesizer.output=e,this._backingTrackOutput=e,e.timeUpdate.on(i=>{const s=this.sequencer.mainTimePositionFromBackingTrack(i,e.backingTrackDuration);this.sequencer.fillMidiEventQueueToEndTime(s),this.synthesizer.fakeSynthesize(),this.updateTimePosition(s,!1),this.checkForFinish()})}updateMasterVolume(e){super.updateMasterVolume(e),this._backingTrackOutput.masterVolume=e}updatePlaybackSpeed(e){super.updatePlaybackSpeed(e),this._backingTrackOutput.playbackRate=e}onSampleRequest(){}loadMidiFile(e){this.isSoundFontLoaded||(this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger()),super.loadMidiFile(e)}updateTimePosition(e,t){super.updateTimePosition(e,t),t&&this._backingTrackOutput.seekTo(this.sequencer.mainTimePositionToBackingTrack(e,this._backingTrackOutput.backingTrackDuration))}loadBackingTrack(e){const t=e.backingTrack;t&&(this._backingTrackOutput.loadBackingTrack(t),this.timePosition=0)}updateSyncPoints(e){this.sequencer.mainUpdateSyncPoints(e),this.tickPosition=this.tickPosition}}class GR{sampleRate=44100;_seekPosition=0;_handler;get handler(){return this._handler}set handler(e){e&&this._seekPosition!==0&&(e.seekTo(this._seekPosition),this._seekPosition=0),this._handler=e}get backingTrackDuration(){return this.handler?.backingTrackDuration??0}get playbackRate(){return this.handler?.playbackRate??1}set playbackRate(e){const t=this.handler;t&&(t.playbackRate=e)}get masterVolume(){return this.handler?.masterVolume??1}set masterVolume(e){const t=this.handler;t&&(t.masterVolume=e)}seekTo(e){const t=this.handler;t?t.seekTo(e):this._seekPosition=e}loadBackingTrack(e){}open(e){this.ready.trigger()}updatePosition(e){this.timeUpdate.trigger(e)}play(){this.handler?.play()}destroy(){}pause(){this.handler?.pause()}addSamples(e){}resetSamples(){}activate(){}ready=new qi;samplesPlayed=new ot;timeUpdate=new ot;sampleRequest=new qi;async enumerateOutputDevices(){return[]}async setOutputDevice(e){}async getOutputDevice(){return null}}class UR extends gv{get handler(){return this.output.handler}set handler(e){this.output.handler=e}constructor(e){super(new GR,e)}}class mv{startTick=0;endTick=0}class Lf{beat;bounds=null;constructor(e){this.beat=e}}class YR{_startTime=0;_trackIndexes=null;_trackIndexLookup=null;_isDestroyed=!1;_score=null;_tracks=[];_actualPlayerMode=nn.Disabled;_player;_renderer;get actualPlayerMode(){return this._actualPlayerMode}uiFacade;container;get renderer(){return this._renderer}get score(){return this._score}settings;get tracks(){return this._tracks}canvasElement;constructor(e,t){this.uiFacade=e,this.container=e.rootContainer,this.activeBeatsChanged=new ot(()=>this._player.state===Ts.Playing&&this._currentBeat?new H0(this._currentBeat.beatLookup.highlightedBeats.map(s=>s.beat)):null),this.playedBeatChanged=new ot(()=>this._player.state===Ts.Playing&&this._currentBeat?this._currentBeat.beat:null),this.scoreLoaded=new ot(()=>this._score?this._score:null),this.midiLoaded=new ot(()=>this._player.loadedMidiInfo??null),e.initialize(this,t),ee.logLevel=this.settings.core.logLevel,this.settings.handleBackwardsCompatibility(),ne.printEnvironmentInfo(!1),this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this._renderer=new VR,this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&ne.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this._renderer.instance=this.uiFacade.createWorkerRenderer():this._renderer.instance=new ph(this.settings),this.container.resize.on(ne.throttle(()=>{this._isDestroyed||this.container.width!==this._renderer.width&&this.triggerResize()},e.resizeThrottle));const i=new IB;i.oldWidth=this._renderer.width,i.newWidth=this.container.width|0,i.settings=this.settings,this._onResize(i),this._renderer.preRender.on(this._onRenderStarted.bind(this)),this._renderer.renderFinished.on(s=>{this._onRenderFinished(s)}),this._renderer.postRenderFinished.on(()=>{const s=Date.now()-this._startTime;ee.debug("rendering",`Rendering completed in ${s}ms`),this._onPostRenderFinished()}),this._renderer.preRender.on(s=>{this._startTime=Date.now()}),this._renderer.partialLayoutFinished.on(s=>this._appendRenderResult(s,!1)),this._renderer.partialRenderFinished.on(this._updateRenderResult.bind(this)),this._renderer.renderFinished.on(s=>{this._appendRenderResult(s,!0)}),this._renderer.error.on(this.onError.bind(this)),this._setupPlayerWrapper(),this.settings.player.playerMode!==nn.Disabled&&this._setupOrDestroyPlayer(),this._setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}_setupPlayerWrapper(){const e=new HR;this._player=e,e.ready.on(()=>{this.loadMidiForScore()}),e.readyForPlayback.on(()=>{if(this._onPlayerReady(),this.tracks)for(const t of this.tracks){const i=t.playbackInfo.volume/16;e.setChannelVolume(t.playbackInfo.primaryChannel,i),e.setChannelVolume(t.playbackInfo.secondaryChannel,i)}}),e.soundFontLoaded.on(this._onSoundFontLoaded.bind(this)),e.soundFontLoadFailed.on(t=>{this.onError(t)}),e.midiLoaded.on(this._onMidiLoaded.bind(this)),e.midiLoadFailed.on(t=>{this.onError(t)}),e.stateChanged.on(this._onPlayerStateChanged.bind(this)),e.positionChanged.on(this._onPlayerPositionChanged.bind(this)),e.midiEventsPlayed.on(this._onMidiEventsPlayed.bind(this)),e.playbackRangeChanged.on(this._onPlaybackRangeChanged.bind(this)),e.finished.on(this._onPlayerFinished.bind(this))}destroy(){this._isDestroyed=!0,this._player.destroy(),this.uiFacade.destroy(),this._renderer.destroy()}updateSettings(){this.settings.handleBackwardsCompatibility();const e=this.score;e&&ce.applyPitchOffsets(this.settings,e),this._updateRenderer(),this._renderer.updateSettings(this.settings),this._setupOrDestroyPlayer(),this._onSettingsUpdated()}_updateRenderer(){const e=this._renderer;this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&ne.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?e.instance instanceof ph&&(e.destroy(),e.instance=this.uiFacade.createWorkerRenderer()):e.instance instanceof ph||(e.destroy(),e.instance=new ph(this.settings))}load(e,t){try{return this.uiFacade.load(e,i=>{this.renderScore(i,t)},i=>{this.onError(i)})}catch(i){return this.onError(i),!1}}renderScore(e,t){const i=[];if(!t)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===0)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===1&&t[0]===-1)for(const s of e.tracks)i.push(s);else for(const s of t)s>=0&&s<=e.tracks.length&&i.push(e.tracks[s]);this._internalRenderTracks(e,i)}renderTracks(e){if(e.length>0){const t=e[0].score;for(const i of e)if(i.score!==t){this.onError(new Ht(It.General,"All rendered tracks must belong to the same score."));return}this._internalRenderTracks(t,e)}}_internalRenderTracks(e,t){if(ce.applyPitchOffsets(this.settings,e),e!==this.score){this._score=e,this._tracks=t,this._tickCache=null,this._trackIndexes=[];for(const i of t)this._trackIndexes.push(i.index);this._trackIndexLookup=new Set(this._trackIndexes),this._onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this._tracks=t;const i=ce.computeFirstDisplayedBarIndex(e,this.settings),s=ce.computeLastDisplayedBarIndex(e,this.settings,i);this._tickCache&&(this._tickCache.multiBarRestInfo=ce.buildMultiBarRestInfo(this.tracks,i,s)),this._trackIndexes=[];for(const a of t)this._trackIndexes.push(a.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(!this.container.isVisible)ee.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{ee.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()});else{const e=new IB;e.oldWidth=this._renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this._onResize(e),this._renderer.updateSettings(this.settings),this._renderer.width=this.container.width,this._renderer.resizeRender()}}_appendRenderResult(e,t){t&&(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight)),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e),t&&this.uiFacade.beginAppendRenderResults(null)}_updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{const i=new Nb;i.logErrors=!0,i.initFromString(e,this.settings);const s=i.readScore();this.renderScore(s,t)}catch(i){this.onError(i)}}loadSoundFont(e,t=!1){return this.uiFacade.loadSoundFont(e,t)}resetSoundFonts(){this._player.resetSoundFonts()}render(){this.uiFacade.canRender?(this._renderer.width=this.container.width,this._renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render())}_tickCache=null;get tickCache(){return this._tickCache}get boundsLookup(){return this._renderer.boundsLookup}get player(){return this._player.instance?this._player:null}get isReadyForPlayback(){return this._player.isReadyForPlayback}get playerState(){return this._player.state}get masterVolume(){return this._player.masterVolume}set masterVolume(e){this._player.masterVolume=e}get metronomeVolume(){return this._player.metronomeVolume}set metronomeVolume(e){this._player.metronomeVolume=e}get countInVolume(){return this._player.countInVolume}set countInVolume(e){this._player.countInVolume=e}get midiEventsPlayedFilter(){return this._player.midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._player.midiEventsPlayedFilter=e}get tickPosition(){return this._player.tickPosition}set tickPosition(e){this._player.tickPosition=e}get timePosition(){return this._player.timePosition}set timePosition(e){this._player.timePosition=e}get endTick(){return this._player.currentPosition.endTick}get endTime(){return this._player.currentPosition.endTime}get playbackRange(){return this._player.playbackRange}set playbackRange(e){this._player.playbackRange=e,this._updateSelectionCursor(e)}get playbackSpeed(){return this._player.playbackSpeed}set playbackSpeed(e){this._player.playbackSpeed=e}get isLooping(){return this._player.isLooping}set isLooping(e){this._player.isLooping=e}_destroyPlayer(){this._player.destroy(),this._previousTick=0,this._destroyCursors()}_setupOrDestroyPlayer(){let e=this.settings.player.playerMode;if(e===nn.EnabledAutomatic){const i=this.score;if(!i)return!1;i?.backingTrack?.rawAudioFile?e=nn.EnabledBackingTrack:e=nn.EnabledSynthesizer}let t=null;if(e!==this._actualPlayerMode)switch(this._destroyPlayer(),this._updateCursors(),e){case nn.Disabled:t=null;break;case nn.EnabledSynthesizer:t=this.uiFacade.createWorkerPlayer();break;case nn.EnabledBackingTrack:t=this.uiFacade.createBackingTrackPlayer();break;case nn.EnabledExternalMedia:t=new UR(this.settings.player.bufferTimeInMilliseconds);break}else return this._updateCursors(),!1;return this._actualPlayerMode=e,t&&(this._player.instance=t),!1}loadMidiForScore(){if(!this.score)return;const e=this.score;ee.debug("AlphaTab","Generating Midi");const t=new Kr,i=new Ua(t),s=new mt(e,this.settings,i),a=ce.computeFirstDisplayedBarIndex(e,this.settings),o=ce.computeLastDisplayedBarIndex(e,this.settings,a);s.tickLookup.multiBarRestInfo=ce.buildMultiBarRestInfo(this.tracks,a,o),s.applyTranspositionPitches=!1,s.generate(),this._tickCache=s.tickLookup,this._onMidiLoad(t);const c=this._player;c.loadMidiFile(t),c.loadBackingTrack(e),c.updateSyncPoints(s.syncPoints),c.applyTranspositionPitches(s.transpositionPitches)}updateSyncPoints(){if(!this.score)return;const e=this.score;this._player.updateSyncPoints(mt.generateSyncPoints(e))}changeTrackVolume(e,t){for(const i of e)this._player.setChannelVolume(i.playbackInfo.primaryChannel,t),this._player.setChannelVolume(i.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){for(const i of e)this._player.setChannelSolo(i.playbackInfo.primaryChannel,t),this._player.setChannelSolo(i.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){for(const i of e)this._player.setChannelMute(i.playbackInfo.primaryChannel,t),this._player.setChannelMute(i.playbackInfo.secondaryChannel,t)}changeTrackTranspositionPitch(e,t){for(const i of e)this._player.setChannelTranspositionPitch(i.playbackInfo.primaryChannel,t),this._player.setChannelTranspositionPitch(i.playbackInfo.secondaryChannel,t)}play(){return this._player.play()}pause(){this._player.pause()}playPause(){this._player.playPause()}stop(){this._player.stop()}playBeat(e){const t=new Kr,i=new Ua(t);new mt(e.voice.bar.staff.track.score,this.settings,i).generateSingleBeat(e),this._player.playOneTimeMidiFile(t)}playNote(e){const t=new Kr,i=new Ua(t);new mt(e.beat.voice.bar.staff.track.score,this.settings,i).generateSingleNote(e),this._player.playOneTimeMidiFile(t)}_cursorWrapper=null;_barCursor=null;_beatCursor=null;_selectionWrapper=null;_previousTick=0;_currentBeat=null;_currentBeatBounds=null;_isInitialBeatCursorUpdate=!0;_previousStateForCursor=Ts.Paused;_previousCursorCache=null;_lastScroll=0;_destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}_updateCursors(){const e=this._hasCursor;if(e&&!this._cursorWrapper){const t=this.uiFacade.createCursors();t&&(this._cursorWrapper=t.cursorWrapper,this._barCursor=t.barCursor,this._beatCursor=t.beatCursor,this._selectionWrapper=t.selectionWrapper,this._isInitialBeatCursorUpdate=!0),this._currentBeat!==null&&this._cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,1,!0)}else!e&&this._cursorWrapper&&this._destroyCursors()}_cursorUpdateTick(e,t,i,s=!1,a=!1){this._previousTick=e;const o=this._tickCache;if(o){const c=this._trackIndexLookup;if(c!=null&&c.size>0){const h=o.findBeat(c,e,this._currentBeat);h&&this._cursorUpdateBeat(h,t,s,i,a||this.playerState===Ts.Paused)}}}_cursorUpdateBeat(e,t,i,s,a=!1){const o=e.beat,c=e.nextBeat?.beat??null,h=e.duration,d=e.beatLookup.highlightedBeats;if(!o)return;const p=this._renderer.boundsLookup;if(!p)return;const g=this._currentBeat,y=this._previousCursorCache,k=this._previousStateForCursor;if(!a&&o===g?.beat&&p===y&&k===this._player.state&&g?.start===e.start)return;const _=p.findBeat(o);_&&(this._currentBeat=e,this._previousCursorCache=p,this._previousStateForCursor=this._player.state,this.uiFacade.beginInvoke(()=>{this._internalCursorUpdateBeat(o,c,h,t,d,p,_,i,e.cursorMode,s)}))}scrollToCursor(){const e=this._currentBeatBounds;e&&this._internalScrollToCursor(e.barBounds.masterBarBounds)}_internalScrollToCursor(e){const t=this.uiFacade.getScrollContainer(),i=ne.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,s=this.settings.player.scrollMode;if(i){const a=e.realBounds.y+this.settings.player.scrollOffsetY;if(a!==this._lastScroll)switch(this._lastScroll=a,s){case pr.Continuous:const o=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,o.y+a,this.settings.player.scrollSpeed);break;case pr.OffScreen:const c=t.scrollTop+this.uiFacade.getOffset(null,t).h;if(e.visualBounds.y+e.visualBounds.h>=c||e.visualBounds.y<t.scrollTop){const h=e.realBounds.y+this.settings.player.scrollOffsetY;this.uiFacade.scrollToY(t,h,this.settings.player.scrollSpeed)}break}}else{const a=e.visualBounds.x;if(a!==this._lastScroll)switch(this._lastScroll=a,s){case pr.Continuous:const o=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,o,this.settings.player.scrollSpeed);break;case pr.OffScreen:const c=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=c||e.visualBounds.x<t.scrollLeft){const h=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,h,this.settings.player.scrollSpeed)}break}}}_internalCursorUpdateBeat(e,t,i,s,a,o,c,h,d,p){const g=this._barCursor,y=this._beatCursor,k=c.barBounds.masterBarBounds,_=k.visualBounds,w=this._currentBeatBounds;this._currentBeatBounds=c,g&&g.setBounds(_.x,_.y,_.w,_.h);const T=this._player.state===Ts.Playing&&!s;let x=k.visualBounds.x+k.visualBounds.w;if(t&&d===na.ToNextBext){const v=o.findBeat(t);v&&v.barBounds.masterBarBounds.staffSystemBounds===k.staffSystemBounds&&(x=v.onNotesX)}let E=c.onNotesX;if(y){if(this.settings.player.enableAnimatedBeatCursor){const v=x-c.onNotesX,L=this._previousTick-this._currentBeat.start,A=this._currentBeat.tickDuration>0?L/this._currentBeat.tickDuration:0;E=c.onNotesX+v*A,i-=i*A,T?((!w||this._isInitialBeatCursorUpdate||_.y!==w.barBounds.masterBarBounds.visualBounds.y||E<w.onNotesX||k.index>w.barBounds.masterBarBounds.index+1)&&(y.transitionToX(0,E),y.setBounds(E,_.y,1,_.h)),this.uiFacade.beginInvoke(()=>{const H=d===na.ToNextBext?2:1,J=E+(x-E)*H;y.transitionToX(i/p*H,J)})):(y.transitionToX(0,E),y.setBounds(E,_.y,1,_.h))}else y.transitionToX(0,E),y.setBounds(E,_.y,1,_.h);this._isInitialBeatCursorUpdate=!1}else this._isInitialBeatCursorUpdate=!0;this.uiFacade.removeHighlights();let N=!1;if(T){if(this.settings.player.enableElementHighlighting)for(const v of a){const L=Da.getGroupId(v.beat);this.uiFacade.highlightElements(L,e.voice.bar.index)}h=!s,N=!0}h&&!this._isBeatMouseDown&&this.settings.player.scrollMode!==pr.Off&&this._internalScrollToCursor(k),N&&(this._onPlayedBeatChanged(e),this._onActiveBeatsChanged(new H0(a.map(v=>v.beat))))}playedBeatChanged;_onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}activeBeatsChanged;_onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}_isBeatMouseDown=!1;_isNoteMouseDown=!1;_selectionStart=null;_selectionEnd=null;beatMouseDown=new ot;beatMouseMove=new ot;beatMouseUp=new ot;noteMouseDown=new ot;noteMouseMove=new ot;noteMouseUp=new ot;get _hasCursor(){return this.settings.player.playerMode!==nn.Disabled&&this.settings.player.enableCursor}_onBeatMouseDown(e,t){this._isDestroyed||(this._hasCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new Lf(t),this._selectionEnd=null),this._isBeatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}_onNoteMouseDown(e,t){this._isDestroyed||(this._isNoteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}_onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new Lf(t),this._cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}_onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}_onBeatMouseUp(e,t){if(!this._isDestroyed){if(this._hasCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){const i=this._tickCache?.getBeatStart(this._selectionStart.beat)??this._selectionStart.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(this._selectionEnd.beat)??this._selectionEnd.beat.absolutePlaybackStart)<i){const a=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=a}}if(this._selectionStart&&this._tickCache){const i=this._tickCache,s=i.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._player.state===Ts.Paused&&this._cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1,1),this.tickPosition=s+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){const a=i.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),o=new mv;o.startTick=s+this._selectionStart.beat.playbackStart,o.endTick=a+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=o}else this._selectionStart=null,this.playbackRange=null,this._cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._isBeatMouseDown=!1}}_onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._isNoteMouseDown=!1)}_updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),i=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&i){const s=new Lf(t.beat),a=new Lf(i.beat);this._cursorSelectRange(s,a)}}else this._cursorSelectRange(null,null)}_setupClickHandling(){this.canvasElement.mouseDown.on(e=>{if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),s=this._renderer.boundsLookup?.getBeatAtPos(t,i)??null;if(s&&(this._onBeatMouseDown(e,s),this.settings.core.includeNoteBounds)){const a=this._renderer.boundsLookup?.getNoteAtPos(s,t,i);a&&this._onNoteMouseDown(e,a)}}),this.canvasElement.mouseMove.on(e=>{if(!this._isBeatMouseDown)return;const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),s=this._renderer.boundsLookup?.getBeatAtPos(t,i)??null;if(s&&(this._onBeatMouseMove(e,s),this._isNoteMouseDown)){const a=this._renderer.boundsLookup?.getNoteAtPos(s,t,i);a&&this._onNoteMouseMove(e,a)}}),this.canvasElement.mouseUp.on(e=>{if(!this._isBeatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),s=this._renderer.boundsLookup?.getBeatAtPos(t,i)??null;if(this._onBeatMouseUp(e,s),this._isNoteMouseDown)if(s){const a=this._renderer.boundsLookup?.getNoteAtPos(s,t,i)??null;this._onNoteMouseUp(e,a)}else this._onNoteMouseUp(e,null)}),this._renderer.postRenderFinished.on(()=>{!this._selectionStart||!this._hasCursor||!this.settings.player.enableUserInteraction||this._cursorSelectRange(this._selectionStart,this._selectionEnd)})}_cursorSelectRange(e,t){const i=this._renderer.boundsLookup;if(!i)return;const s=this._selectionWrapper;if(!s||(s.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=i.findBeat(e.beat)),t.bounds||(t.bounds=i.findBeat(t.beat));const a=this._tickCache?.getBeatStart(e.beat)??e.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(t.beat)??t.beat.absolutePlaybackStart)<a){const d=e;e=t,t=d}const c=e.bounds.realBounds.x;let h=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(h=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){const d=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,p=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,g=this.uiFacade.createSelectionElement();g.setBounds(c,e.bounds.barBounds.masterBarBounds.visualBounds.y,p-c,e.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(g);const y=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1,k=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let w=y;w<k;w++){const T=i.staffSystems[w],x=this.uiFacade.createSelectionElement();x.setBounds(d,T.visualBounds.y,p-d,T.visualBounds.h),s.appendChild(x)}const _=this.uiFacade.createSelectionElement();_.setBounds(d,t.bounds.barBounds.masterBarBounds.visualBounds.y,h-d,t.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(_)}else{const d=this.uiFacade.createSelectionElement();d.setBounds(c,e.bounds.barBounds.masterBarBounds.visualBounds.y,h-c,e.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(d)}}scoreLoaded;_onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e),this._setupOrDestroyPlayer()||this.loadMidiForScore())}resize=new ot;_onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}renderStarted=new ot;_onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}renderFinished=new ot;_onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}postRenderFinished=new qi;_onPostRenderFinished(){this._isDestroyed||(this._currentBeat=null,this._cursorUpdateTick(this._previousTick,!1,1,!0,!0),this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}error=new ot;onError(e){this._isDestroyed||(ee.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}get playerReady(){return this._player.readyForPlayback}_onPlayerReady(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerReady",null)}get playerFinished(){return this._player.finished}_onPlayerFinished(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerFinished",null)}get soundFontLoaded(){return this._player.soundFontLoaded}_onSoundFontLoaded(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null)}midiLoad=new ot;_onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}midiLoaded;_onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}get playerStateChanged(){return this._player.stateChanged}_onPlayerStateChanged(e){if(!this._isDestroyed){if(!e.stopped&&e.state===Ts.Paused){const t=this._currentBeat,i=this._tickCache;t&&i&&(this._player.tickPosition=i.getBeatStart(t.beat))}this.uiFacade.triggerEvent(this.container,"playerStateChanged",e)}}get playerPositionChanged(){return this._player.positionChanged}_onPlayerPositionChanged(e){this._isDestroyed||(this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{const t=e.modifiedTempo/e.originalTempo;this._cursorUpdateTick(e.currentTick,!1,t,!1,e.isSeek)}),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}get midiEventsPlayed(){return this._player.midiEventsPlayed}_onMidiEventsPlayed(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e)}get playbackRangeChanged(){return this._player.playbackRangeChanged}_onPlaybackRangeChanged(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e)}settingsUpdated=new qi;_onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}async enumerateOutputDevices(){return await this._player.output.enumerateOutputDevices()}async setOutputDevice(e){await this._player.output.setOutputDevice(e)}async getOutputDevice(){return await this._player.output.getOutputDevice()}async exportAudio(e){if(!this.score)throw new Ht(It.General,"No song loaded");let t;switch(this._actualPlayerMode){case nn.EnabledSynthesizer:t=this.uiFacade.createWorkerAudioExporter(this._player.instance);break;default:t=this.uiFacade.createWorkerAudioExporter(null);break}const i=this.score,s=new Kr,a=new Ua(s),o=new mt(i,this.settings,a);o.applyTranspositionPitches=!1,o.generate();const c=new hv;c.soundFonts=e.soundFonts,c.sampleRate=e.sampleRate,c.useSyncPoints=e.useSyncPoints,c.masterVolume=e.masterVolume,c.metronomeVolume=e.metronomeVolume,c.playbackRange=e.playbackRange;for(const[h,d]of e.trackVolume)if(h<this.score.tracks.length){const p=this.score.tracks[h];c.trackVolume.set(p.playbackInfo.primaryChannel,d),c.trackVolume.set(p.playbackInfo.secondaryChannel,d)}for(const[h,d]of e.trackTranspositionPitches)if(h<this.score.tracks.length){const p=this.score.tracks[h];c.trackTranspositionPitches.set(p.playbackInfo.primaryChannel,d),c.trackTranspositionPitches.set(p.playbackInfo.secondaryChannel,d)}return await t.initialize(c,s,o.syncPoints,o.transpositionPitches),t}}class Nl extends Ht{xhr;constructor(e,t){super(It.General,e),this.xhr=t}}class Yc{static loadAlphaTex(e,t){const i=new Nb;return i.logErrors=!0,i.initFromString(e,t??new Zo),i.readScore()}static loadScoreAsync(e,t,i,s){const a=new XMLHttpRequest;a.open("GET",e,!0,null,null),a.responseType="arraybuffer",a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE){const o=a.response;if(a.status===200||a.status===0&&o)try{const c=a.response,h=new Uint8Array(c),d=Yc.loadScoreFromBytes(h,s);t(d)}catch(c){i(c)}else a.status===0?i(new Nl(`You are offline!!
 Please Check Your Network.`,a)):a.status===404?i(new Nl("Requested URL not found.",a)):a.status===500?i(new Nl("Internel Server Error.",a)):a.statusText==="parsererror"?i(new Nl(`Error.
Parsing JSON Request failed.`,a)):a.statusText==="timeout"?i(new Nl("Request Time out.",a)):i(new Nl(`Unknow Error: ${a.responseText}`,a))}},a.send()}static loadScoreFromBytes(e,t){t||(t=new Zo);const i=ne.buildImporters();ee.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${i.length} importers`);let s=null;const a=ss.fromBuffer(e);for(const o of i){a.reset();try{ee.debug("ScoreLoader",`Importing using importer ${o.name}`),o.init(a,t),s=o.readScore(),ee.debug("ScoreLoader",`Score imported using ${o.name}`);break}catch(c){if(c instanceof is)ee.debug("ScoreLoader",`${o.name} does not support the file`);else throw ee.error("ScoreLoader","Score import failed due to unexpected error: ",c),c}}if(s)return s;throw new is("No compatible importer found for file")}}class u0{mouseEvent;get isLeftMouseButton(){return this.mouseEvent.button===0}getX(e){const t=e.element,s=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-s}getY(e){const t=e.element,s=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-s}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class Jr{static _resizeObserver=new Zc(()=>new ResizeObserver(e=>{for(const t of e){const i=new CustomEvent("resize",{detail:t});t.target.dispatchEvent(i)}}));_resizeListeners=0;get width(){return this.element.offsetWidth}set width(e){this.element.style.width=`${e}px`}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollLeft=e}get scrollTop(){return this.element.scrollTop}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){e>=0?this.element.style.height=`${e}px`:this.element.style.height="100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}element;constructor(e){this.element=e,this.mouseDown={on:i=>{const s=a=>{i(new u0(a))};return this.element.addEventListener("mousedown",s,!0),()=>{this.element.removeEventListener("mousedown",s,!0)}},off:i=>{}},this.mouseUp={on:i=>{const s=a=>{i(new u0(a))};return this.element.addEventListener("mouseup",s,!0),()=>{this.element.removeEventListener("mouseup",s,!0)}},off:i=>{}},this.mouseMove={on:i=>{const s=a=>{i(new u0(a))};return this.element.addEventListener("mousemove",s,!0),()=>{this.element.removeEventListener("mousemove",s,!0)}},off:i=>{}};const t=this;this.resize={on:function(i){return t._resizeListeners===0&&Jr._resizeObserver.value.observe(t.element),t.element.addEventListener("resize",i,!0),t._resizeListeners++,()=>this.off(i)},off:i=>{this.element.removeEventListener("resize",i,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,Jr._resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,Number.NaN,Number.NaN,Number.NaN)}lastBounds=new Os;setBounds(e,t,i,s){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(i)&&(i=this.lastBounds.w),Number.isNaN(s)&&(s=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=s}resize;mouseDown;mouseMove;mouseUp;appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}class WB{_originalFamilies;_families;_isStarted=!1;isFontLoaded=!1;fontLoaded=new ot;constructor(e){this._originalFamilies=e,this._families=e}checkForFontAvailability(){if(ne.isRunningInWorker){this.isFontLoaded=!1;return}if(this._isStarted)return;this._isStarted=!0;let e=0;const t=window.setInterval(()=>{ee.warning("Rendering",`Could not load font '${this._families[0]}' within ${(e+1)*5} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);ee.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);const i=o=>{this._families.length>1?(ee.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,o),this._families.shift(),window.setTimeout(()=>{a()},0)):(ee.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,o),window.clearInterval(t))},s=o=>{ee.debug("Font",`[${o}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(t),this.fontLoaded.trigger(this._families[0])},a=async()=>{for(const o of this._families)if(await this._isFontAvailable(o,!1)){s(o);return}try{await document.fonts.load(`1em ${this._families[0]}`)}catch(o){i(o)}return ee.debug("Font",`[${this._families[0]}] Font API signaled loaded`),await this._isFontAvailable(this._families[0],!0)?s(this._families[0]):i("Font not available"),!0};document.fonts.ready.then(()=>{a()})}_isFontAvailable(e,t){return new Promise(i=>{const s=`1em ${e}`;if(document.fonts.check(s))i(!0);else if(t){ee.debug("Font",`Font ${e} not available, creating test element to trigger load`);const a=document.createElement("div");a.style.font=s,a.style.opacity="0",a.style.position="absolute",a.style.top="0",a.style.left="0",a.innerText=`Trigger ${e} load`,document.body.appendChild(a),setTimeout(()=>{document.body.removeChild(a),document.fonts.check(s)?i(!0):i(!1)},200)}else i(!1)})}}class yv extends Ga{_audioNode=null;_circularBuffer;_bufferCount=0;_requestedBufferCount=0;open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/Ga.BufferSize),this._circularBuffer=new Lb(Ga.BufferSize*this._bufferCount),this.onReady()}play(){super.play();const e=this.context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this._generateSound.bind(this),this._circularBuffer.clear(),this._requestBuffers(),this.source=e.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=!0,this.source.connect(this._audioNode,0,0),this.source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}_requestBuffers(){const e=this._bufferCount/2|0,t=e*Ga.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*Ga.BufferSize<t){for(let s=0;s<e;s++)this.onSampleRequest();this._requestedBufferCount+=e}}_outputBuffer=new Float32Array(0);_generateSound(e){const t=e.outputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(1),s=t.length+i.length;let a=this._outputBuffer;a.length!==s&&(a=new Float32Array(s),this._outputBuffer=a);const o=this._circularBuffer.read(a,0,Math.min(a.length,this._circularBuffer.count));let c=0;const h=Math.min(t.length,o);for(let d=0;d<h;d++)t[d]=a[c++],i[d]=a[c++];if(o<t.length)for(let d=o;d<t.length;d++)t[d]=0,i[d]=0;this.onSamplesPlayed(o/Xe.AudioChannels),this._requestBuffers()}}class $f{_synth;_output;_workerIsReadyForPlayback=!1;_workerIsReady=!1;_outputIsReady=!1;_state=Ts.Paused;_masterVolume=0;_metronomeVolume=0;_countInVolume=0;_playbackSpeed=0;_isLooping=!1;_playbackRange=null;_midiEventsPlayedFilter=[];_loadedMidiInfo;_currentPosition=new fr(0,0,0,0,!1,120,120);get output(){return this._output}get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return ee.logLevel}get worker(){return this._synth}set logLevel(e){ee.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,Xe.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,Xe.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,Xe.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:ne.prepareForPostMessage(e)})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=ce.clamp(e,Xe.MinPlaybackSpeed,Xe.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get loadedMidiInfo(){return this.loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._currentPosition.currentTick}set tickPosition(e){e<0&&(e=0),this._currentPosition=new fr(this._currentPosition.currentTime,this._currentPosition.endTime,e,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._currentPosition.currentTime}set timePosition(e){e<0&&(e=0),this._currentPosition=new fr(e,this._currentPosition.endTime,this._currentPosition.currentTick,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:ne.prepareForPostMessage(e)})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=Ts.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this._onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=ne.createWebWorker(t)}catch(i){ee.error("AlphaSynth",`Failed to create WebWorker: ${i}`)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:ts.midiFileToJsObject(ne.prepareForPostMessage(e))})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:ne.prepareForPostMessage(e),append:t})}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:ts.midiFileToJsObject(ne.prepareForPostMessage(e))})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(ne.prepareForPostMessage(e).entries()))})}setChannelTranspositionPitch(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:e,semitones:t})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,Xe.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this._checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this._checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._currentPosition=new fr(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.positionChanged.trigger(this._currentPosition);break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new Fb(t.events.map(ts.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new Rl(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new Hh(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this._checkReadyForPlayback(),this._loadedMidiInfo=new fr(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo);break;case"alphaSynth.midiLoadFailed":this._checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples();break}}_checkReady(){this.isReady&&this.ready.trigger()}_checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}ready=new qi;readyForPlayback=new qi;finished=new qi;soundFontLoaded=new qi;soundFontLoadFailed=new ot;midiLoaded=new ot;midiLoadFailed=new ot;stateChanged=new ot;positionChanged=new ot;midiEventsPlayed=new ot;playbackRangeChanged=new ot;onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}_onOutputReady(){this._outputIsReady=!0,this._checkReady()}loadBackingTrack(e){}updateSyncPoints(e){}}class $R{_api;_worker;_width=0;boundsLookup=null;constructor(e,t){this._api=e;try{this._worker=ne.createWebWorker(t)}catch(i){ee.error("Rendering",`Failed to create WebWorker: ${i}`);return}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this._serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this._handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this._serializeSettingsForWorker(e)})}_serializeSettingsForWorker(e){const t=ts.settingsToJsObject(ne.prepareForPostMessage(e));return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}_handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=Mn.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error);break}}renderScore(e,t){const i=e==null?null:ts.scoreToJsObject(ne.prepareForPostMessage(e));this._worker.postMessage({cmd:"alphaTab.renderScore",score:i,trackIndexes:ne.prepareForPostMessage(t),fontSizes:Gn.fontSizeLookupTables})}preRender=new ot;partialRenderFinished=new ot;partialLayoutFinished=new ot;renderFinished=new ot;postRenderFinished=new qi;error=new ot}class XR{cursorWrapper;barCursor;beatCursor;selectionWrapper;constructor(e,t,i,s){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=i,this.selectionWrapper=s}}class qR extends Jr{_xscale;_yscale;constructor(e,t,i){super(e),this._xscale=t,this._yscale=i}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=`${e*this._xscale}px`}get height(){return this.element.offsetHeight/this._yscale}set height(e){e>=0?this.element.style.height=`${e*this._yscale}px`:this.element.style.height="100%"}setBounds(e,t,i,s){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(i)?i=this.lastBounds.w:i=i/this._xscale,Number.isNaN(s)?s=this.lastBounds.h:s=s/this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=s}}class JR{sampleRate=44100;audioElement;_updateInterval=0;get backingTrackDuration(){const e=this.audioElement.duration??0;return Number.isFinite(e)?e*1e3:0}get playbackRate(){return this.audioElement.playbackRate}set playbackRate(e){this.audioElement.playbackRate=e}get masterVolume(){return this.audioElement.volume}set masterVolume(e){this.audioElement.volume=e}seekTo(e){this.audioElement.currentTime=e/1e3}loadBackingTrack(e){this.audioElement?.src&&URL.revokeObjectURL(this.audioElement.src);const t=new Blob([e.rawAudioFile]),i=this.audioElement.playbackRate;this.audioElement.src=URL.createObjectURL(t),this.audioElement.playbackRate=i}open(e){const t=document.createElement("audio");t.style.display="none",document.body.appendChild(t),t.addEventListener("seeked",()=>{this._updatePosition()}),t.addEventListener("timeupdate",()=>{this._updatePosition()}),this.audioElement=t,this.ready.trigger()}_updatePosition(){const e=this.audioElement.currentTime*1e3;this.timeUpdate.trigger(e)}play(){this.audioElement.play(),this._updateInterval=window.setInterval(()=>{this._updatePosition()},50)}destroy(){const e=this.audioElement;e&&document.body.removeChild(e)}pause(){this.audioElement.pause(),window.clearInterval(this._updateInterval)}addSamples(e){}resetSamples(){}activate(){}ready=new qi;samplesPlayed=new ot;timeUpdate=new ot;sampleRequest=new qi;async enumerateOutputDevices(){return Bn.enumerateOutputDevices()}async setOutputDevice(e){await Bn.checkSinkIdSupport()&&(e?await this.audioElement.setSinkId(e.deviceId):await this.audioElement.setSinkId(""))}async getOutputDevice(){if(!await Bn.checkSinkIdSupport())return null;const e=this.audioElement.sinkId;if(typeof e!="string"||e===""||e==="default")return null;let t=Bn.findKnownDevice(e);if(t)return t;const i=await this.enumerateOutputDevices();return t=i.find(s=>s.deviceId===e),t||(ee.warning("WebAudio","Could not find output device in device list",e,i),null)}}class Hb{static _nextExporterId=1;_worker;_unsubscribe;_exporterId;_ownsWorker;_promise=null;constructor(e,t){this._exporterId=Hb._nextExporterId++,this._worker=e,this._ownsWorker=t}async initialize(e,t,i,s){const a=this.handleWorkerMessage.bind(this);this._worker.worker.addEventListener("message",a,!1),this._unsubscribe=()=>{this._worker.worker.removeEventListener("message",a,!1)},this._promise=Promise.withResolvers(),this._worker.worker.postMessage({cmd:"alphaSynth.exporter.initialize",exporterId:this._exporterId,options:ne.prepareForPostMessage(e),midi:ts.midiFileToJsObject(ne.prepareForPostMessage(t)),syncPoints:ne.prepareForPostMessage(i),transpositionPitches:ne.prepareForPostMessage(s)}),await this._promise.promise}handleWorkerMessage(e){const t=e.data;if(t.exporterId!==this._exporterId)return;switch(t.cmd){case"alphaSynth.exporter.initialized":this._promise?.resolve(null),this._promise=null;break;case"alphaSynth.exporter.error":this._promise?.reject(t.error),this._promise=null;break;case"alphaSynth.exporter.rendered":this._promise?.resolve(t.chunk),this._promise=null;break;case"alphaSynth.destroyed":this._promise?.reject(new Ht(It.General,"Worker was destroyed")),this._promise=null;break}}async render(e){if(this._promise)throw new Ht(It.General,"There is already an ongoing operation, wait for initialize to complete before requesting render");return this._promise=Promise.withResolvers(),this._worker.worker.postMessage({cmd:"alphaSynth.exporter.render",exporterId:this._exporterId,milliseconds:e}),await this._promise.promise}destroy(){this._worker.worker.postMessage({cmd:"alphaSynth.exporter.destroy",exporterId:this._exporterId}),this._unsubscribe(),this._ownsWorker&&this._worker.destroy()}[Symbol.dispose](){this.destroy()}}var or;(function(n){n[n.LayoutDone=0]="LayoutDone",n[n.RenderRequested=1]="RenderRequested",n[n.RenderDone=2]="RenderDone",n[n.Detached=3]="Detached"})(or||(or={}));class Cl{_fontCheckers=new Map;_api;_contents=null;_file=null;_totalResultCount=0;_initialTrackIndexes=null;_intersectionObserver;_barToElementLookup=new Map;_resultIdToElementLookup=new Map;_webFont;rootContainerBecameVisible=new qi;canRenderChanged=new qi;get resizeThrottle(){return 10}rootContainer;areWorkersSupported;get canRender(){return this._areAllFontsLoaded()}_areAllFontsLoaded(){let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return e?!1:(ee.debug("Font",`All fonts loaded: ${this._fontCheckers.size}`),!0)}_onFontLoaded(e){Gn.generateFontLookup(e),this._areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(ne.webPlatform!==Tn.Browser&&ne.webPlatform!==Tn.BrowserModule)throw new Ht(It.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new Jr(e),this.areWorkersSupported="Worker"in window,this._intersectionObserver=new IntersectionObserver(this._onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}_onElementVisibilityChanged(e){for(const t of e){const i=t.target;if(i===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in i&&this._api.settings.core.enableLazyLoading){const s=i;t.isIntersecting?s.renderedResultId!==s.layoutResultId?this._resultIdToElementLookup.has(s.layoutResultId)?s.resultState!==or.RenderRequested&&(s.resultState=or.RenderRequested,this._api.renderer.renderResult(s.layoutResultId)):i.replaceChildren():s.resultState===or.Detached&&(i.replaceChildren(...s.renderedResult),s.resultState=or.RenderDone):s.resultState===or.RenderDone&&(s.resultState=or.Detached,s.replaceChildren())}}}createWorkerRenderer(){return new $R(this._api,this._api.settings)}initialize(e,t){this._api=e;let i;t instanceof Zo?i=t:i=ts.jsObjectToSettings(t);const s=this._getDataAttributes();Ko.fromJson(i,s),i.notation.notationMode===Ps.SongBook&&i.setSongBookModeSettings(),e.settings=i,this._setupFontCheckers(i),this._initialTrackIndexes=this.parseTracks(i.core.tracks),this._contents="";const a=e.container;i.core.tex&&(this._contents=a.element.innerHTML,a.element.innerHTML=""),this._createStyleElements(i),this._file=i.core.file}_setupFontCheckers(e){this._registerFontChecker(e.display.resources.copyrightFont),this._registerFontChecker(e.display.resources.effectFont),this._registerFontChecker(e.display.resources.graceFont),this._registerFontChecker(e.display.resources.markerFont),this._registerFontChecker(e.display.resources.tablatureFont),this._registerFontChecker(e.display.resources.titleFont),this._registerFontChecker(e.display.resources.wordsFont),this._registerFontChecker(e.display.resources.barNumberFont),this._registerFontChecker(e.display.resources.fretboardNumberFont),this._registerFontChecker(e.display.resources.subTitleFont)}_registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){const t=new WB(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this._onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML="";const e=this._webFont;e.usages--,e.usages<=0&&(e.element.remove(),Cl._registeredWebFonts.delete(e.hash))}createCanvasElement(){const e=document.createElement("div");return e.classList.add("at-surface",`at${this._webFont.fontSuffix}`),e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new Jr(e)}triggerEvent(e,t,i=null,s){const a=e.element;t=`alphaTab.${t}`;const o=document.createEvent("CustomEvent"),c=s?s.mouseEvent:null;if(o.initCustomEvent(t,!1,!1,i),c&&(o.originalEvent=c),a.dispatchEvent(o),window&&"jQuery"in window){const h=window.jQuery,d=[];d.push(i),c&&d.push(c),h(a).trigger(t,d)}}load(e,t,i){if(e instanceof Qa)return t(e),!0;if(e instanceof ArrayBuffer){const s=new Uint8Array(e);return t(Yc.loadScoreFromBytes(s,this._api.settings)),!0}return e instanceof Uint8Array?(t(Yc.loadScoreFromBytes(e,this._api.settings)),!0):typeof e=="string"?(Yc.loadScoreAsync(e,t,i,this._api.settings),!0):!1}loadSoundFont(e,t){return this._api.player?e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),!0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),!0):typeof e=="string"?(this._api.loadSoundFontFromUrl(e,t),!0):!1:!1}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=this.rootContainer.width|0,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&Yc.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}_createStyleElements(e){const t=this._api.container.element.ownerDocument;Cl.createSharedStyleElement(t);const i=e.core.smuflFontSources??vv.buildDefaultSmuflFontSources(e.core.fontDirectory),s=Cl._cyrb53(i.values()),a=Cl._registeredWebFonts;if(a.has(s)){const k=a.get(s);k.usages++,k.checker.fontLoaded.on(this._onFontLoaded.bind(this)),this._webFont=k;return}const o=a.size===0?"":String(a.size),c=`alphaTab${o}`,h=Array.from(i.entries()).map(k=>`url(${JSON.stringify(k[1])}) format('${Cl._cssFormat(k[0])}')`).join(","),d=`
            @font-face {
                font-display: block;
                font-family: '${c}';
                src: ${h};
                font-weight: normal;
                font-style: normal;
            }
            .at-surface.at${o} .at {
                font-family: '${c}';
                speak: none;
                font-style: normal;
                font-weight: normal;
                font-variant: normal;
                text-transform: none;
                line-height: 1;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                font-size: ${e.display.resources.engravingSettings.musicFontSize}px;
                overflow: visible !important;
            }`,p=t.createElement("style");p.id=`alphaTabStyle${o}`,p.innerHTML=d,t.getElementsByTagName("head").item(0).appendChild(p);const g=new WB([c]);g.fontLoaded.on(this._onFontLoaded.bind(this)),this._fontCheckers.set(c,g),g.checkForFontAvailability(),e.display.resources.smuflFontFamilyName=c;const y={hash:s,element:p,fontSuffix:o,usages:1,checker:g};a.set(s,y),this._webFont=y}static _cssFormat(e){switch(e){case Ea.EmbeddedOpenType:return"embedded-opentype";case Ea.Woff:return"woff";case Ea.Woff2:return"woff2";case Ea.OpenType:return"opentype";case Ea.TrueType:return"truetype";case Ea.Svg:return"svg"}}static _registeredWebFonts=new Map;static _cyrb53(e,t=0){let i=3735928559^t,s=1103547991^t;for(const a of e)for(let o=0;o<a.length;o++){const c=a.charCodeAt(o);i=Math.imul(i^c,2654435761),s=Math.imul(s^c,1597334677)}return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&s)+(i>>>0)}static createSharedStyleElement(e){let t=e.getElementById("alphaTabStyle");if(!t){t=document.createElement("style"),t.id="alphaTabStyleShared";const i=`
                .at-surface * {
                    cursor: default;
                    vertical-align: top;
                    overflow: visible;
                }
                .at-surface-svg text {
                    dominant-baseline: alphabetic;
                    white-space:pre;
                }`;t.innerHTML=i,document.getElementsByTagName("head").item(0).appendChild(t)}}parseTracks(e){if(!e)return[];const t=[];if(typeof e=="string")try{if(e==="all")return[-1];e=JSON.parse(e)}catch{e=[0]}if(typeof e=="number")t.push(e);else if("length"in e){const i=e.length,s=e;for(let a=0;a<i;a++){const o=s[a];let c=0;typeof o=="number"?c=o:"index"in o?c=o.index:c=Number.parseInt(o.toString(),10),(c>=0||c===-1)&&t.push(c)}}else"index"in e&&t.push(e.index);return t}_getDataAttributes(){const e=new Map,t=this._api.container.element;if(t.dataset)for(const i of Object.keys(t.dataset)){let s=t.dataset[i];try{s=JSON.parse(s)}catch{s===""&&(s=null)}e.set(i,s)}else for(let i=0;i<t.attributes.length;i++){const s=t.attributes.item(i),a=s.nodeName;if(a.startsWith("data-")){const o=a.substr(5).split("-");let c=o[0];for(let d=1;d<o.length;d++)c+=o[d].substr(0,1).toUpperCase()+o[d].substr(1);let h=s.nodeValue;try{h=JSON.parse(h)}catch{h===""&&(h=null)}e.set(c,h)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),i=e.renderResult;typeof i=="string"?t.innerHTML=i:"nodeType"in i&&t.replaceChildren(i),t.resultState=or.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let i;this._totalResultCount<t.childElementCount?i=t.childNodes.item(this._totalResultCount):(i=document.createElement("div"),t.appendChild(i)),i.style.zIndex="1",i.style.position="absolute",i.style.left=`${e.x}px`,i.style.top=`${e.y}px`,i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.display="inline-block",i.layoutResultId=e.id,i.resultState=or.LayoutDone,i.renderedResultId=void 0,i.renderedResult=void 0,this._resultIdToElementLookup.set(e.id,i);for(let s=e.firstMasterBarIndex;s<=e.lastMasterBarIndex;s++)s>=0&&this._barToElementLookup.set(s,i);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(i),this._intersectionObserver.observe(i)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null;const t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===zh.WebAudioAudioWorklets?(ee.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new $f(new Xx(this._api.settings),this._api.settings)):t&&(ee.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new $f(new yv,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):ee.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}createWorkerAudioExporter(e){const t=e===null||!(e instanceof $f);return t&&(e=this.createWorkerPlayer()),new Hb(e,t)}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}_highlightedElements=[];highlightElements(e,t){const i=this._barToElementLookup.get(t);if(i){const s=i.getElementsByClassName(e);for(let a=0;a<s.length;a++)s.item(a).classList.add("at-highlight"),this._highlightedElements.push(s.item(a))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){const e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){const e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");const i=document.createElement("div");i.classList.add("at-selection");const s=this.createScalingElement(),a=this.createScalingElement(),o=s.element;o.classList.add("at-cursor-bar");const c=a.element;return c.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",i.style.position="absolute",o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.willChange="transform",s.width=1,s.height=1,s.setBounds(0,0,1,1),c.style.position="absolute",c.style.transition="all 0s linear",c.style.left="0",c.style.top="0",c.style.willChange="transform",a.width=3,a.height=1,a.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(i),t.appendChild(o),t.appendChild(c),new XR(new Jr(t),s,a,new Jr(i))}getOffset(e,t){const i=t.element,s=i.getBoundingClientRect();let a=s.top+i.ownerDocument.defaultView.pageYOffset,o=s.left+i.ownerDocument.defaultView.pageXOffset;if(e){const h=e.element,d=h.nodeName.toLowerCase();if(d!=="html"&&d!=="body"){const p=this.getOffset(null,e);a=a+h.scrollTop-p.y,o=o+h.scrollLeft-p.x}}const c=new Os;return c.x=o,c.y=a,c.w=s.width,c.h=s.height,c}_scrollContainer=null;getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e=typeof this._api.settings.player.scrollElement=="string"?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement;const t=e.nodeName.toLowerCase();return(t==="html"||t==="body")&&("scrollingElement"in document?e=document.scrollingElement:navigator.userAgent.indexOf("WebKit")!==-1?e=document.body:e=document.documentElement),this._scrollContainer=new Jr(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new qR(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,i){this._internalScrollToY(e.element,t,i)}scrollToX(e,t,i){this._internalScrollToX(e.element,t,i)}_internalScrollToY(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{const s=e.scrollTop,a=t-s;let o=0;const c=h=>{o===0&&(o=h);const d=h-o,p=Math.min(d/i,1);e.scrollTop=s+a*p|0,d<i&&window.requestAnimationFrame(c)};window.requestAnimationFrame(c)}}_internalScrollToX(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{const s=e.scrollLeft,a=t-s;let o=0;const c=h=>{o===0&&(o=h);const d=h-o,p=Math.min(d/i,1);e.scrollLeft=s+a*p|0,d<i&&window.requestAnimationFrame(c)};window.requestAnimationFrame(c)}}createBackingTrackPlayer(){return new gv(new JR,this._api.settings.player.bufferTimeInMilliseconds)}}class QR{loaded;total;constructor(e,t){this.loaded=e,this.total=t}}class Sg extends YR{constructor(e,t){super(new Cl(e),t)}tex(e,t){const i=this.uiFacade;super.tex(e,i.parseTracks(t))}print(e,t=null){const i=window.open("","","width=0,height=0"),s=i.document.createElement("div");e?s.style.width=e:this.settings.display.layoutMode===jr.Horizontal?s.style.width="297mm":s.style.width="210mm",i.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);const a=this.score;a&&(a.artist&&a.title?i.document.title=`${a.title} - ${a.artist}`:a.title&&(i.document.title=`${a.title}`)),i.document.body.appendChild(s);const o=typeof window.screenLeft<"u"?window.screenLeft:window.left,c=typeof window.screenTop<"u"?window.screenTop:window.top,h="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,d="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,p=s.offsetWidth+50,g=window.innerHeight,y=(h/2|0)-(p/2|0)+o,k=(d/2|0)-(g/2|0)+c;i.resizeTo(p,g),i.moveTo(y,k),i.focus();const _=ts.jsObjectToSettings(ts.settingsToJsObject(this.settings));_.core.enableLazyLoading=!1,_.core.useWorkers=!0,_.core.file=null,_.core.tracks=null,_.player.enableCursor=!1,_.player.playerMode=nn.Disabled,_.player.enableElementHighlighting=!1,_.player.enableUserInteraction=!1,_.player.soundFont=null,_.display.scale=.8,_.display.stretchForce=.8,Ko.fromJson(_,t);const w=new Sg(s,_);i.onunload=()=>{w.destroy()},w.renderer.postRenderFinished.on(()=>{i.print()}),w.renderTracks(this.tracks)}downloadMidi(e=tu.SingleTrackMultiChannel){if(!this.score)return;const t=new Kr;t.format=e;const i=new Ua(t,!0);new mt(this.score,this.settings,i).generate();const a=t.toBinary(),o=this.score.title?`${this.score.title}.mid`:"File.mid",c=document.createElement("a");c.download=o;const h=new Blob([a],{type:"audio/midi"}),d=URL.createObjectURL(h);c.href=d,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)}changeTrackMute(e,t){const i=this._trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(i,t)}changeTrackSolo(e,t){const i=this._trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(i,t)}changeTrackVolume(e,t){const i=this._trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(i,t)}_trackIndexesToTracks(e){if(!this.score)return[];const t=[];if(e.length===1&&e[0]===-1)for(const i of this.score.tracks)t.push(i);else for(const i of e)i>=0&&i<this.score.tracks.length&&t.push(this.score.tracks[i]);return t}soundFontLoad=new ot;loadSoundFontFromUrl(e,t){const i=this.player;if(!i)return;ee.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);const s=new XMLHttpRequest;s.open("GET",e,!0,null,null),s.responseType="arraybuffer",s.onload=a=>{const o=new Uint8Array(s.response);this.loadSoundFont(o,t)},s.onerror=a=>{ee.error("AlphaSynth",`Loading failed: ${a.message}`),i.soundFontLoadFailed.trigger(new Nl(a.message,s))},s.onprogress=a=>{ee.debug("AlphaSynth",`Soundfont downloading: ${a.loaded}/${a.total} bytes`);const o=new QR(a.loaded,a.total);this.soundFontLoad.trigger(o),this.uiFacade.triggerEvent(this.container,"soundFontLoad",o)},s.send()}}class VB{exec(e,t,i){if(typeof t!="string"&&(i=[t],t="init"),t.charCodeAt(0)===95||t==="exec")return null;const s=new jQuery(e),a=s.data("alphaTab");if(t==="destroy"&&!a)return null;if(t!=="init"&&!a)throw new Error("alphaTab not initialized");const o=this[t];if(o){const c=[s,a].concat(i);return o.apply(this,c)}return ee.error("Api",`Method '${t}' does not exist on jQuery.alphaTab`),null}init(e,t,i){if(!t){t=new Sg(e[0],i),e.data("alphaTab",t);for(const s of this._initListeners)s(e,t,i)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,i,s){t.print(i,s)}load(e,t,i,s){return t.load(i,s)}render(e,t){t.render()}renderScore(e,t,i,s){t.renderScore(i,s)}renderTracks(e,t,i){t.renderTracks(i)}invalidate(e,t){t.render()}tex(e,t,i,s){t.tex(i,s)}muteTrack(e,t,i,s){t.changeTrackMute(i,s)}soloTrack(e,t,i,s){t.changeTrackSolo(i,s)}trackVolume(e,t,i,s){t.changeTrackVolume(i,s)}loadSoundFont(e,t,i,s){t.loadSoundFont(i,s)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,i){return typeof i=="number"&&(t.masterVolume=i),t.masterVolume}metronomeVolume(e,t,i){return typeof i=="number"&&(t.metronomeVolume=i),t.metronomeVolume}countInVolume(e,t,i){return typeof i=="number"&&(t.countInVolume=i),t.countInVolume}midiEventsPlayedFilter(e,t,i){return Array.isArray(i)&&(t.midiEventsPlayedFilter=i),t.midiEventsPlayedFilter}playbackSpeed(e,t,i){return typeof i=="number"&&(t.playbackSpeed=i),t.playbackSpeed}tickPosition(e,t,i){return typeof i=="number"&&(t.tickPosition=i),t.tickPosition}timePosition(e,t,i){return typeof i=="number"&&(t.timePosition=i),t.timePosition}loop(e,t,i){return typeof i=="boolean"&&(t.isLooping=i),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_initListeners=[];_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}function KR(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,s;if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose]}if(typeof i!="function")throw new TypeError("Object not disposable.");s&&(i=function(){try{s.call(this)}catch(a){return Promise.reject(a)}}),n.stack.push({value:e,dispose:i,async:t})}return e}var ZR=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var i=new Error(t);return i.name="SuppressedError",i.error=n,i.suppressed=e,i};function jR(n){function e(a){n.error=n.hasError?new ZR(a,n.error,"An error was suppressed during disposal."):a,n.hasError=!0}var t,i=0;function s(){for(;t=n.stack.pop();)try{if(!t.async&&i===1)return i=0,n.stack.push(t),Promise.resolve().then(s);if(t.dispose){var a=t.dispose.call(t.value);if(t.async)return i|=2,Promise.resolve(a).then(s,function(o){return e(o),s()})}else i|=1}catch(o){e(o)}if(i===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return s()}class ki{static _alphaSkia;static _defaultMusicTextStyle=null;static enable(e,t){ki._alphaSkia=t,ki.initializeMusicFont(ki._alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){ki._defaultMusicTextStyle=new ki._alphaSkia.AlphaSkiaTextStyle([e.familyName],e.weight,e.isItalic)}static registerFont(e,t){const i=ki._alphaSkia.AlphaSkiaTypeface.register(e.buffer);return t||(t=nt.withFamilyList([i.familyName],12,i.isItalic?pi.Italic:pi.Plain,i.weight>400?fn.Bold:fn.Regular)),t}_canvas;_color=new Tt(0,0,0,0);_lineWidth=0;_textStyle=null;_scale=1;_textStyles=new Map;_font=new nt("Arial",10,pi.Plain);_musicTextStyle=null;settings;get font(){return this._font}set font(e){if(this._font===e)return;this._font=e;const t=this._textStyleKey(e);if(this._textStyles.has(t))this._textStyle=this._textStyles.get(t);else{const i=new ki._alphaSkia.AlphaSkiaTextStyle(e.families,e.weight===fn.Bold?700:400,e.isItalic);this._textStyles.set(t,i),this._textStyle=i}}_textStyleKey(e){return[...e.families,e.weight.toString(),e.isItalic?"italic":"upright"].join("_")}constructor(){this._canvas=new ki._alphaSkia.AlphaSkiaCanvas,this.color=new Tt(0,0,0,255)}destroy(){this._canvas[Symbol.dispose]();for(const e of this._textStyles.values())e[Symbol.dispose]()}onRenderFinished(){return null}beginRender(e,t){this._scale=this.settings.display.scale,this._canvas.beginRender(e,t,ne.highDpiFactor);const i=this.settings.display.resources.smuflFontFamilyName;i&&i!==ki._defaultMusicTextStyle.familyNames[0]?this._textStyles.has(i)?this._musicTextStyle=this._textStyles.get(i):(this._musicTextStyle=new ki._alphaSkia.AlphaSkiaTextStyle([i],ki._defaultMusicTextStyle.weight,ki._defaultMusicTextStyle.isItalic),this._textStyles.set(i,this._musicTextStyle)):this._musicTextStyle=ki._defaultMusicTextStyle}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=ki._alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,t,i,s){i>0&&this._canvas.fillRect(e*this._scale,t*this._scale,i*this._scale,s*this._scale)}strokeRect(e,t,i,s){const a=this.lineWidth%2===0?0:.5;this._canvas.strokeRect(e*this._scale+a,t*this._scale+a,i*this._scale,s*this._scale)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,t){this._canvas.moveTo(e*this._scale,t*this._scale)}lineTo(e,t){this._canvas.lineTo(e*this._scale,t*this._scale)}quadraticCurveTo(e,t,i,s){this._canvas.quadraticCurveTo(e*this._scale,t*this._scale,i*this._scale,s*this._scale)}bezierCurveTo(e,t,i,s,a,o){this._canvas.bezierCurveTo(e*this._scale,t*this._scale,i*this._scale,s*this._scale,a*this._scale,o*this._scale)}fillCircle(e,t,i){this._canvas.fillCircle(e*this._scale,t*this._scale,i*this._scale)}strokeCircle(e,t,i){this._canvas.strokeCircle(e*this._scale,t*this._scale,i*this._scale)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}textAlign=Ce.Left;textBaseline=Wt.Top;beginGroup(e){}endGroup(){}fillText(e,t,i){if(e.length===0)return;let s=ki._alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case Ce.Left:s=ki._alphaSkia.AlphaSkiaTextAlign.Left;break;case Ce.Center:s=ki._alphaSkia.AlphaSkiaTextAlign.Center;break;case Ce.Right:s=ki._alphaSkia.AlphaSkiaTextAlign.Right;break}let a=ki._alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case Wt.Top:a=ki._alphaSkia.AlphaSkiaTextBaseline.Top;break;case Wt.Middle:a=ki._alphaSkia.AlphaSkiaTextBaseline.Middle;break;case Wt.Bottom:a=ki._alphaSkia.AlphaSkiaTextBaseline.Bottom;break;case Wt.Alphabetic:a=ki._alphaSkia.AlphaSkiaTextBaseline.Alphabetic;break}this._canvas.fillText(e,this._textStyle,this._font.size*this._scale,t*this._scale,i*this._scale,s,a)}measureText(e){const t={stack:[],error:void 0,hasError:!1};try{const i=KR(t,this._canvas.measureText(e,this._textStyle,this._font.size,ki._alphaSkia.AlphaSkiaTextAlign.Left,ki._alphaSkia.AlphaSkiaTextBaseline.Alphabetic),!1),[s,a]=this._getTextWidthAndHeight(i,e);return new gg(s,a)}catch(i){t.error=i,t.hasError=!0}finally{jR(t)}}_getTextWidthAndHeight(e,t){let i=e.width;if(t.length>0&&i<1)for(let a=0;a<5&&(i=e.width,!(i>1));a++);const s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;return[i,s]}fillMusicFontSymbol(e,t,i,s,a){s!==S.None&&this._fillMusicFontSymbolText(e,t,i,String.fromCharCode(s),a)}fillMusicFontSymbols(e,t,i,s,a){let o="";for(const c of s)c!==S.None&&(o+=String.fromCharCode(c));this._fillMusicFontSymbolText(e,t,i,o,a)}_fillMusicFontSymbolText(e,t,i,s,a){this._canvas.fillText(s,this._musicTextStyle,this.settings.display.resources.engravingSettings.musicFontSize*this._scale*i,e*this._scale,t*this._scale,a?ki._alphaSkia.AlphaSkiaTextAlign.Center:ki._alphaSkia.AlphaSkiaTextAlign.Left,ki._alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,t,i){this._canvas.beginRotate(e*this._scale,t*this._scale,i)}endRotate(){this._canvas.endRotate()}}class zb{buffer="";_currentPath="";_currentPathIsEmpty=!0;scale=1;color=new Tt(255,255,255,255);lineWidth=1;font=new nt("Arial",10,pi.Plain);textAlign=Ce.Left;textBaseline=Wt.Top;settings;destroy(){}beginRender(e,t){this.scale=this.settings.display.scale,this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${e|0}px" height="${t|0}px" class="at-surface-svg">
`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=Wt.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,i,s){i>0&&(this.buffer+=`<rect x="${e*this.scale}" y="${t*this.scale}" width="${i*this.scale}" height="${s*this.scale}" fill="${this.color.rgba}" />
`)}strokeRect(e,t,i,s){const a=this.lineWidth*this.scale%2===0?0:.5;this.buffer+=`<rect x="${e*this.scale+a}" y="${t*this.scale+a}" width="${i*this.scale}" height="${s*this.scale}" stroke="${this.color.rgba}"`,this.lineWidth!==1&&(this.buffer+=` stroke-width="${this.lineWidth*this.scale}"`),this.buffer+=` fill="transparent" />
`}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e*this.scale},${t*this.scale}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e*this.scale},${t*this.scale}`}quadraticCurveTo(e,t,i,s){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e*this.scale},${t*this.scale},${i*this.scale},${s*this.scale}`}bezierCurveTo(e,t,i,s,a,o){this._currentPathIsEmpty=!1,this._currentPath+=` C${e*this.scale},${t*this.scale},${i*this.scale},${s*this.scale},${a*this.scale},${o*this.scale}`}fillCircle(e,t,i){this._currentPathIsEmpty=!1,e*=this.scale,t*=this.scale,i*=this.scale,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.fill()}strokeCircle(e,t,i){this._currentPathIsEmpty=!1,e*=this.scale,t*=this.scale,i*=this.scale,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;(this.lineWidth!==1||this.scale!==1)&&(e+=` stroke-width="${this.lineWidth*this.scale}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,i){if(e==="")return;let s=`<text x="${t*this.scale}" y="${i*this.scale}" style='stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}'`;this.color.rgba!=="#000000"&&(s+=` fill="${this.color.rgba}"`),this.textAlign!==Ce.Left&&(s+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),s+=`>${zb._escapeText(e)}</text>`,this.buffer+=s}static _escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case Ce.Left:return"start";case Ce.Center:return"middle";case Ce.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case Wt.Top:return"dominant-baseline: hanging";case Wt.Bottom:return"dominant-baseline: ideographic";case Wt.Alphabetic:return"";case Wt.Middle:return"dominant-baseline: middle";default:return""}}measureText(e){return e?Gn.measureString(e,this.font.families,this.font.size,this.font.style,this.font.weight):new gg(0,0)}onRenderFinished(){return null}beginRotate(e,t,i){this.buffer+=`<g transform="translate(${e*this.scale} ,${t*this.scale}) rotate( ${i})">`}endRotate(){this.buffer+="</g>"}}class e3 extends zb{fillMusicFontSymbol(e,t,i,s,a){s!==S.None&&this._fillMusicFontSymbolText(e,t,i,`&#${s};`,a)}fillMusicFontSymbols(e,t,i,s,a){let o="";for(const c of s)c!==S.None&&(o+=`&#${c};`);this._fillMusicFontSymbolText(e,t,i,o,a)}_fillMusicFontSymbolText(e,t,i,s,a){e*=this.scale,t*=this.scale,this.buffer+=`<g transform="translate(${e} ${t})" class="at" ><text`;const o=this.scale*i;o!==1?this.buffer+=` style="font-size: ${o*100}%; stroke:none"`:this.buffer+=' style="stroke:none"',this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),a&&(this.buffer+=` text-anchor="${this.getSvgTextAlignment(Ce.Center)}"`),this.buffer+=`>${s}</text></g>`}}class nd{isInsideBracket=!0;isRelevantForBoundsLookup=!0;hideOnMultiTrack=!1;hideOnPercussionTrack=!1;canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var lt;(function(n){n[n.PreNotes=0]="PreNotes",n[n.OnNotes=1]="OnNotes",n[n.MiddleNotes=2]="MiddleNotes",n[n.Stem=3]="Stem",n[n.PostNotes=4]="PostNotes",n[n.EndBeat=5]="EndBeat"})(lt||(lt={}));class ja extends Vi{glyphs=null;get isEmpty(){return!this.glyphs||this.glyphs.length===0}getBoundingBoxTop(){let e=0;const t=this.glyphs;if(t)for(const i of t){const s=i.getBoundingBoxTop();s<e&&(e=s)}return e}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}let e=0,t=0;for(let i=0,s=this.glyphs.length;i<s;i++){const a=this.glyphs[i];a.renderer=this.renderer,a.doLayout(),e=Math.max(e,a.width),t=Math.max(t,a.y+a.height)}this.width=e,this.height=t}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,i){const s=this.glyphs;if(!(!s||s.length===0))for(const a of s)a.paint(e+this.x,t+this.y,i)}}class El extends ja{gap=0;constructor(){super(0,0),this.glyphs=[]}doLayout(){}addGlyph(e){e.x=this.width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width+this.gap,super.addGlyph(e)}}class ht{static score(e,t,i,s=!1){if(!i.style&&!s)return;const a=ht._scoreDefaultColor(e.settings.display.resources,t);return new Rc(e,t,i.style,a)}static scoreColor(e,t,i){const s=ht._scoreDefaultColor(e,t);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??s}static _scoreDefaultColor(e,t){return e.mainGlyphColor}static bar(e,t,i,s=!1){if(!i.style&&!s)return;let a=e.settings.display.resources.mainGlyphColor;switch(t){case Bt.StandardNotationRepeats:case Bt.GuitarTabsRepeats:case Bt.SlashRepeats:case Bt.NumberedRepeats:case Bt.StandardNotationClef:case Bt.GuitarTabsClef:case Bt.StandardNotationKeySignature:case Bt.NumberedKeySignature:case Bt.StandardNotationTimeSignature:case Bt.GuitarTabsTimeSignature:case Bt.SlashTimeSignature:case Bt.NumberedTimeSignature:break;case Bt.StandardNotationBarLines:case Bt.GuitarTabsBarLines:case Bt.SlashBarLines:case Bt.NumberedBarLines:a=e.settings.display.resources.barSeparatorColor;break;case Bt.StandardNotationBarNumber:case Bt.SlashBarNumber:case Bt.NumberedBarNumber:case Bt.GuitarTabsBarNumber:a=e.settings.display.resources.barNumberColor;break;case Bt.StandardNotationStaffLine:case Bt.GuitarTabsStaffLine:case Bt.SlashStaffLine:case Bt.NumberedStaffLine:a=e.settings.display.resources.staffLineColor;break}return new Rc(e,t,i.style,a)}static voice(e,t,i,s=!1){if(!i.style&&!s)return;const a=i.index===0?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor;return new Rc(e,t,i.style,a)}static trackColor(e,t,i){const s=ht._trackDefaultColor(e,t);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??s}static _trackDefaultColor(e,t){let i=e.mainGlyphColor;switch(t){case Xa.TrackName:case Xa.SystemSeparator:case Xa.StringTuning:break;case Xa.BracesAndBrackets:i=e.barSeparatorColor;break}return i}static track(e,t,i,s=!1){if(!i.style&&!s)return;const a=ht._trackDefaultColor(e.settings.display.resources,t);return new Rc(e,t,i.style,a)}static beatColor(e,t,i){const s=ht._beatDefaultColor(e,t,i);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??s}static _beatDefaultColor(e,t,i){return i.voice.index===0?e.mainGlyphColor:e.secondaryGlyphColor}static beat(e,t,i,s=!1){if(!i.style&&!s)return;const a=ht._beatDefaultColor(e.settings.display.resources,t,i);return new Rc(e,t,i.style,a)}static noteColor(e,t,i){const s=ht._noteDefaultColor(e,t,i);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??s}static _noteDefaultColor(e,t,i){return i.beat.voice.index===0?e.mainGlyphColor:e.secondaryGlyphColor}static note(e,t,i,s=!1){if(!i.style&&!s)return;const a=i.beat.voice.index===0?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor;return new Rc(e,t,i.style,a)}}class Rc{_canvas;_previousColor;constructor(e,t,i,s){this._canvas=e,i&&i.colors.has(t)?(this._previousColor=e.color,e.color=i.colors.get(t)??s):i||(this._previousColor=e.color,e.color=s)}[Symbol.dispose](){this._previousColor&&(this._canvas.color=this._previousColor)}}class t3 extends ja{static KeySizeBeat="Beat";beatGlyphs;voice;tupletGroups;constructor(e,t,i){super(e,t),this.voice=i,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const t=this.renderer.layoutingInfo.spaceToForce(e);this._scaleToForce(t)}_scaleToForce(e){this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e);const t=this.renderer.layoutingInfo.buildOnTimePositions(e),i=this.beatGlyphs;for(let s=0,a=i.length;s<a;s++){const o=i[s];switch(o.beat.graceType){case De.None:o.x=t.get(o.beat.absoluteDisplayStart)-o.onTimeX;break;default:const c=o.beat.graceGroup.beats[0].absoluteDisplayStart,h=o.beat.graceGroup.id;if(o.beat.graceGroup.isComplete&&t.has(c)){o.x=t.get(c)-o.onTimeX;const d=this.renderer.layoutingInfo.allGraceRods.get(h),p=o.beat.graceGroup.beats[o.beat.graceGroup.beats.length-1].nextBeat,g=p?this.renderer.layoutingInfo.getPreBeatSize(p):0;o.x-=g,o.x-=d[o.beat.graceIndex].postSpringWidth,o.x+=d[o.beat.graceIndex].graceBeatWidth;const y=d[o.beat.graceGroup.beats.length-1];o.x-=y.graceBeatWidth}else{const d=this.renderer.layoutingInfo.incompleteGraceRods.get(h),p=d[o.beat.graceIndex].postSpringWidth-d[o.beat.graceIndex].preSpringWidth;s>0?o.beat.graceIndex===0?o.x=i[s-1].x+i[s-1].width:o.x=i[s-1].x+d[o.beat.graceIndex-1].postSpringWidth-d[o.beat.graceIndex-1].preSpringWidth-p:o.x=-p}break}if(s>0){const c=o.x-i[s-1].x;i[s-1].scaleToWidth(c)}if(s===a-1){const c=this.width-i[i.length-1].x;o.scaleToWidth(c)}}}registerLayoutingInfo(e){const t=this.beatGlyphs;for(const i of t)i.registerLayoutingInfo(e)}applyLayoutingInfo(e){const t=this.beatGlyphs;for(const i of t)i.applyLayoutingInfo(e);this._scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){const t=e;e.x=this.beatGlyphs.length===0?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(t),this.width=e.x+e.width,t.beat.hasTuplet&&t.beat.tupletGroup.beats[0].id===t.beat.id&&this.tupletGroups.push(t.beat.tupletGroup)}doLayout(){}paint(e,t,i){const s=ht.voice(i,jc.Glyphs,this.voice,!0);try{for(let a=0,o=this.beatGlyphs.length;a<o;a++)this.beatGlyphs[a].paint(e+this.x,t+this.y,i)}finally{s?.[Symbol.dispose]?.()}}}class i3{staffId="";up=0;down=0}class s3{startBeat=null;startX=0;startY=0;endBeat=null;endX=0;endY=0;calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class qa{_staff;_beatLineXPositions=new Map;_renderer;_firstNonRestBeat=null;_lastNonRestBeat=null;voice=null;beats=[];shortestDuration=M.QuadrupleWhole;tremoloDuration;hasTuplet=!1;slashBeats=[];lowestNoteInHelper=null;_lowestNoteCompareValueInHelper=-1;highestNoteInHelper=null;_highestNoteCompareValueInHelper=-1;invertBeamDirection=!1;preferredBeamDirection=null;graceType=De.None;minRestLine=null;beatOfMinRestLine=null;maxRestLine=null;beatOfMaxRestLine=null;get isRestBeamHelper(){return this.beats.length===1&&this.beats[0].isRest}hasLine(e,t){return e&&this._beatHasLine(t)||!e&&this.beats.length===1&&this._beatHasLine(t)}_beatHasLine(e){return e.duration>M.Whole}hasFlag(e,t){return e&&this._beatHasFlag(t)||!e&&this.beats.length===1&&this._beatHasFlag(this.beats[0])}_beatHasFlag(e){return!e.deadSlapped&&!e.isRest&&(e.duration>M.Quarter||e.graceType!==De.None)}constructor(e,t){this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e,t){return t=t??this.direction,this.hasBeatLineX(e)?t===j.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,i,s){const a=this._getOrCreateBeatPositions(t);a.staffId=e,a.up=i,a.down=s;for(const o of this.drawingInfos.values())o.startBeat===t?o.startX=this.getBeatLineX(t):o.endBeat===t&&(o.endX=this.getBeatLineX(t))}_getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new i3),this._beatLineXPositions.get(e.index)}direction=j.Up;finish(){this.direction=this._calculateDirection(),this._renderer.completeBeamingHelper(this)}_calculateDirection(){if(!this.voice)return j.Up;if(this.preferredBeamDirection!==null)return this.preferredBeamDirection;if(this.voice.index>0)return this._invert(j.Down);if(this.voice.bar.isMultiVoice)return this._invert(j.Up);if(this.beats[0].graceType!==De.None)return this._invert(j.Up);if(this.highestNoteInHelper&&this.lowestNoteInHelper){const e=this._renderer.getNoteY(this.highestNoteInHelper,pe.Center),t=this._renderer.getNoteY(this.lowestNoteInHelper,pe.Center),i=(e+t)/2;return this._invert(this._renderer.middleYPosition<i?j.Up:j.Down)}return this._invert(j.Up)}static computeLineHeightsForRest(e){switch(e){case M.QuadrupleWhole:return[2,2];case M.DoubleWhole:return[2,2];case M.Whole:return[0,1];case M.Half:return[1,0];case M.Quarter:return[3,3];case M.Eighth:return[2,2];case M.Sixteenth:return[2,4];case M.ThirtySecond:return[4,4];case M.SixtyFourth:return[4,6];case M.OneHundredTwentyEighth:return[6,6];case M.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let i=t,s=t;const a=qa.computeLineHeightsForRest(e.duration);i-=a[0],s+=a[1];const o=this.minRestLine,c=this.maxRestLine;(o===null||o>i)&&(this.minRestLine=i,this.beatOfMinRestLine=e),(c===null||c<s)&&(this.maxRestLine=s,this.beatOfMaxRestLine=e)}_invert(e){if(!this.invertBeamDirection)return e;switch(e){case j.Down:return j.Up;default:return j.Down}}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(this.beats.length===0)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case ei.Auto:case ei.ForceSplitOnSecondaryToNext:t=qa._canJoin(this.beats[this.beats.length-1],e);break;case ei.ForceSplitToNext:t=!1;break;case ei.ForceMergeWithNext:t=!0;break}return t&&(this.preferredBeamDirection==null&&e.preferredBeamDirection!==null&&(this.preferredBeamDirection=e.preferredBeamDirection),e.hasTuplet&&(this.hasTuplet=!0),e.isTremolo&&(!this.tremoloDuration||this.tremoloDuration<e.tremoloSpeed)&&(this.tremoloDuration=e.tremoloSpeed),e.graceType!==De.None&&(this.graceType=e.graceType),e.isRest?this.beats.length===0&&this.beats.push(e):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),this._checkNote(e.minNote),this._checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e),e.slashed&&this.slashBeats.push(e)),t}_checkNote(e){if(!e)return;let t,i;this.voice&&e.isPercussion?(t=-Gs.getPercussionLine(this.voice.bar,Gs.getNoteValue(e)),i=t):(t=Gs.getNoteValue(e),i=t,e.harmonicType!==Re.None&&e.harmonicType!==Re.Natural&&(i=e.realValue-this._staff.displayTranspositionPitch)),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||i>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=i)}static _canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===De.BendGrace||t.graceType===De.BendGrace||e.deadSlapped||t.deadSlapped)return!1;if(e.graceType!==De.None&&t.graceType!==De.None)return!0;const i=e.voice.bar,s=t.voice.bar;if(i!==s)return!1;const a=e.playbackStart,o=t.playbackStart;if(!qa._canJoinDuration(e.duration)||!qa._canJoinDuration(t.duration))return a===o;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let c=$.QuarterTime;switch(i.masterBar.timeSignatureDenominator){case 8:i.masterBar.timeSignatureNumerator%3===0&&(c+=$.QuarterTime/2|0);break}const h=(c+a)/c|0|0,d=(c+o)/c|0|0;return h===d}static _canJoinDuration(e){switch(e){case M.Whole:case M.Half:case M.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,i){return ce.getIndex(e.duration)-2-i>0&&ce.getIndex(t.duration)-2-i>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return this._beatLineXPositions.has(t.index)?this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId:!0}drawingInfos=new Map}class n3{topY=0;bottomY=0;constructor(e,t){this.topY=e,this.bottomY=t}}class a3{beat;topY=-1e3;bottomY=-1e3;slots=[];constructor(e){this.beat=e}addSlot(e,t){if(this.slots.push(new n3(e,t)),this.topY===-1e3)this.topY=e,this.bottomY=t;else{const i=Math.min(e,t),s=Math.max(e,t);i<this.topY&&(this.topY=i),s>this.bottomY&&(this.bottomY=s)}}}class r3{reservedLayoutAreasByDisplayTime=new Map;restDurationsByDisplayTime=new Map;getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const i of this.reservedLayoutAreasByDisplayTime.values())e===-1e3?(e=i.topY,t=i.bottomY):(e>i.topY&&(e=i.topY),t<i.bottomY&&(t=i.bottomY));return e===-1e3?[0,0]:[e,t]}reserveBeatSlot(e,t,i){t!==i&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new a3(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,i),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,i){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const s=qa.computeLineHeightsForRest(e.duration).map(p=>p*i),a=t-s[0],o=t+s[1];let c=a;const h=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let d=!1;for(const p of h.slots)if(a>=p.topY&&a<=p.bottomY||o>=p.topY&&o<=p.bottomY){d=!0;break}if(d){e.voice.index===1?c=h.topY-s[1]-s[0]:c=h.bottomY;const p=c+s[0]+s[1],g=i*2,y=Math.ceil(Math.abs(c-a)/g);return h.addSlot(c,p),c<a?y*-g:y*g}}return 0}}class o3{_renderer;beamHelpers=[];beamHelperLookup=[];collisionHelper;preferredBeamDirection=null;constructor(e){this._renderer=e,this.collisionHelper=new r3}initialize(){const e=this._renderer,t=this._renderer.bar;let i=null,s=null;for(let a=0,o=t.voices.length;a<o;a++){const c=t.voices[a];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let h=0,d=c.beats.length;h<d;h++){const p=c.beats[h];let g;p.graceType!==De.None?g=s:(g=i,s=null),(!g||!g.checkBeat(p))&&(g&&g.finish(),g=new qa(t.staff,e),g.preferredBeamDirection=this.preferredBeamDirection,g.checkBeat(p),p.graceType!==De.None?s=g:i=g,this.beamHelpers[c.index].push(g)),this.beamHelperLookup[c.index].set(p.index,g)}i&&i.finish(),s&&s.finish(),i=null,s=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}class Lh extends Xn{static _frets=5;_chord;_textRow=0;_fretRow=0;_firstFretSpacing=0;constructor(e,t,i){super(e,t),this._chord=i}doLayout(){super.doLayout();const e=this.renderer.resources;this._textRow=e.effectFont.size*1.5,this._fretRow=e.effectFont.size*1.5,this._chord.firstFret>1?this._firstFretSpacing=this.renderer.smuflMetrics.chordDiagramFretSpacing:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+Lh._frets*this.renderer.smuflMetrics.chordDiagramFretSpacing+2*this.renderer.smuflMetrics.chordDiagramPaddingY,this.width=this._firstFretSpacing+(this._chord.strings.length-1)*this.renderer.smuflMetrics.chordDiagramStringSpacing+2*this.renderer.smuflMetrics.chordDiagramPaddingX}paint(e,t,i){e+=this.x+this.renderer.smuflMetrics.chordDiagramPaddingX+this._firstFretSpacing,t+=this.y;const s=this.renderer.smuflMetrics.chordDiagramStringSpacing,a=this.renderer.smuflMetrics.chordDiagramFretSpacing,o=this.renderer.resources,c=o.engravingSettings.chordDiagramLineWidth,h=this.width-2*this.renderer.smuflMetrics.chordDiagramPaddingX-this._firstFretSpacing+c,d=o.engravingSettings.glyphHeights.get(S.FretboardFilledCircle),p=o.engravingSettings.glyphTop.get(S.FretboardFilledCircle),g=o.engravingSettings.glyphHeights.get(S.FretboardX)/2,y=o.engravingSettings.glyphHeights.get(S.FretboardO)/2,k=i.textAlign,_=i.textBaseline;i.font=o.effectFont,i.textAlign=Ce.Center,i.textBaseline=Wt.Top,this._chord.showName&&i.fillText(this._chord.name,e+h/2,t+o.effectFont.size/2),t+=this._textRow,i.font=o.fretboardNumberFont,i.textBaseline=Wt.Middle;for(let T=0;T<this._chord.strings.length;T++){const x=e+T*s,E=t+this._fretRow/2;let N=this._chord.strings[this._chord.strings.length-T-1];N<0?vi.fillMusicFontSymbolSafe(i,x,E+g,1,S.FretboardX,!0):N===0?vi.fillMusicFontSymbolSafe(i,x,E+y,1,S.FretboardO,!0):(N-=this._chord.firstFret-1,i.fillText(N.toString(),x,E))}t+=this._fretRow;for(let T=0;T<this._chord.strings.length;T++){const x=e+T*s;i.fillRect(x,t,c,a*Lh._frets+1)}this._chord.firstFret>1?(i.textAlign=Ce.Left,i.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,t+a/2),i.fillRect(e,t,h,c)):i.fillRect(e,t-this.renderer.smuflMetrics.chordDiagramNutHeight/2,h,this.renderer.smuflMetrics.chordDiagramNutHeight);for(let T=0;T<=Lh._frets;T++){const x=t+T*a;i.fillRect(e,x,h,this.renderer.smuflMetrics.chordDiagramFretHeight)}const w=new Map;for(const T of this._chord.barreFrets){const x=[-1,-1];w.set(T-this._chord.firstFret,x)}for(let T=0;T<this._chord.strings.length;T++){let x=this._chord.strings[T];if(x>0){if(x-=this._chord.firstFret,w.has(x)){const v=w.get(x);(v[0]===-1||T<v[0])&&(v[0]=T),(v[1]===-1||T>v[1])&&(v[1]=T)}const E=t+x*a+a/2+.5,N=e+(this._chord.strings.length-T-1)*s+c/2;vi.fillMusicFontSymbolSafe(i,N,E+p-d/2,1,S.FretboardFilledCircle,!0)}}for(const[T,x]of w){const E=t+T*a+a/2+.5,N=e+(this._chord.strings.length-x[1]-1)*s,v=e+(this._chord.strings.length-x[0]-1)*s;i.fillRect(N,E-d/2,v-N,d)}i.textAlign=k,i.textBaseline=_}}class HB extends ja{_glyphWidth=0;_align;constructor(e,t,i=Ce.Center){super(e,t),this.glyphs=[],this._align=i}doLayout(){const e=this.renderer.smuflMetrics.rowContainerGap,t=this._glyphWidth-e;let i=0;switch(this._align){case Ce.Left:i=0;break;case Ce.Center:i=(this.width-t)/2;break;case Ce.Right:i=this.width-t;break}for(const s of this.glyphs)s.x=i,i+=s.width+e}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width+this.renderer.smuflMetrics.rowContainerGap,e.height>this.height&&(this.height=e.height)}}class bv extends ja{_rows=[];_align;constructor(e,t,i=Ce.Center){super(e,t),this.height=0,this.glyphs=[],this._align=i}doLayout(){let e=0,t=0;const i=this.renderer.smuflMetrics.rowContainerGap;this._rows=[];let s=new HB(e,t,this._align);s.renderer=this.renderer,s.width=this.width;for(const a of this.glyphs){const o=e+a.width+i;o<this.width?(s.addGlyphToRow(a),e=Math.ceil(o)):(s.isEmpty||(s.doLayout(),this._rows.push(s),t+=s.height+i),e=0,s=new HB(e,t,this._align),s.renderer=this.renderer,s.width=this.width,s.addGlyphToRow(a),e+=Math.ceil(a.width+i))}s.isEmpty||(s.doLayout(),this._rows.push(s),t+=Math.ceil(s.height+this.renderer.smuflMetrics.rowContainerPadding)),this.height=t}paint(e,t,i){for(const s of this._rows)s.paint(e+this.x,t+this.y,i)}}class l3 extends bv{addChord(e){if(e.strings.length>0){const t=new Lh(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}paint(e,t,i){if(this.glyphs.length>0){const s=ht.score(i,ye.ChordDiagramList,this.renderer.scoreRenderer.score);try{super.paint(e,t,i)}finally{s?.[Symbol.dispose]?.()}}}}class ha extends Xn{_lines;_lineHeights=null;font;textAlign;textBaseline;colorOverride;constructor(e,t,i,s,a=Ce.Left,o=null,c){super(e,t),this._lines=i.split(`
`),this.font=s,this.textAlign=a,this.textBaseline=o,this.colorOverride=c}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const i=e.measureText(t),s=i.height;this._lineHeights.push(s),this.height+=s,this.width=Math.max(this.width,i.width)}}paint(e,t,i){const s=i.color;i.color=this.colorOverride??s,i.font=this.font;const a=i.textAlign,o=i.textBaseline;i.textAlign=this.textAlign,this.textBaseline!==null&&(i.textBaseline=this.textBaseline);let c=t+this.y;for(let h=0;h<this._lines.length;h++)i.fillText(this._lines[h],e+this.x,c),c+=this._lineHeights[h];i.textAlign=a,i.textBaseline=o,i.color=s}}class c3{_factory;_sharedLayoutData=new Map;staffTrackGroup;system;barRenderers=[];x=0;y=0;height=0;index=0;staffIndex=0;isFirstInSystem=!1;trackIndex=0;modelStaff;get staffId(){return this._factory.staffId}staveTop=0;topSpacing=0;bottomSpacing=0;staveBottom=0;get contentTop(){return this.y+this.staveTop+this.topSpacing+this.topOverflow}get contentBottom(){return this.y+this.topSpacing+this.topOverflow+this.staveBottom}constructor(e,t,i){this._factory=i,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInsideBracket(){return this._factory.isInsideBracket}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staffId,e)}addBar(e,t,i){const s=this._factory.create(this.system.layout.renderer,e);s.additionalMultiRestBars=i,s.staff=this,s.index=this.barRenderers.length,s.layoutingInfo=t,s.doLayout(),s.registerLayoutingInfo();const a=s.barDisplayWidth;a>0&&this.system.layout.systemsLayoutMode===Un.FromModelWithWidths&&(s.width=a),this.barRenderers.push(s),e&&this.system.layout.registerBarRenderer(this.staffId,s)}revertLastBar(){const e=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staffId,e);for(const t of this.barRenderers)t.applyLayoutingInfo();return e}scaleToWidth(e){this._sharedLayoutData=new Map;const t=this.topOverflow;let i=0;switch(this.system.layout.systemsLayoutMode){case Un.Automatic:const a=(e-this.system.computedWidth)/this.barRenderers.length;for(const c of this.barRenderers){c.x=i,c.y=this.topSpacing+t;const h=c.computedWidth+a;c.scaleToWidth(h),i+=c.width}break;case Un.FromModelWithScale:e-=this.system.accoladeWidth;const o=this.system.totalBarDisplayScale;for(const c of this.barRenderers){c.x=i,c.y=this.topSpacing+t;const h=c.barDisplayScale*e/o;c.scaleToWidth(h),i+=c.width}break;case Un.FromModelWithWidths:for(const c of this.barRenderers){c.x=i,c.y=this.topSpacing+t;const h=c.barDisplayWidth;h>0?c.scaleToWidth(h):c.scaleToWidth(c.computedWidth),i+=c.width}break}}get topOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){const s=this.barRenderers[t];s.topOverflow>e&&(e=s.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){const s=this.barRenderers[t];s.bottomOverflow>e&&(e=s.bottomOverflow)}return e}calculateHeightForAccolade(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=this.barRenderers.length>0?this.barRenderers[0].height:0,this.height>0&&(this.height+=Math.ceil(this.topSpacing+this.topOverflow+this.bottomOverflow+this.bottomSpacing))}finalizeStaff(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=0;let e=!1,t=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+t,this.height=Math.max(this.height,this.barRenderers[i].height),this.barRenderers[i].finalizeRenderer()&&(e=!0);if(e){t=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+t;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+t+this.bottomOverflow+this.bottomSpacing),this.height=Math.ceil(this.height)}paint(e,t,i,s,a){if(!(this.height===0||a===0))for(let o=s,c=Math.min(s+a,this.barRenderers.length);o<c;o++)this.barRenderers[o].paint(e+this.x,t+this.y,i)}}class zB{timePosition=0;longestDuration=0;smallestDuration=0;force=0;springConstant=0;get springWidth(){return this.preSpringWidth+this.postSpringWidth}preBeatWidth=0;graceBeatWidth=0;postSpringWidth=0;get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}allDurations=new Set}class Wp{static _defaultMinDuration=30;static _defaultMinDurationWidth=7;_timeSortedSprings=[];_minTime=-1;_onTimePositionsForce=0;_onTimePositions=new Map;_incompleteGraceRodsWidth=0;_minDuration=Wp._defaultMinDuration;version=0;preBeatSize=0;postBeatSize=0;minStretchForce=0;totalSpringConstant=0;_updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}getPreBeatSize(e){if(e.graceType!==De.None){const i=e.graceGroup.id;return this.allGraceRods.get(i)[e.graceIndex].preBeatWidth}const t=e.absoluteDisplayStart;return this.springs.has(t)?this.springs.get(t).preBeatWidth:0}getPostBeatSize(e){if(e.graceType!==De.None){const i=e.graceGroup.id;return this.allGraceRods.get(i)[e.graceIndex].postSpringWidth}const t=e.absoluteDisplayStart;return this.springs.has(t)?this.springs.get(t).postSpringWidth:0}incompleteGraceRods=new Map;allGraceRods=new Map;springs=new Map;addSpring(e,t,i,s,a){this.version++;let o;if(this.springs.has(e))o=this.springs.get(e),o.postSpringWidth<a&&(o.postSpringWidth=a),o.graceBeatWidth<i&&(o.graceBeatWidth=i),o.preBeatWidth<s&&(o.preBeatWidth=s),t<o.smallestDuration&&(o.smallestDuration=t),t>o.longestDuration&&(o.longestDuration=t),o.allDurations.add(t);else{if(o=new zB,o.timePosition=e,o.allDurations.add(t),this._timeSortedSprings.length>0){const d=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const p of d.allDurations)d.timePosition+p;t<this._minDuration&&(this._minDuration=t)}o.longestDuration=t,o.postSpringWidth=a,o.graceBeatWidth=i,o.preBeatWidth=s,this.springs.set(e,o);const c=this._timeSortedSprings;let h=c.length-1;for(;h>0&&c[h].timePosition>e;)h--;this._timeSortedSprings.splice(h+1,0,o)}return(this._minTime===-1||this._minTime>e)&&(this._minTime=e),o}addBeatSpring(e,t,i){const s=e.absoluteDisplayStart;if(e.graceType!==De.None){const a=e.graceGroup.id;this.allGraceRods.has(a)||this.allGraceRods.set(a,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(a)&&this.incompleteGraceRods.set(a,new Array(e.graceGroup.beats.length));const o=this.allGraceRods.get(a)[e.graceIndex];if(o)o.postSpringWidth<i&&(o.postSpringWidth=i),o.preBeatWidth<t&&(o.preBeatWidth=t);else{const c=new zB;c.timePosition=s,c.postSpringWidth=i,c.preBeatWidth=t,e.graceGroup.isComplete||(this.incompleteGraceRods.get(a)[e.graceIndex]=c),this.allGraceRods.get(a)[e.graceIndex]=c}}else{let a=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const o of this.allGraceRods.get(e.graceGroup.id))a+=o.springWidth;this.addSpring(s,e.displayDuration,a,t,i)}}finish(){for(const[e,t]of this.allGraceRods){let i=0;for(const s of t)i+=s.preBeatWidth,s.graceBeatWidth=i,i+=s.postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const t of e)this._incompleteGraceRodsWidth+=t.preBeatWidth+t.postSpringWidth;this._calculateSpringConstants(),this.version++}_calculateSpringConstants(){let e=0;const t=this._timeSortedSprings;if(t.length===0){this.totalSpringConstant=-1,this.minStretchForce=-1;return}for(let i=0;i<t.length;i++){const s=t[i];let a=0;if(i===t.length-1)a=s.longestDuration;else{const o=t[i+1];a=Math.abs(o.timePosition-s.timePosition)}s.springConstant=this._calculateSpringConstant(s,a),e+=1/s.springConstant}this.totalSpringConstant=1/e,this.minStretchForce=0;for(let i=0;i<t.length;i++){const s=t[i];let a=0;if(i===t.length-1)a=s.postSpringWidth;else{const c=t[i+1];a=s.postSpringWidth+c.preSpringWidth}i===0&&(a+=s.preSpringWidth);const o=a*s.springConstant;this._updateMinStretchForce(o)}}height=0;paint(e,t,i){}_calculateSpringConstant(e,t){t<=0&&(t=$.toTicks(M.TwoHundredFiftySixth)),e.smallestDuration===0&&(e.smallestDuration=t);const i=e.smallestDuration,s=this._minDuration,a=Wp._defaultMinDurationWidth,o=1+.85*Math.log2(t/s);return i/t*(1/(o*a))}spaceToForce(e){return this.totalSpringConstant!==-1?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let t=0;return this.totalSpringConstant!==-1&&(t=this._calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(t+=this._timeSortedSprings[0].preSpringWidth),t+=this._incompleteGraceRodsWidth,t}_calculateWidth(e,t){return e/t}buildOnTimePositions(e){if(this.totalSpringConstant===-1)return new Map;if(ce.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;const t=new Map;this._onTimePositions=t;const i=this._timeSortedSprings;if(i.length===0)return t;let s=i[0].preSpringWidth;for(let a=0;a<i.length;a++)t.set(i[a].timePosition,s),s+=this._calculateWidth(e,i[a].springConstant);return t}}class u3{width=0;isLinkedToPrevious=!1;canWrap=!0;masterBar;additionalMultiBarRestIndexes=null;get lastMasterBarIndex(){return this.additionalMultiBarRestIndexes?this.additionalMultiBarRestIndexes[this.additionalMultiBarRestIndexes.length-1]:this.masterBar.index}renderers=[];layoutingInfo}class h3{track;staffSystem;staves=[];stavesRelevantForBoundsLookup=[];firstStaffInBracket=null;lastStaffInBracket=null;bracket=null;constructor(e,t){this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class d3{firstStaffInBracket=null;lastStaffInBracket=null;drawAsBrace=!1;braceScale=1;width=0;index=0;finalizeBracket(e){if(this.firstStaffInBracket===this.lastStaffInBracket){this.width=0;return}const t=e.glyphHeights.get(S.Brace),i=e.glyphWidths.get(S.Brace);if(this.drawAsBrace?this.width=i:this.width=e.bracketThickness,!this.drawAsBrace||!this.firstStaffInBracket||!this.lastStaffInBracket)return;const s=this.firstStaffInBracket.contentTop,c=(this.lastStaffInBracket.contentBottom-s)/t;this.braceScale=c,this.width=i*this.braceScale}}class _g extends d3{track;constructor(e){super(),this.track=e,this.drawAsBrace=_g.isTrackDrawAsBrace(e)}includesStaff(e){return e.modelStaff.track===this.track}static isTrackDrawAsBrace(e){return e.staves.filter(t=>t.showStandardNotation).length>1}}class f3 extends _g{includesStaff(e){return e.modelStaff.track===this.track?!0:this.drawAsBrace?!1:this.track.playbackInfo.program===e.modelStaff.track.playbackInfo.program}}class p3{_allStaves=[];_firstStaffInBrackets=null;_lastStaffInBrackets=null;_accoladeSpacingCalculated=!1;_brackets=[];_hasSystemSeparator=!1;x=0;y=0;index=0;accoladeWidth=0;isFull=!1;width=0;computedWidth=0;totalBarDisplayScale=0;isLast=!1;masterBarsRenderers=[];staves=[];layout;topPadding;bottomPadding;constructor(e){this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].lastMasterBarIndex}addMasterBarRenderers(e,t){if(e.length===0)return null;this.masterBarsRenderers.push(t),t.layoutingInfo.preBeatSize=0;let i=0;for(let s=0,a=this.staves.length;s<a;s++){const o=this.staves[s];for(let c=0,h=o.staves.length;c<h;c++){const d=o.staves[c],p=t.renderers[i++];d.addBarRenderer(p)}}return this._calculateAccoladeSpacing(e),this._updateWidthFromLastBar(),t}addBars(e,t,i){const s=new u3;s.additionalMultiBarRestIndexes=i,s.layoutingInfo=new Wp,s.masterBar=e[0].score.masterBars[t],this.masterBarsRenderers.push(s);const a=s.layoutingInfo;for(const o of this.staves)for(const c of o.staves){const h=o.track.staves[c.modelStaff.index].bars[t],d=i==null?null:i.map(g=>o.track.staves[c.modelStaff.index].bars[g]);c.addBar(h,a,d);const p=c.barRenderers[c.barRenderers.length-1];s.renderers.push(p),p.isLinkedToPrevious&&(s.isLinkedToPrevious=!0),p.canWrap||(s.canWrap=!1)}return this._calculateAccoladeSpacing(e),a.finish(),s.width=this._updateWidthFromLastBar(),s}revertLastBar(){if(this.masterBarsRenderers.length>1){const e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let t=0,i=0;for(let s=0,a=this._allStaves.length;s<a;s++){const c=this._allStaves[s].revertLastBar(),h=c.computedWidth;h>t&&(t=h);const d=c.barDisplayScale;d>i&&(i=d)}return this.width-=t,this.computedWidth-=t,this.totalBarDisplayScale-=i,e}return null}_updateWidthFromLastBar(){let e=0,t=0;for(let i=0,s=this._allStaves.length;i<s;i++){const a=this._allStaves[i],o=a.barRenderers[a.barRenderers.length-1];o.applyLayoutingInfo(),o.computedWidth>e&&(e=o.computedWidth);const c=o.barDisplayScale;c>t&&(t=c)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=t,e}_calculateAccoladeSpacing(e){const t=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){this._accoladeSpacingCalculated=!0,this.accoladeWidth=0;const i=this.layout.renderer.score.stylesheet;if(this.layout.renderer.settings.notation.isNotationElementVisible(rt.TrackNames)){const c=this.layout.renderer.tracks.length===1?i.singleTrackTrackNamePolicy:i.multiTrackTrackNamePolicy,h=this.index===0?i.firstSystemTrackNameMode:i.otherSystemsTrackNameMode,d=this.index===0?i.firstSystemTrackNameOrientation:i.otherSystemsTrackNameOrientation;let p=!1;switch(c){case Ii.Hidden:break;case Ii.FirstSystem:p=this.index===0;break;case Ii.AllSystems:p=!0;break}let g=!1;if(p){const y=this.layout.renderer.canvas,k=t.display.resources.effectFont;y.font=k;for(const _ of e){let w="";switch(h){case $s.FullName:w=_.name;break;case $s.ShortName:w=_.shortName;break}if(w.length>0){g=!0;const T=y.measureText(w);switch(d){case Xs.Horizontal:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,T.width));break;case Xs.Vertical:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,T.height));break}}}g&&(this.accoladeWidth+=t.display.systemLabelPaddingLeft,this.accoladeWidth+=t.display.systemLabelPaddingRight)}}let a=0;for(const c of this._allStaves)c.y=a,c.calculateHeightForAccolade(),a+=c.height;let o=0;for(const c of this._brackets)c.finalizeBracket(t.display.resources.engravingSettings),o=Math.max(o,c.width);this.accoladeWidth+=o,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}_getStaffTrackGroup(e){for(let t=0,i=this.staves.length;t<i;t++){const s=this.staves[t];if(s.track===e)return s}return null}addStaff(e,t){let i=this._getStaffTrackGroup(e);if(i||(i=new h3(this,e),this.staves.push(i)),t.staffTrackGroup=i,t.system=this,t.index=this._allStaves.length,this._allStaves.push(t),i.addStaff(t),t.isInsideBracket){this._firstStaffInBrackets||(this._firstStaffInBrackets=t,t.isFirstInSystem=!0),i.firstStaffInBracket||(i.firstStaffInBracket=t),this._lastStaffInBrackets=t,i.lastStaffInBracket=t;let s=this._brackets.find(a=>a.includesStaff(t));if(!s)switch(e.score.stylesheet.bracketExtendMode){case Yo.NoBrackets:break;case Yo.GroupStaves:s=new _g(e),s.index=this._brackets.length,this._brackets.push(s);break;case Yo.GroupSimilarInstruments:s=new f3(e),s.index=this._brackets.length,this._brackets.push(s);break}s&&(s.firstStaffInBracket||(s.firstStaffInBracket=t),s.lastStaffInBracket=t,i.bracket=s)}}get height(){return this._allStaves.length===0?0:Math.ceil(this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding)}scaleToWidth(e){for(let t=0,i=this._allStaves.length;t<i;t++)this._allStaves[t].scaleToWidth(e);this.width=e}paint(e,t,i){if(this.paintPartial(e+this.x,t+this.y+this.topPadding,i,0,this.masterBarsRenderers.length),this._hasSystemSeparator){const s=ht.track(i,Xa.SystemSeparator,this._allStaves[0].modelStaff.track);try{const a=this.layout.renderer.settings.display.resources.engravingSettings,o=Math.min(0,a.glyphBottom.get(S.SystemDivider)??0);vi.fillMusicFontSymbolSafe(i,e+this.x,t+this.y+this.height+o,1,S.SystemDivider,!1),vi.fillMusicFontSymbolSafe(i,e+this.x+this.width-a.glyphWidths.get(S.SystemDivider),t+this.y+this.height+o,1,S.SystemDivider,!1)}finally{s?.[Symbol.dispose]?.()}}}paintPartial(e,t,i,s,a){for(let c=0,h=this._allStaves.length;c<h;c++)this._allStaves[c].paint(e,t,i,s,a);const o=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&s===0){i.color=o.barSeparatorColor;const c=this.layout.renderer.settings,h=this.layout.renderer.settings.notation.isNotationElementVisible(rt.TrackNames);if(i.font=o.effectFont,h){const d=this.layout.renderer.score.stylesheet,p=this.layout.renderer.tracks.length===1?d.singleTrackTrackNamePolicy:d.multiTrackTrackNamePolicy,g=this.index===0?d.firstSystemTrackNameMode:d.otherSystemsTrackNameMode,y=this.index===0?d.firstSystemTrackNameOrientation:d.otherSystemsTrackNameOrientation;let k=!1;switch(p){case Ii.Hidden:break;case Ii.FirstSystem:k=this.index===0;break;case Ii.AllSystems:k=!0;break}if(k){const _=i.textBaseline,w=i.textAlign;for(const T of this.staves)if(T.firstStaffInBracket&&T.lastStaffInBracket){const x=t+T.firstStaffInBracket.contentTop,E=t+T.lastStaffInBracket.contentBottom;let N="";switch(g){case $s.FullName:N=T.track.name;break;case $s.ShortName:N=T.track.shortName;break}const v=ht.track(i,Xa.TrackName,T.track);try{if(N.length>0){const L=e+T.firstStaffInBracket.x-c.display.accoladeBarPaddingRight-(T.bracket?.width??0)-c.display.systemLabelPaddingRight;switch(y){case Xs.Horizontal:i.textBaseline=Wt.Middle,i.textAlign=Ce.Right,i.fillText(N,L,(x+E)/2);break;case Xs.Vertical:i.textBaseline=Wt.Bottom,i.textAlign=Ce.Center,i.beginRotate(L,(x+E)/2,-90-.1),i.fillText(N,0,0),i.endRotate();break}}}finally{v?.[Symbol.dispose]?.()}}i.textBaseline=_,i.textAlign=w}}if(this._allStaves.length>0){let d=null;for(const p of this._allStaves)if(p.isInsideBracket){if(d!==null){const g=d.contentBottom,y=p.contentTop,k=e+d.x,_=d.barRenderers[0],w=ht.bar(i,_.staffLineBarSubElement,_.bar);try{const T=Math.ceil(y-g);i.fillRect(k,t+g,o.engravingSettings.thinBarlineThickness,T)}finally{w?.[Symbol.dispose]?.()}}d=p}}for(const d of this._brackets)if(d.firstStaffInBracket&&d.lastStaffInBracket){const p=e+d.firstStaffInBracket.x,g=d.width,y=c.display.accoladeBarPaddingRight,k=t+d.firstStaffInBracket.contentTop,_=t+d.lastStaffInBracket.contentBottom;let w=k,T=_;if(d.drawAsBrace)vi.fillMusicFontSymbolSafe(i,p-y-g,T,d.braceScale,S.Brace);else if(d.firstStaffInBracket!==d.lastStaffInBracket){const x=g/2;w-=x,T+=x*2,i.fillRect(p-y-g,w,g,Math.ceil(T-w));const E=p-y-g;vi.fillMusicFontSymbolSafe(i,E,w,1,S.BracketTop),vi.fillMusicFontSymbolSafe(i,E,Math.floor(T),1,S.BracketBottom)}}}}finalizeSystem(){const e=this.layout.renderer.settings;if(this.index===0&&(this.topPadding=e.display.firstSystemPaddingTop),this.isLast)this.bottomPadding=e.display.lastSystemPaddingBottom;else if(this.layout.renderer.score.stylesheet.useSystemSignSeparator&&this.layout.renderer.tracks.length>1){const i=e.display.resources.engravingSettings.glyphHeights.get(S.SystemDivider);this.bottomPadding=Math.max(this.bottomPadding,i),this._hasSystemSeparator=!0}let t=0;for(const i of this._allStaves)i.x=this.accoladeWidth,i.y=t,i.finalizeStaff(),t+=i.height;for(const i of this._brackets)i.finalizeBracket(e.display.resources.engravingSettings)}buildBoundingsLookup(e,t){if(this.layout.renderer.boundsLookup.isFinished)return;const i=this._firstStaffInBrackets,s=this._lastStaffInBrackets;if(!i||!s)return;t+=this.topPadding;const a=this._allStaves[this._allStaves.length-1],o=t+this.y+i.y,c=t+this.y+s.y+s.height,h=t+this.y+this._allStaves[0].y,d=t+this.y+a.y+a.height,p=t+this.y+i.y+i.topSpacing+i.topOverflow+(i.barRenderers.length>0?i.barRenderers[0].topPadding:0),g=t+this.y+a.y+a.height-a.bottomSpacing-a.bottomOverflow-(a.barRenderers.length>0?a.barRenderers[0].bottomPadding:0),y=c-o,k=g-p,_=d-h,w=this.x+i.x,T=new Ux;T.visualBounds=new Os,T.visualBounds.x=e+this.x,T.visualBounds.y=t+this.y,T.visualBounds.w=this.width,T.visualBounds.h=this.height-this.topPadding-this.bottomPadding,T.realBounds=new Os,T.realBounds.x=e+this.x,T.realBounds.y=t+this.y,T.realBounds.w=this.width,T.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(T);const x=new Map;for(let E=0;E<this.staves.length;E++)for(const N of this.staves[E].stavesRelevantForBoundsLookup)for(const v of N.barRenderers){let L;x.has(v.bar.masterBar.index)?L=x.get(v.bar.masterBar.index):(L=new Gx,L.index=v.bar.masterBar.index,L.isFirstOfLine=v.isFirstOfLine,L.realBounds=new Os,L.realBounds.x=w+v.x,L.realBounds.y=h,L.realBounds.w=v.width,L.realBounds.h=_,L.visualBounds=new Os,L.visualBounds.x=w+v.x,L.visualBounds.y=o,L.visualBounds.w=v.width,L.visualBounds.h=y,L.lineAlignedBounds=new Os,L.lineAlignedBounds.x=w+v.x,L.lineAlignedBounds.y=p,L.lineAlignedBounds.w=v.width,L.lineAlignedBounds.h=k,this.layout.renderer.boundsLookup.addMasterBar(L),x.set(L.index,L)),v.buildBoundingsLookup(L,w,t+this.y+N.y)}}getBarX(e){if(!this._firstStaffInBrackets||this.layout.renderer.tracks.length===0)return 0;const t=this.layout.renderer.tracks[0].staves[0].bars[e];return this.layout.getRendererForBar(this._firstStaffInBrackets.staffId,t).x}}class g3 extends bv{constructor(e,t){super(e,t,Ce.Left)}}class m3 extends ja{_tuning;_trackLabel;colorOverride;constructor(e,t,i,s){super(e,t),this._tuning=i,this._trackLabel=s,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this._createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,t,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride),super.paint(e,t,i),i.color=s}_createGlyphs(e){const t=this.renderer.resources;if(this.height=0,this._trackLabel.length>0){const o=new ha(0,this.height,this._trackLabel,t.effectFont,Ce.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height,this.addGlyph(o)}if(e.name.length>0){const o=new ha(0,this.height,e.name,t.effectFont,Ce.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height,this.addGlyph(o)}const i=this.renderer.smuflMetrics.tuningGlyphCircleNumberScale,s=this.renderer.smuflMetrics.glyphHeights.get(S.GuitarString0)*i;this.renderer.scoreRenderer.canvas.font=t.effectFont;const a=(s+this.renderer.scoreRenderer.canvas.measureText(" = Gb").width)*t.engravingSettings.tuningGlyphStringColumnScale;if(this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width,2*a)),!e.isStandard){const o=Math.ceil(e.tunings.length/2)|0;let c=0;const h=this.height+this.renderer.smuflMetrics.tuningGlyphStringRowPadding;let d=h;for(let p=0,g=e.tunings.length;p<g;p++){const y=S.GuitarString0+(p+1);this.addGlyph(new ns(c,d+s,i,y));const k=` = ${de.getTextForTuning(e.tunings[p],!1)}`;this.addGlyph(new ha(c+s,d+s/2,k,t.effectFont,Ce.Left,Wt.Middle)),d+=s+this.renderer.smuflMetrics.tuningGlyphStringRowPadding;const _=d;this.height<_&&(this.height=_),p===o-1&&(d=h,c+=a)}}}}class y3{args;renderCallback;constructor(e,t){this.args=e,this.renderCallback=t}}var Un;(function(n){n[n.Automatic=0]="Automatic",n[n.FromModelWithScale=1]="FromModelWithScale",n[n.FromModelWithWidths=2]="FromModelWithWidths"})(Un||(Un={}));class Il{_barRendererLookup=new Map;pagePadding=null;renderer;width=0;height=0;multiBarRestInfo=null;get scaledWidth(){return Math.round(this.width/this.renderer.settings.display.scale)}headerGlyphs=new Map;footerGlyphs=new Map;chordDiagrams=null;tuningGlyph=null;systemsLayoutMode=Un.Automatic;constructor(e){this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();const e=this.renderer.score;this.firstBarIndex=ce.computeFirstDisplayedBarIndex(e,this.renderer.settings),this.lastBarIndex=ce.computeLastDisplayedBarIndex(e,this.renderer.settings,this.firstBarIndex),this.multiBarRestInfo=ce.buildMultiBarRestInfo(this.renderer.tracks,this.firstBarIndex,this.lastBarIndex),this.pagePadding=this.renderer.settings.display.padding.map(t=>t/this.renderer.settings.display.scale),this.pagePadding||(this.pagePadding=[0,0,0,0]),this.pagePadding.length===1?this.pagePadding=[this.pagePadding[0],this.pagePadding[0],this.pagePadding[0],this.pagePadding[0]]:this.pagePadding.length===2&&(this.pagePadding=[this.pagePadding[0],this.pagePadding[1],this.pagePadding[0],this.pagePadding[1]]),this._createScoreInfoGlyphs(),this.doLayoutAndRender()}_lazyPartials=new Map;registerPartial(e,t){if(e.height===0)return;const i=this.renderer.settings.display.scale;e.x*=i,e.y*=i,e.width*=i,e.height*=i,e.totalWidth*=i,e.totalHeight*=i,this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new y3(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this._internalRenderLazyPartial(e,t))}_internalRenderLazyPartial(e,t){const i=this.renderer.canvas;i.beginRender(e.width,e.height),t(i),e.renderResult=i.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this._internalRenderLazyPartial(t.args,t.renderCallback)}}static headerElements=new Zc(()=>new Map([[ye.Title,rt.ScoreTitle],[ye.SubTitle,rt.ScoreSubTitle],[ye.Artist,rt.ScoreArtist],[ye.Album,rt.ScoreAlbum],[ye.Words,rt.ScoreWords],[ye.Music,rt.ScoreMusic],[ye.WordsAndMusic,rt.ScoreWordsAndMusic],[ye.Transcriber,void 0]]));static footerElements=new Zc(()=>new Map([[ye.Copyright,rt.ScoreCopyright],[ye.CopyrightSecondLine,void 0]]));_createHeaderFooterGlyph(e,t,i,s){switch(i){case ye.WordsAndMusic:if(t.words!==t.music)return;break;case ye.Words:case ye.Music:if(t.words===t.music)return;break;case ye.CopyrightSecondLine:if(!this.footerGlyphs.has(ye.Copyright))return;break}const a=e.display.resources,o=e.notation,h=t.style&&t.style.headerAndFooter.has(i)?t.style.headerAndFooter.get(i):$o.defaultHeaderAndFooter.get(i);let d=h.isVisible!==void 0?h.isVisible:!0;if(s!==void 0&&(d=o.isNotationElementVisible(s)),!d)return;const p=h.buildText(t);if(p)return new ha(0,0,p,a.getFontForElement(i),h.textAlign,void 0,ht.scoreColor(a,i,t))}_createScoreInfoGlyphs(){ee.debug("ScoreLayout","Creating score info glyphs");const e=this.renderer.settings,t=this.renderer.score;this.headerGlyphs=new Map,this.footerGlyphs=new Map;const i=new Hp(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[o,c]of Il.headerElements.value){const h=this._createHeaderFooterGlyph(e,t,o,c);h&&(h.renderer=i,h.doLayout(),this.headerGlyphs.set(o,h))}for(const[o,c]of Il.footerElements.value){const h=this._createHeaderFooterGlyph(e,t,o,c);h&&(h.renderer=i,h.doLayout(),this.footerGlyphs.set(o,h))}const s=e.notation,a=e.display.resources;if(s.isNotationElementVisible(rt.GuitarTuning)){const o=[];for(const c of this.renderer.tracks)for(const h of c.staves){let d=!h.isPercussion&&h.isStringed&&h.tuning.length>0&&h.showTablature;if(t.stylesheet.perTrackDisplayTuning&&t.stylesheet.perTrackDisplayTuning.has(c.index)&&t.stylesheet.perTrackDisplayTuning.get(c.index)===!1&&(d=!1),d){o.push(h);break}}if(o.length>0&&t.stylesheet.globalDisplayTuning){this.tuningGlyph=new g3(0,0),this.tuningGlyph.renderer=i;for(const c of o)if(c.stringTuning.tunings.length>0){const h=o.length>1?c.track.name:"",d=new m3(0,0,c.stringTuning,h);d.colorOverride=ht.trackColor(a,Xa.StringTuning,c.track),d.renderer=i,d.doLayout(),this.tuningGlyph.addGlyph(d)}}else this.tuningGlyph=null}if(s.isNotationElementVisible(rt.ChordDiagrams)){this.chordDiagrams=new l3(0,0),this.chordDiagrams.renderer=i;const o=new Set;for(const c of this.renderer.tracks)if(t.stylesheet.globalDisplayChordDiagramsOnTop&&(t.stylesheet.perTrackChordDiagramsOnTop==null||!t.stylesheet.perTrackChordDiagramsOnTop.has(c.index)||t.stylesheet.perTrackChordDiagramsOnTop.get(c.index)))for(const d of c.staves){const p=d.chords;if(p)for(const[,g]of p)o.has(g.uniqueId)||g.showDiagram&&(o.add(g.uniqueId),this.chordDiagrams.addChord(g))}this.chordDiagrams.isEmpty&&(this.chordDiagrams=null)}else this.chordDiagrams=null}firstBarIndex=0;lastBarIndex=0;createEmptyStaffSystem(){const e=new p3(this);for(let t=0;t<this.renderer.tracks.length;t++){const i=this.renderer.tracks[t];for(let s=0;s<i.staves.length;s++){const a=i.staves[s],o=ne.staveProfiles.get(this.renderer.settings.display.staveProfile);for(const c of o)c.canCreate(i,a)&&e.addStaff(i,new c3(t,a,c))}}return e}registerBarRenderer(e,t){if(this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t),t.additionalMultiRestBars)for(const i of t.additionalMultiRestBars)this._barRendererLookup.get(e).set(i.id,t)}unregisterBarRenderer(e,t){if(this._barRendererLookup.has(e)){const i=this._barRendererLookup.get(e);if(i.delete(t.bar.id),t.additionalMultiRestBars)for(const s of t.additionalMultiRestBars)i.delete(s.id)}}getRendererForBar(e,t){const i=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(i)?this._barRendererLookup.get(e).get(i):null}layoutAndRenderBottomScoreInfo(e){e=Math.round(e);const t=new Wo;t.x=0,t.y=e;let i=0;const s=this.renderer.settings.display.resources,a=[];let o=0;for(const[c,h]of Il.footerElements.value)if(this.footerGlyphs.has(c)){const d=this.footerGlyphs.get(c);d.y=i,this.alignScoreInfoGlyph(d),i+=d.height,a.push(d),o=Math.max(o,Math.round(d.x+d.width))}return i=Math.round(i),a.length>0&&(t.width=o,t.height=i,t.totalWidth=this.scaledWidth,t.totalHeight=e+t.height,this.registerPartial(t,c=>{c.color=s.scoreInfoColor,c.textAlign=Ce.Left,c.textBaseline=Wt.Top;for(const h of a)h.paint(0,0,c)})),e+i}alignScoreInfoGlyph(e){if(ne.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical)switch(e.textAlign){case Ce.Left:e.x=this.pagePadding[0];break;case Ce.Center:e.x=this.scaledWidth/2;break;case Ce.Right:e.x=this.scaledWidth-this.pagePadding[2];break}else e.x=this.firstBarX,e.textAlign=Ce.Left}layoutAndRenderAnnotation(e){const t="rendered by alphaTab",i=this.renderer.settings.display.resources,s=12,a=nt.withFamilyList(i.copyrightFont.families,s,pi.Plain,fn.Bold),o=new Hp(this.renderer,this.renderer.tracks[0].staves[0].bars[0]),c=new ha(0,0,t,a,Ce.Center,void 0,i.mainGlyphColor);c.renderer=o,c.doLayout(),this.alignScoreInfoGlyph(c);const h=new Wo;return h.width=c.x+c.width,h.x=0,h.height=s,h.y=e,h.totalWidth=this.scaledWidth,h.totalHeight=e+s,h.firstMasterBarIndex=-1,h.lastMasterBarIndex=-1,this.registerPartial(h,d=>{d.color=i.mainGlyphColor,d.font=a,d.textAlign=Ce.Left,d.textBaseline=Wt.Top,c.paint(0,0,d)}),e+s}}class tl extends ja{_effectGlyphs=[];_normalGlyphs=[];container;computedWidth=0;constructor(){super(0,0)}doLayout(){let e=0;if(this.glyphs)for(let t=0,i=this.glyphs.length;t<i;t++){const s=this.glyphs[t];s.x=e,s.renderer=this.renderer,s.doLayout(),e+=s.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}addEffect(e){super.addGlyph(e),this._effectGlyphs.push(e)}addNormal(e){super.addGlyph(e),this._normalGlyphs.push(e)}get effectElement(){}paint(e,t,i){this._paintEffects(e,t,i),this._paintNormal(e,t,i)}_paintNormal(e,t,i){for(const s of this._normalGlyphs)s.paint(e+this.x,t+this.y,i)}_paintEffects(e,t,i){const s=this.effectElement?ht.beat(i,this.effectElement,this.container.beat):void 0;try{for(const a of this._effectGlyphs)a.paint(e+this.x,t+this.y,i)}finally{s?.[Symbol.dispose]?.()}}}class il extends tl{beamingHelper;centerX=0;updateBeamingHelper(){}buildBoundingsLookup(e,t,i){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}getHighestNoteY(){return 0}getLowestNoteY(){return 0}}class nu extends Vi{_scale=0;_baseline;_symbols=[];constructor(e,t,i,s,a=1){super(e,t),this._symbols=nu.getSymbols(i),this._scale=a,this._baseline=s}static getSymbols(e){const t=[];for(;e>0;){const i=e%10;t.unshift(nu.getSymbol(i)),e=e/10|0}return t}static getSymbol(e){switch(e){case 0:return S.TimeSig0;case 1:return S.TimeSig1;case 2:return S.TimeSig2;case 3:return S.TimeSig3;case 4:return S.TimeSig4;case 5:return S.TimeSig5;case 6:return S.TimeSig6;case 7:return S.TimeSig7;case 8:return S.TimeSig8;case 9:return S.TimeSig9;default:return S.None}}doLayout(){let e=0;for(const t of this._symbols)e+=this.renderer.smuflMetrics.glyphWidths.get(t);this.width=e}paint(e,t,i){switch(this._baseline){case Wt.Top:t+=this.renderer.smuflMetrics.glyphBottom.get(this._symbols[0]);break;case Wt.Bottom:t+=this.renderer.smuflMetrics.glyphTop.get(this._symbols[0]);break}i.fillMusicFontSymbols(e+this.x,t+this.y,this._scale,this._symbols)}}class Vp extends Vi{static _restSymbols=[S.RestHBarLeft,S.RestHBarMiddle,S.RestHBarMiddle,S.RestHBarMiddle,S.RestHBarRight];_numberGlyph=[];constructor(){super(0,0)}doLayout(){this.width=Vp._restSymbols.reduce((t,i)=>t+this.renderer.smuflMetrics.glyphWidths.get(i),0),this.renderer.registerOverflowTop(this.renderer.getLineHeight(1));const e=this.renderer.additionalMultiRestBars.length+1;this._numberGlyph=nu.getSymbols(e)}paint(e,t,i){i.fillMusicFontSymbols(e+this.x,t+this.y+this.renderer.height/2,1,Vp._restSymbols);const s=this.renderer.getLineY(-1.5);i.fillMusicFontSymbols(e+this.x+this.width/2,t+this.y+s|0,1,this._numberGlyph,!0)}}class kg extends Da{constructor(e){super(kg._getOrCreatePlaceholderBeat(e),e),this.preNotes=new tl,this.onNotes=new il}doLayout(){this.renderer.showMultiBarRest&&this.onNotes.addNormal(new Vp),super.doLayout()}static _getOrCreatePlaceholderBeat(e){if(e.voice.beats.length>1)return e.voice.beats[0];const t=new fs;return t.voice=e.voice,t}}var pe;(function(n){n[n.TopWithStem=0]="TopWithStem",n[n.Top=1]="Top",n[n.Center=2]="Center",n[n.Bottom=3]="Bottom",n[n.BottomWithStem=4]="BottomWithStem",n[n.StemUp=5]="StemUp",n[n.StemDown=6]="StemDown"})(pe||(pe={}));var ci;(function(n){n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right"})(ci||(ci={}));class Hp{_preBeatGlyphs=new El;_voiceContainers=new Map;_postBeatGlyphs=new El;_ties=[];get nextRenderer(){return!this.bar||!this.bar.nextBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.nextBar)}get previousRenderer(){return!this.bar||!this.bar.previousBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.previousBar)}scoreRenderer;staff;layoutingInfo;bar;additionalMultiRestBars=null;get lastBar(){return this.additionalMultiRestBars?this.additionalMultiRestBars[this.additionalMultiRestBars.length-1]:this.bar}x=0;y=0;width=0;computedWidth=0;height=0;index=0;topOverflow=0;bottomOverflow=0;helpers;isLinkedToPrevious=!1;canWrap=!0;get showMultiBarRest(){return!1}constructor(e,t){this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new o3(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e=Math.ceil(e),e>this.topOverflow?(this.topOverflow=e,!0):!1}registerOverflowBottom(e){return e=Math.ceil(e),e>this.bottomOverflow?(this.bottomOverflow=e,!0):!1}scaleToWidth(e){const t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const i of this._voiceContainers.values())i.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get smuflMetrics(){return this.resources.engravingSettings}get settings(){return this.scoreRenderer.settings}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}wasFirstOfLine=!1;get isFirstOfLine(){return this.index===0}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){const e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const s of this._voiceContainers.values())s.registerLayoutingInfo(e),s.x+s.width;const i=this._postBeatGlyphs.width;e.postBeatSize<i&&(e.postBeatSize=i)}_appliedLayoutingInfo=0;applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const i of this._voiceContainers.values()){i.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,i.applyLayoutingInfo(this.layoutingInfo);const s=i.x+i.width;e<s&&(e=s)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode===Un.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}isFinalized=!1;finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,i=this.y+this.height+this.staff.bottomSpacing;for(const s of this._ties)if(s.doLayout(),s.height>0){const a=s.y+s.height-i;a>0&&this.registerOverflowBottom(a)&&(e=!0);const o=s.y-t;o<0&&this.registerOverflowTop(o*-1)&&(e=!0)}return e}topPadding=0;bottomPadding=0;doLayout(){if(!this.bar)return;this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new El,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new El,this._postBeatGlyphs.renderer=this;for(let s=0;s<this.bar.voices.length;s++){const a=this.bar.voices[s];if(this.hasVoiceContainer(a)){const o=new t3(0,0,a);o.renderer=this,this._voiceContainers.set(this.bar.voices[s].index,o)}}if(this.bar.simileMark===rs.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.additionalMultiRestBars){const s=new kg(this.getVoiceContainer(this.bar.voices[0]));this.addBeatGlyph(s)}else this.createBeatGlyphs();this.createPostBeatGlyphs(),this.updateSizes();for(const s of this.helpers.beamHelpers)for(const a of s)a.finish();this.computedWidth=this.width;const e=this.height,t=this._preBeatGlyphs.glyphs;if(t)for(const s of t){const a=s.getBoundingBoxTop();a<0&&this.registerOverflowTop(a*-1);const o=a+s.height;o>e&&this.registerOverflowBottom(o-e)}const i=this._postBeatGlyphs.glyphs;if(i)for(const s of i){const a=s.getBoundingBoxTop();a<0&&this.registerOverflowTop(a*-1);const o=a+s.height;o>e&&this.registerOverflowBottom(o-e)}}hasVoiceContainer(e){return this.additionalMultiRestBars||e.index===0?!0:!e.isEmpty}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);const e=this._voiceContainers,t=this.beatGlyphsStart;let i=t;for(const s of e.values()){s.x=t,s.doLayout();const a=s.x+s.width;i<a&&(i=a)}this._postBeatGlyphs.x=Math.floor(i),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height,this.height=Math.ceil(this.height)}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){return this.getVoiceContainer(e.voice)?.beatGlyphs?.[e.index]}getPreNotesGlyphForBeat(e){return this.getBeatContainer(e)?.preNotes}getOnNotesGlyphForBeat(e){return this.getBeatContainer(e)?.onNotes}paint(e,t,i){this.paintBackground(e,t,i),i.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,i);for(const s of this._voiceContainers.values())s.paint(e+this.x,t+this.y,i);i.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,i)}paintBackground(e,t,i){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,i)}buildBoundingsLookup(e,t,i){const s=new Hx;s.bar=this.bar,s.visualBounds=new Os,s.visualBounds.x=t+this.x,s.visualBounds.y=i+this.y+this.topPadding,s.visualBounds.w=this.width,s.visualBounds.h=this.height-this.topPadding-this.bottomPadding,s.realBounds=new Os,s.realBounds.x=t+this.x,s.realBounds.y=i+this.y,s.realBounds.w=this.width,s.realBounds.h=this.height,e.addBar(s);for(const[a,o]of this._voiceContainers){const c=this.bar.isEmpty&&a===0;if(!o.voice.isEmpty||c)for(let h=0,d=o.beatGlyphs.length;h<d;h++)o.beatGlyphs[h].buildBoundingsLookup(s,t+this.x+o.x,i+this.y+o.y,c)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=lt.PreNotes){const i=this.getBeatContainer(e);if(i)switch(t){case lt.PreNotes:return i.voiceContainer.x+i.x;case lt.OnNotes:return i.voiceContainer.x+i.x+i.onNotes.x;case lt.MiddleNotes:return i.voiceContainer.x+i.x+i.onTimeX;case lt.Stem:const s=i.onNotes.beamingHelper?i.onNotes.beamingHelper.getBeatLineX(e):i.onNotes.x+i.onNotes.width/2;return i.voiceContainer.x+s;case lt.PostNotes:return i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.width;case lt.EndBeat:return i.voiceContainer.x+i.x+i.width}return 0}getRatioPositionX(e){const t=this.bar.isEmpty?this.beatGlyphsStart:this.getBeatX(this.bar.voices[0].beats[0],lt.OnNotes),i=t,s=this.postBeatGlyphsStart-t;return i+s*e}getNoteX(e,t){const i=this.getBeatContainer(e.beat);return i?i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.getNoteX(e,t):0}getNoteY(e,t){const i=this.getOnNotesGlyphForBeat(e.beat);return i?i.getNoteY(e,t):Number.NaN}reLayout(){(this.wasFirstOfLine&&!this.isFirstOfLine||!this.wasFirstOfLine&&this.isFirstOfLine)&&this.recreatePreBeatGlyphs(),this.updateSizes(),this.registerLayoutingInfo()}recreatePreBeatGlyphs(){this._preBeatGlyphs=new El,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()}paintSimileMark(e,t,i){const s=ht.voice(i,jc.Glyphs,this.bar.voices[0],!0);try{switch(this.bar.simileMark){case rs.Simple:i.beginGroup(Da.getGroupId(this.bar.voices[0].beats[0])),vi.fillMusicFontSymbolSafe(i,e+this.x+this.width/2,t+this.y+this.height/2,1,S.Repeat1Bar,!0),i.endGroup();break;case rs.SecondOfDouble:i.beginGroup(Da.getGroupId(this.bar.voices[0].beats[0])),i.beginGroup(Da.getGroupId(this.bar.previousBar.voices[0].beats[0])),vi.fillMusicFontSymbolSafe(i,e+this.x,t+this.y+this.height/2,1,S.Repeat2Bars,!0),i.endGroup(),i.endGroup();break}}finally{s?.[Symbol.dispose]?.()}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}var ft;(function(n){n[n.SinglePreBeat=0]="SinglePreBeat",n[n.SingleOnBeat=1]="SingleOnBeat",n[n.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",n[n.GroupedOnBeat=3]="GroupedOnBeat",n[n.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",n[n.FullBar=5]="FullBar"})(ft||(ft={}));class b3 extends Vi{_uniqueEffectGlyphs=[];_effectGlyphs=[];isEmpty=!0;previousBand=null;isLinkedToPrevious=!1;firstBeat=null;lastBeat=null;height=0;originalHeight=0;voice;info;slot=null;constructor(e,t){super(0,0),this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||this.renderer.staff.trackIndex===0)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case ft.SingleOnBeatToEnd:case ft.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat);break}const t=this._createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height,this.originalHeight=t.height)}}resetHeight(){this.height=this.originalHeight}_createOrResizeGlyph(e,t){let i;switch(e){case ft.FullBar:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case ft.SinglePreBeat:case ft.SingleOnBeat:case ft.SingleOnBeatToEnd:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case ft.GroupedOnBeat:case ft.GroupedOnBeatToEnd:const s=e===ft.GroupedOnBeat?ft.SingleOnBeat:ft.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){const a=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,a)){let o=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(a.index))o=this._effectGlyphs[t.voice.index].get(a.index);else if(this.renderer.index>0){const d=this.renderer.previousRenderer.getBand(a.voice,this.info.effectId);if(d){const p=d._effectGlyphs[a.voice.index];p.has(a.index)&&(o=p.get(a.index))}}const c=this._createOrResizeGlyph(s,t);return o&&this.info.canExpand(a,t)&&(o.nextGlyph=c,c.previousGlyph=o,this.isLinkedToPrevious=!0),c}return this._createOrResizeGlyph(s,t)}return this._createOrResizeGlyph(s,t);default:return this._createOrResizeGlyph(ft.SingleOnBeat,t)}}paint(e,t,i){super.paint(e,t,i);for(let s=0,a=this._uniqueEffectGlyphs.length;s<a;s++){const o=this._uniqueEffectGlyphs[s];for(let c=0,h=o.length;c<h;c++){const d=o[c],p=ht.beat(i,ti.Effects,d.beat,!1);try{d.paint(e+this.x,t+this.y,i)}finally{p?.[Symbol.dispose]?.()}}}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this._alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}_alignGlyph(e,t){const i=this._effectGlyphs[t.voice.index].get(t.index),s=this.renderer.getBeatContainer(t);switch(e){case ft.SinglePreBeat:const a=this.renderer.layoutingInfo.getPreBeatSize(t);i.x=this.renderer.beatGlyphsStart+s.x-a;break;case ft.SingleOnBeat:case ft.GroupedOnBeat:i.x=this.renderer.beatGlyphsStart+s.x;break;case ft.SingleOnBeatToEnd:case ft.GroupedOnBeatToEnd:if(i.x=this.renderer.beatGlyphsStart+s.x,s.beat.isLastOfVoice)i.width=this.renderer.width-i.x;else{const o=this.renderer.layoutingInfo.getPostBeatSize(t);i.width=o}break;case ft.FullBar:i.width=this.renderer.width;break}}}class S3{uniqueEffectId=null;y=0;height=0;firstBeat=null;lastBeat=null}class _3{bands;shared;constructor(){this.bands=[],this.shared=new S3}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class k3{_effectSlot;slots;constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){const i=this._effectSlot.get(e.info.effectId);if(i.canBeUsed(e))return i}for(const i of this.slots)if(i.canBeUsed(e))return i;const t=new _3;return this.slots.push(t),t}register(e){const t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class w3 extends Hp{_infos;_bands=[];_bandLookup=new Map;sizingInfo=null;constructor(e,t,i){super(e,t),this._infos=i}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this._updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this._updateHeight()&&(e=!0),e}_updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(const t of this.sizingInfo.slots){t.shared.y=e;for(const i of t.bands)i.y=e,i.height=t.shared.height;e+=t.shared.height+this.settings.display.effectBandPaddingBottom}return e=Math.ceil(e),e!==this.height?(this.height=e,!0):!1}applyLayoutingInfo(){const e=!super.applyLayoutingInfo();if(this.index>0){const t=this.previousRenderer;this.sizingInfo=t.sizingInfo}else this.sizingInfo=new k3;for(const t of this._bands)t.resetHeight(),t.alignGlyphs(),t.isEmpty||this.sizingInfo.register(t);return this._updateHeight(),e}scaleToWidth(e){super.scaleToWidth(e);for(const t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(const e of this.bar.voices)if(this.hasVoiceContainer(e))for(const t of this._infos){const i=new b3(e,t);i.renderer=this,i.doLayout(),this._bands.push(i),this._bandLookup.set(`${e.index}.${t.effectId}`,i)}super.createBeatGlyphs();for(const e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(const t of e.beats){const i=new Da(t,this.getVoiceContainer(e));i.preNotes=new tl,i.onNotes=new il,this.addBeatGlyph(i);for(const s of this._bands)s.createGlyph(t)}}paint(e,t,i){this.paintBackground(e,t,i);for(const s of this._bands)i.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isEmpty||s.paint(e+this.x,t+this.y,i)}getBand(e,t){const i=`${e.index}.${t}`;return this._bandLookup.has(i)?this._bandLookup.get(i):null}}class Bl extends nd{infos;_staffId;get staffId(){return this._staffId}shouldShow;getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t,i=null){super(),this.infos=t,this._staffId=e,this.isInsideBracket=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=i}canCreate(e,t){const i=this.shouldShow;return super.canCreate(e,t)&&(!i||i(e,t))}create(e,t){return new w3(e,t,this.infos.filter(i=>e.settings.notation.isNotationElementVisible(i.notationElement)))}}class B3 extends Xn{_endings;_endingsString="";_openLine;_closeLine;_indent;constructor(e,t,i,s,a,o){super(e,t),this._endings=ce.getAlternateEndingsList(i),this._openLine=s,this._closeLine=a,this._indent=o}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+this.renderer.smuflMetrics.alternateEndingsPadding*2;let e="";for(let t=0,i=this._endings.length;t<i;t++)e+=this._endings[t]+1,e+=". ";this._endingsString=e}paint(e,t,i){let s=this._closeLine?this.width-i.lineWidth:this.width;if(this.renderer.bar.getActualBarLineRight()===et.LightHeavy&&(s-=this.renderer.smuflMetrics.thickBarlineThickness+this.renderer.smuflMetrics.barlineSeparation),e=(e|0)+i.lineWidth/2,t=(t|0)+i.lineWidth/2,this._indent&&(e+=this.renderer.smuflMetrics.alternateEndingsPadding,s-=this.renderer.smuflMetrics.alternateEndingsPadding),this._openLine?(i.moveTo(e+this.x,t+this.y+this.height),i.lineTo(e+this.x,t+this.y)):i.moveTo(e+this.x,t+this.y),i.lineTo(e+this.x+s,t+this.y),this._closeLine&&i.lineTo(e+this.x+s,t+this.y+this.height),i.stroke(),this._openLine){const o=i.textBaseline;i.textBaseline=Wt.Top;const c=this.renderer.resources;i.font=c.wordsFont,i.fillText(this._endingsString,e+this.x+this.renderer.smuflMetrics.alternateEndingsPadding,t+this.y+this.renderer.smuflMetrics.alternateEndingsPadding),i.textBaseline=o}}}class Di{get effectId(){return this.notationElement.toString()}}class T3 extends Di{get notationElement(){return rt.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return ft.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.alternateEndings!==0}createNewGlyph(e,t){const i=t.voice.bar.masterBar,s=i.previousMasterBar===null||i.alternateEndings!==i.previousMasterBar.alternateEndings;let a=i.isRepeatEnd||i.nextMasterBar===null||i.alternateEndings!==i.nextMasterBar.alternateEndings;i.repeatGroup.closings.some(c=>c.index>=i.index)||(a=!1);const o=i.previousMasterBar!==null&&i.alternateEndings!==i.previousMasterBar.alternateEndings&&i.previousMasterBar.alternateEndings>0;return new B3(0,0,i.alternateEndings,s,a,o)}canExpand(e,t){return!0}}class ad extends Xn{endPosition;forceGroupedRendering=!1;endOnBarLine=!1;constructor(e){super(),this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,i){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering){this.paintNonGrouped(e,t,i);return}let s;if(!this.isLinkedWithNext&&this.forceGroupedRendering)s=this;else for(s=this.nextGlyph;s.isLinkedWithNext;)s=s.nextGlyph;const a=s.renderer,o=s.beat,c=this.endPosition,h=e-this.renderer.x,d=this.calculateEndX(a,o,h,c);this.paintGrouped(e,t,d,i)}calculateEndX(e,t,i,s){return t?i+e.x+e.getBeatX(t,s):i+e.x+this.x+this.width}paintNonGrouped(e,t,i){const s=e-this.renderer.x,a=this.calculateEndX(this.renderer,this.beat,s,this.endPosition);this.paintGrouped(e,t,a,i)}}class Hl extends ad{_label;_dashed;_labelWidth=0;constructor(e,t=!0){super(lt.OnNotes),this._label=e,this._dashed=t}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=lt.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.renderer.scoreRenderer.canvas.font=this.renderer.resources.effectFont;const e=this.renderer.scoreRenderer.canvas.measureText(this._label);this.height=e.height,this._labelWidth=e.width}paintNonGrouped(e,t,i){const s=this.renderer.resources;i.font=s.effectFont;const a=i.textBaseline;i.textBaseline=Wt.Middle,i.fillText(this._label,e+this.x-this._labelWidth/2,t+this.y+this.height/2),i.textBaseline=a}paintGrouped(e,t,i,s){this.paintNonGrouped(e,t,s);const a=this.renderer.smuflMetrics.lineRangedGlyphDashGap,o=this.renderer.smuflMetrics.lineRangedGlyphDashSize,c=this.renderer.smuflMetrics.pedalLineThickness,h=e+this.x+this._labelWidth/2+a/2,d=t+this.y+this.height/2-c/2;if(this._dashed){if(i>h){let p=h;for(;p<i;){const g=Math.min(p+o,i);s.fillRect(p,d,g-p,c),p+=o+a}s.fillRect(i,d-o/2+c/2,c,o)}}else s.fillRect(h,d,i-h,c),s.fillRect(i-c,d,c,o/2)}}class zp extends Di{get notationElement(){return rt.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isBarre}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){let i="";switch(t.barreShape){case Yn.None:case Yn.Full:break;case Yn.Half:i+="1/2";break}return i+=`B ${zp.toRoman(t.barreFret)}`,new Hl(i,!1)}static _romanLetters=new Map([["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]]);static toRoman(e){let t="";if(e>0)for(const[i,s]of zp._romanLetters){const a=Math.floor(e/s);e-=a*s,t+=i.repeat(a)}return t}canExpand(e,t){return e.barreFret===t.barreFret&&e.barreShape===t.barreShape}}class x3 extends Xn{_timer;_text="";_textWidth=0;_textHeight=0;constructor(e){super(0,0),this._timer=e}doLayout(){const e=this._timer/6e4|0,t=(this._timer-e*6e4)/1e3|0;this._text=`${e}:${t.toString().padStart(2,"0")}`;const i=this.renderer.scoreRenderer.canvas;i.font=this.renderer.resources.timerFont;const s=i.measureText(this._text);this._textHeight=i.font.size+this.renderer.smuflMetrics.beatTimerPadding*2,this._textWidth=s.width+this.renderer.smuflMetrics.beatTimerPadding*2,this.height=this._textHeight+this.renderer.smuflMetrics.beatTimerPadding*2}paint(e,t,i){const s=this._textWidth/2|0;i.strokeRect(e+this.x-s,t+this.y+this.renderer.smuflMetrics.beatTimerPadding,this._textWidth,this._textHeight);const a=i.font,o=i.textBaseline,c=i.textAlign;i.font=this.renderer.resources.timerFont,i.textBaseline=Wt.Middle,i.textAlign=Ce.Center,i.fillText(this._text,e+this.x,t+this.y+this.height/2),i.font=a,i.textBaseline=o,i.textAlign=c}}class v3 extends Di{get notationElement(){return rt.EffectBeatTimer}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.showTimer}createNewGlyph(e,t){return new x3(t.timer??0)}canExpand(e,t){return!0}}class N3 extends Di{get notationElement(){return rt.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.index===0&&t.voice.bar.index===0&&t.voice.bar.staff.capo!==0}createNewGlyph(e,t){return new ha(0,0,`Capo. fret ${t.voice.bar.staff.capo}`,e.resources.effectFont,Ce.Left)}canExpand(e,t){return!1}}class C3 extends Di{get notationElement(){return rt.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new ha(0,0,t.chord.name,e.resources.effectFont,Ce.Center)}canExpand(e,t){return!1}}class E3 extends ad{_crescendo;constructor(e,t,i){super(lt.EndBeat),this._crescendo=Ds.None,this._crescendo=i,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.DynamicCrescendoHairpin)}paintGrouped(e,t,i,s){const a=e+this.x,o=this.height,c=this.renderer.smuflMetrics.glyphWidths.get(S.NoteheadBlack)/2;s.beginPath(),this._crescendo===Ds.Crescendo?(i-=c,s.moveTo(i,t+this.y),s.lineTo(a,t+this.y+o/2),s.lineTo(i,t+this.y+o)):(i-=c,s.moveTo(a,t+this.y),s.lineTo(i,t+this.y+o/2),s.lineTo(a,t+this.y+o));const h=s.lineWidth;s.lineWidth=this.renderer.smuflMetrics.hairpinThickness,s.stroke(),s.lineWidth=h}}class P3 extends Di{get notationElement(){return rt.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==Ds.None}createNewGlyph(e,t){return new E3(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class Af extends Vi{_symbols;_scale=1;constructor(e){super(0,0),this._symbols=e}doLayout(){this.height=0;const e=this.renderer.smuflMetrics.directionsScale;this._scale=e;for(const t of this._symbols){const i=this.renderer.smuflMetrics.glyphHeights.get(t)*e;i>this.height&&(this.height=i)}}paint(e,t,i){i.fillMusicFontSymbols(e+this.x,t+this.y+this.height,this._scale,this._symbols,!0)}}class En extends Vi{_text;constructor(e){super(0,0),this._text=e}doLayout(){const e=this.renderer.scoreRenderer.canvas;e.font=this.renderer.resources.directionsFont,this.height=e.measureText(this._text).height}paint(e,t,i){const s=i.font,a=i.textBaseline,o=i.textAlign;i.font=this.renderer.resources.directionsFont,i.textBaseline=Wt.Middle,i.textAlign=Ce.Right,i.fillText(this._text,e+this.x,t+this.y+this.height/2),i.font=s,i.textBaseline=a,i.textAlign=o}}class D3 extends Xn{_directions;_barBeginGlyphs=[];_barEndGlyphs=[];constructor(e,t,i){super(e,t),this._directions=i}doLayout(){const e=this._directions;e.has(Te.TargetSegnoSegno)&&this._barBeginGlyphs.push(new Af([S.Segno,S.Segno])),e.has(Te.TargetSegno)&&this._barBeginGlyphs.push(new Af([S.Segno])),e.has(Te.TargetDoubleCoda)&&this._barBeginGlyphs.push(new Af([S.Coda,S.Coda])),e.has(Te.TargetCoda)&&this._barBeginGlyphs.push(new Af([S.Coda])),e.has(Te.TargetFine)&&this._barEndGlyphs.push(new En("Fine")),e.has(Te.JumpDaDoubleCoda)&&this._barEndGlyphs.push(new En("To Double Coda")),e.has(Te.JumpDaCoda)&&this._barEndGlyphs.push(new En("To Coda")),e.has(Te.JumpDalSegnoSegno)&&this._barEndGlyphs.push(new En("D.S.S.")),e.has(Te.JumpDalSegnoSegnoAlCoda)&&this._barEndGlyphs.push(new En("D.S.S. al Coda")),e.has(Te.JumpDalSegnoSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new En("D.S.S. al Double Coda")),e.has(Te.JumpDalSegnoSegnoAlFine)&&this._barEndGlyphs.push(new En("D.S.S. al Fine")),e.has(Te.JumpDalSegno)&&this._barEndGlyphs.push(new En("D.S.")),e.has(Te.JumpDalSegnoAlCoda)&&this._barEndGlyphs.push(new En("D.S. al Coda")),e.has(Te.JumpDalSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new En("D.S. al Double Coda")),e.has(Te.JumpDalSegnoAlFine)&&this._barEndGlyphs.push(new En("D.S. al Fine")),e.has(Te.JumpDaCapo)&&this._barEndGlyphs.push(new En("D.C.")),e.has(Te.JumpDaCapoAlCoda)&&this._barEndGlyphs.push(new En("D.C. al Coda")),e.has(Te.JumpDaCapoAlDoubleCoda)&&this._barEndGlyphs.push(new En("D.C. al Double Coda")),e.has(Te.JumpDaCapoAlFine)&&this._barEndGlyphs.push(new En("D.C. al Fine"));const t=this._doSideLayout(this._barBeginGlyphs),i=this._doSideLayout(this._barEndGlyphs);this.height=Math.max(t,i)}_doSideLayout(e){let t=0;const i=this.renderer.settings.display.effectBandPaddingBottom;for(const s of e)s.y=t,s.renderer=this.renderer,s.doLayout(),t+=s.height+i;return t}paint(e,t,i){for(const s of this._barBeginGlyphs)s.paint(e+this.x,t+this.y,i);for(const s of this._barEndGlyphs)s.paint(e+this.x+this.width,t+this.y,i)}}class M3 extends Di{get notationElement(){return rt.EffectDirections}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return ft.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.directions!==null&&t.voice.bar.masterBar.directions.size>0}createNewGlyph(e,t){return new D3(0,0,t.voice.bar.masterBar.directions)}canExpand(e,t){return!0}}class Gb extends ns{constructor(e,t,i){super(e,t,1,Gb._getSymbol(i))}doLayout(){super.doLayout(),this.center=!0,this.height=this.renderer.smuflMetrics.glyphHeights.get(S.DynamicForte);const e=this.renderer.smuflMetrics.glyphTop.get(S.DynamicForte);this.offsetY=e}static _getSymbol(e){switch(e){case Oe.PPP:return S.DynamicPPP;case Oe.PP:return S.DynamicPP;case Oe.P:return S.DynamicPiano;case Oe.MP:return S.DynamicMP;case Oe.MF:return S.DynamicMF;case Oe.F:return S.DynamicForte;case Oe.FF:return S.DynamicFF;case Oe.FFF:return S.DynamicFFF;case Oe.PPPP:return S.DynamicPPPP;case Oe.PPPPP:return S.DynamicPPPPP;case Oe.PPPPPP:return S.DynamicPPPPP;case Oe.FFFF:return S.DynamicFFFF;case Oe.FFFFF:return S.DynamicFFFFF;case Oe.FFFFFF:return S.DynamicFFFFFF;case Oe.SF:return S.DynamicSforzando1;case Oe.SFP:return S.DynamicSforzandoPiano;case Oe.SFPP:return S.DynamicSforzandoPianissimo;case Oe.FP:return S.DynamicFortePiano;case Oe.RF:return S.DynamicRinforzando1;case Oe.RFZ:return S.DynamicRinforzando2;case Oe.SFZ:return S.DynamicSforzato;case Oe.SFFZ:return S.DynamicSforzatoFF;case Oe.FZ:return S.DynamicForzando;case Oe.N:return S.DynamicNiente;case Oe.PF:return S.DynamicPF;case Oe.SFZP:return S.DynamicSforzatoPiano;default:return S.None}}}class L3 extends Di{get notationElement(){return rt.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return this._internalShouldCreateGlyph(t)}_internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest)return!1;const t=this._getPreviousDynamicsBeat(e);let i=e.voice.index===0&&!t||e.dynamics!==t?.dynamics;if(i&&e.voice.index>0){for(const s of e.voice.bar.voices)if(s.index<e.voice.index){const a=s.getBeatAtPlaybackStart(e.playbackStart);a&&e.dynamics===a.dynamics&&this._internalShouldCreateGlyph(a)&&(i=!1)}}return i}_getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;t!=null;){if(!t.isRest)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new Gb(0,0,t.dynamics)}canExpand(e,t){return!0}}class Ub extends ns{constructor(e){super(0,0,1,Ub._getSymbol(e)),this.center=!0}static _getSymbol(e){switch(e){case Xi.FadeIn:return S.GuitarFadeIn;case Xi.FadeOut:return S.GuitarFadeOut;case Xi.VolumeSwell:return S.GuitarVolumeSwell}return S.None}paint(e,t,i){super.paint(e,t+this.height,i)}}class A3 extends Di{get notationElement(){return rt.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.fade!==Xi.None}createNewGlyph(e,t){return new Ub(t.fade)}canExpand(e,t){return!0}}class Yb extends ns{constructor(e,t,i){super(e,t,1,Yb._getSymbol(i))}static _getSymbol(e){switch(e){case mn.Short:return S.FermataShortAbove;case mn.Medium:return S.FermataAbove;case mn.Long:return S.FermataLongAbove;default:return S.None}}paint(e,t,i){super.paint(e-this.width/2,t+this.height,i)}}class R3 extends Di{get notationElement(){return rt.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index===0&&!!t.fermata}createNewGlyph(e,t){return new Yb(0,0,t.fermata.type)}canExpand(e,t){return!0}}class O3{line=0;symbols;color;constructor(e,t){this.line=e,this.symbols=t}}class Gh extends ja{_infos=new Map;constructor(){super(0,0)}get isEmpty(){return this._infos.size===0}addFingers(e){const t=this.renderer.settings;if(t.notation.fingeringMode!==$a.ScoreDefault&&t.notation.fingeringMode!==$a.ScoreForcePiano)return;const i=Gh.fingerToMusicFontSymbol(this.renderer.settings,e.beat,e.leftHandFinger,!0);i!==S.None&&this._addFinger(e,i);const s=Gh.fingerToMusicFontSymbol(this.renderer.settings,e.beat,e.rightHandFinger,!1);s!==S.None&&this._addFinger(e,s)}static fingerToMusicFontSymbol(e,t,i,s){if(e.notation.fingeringMode===$a.ScoreForcePiano||e.notation.fingeringMode===$a.SingleNoteEffectBandForcePiano||vn.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(i){case Fe.Unknown:case Fe.NoOrDead:return S.None;case Fe.Thumb:return S.Fingering1;case Fe.IndexFinger:return S.Fingering2;case Fe.MiddleFinger:return S.Fingering3;case Fe.AnnularFinger:return S.Fingering4;case Fe.LittleFinger:return S.Fingering5;default:return S.None}if(s)switch(i){case Fe.Unknown:return S.None;case Fe.NoOrDead:return S.Fingering0;case Fe.Thumb:return S.FingeringTLower;case Fe.IndexFinger:return S.Fingering1;case Fe.MiddleFinger:return S.Fingering2;case Fe.AnnularFinger:return S.Fingering3;case Fe.LittleFinger:return S.Fingering4;default:return S.None}switch(i){case Fe.Unknown:case Fe.NoOrDead:return S.None;case Fe.Thumb:return S.FingeringPLower;case Fe.IndexFinger:return S.FingeringILower;case Fe.MiddleFinger:return S.FingeringMLower;case Fe.AnnularFinger:return S.FingeringALower;case Fe.LittleFinger:return S.FingeringCLower;default:return S.None}}_addFinger(e,t){const i=this.renderer,s=i.getNoteLine(e);if(this._infos.has(s))this._infos.get(s).symbols.push(t);else{const a=new O3(s,[t]);a.color=ht.noteColor(i.resources,Js.StandardNotationEffects,e),this._infos.set(s,a)}}doLayout(){const e=this.renderer;for(const[t,i]of this._infos){const s=new WR(0,0,1,i.symbols);s.colorOverride=i.color,s.renderer=e,s.y=e.getScoreY(i.line),s.doLayout(),s.offsetY=s.height/2,this.addGlyph(s),this.width=Math.max(this.width,s.width)}for(const t of this.glyphs){const i=t;i.x=this.width/2,i.center=!0}}}class F3 extends Di{get notationElement(){return rt.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index!==0||t.isRest||e.notation.fingeringMode!==$a.SingleNoteEffectBand&&e.notation.fingeringMode!==$a.SingleNoteEffectBandForcePiano||t.notes.length!==1?!1:t.notes[0].isFingering}createNewGlyph(e,t){let i=Fe.Unknown,s=!1;const a=t.notes[0];a.leftHandFinger!==Fe.Unknown?(i=a.leftHandFinger,s=!0):a.rightHandFinger!==Fe.Unknown&&(i=a.rightHandFinger);const o=Gh.fingerToMusicFontSymbol(e.settings,t,i,s),c=new ns(0,0,1,o);return c.center=!0,c.renderer=e,c.doLayout(),c.offsetY=e.smuflMetrics.glyphTop.get(c.symbol),c}canExpand(e,t){return!0}}class I3 extends Di{get notationElement(){return rt.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SinglePreBeat}shouldCreateGlyph(e,t){const i=t.voice.bar.masterBar;return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&i.isFreeTime&&(i.index===0||i.isFreeTime!==i.previousMasterBar.isFreeTime)}createNewGlyph(e,t){return new ha(0,0,"Free time",e.resources.effectFont,Ce.Left)}canExpand(e,t){return!0}}class Sv extends ns{constructor(e,t,i=!1){super(e,t,Ct.GraceScale,S.GuitarGolpe),this.center=i}doLayout(){super.doLayout(),this.offsetY=this.height}}class Rf extends Di{_type;_shouldCreate;constructor(e,t){super(),this._type=e,this._shouldCreate=t}get notationElement(){return rt.EffectGolpe}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){const i=this._shouldCreate;return t.golpe===this._type&&(!i||i(e,t))}createNewGlyph(e,t){return new Sv(0,0,!0)}canExpand(e,t){return!1}}class zl extends Di{lastCreateInfo=null;shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let i=0,s=t.notes.length;i<s;i++){const a=t.notes[i];this.shouldCreateGlyphForNote(a)&&this.lastCreateInfo.push(a)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}class Io extends zl{_harmonicType;_beat=null;_effectId;get effectId(){return this._effectId}get notationElement(){return rt.EffectHarmonics}constructor(e){switch(super(),this._harmonicType=e,e){case Re.None:this._effectId="harmonics-none";break;case Re.Natural:this._effectId="harmonics-natural";break;case Re.Artificial:this._effectId="harmonics-artificial";break;case Re.Pinch:this._effectId="harmonics-pinch";break;case Re.Tap:this._effectId="harmonics-tap";break;case Re.Semi:this._effectId="harmonics-semi";break;case Re.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId="";break}}shouldCreateGlyphForNote(e){return!e.isHarmonic||e.harmonicType!==this._harmonicType?!1:(e.beat!==this._beat&&(this._beat=e.beat),!0)}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){return new Hl(Io.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case Re.Natural:return"N.H.";case Re.Artificial:return"A.H.";case Re.Pinch:return"P.H.";case Re.Tap:return"T.H.";case Re.Semi:return"S.H.";case Re.Feedback:return"Fdbk."}return""}}class W3 extends ns{constructor(){super(0,0,1,S.GuitarLeftHandTapping),this.center=!0}doLayout(){super.doLayout(),this.offsetY=this.renderer.smuflMetrics.glyphTop.get(this.symbol)}}class GB extends zl{get notationElement(){return rt.EffectTap}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new W3}}class V3 extends Di{get notationElement(){return rt.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){return new Hl("LetRing")}canExpand(e,t){return!0}}class H3 extends Xn{_lines;font;textAlign;constructor(e,t,i,s,a=Ce.Center){super(e,t),this._lines=i,this.font=s,this.textAlign=a}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,i){i.font=this.font;const s=i.textAlign;i.textAlign=this.textAlign;for(let a=0;a<this._lines.length;a++)this._lines[a]&&i.fillText(this._lines[a],e+this.x,t+this.y+a*this.font.size);i.textAlign=s}}class z3 extends Di{get notationElement(){return rt.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new H3(0,0,t.lyrics,e.resources.effectFont,Ce.Center)}canExpand(e,t){return!0}}class G3 extends Di{get notationElement(){return rt.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return ft.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new ha(0,0,t.voice.bar.masterBar.section.marker?`[${t.voice.bar.masterBar.section.marker}] ${t.voice.bar.masterBar.section.text}`:t.voice.bar.masterBar.section.text,e.resources.markerFont,Ce.Left)}canExpand(e,t){return!0}}class $b extends ns{constructor(e){super(0,0,1,$b._getSymbol(e)),this.center=!0}static _getSymbol(e){switch(e){case fi.InvertedTurn:return S.OrnamentTurnInverted;case fi.Turn:return S.OrnamentTurn;case fi.UpperMordent:return S.OrnamentShortTrill;case fi.LowerMordent:return S.OrnamentMordent}return S.None}doLayout(){super.doLayout(),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.OrnamentMordent),this.offsetY=this.renderer.smuflMetrics.glyphTop.get(S.OrnamentMordent)}}class U3 extends Di{get notationElement(){return rt.EffectNoteOrnament}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.notes.some(i=>i.ornament!==fi.None)}createNewGlyph(e,t){return new $b(t.notes.find(i=>i.ornament!==fi.None).ornament)}canExpand(e,t){return!1}}class Y3 extends ad{_ottava;_aboveStaff;constructor(e,t){super(lt.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.QuindicesimaAlta)}paintNonGrouped(e,t,i){this._paintOttava(e,t,i)}_paintOttava(e,t,i){let s=0;switch(this._ottava){case Ye._15ma:s=this.renderer.smuflMetrics.glyphWidths.get(S.QuindicesimaAlta),vi.fillMusicFontSymbolSafe(i,e+this.x-s/2,t+this.y+this.height,1,S.QuindicesimaAlta,!1);break;case Ye._8va:s=this.renderer.smuflMetrics.glyphWidths.get(S.OttavaAlta),vi.fillMusicFontSymbolSafe(i,e+this.x-s/2,t+this.y+this.height,1,S.OttavaAlta,!1);break;case Ye._8vb:s=this.renderer.smuflMetrics.glyphWidths.get(S.OttavaBassaVb),vi.fillMusicFontSymbolSafe(i,e+this.x-s/2,t+this.y+this.height,1,S.OttavaBassaVb,!1);break;case Ye._15mb:s=(this.renderer.smuflMetrics.glyphWidths.get(S.Quindicesima)+this.renderer.smuflMetrics.glyphWidths.get(S.OctaveBaselineM)+this.renderer.smuflMetrics.glyphWidths.get(S.OctaveBaselineB))*1,vi.fillMusicFontSymbolsSafe(i,e+this.x-s/2,t+this.y+this.height,1,[S.Quindicesima,S.OctaveBaselineM,S.OctaveBaselineB],!1);break}return s/2}paintGrouped(e,t,i,s){const a=this._paintOttava(e,t,s),o=this.renderer.smuflMetrics.lineRangedGlyphDashGap,c=e+this.x+a+o;let h=t+this.y;const d=this.height*.5;h+=this._aboveStaff?0:this.height;const p=this.renderer.smuflMetrics.lineRangedGlyphDashSize,g=s.lineWidth;if(s.lineWidth=this.renderer.smuflMetrics.octaveLineThickness,i>c){let y=c;for(;y<i;)s.beginPath(),s.moveTo(y,h|0),s.lineTo(Math.min(y+p,i),h|0),y+=p+o,s.stroke();s.beginPath(),this._aboveStaff?(s.moveTo(i,h),s.lineTo(i,h+d)):(s.moveTo(i,h),s.lineTo(i,h-d)),s.stroke()}s.lineWidth=g}}class UB extends Di{_aboveStaff;get effectId(){return`ottavia-${this._aboveStaff?"above":"below"}`}get notationElement(){return rt.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case Ye._15ma:return this._aboveStaff;case Ye._8va:return this._aboveStaff;case Ye._8vb:return!this._aboveStaff;case Ye._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new Y3(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class $3 extends zl{get notationElement(){return rt.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){return new Hl("P.M.")}}class X3 extends zl{get notationElement(){return rt.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===$e.PickSlideDown||e.slideOutType===$e.PickSlideUp}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){return new Hl("P.S.")}}class Uh extends ns{constructor(e,t,i){super(e,t,Ct.GraceScale,Uh._getSymbol(i)),this.center=!0}doLayout(){super.doLayout(),this.offsetY=this.height}static _getSymbol(e){switch(e){case ds.Up:return S.StringsUpBow;case ds.Down:return S.StringsDownBow;default:return S.None}}}class q3 extends Di{get notationElement(){return rt.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==ds.None}createNewGlyph(e,t){return new Uh(0,0,t.pickStroke)}canExpand(e,t){return!0}}class J3 extends Di{get notationElement(){return rt.EffectRasgueado}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.hasRasgueado}get sizingMode(){return ft.GroupedOnBeat}createNewGlyph(e,t){return new Hl("rasg.")}canExpand(e,t){return!0}}class _v extends ad{_type;_symbol=S.None;_repeatOffsetX=0;_symbolOffsetY=0;_partialWaves;constructor(e,t,i,s=!1){super(lt.EndBeat),this._type=i,this.x=e,this.y=t,this._partialWaves=s}doLayout(){switch(super.doLayout(),this._type){case ct.Slight:this._symbol=this.slightVibratoGlyph;break;case ct.Wide:this._symbol=this.wideVibratoGlyph;break}this._repeatOffsetX=this.renderer.smuflMetrics.repeatOffsetX.get(this._symbol),this._symbolOffsetY=this.renderer.smuflMetrics.glyphTop.get(this._symbol),this.height=this.renderer.smuflMetrics.glyphHeights.get(this._symbol)}paintGrouped(e,t,i,s){const a=e+this.x,o=i-a,c=this._repeatOffsetX;let h=o/c;this._partialWaves||(h=Math.floor(h)),h<1&&(h=1);const d=[];for(let p=0;p<h;p++)d.push(this._symbol);s.fillMusicFontSymbols(e+this.x,t+this.y+this._symbolOffsetY,1,d,!1)}}class jo extends _v{get slightVibratoGlyph(){return S.GuitarVibratoStroke}get wideVibratoGlyph(){return S.GuitarWideVibratoStroke}}class kv extends _v{get slightVibratoGlyph(){return S.WiggleSawtoothNarrow}get wideVibratoGlyph(){return S.WiggleSawtooth}}class YB extends Di{get notationElement(){return rt.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===ct.Slight}createNewGlyph(e,t){return new kv(0,0,ct.Slight)}canExpand(e,t){return!0}}class $B extends zl{_hideOnTiedBend;get notationElement(){return rt.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){let t=e.vibrato===ct.Slight||e.isTieDestination&&e.tieOrigin.vibrato===ct.Slight;return this._hideOnTiedBend&&t&&e.isTieDestination&&e.tieOrigin.hasBend&&(t=!1),t}get sizingMode(){return ft.GroupedOnBeatToEnd}createNewGlyph(e,t){return new jo(0,0,ct.Slight)}constructor(e){super(),this._hideOnTiedBend=e}}class Q3 extends Xn{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.KeyboardPedalPed)}paint(e,t,i){const s=this.renderer,a=t+this.y,o=this.height,c=s.bar.sustainPedals,h=this.renderer.smuflMetrics.glyphWidths.get(S.KeyboardPedalPed),d=this.renderer.smuflMetrics.glyphWidths.get(S.KeyboardPedalUp);let p=0;for(;p<c.length;){let g=c[p];for(;g!=null;){const y=e+this.renderer.getRatioPositionX(g.ratioPosition);let k=0;if(g.pedalType===ai.Down?(vi.fillMusicFontSymbolSafe(i,y,a+o,1,S.KeyboardPedalPed,!0),k=h/2+this.renderer.smuflMetrics.sustainPedalLinePadding):g.pedalType===ai.Up&&(vi.fillMusicFontSymbolSafe(i,y,a+o,1,S.KeyboardPedalUp,!0),k=d/2+this.renderer.smuflMetrics.sustainPedalLinePadding),g.nextPedalMarker)if(g.nextPedalMarker.bar===g.bar){let _=e+this.renderer.getRatioPositionX(g.nextPedalMarker.ratioPosition);switch(g.nextPedalMarker.pedalType){case ai.Down:_-=h/2;break;case ai.Hold:break;case ai.Up:_-=d/2;break}const w=y+k;_>w&&i.fillRect(w,a+o-this.renderer.smuflMetrics.pedalLineThickness,_-w,this.renderer.smuflMetrics.pedalLineThickness)}else{const _=e+this.x+this.width,w=y+k;i.fillRect(w,a+o-this.renderer.smuflMetrics.pedalLineThickness,_-w,this.renderer.smuflMetrics.pedalLineThickness)}if(p===0&&g.previousPedalMarker){const _=e+this.x,w=y-k;i.fillRect(_,a+o-this.renderer.smuflMetrics.pedalLineThickness,w-_,this.renderer.smuflMetrics.pedalLineThickness)}p++,g.nextPedalMarker!=null&&g.nextPedalMarker.bar!==g.bar?(g=null,p=c.length):g=g.nextPedalMarker}}}}class K3 extends Di{get notationElement(){return rt.EffectSustainPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.sustainPedals.length>0}createNewGlyph(e,t){return new Q3}canExpand(e,t){return!0}}class Z3 extends Di{get notationElement(){return rt.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){const i=e.resources;return t.slap?new ha(0,0,"S",i.effectFont,Ce.Center):t.pop?new ha(0,0,"P",i.effectFont,Ce.Center):new ha(0,0,"T",i.effectFont,Ce.Center)}canExpand(e,t){return!0}}class j3 extends Xn{_tempoAutomations;constructor(e){super(0,0),this._tempoAutomations=e}doLayout(){super.doLayout();const e=this.renderer.resources;this.height=this.renderer.smuflMetrics.glyphHeights.get(S.MetNoteQuarterUp)*e.engravingSettings.tempoNoteScale}paint(e,t,i){for(const s of this._tempoAutomations){let a=e+this.renderer.getRatioPositionX(s.ratioPosition);const o=this.renderer.resources;i.font=o.markerFont;const c=t+this.y+this.height+this.renderer.smuflMetrics.glyphBottom.get(S.MetNoteQuarterUp)*o.engravingSettings.tempoNoteScale,h=i.textBaseline;if(i.textBaseline=Wt.Alphabetic,s.text){const d=`${s.text} `,p=i.measureText(d);i.fillText(d,a,c),a+=p.width}else a-=o.engravingSettings.glyphWidths.get(S.MetNoteQuarterUp)/2;vi.fillMusicFontSymbolSafe(i,a,c,o.engravingSettings.tempoNoteScale,S.MetNoteQuarterUp),a+=this.renderer.smuflMetrics.glyphWidths.get(S.MetNoteQuarterUp)*o.engravingSettings.tempoNoteScale,i.fillText(` = ${s.value.toString()}`,a,c),i.textBaseline=h,a+=i.measureText(` = ${s.value.toString()}`).width}}}class eO extends Di{get notationElement(){return rt.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return ft.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.tempoAutomations.some(i=>i.isVisible)}createNewGlyph(e,t){return new j3(t.voice.bar.masterBar.tempoAutomations.filter(i=>i.isVisible))}canExpand(e,t){return!0}}class tO extends Di{get notationElement(){return rt.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new ha(0,0,t.text,e.resources.effectFont,Ce.Left)}canExpand(e,t){return!0}}class iO extends ad{constructor(e,t){super(lt.EndBeat),this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.OrnamentTrill)}paintGrouped(e,t,i,s){const a=this.renderer.smuflMetrics.glyphWidths.get(S.OrnamentTrill),c=e+this.x+a,h=this.renderer.smuflMetrics.repeatOffsetX.get(S.WiggleTrill),d=Math.ceil((i-c)/h),p=[S.OrnamentTrill];for(let g=0;g<d;g++)p.push(S.WiggleTrill);s.fillMusicFontSymbols(e+this.x-a/2,t+this.y+this.height,1,p,!1)}}class XB extends zl{get notationElement(){return rt.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return ft.GroupedOnBeatToEnd}createNewGlyph(e,t){return new iO(0,0)}}var as;(function(n){n[n.EighthEighth=0]="EighthEighth",n[n.SixteenthSixteenth=1]="SixteenthSixteenth",n[n.QuarterTripletEighthTriplet=2]="QuarterTripletEighthTriplet",n[n.EighthSixteenthTriplet=3]="EighthSixteenthTriplet",n[n.EighthDottedSixteenth=4]="EighthDottedSixteenth",n[n.SixteenthDottedThirtySecond=5]="SixteenthDottedThirtySecond",n[n.SixteenthEighthDotted=6]="SixteenthEighthDotted",n[n.ThirtySecondSixteenthDotted=7]="ThirtySecondSixteenthDotted"})(as||(as={}));class sO extends Xn{_tripletFeel;_tupletHeight=0;_tupletPadding=0;constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout();const e=this.renderer.smuflMetrics.tempoNoteScale;this.height=this.renderer.smuflMetrics.glyphHeights.get(S.MetNoteQuarterUp)*e,this._tupletHeight=this.renderer.smuflMetrics.glyphHeights.get(S.Tuplet3)*e,this._tupletPadding=this.renderer.smuflMetrics.tripletFeelBracketPadding,this.height+=this._tupletHeight}paint(e,t,i){e+=this.x,t+=this.y;let s=as.EighthEighth,a=as.EighthEighth;switch(this._tripletFeel){case yt.NoTripletFeel:s=as.EighthEighth,a=as.EighthEighth;break;case yt.Triplet8th:s=as.EighthEighth,a=as.QuarterTripletEighthTriplet;break;case yt.Triplet16th:s=as.SixteenthSixteenth,a=as.EighthSixteenthTriplet;break;case yt.Dotted8th:s=as.EighthEighth,a=as.EighthDottedSixteenth;break;case yt.Dotted16th:s=as.SixteenthSixteenth,a=as.SixteenthDottedThirtySecond;break;case yt.Scottish8th:s=as.EighthEighth,a=as.SixteenthEighthDotted;break;case yt.Scottish16th:s=as.SixteenthSixteenth,a=as.ThirtySecondSixteenthDotted;break}const o=this.renderer.smuflMetrics.tempoNoteScale,c=t+this.renderer.smuflMetrics.glyphTop.get(S.MetNoteQuarterUp)*o,h=t+this.height,d=i.textBaseline;i.textBaseline=Wt.Bottom,i.font=this.renderer.resources.effectFont,i.fillText("(",e,h),e+=i.measureText("( ").width,e=this._drawGroup(e,c+this._tupletHeight,i,s),i.fillText(" = ",e,h),e+=i.measureText(" = ").width,e=this._drawGroup(e,c+this._tupletHeight,i,a),i.fillText(" )",e,h),i.textBaseline=d}_drawGroup(e,t,i,s){const a=this.renderer.smuflMetrics.tempoNoteScale;let o=[],c=[];const h=[];let d=S.None;switch(s){case as.EighthEighth:h.push(Ce.Center),o=[S.MetNoteQuarterUp],c=[S.MetNoteQuarterUp];break;case as.SixteenthSixteenth:h.push(Ce.Center),h.push(Ce.Center),o=[S.MetNoteQuarterUp],c=[S.MetNoteQuarterUp];break;case as.QuarterTripletEighthTriplet:o=[S.MetNoteQuarterUp],c=[S.MetNote8thUp],d=S.Tuplet3;break;case as.EighthSixteenthTriplet:h.push(Ce.Center),h.push(Ce.Right),o=[S.MetNoteQuarterUp],c=[S.MetNoteQuarterUp],d=S.Tuplet3;break;case as.EighthDottedSixteenth:h.push(Ce.Center),h.push(Ce.Right),o=[S.MetNoteQuarterUp,S.Space,S.MetAugmentationDot],c=[S.MetNoteQuarterUp];break;case as.SixteenthDottedThirtySecond:h.push(Ce.Center),h.push(Ce.Center),h.push(Ce.Right),o=[S.MetNoteQuarterUp,S.Space,S.MetAugmentationDot],c=[S.MetNoteQuarterUp];break;case as.SixteenthEighthDotted:h.push(Ce.Center),h.push(Ce.Left),o=[S.MetNoteQuarterUp],c=[S.MetNoteQuarterUp,S.Space,S.MetAugmentationDot];break;case as.ThirtySecondSixteenthDotted:h.push(Ce.Center),h.push(Ce.Center),h.push(Ce.Left),o=[S.MetNoteQuarterUp],c=[S.MetNoteQuarterUp,S.Space,S.MetAugmentationDot];break}const p=this.renderer.smuflMetrics.glyphWidths.get(S.MetNoteQuarterUp)*a,g=e+p-this.renderer.smuflMetrics.stemThickness*a,y=g+p*2+this.renderer.smuflMetrics.stemThickness*a,k=this.renderer.smuflMetrics.tempoNoteScale*this.renderer.smuflMetrics.beamThickness,_=this.renderer.smuflMetrics.tempoNoteScale*this.renderer.smuflMetrics.beamSpacing,w=this.renderer.smuflMetrics.brokenBeamWidth*a;let T=t-this.renderer.smuflMetrics.glyphHeights.get(S.MetNoteQuarterUp)*a+k;if(d!==S.None){const N=(e+y)/2,v=T-this._tupletHeight-this._tupletPadding,L=this.renderer.smuflMetrics.glyphTop.get(d)*a,A=this.renderer.smuflMetrics.glyphWidths.get(d)*a;vi.fillMusicFontSymbolSafe(i,N,v+L,a,d,!0);const D=N-A/2-this._tupletPadding,H=N+A/2+this._tupletPadding,J=this._tupletHeight/2,K=i.lineWidth;i.beginPath(),i.moveTo(e,v+J+J),i.lineTo(e,v+J),i.lineTo(D,v+J),i.moveTo(H,v+J),i.lineTo(y,v+J),i.lineTo(y,v+J+J),i.lineWidth=this.renderer.smuflMetrics.tupletBracketThickness*a,i.stroke(),i.lineWidth=K}i.fillMusicFontSymbols(e,t,a,o,!1),e+=p,e+=p,i.fillMusicFontSymbols(e,t,a,c,!1),e+=p,(c[c.length-1]===S.MetAugmentationDot||c[0]===S.MetNote8thUp)&&(e+=p);for(const x of h){switch(x){case Ce.Left:i.fillRect(g,T,w,k);break;case Ce.Center:i.fillRect(g,T,y-g,k);break;case Ce.Right:i.fillRect(y-w,T,w,k);break}T+=k+_}return e}}class nO extends Di{get notationElement(){return rt.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return ft.SinglePreBeat}shouldCreateGlyph(e,t){return t.index===0&&(t.voice.bar.masterBar.index===0&&t.voice.bar.masterBar.tripletFeel!==yt.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new sO(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class Xb extends ns{constructor(e){super(0,0,1,Xb._getSymbol(e)),this.center=!0}static _getSymbol(e){switch(e){case an.Open:return S.GuitarOpenPedal;case an.Closed:return S.GuitarClosePedal}return S.None}paint(e,t,i){super.paint(e,t+this.height,i)}}class aO extends Di{get notationElement(){return rt.EffectWahPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.SingleOnBeat}shouldCreateGlyph(e,t){return t.wahPedal!==an.None}createNewGlyph(e,t){return new Xb(t.wahPedal)}canExpand(e,t){return!1}}class rO extends Di{get notationElement(){return rt.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return ft.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new Hl("w/bar")}canExpand(e,t){return!0}}class qB extends Di{get notationElement(){return rt.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return ft.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===ct.Wide}createNewGlyph(e,t){return new kv(0,0,ct.Wide)}canExpand(e,t){return!0}}class JB extends zl{get notationElement(){return rt.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===ct.Wide||e.isTieDestination&&e.tieOrigin.vibrato===ct.Wide}get sizingMode(){return ft.GroupedOnBeatToEnd}createNewGlyph(e,t){return new jo(0,0,ct.Wide)}}class QB{x=0;width=0;masterBars=[]}class oO extends Il{_system=null;get name(){return"HorizontalScreen"}get supportsResize(){return!1}get firstBarX(){let e=this.pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Qo.Automatic:this.systemsLayoutMode=Un.Automatic;break;case Qo.UseModelLayout:this.systemsLayoutMode=Un.FromModelWithWidths;break}const e=this.renderer.score;let t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let i=t,s=this.renderer.settings.display.barCount;s<=0&&(s=e.masterBars.length),s=t+s-1,s=Math.min(e.masterBars.length-1,Math.max(0,s)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this.pagePadding[0],this._system.y=this.pagePadding[1];const a=this.renderer.settings.display.barCountPerPartial,o=[];let c=new QB,h=0;for(;i<=s;){const p=this.multiBarRestInfo,g=p!==null&&p.has(i)?p.get(i):null,y=this._system.addBars(this.renderer.tracks,i,g);if(c.masterBars.length===0&&y.isLinkedToPrevious&&o.length>0){const k=o[o.length-1];k.masterBars.push(e.masterBars[i]),k.width+=y.width,h+=y.width,c.x+=h}else c.masterBars.push(e.masterBars[i]),c.width+=y.width,c.masterBars.length>=a&&(o.length===0&&(c.width+=this._system.accoladeWidth+this.pagePadding[0]),h+=c.width,o.push(c),ee.debug(this.name,`Finished partial from bar ${c.masterBars[0].index} to ${c.masterBars[c.masterBars.length-1].index}`,null),c=new QB,c.x=h);i++}c.masterBars.length>0&&(o.length===0&&(c.width+=this._system.accoladeWidth+this.pagePadding[0]),o.push(c),ee.debug(this.name,`Finished partial from bar ${c.masterBars[0].index} to ${c.masterBars[c.masterBars.length-1].index}`,null)),this._finalizeStaffSystem(),this.height=Math.floor(this._system.y+this._system.height),this.width=this._system.x+this._system.width+this.pagePadding[2],i=0;let d=0;for(let p=0;p<o.length;p++){const g=o[p],y=new Wo;y.x=d,y.y=0,y.totalWidth=this.width,y.totalHeight=this.height,y.width=g.width,y.height=this.height,y.firstMasterBarIndex=g.masterBars[0].index,y.lastMasterBarIndex=g.masterBars[g.masterBars.length-1].index,d+=g.width;const k=i,_=p;this._system.buildBoundingsLookup(0,0),this.registerPartial(y,w=>{let T=this._system.getBarX(g.masterBars[0].index)+this._system.accoladeWidth;_===0&&(T-=this._system.x+this._system.accoladeWidth),w.color=this.renderer.settings.display.resources.mainGlyphColor,w.textAlign=Ce.Left,ee.debug(this.name,`Rendering partial from bar ${g.masterBars[0].index} to ${g.masterBars[g.masterBars.length-1].index}`,null),this._system.paintPartial(-T,this._system.y,w,k,g.masterBars.length)}),i+=g.masterBars.length}this.height=this.layoutAndRenderBottomScoreInfo(this.height),this.height=this.layoutAndRenderAnnotation(this.height),this.height+=this.pagePadding[3],this.height*=this.renderer.settings.display.scale}_finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class lO extends Il{_systems=[];_allMasterBarRenderers=[];_barsFromPreviousSystem=[];get name(){return"PageView"}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Qo.Automatic:this.systemsLayoutMode=Un.Automatic;break;case Qo.UseModelLayout:this.systemsLayoutMode=Un.FromModelWithScale;break}let e=this.pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this._layoutAndRenderScoreInfo(e,-1),e=this._layoutAndRenderTunings(e,-1),e=this._layoutAndRenderChordDiagrams(e,-1),e=this._layoutAndRenderScore(e),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}get supportsResize(){return!0}get firstBarX(){let e=this.pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this.pagePadding[1];this.width=this.renderer.width;const t=this.height;e=this._layoutAndRenderScoreInfo(e,t),e=this._layoutAndRenderTunings(e,t),e=this._layoutAndRenderChordDiagrams(e,t),e=this._resizeAndRenderScore(e,t),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}_layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;const i=this.renderer.settings.display.resources;this.tuningGlyph.x=this.pagePadding[0],this.tuningGlyph.width=this.scaledWidth-this.pagePadding[0]-this.pagePadding[2],this.tuningGlyph.doLayout();const s=Math.round(this.tuningGlyph.height),a=new Wo;return a.x=0,a.y=e,a.width=this.scaledWidth,a.height=s,a.totalWidth=this.scaledWidth,a.totalHeight=t<0?e+a.height:t,this.registerPartial(a,o=>{o.color=i.scoreInfoColor,o.textAlign=Ce.Center,this.tuningGlyph.paint(0,0,o)}),e+s}_layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const i=this.renderer.settings.display.resources;this.chordDiagrams.x=this.pagePadding[0],this.chordDiagrams.width=this.scaledWidth-this.pagePadding[0]-this.pagePadding[2],this.chordDiagrams.doLayout();const s=Math.round(this.chordDiagrams.height),a=new Wo;return a.x=0,a.y=e,a.width=this.scaledWidth,a.height=s,a.totalWidth=this.scaledWidth,a.totalHeight=t<0?e+s:t,this.registerPartial(a,o=>{o.color=i.scoreInfoColor,o.textAlign=Ce.Center,this.chordDiagrams.paint(0,0,o)}),e+s}_layoutAndRenderScoreInfo(e,t=-1){ee.debug(this.name,"Layouting score info");const i=new Wo;i.x=0,i.y=e;let s=0;const a=this.renderer.settings.display.resources,o=[];for(const[c,h]of Il.headerElements.value)if(this.headerGlyphs.has(c)){const d=this.headerGlyphs.get(c);d.y=s,this.alignScoreInfoGlyph(d);let p=d.font.size;c===ye.Words&&this.headerGlyphs.has(ye.Music)&&this.headerGlyphs.get(ye.Music).textAlign!==d.textAlign&&(p=0),s+=p,o.push(d)}return o.length>0&&(s=Math.floor(s+17),i.width=this.scaledWidth,i.height=s,i.totalWidth=this.scaledWidth,i.totalHeight=t<0?e+i.height:t,this.registerPartial(i,c=>{c.color=a.scoreInfoColor,c.textAlign=Ce.Center;for(const h of o)h.paint(0,0,c)})),e+s}_resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode===Un.FromModelWithScale)for(let s=0;s<this._systems.length;s++){const a=this._systems[s];this._fitSystem(a),e+=this._paintSystem(a,t)}else{this._systems=[];let s=0;const a=this._maxWidth;let o=this.createEmptyStaffSystem();for(o.index=this._systems.length,o.x=this.pagePadding[0],o.y=e;s<this._allMasterBarRenderers.length;){let c=this._allMasterBarRenderers[s];if(o.width+c.width<=a||o.masterBarsRenderers.length===0)o.addMasterBarRenderers(this.renderer.tracks,c),s++;else{for(;c&&!c.canWrap&&o.masterBarsRenderers.length>1;)c=o.revertLastBar(),s--;o.isFull=!0,o.isLast=this.lastBarIndex===o.lastBarIndex,this._systems.push(o),this._fitSystem(o),e+=this._paintSystem(o,t),o=this.createEmptyStaffSystem(),o.index=this._systems.length,o.x=this.pagePadding[0],o.y=e}}o.isLast=this.lastBarIndex===o.lastBarIndex,this._fitSystem(o),e+=this._paintSystem(o,t)}return e}_layoutAndRenderScore(e){let i=this.firstBarIndex;const s=this.lastBarIndex;for(this._systems=[];i<=s;){const a=this._createStaffSystem(i,s);this._systems.push(a),a.x=this.pagePadding[0],a.y=e,i=a.lastBarIndex+1,this._fitSystem(a),ee.debug(this.name,`Rendering partial from bar ${a.firstBarIndex} to ${a.lastBarIndex}`,null),e+=this._paintSystem(a,e)}return e}_paintSystem(e,t){const i=Math.floor(e.height),s=new Wo;return s.x=0,s.y=e.y,s.totalWidth=this.scaledWidth,s.totalHeight=t,s.width=this.scaledWidth,s.height=i,s.firstMasterBarIndex=e.firstBarIndex,s.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(s,a=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=Ce.Left,e.paint(0,-(s.y/this.renderer.settings.display.scale),a)}),i}_fitSystem(e){e.isFull||e.width>this._maxWidth||this.renderer.settings.display.justifyLastSystem?e.scaleToWidth(this._maxWidth):e.scaleToWidth(e.width),e.finalizeSystem()}_getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode===Un.FromModelWithScale){let i,s;this.renderer.tracks.length>1?(i=this.renderer.score.defaultSystemsLayout,s=this.renderer.score.systemsLayout):(i=this.renderer.tracks[0].defaultSystemsLayout,s=this.renderer.tracks[0].systemsLayout),t=e<s.length?s[e]:i}return t}_createStaffSystem(e,t){const i=this.createEmptyStaffSystem();i.index=this._systems.length;const s=this._getBarsPerSystem(i.index),a=this._maxWidth,o=t+1;let c=e;for(;c<o;){if(this._barsFromPreviousSystem.length>0)for(const g of this._barsFromPreviousSystem)i.addMasterBarRenderers(this.renderer.tracks,g),c=g.lastMasterBarIndex;else{const g=this.multiBarRestInfo,y=g!==null&&g.has(c)?g.get(c):null,k=i.addBars(this.renderer.tracks,c,y);this._allMasterBarRenderers.push(k),c=k.lastMasterBarIndex}this._barsFromPreviousSystem=[];let h=!1;if((s===-1&&i.width>=a&&i.masterBarsRenderers.length!==0||i.masterBarsRenderers.length===s+1)&&(h=!0),h){let g=i.revertLastBar();if(g)for(this._barsFromPreviousSystem.push(g);g&&!g.canWrap&&i.masterBarsRenderers.length>1;)g=i.revertLastBar(),g&&this._barsFromPreviousSystem.push(g);return i.isFull=!0,i.isLast=!1,this._barsFromPreviousSystem.reverse(),i}let d=!1,p=!0;for(const g of this.renderer.tracks)g.lineBreaks&&g.lineBreaks.has(c+1)?d=!0:p=!1;if(d&&p)return i.isFull=!0,i.isLast=!1,i;i.x=0,c++}return i.isLast=t===i.lastBarIndex,i}get _maxWidth(){return this.scaledWidth-this.pagePadding[0]-this.pagePadding[2]}}class xn extends Vi{constructor(e,t,i){super(e,t),this.width=i}}class Gl extends Vi{doLayout(){this.width=this.renderer.smuflMetrics.thinBarlineThickness}}class lh extends Gl{_isRepeat;constructor(e,t,i){super(e,t),this._isRepeat=i}doLayout(){this.width=this._isRepeat?this.renderer.smuflMetrics.repeatEndingLineThickness:this.renderer.smuflMetrics.thinBarlineThickness}paint(e,t,i){i.fillRect(e+this.x,t+this.y,this.renderer.smuflMetrics.thinBarlineThickness,this.height)}}class cO extends Gl{paint(e,t,i){const s=this.renderer.smuflMetrics.thinBarlineThickness/2,a=this.renderer.getLineHeight(1);let o=t+this.y+a*.5+s;const c=t+this.y+this.height;for(;o<c;)i.fillCircle(e+this.x,o,s),o+=a}}class uO extends Gl{paint(e,t,i){const s=this.renderer.smuflMetrics.dashedBarlineDashLength,a=e+this.x-this.width/2,o=Math.ceil(this.height/2/s),c=t+this.y+this.height,h=this.renderer.smuflMetrics.dashedBarlineGapLength,d=i.lineWidth;if(i.lineWidth=this.renderer.smuflMetrics.dashedBarlineThickness,i.beginPath(),o<1)i.moveTo(a,t+this.y),i.lineTo(a,c);else{let p=t+this.y;for(;p<c;){i.moveTo(a,p);const g=Math.min(c-p,s);i.lineTo(a,p+g),p+=s+h}}i.stroke(),i.lineWidth=d}}class ch extends Gl{doLayout(){this.width=this.renderer.smuflMetrics.thickBarlineThickness}paint(e,t,i){i.fillRect(e+this.x,t+this.y,this.width,this.height)}}class KB extends Gl{doLayout(){this.width=this.renderer.smuflMetrics.glyphWidths.get(S.RepeatDot)}paint(e,t,i){const s=this.renderer,a=s.heightLineCount%2===0?1:.5,o=t+this.y+this.height/2,c=s.getLineHeight(a),h=s.smuflMetrics.glyphTop.get(S.RepeatDot),d=s.smuflMetrics.glyphHeights.get(S.RepeatDot),p=h-d/2;vi.fillMusicFontSymbolSafe(i,e+this.x,o+p-c,1,S.RepeatDot),vi.fillMusicFontSymbolSafe(i,e+this.x,o+p+c,1,S.RepeatDot)}}class hO extends Gl{paint(e,t,i){const s=this.renderer;if(s.drawnLineCount-1<=2)return;const c=s.smuflMetrics.staffLineThickness/2,h=(s.drawnLineCount-1)/2,d=s.getLineY(h-1)-c,p=s.getLineY(h+1)+c;i.fillRect(e+this.x,t+d,s.smuflMetrics.thinBarlineThickness,p-d)}}class dO extends Gl{paint(e,t,i){const a=this.renderer.getLineHeight(1),o=-(a/2)+1;i.fillRect(e+this.x,t+this.y+o,1,a)}}class z0 extends El{_isRight;constructor(e){super(),this._isRight=e}doLayout(){const e=this.renderer.bar,t=e.masterBar,i=this._isRight?e.getActualBarLineRight():e.getActualBarLineLeft(this.renderer.index===0),s=this._isRight&&t.isRepeatEnd||!this._isRight&&t.isRepeatStart;let a=et.Automatic;if(!this._isRight){const g=this.renderer.previousRenderer;if(g&&g.staff===this.renderer.staff&&(a=g.bar.getActualBarLineRight(),i===a))return}switch(this._isRight&&t.isRepeatEnd&&(this.addGlyph(new KB(0,0)),this.width+=this.renderer.smuflMetrics.repeatBarlineDotSeparation),i){case et.Dashed:this.addGlyph(new uO(0,0));break;case et.Dotted:this.addGlyph(new cO(0,0));break;case et.Heavy:a!==et.LightHeavy&&a!==et.HeavyHeavy&&this.addGlyph(new ch(0,0));break;case et.HeavyHeavy:a!==et.LightHeavy&&a!==et.Heavy&&this.addGlyph(new ch(0,0)),this.width+=this.renderer.smuflMetrics.barlineSeparation,this.addGlyph(new ch(0,0));break;case et.HeavyLight:a!==et.LightHeavy&&a!==et.Heavy&&a!==et.HeavyHeavy&&this.addGlyph(new ch(0,0)),this.width+=this.renderer.smuflMetrics.thinThickBarlineSeparation,this.addGlyph(new lh(0,0,s));break;case et.LightHeavy:a!==et.HeavyLight&&a!==et.Regular&&a!==et.LightLight&&this.addGlyph(new lh(0,0,s)),this.width+=this.renderer.smuflMetrics.thinThickBarlineSeparation,this.addGlyph(new ch(0,0));break;case et.LightLight:a!==et.HeavyLight&&a!==et.Regular&&this.addGlyph(new lh(0,0,s)),this.width+=this.renderer.smuflMetrics.barlineSeparation,this.addGlyph(new lh(0,0,s));break;case et.None:break;case et.Regular:a!==et.HeavyLight&&a!==et.LightLight&&this.addGlyph(new lh(0,0,s));break;case et.Short:this.addGlyph(new hO(0,0));break;case et.Tick:this.addGlyph(new dO(0,0));break}this._isRight||t.isRepeatStart&&(this.width+=this.renderer.smuflMetrics.repeatBarlineDotSeparation,this.addGlyph(new KB(0,0)));const o=this.renderer,c=o.smuflMetrics.staffLineThickness,h=this.y+o.topPadding-c,p=this.y+this.renderer.height-this.renderer.bottomPadding-h;for(const g of this.glyphs)g.y=h,g.height=p}paint(e,t,i){const s=this.renderer,a=ht.bar(i,s.barLineBarSubElement,this.renderer.bar,!0);try{super.paint(e,t,i)}finally{a?.[Symbol.dispose]?.()}}}class fO extends Vi{_count=0;constructor(e,t,i){super(e,t),this._count=0,this._count=i}doLayout(){this.width=0}paint(e,t,i){const s=ht.bar(i,this.renderer.repeatsBarSubElement,this.renderer.bar);try{const a=this.renderer.resources,o=i.textAlign;i.font=a.barNumberFont,i.textAlign=Ce.Right;const c=`x${this._count}`,h=i.measureText(c).width/1.5;i.fillText(c,e+this.x-h,t+this.y),i.textAlign=o}finally{s?.[Symbol.dispose]?.()}}}class wv extends Vi{_number;constructor(e,t,i){super(e,t),this._number=`${i}  `}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number).width}paint(e,t,i){if(!this.renderer.staff.isFirstInSystem)return;const s=ht.bar(i,this.renderer.barNumberBarSubElement,this.renderer.bar,!0);try{const a=this.renderer.resources,o=i.textBaseline;i.textBaseline=Wt.Top,i.font=a.barNumberFont,i.fillText(this._number,e+this.x,t+this.y),i.textBaseline=o}finally{s?.[Symbol.dispose]?.()}}}class Zr extends Hp{firstLineY=0;_startSpacing=!1;tupletSize=0;get lineOffset(){return this.lineSpacing}get tupletOffset(){return this.smuflMetrics.oneStaffSpace*.5}get topGlyphOverflow(){return this.smuflMetrics.oneStaffSpace}get bottomGlyphOverflow(){return this.smuflMetrics.oneStaffSpace}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){const e=this.lineOffset*(this.heightLineCount-1),t=(this.drawnLineCount-1)*this.lineOffset,i=this.smuflMetrics.staffLineThickness/2;this.firstLineY=(this.topPadding+(e-t)/2|0)-i}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=this.smuflMetrics.glyphHeights.get(S.Tuplet0),super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,i){super.paintBackground(e,t,i),this.paintStaffLines(e,t,i),this.paintSimileMark(e,t,i)}paintStaffLines(e,t,i){const s=ht.bar(i,this.staffLineBarSubElement,this.bar,!0);try{const a=[];for(let h=0,d=this.drawnLineCount;h<d;h++)a.push([]);this.additionalMultiRestBars||this.collectSpaces(a);for(const h of a)h.sort((d,p)=>d[0]>p[0]?1:d[0]<p[0]?-1:0);const o=this.width,c=this.smuflMetrics.staffLineThickness/2;for(let h=0;h<this.drawnLineCount;h++){const d=this.getLineY(h)-c;let p=0;for(const g of a[h])i.fillRect(e+this.x+p,t+this.y+d,g[0]-p,this.smuflMetrics.staffLineThickness),p=g[0]+g[1];i.fillRect(e+this.x+p,t+this.y+d,o-p,this.smuflMetrics.staffLineThickness)}}finally{s?.[Symbol.dispose]?.()}}collectSpaces(e){}createStartSpacing(){if(this._startSpacing)return;const e=this.index===0?this.settings.display.firstStaffPaddingLeft:this.settings.display.staffPaddingLeft;this.addPreBeatGlyph(new xn(0,0,e)),this._startSpacing=!0}paintTuplets(e,t,i,s,a=!1){for(const o of this.bar.voices)if(this.hasVoiceContainer(o)){const c=this.getVoiceContainer(o);for(const h of c.tupletGroups)this._paintTupletHelper(e+this.beatGlyphsStart,t,i,h,s,a)}}getTupletBeamDirection(e){return this.getBeamDirection(e)}_paintTupletHelper(e,t,i,s,a,o){const c=this.resources,h=i.textAlign,d=i.textBaseline;i.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=Ce.Center,i.textBaseline=Wt.Middle;let p;const g=s.beats[0].tupletNumerator,y=s.beats[0].tupletDenominator;if(g===2&&y===3)p=[S.Tuplet2];else if(g===3&&y===2)p=[S.Tuplet3];else if(g===4&&y===6)p=[S.Tuplet4];else if(g===5&&y===4)p=[S.Tuplet5];else if(g===6&&y===4)p=[S.Tuplet6];else if(g===7&&y===4)p=[S.Tuplet7];else if(g===9&&y===8)p=[S.Tuplet9];else if(g===10&&y===8)p=[S.Tuplet1,S.Tuplet0];else if(g===11&&y===8)p=[S.Tuplet1,S.Tuplet1];else if(g===12&&y===8)p=[S.Tuplet1,S.Tuplet2];else if(g===13&&y===8)p=[S.Tuplet1,S.Tuplet3];else{p=[];const T=S.Tuplet0;g>10?(p.push(T+Math.floor(g/10)),p.push(T+(g-10))):p.push(T+g),p.push(S.TupletColon),y>10?(p.push(T+Math.floor(y/10)),p.push(T+(y-10))):p.push(T+y)}const k=this.tupletOffset,_=this.tupletSize,w=ht.beat(i,a,s.beats[0]);try{const T=i.lineWidth;if(i.lineWidth=this.smuflMetrics.tupletBracketThickness,s.beats.length===1||!s.isFull)for(const x of s.beats){const E=this.helpers.beamHelperLookup[s.voice.index].get(x.index);if(!E)continue;const N=this.getTupletBeamDirection(E),v=E.getBeatLineX(x);let L=this.calculateBeamYWithDirection(E,v,N);N===j.Down?L+=k+_:L-=k+_,i.fillMusicFontSymbols(e+this.x+v,t+this.y+L,1,p,!0)}else{const x=s.beats[0],E=s.beats[s.beats.length-1];let N=null,v=null;for(let ze=0;ze<s.beats.length;ze++)if(!s.beats[ze].isRest){N=s.beats[ze];break}for(let ze=s.beats.length-1;ze>=0;ze--)if(!s.beats[ze].isRest){v=s.beats[ze];break}let L=!1;N||(N=x,L=!0),v||(v=E);const A=this.getBeatX(x,lt.OnNotes)-this.beatGlyphsStart,D=this.getBeatX(E,lt.PostNotes)-this.beatGlyphsStart,H=this.helpers.beamHelperLookup[s.voice.index].get(N.index),J=this.helpers.beamHelperLookup[s.voice.index].get(v.index),K=this.getTupletBeamDirection(H);let Y=this.calculateBeamYWithDirection(H,A,K),C=this.calculateBeamYWithDirection(J,D,K);L&&(Y=Math.max(Y,C),C=Y);const Q=k+_*.5;K===j.Down?(Y+=Q,C+=Q):(Y-=Q,C-=Q);const Z=p.reduce((ze,qt)=>ze+c.engravingSettings.glyphWidths.get(qt),0),le=c.engravingSettings.oneStaffSpace*.5,F=(A+D)/2,re=F-Z/2-le,_e=F+Z/2+le,ve=(C-Y)/(D-A),Ve=Y-ve*A,R=ve*re+Ve,te=ve*F+Ve,we=ve*_e+Ve,Ee=K===j.Down?Y-_*.5:Y+_*.5,qe=K===j.Down?C-_*.5:C+_*.5,je=i.lineWidth%2===0?0:.5;e+=je,t+=je,re>A&&(i.beginPath(),i.moveTo(e+this.x+A,t+this.y+Ee),o?i.quadraticCurveTo(e+this.x+(re+A)/2,t+this.y+R,e+this.x+re,t+this.y+R):(i.lineTo(e+this.x+A,t+this.y+Y),i.lineTo(e+this.x+re,t+this.y+R)),i.moveTo(e+this.x+_e,t+this.y+we),o?i.quadraticCurveTo(e+this.x+(D+_e)/2,t+this.y+we,e+this.x+D,t+this.y+qe):(i.lineTo(e+this.x+D,t+this.y+C),i.lineTo(e+this.x+D,t+this.y+qe)),i.stroke()),i.fillMusicFontSymbols(e+this.x+F,t+this.y+te+_*.5,1,p,!0)}i.textAlign=h,i.textBaseline=d,i.lineWidth=T}finally{w?.[Symbol.dispose]?.()}}paintBeams(e,t,i,s,a){for(const o of this.helpers.beamHelpers)for(const c of o)this._paintBeamHelper(e+this.beatGlyphsStart,t,i,c,s,a)}drawBeamHelperAsFlags(e){return e.beats.length===1}_paintBeamHelper(e,t,i,s,a,o){i.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isRestBeamHelper||(this.drawBeamHelperAsFlags(s)?this.paintFlag(e,t,i,s,a):this.paintBar(e,t,i,s,o))}shouldPaintFlag(e,t){return!(e.graceType===De.BendGrace||e.deadSlapped||!t.hasBeatLineX(e)||e.graceType!==De.None&&this.settings.notation.notationMode===Ps.SongBook||e.duration===M.Whole||e.duration===M.DoubleWhole||e.duration===M.QuadrupleWhole)}paintFlag(e,t,i,s,a){for(const o of s.beats){if(!this.shouldPaintFlag(o,s))continue;const c=o.graceType!==De.None,h=s.getBeatLineX(o),d=this.getBeamDirection(s),p=t+this.y+this.getFlagTopY(o,d),g=t+this.y+this.getFlagBottomY(o,d);let y=0;if(d===j.Down?y=g:y=p,!s.hasLine(!0,o))continue;this.paintBeamingStem(o,t+this.y,e+this.x+h,p,g,i);const k=ht.beat(i,a,o);try{let _=0;if(s.hasFlag(!0,o)){const w=new bg(e+this.x+h,y,o.duration,d,c);w.renderer=this,w.doLayout(),w.paint(0,0,i),_=w.width/2}o.graceType===De.BeforeBeat&&(d===j.Down?vi.fillMusicFontSymbolSafe(i,e+this.x+h+_/2,(p+g-this.smuflMetrics.glyphHeights.get(S.GraceNoteSlashStemDown))/2,Ct.GraceScale,S.GraceNoteSlashStemDown,!0):vi.fillMusicFontSymbolSafe(i,e+this.x+h+_/2,(p+g+this.smuflMetrics.glyphHeights.get(S.GraceNoteSlashStemUp))/2,Ct.GraceScale,S.GraceNoteSlashStemUp,!0))}finally{k?.[Symbol.dispose]?.()}}}getFlagStemSize(e,t=!1){let i=0;switch(e){case M.QuadrupleWhole:case M.Half:case M.Quarter:case M.Eighth:case M.Sixteenth:case M.ThirtySecond:case M.SixtyFourth:case M.OneHundredTwentyEighth:case M.TwoHundredFiftySixth:i=this.smuflMetrics.standardStemLength+this.smuflMetrics.stemFlagOffsets.get(e);break;default:i=t?this.smuflMetrics.standardStemLength:0;break}return i}recreatePreBeatGlyphs(){this._startSpacing=!1,super.recreatePreBeatGlyphs()}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.addPreBeatGlyph(new z0(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new wv(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs();const e=this.lastBar;this.addPostBeatGlyph(new z0(!0)),e.masterBar.isRepeatEnd&&e.masterBar.repeatCount>2&&this.addPostBeatGlyph(new fO(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))}paintBar(e,t,i,s,a){const o=this.getBeamDirection(s),h=s.graceType!==De.None?Ct.GraceScale:1;let d=(this.smuflMetrics.beamSpacing+this.smuflMetrics.beamThickness)*h,p=this.smuflMetrics.beamThickness*h;o===j.Down&&(d=-d,p=-p);for(let g=0,y=s.beats.length;g<y;g++){const k=s.beats[g];if(!s.hasBeatLineX(k)||k.deadSlapped)continue;const _=s.getBeatLineX(k),w=t+this.y+this.getBarLineStart(k,o),T=t+this.y+this.calculateBeamY(s,_)|0;w<T?this.paintBeamingStem(k,t+this.y,e+this.x+_,w,T,i):this.paintBeamingStem(k,t+this.y,e+this.x+_,T,w,i);const x=ht.beat(i,a,k);try{const E=this.smuflMetrics.brokenBeamWidth*h,N=ce.getIndex(k.duration)-2,v=t+this.y;for(let L=0;L<N;L++){let A=0,D=0,H=0,J=0;const K=v+L*d;if(g<s.beats.length-1){const Y=qa.isFullBarJoin(k,s.beats[g+1],L);if(L===N-1&&Y&&k.beamingMode===ei.ForceSplitOnSecondaryToNext)A=_,D=A+E,H=K+this.calculateBeamY(s,A),J=K+this.calculateBeamY(s,D),Zr.paintSingleBar(i,e+this.x+A,H,e+this.x+D,J,p),D=s.getBeatLineX(s.beats[g+1]),A=D-E,H=K+this.calculateBeamY(s,A),J=K+this.calculateBeamY(s,D),Zr.paintSingleBar(i,e+this.x+A,H,e+this.x+D,J,p);else{if(Y)A=_,D=s.getBeatLineX(s.beats[g+1]);else if(g===0||!qa.isFullBarJoin(s.beats[g-1],k,L))A=_,D=A+E;else continue;H=K+this.calculateBeamY(s,A),J=K+this.calculateBeamY(s,D),L===0&&(H=H|0,J=J|0),Zr.paintSingleBar(i,e+this.x+A,H,e+this.x+D,J,p)}}else g>0&&!qa.isFullBarJoin(k,s.beats[g-1],L)&&(A=_-E,D=_,D=_,H=K+this.calculateBeamY(s,A),J=K+this.calculateBeamY(s,D),Zr.paintSingleBar(i,e+this.x+A,H,e+this.x+D,J,p))}}finally{x?.[Symbol.dispose]?.()}}if(s.graceType===De.BeforeBeat){const g=s.getBeatLineX(s.beats[0]),y=this.smuflMetrics.glyphWidths.get(S.Flag8thUp)*Ct.GraceScale;let k=t+this.y+this.calculateBeamY(s,g)|0;k+=p+d,o===j.Down?vi.fillMusicFontSymbolSafe(i,e+this.x+g+y/2,k,Ct.GraceScale,S.GraceNoteSlashStemDown,!0):vi.fillMusicFontSymbolSafe(i,e+this.x+g+y/2,k,Ct.GraceScale,S.GraceNoteSlashStemUp,!0)}}static paintSingleBar(e,t,i,s,a,o){e.beginPath(),e.moveTo(t,i),e.lineTo(s,a),e.lineTo(s,a+o),e.lineTo(t,i+o),e.closePath(),e.fill()}}class hs extends Vi{startBeat;endBeat;yOffset=0;forEnd;startNoteRenderer=null;endNoteRenderer=null;tieDirection=j.Up;constructor(e,t,i){super(0,0),this.startBeat=e,this.endBeat=t,this.forEnd=i}_startX=0;_startY=0;_endX=0;_endY=0;_tieHeight=0;_shouldDraw=!1;doLayout(){if(this.width=0,!this.endBeat){this._shouldDraw=!1;return}const e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar);this.startNoteRenderer=e;const t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.endBeat.voice.bar);if(this.endNoteRenderer=t,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,t),!this.forEnd&&e?(e!==t?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,!t||e.staff!==t.staff?(this._endX=e.x+e.width,this._endY=this._startY):(this._endX=t.x+this.getEndX(),this._endY=t.y+this.getEndY()+this.yOffset)):(this._startX=e.x+this.getStartX(),this._endX=t.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=t.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==t.staff)&&(this._startX=t.x,this._endX=t.x+this.getEndX(),this._startY=t.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw)if(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur())this._tieHeight=0;else{this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY);const i=hs.calculateActualTieHeight(1,this._startX,this._startY,this._endX,this._endY,this.tieDirection===j.Down,this._tieHeight,this.renderer.smuflMetrics.tieMidpointThickness);if(this.height=i.h,this.tieDirection===j.Up){const s=this.y-i.y;s>0&&(this.y-=s)}}}paint(e,t,i){this._shouldDraw&&(this.shouldDrawBendSlur()?hs.drawBendSlur(i,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===j.Down,1,this.renderer.smuflMetrics.tieHeight):hs.paintTie(i,1,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===j.Down,this._tieHeight,this.renderer.smuflMetrics.tieMidpointThickness))}shouldDrawBendSlur(){return!1}getTieHeight(e,t,i,s){return this.renderer.smuflMetrics.tieHeight}getBeamDirection(e,t){return j.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,t,i,s,a,o,c,h){const d=hs._computeBezierControlPoints(e,t,i,s,a,o,c,h);t=d[0],i=d[1];const p=d[2],g=d[3];s=d[6],a=d[7];const y=(t-p)/(t-2*p+s),k=hs._calculateExtrema(t,i,p,g,s,a,y),_=k.length>0?Math.min(t,s,k[0]):Math.min(t,s),w=k.length>0?Math.max(t,s,k[0]):Math.max(t,s),T=(i-g)/(i-2*g+a),x=hs._calculateExtrema(t,i,p,g,s,a,T),E=x.length>0?Math.min(i,a,x[1]):Math.min(i,a),N=x.length>0?Math.max(i,a,x[1]):Math.max(i,a),v=new Os;return v.x=_,v.y=E,v.w=w-_,v.h=N-E,v}static _calculateExtrema(e,t,i,s,a,o,c){if(c<=0||1<=c)return[];const h=e+(i-e)*c,d=t+(s-t)*c,p=i+(a-i)*c,g=s+(o-s)*c;return[h+(p-h)*c,d+(g-d)*c]}static _computeBezierControlPoints(e,t,i,s,a,o,c,h){if(t===s&&i===a)return[];if(s<t){let L=t;t=s,s=L,L=i,i=a,a=L}c*=e,h*=e,o&&(c*=-1,h*=-1),e>=1&&(h*=1.2);const d=a-i,p=s-t,g=Math.sqrt(p*p+d*d);let y=t+g*.25,k=i-c,_=t+g*.75,w=i-c,T=t+g*.75,x=i-c-h,E=t+g*.25,N=i-c-h;const v=Math.atan2(d,p);return[y,k]=hs._rotate(y,k,t,i,v),[_,w]=hs._rotate(_,w,t,i,v),[T,x]=hs._rotate(T,x,t,i,v),[E,N]=hs._rotate(E,N,t,i,v),[t,i,y,k,_,w,s,a,T,x,E,N,t,i]}static _rotate(e,t,i,s,a){const o=e-i,c=t-s,h=o*Math.cos(a)-c*Math.sin(a),d=o*Math.sin(a)+c*Math.cos(a);return[i+h,s+d]}static paintTie(e,t,i,s,a,o,c,h,d){const p=hs._computeBezierControlPoints(t,i,s,a,o,c,h,d);e.beginPath(),e.moveTo(p[0],p[1]),e.bezierCurveTo(p[2],p[3],p[4],p[5],p[6],p[7]),e.bezierCurveTo(p[8],p[9],p[10],p[11],p[12],p[13]),e.closePath(),e.fill()}static drawBendSlur(e,t,i,s,a,o,c,h,d){let p=a-i,g=s-t;const y=Math.sqrt(p*p+g*g);o?p*=-1:g*=-1,p/=y,g/=y;const k=(s+t)/2,_=(a+i)/2;let w=h*c;s-t<20&&(w/=2);const T=k+w*p,x=_+w*g;if(e.beginPath(),e.moveTo(t,i),e.lineTo(T,x),e.lineTo(s,a),e.stroke(),d){const E=e.measureText(d).width,N=o?0:-e.font.size;e.fillText(d,T-E/2,x+N)}}}class h0 extends hs{startNote;endNote;constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}get _isLeftHandTap(){return this.startNote===this.endNote}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return j.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,pe.Top)}getEndY(){return this.getStartY()}getStartX(){return this._isLeftHandTap?this.getEndX()-this.startNoteRenderer.smuflMetrics.leftHandTabTieWidth:this.startNoteRenderer.getNoteX(this.startNote,ci.Center)}getEndX(){return this._isLeftHandTap?this.endNoteRenderer.getNoteX(this.endNote,ci.Left):this.endNoteRenderer.getNoteX(this.endNote,ci.Center)}}class eo extends hs{startNote;endNote;constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}get _isLeftHandTap(){return this.startNote===this.endNote}getTieHeight(e,t,i,s){return this._isLeftHandTap?this.startNoteRenderer.smuflMetrics.tieHeight:super.getTieHeight(e,t,i,s)}getBeamDirection(e,t){return this._isLeftHandTap?j.Up:eo.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?j.Up:j.Down}getStartY(){return this._isLeftHandTap?this.startNoteRenderer.getNoteY(this.startNote,pe.Center):this.tieDirection===j.Up?this.startNoteRenderer.getNoteY(this.startNote,pe.Top):this.startNoteRenderer.getNoteY(this.startNote,pe.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this._isLeftHandTap?this.getEndX()-this.renderer.smuflMetrics.leftHandTabTieWidth:this.startNoteRenderer.getNoteX(this.startNote,ci.Center)}getEndX(){return this._isLeftHandTap?this.endNoteRenderer.getNoteX(this.endNote,ci.Left):this.endNoteRenderer.getNoteX(this.endNote,ci.Center)}}class ZB extends eo{_direction;_forSlide;constructor(e,t,i,s=!1){super(e,t,s),this._direction=j.Up,this._forSlide=i}getTieHeight(e,t,i,s){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight/2}tryExpand(e,t,i,s){if(this._forSlide!==i||this.forEnd!==s||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id)return!1;switch(this._direction){case j.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case j.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),a=this.getBeamDirection(this.startBeat,s),o=`numbered.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${a}`,c=this.renderer;c.staff.getSharedLayoutData(o,!1)||(c.staff.setSharedLayoutData(o,!0),super.paint(e,t,i))}}class pO extends Da{_effectSlurs=[];createTies(e){if(e.isVisible){if(e.isTieOrigin&&e.tieDestination.isVisible){const t=new h0(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination){const t=new h0(e.tieOrigin,e,!0);this.addTie(t)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const t=new h0(e,e,!1);this.addTie(t)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let t=!1;for(const i of this._effectSlurs)if(i.tryExpand(e,e.effectSlurDestination,!1,!1)){t=!0;break}if(!t){const i=new ZB(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(i),this.addTie(i)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let t=!1;for(const i of this._effectSlurs)if(i.tryExpand(e.effectSlurOrigin,e,!1,!0)){t=!0;break}if(!t){const i=new ZB(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(i),this.addTie(i)}}}}}class gO extends Vi{_isGrace;_beat;_number;constructor(e,t,i,s,a){super(e,t),this._isGrace=s,this._number=i,this._beat=a}paint(e,t,i){const s=this._beat.isRest?ht.beat(i,ti.NumberedRests,this._beat):this._beat.notes.length>0?ht.note(i,Js.NumberedNumber,this._beat.notes[0]):void 0;try{const a=this.renderer.resources;i.font=this._isGrace?a.numberedNotationGraceFont:a.numberedNotationFont,i.textBaseline=Wt.Middle,i.textAlign=Ce.Left,i.fillText(this._number.toString(),e+this.x,t+this.y)}finally{s?.[Symbol.dispose]?.()}}doLayout(){const e=this.renderer.resources,t=this._isGrace?e.numberedNotationGraceFont:e.numberedNotationFont,i=this.renderer.scoreRenderer.canvas;i.font=t;const s=i.measureText(`${this._number}`);this.height=s.height,this.width=s.width}}class jB{x=0;y=-3e3;width=0}class qb extends ja{constructor(){super(0,0)}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}this.glyphs.sort((i,s)=>i.y<s.y?-1:i.y>s.y?1:0);const e=[];e.push(new jB);for(let i=0,s=this.glyphs.length;i<s;i++){const a=this.glyphs[i];a.renderer=this.renderer,a.doLayout();let o=0;for(;e[o].y>a.y;)o++,o===e.length&&e.push(new jB);a.x=o,e[o].y=a.y+a.height,e[o].width<a.width&&(e[o].width=a.width)}this.width=0;const t=this.renderer.smuflMetrics.accidentalPadding;for(const i of e)this.width+=i.width+t,i.x=this.width;for(let i=0,s=this.glyphs.length;i<s;i++){const a=this.glyphs[i],o=e[a.x];a.x=this.width-o.x}}}class _r extends ns{constructor(e,t,i,s){super(e,t,s,_r.getMusicSymbol(i))}static getMusicSymbol(e){switch(e){case Le.Natural:return S.AccidentalNatural;case Le.Sharp:return S.AccidentalSharp;case Le.Flat:return S.AccidentalFlat;case Le.NaturalQuarterNoteUp:return S.AccidentalQuarterToneSharpNaturalArrowUp;case Le.SharpQuarterNoteUp:return S.AccidentalThreeQuarterTonesSharpArrowUp;case Le.FlatQuarterNoteUp:return S.AccidentalQuarterToneFlatArrowUp;case Le.DoubleSharp:return S.AccidentalDoubleSharp;case Le.DoubleFlat:return S.AccidentalDoubleFlat}return S.None}}class Yh extends ns{constructor(e,t){super(e,t,1,S.AugmentationDot)}doLayout(){super.doLayout(),this.offsetX=this.width/2,this.width*=1.5}}class mO extends Vi{_beat;constructor(e,t,i){super(e,t),this._beat=i}doLayout(){this.width=this.renderer.smuflMetrics.numberedDashGlyphWidth+this.renderer.smuflMetrics.numberedDashGlyphPadding,this.height=this.renderer.smuflMetrics.numberedBarRendererBarSize}paint(e,t,i){const s=ht.beat(i,ti.NumberedDuration,this._beat);try{const a=this.renderer.smuflMetrics.numberedDashGlyphPadding;i.fillRect(e+this.x,Math.ceil(t+this.y-this.height),this.width-a,this.height)}finally{s?.[Symbol.dispose]?.()}}}class wg extends Vi{constructor(){super(0,0)}doLayout(){this.width=this.renderer.smuflMetrics.glyphWidths.get(S.NoteheadSlashWhiteHalf)}paint(e,t,i){const s=this.renderer,a=s.getLineHeight(s.heightLineCount-1),o=s.getLineY(0),c=s.getLineHeight(s.drawnLineCount-1),h=o+c/2-a/2,d=i.lineWidth;i.lineWidth=this.renderer.smuflMetrics.deadSlappedLineWidth,i.moveTo(e+this.x,t+h),i.lineTo(e+this.x+this.width,t+h+a),i.moveTo(e+this.x,t+h+a),i.lineTo(e+this.x+this.width,t+h),i.stroke(),i.lineWidth=d}}class yO extends tl{isNaturalizeAccidental=!1;accidental=Le.None;get effectElement(){return ti.NumberedEffects}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){const e=new qb;if(e.renderer=this.renderer,this.container.beat.notes.length>0){const t=this.container.beat.notes[0],i=t?t.accidentalMode:Ue.Default,s=Gs.getNoteValue(t);let a=ce.computeAccidental(this.renderer.bar.keySignature,i,s,t.hasQuarterToneOffset);if(a===Le.Natural&&(a=this.renderer.bar.keySignature+7<7?Le.Sharp:Le.Flat,this.isNaturalizeAccidental=!0),a!==Le.None){this.accidental=a;const o=this.renderer,c=ht.noteColor(o.resources,Js.NumberedAccidentals,t),h=new _r(0,o.getLineY(0),a,t.beat.graceType!==De.None?Ct.GraceScale*Ct.GraceScale:Ct.GraceScale);h.colorOverride=c,h.renderer=this.renderer,e.addGlyph(h),this.addNormal(e),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding))}}}super.doLayout()}}class $h extends il{noteHeads=null;deadSlapped=null;octaveDots=0;get effectElement(){return ti.NumberedEffects}getNoteX(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let s=i.x;switch(t){case ci.Left:break;case ci.Center:s+=i.width/2;break;case ci.Right:s+=i.width;break}return s}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const s=new id;s.note=this.container.beat.notes[0],s.noteHeadBounds=new Os,s.noteHeadBounds.x=t+this.x+this.noteHeads.x,s.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,e.addNote(s)}}getLowestNoteY(){return this._internalGetNoteY(pe.Center)}getHighestNoteY(){return this._internalGetNoteY(pe.Center)}getNoteY(e,t){return this._internalGetNoteY(t)}_internalGetNoteY(e){let t=null;if(this.noteHeads?t=this.noteHeads:this.deadSlapped&&(t=this.deadSlapped),t){let i=this.y+t.y;switch(e){case pe.Top:case pe.TopWithStem:i-=t.height/2;break;case pe.Center:break;case pe.Bottom:case pe.BottomWithStem:i+=t.height/2;break;case pe.StemUp:case pe.StemDown:break}return i}return 0}updateBeamingHelper(){if(this.beamingHelper){let e=null;this.noteHeads?e=this.noteHeads:this.deadSlapped&&(e=this.deadSlapped),e&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+e.x,this.container.x+this.x+e.x+e.width)}}static majorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61];static minorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73];doLayout(){const e=this.renderer;e.shortestDuration<this.container.beat.duration&&(e.shortestDuration=this.container.beat.duration);const t=e.getLineY(e.getNoteLine());if(!this.container.beat.isEmpty){let i="0";if(this.container.beat.notes.length>0){const o=this.renderer.bar.keySignatureType,c=this.renderer.bar.keySignature,h=c+7,p=(o===pn.Minor?$h.minorKeySignatureOneValues:$h.majorKeySignatureOneValues)[h],g=this.container.beat.notes[0];if(g.isDead)i="X";else{const y=g.displayValue-p,k=y<0?(y%12+12)%12:y%12;let _=y<0?(Math.abs(y)+12)/12|0:y/12|0;y<0&&(_*=-1),this.octaveDots=_,e.registerOctave(_);let T=(ce.keySignatureIsSharp(c)||ce.keySignatureIsNatural(c)?Gs.flatNoteSteps:Gs.sharpNoteSteps)[k]+1;ce.accidentalNotes[k]&&!this.container.preNotes.isNaturalizeAccidental&&(h<7?T++:T--),i=T.toString()}}if(this.container.beat.deadSlapped){const o=new wg;o.renderer=this.renderer,o.doLayout(),this.deadSlapped=o,this.addEffect(o)}else{const o=this.container.beat.graceType!==De.None,c=new gO(0,t,i,o,this.container.beat);this.noteHeads=c,this.addNormal(c)}if(this.container.beat.dots>0&&this.container.beat.duration>=M.Quarter)for(let o=0;o<this.container.beat.dots;o++){const c=new Yh(0,e.getLineY(0));c.renderer=this.renderer,this.addEffect(c)}let s=0;switch(this.container.beat.duration){case M.QuadrupleWhole:s=16;break;case M.DoubleWhole:s=8;break;case M.Whole:s=4;break;case M.Half:s=2;break}let a=s;for(let o=0;o<this.container.beat.dots;o++)a=a/2|0,s+=a;for(let o=0;o<s-1;o++){const c=new mO(0,e.getLineY(0),this.container.beat);c.renderer=this.renderer,this.addNormal(c)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}class G0 extends Vi{_isOpen;colorOverride;constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=this.renderer.smuflMetrics.ghostParenthesisWidth+this.renderer.smuflMetrics.ghostParenthesisPadding}paint(e,t,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride),this._isOpen?hs.paintTie(i,1,e+this.x+this.renderer.smuflMetrics.ghostParenthesisWidth,t+this.y+this.height,e+this.x+this.renderer.smuflMetrics.ghostParenthesisWidth,t+this.y,!1,this.renderer.smuflMetrics.ghostParenthesisWidth/2,this.renderer.smuflMetrics.tieMidpointThickness):hs.paintTie(i,1,e+this.x+this.renderer.smuflMetrics.ghostParenthesisPadding,t+this.y,e+this.x+this.renderer.smuflMetrics.ghostParenthesisPadding,t+this.y+this.height,!1,this.renderer.smuflMetrics.ghostParenthesisWidth/2,this.renderer.smuflMetrics.tieMidpointThickness),i.color=s}}class Bv extends ja{_numerator=0;_denominator=0;_isCommon;_isFreeTime;barSubElement=Bt.StandardNotationTimeSignature;constructor(e,t,i,s,a,o){super(e,t),this._numerator=i,this._denominator=s,this._isCommon=a,this._isFreeTime=o}paint(e,t,i){const s=ht.bar(i,this.barSubElement,this.renderer.bar);try{super.paint(e,t,i)}finally{s?.[Symbol.dispose]?.()}}doLayout(){if(this._isCommon&&this._numerator===2&&this._denominator===2){const e=new ns(0,0,this.commonScale,S.TimeSigCutCommon);this.addGlyph(e),super.doLayout()}else if(this._isCommon&&this._numerator===4&&this._denominator===4){const e=new ns(0,0,this.commonScale,S.TimeSigCommon);this.addGlyph(e),super.doLayout()}else{const e=new nu(0,0,this._numerator,Wt.Top,this.numberScale),t=new nu(0,0,this._denominator,Wt.Bottom,this.numberScale);this.addGlyph(e),this.addGlyph(t),super.doLayout();const i=this.width;e.x=(i-e.width)/2,t.x=(i-t.width)/2,this.width=Math.max(e.x+e.width,t.x+t.width)}if(this._isFreeTime){const e=this.renderer.smuflMetrics.oneStaffSpace*2,t=new G0(!0);t.renderer=this.renderer,t.y=-e,t.height=e*2,t.doLayout();for(const s of this.glyphs)s.x+=t.width;this.width+=t.width,this.addGlyph(t);const i=new G0(!1);i.renderer=this.renderer,i.x=this.width,i.y=-e,i.height=e*2,i.doLayout(),this.addGlyph(i),this.width+=i.width}}}class Jb extends Bv{get commonScale(){return 1}get numberScale(){return 1}}class bO extends Vi{_keySignature;_keySignatureType;_text="";_accidental=Le.None;_accidentalOffset=0;constructor(e,t,i,s){super(e,t),this._keySignature=i,this._keySignatureType=s}doLayout(){super.doLayout();const e="1 = ";let t="",i=Le.None;switch(this._keySignatureType){case pn.Major:switch(this._keySignature){case Xt.Cb:t="  C",i=Le.Flat;break;case Xt.Gb:t="  G",i=Le.Flat;break;case Xt.Db:t="  D",i=Le.Flat;break;case Xt.Ab:t="  A",i=Le.Flat;break;case Xt.Eb:t="  E",i=Le.Flat;break;case Xt.Bb:t="  B",i=Le.Flat;break;case Xt.F:t="F";break;case Xt.C:t="C",i=Le.None;break;case Xt.G:t="G",i=Le.None;break;case Xt.D:t="D",i=Le.None;break;case Xt.A:t="A",i=Le.None;break;case Xt.E:t="E",i=Le.None;break;case Xt.B:t="B",i=Le.None;break;case Xt.FSharp:t="  F",i=Le.Sharp;break;case Xt.CSharp:t="  C",i=Le.Sharp;break}break;case pn.Minor:switch(this._keySignature){case Xt.Cb:t="  a",i=Le.Flat;break;case Xt.Gb:t="  e",i=Le.Flat;break;case Xt.Db:t="  b",i=Le.Flat;break;case Xt.Ab:t="f",i=Le.None;break;case Xt.Eb:t="c",i=Le.None;break;case Xt.Bb:t="g",i=Le.None;break;case Xt.F:t="d";break;case Xt.C:t="a",i=Le.None;break;case Xt.G:t="e",i=Le.None;break;case Xt.D:t="b",i=Le.None;break;case Xt.A:t="  f",i=Le.Sharp;break;case Xt.E:t="  c",i=Le.Sharp;break;case Xt.B:t="  g",i=Le.Sharp;break;case Xt.FSharp:t="  d",i=Le.Sharp;break;case Xt.CSharp:t="  a",i=Le.Sharp;break}break}this._text=e+t,this._accidental=i;const s=this.renderer.scoreRenderer.canvas,a=this.renderer.resources;s.font=a.numberedNotationFont,this._accidentalOffset=s.measureText(e).width,this.width=s.measureText(e+t).width}paint(e,t,i){const s=ht.bar(i,Bt.NumberedKeySignature,this.renderer.bar);try{const a=this.renderer.resources;i.font=a.numberedNotationFont,i.textBaseline=Wt.Middle,i.fillText(this._text,e+this.x,t+this.y),this._accidental!==Le.None&&vi.fillMusicFontSymbolSafe(i,e+this.x+this._accidentalOffset,t+this.y,1,_r.getMusicSymbol(this._accidental),!1)}finally{s?.[Symbol.dispose]?.()}}}class eT extends Zr{static StaffId="numbered";simpleWhammyOverflow=0;_isOnlyNumbered;shortestDuration=M.QuadrupleWhole;lowestOctave=null;highestOctave=null;get dotSpacing(){return this.smuflMetrics.glyphHeights.get(S.AugmentationDot)*2}registerOctave(e){this.lowestOctave===null?(this.lowestOctave=e,this.highestOctave=e):(e<this.lowestOctave&&(this.lowestOctave=e),e>this.highestOctave&&(this.highestOctave=e))}get repeatsBarSubElement(){return Bt.NumberedRepeats}get barNumberBarSubElement(){return Bt.NumberedBarNumber}get barLineBarSubElement(){return Bt.NumberedBarLines}get staffLineBarSubElement(){return Bt.NumberedStaffLine}constructor(e,t){super(e,t),this._isOnlyNumbered=!t.staff.showSlash&&!t.staff.showTablature&&!t.staff.showStandardNotation}get lineSpacing(){return this.smuflMetrics.oneStaffSpace}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,ti.NumberedDuration,ti.NumberedDuration),this.paintTuplets(e,t,i,ti.NumberedTuplet,!0)}doLayout(){super.doLayout();let e=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}if(e&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){const t=ce.getIndex(this.shortestDuration)-2,i=this.dotSpacing;if(t>0){const a=this.smuflMetrics.numberedBarRendererBarSpacing,o=this.smuflMetrics.numberedBarRendererBarSize,c=(t-1)*a+o;let h=0;const d=this.lowestOctave;d!==null&&(h=Math.abs(d)*i+this.smuflMetrics.glyphHeights.get(S.AugmentationDot)),this.registerOverflowBottom(c+h)}const s=this.highestOctave;if(s!==null){const a=Math.abs(s)*i+this.smuflMetrics.glyphHeights.get(S.AugmentationDot);this.registerOverflowTop(a)}}}paintFlag(e,t,i,s,a){this.paintBar(e,t,i,s,a)}paintBar(e,t,i,s,a){if(s.beats.length===0)return;const o=this.resources;for(let c=0,h=s.beats.length;c<h;c++){const d=s.beats[c],p=ht.beat(i,a,d);try{const g=this.smuflMetrics.numberedBarRendererBarSpacing,y=this.smuflMetrics.numberedBarRendererBarSize,k=ce.getIndex(d.duration)-2,_=t+this.y,w=this.getBeatX(d,lt.PreNotes)-this.beatGlyphsStart,T=this.calculateBeamY(s,w);for(let D=0;D<k;D++){let H=0,J=0,K=0;const Y=_+D*g;c===s.beats.length-1?(H=w,J=this.getBeatX(d,lt.PostNotes)-this.beatGlyphsStart):(H=w,J=this.getBeatX(s.beats[c+1],lt.PreNotes)-this.beatGlyphsStart),K=Y+T,i.fillRect(e+this.x+H,K,J-H,y)}const x=this.getBeatContainer(d).onNotes;let E=x instanceof $h?x.octaveDots:0;const N=this.dotSpacing;let v=0,L=0;E>0?(v=_+this.getLineY(0)-o.numberedNotationFont.size,L=N*-1):E<0&&(v=_+T+k*(g+y),L=N);const A=this.getBeatX(d,lt.MiddleNotes)-this.beatGlyphsStart;E=Math.abs(E);for(let D=0;D<E;D++)vi.fillMusicFontSymbolSafe(i,e+this.x+A,v,1,S.AugmentationDot,!0),v+=L}finally{p?.[Symbol.dispose]?.()}}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size*1.5}getFlagTopY(e,t){return this.getLineY(0)-this.resources.numberedNotationFont.size}getFlagBottomY(e,t){return this.getLineY(0)-this.resources.numberedNotationFont.size}getBeamDirection(e){return j.Down}getTupletBeamDirection(e){return j.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){const s=this.resources.numberedNotationFont;return this.getLineY(0)+s.size}getBarLineStart(e,t){const i=this.smuflMetrics.glyphHeights.get(S.NoteheadBlack);return this.getLineY(0)-i/2}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine,(this.index===0||this.bar.masterBar.isRepeatStart&&this._isOnlyNumbered)&&this.addPreBeatGlyph(new z0(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new wv(0,this.getLineHeight(-.25),this.bar.index+1))}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this._createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this._createTimeSignatureGlyphs())}_createKeySignatureGlyphs(){this.addPreBeatGlyph(new bO(0,this.getLineY(0),this.bar.keySignature,this.bar.keySignatureType))}_createTimeSignatureGlyphs(){this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.oneStaffSpace));const e=this.bar.masterBar,t=new Jb(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime));t.barSubElement=Bt.NumberedTimeSignature,this.addPreBeatGlyph(t)}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(e){for(const t of e.beats){const i=new pO(t,this.getVoiceContainer(e));i.preNotes=e.index===0?new yO:new tl,i.onNotes=e.index===0?new $h:new il,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,s,a,o){}}class SO extends nd{get staffId(){return eT.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new eT(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showNumbered}}class Qb extends ns{_clef;_clefOttava;constructor(e,t,i,s){super(e,t,1,Qb._getSymbol(i,s)),this._clef=i,this._clefOttava=s}doLayout(){this.center=!0,super.doLayout(),this.width=this.renderer.smuflMetrics.glyphWidths.get(S.GClef),this.offsetX=this.width/2}static _getSymbol(e,t){switch(e){case _t.Neutral:return S.UnpitchedPercussionClef1;case _t.C3:case _t.C4:switch(t){case Ye._8vb:return S.CClef8vb;default:return S.CClef}case _t.F4:switch(t){case Ye._15ma:return S.FClef15ma;case Ye._8va:return S.FClef8va;case Ye._8vb:return S.FClef8vb;case Ye._15mb:return S.FClef15mb;default:return S.FClef}case _t.G2:switch(t){case Ye._15ma:return S.GClef15ma;case Ye._8va:return S.GClef8va;case Ye._8vb:return S.GClef8vb;case Ye._15mb:return S.GClef15mb;default:return S.GClef}default:return S.None}}paint(e,t,i){const s=ht.bar(i,Bt.StandardNotationClef,this.renderer.bar);try{switch(super.paint(e,t,i),this._clef){case _t.C3:case _t.C4:switch(this._clefOttava){case Ye._8vb:return}break;case _t.F4:case _t.G2:return}let a,o=!1;switch(this._clefOttava){case Ye._15ma:a=S.Clef15,o=!0;break;case Ye._8va:a=S.Clef8,o=!0;break;case Ye._8vb:a=S.Clef8;break;case Ye._15mb:a=S.Clef15;break;default:return}const c=this.width/2,h=o?this.renderer.smuflMetrics.glyphTop.get(this.symbol):this.renderer.smuflMetrics.glyphBottom.get(this.symbol)-this.renderer.smuflMetrics.glyphHeights.get(a);vi.fillMusicFontSymbolSafe(i,e+this.x+c,t+this.y-h,1,a,!0)}finally{s?.[Symbol.dispose]?.()}}}class Ah extends Xn{_note;constructor(e,t,i){super(e,t),this._note=i}static _getSymbol(e,t){switch(e){case mi.None:return S.None;case mi.Normal:return t?S.ArticAccentAbove:S.ArticAccentBelow;case mi.Heavy:return t?S.ArticMarcatoAbove:S.ArticMarcatoBelow;case mi.Tenuto:return t?S.ArticTenutoAbove:S.ArticTenutoBelow;default:return S.None}}doLayout(){this.width=this.renderer.smuflMetrics.glyphWidths.get(S.ArticAccentAbove),this.height=this.renderer.smuflMetrics.glyphHeights.get(S.ArticAccentAbove)}paint(e,t,i){const s=this.renderer.getBeatDirection(this._note.beat),a=Ah._getSymbol(this._note.accentuated,s===j.Down),o=s===j.Up?t+this.y:t+this.y+this.height;vi.fillMusicFontSymbolSafe(i,e+this.x,o,1,a,!0)}}class _O extends ns{constructor(e,t,i){super(e,t,i?Ct.GraceScale:1,S.NoteheadXOrnate)}}class Gp extends ns{constructor(e,t,i,s){super(e,t,s?Ct.GraceScale:1,Gp._getSymbol(i))}static _getSymbol(e){switch(e){case M.QuadrupleWhole:case M.DoubleWhole:case M.Whole:case M.Half:return S.NoteheadDiamondWhiteWide;default:return S.NoteheadDiamondBlackWide}}}class tT{line=0;isGhost;color;constructor(e,t,i){this.line=e,this.isGhost=t,this.color=i}}class Up extends Vi{_isOpen;_infos=[];_glyphs=[];isEmpty=!0;constructor(e){super(0,0),this._isOpen=e}addParenthesis(e){const t=this.renderer,i=t.getNoteLine(e),s=e.isGhost||this._isTiedBend(e)&&t.settings.notation.isNotationElementVisible(rt.ParenthesisOnTiedBends),a=ht.noteColor(t.resources,Js.Effects,e);this._add(new tT(i,s,a))}addParenthesisOnLine(e,t){const i=new tT(e,t,void 0);this._add(i)}_add(e){this._infos.push(e),e.isGhost&&(this.isEmpty=!1)}_isTiedBend(e){return e.isTieDestination?e.tieOrigin.hasBend?!0:this._isTiedBend(e.tieOrigin):!1}doLayout(){const e=this.renderer;this._infos.sort((s,a)=>s.line-a.line);let t=null;const i=e.getScoreHeight(1);for(let s=0,a=this._infos.length;s<a;s++){let o;if(!this._infos[s].isGhost)t=null;else if(!t)o=new G0(this._isOpen),o.colorOverride=this._infos[s].color,o.renderer=this.renderer,o.y=e.getScoreY(this._infos[s].line)-i,o.height=i*2,o.doLayout(),this._glyphs.push(o),t=o;else{const c=e.getScoreY(this._infos[s].line)+i;t.height=c-t.y}}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,i){super.paint(e,t,i);for(const s of this._glyphs)s.paint(e+this.x,t+this.y,i)}}class kO{glyph;steps=0;constructor(e,t){this.glyph=e,this.steps=t}}class Tv extends Vi{_infos=[];minNote=null;maxNote=null;upLineX=0;downLineX=0;noteStartX=0;constructor(){super(0,0)}getLowestNoteY(){return this.maxNote?this.renderer.getScoreY(this.maxNote.steps):0}getHighestNoteY(){return this.minNote?this.renderer.getScoreY(this.minNote.steps):0}add(e,t){const i=new kO(e,t);this._infos.push(i),(!this.minNote||this.minNote.steps>i.steps)&&(this.minNote=i),(!this.maxNote||this.maxNote.steps<i.steps)&&(this.maxNote=i)}doLayout(){this._infos.sort((y,k)=>k.steps-y.steps);let e=0,t=0,i=!0,s=0,a=!1;const o=this.direction,c=this.renderer.smuflMetrics,h=this.scale,d=new Map;for(let y=0,k=this._infos.length;y<k;y++){const _=this._infos[y].glyph;if(_.renderer=this.renderer,_.doLayout(),y>0&&Math.abs(s-this._infos[y].steps)<=1?i?(i=!1,d.set(y,!1)):(a=!0,i=!0,d.set(y,!0)):(i=!1,d.set(y,!1)),c.stemUp.has(_.symbol)){const T=c.stemUp.get(_.symbol).x*h;T>e&&(e=T)}else{const w=c.glyphWidths.get(_.symbol)*h;w>e&&(e=w)}if(c.stemDown.has(_.symbol)){const T=c.stemDown.get(_.symbol).x*h;if(T>t){const x=T-t;t=T,e+=x}}s=this._infos[y].steps}const p=a||o===j.Up?e:t;let g=0;for(let y=0,k=this._infos.length;y<k;y++){const _=this._infos[y].glyph;d.get(y)?_.x=p:(_.x=t,c.stemDown.has(_.symbol)&&(_.x-=c.stemDown.get(_.symbol).x*h)),_.x+=this.noteStartX,g=Math.max(g,_.x+_.width),_ instanceof Ct&&_.centerOnStem&&(_.x=p)}a?(this.upLineX=p,this.downLineX=p):(this.upLineX=e,this.downLineX=t),this.width=g}paint(e,t,i){e+=this.x,t+=this.y,this._paintLedgerLines(e,t,i);const s=this._infos;for(const a of s)a.glyph.renderer=this.renderer,a.glyph.paint(e,t,i)}_paintLedgerLines(e,t,i){if(!this.minNote)return;const s=this.renderer,a=ht.bar(i,Bt.StandardNotationStaffLine,s.bar,!0);try{const o=this.scale,c=this.renderer.smuflMetrics.legerLineExtension*o,h=this.width-this.noteStartX+c*2,d=s.getLineHeight(1),p=s.getLineY(-1),g=s.getLineY(s.drawnLineCount),y=s.getLineY(this.minNote.steps/2),k=s.getLineY(this.maxNote.steps/2),_=this.renderer.smuflMetrics.legerLineThickness*o/2;let w=p;for(;w>=y;)i.fillRect(e-c+this.noteStartX,t+w-_,h,this.renderer.smuflMetrics.legerLineThickness*o),w-=d;for(w=g;w<=k;)i.fillRect(e-c+this.noteStartX,t+w-_,h,this.renderer.smuflMetrics.legerLineThickness*o),w+=d}finally{a?.[Symbol.dispose]?.()}}}class Bg extends ns{constructor(e,t,i){super(e,t,1,Bg._getSymbol(i))}static _getSymbol(e){switch(e){case M.ThirtySecond:return S.Tremolo3;case M.Sixteenth:return S.Tremolo2;case M.Eighth:return S.Tremolo1;default:return S.None}}}class wO extends Tv{_noteGlyphLookup=new Map;_notes=[];_deadSlapped=null;_tremoloPicking=null;aboveBeatEffects=new Map;belowBeatEffects=new Map;beat;beamingHelper;get direction(){return this.beamingHelper.direction}get scale(){return this.beat.graceType!==De.None?Ct.GraceScale:1}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){const i=this._noteGlyphLookup.get(e.id);let s=this.x+i.x;switch(t){case ci.Left:break;case ci.Center:s+=i.width/2;break;case ci.Right:s+=i.width;break}return s}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const i=this._noteGlyphLookup.get(e.id);return this._internalGetNoteY(i,t)}return 0}_internalGetNoteY(e,t){let i=this.y+e.y;const s=this.beat.graceType!==De.None?Ct.GraceScale:1;switch(t){case pe.TopWithStem:i-=(this.renderer.smuflMetrics.stemUp.has(e.symbol)?this.renderer.smuflMetrics.stemUp.get(e.symbol).bottomY:0)*s,i-=this.renderer.smuflMetrics.standardStemLength*s;const a=this.renderer.centerStaffStemY(this.beamingHelper);return Math.min(a,i);case pe.Top:i-=e.height/2;break;case pe.Center:break;case pe.Bottom:i+=e.height/2;break;case pe.BottomWithStem:i-=(this.renderer.smuflMetrics.stemDown.has(e.symbol)?this.renderer.smuflMetrics.stemDown.get(e.symbol).topY:-this.renderer.smuflMetrics.glyphHeights.get(e.symbol)/2)*s,i+=this.renderer.smuflMetrics.standardStemLength*s;const o=this.renderer.centerStaffStemY(this.beamingHelper);return Math.max(o,i);case pe.StemUp:i-=(this.renderer.smuflMetrics.stemUp.has(e.symbol)?this.renderer.smuflMetrics.stemUp.get(e.symbol).bottomY:0)*s;break;case pe.StemDown:i-=(this.renderer.smuflMetrics.stemDown.has(e.symbol)?this.renderer.smuflMetrics.stemDown.get(e.symbol).topY:-this.renderer.smuflMetrics.glyphHeights.get(e.symbol)/2)*s;break}return i}addMainNoteGlyph(e,t,i){super.add(e,i),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}addEffectNoteGlyph(e,t){super.add(e,t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();const e=this.renderer;this.beat.deadSlapped&&(this._deadSlapped=new wg,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),this.width=this._deadSlapped.width);let t=0,i=0;const s=this.renderer.smuflMetrics.onNoteEffectPadding;this.beat.deadSlapped?(i=e.getScoreY(0),t=e.getScoreY(e.heightLineCount)):this.direction===j.Up?(i=this._internalGetNoteY(this.maxNote.glyph,pe.Bottom)+s,t=this._internalGetNoteY(this.minNote.glyph,pe.TopWithStem)-s):(i=this._internalGetNoteY(this.maxNote.glyph,pe.BottomWithStem)+s,t=this._internalGetNoteY(this.minNote.glyph,pe.Top)-s);let a=null,o=null;for(const c of this.aboveBeatEffects.values())c.renderer=this.renderer,c.doLayout(),t-=c.height,c.y=t,(a===null||a>t)&&(a=t),(o===null||o<t)&&(o=t),t-=s;for(const c of this.belowBeatEffects.values())c.renderer=this.renderer,c.doLayout(),c.y=i,(a===null||a>i)&&(a=i),(o===null||o<i)&&(o=i),i+=c.height+s;if(a!==null&&e.registerBeatEffectOverflows(a,o??0),this.beat.isTremolo&&!this.beat.deadSlapped){const c=this.direction;let h=0;if(c===j.Up){const g=this._internalGetNoteY(this.minNote.glyph,pe.TopWithStem),y=this._internalGetNoteY(this.minNote.glyph,pe.StemUp);h=(g+y)/2}else{const g=this._internalGetNoteY(this.maxNote.glyph,pe.StemDown),y=this._internalGetNoteY(this.maxNote.glyph,pe.BottomWithStem);h=(g+y)/2}let d=c===j.Up?this.upLineX:this.downLineX;const p=this.beat.tremoloSpeed;this.beat.duration<M.Half&&(d=this.width/2),this._tremoloPicking=new Bg(d,h,p),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,i){for(const s of this._notes)if(this._noteGlyphLookup.has(s.id)){const a=this._noteGlyphLookup.get(s.id),o=new id;o.note=s,o.noteHeadBounds=new Os,o.noteHeadBounds.x=t+this.x+a.x,o.noteHeadBounds.y=i+this.y+a.y-a.height/2,o.noteHeadBounds.w=a.width,o.noteHeadBounds.h=a.height,e.addNote(o)}}paint(e,t,i){this._paintEffects(e,t,i),super.paint(e,t,i)}_paintEffects(e,t,i){const s=ht.beat(i,ti.StandardNotationEffects,this.beat);try{for(const a of this.aboveBeatEffects.values())a.paint(e+this.x+this.width/2,t+this.y,i);for(const a of this.belowBeatEffects.values())a.paint(e+this.x+this.width/2,t+this.y,i);this._tremoloPicking&&this._tremoloPicking.paint(e,t,i),this._deadSlapped&&this._deadSlapped.paint(e,t,i)}finally{s?.[Symbol.dispose]?.()}}}class rd extends ns{beamingHelper;constructor(e,t,i){super(e,t,1,rd.getSymbol(i))}static getSymbol(e){switch(e){case M.QuadrupleWhole:return S.RestLonga;case M.DoubleWhole:return S.RestDoubleWhole;case M.Whole:return S.RestWhole;case M.Half:return S.RestHalf;case M.Quarter:return S.RestQuarter;case M.Eighth:return S.Rest8th;case M.Sixteenth:return S.Rest16th;case M.ThirtySecond:return S.Rest32nd;case M.SixtyFourth:return S.Rest64th;case M.OneHundredTwentyEighth:return S.Rest128th;case M.TwoHundredFiftySixth:return S.Rest256th;default:return S.None}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){this.internalPaint(e,t,i,ti.StandardNotationRests)}internalPaint(e,t,i,s){const a=ht.beat(i,s,this.beat);try{super.paint(e,t,i)}finally{a?.[Symbol.dispose]?.()}}}class Ho extends Tv{_beat;_showParenthesis=!1;_noteValueLookup=new Map;_accidentals=new qb;_preNoteParenthesis=null;_postNoteParenthesis=null;isEmpty=!0;get scale(){return Ct.GraceScale}get direction(){return j.Up}noteHeadOffset=0;constructor(e,t=!1){super(),this._beat=e,this._showParenthesis=t,t&&(this._preNoteParenthesis=new Up(!0),this._postNoteParenthesis=new Up(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,t,i){const s=this.renderer,a=new Ct(0,0,M.Quarter,!0),o=s.accidentalHelper.applyAccidentalForValue(this._beat,e,t,!0),c=s.accidentalHelper.getNoteLineForValue(e,!1);if(a.y=s.getScoreY(c),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(c,!0),this._postNoteParenthesis.addParenthesisOnLine(c,!0)),o!==Le.None){const h=new _r(0,a.y,o,Ct.GraceScale);h.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(h)}this._noteValueLookup.set(e,a),this.add(a,c),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+this.renderer.smuflMetrics.bendNoteHeadElementPadding),this._accidentals.isEmpty||(e+=this._accidentals.width+this.renderer.smuflMetrics.bendNoteHeadElementPadding,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+this.renderer.smuflMetrics.bendNoteHeadElementPadding),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+this.renderer.smuflMetrics.bendNoteHeadElementPadding,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+this.renderer.smuflMetrics.bendNoteHeadElementPadding)}paint(e,t,i){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,t+this.y,i),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,t+this.y,i),this._postNoteParenthesis.paint(e+this.x,t+this.y,i)),super.paint(e,t,i)}}class xv extends Vi{bendNoteHeads=[];drawBendSlur(e,t,i,s,a,o,c,h){hs.drawBendSlur(e,t,i,s,a,o,c,this.renderer.smuflMetrics.tieHeight,h)}doLayout(){super.doLayout(),this.width=0;for(const e of this.bendNoteHeads)e.doLayout(),this.width+=e.width}getTieDirection(e,t){switch(t.getBeatDirection(e)){case j.Up:return j.Down;default:return j.Up}}}class BO extends xv{_beat;_endGlyph=null;constructor(e){super(0,0),this._beat=e}doLayout(){const e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case Dt.None:case Dt.Custom:case Dt.Hold:return;case Dt.Dive:case Dt.PrediveDive:{const t=new Ho(this._beat,!1);this._endGlyph=t,t.renderer=this.renderer;const i=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const s of this._beat.notes)s.isTieOrigin||t.addGlyph(this._getBendNoteValue(s,i),i.value%2!==0,void 0);t.doLayout(),this.bendNoteHeads.push(t)}break;case Dt.Dip:if(e===Ps.SongBook){const t=this.renderer.resources;this.renderer.simpleWhammyOverflow=t.tablatureFont.size+this.renderer.smuflMetrics.songBookWhammyDipHeight}else{const t=new Ho(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===Ps.GuitarPro){const s=this._beat.whammyBarPoints[1];for(const a of this._beat.notes)t.addGlyph(this._getBendNoteValue(a,this._beat.whammyBarPoints[1]),s.value%2!==0,void 0)}t.doLayout(),this.bendNoteHeads.push(t);const i=new Ho(this._beat,!1);if(i.renderer=this.renderer,this._endGlyph=i,this.renderer.settings.notation.notationMode===Ps.GuitarPro){const s=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const a of this._beat.notes)i.addGlyph(this._getBendNoteValue(a,s),s.value%2!==0,void 0)}i.doLayout(),this.bendNoteHeads.push(i)}break;case Dt.Predive:break}super.doLayout()}paint(e,t,i){const s=this._beat;switch(s.whammyBarType){case Dt.None:case Dt.Custom:return}const a=this.renderer.settings.notation.notationMode,o=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,s.voice.bar),c=ht.beat(i,ti.StandardNotationEffects,s);try{const h=e+o.x+o.getBeatX(s,lt.MiddleNotes),d=this.getTieDirection(s,o);let p=this._beat.notes.length===1?d:j.Up;const g=i.textAlign,y=this.renderer.smuflMetrics.glyphHeights.get(S.NoteheadBlack);for(let k=0;k<s.notes.length;k++){const _=s.notes[k],w=ht.note(i,Js.StandardNotationEffects,_);try{let T=t+o.y;k>0&&k>=(this._beat.notes.length/2|0)&&(p=j.Down),p===j.Down?T+=o.getNoteY(_,pe.Bottom):T+=o.getNoteY(_,pe.Top);let x=e+o.x;s.isLastOfVoice?x+=o.postBeatGlyphsStart:x+=o.getBeatX(s,lt.EndBeat),this._endGlyph&&(x-=this._endGlyph.upLineX);const E=s.whammyStyle===Kt.Gradual&&k===0?"grad.":"";let N=null;_.isTieOrigin&&(N=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,_.tieDestination.beat.voice.bar),N&&N.staff===o.staff?x=e+N.x+N.getBeatX(_.tieDestination.beat,lt.MiddleNotes):N=null);let v=y*Ct.GraceScale*.5;p===j.Up&&(v=-v);const L=s.whammyBarPoints.length>0?this._getBendNoteValue(_,s.whammyBarPoints[s.whammyBarPoints.length-1]):0;let A=0,D=!1;switch(this.bendNoteHeads.length>0&&this.bendNoteHeads[0].containsNoteValue(L)?(A=this.bendNoteHeads[0].getNoteValueY(L)+v,D=!0):N&&(_.isTieOrigin&&_.tieDestination.beat.hasWhammyBar||_.beat.isContinuedWhammy)?(A=t+N.y+N.getNoteY(_.tieDestination,pe.Top),D=!0,p===j.Down&&(A+=y)):_.isTieOrigin&&(N?A=t+N.y+N.getNoteY(_.tieDestination,pe.Top):A=T,p===j.Down&&(A+=y)),s.whammyBarType){case Dt.Hold:_.isTieOrigin&&hs.paintTie(i,1,h,T,x,A,d===j.Down,this.renderer.smuflMetrics.tieHeight,this.renderer.smuflMetrics.slurMidpointThickness);break;case Dt.Dive:if(k===0){this.bendNoteHeads[0].x=x-this.bendNoteHeads[0].noteHeadOffset;const K=this.bendNoteHeads[0].y;this.bendNoteHeads[0].y=t+o.y,this.bendNoteHeads[0].paint(0,0,i),this.bendNoteHeads[0].containsNoteValue(L)&&(A-=K,A+=this.bendNoteHeads[0].y)}D?this.drawBendSlur(i,h,T,x,A,p===j.Down,1,E):_.isTieOrigin&&hs.paintTie(i,1,h,T,x,A,d===j.Down,this.renderer.smuflMetrics.tieHeight,this.renderer.smuflMetrics.slurMidpointThickness);break;case Dt.Dip:if(a===Ps.SongBook){if(k===0){const K=e+o.x+o.getBeatX(this._beat,lt.OnNotes),Y=e+o.x+o.getBeatX(this._beat,lt.PostNotes),C=(K+Y)/2,Q=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();i.font=this.renderer.resources.tablatureFont,i.fillText(Q,C,t+this.y);const Z=t+this.y+i.font.size,le=Z+this.renderer.smuflMetrics.songBookWhammyDipHeight;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(i.moveTo(K,le),i.lineTo(C,Z),i.lineTo(Y,le)):(i.moveTo(K,Z),i.lineTo(C,le),i.lineTo(Y,Z)),i.stroke()}_.isTieOrigin&&hs.paintTie(i,1,h,T,x,A,d===j.Down,this.renderer.smuflMetrics.tieHeight,this.renderer.smuflMetrics.slurMidpointThickness)}else{const K=(h+x)/2;this.bendNoteHeads[0].x=K-this.bendNoteHeads[0].noteHeadOffset,this.bendNoteHeads[0].y=t+o.y,this.bendNoteHeads[0].paint(0,0,i);const Y=this._getBendNoteValue(_,s.whammyBarPoints[1]),C=this.bendNoteHeads[0].getNoteValueY(Y)+v;this.drawBendSlur(i,h,T,K,C,p===j.Down,1,E),this.bendNoteHeads[1].x=x-this.bendNoteHeads[1].noteHeadOffset,this.bendNoteHeads[1].y=t+o.y,this.bendNoteHeads[1].paint(0,0,i),A=this.bendNoteHeads[1].getNoteValueY(L)+v,this.drawBendSlur(i,K,C,x,A,p===j.Down,1,E)}break;case Dt.PrediveDive:case Dt.Predive:let H=e+o.x+o.getBeatX(_.beat,lt.PreNotes);H+=o.getPreNotesGlyphForBeat(_.beat).prebendNoteHeadOffset;const J=t+o.y+o.getScoreY(o.accidentalHelper.getNoteLineForValue(_.displayValue-(_.beat.whammyBarPoints[0].value/2|0),!1))+v;this.drawBendSlur(i,H,J,h,T,p===j.Down,1,E),this.bendNoteHeads.length>0&&(this.bendNoteHeads[0].x=x-this.bendNoteHeads[0].noteHeadOffset,this.bendNoteHeads[0].y=t+o.y,this.bendNoteHeads[0].paint(0,0,i),this.drawBendSlur(i,h,T,x,A,p===j.Down,1,E));break}}finally{w?.[Symbol.dispose]?.()}}i.textAlign=g}finally{c?.[Symbol.dispose]?.()}}_getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class TO extends ns{_isGrace;_articulation;constructor(e,t,i,s,a){super(e,t,a?Ct.GraceScale:1,i.getSymbol(s)),this._isGrace=a,this._articulation=i}paint(e,t,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride);const a=this._isGrace?1:0;vi.fillMusicFontSymbolSafe(i,e+this.x,t+this.y+a,this.glyphScale,this.symbol,!1),this._articulation.techniqueSymbol!==S.None&&this._articulation.techniqueSymbolPlacement===Jt.Inside&&vi.fillMusicFontSymbolSafe(i,e+this.x,t+this.y+a,this.glyphScale,this._articulation.techniqueSymbol,!1),i.color=s}doLayout(){super.doLayout(),this.width===0&&(this.height=this.renderer.smuflMetrics.glyphWidths.get(S.NoteheadBlack)),this.height===0&&(this.height=this.renderer.smuflMetrics.glyphHeights.get(S.NoteheadBlack))}}class iT extends ns{constructor(e,t){super(e,t,Ct.GraceScale,S.ArticStaccatoAbove),this.center=!0}doLayout(){super.doLayout(),this.offsetY=this.height}}class xO extends ns{constructor(e,t){super(e,t,.5,S.PictEdgeOfCymbal),this.center=!0}doLayout(){super.doLayout(),this.offsetY=this.height}}class vO extends Xn{_strings=new Set;addString(e){this._strings.add(e)}doLayout(){const e=this.renderer.smuflMetrics.glyphWidths.get(S.GuitarString0)*this.renderer.smuflMetrics.tuningGlyphCircleNumberScale;this.height=(e+this.renderer.smuflMetrics.stringNumberCirclePadding)*this._strings.size,this.width=e}paint(e,t,i){const s=this.renderer.bar.staff.tuning.length;let a=0;const o=this.renderer.smuflMetrics.glyphWidths.get(S.GuitarString0)*this.renderer.smuflMetrics.tuningGlyphCircleNumberScale;for(const c of this._strings){const h=s-c,d=S.GuitarString1+h;vi.fillMusicFontSymbolSafe(i,e+this.x,t+this.y+o+a,this.renderer.smuflMetrics.tuningGlyphCircleNumberScale,d,!0),a+=o+this.renderer.smuflMetrics.stringNumberCirclePadding}}}class no extends ns{beatEffects=new Map;beamingHelper;noteHeadElement=Js.SlashNoteHead;effectElement=ti.SlashEffects;_symbol;constructor(e,t,i,s,a){super(e,t,s?Ct.GraceScale:1,no.getSymbol(i)),this._symbol=no.getSymbol(i),this.beat=a}paint(e,t,i){const s=this.beat.notes.length===0?void 0:ht.note(i,this.noteHeadElement,this.beat.notes[0]);try{super.paint(e,t,i),this._paintEffects(e,t,i)}finally{s?.[Symbol.dispose]?.()}}_paintEffects(e,t,i){const s=ht.beat(i,this.effectElement,this.beat);try{for(const a of this.beatEffects.values())a.paint(e+this.x,t+this.y,i)}finally{s?.[Symbol.dispose]?.()}}doLayout(){super.doLayout();const e=this.renderer.smuflMetrics.onNoteEffectPadding;let t=this.renderer.smuflMetrics.glyphHeights.get(this._symbol);for(const i of this.beatEffects.values())i.y+=t,i.x+=this.width/2,i.renderer=this.renderer,i.doLayout(),t+=i.height+e}static getSymbol(e){switch(e){case M.QuadrupleWhole:case M.DoubleWhole:case M.Whole:return S.NoteheadSlashWhiteWhole;case M.Half:return S.NoteheadSlashWhiteHalf;default:return S.NoteheadSlashHorizontalEnds}}updateBeamingHelper(e){if(this.beamingHelper){const t=this._symbol,i=this.renderer.smuflMetrics.stemUp.has(t)?this.renderer.smuflMetrics.stemUp.get(t).x:0,s=this.renderer.smuflMetrics.stemDown.has(t)?this.renderer.smuflMetrics.stemDown.get(t).x:0;this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+i,e+this.x+s)}}}class NO extends il{_collisionOffset=-1e3;_skipPaint=!1;noteHeads=null;restGlyph=null;get effectElement(){return ti.StandardNotationEffects}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,i){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,i+this.y)}getLowestNoteY(){return this.noteHeads?this.noteHeads.getLowestNoteY():0}getHighestNoteY(){return this.noteHeads?this.noteHeads.getHighestNoteY():0}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph&&(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&this._collisionOffset===-1e3)){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}paint(e,t,i){this._skipPaint||super.paint(e,t,i)}doLayout(){const e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2)*2;this.container.beat.duration===M.Whole&&this.renderer.bar.staff.standardNotationLineCount!==1&&this.renderer.bar.staff.standardNotationLineCount!==3&&(t-=2);const i=new rd(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=i,i.beat=this.container.beat,i.beamingHelper=this.beamingHelper,this.addNormal(i),this.renderer.bar.isMultiVoice)if(this.container.beat.voice.index===0){const s=qa.computeLineHeightsForRest(this.container.beat.duration),a=i.y-e.getScoreHeight(s[0]),o=i.y+e.getScoreHeight(s[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,a,o)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0)for(let s=0;s<this.container.beat.dots;s++){const a=new ja(0,0);a.renderer=this.renderer,this._createBeatDot(t,a),this.addEffect(a)}}else{const t=new wO;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;const i=new Up(!1);i.renderer=this.renderer;for(const s of this.container.beat.notes)s.isVisible&&(!s.beat.slashed||s.index===0)&&(this._createNoteGlyph(s),i.addParenthesis(s));if(this.addNormal(t),i.isEmpty||this.addEffect(i),this.container.beat.hasWhammyBar){const s=new BO(this.container.beat);s.renderer=this.renderer,s.doLayout(),this.container.ties.push(s)}if(this.container.beat.dots>0)for(let s=0;s<this.container.beat.dots;s++){const a=new ja(0,0);a.renderer=this.renderer;for(const o of this.container.beat.notes){const c=this._createBeatDot(e.getNoteLine(o),a);c.colorOverride=ht.noteColor(e.resources,Js.StandardNotationEffects,o)}this.addEffect(a)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads&&(this.centerX=this.noteHeads.x+this.noteHeads.width/2)}_createBeatDot(e,t){const i=this.renderer,s=new Yh(0,i.getScoreY(e));return t.addGlyph(s),s}_createNoteHeadGlyph(e){const t=this.container.beat.graceType!==De.None,i=e.style;if(i?.noteHead!==void 0){const s=new Ct(0,0,e.beat.duration,t);return s.symbol=i.noteHead,i.noteHeadCenterOnStem&&(s.centerOnStem=!0),s}if(e.beat.voice.bar.staff.isPercussion){const s=$i.getArticulation(e);if(s)return new TO(0,0,s,e.beat.duration,t);ee.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.beat.slashed?new no(0,0,e.beat.duration,t,e.beat):e.isDead?new _O(0,0,t):e.beat.graceType===De.BendGrace?new Ct(0,0,M.Quarter,!0):e.harmonicType===Re.Natural?new Gp(0,0,e.beat.duration,t):new Ct(0,0,e.beat.duration,t)}_createNoteGlyph(e){if(e.beat.graceType===De.BendGrace&&!e.hasBend)return;const t=this.renderer,i=this._createNoteHeadGlyph(e);i.colorOverride=ht.noteColor(t.resources,Js.StandardNotationNoteHead,e);let s;if(e.beat.slashed?s=t.heightLineCount-1:s=t.getNoteLine(e),i.y=t.getScoreY(s),this.noteHeads.addMainNoteGlyph(i,e,s),!e.beat.slashed&&e.harmonicType!==Re.None&&e.harmonicType!==Re.Natural){const h=e.displayValue+e.harmonicPitch,d=new Gp(0,0,e.beat.duration,this.container.beat.graceType!==De.None);d.colorOverride=i.colorOverride,s=t.accidentalHelper.getNoteLineForValue(h,!1),d.y=t.getScoreY(s),this.noteHeads.addEffectNoteGlyph(d,s)}const a=this.noteHeads.belowBeatEffects,o=this.noteHeads.aboveBeatEffects,c=this.beamingHelper.direction===j.Up?this.noteHeads.belowBeatEffects:this.noteHeads.aboveBeatEffects;if(e.isStaccato&&!a.has("Staccato")&&c.set("Staccato",new iT(0,0)),e.accentuated===mi.Normal&&!a.has("Accent")&&c.set("Accent",new Ah(0,0,e)),e.accentuated===mi.Heavy&&!a.has("HAccent")&&c.set("HAccent",new Ah(0,0,e)),e.accentuated===mi.Tenuto&&!a.has("Tenuto")&&c.set("Tenuto",new Ah(0,0,e)),e.showStringNumber&&e.isStringed){let h;o.has("StringNumber")?h=o.get("StringNumber"):(h=new vO(0,0),o.set("StringNumber",h)),h.addString(e.string)}if(e.isPercussion){const h=$i.getArticulation(e);if(h&&h.techniqueSymbolPlacement!==Jt.Inside){let d;switch(h.techniqueSymbolPlacement){case Jt.Above:d=this.noteHeads.aboveBeatEffects;break;case Jt.Below:d=this.noteHeads.belowBeatEffects;break;case Jt.Outside:d=c;break;default:return}switch(h.techniqueSymbol){case S.PictEdgeOfCymbal:d.set("PictEdgeOfCymbal",new xO(0,0));break;case S.ArticStaccatoAbove:d.set("ArticStaccatoAbove",new iT(0,0));break;case S.StringsUpBow:d.set("StringsUpBow",new Uh(0,0,ds.Up));break;case S.StringsDownBow:d.set("StringsDownBow",new Uh(0,0,ds.Down));break;case S.GuitarGolpe:d.set("GuitarGolpe",new Sv(0,0,!0));break}}}}}class CO extends Vi{_beat;_noteVibratoGlyph;constructor(e){super(0,0),this._beat=e}doLayout(){if(this._beat.brushType===Ne.ArpeggioUp||this._beat.brushType===Ne.ArpeggioDown){const e=new jo(0,0,ct.Slight,!0);e.renderer=this.renderer,e.doLayout(),this._noteVibratoGlyph=e,this.width=e.height}else this.width=0}paint(e,t,i){if(this._beat.brushType===Ne.ArpeggioUp||this._beat.brushType===Ne.ArpeggioDown){const s=this.renderer,a=s.lineOffset,o=t+this.y+(s.getNoteY(this._beat.maxNote,pe.Bottom)-a),c=t+this.y+s.getNoteY(this._beat.minNote,pe.Top)+a,h=e+this.x+this.width/2,d=this.renderer.smuflMetrics.glyphWidths.get(S.ArrowheadBlackDown),p=this._noteVibratoGlyph;if(this._beat.brushType===Ne.ArpeggioUp){const g=o+d,y=c-d;p.width=Math.abs(y-g),i.beginRotate(e+this.x,y,-90),p.paint(0,0,i),i.endRotate(),i.beginPath(),i.moveTo(h,c),i.lineTo(h+d/2,c-d),i.lineTo(h-d/2,c-d),i.closePath(),i.fill()}else if(this._beat.brushType===Ne.ArpeggioDown){const g=o+d,y=c;p.width=Math.abs(y-g),i.beginRotate(e+this.x,g,90),p.paint(0,-p.height,i),i.endRotate(),i.beginPath(),i.moveTo(h,o),i.lineTo(h+d/2,o+d),i.lineTo(h-d/2,o+d),i.closePath(),i.fill()}}}}class EO extends tl{_prebends=null;get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}get effectElement(){return ti.StandardNotationEffects}accidentals=null;doLayout(){if(!this.container.beat.isRest){const e=new qb;e.renderer=this.renderer;const t=new Gh;t.renderer=this.renderer;const i=new Up(!0);i.renderer=this.renderer;const s=new Ho(this.container.beat,!0);this._prebends=s,s.renderer=this.renderer;let a=!1;for(const o of this.container.beat.notes){const c=ht.noteColor(this.renderer.resources,Js.StandardNotationEffects,o);if(o.isVisible){if(o.hasBend)switch(o.bendType){case Ae.PrebendBend:case Ae.Prebend:case Ae.PrebendRelease:s.addGlyph(o.displayValue-(o.bendPoints[0].value/2|0),!1,c);break}else if(o.beat.hasWhammyBar)switch(o.beat.whammyBarType){case Dt.PrediveDive:case Dt.Predive:this._prebends.addGlyph(o.displayValue-(o.beat.whammyBarPoints[0].value/2|0),!1,c);break}switch(this._createAccidentalGlyph(o,e),i.addParenthesis(o),t.addFingers(o),o.slideInType){case Ji.IntoFromBelow:case Ji.IntoFromAbove:a=!0;break}}}a&&this.addNormal(new xn(0,0,this.renderer.smuflMetrics.simpleSlideWidth*(this.container.beat.graceType!==De.None?Ct.GraceScale:1))),s.isEmpty||(this.addEffect(s),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1)))),this.container.beat.brushType!==Ne.None&&(this.addEffect(new CO(this.container.beat)),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1)))),t.isEmpty||(this.isEmpty||this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1))),this.addEffect(t),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1)))),i.isEmpty||this.addEffect(i),e.isEmpty||(this.accidentals=e,this.isEmpty||this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1))),this.addNormal(e),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding*(this.container.beat.graceType!==De.None?Ct.GraceScale:1))))}super.doLayout()}_createAccidentalGlyph(e,t){const i=this.renderer;let s=i.accidentalHelper.applyAccidental(e),a=i.getNoteLine(e);const o=this.container.beat.graceType!==De.None,c=ht.noteColor(i.resources,Js.StandardNotationAccidentals,e),h=o?Ct.GraceScale:1;if(s!==Le.None){const d=new _r(0,i.getScoreY(a),s,h);d.colorOverride=c,d.renderer=this.renderer,t.addGlyph(d)}if(e.harmonicType!==Re.None&&e.harmonicType!==Re.Natural){const d=e.displayValue+e.harmonicPitch;s=i.accidentalHelper.applyAccidentalForValue(e.beat,d,o,!1),a=i.accidentalHelper.getNoteLineForValue(d,!1);const p=new _r(0,i.getScoreY(a),s,h);p.colorOverride=c,p.renderer=this.renderer,t.addGlyph(p)}}}class PO extends xv{_beat;_notes=[];_endNoteGlyph=null;_middleNoteGlyph=null;constructor(e){super(0,0),this._beat=e}addBends(e){if(this._notes.push(e),e.isTieOrigin)return;const t=ht.noteColor(this.renderer.resources,Js.StandardNotationEffects,e);switch(e.bendType){case Ae.Bend:case Ae.PrebendRelease:case Ae.PrebendBend:{let i=this._endNoteGlyph;i||(i=new Ho(e.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.bendNoteHeads.push(i));const s=e.bendPoints[e.bendPoints.length-1];i.addGlyph(this._getBendNoteValue(e,s),s.value%2!==0,t)}break;case Ae.Release:if(!e.isTieOrigin){let i=this._endNoteGlyph;i||(i=new Ho(e.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.bendNoteHeads.push(i));const s=e.bendPoints[e.bendPoints.length-1];i.addGlyph(this._getBendNoteValue(e,s),s.value%2!==0,t)}break;case Ae.BendRelease:{let i=this._middleNoteGlyph;i||(i=new Ho(e.beat,!1),this._middleNoteGlyph=i,i.renderer=this.renderer,this.bendNoteHeads.push(i));const s=e.bendPoints[1];i.addGlyph(this._getBendNoteValue(e,e.bendPoints[1]),s.value%2!==0,t);let a=this._endNoteGlyph;a||(a=new Ho(e.beat,!1),a.renderer=this.renderer,this._endNoteGlyph=a,this.bendNoteHeads.push(a));const o=e.bendPoints[e.bendPoints.length-1];a.addGlyph(this._getBendNoteValue(e,o),o.value%2!==0,t)}break}}paint(e,t,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._beat.voice.bar),a=e+s.x+s.getBeatX(this._beat,lt.MiddleNotes);let o=e+s.x;this._beat.isLastOfVoice?o+=s.postBeatGlyphsStart:o+=s.getBeatX(this._beat.nextBeat,lt.PreNotes),this._endNoteGlyph&&(o-=this._endNoteGlyph.upLineX);const c=(a+o)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=c-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+s.y,this._middleNoteGlyph.paint(0,0,i)),this._endNoteGlyph&&(this._endNoteGlyph.x=o-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+s.y,this._endNoteGlyph.paint(0,0,i)),this._notes.sort((g,y)=>y.displayValue-g.displayValue);const h=this._beat.graceType===De.BendGrace?this._beat.nextBeat:this._beat;let d=this._notes.length===1?this.getTieDirection(h,s):j.Up;const p=this.renderer.smuflMetrics.glyphHeights.get(S.NoteheadBlack);for(let g=0;g<this._notes.length;g++){const y=this._notes[g],k=ht.note(i,Js.StandardNotationEffects,y);try{g>0&&g>=(this._notes.length/2|0)&&(d=j.Down);let _=t+s.y+s.getNoteY(y,pe.Top),w=p*Ct.GraceScale*.5;d===j.Down&&(_+=p);const T=y.bendStyle===Kt.Gradual?"grad.":"";if(y.isTieOrigin){const x=y.tieDestination,E=x?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,x.beat.voice.bar):null;if(!E||E.staff!==s.staff){const N=e+s.x+s.width,v=y.tieDestination.realValue;s.accidentalHelper.applyAccidentalForValue(y.beat,v,!1,!0);const L=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(v,!1));y.bendType===Ae.Hold||y.bendType===Ae.Prebend?hs.paintTie(i,1,a,_,N,L,d===j.Down,this.renderer.smuflMetrics.tieHeight,this.renderer.smuflMetrics.slurMidpointThickness):this.drawBendSlur(i,a,_,N,L,d===j.Down,1,T)}else{const N=e+E.x+E.getBeatX(x.beat,lt.MiddleNotes);let v=t+E.y+E.getNoteY(x,pe.Top);d===j.Down&&(v+=p),y.bendType===Ae.Hold||y.bendType===Ae.Prebend?hs.paintTie(i,1,a,_,N,v,d===j.Down,this.renderer.smuflMetrics.tieHeight,this.renderer.smuflMetrics.slurMidpointThickness):this.drawBendSlur(i,a,_,N,v,d===j.Down,1,T)}switch(y.bendType){case Ae.Prebend:case Ae.PrebendBend:case Ae.PrebendRelease:let N=e+s.x+s.getBeatX(y.beat,lt.PreNotes);N+=s.getPreNotesGlyphForBeat(y.beat).prebendNoteHeadOffset;const v=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(y.displayValue-(y.bendPoints[0].value/2|0),!1))+w;this.drawBendSlur(i,N,v,a,_,d===j.Down,1);break}}else{d===j.Up&&(w=-w);let x=0,E=0;switch(y.bendType){case Ae.Bend:x=this._getBendNoteValue(y,y.bendPoints[y.bendPoints.length-1]),E=this._endNoteGlyph.getNoteValueY(x)+w,this.drawBendSlur(i,a,_,o,E,d===j.Down,1,T);break;case Ae.BendRelease:const N=this._getBendNoteValue(y,y.bendPoints[1]),v=this._middleNoteGlyph.getNoteValueY(N)+w;this.drawBendSlur(i,a,_,c,v,d===j.Down,1,T),x=this._getBendNoteValue(y,y.bendPoints[y.bendPoints.length-1]),E=this._endNoteGlyph.getNoteValueY(x)+w,this.drawBendSlur(i,c,v,o,E,d===j.Down,1,T);break;case Ae.Release:this.bendNoteHeads.length>0&&(x=this._getBendNoteValue(y,y.bendPoints[y.bendPoints.length-1]),E=this.bendNoteHeads[0].getNoteValueY(x)+w,this.drawBendSlur(i,a,_,o,E,d===j.Down,1,T));break;case Ae.Prebend:case Ae.PrebendBend:case Ae.PrebendRelease:let L=e+s.x+s.getBeatX(y.beat,lt.PreNotes);L+=s.getPreNotesGlyphForBeat(y.beat).prebendNoteHeadOffset;const A=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(y.displayValue-(y.bendPoints[0].value/2|0),!1))+w;this.drawBendSlur(i,L,A,a,_,d===j.Down,1),this.bendNoteHeads.length>0&&(x=this._getBendNoteValue(y,y.bendPoints[y.bendPoints.length-1]),E=this.bendNoteHeads[0].getNoteValueY(x)+w,this.drawBendSlur(i,a,_,o,E,d===j.Down,1,T));break}}}finally{k?.[Symbol.dispose]?.()}}}_getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class U0 extends hs{constructor(e,t,i=!1){super(e,t,i)}doLayout(){super.doLayout()}getBeamDirection(e,t){if(e.isRest)return j.Up;switch(t.getBeatDirection(e)){case j.Up:return j.Down;default:return j.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case j.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,pe.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,pe.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case j.Up:return e.getScoreY(9);default:return e.getScoreY(0)}const t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);if(t!==i&&this.startBeat.graceType===De.None){if(i===this.tieDirection)switch(this.tieDirection){case j.Up:return e.getNoteY(this.endBeat.maxNote,pe.TopWithStem);default:return e.getNoteY(this.endBeat.minNote,pe.BottomWithStem)}switch(this.tieDirection){case j.Up:return e.getNoteY(this.endBeat.maxNote,pe.BottomWithStem);default:return e.getNoteY(this.endBeat.minNote,pe.TopWithStem)}}switch(this.tieDirection){case j.Up:return e.getNoteY(this.endBeat.maxNote,pe.Top);default:return e.getNoteY(this.endBeat.minNote,pe.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,lt.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>M.Whole&&e===this.tieDirection?lt.Stem:lt.MiddleNotes)}}class DO extends Vi{_outType;_inType;_startNote;_parent;constructor(e,t,i,s){super(0,0),this._outType=t,this._inType=e,this._startNote=i,this._parent=s}doLayout(){this.width=0}paint(e,t,i){this._paintSlideIn(e,t,i),this._drawSlideOut(e,t,i)}_paintSlideIn(e,t,i){const s=this.renderer,a=s.smuflMetrics.simpleSlideWidth;let o=e+s.x+s.getNoteX(this._startNote,ci.Left)-s.smuflMetrics.preNoteEffectPadding;const c=t+s.y+s.getNoteY(this._startNote,pe.Center);let h=o-a,d=t+s.y;switch(this._inType){case Ji.IntoFromBelow:d+=s.getNoteY(this._startNote,pe.Bottom);break;case Ji.IntoFromAbove:d+=s.getNoteY(this._startNote,pe.Top);break;default:return}const p=this._getAccidentalsWidth(s,this._startNote.beat);h-=p,o-=p,this._paintSlideLine(i,!1,h,o,d,c)}_getAccidentalsWidth(e,t){const i=e.getPreNotesGlyphForBeat(t);return i&&i.accidentals?i.accidentals.width:0}_drawSlideOut(e,t,i){const s=this.renderer,a=s.smuflMetrics.simpleSlideWidth,o=s.smuflMetrics.postNoteEffectPadding;let c=0,h=0,d=0,p=0,g=!1;switch(this._outType){case $e.Shift:case $e.Legato:if(c=e+s.x+s.getBeatX(this._startNote.beat,lt.PostNotes)+o,h=t+s.y+s.getNoteY(this._startNote,pe.Center),this._startNote.slideTarget){const y=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);!y||y.staff!==s.staff?(d=e+s.x+s.width,this._startNote.slideTarget.realValue>this._startNote.realValue?p=t+s.y+s.getNoteY(this._startNote,pe.Top):p=t+s.y+s.getNoteY(this._startNote,pe.Bottom)):(d=e+y.x+y.getBeatX(this._startNote.slideTarget.beat,lt.PreNotes)-o,p=t+y.y+y.getNoteY(this._startNote.slideTarget,pe.Center))}else d=e+s.x+this._parent.x,p=h;break;case $e.OutUp:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+o,h=t+s.y+s.getNoteY(this._startNote,pe.Center),d=c+a,p=t+s.y+s.getNoteY(this._startNote,pe.Top);break;case $e.OutDown:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+o,h=t+s.y+s.getNoteY(this._startNote,pe.Center),d=c+a,p=t+s.y+s.getNoteY(this._startNote,pe.Bottom);break;case $e.PickSlideUp:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+o*2,h=t+s.y+s.getNoteY(this._startNote,pe.Center),p=t+s.y+s.getNoteY(this._startNote,pe.Top),d=e+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(d=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,lt.PreNotes)),g=!0;break;case $e.PickSlideDown:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+o*2,h=t+s.y+s.getNoteY(this._startNote,pe.Center),p=t+s.y+s.getNoteY(this._startNote,pe.Bottom),d=e+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(d=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,lt.PreNotes)),g=!0;break;default:return}this._paintSlideLine(i,g,c,d,h,p)}_paintSlideLine(e,t,i,s,a,o){if(t){const c=new jo(0,0,ct.Slight);c.renderer=this.renderer,c.doLayout(),a-=c.height/2,o-=c.height/2;const h=s-i,d=o-a,p=Math.sqrt(Math.pow(d,2)+Math.pow(h,2));c.width=h;const g=Math.asin(d/p)*(180/Math.PI);e.beginRotate(i,a,g),c.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,a),e.lineTo(s,o),e.stroke()}}class Of extends U0{_startNote;_endNote;constructor(e,t,i=!1){super(e.beat,t.beat,i),this._startNote=e,this._endNote=t}getTieHeight(e,t,i,s){return Math.log2(i-e+1)*this.renderer.settings.notation.slurHeight/2}getStartY(){if(this._isStartCentered())switch(this.tieDirection){case j.Up:return this.startNoteRenderer.getNoteY(this._startNote,pe.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,pe.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,pe.Center)}getEndY(){if(this._isEndCentered()){if(this._isEndOnStem())switch(this.tieDirection){case j.Up:return this.endNoteRenderer.getNoteY(this._endNote,pe.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,pe.BottomWithStem)}switch(this.tieDirection){case j.Up:return this.endNoteRenderer.getNoteY(this._endNote,pe.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,pe.Bottom)}}return this.endNoteRenderer.getNoteY(this._endNote,pe.Center)}_isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===j.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===j.Down}_isEndCentered(){return this._startNote.beat.graceType===De.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===j.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===j.Down)}_isEndOnStem(){const e=this.endNoteRenderer,t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);return t!==i&&this.startBeat.graceType===De.None}getStartX(){return this._isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,lt.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,ci.Right)}getEndX(){return this._isEndCentered()?this._isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,lt.Stem):this.endNoteRenderer.getNoteX(this._endNote,ci.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,lt.PreNotes)}}class sT extends hs{startNote;endNote;constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){switch(t.getBeatDirection(e)){case j.Up:return j.Down;default:return j.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case j.Up:return this.startNoteRenderer.getNoteY(this.startNote,pe.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,pe.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case j.Up:return e.getScoreY(9);default:return e.getScoreY(0)}switch(this.tieDirection){case j.Up:return e.getNoteY(this.endNote,pe.Top);default:return e.getNoteY(this.endNote,pe.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,lt.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,lt.PreNotes)}}class MO extends Da{_bend=null;_effectSlur=null;_effectEndSlur=null;doLayout(){this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==De.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){const t=new sT(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){const t=new sT(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==Ji.None||e.slideOutType!==$e.None){const t=new DO(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){const t=new Of(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){const t=new Of(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new Of(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){const t=this.onNotes.beamingHelper.direction,i=t===j.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,s=t===j.Up?e.beat.minNote:e.beat.maxNote,a=new Of(i,s,!0);this._effectEndSlur=a,this.addTie(a)}if(e.hasBend){if(!this._bend){const t=new PO(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}if(this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let t=this.beat.nextBeat;for(;t.nextBeat&&t.nextBeat.isLegatoDestination;)t=t.nextBeat;this.addTie(new U0(this.beat,t,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let t=this.beat.previousBeat;for(;t.previousBeat&&t.previousBeat.isLegatoOrigin;)t=t.previousBeat;this.addTie(new U0(t,this.beat,!0))}}}}class LO extends El{paint(e,t,i){const s=ht.bar(i,Bt.StandardNotationKeySignature,this.renderer.bar);try{super.paint(e,t,i)}finally{s?.[Symbol.dispose]?.()}}}class zo extends Zr{static StaffId="score";static _sharpKsSteps=[-1,2,-2,1,4,0,3];static _flatKsSteps=[3,0,4,1,5,2,6];simpleWhammyOverflow=0;beatEffectsMinY=null;beatEffectsMaxY=null;accidentalHelper;constructor(e,t){super(e,t),this.accidentalHelper=new Gs(this)}get repeatsBarSubElement(){return Bt.StandardNotationRepeats}get barNumberBarSubElement(){return Bt.StandardNotationBarNumber}get barLineBarSubElement(){return Bt.StandardNotationBarLines}get staffLineBarSubElement(){return Bt.StandardNotationStaffLine}get showMultiBarRest(){return!0}get lineSpacing(){return this.smuflMetrics.oneStaffSpace}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(e,t){const i=this.beatEffectsMinY;(i==null||e<i)&&(this.beatEffectsMinY=e);const s=this.beatEffectsMaxY;(s==null||t>s)&&(this.beatEffectsMaxY=t)}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){const e=this.getScoreY(-2),t=this.getScoreY(this.heightLineCount*2),i=this.simpleWhammyOverflow,s=this.beatEffectsMinY;if(s!==null){const d=e-s;d>0&&this.registerOverflowTop(d)}const a=this.beatEffectsMaxY;if(a!==null){const d=a-t;d>0&&this.registerOverflowBottom(d)}this.registerOverflowTop(i);const o=this.getScoreHeight(1);let c=0,h=0;for(const d of this.helpers.beamHelpers)for(const p of d)if(p.isRestBeamHelper){if(p.minRestLine){const g=this.getScoreY(p.maxRestLine)-o;g<c&&(c=g)}if(p.maxRestLine){const g=this.getScoreY(p.maxRestLine)+o;g<c&&(c=g)}}else if(p.beats.length===1)if(p.beats[0].duration>=M.Half)if(p.direction===j.Up){let g=this.getFlagTopY(p.beats[0],p.direction);p.hasTuplet&&(g-=this.tupletSize+this.tupletOffset),g<c&&(c=g);const y=this.getFlagBottomY(p.beats[0],p.direction)+o;y>h&&(h=y)}else{let g=this.getFlagBottomY(p.beats[0],p.direction);p.hasTuplet&&(g+=this.tupletSize+this.tupletOffset),g>h&&(h=g);const y=this.getFlagTopY(p.beats[0],p.direction)-o;y<c&&(c=y)}else{const g=this.getBeatContainer(p.beats[0]);if(g){let y=g.onNotes.getHighestNoteY()-o,k=g.onNotes.getLowestNoteY()+o;p.direction===j.Up?p.hasTuplet&&(y-=this.tupletSize+this.tupletOffset):p.hasTuplet&&(k+=this.tupletSize+this.tupletOffset),k>h&&(h=k),y<c&&(c=y)}}else{this._ensureDrawingInfo(p,p.direction);const g=p.drawingInfos.get(p.direction);if(p.direction===j.Up){let y=Math.min(g.startY,g.endY);p.hasTuplet&&(y-=this.tupletSize+this.tupletOffset),y<c&&(c=y);const k=this.getBarLineStart(p.beatOfLowestNote,p.direction)+o;k>h&&(h=k)}else{let y=Math.max(g.startY,g.endY);p.hasTuplet&&(y+=this.tupletSize+this.tupletOffset),y>h&&(h=y);const k=this.getBarLineStart(p.beatOfHighestNote,p.direction)-o;k<c&&(c=k)}}c<e&&this.registerOverflowTop(Math.abs(c)+i),h>t&&this.registerOverflowBottom(Math.abs(h)-t)}}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,ti.StandardNotationFlags,ti.StandardNotationBeams),this.paintTuplets(e,t,i,ti.StandardNotationTuplet)}_getSlashFlagY(){const e=(this.heightLineCount-1)/2;return this.getLineY(e)}getFlagTopY(e,t){if(e.slashed){let a=this._getSlashFlagY();const o=no.getSymbol(e.duration),c=e.graceType!==De.None?Ct.GraceScale:1;return t===j.Down?a-=this.smuflMetrics.stemDown.has(o)?this.smuflMetrics.stemDown.get(o).topY*c:0:(a-=this.smuflMetrics.stemUp.has(o)?this.smuflMetrics.stemUp.get(o).bottomY*c:0,a-=this.smuflMetrics.standardStemLength+c),a}const i=this.accidentalHelper.getMinLineNote(e);if(i)return this.getBeatContainer(e).onNotes.getNoteY(i,t===j.Up?pe.TopWithStem:pe.StemDown);let s=this.getScoreY(this.accidentalHelper.getMinLine(e));if(t===j.Up){const a=e.graceType!==De.None?Ct.GraceScale:1;s-=this.smuflMetrics.standardStemLength*a}return s}getFlagBottomY(e,t){if(e.slashed){let a=this._getSlashFlagY();const o=no.getSymbol(e.duration),c=e.graceType!==De.None?Ct.GraceScale:1;return t===j.Down?(a-=this.smuflMetrics.stemDown.has(o)?this.smuflMetrics.stemDown.get(o).topY*c:0,a+=this.smuflMetrics.standardStemLength+c):a-=this.smuflMetrics.stemUp.has(o)?this.smuflMetrics.stemUp.get(o).bottomY*c:0,a}const i=this.accidentalHelper.getMaxLineNote(e);if(i)return this.getBeatContainer(e).onNotes.getNoteY(i,t===j.Up?pe.StemUp:pe.BottomWithStem);let s=this.getScoreY(this.accidentalHelper.getMaxLine(e));if(t===j.Down){const a=e.graceType!==De.None?Ct.GraceScale:1;s+=this.smuflMetrics.standardStemLength*a}return s}getBeamDirection(e){return e.direction}centerStaffStemY(e){return this.bar.staff.standardNotationLineCount===el.DefaultStandardNotationLineCount?this.getScoreY(this.bar.staff.standardNotationLineCount-1):e.direction===j.Up?this.getScoreY(this.bar.staff.standardNotationLineCount*2):this.getScoreY(0)}getStemBottomY(e){throw new Error("Method not implemented.")}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,t){if(e.beat.slashed){const s=(this.heightLineCount-1)/2;return this.getLineY(s)}let i=super.getNoteY(e,t);if(Number.isNaN(i)){const s=Gs.computeLineWithoutAccidentals(this.bar,e);i=this.getScoreY(s);const a=e.beat.graceType===De.None?1:Ct.GraceScale,o=this.smuflMetrics.standardStemLength*a,c=this.smuflMetrics.glyphHeights.get(Ct.getSymbol(e.beat.duration))*a;switch(t){case pe.TopWithStem:i-=o;break;case pe.Top:i-=c/2;break;case pe.Center:break;case pe.Bottom:i+=c/2;break;case pe.BottomWithStem:i+=o;break;case pe.StemUp:break;case pe.StemDown:break}}return i}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){const t=this.getScoreY(-2),i=this.getScoreY(this.heightLineCount*2),s=this.helpers.collisionHelper.getBeatMinMaxY();s[0]<t&&this.registerOverflowTop(Math.abs(s[0])),s[1]>i&&this.registerOverflowBottom(Math.abs(s[1])-i)}return e}calculateBeamYWithDirection(e,t,i){return e.beats.length===0?i===j.Up?this.getFlagTopY(e.beats[0],i):this.getFlagBottomY(e.beats[0],i):(this._ensureDrawingInfo(e,i),e.drawingInfos.get(i).calcY(t))}_ensureDrawingInfo(e,t){if(!e.drawingInfos.has(t)){const i=e.graceType!==De.None?Ct.GraceScale:1,s=ce.getIndex(e.shortestDuration)-2;let a=this.smuflMetrics.standardStemLength*i;if(e.tremoloDuration){const g=(this.smuflMetrics.beamThickness+this.smuflMetrics.beamSpacing)*i;e.shortestDuration>M.Eighth?e.tremoloDuration===M.Eighth?a+=g:a+=g*1.5:e.tremoloDuration===M.ThirtySecond&&(a+=g*1.5)}const o=new s3;e.drawingInfos.set(t,o);const c=e.beats[0],h=e.beats[e.beats.length-1],d=e.isRestBeamHelper;o.startBeat=c,o.startX=e.getBeatLineX(c),d?o.startY=t===j.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):o.startY=t===j.Up?this.getFlagTopY(c,t):this.getFlagBottomY(c,t),o.endBeat=h,o.endX=e.getBeatLineX(h),d?o.endY=t===j.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):o.endY=t===j.Up?this.getFlagTopY(h,t):this.getFlagBottomY(h,t);const p=this.smuflMetrics.oneStaffSpace;if(t===j.Down&&o.startY>o.endY&&o.startY-o.endY>p&&(o.endY=o.startY-p),t===j.Down&&o.endY>o.startY&&o.endY-o.startY>p&&(o.startY=o.endY-p),t===j.Up&&o.startY<o.endY&&o.endY-o.startY>p&&(o.endY=o.startY+p),t===j.Up&&o.endY<o.startY&&o.startY-o.endY>p&&(o.startY=o.endY+p),e.beats.length>1){if(t===j.Up){const g=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-a,k=o.calcY(e.getBeatLineX(e.beatOfHighestNote))-g;k>0&&(o.startY-=k,o.endY-=k)}else{const g=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+a,y=o.calcY(e.getBeatLineX(e.beatOfLowestNote)),k=g-y;k>0&&(o.startY+=k,o.endY+=k)}if(e.minRestLine!==null||e.maxRestLine!==null){const g=e.graceType!==De.None?Ct.GraceScale:1;let y=s*(this.smuflMetrics.beamSpacing+this.smuflMetrics.beamThickness)*g;if(y+=this.smuflMetrics.beamSpacing,t===j.Up&&e.minRestLine!==null){const k=this.getScoreY(e.minRestLine)-y,w=o.calcY(e.getBeatLineX(e.beatOfMinRestLine))-k;w>0&&(o.startY-=w,o.endY-=w)}else if(t===j.Down&&e.maxRestLine!==null){const k=this.getScoreY(e.maxRestLine)+y,_=o.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),w=k-_;w>0&&(o.startY+=w,o.endY+=w)}}if(e.slashBeats.length>0)for(const g of e.slashBeats){const y=o.calcY(e.getBeatLineX(g)),_=(e.direction===j.Up?this.getFlagTopY(g,e.direction):this.getFlagBottomY(g,e.direction))-y;_>0&&(o.startY+=_,o.endY+=_)}}if(s>2&&!d){const g=this.smuflMetrics.beamSpacing*i,y=this.smuflMetrics.beamThickness*i,k=s*y+(s-1)*g;if(t===j.Up){const w=o.startY+2*y+g-k,T=o.startY-w;T>0&&(o.startY-=T,o.endY-=T)}else{const T=o.startY-2*y+g+k-o.startY;T>0&&(o.startY+=T,o.endY+=T)}}}}getBarLineStart(e,t){if(e.slashed)return t===j.Down?this.getFlagTopY(e,t):this.getFlagBottomY(e,t);if(t===j.Up){const s=this.accidentalHelper.getMaxLineNote(e);return s?this.getBeatContainer(e).onNotes.getNoteY(s,pe.StemUp):this.getScoreY(this.accidentalHelper.getMaxLine(e))}const i=this.accidentalHelper.getMinLineNote(e);return i?this.getBeatContainer(e).onNotes.getNoteY(i,pe.StemDown):this.getScoreY(this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){let e=!1;if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let t=0;switch(this.bar.clef){case _t.Neutral:t=this.bar.staff.standardNotationLineCount-1;break;case _t.F4:t=2;break;case _t.C3:t=4;break;case _t.C4:t=2;break;case _t.G2:t=6;break}this.createStartSpacing(),this.addPreBeatGlyph(new Qb(0,this.getScoreY(t),this.bar.clef,this.bar.clefOttava)),this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.preBeatGlyphSpacing)),e=!0}(e||this.index===0&&this.bar.keySignature!==Xt.C||this.bar.previousBar&&this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this._createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this._createTimeSignatureGlyphs())}_createKeySignatureGlyphs(){let e=0;const t=this.bar.keySignature,i=this.bar.previousBar?this.bar.previousBar.keySignature:0;switch(this.bar.clef){case _t.Neutral:e=0;break;case _t.G2:e=1;break;case _t.F4:e=3;break;case _t.C3:e=2;break;case _t.C4:e=0;break}const s=new LO;s.gap=this.smuflMetrics.accidentalPadding,s.renderer=this;const a=new Map,o=[];if(ce.keySignatureIsSharp(t))for(let c=0;c<Math.abs(t);c++){const h=zo._sharpKsSteps[c]+e;o.push(new _r(0,this.getScoreY(h),Le.Sharp,1)),a.set(h,!0)}else for(let c=0;c<Math.abs(t);c++){const h=zo._flatKsSteps[c]+e;o.push(new _r(0,this.getScoreY(h),Le.Flat,1)),a.set(h,!0)}if(this.bar.keySignature===Xt.C){const c=Math.abs(i),h=ce.keySignatureIsSharp(i)?zo._sharpKsSteps:zo._flatKsSteps;for(let d=0;d<c;d++){const p=h[d]+e;a.has(p)||s.addGlyph(new _r(0,this.getScoreY(h[d]+e),Le.Natural,1))}}for(const c of o)s.addGlyph(c);this.addPreBeatGlyph(s),s.isEmpty||this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.preBeatGlyphSpacing))}_createTimeSignatureGlyphs(){const e=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new Jb(0,this.getScoreY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime)),this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.preBeatGlyphSpacing))}createVoiceGlyphs(e){for(const t of e.beats){const i=new MO(t,this.getVoiceContainer(e));i.preNotes=new EO,i.onNotes=new NO,this.addBeatGlyph(i)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let t=0,i=0,s=0;e.hasTuplet&&(s+=this.resources.effectFont.size*2),e.direction===j.Up?(t=this.getNoteY(e.highestNoteInHelper,pe.TopWithStem)-s,i=this.getNoteY(e.lowestNoteInHelper,pe.Bottom)):(t=this.getNoteY(e.highestNoteInHelper,pe.Top),i=this.getNoteY(e.lowestNoteInHelper,pe.BottomWithStem)+s);for(const a of e.beats)this.helpers.collisionHelper.reserveBeatSlot(a,t,i)}}paintBeamingStem(e,t,i,s,a,o){const c=ht.beat(o,ti.StandardNotationStem,e);try{o.fillRect(i,s,this.smuflMetrics.stemThickness,a-s)}finally{c?.[Symbol.dispose]?.()}}}class AO extends nd{get staffId(){return zo.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new zo(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showStandardNotation}}class nT extends hs{startNote;endNote;constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}get _isLeftHandTap(){return this.startNote===this.endNote}getTieHeight(e,t,i,s){return this._isLeftHandTap?this.startNoteRenderer.smuflMetrics.tieHeight:super.getTieHeight(e,t,i,s)}getBeamDirection(e,t){return j.Down}static getBeamDirectionForNote(e){return j.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,pe.Center)}getEndY(){return this.getStartY()}getStartX(){return this._isLeftHandTap?this.getEndX()-this.renderer.smuflMetrics.leftHandTabTieWidth:this.startNoteRenderer.getNoteX(this.startNote,ci.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,ci.Left)}}class RO extends Da{_tiedNoteTie=null;createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){const t=new nT(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){const t=new nT(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class OO extends rd{updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){super.internalPaint(e,t,i,ti.SlashRests)}}class FO extends il{noteHeads=null;deadSlapped=null;restGlyph=null;get effectElement(){return ti.SlashEffects}getNoteX(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let s=i.x;switch(t){case ci.Left:break;case ci.Center:s+=i.width/2;break;case ci.Right:s+=i.width;break}return s}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const s=new id;s.note=this.container.beat.notes[0],s.noteHeadBounds=new Os,s.noteHeadBounds.x=t+this.x+this.noteHeads.x,s.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,e.addNote(s)}}getLowestNoteY(){return this.noteHeads?this.noteHeads.y:0}getHighestNoteY(){return this.noteHeads?this.noteHeads.y:0}getNoteY(e,t){let i=null,s=S.None;if(this.noteHeads?(i=this.noteHeads,s=no.getSymbol(e.beat.duration)):this.deadSlapped&&(i=this.deadSlapped),i){let a=this.y+i.y;switch(t){case pe.Top:case pe.TopWithStem:a-=i.height/2;break;case pe.Center:break;case pe.Bottom:case pe.BottomWithStem:a+=i.height/2;break;case pe.StemUp:a-=this.renderer.smuflMetrics.stemUp.has(s)?this.renderer.smuflMetrics.stemUp.get(s).bottomY:0;break;case pe.StemDown:a-=this.renderer.smuflMetrics.stemDown.has(s)?this.renderer.smuflMetrics.stemDown.get(s).topY:0;break}return a}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.deadSlapped?this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.container.beat,this.container.x+this.x+this.deadSlapped.x+this.width,this.container.x+this.x+this.deadSlapped.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){const e=this.renderer,t=e.getNoteLine(),i=e.getLineY(t);if(this.container.beat.deadSlapped){const s=new wg;s.renderer=this.renderer,s.doLayout(),this.deadSlapped=s,this.addEffect(s)}else if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const s=new OO(0,i,this.container.beat.duration);this.restGlyph=s,s.beat=this.container.beat,s.beamingHelper=this.beamingHelper,this.addNormal(s),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const s=this.container.beat.graceType!==De.None,a=new no(0,i,this.container.beat.duration,s,this.container.beat);this.noteHeads=a,a.beat=this.container.beat,a.beamingHelper=this.beamingHelper,this.addNormal(a)}if(this.container.beat.dots>0)for(let s=0;s<this.container.beat.dots;s++)this.addEffect(new Yh(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5)));super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}class aT extends Zr{static StaffId="slash";simpleWhammyOverflow=0;_isOnlySlash;constructor(e,t){super(e,t),this._isOnlySlash=!t.staff.showTablature&&!t.staff.showStandardNotation,this.helpers.preferredBeamDirection=j.Up}get repeatsBarSubElement(){return Bt.SlashRepeats}get barNumberBarSubElement(){return Bt.SlashBarNumber}get barLineBarSubElement(){return Bt.SlashBarLines}get staffLineBarSubElement(){return Bt.SlashStaffLine}get lineSpacing(){return this.smuflMetrics.oneStaffSpace}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,ti.SlashFlags,ti.SlashBeams),this.paintTuplets(e,t,i,ti.SlashTuplet)}doLayout(){super.doLayout();let e=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e,t){const i=this.smuflMetrics.glyphHeights.get(S.NoteheadSlashWhiteHalf);let s=this.getLineY(0)-i/2;return t===j.Up&&(s-=this.getFlagStemSize(e.duration,!0)),s}getFlagBottomY(e,t){const i=this.smuflMetrics.glyphHeights.get(S.NoteheadSlashWhiteHalf);let s=this.getLineY(0)-i/2;return t===j.Down&&(s+=this.getFlagStemSize(e.duration,!0)),s}getBeamDirection(e){return j.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,t){const i=this.smuflMetrics.glyphHeights.get(S.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this._createTimeSignatureGlyphs())}_createTimeSignatureGlyphs(){this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.oneStaffSpace));const e=this.bar.masterBar,t=new Jb(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime));t.barSubElement=Bt.SlashTimeSignature,this.addPreBeatGlyph(t)}createVoiceGlyphs(e){for(const t of e.beats){const i=new RO(t,this.getVoiceContainer(e));i.preNotes=new tl,i.onNotes=e.index===0?new FO:new il,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,s,a,o){const c=ht.beat(o,ti.SlashStem,e);try{const h=o.lineWidth;o.lineWidth=this.smuflMetrics.stemThickness,o.beginPath(),o.moveTo(i,s),o.lineTo(i,a),o.stroke(),o.lineWidth=h}finally{c?.[Symbol.dispose]?.()}}}class IO extends nd{get staffId(){return aT.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new aT(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}}class Ao extends ke{lineValue=0;constructor(e=0,t=0){super(e,t),this.lineValue=t}}class Tg extends Vi{_notes=[];_renderPoints=new Map;_preBendMinValue=-1;_bendMiddleMinValue=-1;_bendEndMinValue=-1;_bendEndContinuedMinValue=-1;_releaseMinValue=-1;_releaseContinuedMinValue=-1;_maxBendValue=-1;constructor(){super(0,0)}addBends(e){this._notes.push(e);const t=this._createRenderingPoints(e);this._renderPoints.set(e.id,t),(this._maxBendValue===-1||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let i=0;switch(e.bendType){case Ae.Bend:i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case Ae.Release:i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case Ae.BendRelease:i=t[1].value,(this._bendMiddleMinValue===-1||i<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=i),i=t[2].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case Ae.Prebend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i);break;case Ae.PrebendBend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case Ae.PrebendRelease:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break}}doLayout(){super.doLayout();const e=this._maxBendValue*this.renderer.smuflMetrics.tabBendPerValueHeight;this.renderer.registerOverflowTop(e);let t=0;for(const i of this._notes){const s=this._renderPoints.get(i.id);switch(i.bendType){case Ae.Bend:s[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case Ae.Release:t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[1].lineValue=t);break;case Ae.BendRelease:s[1].lineValue=this._bendMiddleMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[2].lineValue=t);break;case Ae.Prebend:s[0].lineValue=this._preBendMinValue;break;case Ae.PrebendBend:s[0].lineValue=this._preBendMinValue,s[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case Ae.PrebendRelease:s[0].lineValue=this._preBendMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[1].lineValue=t);break}}this.width=0,this._notes.sort((i,s)=>i.isStringed?i.string-s.string:i.realValue-s.realValue)}_createRenderingPoints(e){const t=[];switch(e.bendType){case Ae.Custom:for(const i of e.bendPoints)t.push(new Ao(i.offset,i.value));break;case Ae.BendRelease:t.push(new Ao(0,e.bendPoints[0].value)),t.push(new Ao(ke.MaxPosition/2|0,e.bendPoints[1].value)),t.push(new Ao(ke.MaxPosition,e.bendPoints[3].value));break;case Ae.Bend:case Ae.Hold:case Ae.Prebend:case Ae.PrebendBend:case Ae.PrebendRelease:case Ae.Release:t.push(new Ao(0,e.bendPoints[0].value)),t.push(new Ao(ke.MaxPosition,e.bendPoints[1].value));break}return t}paint(e,t,i){const s=i.color;this._notes.length>1&&(i.color=this.renderer.resources.secondaryGlyphColor);for(const a of this._notes){const o=this._renderPoints.get(a.id),c=this.renderer;let h=a,d=!1,p=null,g=!1;const y=a.bendStyle===Kt.Gradual?"grad.":"";let k=null;for(;h.isTieOrigin;){const v=h.tieDestination;if(p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,v.beat.voice.bar),!p||c.staff!==p.staff)break;if(h=v,d=!0,h.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes||h.vibrato!==ct.None){g=!0;break}}k=h.beat,p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,k.voice.bar),k.isLastOfVoice&&!h.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(k=null);let _=0,w=0;const T=t+c.y,x=this.renderer.smuflMetrics.glyphWidths.get(S.ArrowheadBlackDown);_=e+c.x,o[0].value>0||a.isContinuedBend?_+=c.getBeatX(a.beat,lt.MiddleNotes):_+=c.getNoteX(a,ci.Right),!k||k.isLastOfVoice&&!g?w=e+p.x+p.postBeatGlyphsStart:g||!k.nextBeat?w=e+p.x+p.getBeatX(k,lt.MiddleNotes):a.bendType===Ae.Hold?w=e+p.x+p.getBeatX(k.nextBeat,lt.OnNotes):w=e+p.x+p.getBeatX(k.nextBeat,lt.PreNotes),d||(w-=x);const N=(w-_)/ke.MaxPosition;i.beginPath();for(let v=0,L=o.length-1;v<L;v++){const A=o[v];let D=o[v+1];v===0&&A.value!==0&&!a.isTieDestination&&this._paintBend(a,new Ao(0,0),A,_,T,N,y,i),a.bendType!==Ae.Prebend?(v===0&&(_+=this.renderer.smuflMetrics.postNoteEffectPadding),this._paintBend(a,A,D,_,T,N,y,i)):a.isTieOrigin&&a.tieDestination.hasBend&&(D=new Ao(ke.MaxPosition,A.value),D.lineValue=A.lineValue,this._paintBend(a,A,D,_,T,N,y,i))}if(h.vibrato!==ct.None){const v=w-e+x-p.x,L=T-t-this.renderer.smuflMetrics.tabBendPerValueHeight*o[o.length-1].lineValue,A=new jo(v,L,h.vibrato);A.beat=h.beat,A.renderer=p,A.doLayout(),A.paint(e+p.x,t,i)}i.color=s}}_paintBend(e,t,i,s,a,o,c,h){const d=this.renderer,p=this.renderer.resources,g=d.lineOffset/2,y=s+o*t.offset,k=this.renderer.smuflMetrics.tabBendPerValueHeight;let _=a-k*t.lineValue;t.value===0?i.offset===t.offset?_+=d.getNoteY(e.beat.maxStringNote,pe.Top)-g/2:_+=d.getNoteY(e,pe.Center):_+=g;const w=s+o*i.offset;let T=a-k*i.lineValue;i.lineValue===0?T+=d.getNoteY(e,pe.Center):T+=g;let x=0;const E=this.renderer.smuflMetrics.glyphWidths.get(S.ArrowheadBlackDown);i.value>t.value?(T+E>_&&(T=_-E),h.beginPath(),h.moveTo(w,T),h.lineTo(w-E*.5,T+E),h.lineTo(w+E*.5,T+E),h.closePath(),h.fill(),x=E):i.value!==t.value&&(T<_&&(T=_+E),h.beginPath(),h.moveTo(w,T),h.lineTo(w-E*.5,T-E),h.lineTo(w+E*.5,T-E),h.closePath(),h.fill(),x=-E);const N=h.lineWidth;if(h.lineWidth=this.renderer.smuflMetrics.arrowShaftThickness,h.beginPath(),t.value===i.value){if(t.lineValue>0){let v=w;const L=this.renderer.smuflMetrics.tabBendDashSize,A=y+L;if((v-y)/(L*2)<1)h.moveTo(v,_),h.lineTo(y,_);else for(;v>A;)h.moveTo(v,_),h.lineTo(v-L,_),v-=L*2;h.stroke()}}else w>y?(h.moveTo(y,_),h.bezierCurveTo((y+w)/2,_,w,_,w,T+x),h.stroke()):(h.moveTo(y,_),h.lineTo(w,T),h.stroke());if(c&&t.offset<i.offset){h.font=p.graceFont;const v=h.measureText(c);let L=0,A=0;if(_>T){const D=Math.abs(_-T);L=D>v.height?_-D/2:_,A=(y+w-v.width)/2}else L=_,A=w-v.width;h.fillText(c,A,L)}if(i.value!==0&&t.value!==i.value){let v=i.value;const L=i.value>t.value;v=Math.abs(v);let A="";if(v===4)A="full",v-=4;else if(v>=4||v<=-4){const D=v/4|0;A+=D,v-=D*4}if(v>0&&(A+=Tg.getFractionSign(v)),A!==""){T=a-k*i.value;let D=T;L||(D=_+Math.abs(T-_)*1/3),h.font=p.tablatureFont;const H=h.measureText(A),J=D-H.height/1.5,K=w-H.width/2;h.fillText(A,K,J-p.engravingSettings.tabBendLabelPadding)}}h.lineWidth=N}static getFractionSign(e){switch(e){case 1:return"";case 2:return"";case 3:return"";default:return`${e}/ 4`}}}class WO extends Vi{_inType;_outType;_startNote;_parent;constructor(e,t,i,s){super(0,0),this._inType=e,this._outType=t,this._startNote=i,this._parent=s}doLayout(){this.width=0}paint(e,t,i){this._paintSlideIn(e,t,i),this._paintSlideOut(e,t,i)}_paintSlideIn(e,t,i){const s=this.renderer,a=this.renderer.smuflMetrics.simpleSlideWidth,o=this.renderer.smuflMetrics.simpleSlideHeight;let c=0,h=0,d=0,p=0;const g=this.renderer.smuflMetrics.preNoteEffectPadding;switch(this._inType){case Ji.IntoFromBelow:d=e+s.x+s.getNoteX(this._startNote,ci.Left)-g,p=t+s.y+s.getNoteY(this._startNote,pe.Center)-o,c=d-a,h=t+s.y+s.getNoteY(this._startNote,pe.Center)+o;break;case Ji.IntoFromAbove:d=e+s.x+s.getNoteX(this._startNote,ci.Left)-g,p=t+s.y+s.getNoteY(this._startNote,pe.Center)+o,c=d-a,h=t+s.y+s.getNoteY(this._startNote,pe.Center)-o;break;default:return}this._paintSlideLine(i,!1,c,d,h,p)}_paintSlideOut(e,t,i){const s=this.renderer,a=this.renderer.smuflMetrics.simpleSlideWidth,o=this.renderer.smuflMetrics.simpleSlideHeight;let c=0,h=0,d=0,p=0,g=!1;const y=this.renderer.smuflMetrics.postNoteEffectPadding;switch(this._outType){case $e.Shift:case $e.Legato:if(c=e+s.x+s.getBeatX(this._startNote.beat,lt.PostNotes)+y,h=t+s.y+s.getNoteY(this._startNote,pe.Center),this._startNote.slideTarget){const k=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);!k||k.staff!==s.staff?(d=e+s.x+s.width,p=h):(d=e+k.x+k.getBeatX(this._startNote.slideTarget.beat,lt.OnNotes)-y,p=t+k.y+k.getNoteY(this._startNote.slideTarget,pe.Center)),this._startNote.slideTarget.fret>this._startNote.fret?(h+=o,p-=o):(h-=o,p+=o)}else d=e+s.x+this._parent.x,p=h;break;case $e.OutUp:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+y,h=t+s.y+s.getNoteY(this._startNote,pe.Center)+o,d=c+a,p=t+s.y+s.getNoteY(this._startNote,pe.Center)-o;break;case $e.OutDown:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+y,h=t+s.y+s.getNoteY(this._startNote,pe.Center)-o,d=c+a,p=t+s.y+s.getNoteY(this._startNote,pe.Center)+o;break;case $e.PickSlideDown:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+y*2,h=t+s.y+s.getNoteY(this._startNote,pe.Center),d=e+s.x+s.width,p=h+o*3,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(d=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,lt.PreNotes)),g=!0;break;case $e.PickSlideUp:c=e+s.x+s.getNoteX(this._startNote,ci.Right)+y*2,h=t+s.y+s.getNoteY(this._startNote,pe.Center),d=e+s.x+s.width,p=h-o*3,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(d=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,lt.PreNotes)),g=!0;break;default:return}this._paintSlideLine(i,g,c,d,h,p)}_paintSlideLine(e,t,i,s,a,o){if(t){const c=new jo(0,0,ct.Slight);c.renderer=this.renderer,c.doLayout(),a-=c.height/2,o-=c.height/2;const h=s-i,d=o-a,p=Math.sqrt(Math.pow(d,2)+Math.pow(h,2));c.width=h;const g=Math.asin(d/p)*(180/Math.PI);e.beginRotate(i,a,g),c.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,a),e.lineTo(s,o),e.stroke()}}class rT extends eo{_direction;_forSlide;constructor(e,t,i,s=!1){super(e,t,s),this._direction=eo.getBeamDirectionForNote(e),this._forSlide=i}getTieHeight(e,t,i,s){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight/2}tryExpand(e,t,i,s){if(this._forSlide!==i||this.forEnd!==s||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==eo.getBeamDirectionForNote(e))return!1;switch(this._direction){case j.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case j.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),a=this.getBeamDirection(this.startBeat,s),o=`tab.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${a}`,c=this.renderer;c.staff.getSharedLayoutData(o,!1)||(c.staff.setSharedLayoutData(o,!0),super.paint(e,t,i))}}class VO extends Da{_bend=null;_effectSlurs=[];drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;const t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){const i=new eo(e,e.tieDestination,!1);this.addTie(i)}if(e.isTieDestination&&t.showTiedNotes){const i=new eo(e.tieOrigin,e,!0);this.addTie(i)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const i=new eo(e,e,!1);this.addTie(i)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let i=!1;for(const s of this._effectSlurs)if(s.tryExpand(e,e.effectSlurDestination,!1,!1)){i=!0;break}if(!i){const s=new rT(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(s),this.addTie(s)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let i=!1;for(const s of this._effectSlurs)if(s.tryExpand(e.effectSlurOrigin,e,!1,!0)){i=!0;break}if(!i){const s=new rT(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(s),this.addTie(s)}}if(e.slideInType!==Ji.None||e.slideOutType!==$e.None){const i=new WO(e.slideInType,e.slideOutType,e,this);this.addTie(i)}if(e.hasBend){if(!this._bend){const i=new Tg;this._bend=i,i.renderer=this.renderer,this.addTie(i)}this._bend.addBends(e)}}}class HO extends Vi{_note;_noteString=null;_trillNoteString=null;_trillNoteStringWidth=0;isEmpty=!1;noteStringWidth=0;constructor(e,t,i){super(e,t),this._note=i}doLayout(){const e=this._note;let t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===Re.Natural&&e.harmonicValue!==0&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)e.beat.index===0&&this.renderer.settings.notation.notationMode===Ps.GuitarPro||(e.bendType===Ae.Bend||e.bendType===Ae.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(rt.TabNotesOnTiedBends)?this._noteString=`(${(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()})`:this._noteString="";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString=`(${this._noteString})`;else if(e.harmonicType===Re.Natural){const i=this._noteString.indexOf(".");i>=0&&(this._noteString=this._noteString.substr(0,i+2)),this._noteString=`<${this._noteString}>`}if(e.isTrill)this._trillNoteString=`(${(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()})`;else if(ce.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case Re.Artificial:case Re.Pinch:case Re.Tap:case Re.Semi:case Re.Feedback:let i=(t+e.harmonicValue).toString();const s=i.indexOf(".");s>=0&&(i=i.substr(0,s+2)),this._trillNoteString=`<${i}>`;break;default:this._trillNoteString="";break}if(this.isEmpty=!this._noteString,!this.isEmpty){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont;const i=!!this._trillNoteString;this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString+(i?" ":"")).width,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,i&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth)}}paint(e,t,i){if(this.isEmpty)return;const s=this.noteStringWidth+this._trillNoteStringWidth,a=e+this.x+(this.width-s)/2;this.paintTrill(a,t,i);const o=ht.note(i,Js.GuitarTabFretNumber,this._note);try{i.fillText(this._noteString,a,t+this.y)}finally{o?.[Symbol.dispose]?.()}}paintTrill(e,t,i){const s=ht.note(i,Js.GuitarTabFretNumber,this._note);try{const a=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,i.fillText(this._trillNoteString,e+this.noteStringWidth,t+this.y),this.renderer.scoreRenderer.canvas.font=a}finally{s?.[Symbol.dispose]?.()}}buildBoundingsLookup(e,t,i){const s=new id;s.note=this._note,s.noteHeadBounds=new Os,s.noteHeadBounds.x=t+this.x,s.noteHeadBounds.y=i+this.y-this.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,e.addNote(s)}}class zO extends Vi{_notes=[];_deadSlapped=null;_isGrace;beat;beamingHelper;maxStringNote=null;minStringNote=null;beatEffects=new Map;notesPerString=new Map;noteStringWidth=0;constructor(e,t,i){super(e,t),this._isGrace=i}buildBoundingsLookup(e,t,i){for(const s of this._notes)s.buildBoundingsLookup(e,t+this.x,i+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){const i=this.notesPerString.get(e.string);let s=this.x+i.x;switch(t){case ci.Left:break;case ci.Center:s+=i.noteStringWidth/2;break;case ci.Right:s+=i.width;break}return s}return 0}getLowestNoteY(){return this.maxStringNote?this.getNoteY(this.maxStringNote,pe.Center):0}getHighestNoteY(){return this.minStringNote?this.getNoteY(this.minStringNote,pe.Center):0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const i=this.notesPerString.get(e.string);let s=this.y+i.y;switch(t){case pe.Top:case pe.TopWithStem:s-=i.height/2;break;case pe.Center:break;case pe.Bottom:case pe.BottomWithStem:s+=i.height/2;break;case pe.StemUp:case pe.StemDown:break}return s}return 0}doLayout(){let e=0;if(this.beat.deadSlapped)this._deadSlapped=new wg,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),e=this._deadSlapped.width,this.noteStringWidth=e;else{let t=0;for(let o=0,c=this._notes.length;o<c;o++){const h=this._notes[o];h.renderer=this.renderer,h.doLayout(),h.width>e&&(e=h.width),h.noteStringWidth>t&&(t=h.noteStringWidth)}this.noteStringWidth=t;const i=this.renderer.resources.tablatureFont.size;let s=this.getNoteY(this.minStringNote,pe.Center)+i/2;const a=this.renderer.smuflMetrics.onNoteEffectPadding;for(const o of this.beatEffects.values())o.y+=s,o.x+=this.width/2,o.renderer=this.renderer,s+=o.height+a,o.doLayout()}this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t),(!this.maxStringNote||t.string>this.maxStringNote.string)&&(this.maxStringNote=t)}paint(e,t,i){if(e+=this.x,t+=this.y,this.beat.deadSlapped)this._deadSlapped?.paint(e,t,i);else{const s=this.renderer.resources,a=i.textBaseline;i.textBaseline=Wt.Middle,i.font=this._isGrace?s.graceFont:s.tablatureFont;const o=this._notes,c=this.width;for(const d of o)d.renderer=this.renderer,d.width=c,d.paint(e,t,i);i.textBaseline=a;const h=ht.beat(i,ti.GuitarTabEffects,this.beat);try{for(const d of this.beatEffects.values())d.paint(e,t,i)}finally{h?.[Symbol.dispose]?.()}}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class GO extends ns{_isVisibleRest;beamingHelper;constructor(e,t,i,s){super(e,t,1,rd.getSymbol(s)),this._isVisibleRest=i}doLayout(){super.doLayout()}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){if(this._isVisibleRest){const s=ht.beat(i,ti.GuitarTabRests,this.beat);try{super.paint(e,t,i)}finally{s?.[Symbol.dispose]?.()}}}}class Pl extends Vi{static _topOffsetSharedDataKey="tab.whammy.topoffset";static _bottomOffsetSharedDataKey="tab.whammy.bottomffset";_beat;_renderPoints;_isSimpleDip=!1;constructor(e){super(0,0),this._beat=e,this._renderPoints=this._createRenderingPoints(e)}_createRenderingPoints(e){if(e.whammyBarType===Dt.Custom)return e.whammyBarPoints;const t=[];switch(e.whammyBarType){case Dt.Dive:case Dt.Hold:case Dt.PrediveDive:case Dt.Predive:t.push(new ke(0,e.whammyBarPoints[0].value)),t.push(new ke(ke.MaxPosition,e.whammyBarPoints[1].value));break;case Dt.Dip:t.push(new ke(0,e.whammyBarPoints[0].value)),t.push(new ke(ke.MaxPosition/2|0,e.whammyBarPoints[1].value)),t.push(new ke(ke.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value));break}return t}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===Ps.SongBook&&this._beat.whammyBarType===Dt.Dip;let e=null,t=null,i=this._beat;for(;i&&i.hasWhammyBar;)(!e||e.value>i.minWhammyPoint.value)&&(e=i.minWhammyPoint),(!t||t.value<i.maxWhammyPoint.value)&&(t=i.maxWhammyPoint),i=i.nextBeat;let s=t.value>0?Math.abs(this._getOffset(t.value)):0;(s>0||this._beat.whammyBarPoints[0].value!==0||this.renderer.settings.notation.isNotationElementVisible(rt.ZerosOnDiveWhammys))&&(s+=this.renderer.resources.tablatureFont.size+this.renderer.smuflMetrics.tabWhammyTextPadding);const a=e.value<0?Math.abs(this._getOffset(e.value)):0,o=this.renderer.staff.getSharedLayoutData(Pl._topOffsetSharedDataKey,-1);let c=o;s>o&&(this.renderer.staff.setSharedLayoutData(Pl._topOffsetSharedDataKey,s),c=s);const h=this.renderer.staff.getSharedLayoutData(Pl._bottomOffsetSharedDataKey,-1);let d=h;a>h&&(this.renderer.staff.setSharedLayoutData(Pl._bottomOffsetSharedDataKey,a),d=h),this.height=s+a,this.renderer.registerOverflowTop(c+d)}_getOffset(e){if(e===0)return 0;let t=this.renderer.smuflMetrics.tabWhammyPerHalfHeight+Math.log2(Math.abs(e)/2)*this.renderer.smuflMetrics.tabWhammyPerHalfHeight;return e<0&&(t=-t),t}paint(e,t,i){const s=ht.beat(i,ti.StandardNotationEffects,this._beat);try{const a=this.renderer;let o=this._beat.nextBeat,c=null,h=lt.PreNotes;o&&(c=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,o.voice.bar),!c||c.staff!==a.staff||c!==a&&!o.hasWhammyBar?(o=null,c=null):h=o.hasWhammyBar&&(a.settings.notation.notationMode!==Ps.SongBook||o.whammyBarType!==Dt.Dip)?lt.MiddleNotes:lt.PreNotes);let d=0,p=0;this._isSimpleDip?(d=e+a.x+a.getBeatX(this._beat,lt.OnNotes),p=e+a.x+a.getBeatX(this._beat,lt.PostNotes)):(d=e+a.x+a.getBeatX(this._beat,lt.MiddleNotes),p=c?e+c.x+c.getBeatX(o,h):e+a.x+a.postBeatGlyphsStart);const g=i.textAlign,y=i.textBaseline;if(i.textAlign=Ce.Center,i.textBaseline=Wt.Alphabetic,this._renderPoints.length>=2){const k=(p-d)/ke.MaxPosition;i.beginPath();const _=this.renderer.staff.getSharedLayoutData(Pl._topOffsetSharedDataKey,0),w=t+_;let T=this._beat.whammyStyle===Kt.Gradual?"grad.":"";for(let x=0,E=this._renderPoints.length-1;x<E;x++){const N=this._renderPoints[x],v=this._renderPoints[x+1];let L=x===0;x===0&&N.value!==0&&!this._beat.isContinuedWhammy&&(this._paintWhammy(!1,new ke(0,0),N,d,w,k,i),L=!1),this._paintWhammy(L,N,v,d,w,k,i,T),T=""}i.stroke()}i.textAlign=g,i.textBaseline=y}finally{s?.[Symbol.dispose]?.()}}_paintWhammy(e,t,i,s,a,o,c,h){const d=s+o*t.offset,p=s+o*i.offset,g=a-this._getOffset(t.value),y=a-this._getOffset(i.value);if(t.offset===i.offset){const w=this.renderer.smuflMetrics.tabWhammyDashSize;if(Math.abs(y-g)/(w*2)<1)c.moveTo(d,g),c.lineTo(p,y);else{const x=Math.max(g,y);let E=Math.min(g,y);for(;x>E;)c.moveTo(d,E),c.lineTo(d,E+w),E+=w*2}c.stroke()}else if(t.value===i.value){const w=this.renderer.smuflMetrics.tabWhammyDashSize;if(Math.abs(p-d)/(w*2)<1)c.moveTo(d,g),c.lineTo(p,y);else{let x=Math.max(d,p);const E=Math.min(d,p);for(;x>E;)c.moveTo(x,g),c.lineTo(x-w,g),x-=w*2}c.stroke()}else c.moveTo(d,g),c.lineTo(p,y);const k=this.renderer.smuflMetrics.tabWhammyTextPadding;e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip&&(this.renderer.settings.notation.isNotationElementVisible(rt.ZerosOnDiveWhammys)&&c.fillText("0",d,g-k),h&&c.fillText(h,d,g-k));let _=Math.abs(i.value);if((_!==0||this.renderer.settings.notation.isNotationElementVisible(rt.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&t.value!==i.value){let w="";if(i.value<0&&(w+="-"),_>=4){const E=_/4|0;w+=E,_-=E*4}else _===0&&(w+="0");_>0&&(w+=Tg.getFractionSign(_));let T=0;this._isSimpleDip?T=Math.min(g,y):T=t.offset===i.offset?Math.min(g,y):y;const x=p;c.fillText(w,x,T-k)}}}class UO extends il{slash=null;noteNumbers=null;restGlyph=null;get effectElement(){return ti.GuitarTabEffects}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}getLowestNoteY(){return this.noteNumbers?this.noteNumbers.getLowestNoteY():0}getHighestNoteY(){return this.noteNumbers?this.noteNumbers.getHighestNoteY():0}buildBoundingsLookup(e,t,i){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,i+this.y)}doLayout(){const e=this.renderer,t=[];if(this.container.beat.isRest){const s=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),a=e.getTabY(s),o=new GO(0,a,e.showRests,this.container.beat.duration);if(this.restGlyph=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper,this.addNormal(o),this.container.beat.dots>0&&e.showRests)for(let c=0;c<this.container.beat.dots;c++)this.addEffect(new Yh(0,a))}else{const s=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==De.None;let a;if(this.container.beat.slashed&&!this.container.beat.notes.some(o=>o.isTieDestination)){const o=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),c=e.getLineY(o),h=new no(0,c,this.container.beat.duration,s,this.container.beat);h.noteHeadElement=Js.GuitarTabFretNumber,h.effectElement=ti.GuitarTabEffects,this.slash=h,h.beat=this.container.beat,h.beamingHelper=this.beamingHelper,this.addNormal(h),a=h.beatEffects}else{const o=new zO(0,0,s);this.noteNumbers=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper;for(const c of this.container.beat.notes)c.isVisible&&this._createNoteGlyph(c);this.addNormal(o),a=o.beatEffects}if(this.container.beat.hasWhammyBar){const o=new Pl(this.container.beat);o.renderer=this.renderer,o.doLayout(),this.container.ties.push(o)}if(this.container.beat.isTremolo&&!a.has("tremolo")){const o=this.container.beat.tremoloSpeed,c=new Bg(0,0,o);c.offsetY=this.renderer.smuflMetrics.glyphTop.get(c.symbol),a.set("tremolo",c),t.push(c)}if(this.container.beat.dots>0&&e.rhythmMode!==aa.Hidden)for(let o=0;o<this.container.beat.dots;o++)this.addEffect(new Yh(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight))}if(this.isEmpty)return;let i=0;for(let s=0,a=this.glyphs.length;s<a;s++){const o=this.glyphs[s];o.x=i,o.renderer=this.renderer,o.doLayout(),i+=o.width}this.width=i,this.computedWidth=i,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2);for(const s of t)s.x=this.centerX}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}_createNoteGlyph(e){const t=this.renderer,i=new HO(0,0,e),s=e.beat.voice.bar.staff.tuning.length-e.string;i.y=t.getTabY(s),i.renderer=this.renderer,i.doLayout(),this.noteNumbers.addNoteGlyph(i,e);const a=i.y-i.height/2,o=a+i.height;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,a,o)}}class YO extends Vi{_beat;_noteVibratoGlyph;constructor(e){super(0,0),this._beat=e}doLayout(){if(this.width=this.renderer.smuflMetrics.glyphWidths.get(S.ArrowheadBlackDown),this._beat.brushType===Ne.ArpeggioUp){const e=new jo(0,0,ct.Slight,!0);e.renderer=this.renderer,e.doLayout(),this._noteVibratoGlyph=e}else if(this._beat.brushType===Ne.ArpeggioDown){const e=new jo(0,0,ct.Slight,!0);e.renderer=this.renderer,e.doLayout(),this._noteVibratoGlyph=e}}paint(e,t,i){const s=this.renderer,a=t+this.x+s.getNoteY(this._beat.maxStringNote,pe.Top),o=t+this.y+s.getNoteY(this._beat.minStringNote,pe.Bottom),c=e+this.x+this.width/2,h=this.renderer.smuflMetrics.glyphWidths.get(S.ArrowheadBlackDown);if(this._beat.brushType!==Ne.None){if(this._beat.brushType===Ne.BrushUp||this._beat.brushType===Ne.BrushDown)i.beginPath(),i.moveTo(c,a),i.lineTo(c,o),i.stroke();else if(this._beat.brushType===Ne.ArpeggioUp){const d=this._noteVibratoGlyph,p=a,g=o-h;d.width=Math.abs(g-p),i.beginRotate(e+this.x,g,-90),d.paint(0,(this.width-d.height)/2,i),i.endRotate()}else if(this._beat.brushType===Ne.ArpeggioDown){const d=this._noteVibratoGlyph,p=a+h,g=o;d.width=Math.abs(g-p),i.beginRotate(e+this.x,p,90),d.paint(0,-(this.width-d.height/2),i),i.endRotate()}this._beat.brushType===Ne.BrushUp||this._beat.brushType===Ne.ArpeggioUp?(i.beginPath(),i.moveTo(c,o),i.lineTo(c+h/2,o-h),i.lineTo(c-h/2,o-h),i.closePath(),i.fill()):(i.beginPath(),i.moveTo(c,a),i.lineTo(c+h/2,a+h),i.lineTo(c-h/2,a+h),i.closePath(),i.fill())}}}class $O extends tl{doLayout(){this.container.beat.brushType!==Ne.None&&!this.container.beat.isRest&&(this.addEffect(new YO(this.container.beat)),this.addNormal(new xn(0,0,this.renderer.smuflMetrics.preNoteEffectPadding))),super.doLayout()}get effectElement(){return ti.GuitarTabEffects}}class XO extends ns{constructor(e,t){super(e,t,1,S.SixStringTabClef)}doLayout(){this.symbol=this.renderer.bar.staff.tuning.length<=4?S.FourStringTabClef:S.SixStringTabClef,this.center=!0,super.doLayout(),this.width=this.renderer.smuflMetrics.glyphWidths.get(S.GClef),this.offsetX=this.width/2}}class qO extends Bv{doLayout(){this.barSubElement=Bt.GuitarTabsTimeSignature,super.doLayout()}get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?Ct.GraceScale:1}}class Y0 extends Zr{static StaffId="tab";_hasTuplets=!1;showTimeSignature=!1;showRests=!1;showTiedNotes=!1;_showMultiBarRest=!1;get showMultiBarRest(){return this._showMultiBarRest}get repeatsBarSubElement(){return Bt.GuitarTabsRepeats}get barNumberBarSubElement(){return Bt.GuitarTabsBarNumber}get barLineBarSubElement(){return Bt.GuitarTabsBarLines}get staffLineBarSubElement(){return Bt.GuitarTabsStaffLine}constructor(e,t){super(e,t),t.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0,this._showMultiBarRest=!0)}get lineSpacing(){return this.smuflMetrics.tabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}get rhythmMode(){let e=this.settings.notation.rhythmMode;return e===aa.Automatic&&(e=this.bar.staff.showStandardNotation?aa.Hidden:aa.ShowWithBars),e}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){const t=this.smuflMetrics.staffLineThickness;for(const i of this.bar.voices)if(this.hasVoiceContainer(i)){const s=this.getVoiceContainer(i);for(const a of s.beatGlyphs){const o=a.onNotes,c=o.noteNumbers;if(c)for(const[h,d]of c.notesPerString)d.isEmpty||e[this.bar.staff.tuning.length-h].push(new Float32Array([s.x+a.x+o.x+c.x-t,c.width+t*2]))}}}adjustSizes(){if(this.rhythmMode!==aa.Hidden){let e=M.Whole;for(const t of this.helpers.beamHelpers)for(const i of t)i.tremoloDuration&&(!e||e<i.tremoloDuration)&&(e=i.tremoloDuration);switch(e){case M.Eighth:this.height+=this.smuflMetrics.glyphHeights.get(S.Tremolo1);break;case M.Sixteenth:this.height+=this.smuflMetrics.glyphHeights.get(S.Tremolo2);break;case M.ThirtySecond:this.height+=this.smuflMetrics.glyphHeights.get(S.Tremolo3);break}this.height+=this.settings.notation.rhythmHeight,this.bottomPadding+=this.settings.notation.rhythmHeight}}doLayout(){if(super.doLayout(),this.rhythmMode!==aa.Hidden){this._hasTuplets=!1;for(const e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){if(this.isFirstOfLine){const e=(this.bar.staff.tuning.length-1)/2;this.createStartSpacing(),this.addPreBeatGlyph(new XO(0,this.getTabY(e)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this._createTimeSignatureGlyphs())}_createTimeSignatureGlyphs(){this.addPreBeatGlyph(new xn(0,0,this.smuflMetrics.oneStaffSpace));const e=(this.bar.staff.tuning.length+1)/2-1;this.addPreBeatGlyph(new qO(0,this.getTabY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){if(this.additionalMultiRestBars){const t=new kg(this.getVoiceContainer(e));this.addBeatGlyph(t)}else for(const t of e.beats){const i=new VO(t,this.getVoiceContainer(e));i.preNotes=new $O,i.onNotes=new UO,this.addBeatGlyph(i)}}paint(e,t,i){super.paint(e,t,i),this.rhythmMode!==aa.Hidden&&(this.paintBeams(e,t,i,ti.GuitarTabFlags,ti.GuitarTabBeams),this.paintTuplets(e,t,i,ti.GuitarTabTuplet))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.rhythmMode===aa.ShowWithBeams}getFlagTopY(e,t){const i=this.getOnNotesGlyphForBeat(e);return!i.noteNumbers||e.duration===M.Half?this.height-this.settings.notation.rhythmHeight-this.tupletSize:i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,pe.Bottom)+this.smuflMetrics.staffLineThickness}getFlagBottomY(e,t){return this.getFlagAndBarPos()}getFlagStemSize(e,t=!1){return 0}getBarLineStart(e,t){return this.getFlagTopY(e,t)}getBeamDirection(e){return j.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,t,i){return this.getFlagAndBarPos()}shouldPaintFlag(e,t){return!super.shouldPaintFlag(e,t)||e.graceType!==De.None?!1:this.drawBeamHelperAsFlags(t)}paintBeamingStem(e,t,i,s,a,o){if(a<s){const h=a;a=s,s=h}const c=ht.beat(o,ti.GuitarTabStem,e);try{let h=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(h=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),h.sort((p,g)=>p.topY-g.topY));let d=a;for(;d>s;){let p=s;if(h.length>0&&h[h.length-1].bottomY>p){const g=h.pop();p=t+g.bottomY,o.fillRect(i,p,this.smuflMetrics.stemThickness,d-p),d=t+g.topY}else{o.fillRect(i,p,this.smuflMetrics.stemThickness,d-p);break}}}finally{c?.[Symbol.dispose]?.()}}}class d0 extends nd{showTimeSignature=null;showRests=null;showTiedNotes=null;get staffId(){return Y0.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.hideOnPercussionTrack=!0}canCreate(e,t){return t.showTablature&&t.tuning.length>0&&super.canCreate(e,t)}create(e,t){const i=new Y0(e,t);return this.showRests!==null&&(i.showRests=this.showRests),this.showTimeSignature!==null&&(i.showTimeSignature=this.showTimeSignature),this.showTiedNotes!==null&&(i.showTiedNotes=this.showTiedNotes),i}}class oT{vertical;createLayout;constructor(e,t){this.vertical=e,this.createLayout=t}}class f0{supportsWorkers;createCanvas;constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class ne{static _staffIdBeforeSlashAlways="before-slash-always";static _staffIdBeforeScoreAlways="before-score-always";static _staffIdBeforeScoreHideable="before-score-hideable";static _staffIdBeforeNumberedAlways="before-numbered-always";static _staffIdBeforeTabAlways="before-tab-always";static _staffIdBeforeTabHideable="before-tab-hideable";static _staffIdBeforeEndAlways="before-end-always";static highDpiFactor=1;static _globalThis=void 0;static get globalThis(){if(ne._globalThis===void 0){try{ne._globalThis=globalThis}catch{}typeof ne._globalThis>"u"&&(ne._globalThis=self),typeof ne._globalThis>"u"&&(ne._globalThis=global),typeof ne._globalThis>"u"&&(ne._globalThis=window),typeof ne._globalThis>"u"&&(ne._globalThis=Function("return this")())}return ne._globalThis}static webPlatform=ne._detectWebPlatform();static isWebPackBundled=ne._detectWebPack();static isViteBundled=ne._detectVite();static scriptFile=ne._detectScriptFile();static fontDirectory=ne._detectFontDirectory();static get isRunningInWorker(){return"WorkerGlobalScope"in ne.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in ne.globalThis}static createWebWorker;static createAudioWorklet;static throttle(e,t){let i=0;return()=>{ne.globalThis.clearTimeout(i),i=ne.globalThis.setTimeout(e,t)}}static _detectScriptFile(){if(!ne.isRunningInWorker&&ne.globalThis.ALPHATAB_ROOT){let e=ne.globalThis.ALPHATAB_ROOT;return e=ne.ensureFullUrl(e),e=ne._appendScriptName(e),e}try{const e=import.meta.url;if(e&&e.indexOf("file://")===-1)return e}catch{}return"document"in ne.globalThis&&document.currentScript&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:null}static ensureFullUrl(e){if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let t="";const i=ne.globalThis.location;if(t+=i.protocol?.toString(),t+="//",i.hostname&&(t+=i.hostname?.toString()),i.port&&(t+=":",t+=i.port?.toString()),!e.startsWith("/")){const s=i.pathname.split("/").slice(0,-1).join("/");s.length>0&&(s.startsWith("/")||(t+="/"),t+=s?.toString())}return e.startsWith("/")||(t+="/"),t+=e?.toString(),t}return e}static _appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static _detectFontDirectory(){if(!ne.isRunningInWorker&&ne.globalThis.ALPHATAB_FONT)return ne.ensureFullUrl(ne.globalThis.ALPHATAB_FONT);const e=ne.scriptFile;if(e){const t=e.lastIndexOf("/");if(t>=0)return`${e.substr(0,t)}/font/`}return null}static _registerJQueryPlugin(){if(!ne.isRunningInWorker&&ne.globalThis&&"jQuery"in ne.globalThis){const e=ne.globalThis.jQuery,t=new VB;e.fn.alphaTab=function(i){const s=Array.prototype.slice.call(arguments,1);return this.length===1?t.exec(this[0],i,s):this.each((a,o)=>{t.exec(o,i,s)})},e.alphaTab={restore:VB.restore},e.fn.alphaTab.fn=t}}static renderEngines=ne._createDefaultRenderEngines();static layoutEngines=ne._createDefaultLayoutEngines();static staveProfiles=ne._createDefaultStaveProfiles();static getRenderEngineFactory(e){return!e||!ne.renderEngines.has(e)?ne.renderEngines.get("default"):ne.renderEngines.get(e)}static getLayoutEngineFactory(e){return!e||!ne.layoutEngines.has(e)?ne.layoutEngines.get(jr.Page):ne.layoutEngines.get(e)}static buildImporters(){return[new Ro,new $5,new G5,new Qt,new F5,new Nb]}static _createDefaultRenderEngines(){const e=new Map;return e.set("svg",new f0(!0,()=>new e3)),e.set("default",e.get("svg")),e.set("skia",new f0(!1,()=>new ki)),ne._createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){ki.enable(e,t)}static registerAlphaSkiaCustomFont(e){return ki.registerFont(e)}static _createPlatformSpecificRenderEngines(e){e.set("html5",new f0(!1,()=>new ER))}static _createDefaultRenderers(){return[new Bl(ne._staffIdBeforeSlashAlways,[new eO,new nO,new G3,new M3,new T3,new I3,new tO,new v3,new C3]),new IO,new Bl(ne._staffIdBeforeScoreAlways,[new R3,new zp,new U3,new J3,new aO]),new Bl(ne._staffIdBeforeScoreHideable,[new rO,new XB,new UB(!0),new qB,new YB,new JB,new $B(!1),new GB,new Rf(qs.Finger)],(e,t)=>t.showStandardNotation),new AO,new Bl(ne._staffIdBeforeNumberedAlways,[new P3,new UB(!1),new L3,new Rf(qs.Thumb,(e,t)=>t.voice.bar.staff.showStandardNotation),new K3]),new SO,new Bl(ne._staffIdBeforeTabAlways,[new z3]),new Bl(ne._staffIdBeforeTabHideable,[new XB,new qB,new YB,new JB,new $B(!0),new Z3,new A3,new Io(Re.Natural),new Io(Re.Artificial),new Io(Re.Pinch),new Io(Re.Tap),new Io(Re.Semi),new Io(Re.Feedback),new V3,new N3,new F3,new $3,new q3,new X3,new GB,new Rf(qs.Finger,(e,t)=>!t.voice.bar.staff.showStandardNotation)],(e,t)=>t.showTablature),new d0,new Bl(ne._staffIdBeforeEndAlways,[new Rf(qs.Thumb,(e,t)=>!t.voice.bar.staff.showStandardNotation)])]}static _createDefaultStaveProfiles(){const e=new Map,t=ne._createDefaultRenderers();e.set(qr.Default,t),e.set(qr.ScoreTab,t);const i=new Set([ne._staffIdBeforeSlashAlways,ne._staffIdBeforeScoreAlways,ne._staffIdBeforeNumberedAlways,ne._staffIdBeforeTabAlways,zo.StaffId,ne._staffIdBeforeEndAlways]);e.set(qr.Score,t.filter(a=>i.has(a.staffId)));const s=new Set([ne._staffIdBeforeSlashAlways,ne._staffIdBeforeScoreAlways,ne._staffIdBeforeNumberedAlways,ne._staffIdBeforeTabAlways,Y0.StaffId,ne._staffIdBeforeEndAlways]);return e.set(qr.Tab,ne._createDefaultRenderers().filter(a=>{if(a instanceof d0){const o=a;o.showTimeSignature=!0,o.showRests=!0,o.showTiedNotes=!0}return s.has(a.staffId)})),e.set(qr.TabMixed,ne._createDefaultRenderers().filter(a=>{if(a instanceof d0){const o=a;o.showTimeSignature=!1,o.showRests=!1,o.showTiedNotes=!1}return s.has(a.staffId)})),e}static _createDefaultLayoutEngines(){const e=new Map;return e.set(jr.Page,new oT(!0,t=>new lO(t))),e.set(jr.Horizontal,new oT(!1,t=>new oO(t))),e}static initializeMain(e,t){ne.isRunningInWorker||ne.isRunningInAudioWorklet||((ne.webPlatform===Tn.Browser||ne.webPlatform===Tn.BrowserModule)&&(ne._registerJQueryPlugin(),ne.highDpiFactor=window.devicePixelRatio),ne.createWebWorker=e,ne.createAudioWorklet=t)}static get alphaTabWorker(){return ne.globalThis.Worker}static get alphaTabUrl(){return ne.globalThis.URL}static initializeWorker(){if(!ne.isRunningInWorker)throw new Ht(It.General,"Not running in worker, cannot run worker initialization");Vb.init(),Wb.init(),ne.createWebWorker=e=>{throw new Ht(It.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!ne.isRunningInAudioWorklet)throw new Ht(It.General,"Not running in audio worklet, cannot run worklet initialization");op.init()}static _detectWebPack(){try{if(typeof __webpack_require__=="function")return!0}catch{}return!1}static _detectVite(){try{if(typeof __BASE__=="string")return!0}catch{}return!1}static _detectWebPlatform(){if(!(typeof ne.globalThis.Window<"u"&&ne.globalThis instanceof ne.globalThis.Window))try{if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return Tn.NodeJs}catch{}try{const t=import.meta.url;if(t&&typeof t=="string"&&!t.startsWith("file://"))return Tn.BrowserModule}catch{}return Tn.Browser}static printEnvironmentInfo(e=!0){const t=e?i=>{ee.log.debug("VersionInfo",i)}:i=>{ee.debug("VersionInfo",i)};Fl.print(t),t(`High DPI: ${ne.highDpiFactor}`),ne._printPlatformInfo(t)}static _printPlatformInfo(e){e(`Platform: ${Tn[ne.webPlatform]}`),e(`WebPack: ${ne.isWebPackBundled}`),e(`Vite: ${ne.isViteBundled}`),ne.webPlatform!==Tn.NodeJs&&(e(`Browser: ${navigator.userAgent}`),e(`Window Size: ${window.outerWidth}x${window.outerHeight}`),e(`Screen Size: ${window.screen.width}x${window.screen.height}`))}static prepareForPostMessage(e){if(!e)return e;if(typeof e=="object"){const t=e.__v_raw;if(t)return ne.prepareForPostMessage(t)}return e}static quoteJsonString(e){return JSON.stringify(e)}}var Ea;(function(n){n[n.EmbeddedOpenType=0]="EmbeddedOpenType",n[n.Woff=1]="Woff",n[n.Woff2=2]="Woff2",n[n.OpenType=3]="OpenType",n[n.TrueType=4]="TrueType",n[n.Svg=5]="Svg"})(Ea||(Ea={}));class vv{scriptFile=null;fontDirectory=null;smuflFontSources=null;static buildDefaultSmuflFontSources(e){const t=new Map,i=e??"";return t.set(Ea.Woff2,`${i}Bravura.woff2`),t.set(Ea.Woff,`${i}Bravura.woff`),t.set(Ea.OpenType,`${i}Bravura.otf`),t}file=null;tex=!1;tracks=null;enableLazyLoading=!0;engine="default";logLevel=za.Info;useWorkers=!0;includeNoteBounds=!1;constructor(){this.scriptFile=ne.scriptFile,this.fontDirectory=ne.fontDirectory}}var he;(function(n){n[n.SteelGuitar=1]="SteelGuitar",n[n.AcousticGuitar=2]="AcousticGuitar",n[n.TwelveStringGuitar=3]="TwelveStringGuitar",n[n.ElectricGuitar=4]="ElectricGuitar",n[n.Bass=5]="Bass",n[n.ClassicalGuitar=23]="ClassicalGuitar",n[n.UprightBass=6]="UprightBass",n[n.Ukulele=7]="Ukulele",n[n.Banjo=8]="Banjo",n[n.Mandolin=9]="Mandolin",n[n.Piano=10]="Piano",n[n.Synth=12]="Synth",n[n.Strings=11]="Strings",n[n.Brass=13]="Brass",n[n.Reed=14]="Reed",n[n.Woodwind=15]="Woodwind",n[n.Vocal=16]="Vocal",n[n.PitchedIdiophone=17]="PitchedIdiophone",n[n.Fx=21]="Fx",n[n.PercussionKit=18]="PercussionKit",n[n.Idiophone=19]="Idiophone",n[n.Membraphone=20]="Membraphone"})(he||(he={}));class fe{icon=he.Piano;instrumentSetName;instrumentSetType;constructor(e,t,i=null){if(this.icon=e,this.instrumentSetName=t,i)this.instrumentSetType=i;else{const s=t.split(" ");s[0]=s[0].substr(0,1).toLowerCase()+s[0].substr(1),this.instrumentSetType=s.join("")}}}class ia{static _sampleRate=44100;_rhythmIdLookup=new Map;static _midiProgramInfoLookup=new Map([[0,new fe(he.Piano,"Acoustic Piano")],[1,new fe(he.Piano,"Acoustic Piano")],[2,new fe(he.Piano,"Electric Piano")],[3,new fe(he.Piano,"Acoustic Piano")],[4,new fe(he.Piano,"Electric Piano")],[5,new fe(he.Piano,"Electric Piano")],[6,new fe(he.Piano,"Harpsichord")],[7,new fe(he.Piano,"Harpsichord")],[8,new fe(he.PitchedIdiophone,"Celesta")],[9,new fe(he.PitchedIdiophone,"Vibraphone")],[10,new fe(he.PitchedIdiophone,"Vibraphone")],[11,new fe(he.PitchedIdiophone,"Vibraphone")],[12,new fe(he.PitchedIdiophone,"Xylophone")],[13,new fe(he.PitchedIdiophone,"Xylophone")],[14,new fe(he.PitchedIdiophone,"Vibraphone")],[15,new fe(he.Banjo,"Banjo")],[16,new fe(he.Piano,"Electric Organ")],[17,new fe(he.Piano,"Electric Organ")],[18,new fe(he.Piano,"Electric Organ")],[19,new fe(he.Piano,"Electric Organ")],[20,new fe(he.Piano,"Electric Organ")],[21,new fe(he.Piano,"Electric Organ")],[22,new fe(he.Woodwind,"Recorder")],[23,new fe(he.Piano,"Electric Organ")],[24,new fe(he.ClassicalGuitar,"Nylon Guitar")],[25,new fe(he.SteelGuitar,"Steel Guitar")],[26,new fe(he.SteelGuitar,"Electric Guitar")],[27,new fe(he.ElectricGuitar,"Electric Guitar")],[28,new fe(he.ElectricGuitar,"Electric Guitar")],[29,new fe(he.ElectricGuitar,"Electric Guitar")],[30,new fe(he.SteelGuitar,"Electric Guitar")],[31,new fe(he.SteelGuitar,"Electric Guitar")],[32,new fe(he.Bass,"Acoustic Bass")],[33,new fe(he.Bass,"Electric Bass")],[34,new fe(he.Bass,"Electric Bass")],[35,new fe(he.Bass,"Acoustic Bass")],[36,new fe(he.Bass,"Electric Bass")],[37,new fe(he.Bass,"Electric Bass")],[38,new fe(he.Synth,"Synth Bass")],[39,new fe(he.Synth,"Synth Bass")],[40,new fe(he.Strings,"Violin")],[41,new fe(he.Strings,"Viola")],[42,new fe(he.Strings,"Cello")],[43,new fe(he.Strings,"Contrabass")],[44,new fe(he.Strings,"Violin")],[45,new fe(he.Strings,"Violin")],[46,new fe(he.Piano,"Harp")],[47,new fe(he.Membraphone,"Timpani")],[48,new fe(he.Strings,"Violin")],[49,new fe(he.Strings,"Violin")],[50,new fe(he.Strings,"Violin")],[51,new fe(he.Strings,"Violin")],[52,new fe(he.Vocal,"Voice")],[53,new fe(he.Vocal,"Voice")],[54,new fe(he.Vocal,"Voice")],[55,new fe(he.Synth,"Pad Synthesizer")],[56,new fe(he.Brass,"Trumpet")],[57,new fe(he.Brass,"Trombone")],[58,new fe(he.Brass,"Tuba")],[59,new fe(he.Brass,"Trumpet")],[60,new fe(he.Brass,"French Horn")],[61,new fe(he.Brass,"Trumpet")],[62,new fe(he.Brass,"Trumpet")],[63,new fe(he.Brass,"Trumpet")],[64,new fe(he.Reed,"Saxophone")],[65,new fe(he.Reed,"Saxophone")],[66,new fe(he.Reed,"Saxophone")],[67,new fe(he.Reed,"Saxophone")],[68,new fe(he.Reed,"Oboe")],[69,new fe(he.Reed,"English Horn")],[70,new fe(he.Reed,"Bassoon")],[71,new fe(he.Reed,"Clarinet")],[72,new fe(he.Reed,"Piccolo")],[73,new fe(he.Woodwind,"Flute")],[74,new fe(he.Woodwind,"Recorder")],[75,new fe(he.Woodwind,"Flute")],[76,new fe(he.Woodwind,"Recorder")],[77,new fe(he.Woodwind,"Flute")],[78,new fe(he.Woodwind,"Recorder")],[79,new fe(he.Woodwind,"Flute")],[80,new fe(he.Synth,"Lead Synthesizer")],[81,new fe(he.Synth,"Lead Synthesizer")],[82,new fe(he.Synth,"Lead Synthesizer")],[83,new fe(he.Synth,"Lead Synthesizer")],[84,new fe(he.Synth,"Lead Synthesizer")],[85,new fe(he.Synth,"Lead Synthesizer")],[86,new fe(he.Synth,"Lead Synthesizer")],[87,new fe(he.Synth,"Lead Synthesizer")],[88,new fe(he.Synth,"Pad Synthesizer")],[89,new fe(he.Synth,"Pad Synthesizer")],[90,new fe(he.Synth,"Pad Synthesizer")],[91,new fe(he.Synth,"Pad Synthesizer")],[92,new fe(he.Synth,"Pad Synthesizer")],[93,new fe(he.Synth,"Pad Synthesizer")],[94,new fe(he.Synth,"Pad Synthesizer")],[95,new fe(he.Synth,"Pad Synthesizer")],[96,new fe(he.Fx,"Pad Synthesizer")],[97,new fe(he.Fx,"Pad Synthesizer")],[98,new fe(he.Fx,"Pad Synthesizer")],[99,new fe(he.Fx,"Pad Synthesizer")],[100,new fe(he.Fx,"Lead Synthesizer")],[101,new fe(he.Fx,"Lead Synthesizer")],[102,new fe(he.Fx,"Lead Synthesizer")],[103,new fe(he.Fx,"Trumpet")],[104,new fe(he.ElectricGuitar,"Banjo")],[105,new fe(he.Banjo,"Banjo")],[106,new fe(he.Ukulele,"Ukulele")],[107,new fe(he.Banjo,"Banjo")],[108,new fe(he.PitchedIdiophone,"Xylophone")],[109,new fe(he.Reed,"Bassoon")],[110,new fe(he.Strings,"Violin")],[111,new fe(he.Woodwind,"Flute")],[112,new fe(he.PitchedIdiophone,"Xylophone")],[113,new fe(he.Idiophone,"Celesta")],[114,new fe(he.PitchedIdiophone,"Vibraphone")],[115,new fe(he.Idiophone,"Xylophone")],[116,new fe(he.Membraphone,"Xylophone")],[117,new fe(he.Membraphone,"Xylophone")],[118,new fe(he.Membraphone,"Xylophone")],[119,new fe(he.Idiophone,"Celesta")],[120,new fe(he.Fx,"Steel Guitar")],[121,new fe(he.Fx,"Recorder")],[122,new fe(he.Fx,"Recorder")],[123,new fe(he.Fx,"Recorder")],[124,new fe(he.Fx,"Recorder")],[125,new fe(he.Fx,"Recorder")],[126,new fe(he.Fx,"Recorder")],[127,new fe(he.Fx,"Timpani")]]);static _drumKitProgramInfo=new fe(he.PercussionKit,"Drums","drumKit");writeXml(e){const t=new Vh;return this._rhythmIdLookup=new Map,this._writeDom(t,e),t.toFormattedString("",!0)}_writeDom(e,t){const i=e.addElement("GPIF");i.addElement("GPVersion").innerText="8.1.3";const s=i.addElement("GPRevision");s.attributes.set("required","12024"),s.attributes.set("recommended","13000"),s.innerText="13007";const a=i.addElement("Encoding");a.addElement("EncodingDescription").innerText="GP8";const o=new oa;o.nodeType=gi.Comment,o.value=`Written by alphaTab ${Fl.version} (${Fl.commit})`,a.addChild(o),this._writeScoreNode(i,t),this._writeMasterTrackNode(i,t),this._writeBackingTrackNode(i,t),this._writeAudioTracksNode(i,t),this._writeTracksNode(i,t),this._writeMasterBarsNode(i,t),this._writeAssets(i,t);const c=i.addElement("Bars"),h=i.addElement("Voices"),d=i.addElement("Beats"),p=i.addElement("Notes"),g=i.addElement("Rhythms");for(const y of t.tracks)for(const k of y.staves)for(const _ of k.bars){this._writeBarNode(c,_);for(const w of _.voices){this._writeVoiceNode(h,w);for(const T of w.beats){this._writeBeatNode(d,T,g);for(const x of T.notes)this._writeNoteNode(p,x)}}}}_writeAssets(e,t){if(!t.backingTrack?.rawAudioFile)return;const s=e.addElement("Assets").addElement("Asset");s.attributes.set("id",this._backingTrackAssetId),this.backingTrackAssetFileName="Content/Assets/backing-track",s.addElement("EmbeddedFilePath").setCData(this.backingTrackAssetFileName)}_backingTrackAssetId;_backingTrackFramePadding;backingTrackAssetFileName;_writeBackingTrackNode(e,t){if(!t.backingTrack?.rawAudioFile)return;const i=e.addElement("BackingTrack"),s="0";this._backingTrackAssetId=s,i.addElement("IconId").innerText="21",i.addElement("Color").innerText="0 0 0",i.addElement("Name").setCData("Audio Track"),i.addElement("ShortName").setCData("a.track"),i.addElement("PlaybackState").innerText="Default",i.addElement("Enabled").innerText="true",i.addElement("Source").innerText="Local",i.addElement("AssetId").innerText=s;const a=i.addElement("ChannelStrip");a.addElement("Parameters").innerText="0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.000000 0.500000 0.500000 0.800000 0.500000 0.500000 0.500000",a.addElement("YouTubeVideoUrl").innerText="",a.addElement("Filter").innerText="6",a.addElement("FramesPerPixel").innerText="400";const o=this._backingTrackFramePadding!==void 0?this._backingTrackFramePadding:0;i.addElement("FramePadding").innerText=`${o}`,i.addElement("Semitones").innerText="0",i.addElement("Cents").innerText="0"}_writeNoteNode(e,t){const i=e.addElement("Note");i.attributes.set("id",t.id.toString()),this._writeNoteProperties(i,t),t.isGhost&&(i.addElement("AntiAccent").innerText="normal"),t.isLetRing&&i.addElement("LetRing"),t.isTrill&&(i.addElement("Trill").innerText=t.trillValue.toString());let s=0;switch(t.isStaccato&&(s|=1),t.accentuated){case mi.Normal:s|=8;break;case mi.Heavy:s|=4;break;case mi.Tenuto:s|=16;break}if(s>0&&(i.addElement("Accent").innerText=s.toString()),t.isTieOrigin||t.isTieDestination){const a=i.addElement("Tie");a.attributes.set("origin",t.isTieOrigin?"true":"false"),a.attributes.set("destination",t.isTieDestination?"true":"false")}switch(t.vibrato){case ct.Slight:i.addElement("Vibrato").innerText="Slight";break;case ct.Wide:i.addElement("Vibrato").innerText="Wide";break}if(t.isFingering){switch(t.leftHandFinger){case Fe.Thumb:i.addElement("LeftFingering").innerText="P";break;case Fe.IndexFinger:i.addElement("LeftFingering").innerText="I";break;case Fe.MiddleFinger:i.addElement("LeftFingering").innerText="M";break;case Fe.AnnularFinger:i.addElement("LeftFingering").innerText="A";break;case Fe.LittleFinger:i.addElement("LeftFingering").innerText="C";break}switch(t.rightHandFinger){case Fe.Thumb:i.addElement("RightFingering").innerText="P";break;case Fe.IndexFinger:i.addElement("RightFingering").innerText="I";break;case Fe.MiddleFinger:i.addElement("RightFingering").innerText="M";break;case Fe.AnnularFinger:i.addElement("RightFingering").innerText="A";break;case Fe.LittleFinger:i.addElement("RightFingering").innerText="C";break}}t.percussionArticulation>=0?i.addElement("InstrumentArticulation").innerText=t.percussionArticulation.toString():i.addElement("InstrumentArticulation").innerText="0",t.ornament!==fi.None&&(i.addElement("Ornament").innerText=fi[t.ornament])}_writeNoteProperties(e,t){const i=e.addElement("Properties");if(this._writeConcertPitch(i,t),this._writeTransposedPitch(i,t),t.isStringed&&(this._writeSimplePropertyNode(i,"String","String",(t.string-1).toString()),this._writeSimplePropertyNode(i,"Fret","Fret",t.fret.toString()),this._writeSimplePropertyNode(i,"Midi","Number",t.realValue.toString()),t.showStringNumber&&this._writeSimplePropertyNode(i,"ShowStringNumber","Enable",null)),t.isPiano&&(this._writeSimplePropertyNode(i,"Octave","Number",t.octave.toString()),this._writeSimplePropertyNode(i,"Tone","Step",t.tone.toString()),this._writeSimplePropertyNode(i,"Midi","Number",t.realValue.toString())),t.beat.tap&&this._writeSimplePropertyNode(i,"Tapped","Enable",null),t.harmonicType!==Re.None){switch(t.harmonicType){case Re.Natural:this._writeSimplePropertyNode(i,"HarmonicType","HType","Natural");break;case Re.Artificial:this._writeSimplePropertyNode(i,"HarmonicType","HType","Artificial");break;case Re.Pinch:this._writeSimplePropertyNode(i,"HarmonicType","HType","Pinch");break;case Re.Tap:this._writeSimplePropertyNode(i,"HarmonicType","HType","Tap");break;case Re.Semi:this._writeSimplePropertyNode(i,"HarmonicType","HType","Semi");break;case Re.Feedback:this._writeSimplePropertyNode(i,"HarmonicType","HType","Feedback");break}t.harmonicValue!==0&&this._writeSimplePropertyNode(i,"HarmonicFret","HFret",t.harmonicValue.toString())}t.isDead&&this._writeSimplePropertyNode(i,"Muted","Enable",null),t.isPalmMute&&this._writeSimplePropertyNode(i,"PalmMuted","Enable",null),t.hasBend&&this._writeBend(i,t),t.isHammerPullOrigin&&this._writeSimplePropertyNode(i,"HopoOrigin","Enable",null),t.isHammerPullDestination&&this._writeSimplePropertyNode(i,"HopoDestination","Enable",null),t.isLeftHandTapped&&this._writeSimplePropertyNode(i,"LeftHandTapped","Enable",null);let s=0;switch(t.slideInType){case Ji.IntoFromAbove:s|=32;break;case Ji.IntoFromBelow:s|=16;break}switch(t.slideOutType){case $e.Shift:s|=1;break;case $e.Legato:s|=2;break;case $e.OutDown:s|=4;break;case $e.OutUp:s|=8;break;case $e.PickSlideDown:s|=64;break;case $e.PickSlideUp:s|=128;break}s>0&&this._writeSimplePropertyNode(i,"Slide","Flags",s.toString())}_writeTransposedPitch(e,t){t.isPercussion?this._writePitch(e,"ConcertPitch","C","-1",""):this._writePitchForValue(e,"TransposedPitch",t.displayValueWithoutBend,t.accidentalMode,t.beat.voice.bar.keySignature)}_writeConcertPitch(e,t){t.isPercussion?this._writePitch(e,"ConcertPitch","C","-1",""):this._writePitchForValue(e,"ConcertPitch",t.realValueWithoutHarmonic,t.accidentalMode,t.beat.voice.bar.keySignature)}static _defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"];_writePitchForValue(e,t,i,s,a){let o=0,c=0,h="",d="";const p=()=>{switch(o=i%12,c=i/12|0,h=ia._defaultSteps[o],ce.computeAccidental(a,Ue.Default,i,!1)){case Le.None:case Le.Natural:d="";break;case Le.Sharp:d="#";break;case Le.Flat:d="b";break;case Le.DoubleSharp:d="x";break;case Le.DoubleFlat:d="bb";break}};switch(p(),s){case Ue.Default:break;case Ue.ForceNone:d="";break;case Ue.ForceNatural:d="";break;case Ue.ForceSharp:d="#";break;case Ue.ForceDoubleSharp:d==="#"&&(i-=2,p()),d="x";break;case Ue.ForceFlat:d==="#"&&(i+=1,p()),d="b";break;case Ue.ForceDoubleFlat:d==="#"&&(i+=2,p()),d="bb";break}this._writePitch(e,t,h,c.toString(),d)}_writePitch(e,t,i,s,a){const o=e.addElement("Property");o.attributes.set("name",t);const c=o.addElement("Pitch");c.addElement("Step").innerText=i,c.addElement("Accidental").innerText=a,c.addElement("Octave").innerText=s}_writeBend(e,t){t.hasBend&&t.bendPoints.length<=4&&this._writeStandardBend(e,t.bendPoints)}_writeStandardBend(e,t){this._writeSimplePropertyNode(e,"Bended","Enable",null);const i=t[0],s=t[t.length-1];let a,o;switch(t.length){case 4:a=t[1],o=t[2];break;case 3:a=t[1],o=t[1];break;default:a=new ke((i.offset+s.offset)/2,(i.value+s.value)/2),o=a;break}this._writeSimplePropertyNode(e,"BendDestinationOffset","Float",this._toBendOffset(s.offset).toString()),this._writeSimplePropertyNode(e,"BendDestinationValue","Float",this._toBendValue(s.value).toString()),this._writeSimplePropertyNode(e,"BendMiddleOffset1","Float",this._toBendOffset(a.offset).toString()),this._writeSimplePropertyNode(e,"BendMiddleOffset2","Float",this._toBendOffset(o.offset).toString()),this._writeSimplePropertyNode(e,"BendMiddleValue","Float",this._toBendValue(a.value).toString()),this._writeSimplePropertyNode(e,"BendOriginOffset","Float",this._toBendOffset(i.offset).toString()),this._writeSimplePropertyNode(e,"BendOriginValue","Float",this._toBendValue(i.value).toString())}_toBendValue(e){return e*25}_toBendOffset(e){return e/ke.MaxPosition*100}_writeBeatNode(e,t,i){const s=e.addElement("Beat");if(s.attributes.set("id",t.id.toString()),s.addElement("Dynamic").innerText=Oe[t.dynamics],t.fade!==Xi.None&&(s.addElement("Fadding").innerText=Xi[t.fade]),t.isTremolo)switch(t.tremoloSpeed){case M.Eighth:s.addElement("Tremolo").innerText="1/2";break;case M.Sixteenth:s.addElement("Tremolo").innerText="1/4";break;case M.ThirtySecond:s.addElement("Tremolo").innerText="1/8";break}switch(t.hasChord&&s.addElement("Chord").setCData(t.chordId),t.crescendo!==Ds.None&&(s.addElement("Hairpin").innerText=Ds[t.crescendo]),t.brushType){case Ne.ArpeggioUp:s.addElement("Arpeggio").innerText="Up";break;case Ne.ArpeggioDown:s.addElement("Arpeggio").innerText="Down";break}switch(t.text&&s.addElement("FreeText").setCData(t.text),t.graceType){case De.OnBeat:case De.BeforeBeat:s.addElement("GraceNotes").innerText=De[t.graceType];break}if(t.ottava!==Ye.Regular&&(s.addElement("Ottavia").innerText=Ye[t.ottava].substr(1)),t.hasWhammyBar&&this._writeWhammyNode(s,t),t.isLegatoOrigin||t.isLegatoDestination){const a=s.addElement("Legato");a.attributes.set("origin",t.isLegatoOrigin?"true":"false"),a.attributes.set("destination",t.isLegatoDestination?"true":"false")}if(this._writeRhythm(s,t,i),t.preferredBeamDirection!==null)switch(t.preferredBeamDirection){case j.Up:s.addElement("TransposedPitchStemOrientation").innerText="Upward",s.addElement("UserTransposedPitchStemOrientation").innerText="Upward";break;case j.Down:s.addElement("TransposedPitchStemOrientation").innerText="Downward",s.addElement("UserTransposedPitchStemOrientation").innerText="Downward";break}s.addElement("ConcertPitchStemOrientation").innerText="Undefined",t.slashed&&s.addElement("Slashed"),t.deadSlapped&&s.addElement("DeadSlapped"),t.notes.length>0&&(s.addElement("Notes").innerText=t.notes.map(a=>a.id).join(" ")),t.golpe!==qs.None&&(s.addElement("Golpe").innerText=qs[t.golpe]),t.wahPedal!==an.None&&(s.addElement("Wah").innerText=an[t.wahPedal]),t.showTimer&&(s.addElement("Timer").innerText=(t.timer??0).toString()),this._writeBeatProperties(s,t),this._writeBeatXProperties(s,t),t.lyrics&&t.lyrics.length>0&&this._writeBeatLyrics(s,t.lyrics)}_writeBeatLyrics(e,t){const i=e.addElement("Lyrics");for(const s of t)i.addElement("Line").setCData(s)}_writeBeatXProperties(e,t){const i=e.addElement("XProperties");switch(t.brushDuration>0&&this._writeSimpleXPropertyNode(i,"687935489","Int",t.brushDuration.toString()),t.beamingMode){case ei.ForceSplitToNext:this._writeSimpleXPropertyNode(i,"1124204546","Int","2");break;case ei.ForceMergeWithNext:this._writeSimpleXPropertyNode(i,"1124204546","Int","1");break;case ei.ForceSplitOnSecondaryToNext:this._writeSimpleXPropertyNode(i,"1124204552","Int","1");break}}_writeBeatProperties(e,t){const i=e.addElement("Properties");switch(t.brushType){case Ne.BrushUp:this._writeSimplePropertyNode(i,"Brush","Direction","Up");break;case Ne.BrushDown:this._writeSimplePropertyNode(i,"Brush","Direction","Down");break}switch(t.pickStroke){case ds.Up:this._writeSimplePropertyNode(i,"PickStroke","Direction","Up");break;case ds.Down:this._writeSimplePropertyNode(i,"PickStroke","Direction","Down");break}switch(t.slap&&this._writeSimplePropertyNode(i,"Slapped","Enable",null),t.pop&&this._writeSimplePropertyNode(i,"Popped","Enable",null),t.vibrato){case ct.Wide:this._writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Wide");break;case ct.Slight:this._writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Slight");break}if(t.isBarre)switch(this._writeSimplePropertyNode(i,"BarreFret","Fret",t.barreFret.toString()),t.barreShape){case Yn.Full:this._writeSimplePropertyNode(i,"BarreString","String","0");break;case Yn.Half:this._writeSimplePropertyNode(i,"BarreString","String","1");break}if(t.rasgueado!==We.None){let s="";switch(t.rasgueado){case We.Ii:s="ii_1";break;case We.Mi:s="mi_1";break;case We.MiiTriplet:s="mii_1";break;case We.MiiAnapaest:s="mii_2";break;case We.PmpTriplet:s="pmp_1";break;case We.PmpAnapaest:s="pmp_2";break;case We.PeiTriplet:s="pei_1";break;case We.PeiAnapaest:s="pei_2";break;case We.PaiTriplet:s="pai_1";break;case We.PaiAnapaest:s="pai_2";break;case We.AmiTriplet:s="ami_1";break;case We.AmiAnapaest:s="ami_2";break;case We.Ppp:s="ppp_1";break;case We.Amii:s="amii_1";break;case We.Amip:s="amip_1";break;case We.Eami:s="eami_1";break;case We.Eamii:s="eamii_1";break;case We.Peami:s="peami_1";break}this._writeSimplePropertyNode(i,"Rasgueado","Rasgueado",s)}}_writeRhythm(e,t,i){const s=`${t.duration}_${t.dots}_${t.tupletNumerator}_${t.tupletDenominator}';`;let a;if(this._rhythmIdLookup.has(s))a=this._rhythmIdLookup.get(s);else{a=this._rhythmIdLookup.size.toString(),this._rhythmIdLookup.set(s,a);const o=i.addElement("Rhythm");if(o.attributes.set("id",a),t.hasTuplet){const h=o.addElement("PrimaryTuplet");h.attributes.set("num",t.tupletNumerator.toString()),h.attributes.set("den",t.tupletDenominator.toString())}t.dots>0&&o.addElement("AugmentationDot").attributes.set("count",t.dots.toString());let c="Quarter";switch(t.duration){case M.QuadrupleWhole:c="Long";break;case M.DoubleWhole:c="DoubleWhole";break;case M.Whole:c="Whole";break;case M.Half:c="Half";break;case M.Quarter:c="Quarter";break;case M.Eighth:c="Eighth";break;case M.Sixteenth:c="16th";break;case M.ThirtySecond:c="32nd";break;case M.SixtyFourth:c="64th";break;case M.OneHundredTwentyEighth:c="128th";break;case M.TwoHundredFiftySixth:c="256th";break}o.addElement("NoteValue").innerText=c}e.addElement("Rhythm").attributes.set("ref",a)}_writeWhammyNode(e,t){t.hasWhammyBar&&t.whammyBarPoints.length<=4&&this._writeStandardWhammy(e,t.whammyBarPoints)}_writeStandardWhammy(e,t){const i=e.addElement("Whammy"),s=t[0],a=t[t.length-1];let o,c;switch(t.length){case 4:o=t[1],c=t[2];break;case 3:o=t[1],c=t[1];break;default:o=new ke((s.offset+a.offset)/2,(s.value+a.value)/2),c=o;break}i.attributes.set("destinationOffset",this._toBendOffset(a.offset).toString()),i.attributes.set("destinationValue",this._toBendValue(a.value).toString()),i.attributes.set("middleOffset1",this._toBendOffset(o.offset).toString()),i.attributes.set("middleOffset2",this._toBendOffset(c.offset).toString()),i.attributes.set("middleValue",this._toBendValue(o.value).toString()),i.attributes.set("originOffset",this._toBendOffset(s.offset).toString()),i.attributes.set("originValue",this._toBendValue(s.value).toString())}_writeScoreNode(e,t){const i=e.addElement("Score");i.addElement("Title").setCData(t.title),i.addElement("SubTitle").setCData(t.subTitle),i.addElement("Artist").setCData(t.artist),i.addElement("Album").setCData(t.album),i.addElement("Words").setCData(t.words),i.addElement("Music").setCData(t.music),i.addElement("WordsAndMusic").setCData(t.words===t.music?t.words:""),i.addElement("Copyright").setCData(t.copyright),i.addElement("Tabber").setCData(t.tab),i.addElement("Instructions").setCData(t.instructions),i.addElement("Notices").setCData(t.notices),i.addElement("FirstPageHeader").setCData(""),i.addElement("FirstPageFooter").setCData(""),i.addElement("PageHeader").setCData(""),i.addElement("PageFooter").setCData(""),i.addElement("ScoreSystemsDefaultLayout").setCData(t.defaultSystemsLayout.toString()),i.addElement("ScoreSystemsLayout").setCData(t.systemsLayout.join(" ")),i.addElement("ScoreZoomPolicy").innerText="Value",i.addElement("ScoreZoom").innerText="1",i.addElement("MultiVoice").innerText="1>"}_writeMasterTrackNode(e,t){const i=e.addElement("MasterTrack");i.addElement("Tracks").innerText=t.tracks.map(h=>h.index).join(" ");const s=i.addElement("Automations");if(t.masterBars.length>0&&t.masterBars[0].isAnacrusis&&i.addElement("Anacrusis"),t.masterBars[0].tempoAutomations.length===0){const h=s.addElement("Automation");h.addElement("Type").innerText="Tempo",h.addElement("Linear").innerText="false",h.addElement("Bar").innerText="0",h.addElement("Position").innerText="0",h.addElement("Visible").innerText="true",h.addElement("Value").innerText=`${t.tempo} 2`,t.tempoLabel&&(h.addElement("Text").innerText=t.tempoLabel)}const a=t.masterBars[0].syncPoints?t.masterBars[0].syncPoints.find(h=>h.ratioPosition===0&&h.syncPointValue.barOccurence===0):void 0,o=a?a.syncPointValue.millisecondOffset:0;this._backingTrackFramePadding=-1*(o/1e3*ia._sampleRate)|0;const c=new Zc(()=>mt.buildModifiedTempoLookup(t));for(const h of t.masterBars){for(const d of h.tempoAutomations){const p=s.addElement("Automation");p.addElement("Type").innerText="Tempo",p.addElement("Linear").innerText=d.isLinear?"true":"false",p.addElement("Bar").innerText=h.index.toString(),p.addElement("Position").innerText=d.ratioPosition.toString(),p.addElement("Visible").innerText=d.isVisible?"true":"false",p.addElement("Value").innerText=`${d.value} 2`,d.text&&(p.addElement("Text").innerText=d.text)}if(h.syncPoints)for(const d of h.syncPoints){const p=s.addElement("Automation");p.addElement("Type").innerText="SyncPoint",p.addElement("Linear").innerText="false",p.addElement("Bar").innerText=h.index.toString(),p.addElement("Position").innerText=d.ratioPosition.toString(),p.addElement("Visible").innerText=d.isVisible?"true":"false";const g=p.addElement("Value");g.addElement("BarIndex").innerText=h.index.toString(),g.addElement("BarOccurrence").innerText=d.syncPointValue.barOccurence.toString(),g.addElement("ModifiedTempo").innerText=c.value.get(d).syncBpm.toString(),g.addElement("OriginalTempo").innerText=t.tempo.toString();let y=(d.syncPointValue.millisecondOffset-o)/1e3*ia._sampleRate;y=Math.floor(y+.5),g.addElement("FrameOffset").innerText=y.toString()}}}_writeAudioTracksNode(e,t){e.addElement("AudioTracks")}_writeTracksNode(e,t){const i=e.addElement("Tracks");for(const s of t.tracks)this._writeTrackNode(i,s)}_writeTrackNode(e,t){const i=e.addElement("Track");i.attributes.set("id",t.index.toString()),i.addElement("Name").setCData(t.name),i.addElement("ShortName").setCData(t.shortName),i.addElement("Color").innerText=`${t.color.r} ${t.color.g} ${t.color.b}`,i.addElement("SystemsDefautLayout").innerText=t.defaultSystemsLayout.toString(),i.addElement("SystemsLayout").innerText=t.systemsLayout.join(" "),i.addElement("AutoBrush"),i.addElement("PalmMute").innerText="0",i.addElement("PlayingStyle").innerText=vn.isGuitar(t.playbackInfo.program)?"StringedPick":"Default",i.addElement("UseOneChannelPerString"),i.addElement("IconId").innerText=ia._getIconId(t.playbackInfo).toString(),this._writeInstrumentSetNode(i,t),this._writeTransposeNode(i,t),this._writeRseNode(i,t),i.addElement("ForcedSound").innerText="-1",this._writeMidiConnectionNode(i,t),t.playbackInfo.isSolo?i.addElement("PlaybackState").innerText="Solo":t.playbackInfo.isMute?i.addElement("PlaybackState").innerText="Mute":i.addElement("PlaybackState").innerText="Default",i.addElement("AudioEngineState").innerText="MIDI",this._writeLyricsNode(i,t),this._writeStavesNode(i,t),this._writeSoundsAndAutomations(i,t)}static _getIconId(e){return e.primaryChannel===9?ia._drumKitProgramInfo.icon:ia._midiProgramInfoLookup.has(e.program)?ia._midiProgramInfoLookup.get(e.program).icon:he.SteelGuitar}_writeSoundAndAutomation(e,t,i,s,a,o,c,h,d=0){const p=e.addElement("Sound");p.addElement("Name").setCData(i),p.addElement("Label").setCData(i),p.addElement("Path").setCData(s),p.addElement("Role").setCData(a);const g=p.addElement("MIDI"),y=vn.bankToLsbMsb(h);g.addElement("LSB").innerText=y[0].toString(),g.addElement("MSB").innerText=y[1].toString(),g.addElement("Program").innerText=c.toString();const k=t.addElement("Automation");k.addElement("Type").innerText="Sound",k.addElement("Linear").innerText="false",k.addElement("Bar").innerText=o.toString(),k.addElement("Position").innerText=d.toString(),k.addElement("Visible").innerText="true",k.addElement("Value").setCData(`${s};${i};${a}`)}_writeSoundsAndAutomations(e,t){const i=e.addElement("Sounds"),s=e.addElement("Automations");if(t.staves.length>0&&t.staves[0].bars.length>0){const a=`Track_${t.index}_Initial`,o=`Midi/${t.playbackInfo.program}`,c="Factory";let h=!1,d=t.playbackInfo.bank;for(const p of t.staves)for(const g of p.bars)for(const y of g.voices)for(const k of y.beats){const _=k.getAutomation(Mt.Instrument),w=g.index===0&&k.index===0,T=k.getAutomation(Mt.Bank);if(T&&(d=T.value),_){const x=w?a:`ProgramChange_${k.id}`,E=w?o:`Midi/${_.value}`,N=w?c:"User";!w&&!h&&(this._writeSoundAndAutomation(i,s,a,o,c,t.staves[0].bars[0].index,t.playbackInfo.program,t.playbackInfo.bank),h=!0),this._writeSoundAndAutomation(i,s,x,E,N,g.index,_.value,d,_.ratioPosition),w&&(h=!0)}}}for(const a of t.staves)for(const o of a.bars)for(const c of o.sustainPedals)if(c.pedalType!==ai.Hold){const h=s.addElement("Automation");switch(h.addElement("Type").innerText="SustainPedal",h.addElement("Linear").innerText="false",h.addElement("Bar").innerText=o.index.toString(),h.addElement("Position").innerText=c.ratioPosition.toString(),h.addElement("Visible").innerText="true",c.pedalType){case ai.Down:h.addElement("Value").innerText="0 1";break;case ai.Up:h.addElement("Value").innerText="0 3";break}}}_writeMidiConnectionNode(e,t){const i=e.addElement("MidiConnection");i.addElement("Port").innerText=t.playbackInfo.port.toString(),i.addElement("PrimaryChannel").innerText=t.playbackInfo.primaryChannel.toString(),i.addElement("SecondaryChannel").innerText=t.playbackInfo.secondaryChannel.toString(),i.addElement("ForeOneChannelPerString").innerText="false"}_writeRseNode(e,t){const s=e.addElement("RSE").addElement("ChannelStrip");s.attributes.set("version","E56");const a=s.addElement("Parameters");a.innerText=`0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 ${t.playbackInfo.balance/16} ${t.playbackInfo.volume/16} 0.5 0.5 0.5`}_writeStavesNode(e,t){const i=e.addElement("Staves");for(const s of t.staves)this._writeStaffNode(i,s)}_writeStaffNode(e,t){const s=e.addElement("Staff").addElement("Properties");if(this._writeSimplePropertyNode(s,"CapoFret","Fret",t.capo.toString()),this._writeSimplePropertyNode(s,"FretCount","Fret","24"),t.tuning.length>0){const a=s.addElement("Property");switch(a.attributes.set("name","Tuning"),a.addElement("Pitches").innerText=t.tuning.slice().reverse().join(" "),a.addElement("Label").setCData(t.tuningName),a.addElement("LabelVisible").innerText=t.tuningName?"true":"false",a.addElement("Flat"),t.tuning.length){case 3:a.addElement("Instrument").innerText="Shamisen";break;case 4:t.track.playbackInfo.program===105?a.addElement("Instrument").innerText="Banjo":t.track.playbackInfo.program===42?a.addElement("Instrument").innerText="Cello":t.track.playbackInfo.program===43?a.addElement("Instrument").innerText="Contrabass":t.track.playbackInfo.program===40?a.addElement("Instrument").innerText="Violin":t.track.playbackInfo.program===41?a.addElement("Instrument").innerText="Viola":a.addElement("Instrument").innerText="Bass";break;case 5:t.track.playbackInfo.program===105?a.addElement("Instrument").innerText="Banjo":a.addElement("Instrument").innerText="Bass";break;case 6:t.track.playbackInfo.program===105?a.addElement("Instrument").innerText="Banjo":t.track.playbackInfo.program<=39?a.addElement("Instrument").innerText="Bass":a.addElement("Instrument").innerText="Guitar";break;case 7:t.track.playbackInfo.program<=39?a.addElement("Instrument").innerText="Bass":a.addElement("Instrument").innerText="Guitar";break;default:a.addElement("Instrument").innerText="Guitar";break}}this._writeSimplePropertyNode(s,"PartialCapoFret","Fret","0"),this._writeSimplePropertyNode(s,"PartialCapoStringFlags","Bitset",t.tuning.map(a=>"0").join("")),this._writeSimplePropertyNode(s,"TuningFlat","Enable",null),this._writeDiagramCollection(s,t,"DiagramCollection"),this._writeDiagramCollection(s,t,"DiagramWorkingSet")}_writeDiagramCollection(e,t,i){const s=e.addElement("Property");s.attributes.set("name",i);const a=s.addElement("Items"),o=t.chords;if(o)for(const[c,h]of o){const d=a.addElement("Item");d.attributes.set("id",c),d.attributes.set("name",h.name);const p=d.addElement("Diagram");p.attributes.set("stringCount",h.strings.length.toString()),p.attributes.set("fretCount","5"),p.attributes.set("baseFret",(h.firstFret-1).toString()),p.attributes.set("barStates",h.strings.map(A=>"1").join(" "));const g=[],y=new Map;for(let A=0;A<h.strings.length;A++){const D=h.strings[A];if(D!==-1){const H=p.addElement("Fret"),J=h.strings.length-1-A;H.attributes.set("string",J.toString()),H.attributes.set("fret",(D-h.firstFret+1).toString()),y.has(D)||(y.set(D,[]),g.push(D)),y.get(D).push(J)}}g.sort();const k=p.addElement("Fingering");if(h.barreFrets.length>0){const A=[Fe.LittleFinger,Fe.AnnularFinger,Fe.MiddleFinger,Fe.IndexFinger];for(const D of g){const H=y.get(D);if(H.length>1&&h.barreFrets.indexOf(D)>=0){const J=A.length>0?A.pop():Fe.IndexFinger;for(const K of H){const Y=k.addElement("Position");switch(J){case Fe.LittleFinger:Y.attributes.set("finger","Pinky");break;case Fe.AnnularFinger:Y.attributes.set("finger","Ring");break;case Fe.MiddleFinger:Y.attributes.set("finger","Middle");break;case Fe.IndexFinger:Y.attributes.set("finger","Index");break}Y.attributes.set("fret",(D-h.firstFret+1).toString()),Y.attributes.set("string",K.toString())}}}}const _=p.addElement("Property");_.attributes.set("name","ShowName"),_.attributes.set("type","bool"),_.attributes.set("value",h.showName?"true":"false");const w=p.addElement("Property");w.attributes.set("name","ShowDiagram"),w.attributes.set("type","bool"),w.attributes.set("value",h.showDiagram?"true":"false");const T=p.addElement("Property");T.attributes.set("name","ShowFingering"),T.attributes.set("type","bool"),T.attributes.set("value",h.showFingering?"true":"false");const x=p.addElement("Chord"),E=x.addElement("KeyNote");E.attributes.set("step","C"),E.attributes.set("accidental","Natural");const N=x.addElement("BassNote");N.attributes.set("step","C"),N.attributes.set("accidental","Natural");const v=x.addElement("Degree");v.attributes.set("interval","Third"),v.attributes.set("alteration","Major"),v.attributes.set("omitted","false");const L=x.addElement("Degree");L.attributes.set("interval","Fifth"),L.attributes.set("alteration","Perfect"),L.attributes.set("omitted","false")}}_writeSimplePropertyNode(e,t,i,s){const a=e.addElement("Property");a.attributes.set("name",t);const o=a.addElement(i);return s!==null&&(o.innerText=s),a}_writeSimpleXPropertyNode(e,t,i,s){const a=e.addElement("XProperty");a.attributes.set("id",t);const o=a.addElement(i);return s!==null&&(o.innerText=s),a}_writeLyricsNode(e,t){const i=e.addElement("Lyrics");i.attributes.set("dispatched","true");const s=[];for(const a of t.staves[0].bars)for(const o of a.voices)if(!o.isEmpty){for(const c of o.beats)if(c.lyrics)for(let h=0;h<c.lyrics.length;h++){for(;h>=s.length;){const p=new sn;p.startBar=a.index,p.text="[Empty]",s.push(p)}const d=s[h];d.text=d.text==="[Empty]"?c.lyrics[h]:`${d.text} ${c.lyrics[h].split(" ").join("+")}`}}for(let a=0;a<s.length;a++){const o=i.addElement("Line");o.addElement("Text").setCData(s[a].text),o.addElement("Offset").innerText=s[a].startBar.toString()}}_writeTransposeNode(e,t){const i=e.addElement("Transpose"),s=Math.floor(t.staves[0].displayTranspositionPitch/12),a=t.staves[0].displayTranspositionPitch-s*12;i.addElement("Chromatic").innerText=a.toString(),i.addElement("Octave").innerText=s.toString()}_writeInstrumentSetNode(e,t){const i=e.addElement("InstrumentSet"),s=t.staves[0];if(i.addElement("LineCount").innerText=s.standardNotationLineCount.toString(),t.percussionArticulations.length>0||s.isPercussion){const a=t.percussionArticulations.length>0?t.percussionArticulations:Array.from($i.instrumentArticulations.values());i.addElement("Name").innerText=ia._drumKitProgramInfo.instrumentSetName,i.addElement("Type").innerText=ia._drumKitProgramInfo.instrumentSetType;let o="",c=new oa;const h=new Map,d=i.addElement("Elements");for(const p of a){{const y=d.addElement("Element");let k=p.elementType;if(h.has(k)){const _=h.get(k);k+=` ${_}`,h.set(k,_+1)}else h.set(k,1);o=k,y.addElement("Name").innerText=k,y.addElement("Type").innerText=p.elementType,c=y.addElement("Articulations")}const g=c.addElement("Articulation");switch(g.addElement("Name").innerText=`${o} ${c.childNodes.length}`,g.addElement("StaffLine").innerText=p.staffLine.toString(),g.addElement("Noteheads").innerText=[this._mapMusicSymbol(p.noteHeadDefault),this._mapMusicSymbol(p.noteHeadHalf),this._mapMusicSymbol(p.noteHeadWhole)].join(" "),p.techniqueSymbolPlacement){case Jt.Below:g.addElement("TechniquePlacement").innerText="below";break;case Jt.Outside:g.addElement("TechniquePlacement").innerText="outside";break;case Jt.Inside:g.addElement("TechniquePlacement").innerText="inside";break;case Jt.Above:g.addElement("TechniquePlacement").innerText="above";break}g.addElement("TechniqueSymbol").innerText=this._mapMusicSymbol(p.techniqueSymbol),g.addElement("InputMidiNumbers").innerText="",g.addElement("OutputMidiNumber").innerText=p.outputMidiNumber.toString()}}else{const a=ia._midiProgramInfoLookup.has(t.playbackInfo.program)?ia._midiProgramInfoLookup.get(t.playbackInfo.program):ia._midiProgramInfoLookup.get(0);i.addElement("Name").innerText=a.instrumentSetName,i.addElement("Type").innerText=a.instrumentSetType;const c=i.addElement("Elements").addElement("Element");c.addElement("Pitched").innerText="Pitched",c.addElement("Type").innerText="pitched",c.addElement("SoundbankName").innerText="";const d=c.addElement("Articulations").addElement("Articulation");d.addElement("Name").innerText="",d.addElement("StaffLine").innerText="0",d.addElement("Noteheads").innerText="noteheadBlack noteheadHalf noteheadWhole",d.addElement("TechniquePlacement").innerText="outside",d.addElement("TechniqueSymbol").innerText="",d.addElement("InputMidiNumbers").innerText="",d.addElement("OutputRSESound").innerText="",d.addElement("OutputMidiNumber").innerText="0"}}_mapMusicSymbol(e){if(e===S.None)return"";const t=S[e];return t.substring(0,1).toLowerCase()+t.substring(1)}_writeMasterBarsNode(e,t){const i=e.addElement("MasterBars");for(const s of t.masterBars)this._writeMasterBarNode(i,s)}_writeMasterBarNode(e,t){const i=e.addElement("MasterBar"),s=i.addElement("Key");let a=t.score.tracks[0].staves[0].bars[t.index].keySignature;const o=t.score.tracks[0].staves[0].bars[t.index].keySignatureType,c=ce.flooredDivision(t.score.tracks[0].staves[0].displayTranspositionPitch,12);a=ce.transposeKey(a,-c),s.addElement("AccidentalCount").innerText=a.toString(),s.addElement("Mode").innerText=pn[o],s.addElement("Sharps").innerText="Sharps",i.addElement("Time").innerText=`${t.timeSignatureNumerator}/${t.timeSignatureDenominator}`,t.isFreeTime&&i.addElement("FreeTime");const h=[];for(const d of t.score.tracks)for(const p of d.staves)h.push(p.bars[t.index].id.toString());if(i.addElement("Bars").innerText=h.join(" "),t.isDoubleBar&&i.addElement("DoubleBar"),t.isSectionStart){const d=i.addElement("Section");d.addElement("Letter").setCData(t.section.marker),d.addElement("Text").setCData(t.section.text)}if(t.isRepeatStart||t.isRepeatEnd){const d=i.addElement("Repeat");d.attributes.set("start",t.isRepeatStart?"true":"false"),d.attributes.set("end",t.isRepeatEnd?"true":"false"),t.isRepeatEnd&&d.attributes.set("count",t.repeatCount.toString())}if(t.alternateEndings>0){let d=t.alternateEndings;const p=[];let g=0;for(;d>0;)(d>>g&1)===1&&(p.push(g+1),d&=~(1<<g)),g++;i.addElement("AlternateEndings").innerText=p.join(" ")}if(t.tripletFeel!==yt.NoTripletFeel&&(i.addElement("TripletFeel").innerText=yt[t.tripletFeel]),t.directions&&t.directions.size>0){const d=i.addElement("Directions");for(const p of t.directions)switch(p){case Te.TargetFine:d.addElement("Target").innerText="Fine";break;case Te.TargetSegno:d.addElement("Target").innerText="Segno";break;case Te.TargetSegnoSegno:d.addElement("Target").innerText="SegnoSegno";break;case Te.TargetCoda:d.addElement("Target").innerText="Coda";break;case Te.TargetDoubleCoda:d.addElement("Target").innerText="DoubleCoda";break;case Te.JumpDaCapo:d.addElement("Jump").innerText="DaCapo";break;case Te.JumpDaCapoAlCoda:d.addElement("Jump").innerText="DaCapoAlCoda";break;case Te.JumpDaCapoAlDoubleCoda:d.addElement("Jump").innerText="DaCapoAlDoubleCoda";break;case Te.JumpDaCapoAlFine:d.addElement("Jump").innerText="DaCapoAlFine";break;case Te.JumpDalSegno:d.addElement("Jump").innerText="DaSegno";break;case Te.JumpDalSegnoAlCoda:d.addElement("Jump").innerText="DaSegnoAlCoda";break;case Te.JumpDalSegnoAlDoubleCoda:d.addElement("Jump").innerText="DaSegnoAlDoubleCoda";break;case Te.JumpDalSegnoAlFine:d.addElement("Jump").innerText="DaSegnoAlFine";break;case Te.JumpDalSegnoSegno:d.addElement("Jump").innerText="DaSegnoSegno";break;case Te.JumpDalSegnoSegnoAlCoda:d.addElement("Jump").innerText="DaSegnoSegnoAlCoda";break;case Te.JumpDalSegnoSegnoAlDoubleCoda:d.addElement("Jump").innerText="DaSegnoSegnoAlDoubleCoda";break;case Te.JumpDalSegnoSegnoAlFine:d.addElement("Jump").innerText="DaSegnoSegnoAlFine";break;case Te.JumpDaCoda:d.addElement("Jump").innerText="DaCoda";break;case Te.JumpDaDoubleCoda:d.addElement("Jump").innerText="DaDoubleCoda";break}}this._writeFermatas(i,t)}_writeFermatas(e,t){const i=t.fermata?.size??0;if(i!==0&&i>0){const s=e.addElement("Fermatas");for(const[a,o]of t.fermata)this._writeFermata(s,a,o)}}_writeFermata(e,t,i){let s=-1,a=1;if(t>0)for(;a<10&&(s=t/$.QuarterTime*a,s!==Math.floor(s));)s=-1,a++;else s=0,a=1;if(s===-1)return;const o=e.addElement("Fermata");o.addElement("Type").innerText=mn[i.type],o.addElement("Length").innerText=i.length.toString(),o.addElement("Offset").innerText=`${s}/${a}`}_writeBarNode(e,t){const i=e.addElement("Bar");i.attributes.set("id",t.id.toString()),i.addElement("Voices").innerText=t.voices.map(s=>s.isEmpty?"-1":s.id.toString()).join(" "),i.addElement("Clef").innerText=_t[t.clef],t.clefOttava!==Ye.Regular&&(i.addElement("Ottavia").innerText=Ye[t.clefOttava].substr(1)),t.simileMark!==rs.None&&(i.addElement("SimileMark").innerText=rs[t.simileMark])}_writeVoiceNode(e,t){if(t.isEmpty)return;const i=e.addElement("Voice");i.attributes.set("id",t.id.toString()),i.addElement("Beats").innerText=t.beats.map(s=>s.id).join(" ")}}class yh{static _crc32Lookup=yh._buildCrc32Lookup();static _buildCrc32Lookup(){const t=new Uint32Array(256);for(let i=0;i<t.length;i++){let s=i;for(let a=0;a<8;a++)s=(s&1)===1?s>>>1^3988292384:s>>>1;t[i]=s}return t}static _crcInit=4294967295;_checkValue=yh._crcInit;get value(){return~this._checkValue}constructor(){this.reset()}update(e,t,i){for(let s=0;s<i;s++)this._checkValue=yh._crc32Lookup[(this._checkValue^e[t+s])&255]^this._checkValue>>>8}reset(){this._checkValue=yh._crcInit}}class Dn{static maxWbits=15;static wsize=1<<Dn.maxWbits;static wmask=Dn.wsize-1;static minMatch=3;static maxMatch=258;static defaultMemLevel=8;static pendingBufSize=1<<Dn.defaultMemLevel+8;static hashBits=Dn.defaultMemLevel+7;static hashSize=1<<Dn.hashBits;static hashShift=(Dn.hashBits+Dn.minMatch-1)/Dn.minMatch;static hashMask=Dn.hashSize-1;static minLookahead=Dn.maxMatch+Dn.minMatch+1;static maxDist=Dn.wsize-Dn.minLookahead}class hr{static _repeat3To6=16;static _repeat3To10=17;static _repeat11To138=18;freqs;length=null;minNumCodes;numCodes=0;_codes=null;_bitLengthCounts;_maxLength;_huffman;constructor(e,t,i,s){this._huffman=e,this.minNumCodes=i,this._maxLength=s,this.freqs=new Int16Array(t),this._bitLengthCounts=new Int32Array(s)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this._codes=null,this.length=null}buildTree(){const e=this.freqs.length,t=new Int32Array(e);let i=0,s=0;for(let d=0;d<e;d++){const p=this.freqs[d];if(p!==0){let g=i++;for(;g>0;){const y=Math.floor((g-1)/2);if(this.freqs[t[y]]>p)t[g]=t[y],g=y;else break}t[g]=d,s=d}}for(;i<2;){const d=s<2?++s:0;t[i++]=d}this.numCodes=Math.max(s+1,this.minNumCodes);const a=i,o=new Int32Array(4*i-2),c=new Int32Array(2*i-1);let h=a;for(let d=0;d<i;d++){const p=t[d];o[2*d]=p,o[2*d+1]=-1,c[d]=this.freqs[p]<<8,t[d]=d}do{const d=t[0];let p=t[--i],g=0,y=1;for(;y<i;)y+1<i&&c[t[y]]>c[t[y+1]]&&y++,t[g]=t[y],g=y,y=y*2+1;let k=c[p];for(;y=g,g>0;)if(g=Math.floor((y-1)/2),c[t[g]]>k)t[y]=t[g];else break;t[y]=p;const _=t[0];p=h++,o[2*p]=d,o[2*p+1]=_;const w=Math.min(c[d]&255,c[_]&255);for(k=c[d]+c[_]-w+1,c[p]=k,g=0,y=1;y<i;)y+1<i&&c[t[y]]>c[t[y+1]]&&y++,t[g]=t[y],g=y,y=g*2+1;for(;y=g,y>0;)if(g=Math.floor((y-1)/2),c[t[g]]>k)t[y]=t[g];else break;t[y]=p}while(i>1);this._buildLength(o)}_buildLength(e){this.length=new Uint8Array(this.freqs.length);const t=Math.floor(e.length/2),i=Math.floor((t+1)/2);let s=0;for(let h=0;h<this._maxLength;h++)this._bitLengthCounts[h]=0;const a=new Int32Array(t);a[t-1]=0;for(let h=t-1;h>=0;h--)if(e[2*h+1]!==-1){let d=a[h]+1;d>this._maxLength&&(d=this._maxLength,s++),a[e[2*h]]=d,a[e[2*h+1]]=d}else{const d=a[h];this._bitLengthCounts[d-1]++,this.length[e[2*h]]=a[h]}if(s===0)return;let o=this._maxLength-1;do{for(;this._bitLengthCounts[--o]===0;);do this._bitLengthCounts[o]--,this._bitLengthCounts[++o]++,s-=1<<this._maxLength-1-o;while(s>0&&o<this._maxLength-1)}while(s>0);this._bitLengthCounts[this._maxLength-1]+=s,this._bitLengthCounts[this._maxLength-2]-=s;let c=2*i;for(let h=this._maxLength;h!==0;h--){let d=this._bitLengthCounts[h-1];for(;d>0;){const p=2*e[c++];e[p+1]===-1&&(this.length[e[p]]=h,d--)}}}getEncodedLength(){let e=0;for(let t=0;t<this.freqs.length;t++)e+=this.freqs[t]*this.length[t];return e}calcBLFreq(e){let t,i,s,a=-1,o=0;for(;o<this.numCodes;){s=1;const c=this.length[o];for(c===0?(t=138,i=3):(t=6,i=3,a!==c&&(e.freqs[c]++,s=0)),a=c,o++;o<this.numCodes&&a===this.length[o]&&(o++,!(++s>=t)););s<i?e.freqs[a]+=s:a!==0?e.freqs[hr._repeat3To6]++:s<=10?e.freqs[hr._repeat3To10]++:e.freqs[hr._repeat11To138]++}}setStaticCodes(e,t){this._codes=e,this.length=t}buildCodes(){const e=new Int32Array(this._maxLength);let t=0;this._codes=new Int16Array(this.freqs.length);for(let i=0;i<this._maxLength;i++)e[i]=t,t+=this._bitLengthCounts[i]<<15-i;for(let i=0;i<this.numCodes;i++){const s=this.length[i];s>0&&(this._codes[i]=wt.bitReverse(e[s-1]),e[s-1]+=1<<16-s)}}writeTree(e){let t,i,s,a=-1,o=0;for(;o<this.numCodes;){s=1;const c=this.length[o];for(c===0?(t=138,i=3):(t=6,i=3,a!==c&&(e.writeSymbol(c),s=0)),a=c,o++;o<this.numCodes&&a===this.length[o]&&(o++,!(++s>=t)););if(s<i)for(;s-- >0;)e.writeSymbol(a);else a!==0?(e.writeSymbol(hr._repeat3To6),this._huffman.pending.writeBits(s-3,2)):s<=10?(e.writeSymbol(hr._repeat3To10),this._huffman.pending.writeBits(s-3,3)):(e.writeSymbol(hr._repeat11To138),this._huffman.pending.writeBits(s-11,7))}}writeSymbol(e){this._huffman.pending.writeBits(this._codes[e]&65535,this.length[e])}}class wt{static _bufSize=1<<Dn.defaultMemLevel+6;static _literalNum=286;static storedBlock=0;static staticTrees=1;static dynTrees=2;static _distNum=30;static _staticLCodes=new Int16Array(wt._literalNum);static _staticLLength=new Uint8Array(wt._literalNum);static _staticDCodes=new Int16Array(wt._distNum);static _staticDLength=new Uint8Array(wt._distNum);static staticInit(){let e=0;for(;e<144;)wt._staticLCodes[e]=wt.bitReverse(48+e<<8),wt._staticLLength[e++]=8;for(;e<256;)wt._staticLCodes[e]=wt.bitReverse(256+e<<7),wt._staticLLength[e++]=9;for(;e<280;)wt._staticLCodes[e]=wt.bitReverse(-256+e<<9),wt._staticLLength[e++]=7;for(;e<wt._literalNum;)wt._staticLCodes[e]=wt.bitReverse(-88+e<<8),wt._staticLLength[e++]=8;for(e=0;e<wt._distNum;e++)wt._staticDCodes[e]=wt.bitReverse(e<<11),wt._staticDLength[e]=5}static _blOrder=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];static _bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]);static bitReverse(e){return wt._bit4Reverse[e&15]<<12|wt._bit4Reverse[e>>4&15]<<8|wt._bit4Reverse[e>>8&15]<<4|wt._bit4Reverse[e>>12]}static _bitLenNum=19;static _eofSymbol=256;pending;_literalTree;_distTree;_blTree;_dBuf;_lBuf;_lastLit=0;_extraBits=0;constructor(e){this.pending=e,this._literalTree=new hr(this,wt._literalNum,257,15),this._distTree=new hr(this,wt._distNum,1,15),this._blTree=new hr(this,wt._bitLenNum,4,7),this._dBuf=new Int16Array(wt._bufSize),this._lBuf=new Uint8Array(wt._bufSize)}isFull(){return this._lastLit>=wt._bufSize}reset(){this._lastLit=0,this._extraBits=0,this._literalTree.reset(),this._distTree.reset(),this._blTree.reset()}flushStoredBlock(e,t,i,s){this.pending.writeBits((wt.storedBlock<<1)+(s?1:0),3),this.pending.alignToByte(),this.pending.writeShort(i),this.pending.writeShort(~i),this.pending.writeBlock(e,t,i),this.reset()}flushBlock(e,t,i,s){this._literalTree.freqs[wt._eofSymbol]++,this._literalTree.buildTree(),this._distTree.buildTree(),this._literalTree.calcBLFreq(this._blTree),this._distTree.calcBLFreq(this._blTree),this._blTree.buildTree();let a=4;for(let h=18;h>a;h--)this._blTree.length[wt._blOrder[h]]>0&&(a=h+1);let o=14+a*3+this._blTree.getEncodedLength()+this._literalTree.getEncodedLength()+this._distTree.getEncodedLength()+this._extraBits,c=this._extraBits;for(let h=0;h<wt._literalNum;h++)c+=this._literalTree.freqs[h]*wt._staticLLength[h];for(let h=0;h<wt._distNum;h++)c+=this._distTree.freqs[h]*wt._staticDLength[h];o>=c&&(o=c),t>=0&&i+4<o>>3?this.flushStoredBlock(e,t,i,s):o===c?(this.pending.writeBits((wt.staticTrees<<1)+(s?1:0),3),this._literalTree.setStaticCodes(wt._staticLCodes,wt._staticLLength),this._distTree.setStaticCodes(wt._staticDCodes,wt._staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((wt.dynTrees<<1)+(s?1:0),3),this.sendAllTrees(a),this.compressBlock(),this.reset())}sendAllTrees(e){this._blTree.buildCodes(),this._literalTree.buildCodes(),this._distTree.buildCodes(),this.pending.writeBits(this._literalTree.numCodes-257,5),this.pending.writeBits(this._distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this._blTree.length[wt._blOrder[t]],3);this._literalTree.writeTree(this._blTree),this._distTree.writeTree(this._blTree)}compressBlock(){for(let e=0;e<this._lastLit;e++){const t=this._lBuf[e]&255;let i=this._dBuf[e];if(i--!==0){const s=wt._lCode(t);this._literalTree.writeSymbol(s);let a=Math.floor((s-261)/4);a>0&&a<=5&&this.pending.writeBits(t&(1<<a)-1,a);const o=wt._dCode(i);this._distTree.writeSymbol(o),a=Math.floor(o/2)-1,a>0&&this.pending.writeBits(i&(1<<a)-1,a)}else this._literalTree.writeSymbol(t)}this._literalTree.writeSymbol(wt._eofSymbol)}tallyDist(e,t){this._dBuf[this._lastLit]=e,this._lBuf[this._lastLit++]=t-3;const i=wt._lCode(t-3);this._literalTree.freqs[i]++,i>=265&&i<285&&(this._extraBits+=Math.floor((i-261)/4));const s=wt._dCode(e-1);return this._distTree.freqs[s]++,s>=4&&(this._extraBits+=Math.floor(s/2)-1),this.isFull()}tallyLit(e){return this._dBuf[this._lastLit]=0,this._lBuf[this._lastLit++]=e,this._literalTree.freqs[e]++,this.isFull()}static _lCode(e){if(e===255)return 285;let t=257;for(;e>=8;)t+=4,e=e>>1;return t+e}static _dCode(e){let t=0;for(;e>=4;)t+=2,e=e>>1;return t+e}}wt.staticInit();var lT;(function(n){n[n.SequenceNumber=0]="SequenceNumber",n[n.TextEvent=1]="TextEvent",n[n.CopyrightNotice=2]="CopyrightNotice",n[n.SequenceOrTrackName=3]="SequenceOrTrackName",n[n.InstrumentName=4]="InstrumentName",n[n.LyricText=5]="LyricText",n[n.MarkerText=6]="MarkerText",n[n.CuePoint=7]="CuePoint",n[n.PatchName=8]="PatchName",n[n.PortName=9]="PortName",n[n.MidiChannel=32]="MidiChannel",n[n.MidiPort=33]="MidiPort",n[n.EndOfTrack=47]="EndOfTrack",n[n.Tempo=81]="Tempo",n[n.SmpteOffset=84]="SmpteOffset",n[n.TimeSignature=88]="TimeSignature",n[n.KeySignature=89]="KeySignature",n[n.SequencerSpecific=127]="SequencerSpecific"})(lT||(lT={}));var cT;(function(n){n[n.SystemExclusive=240]="SystemExclusive",n[n.MtcQuarterFrame=241]="MtcQuarterFrame",n[n.SongPosition=242]="SongPosition",n[n.SongSelect=243]="SongSelect",n[n.TuneRequest=246]="TuneRequest",n[n.SystemExclusive2=247]="SystemExclusive2"})(cT||(cT={}));var uT;(function(n){n[n.MetronomeTick=0]="MetronomeTick",n[n.Rest=1]="Rest"})(uT||(uT={}));const JO=Object.freeze(Object.defineProperty({__proto__:null,get AccentuationType(){return mi},get AccidentalType(){return Le},Automation:jt,get AutomationType(){return Mt},BackingTrack:Db,Bar:gn,get BarLineStyle(){return et},BarStyle:Ax,get BarSubElement(){return Bt},get BarreShape(){return Yn},Beat:fs,get BeatBeamingMode(){return ei},BeatStyle:Fx,get BeatSubElement(){return ti},BendPoint:ke,get BendStyle(){return Kt},get BendType(){return Ae},get BracketExtendMode(){return Yo},get BrushType(){return Ne},Chord:so,get Clef(){return _t},Color:Tt,get CrescendoType(){return Ds},get Direction(){return Te},get Duration(){return M},get DynamicValue(){return Oe},ElementStyle:Vl,get FadeType(){return Xi},Fermata:ru,get FermataType(){return mn},get Fingers(){return Fe},Font:nt,get FontStyle(){return pi},get FontWeight(){return fn},get GolpeType(){return qs},GraceGroup:sp,get GraceType(){return De},get HarmonicType(){return Re},HeaderFooterStyle:wn,InstrumentArticulation:Pe,JsonConverter:ts,get KeySignature(){return Xt},get KeySignatureType(){return pn},Lyrics:sn,MasterBar:Ka,get MusicFontSymbol(){return S},Note:es,get NoteAccidentalMode(){return Ue},get NoteOrnament(){return fi},NoteStyle:Bb,get NoteSubElement(){return Js},get Ottavia(){return Ye},get PickStroke(){return ds},PlaybackInformation:vb,get Rasgueado(){return We},RenderStylesheet:Lx,RepeatGroup:O0,Score:Qa,ScoreStyle:$o,get ScoreSubElement(){return ye},Section:ou,get SimileMark(){return rs},get SlideInType(){return Ji},get SlideOutType(){return $e},Staff:el,SustainPedalMarker:Qr,get SustainPedalMarkerType(){return ai},SyncPointData:td,get TechniqueSymbolPlacement(){return Jt},Track:Za,get TrackNameMode(){return $s},get TrackNameOrientation(){return Xs},get TrackNamePolicy(){return Ii},TrackStyle:Vx,get TrackSubElement(){return Xa},get TripletFeel(){return yt},Tuning:de,TupletGroup:xa,get VibratoType(){return ct},Voice:An,VoiceStyle:Rx,get VoiceSubElement(){return jc},get WahPedal(){return an},get WhammyType(){return Dt}},Symbol.toStringTag,{value:"Module"})),QO=Object.freeze(Object.defineProperty({__proto__:null,ActiveBeatsChangedEventArgs:H0,AlphaSynth:fv,AlphaSynthAudioWorkletOutput:Xx,AlphaSynthBase:Ib,AlphaSynthScriptProcessorOutput:yv,AlphaSynthWebAudioOutputBase:Ga,AlphaSynthWebWorkerApi:$f,AudioExportChunk:dv,AudioExportOptions:hv,BackingTrackSyncPoint:Hc,CircularSampleBuffer:Lb,MidiEventsPlayedEventArgs:Fb,PlaybackRange:mv,PlaybackRangeChangedEventArgs:Hh,get PlayerState(){return Ts},PlayerStateChangedEventArgs:Rl,PositionChangedEventArgs:fr},Symbol.toStringTag,{value:"Module"}));ne.isRunningInWorker?ne.initializeWorker():ne.isRunningInAudioWorklet?ne.initializeAudioWorklet():ne.initializeMain(n=>{if(ne.webPlatform===Tn.NodeJs)throw new Ht(It.General,"Workers not yet supported in Node.js");if(ne.webPlatform===Tn.BrowserModule||ne.isWebPackBundled||ne.isViteBundled){ee.debug("AlphaTab","Creating webworker");try{return new ne.alphaTabWorker(new ne.alphaTabUrl(new URL("/griff/assets/alphaTab.worker-CVlve8V-.js",import.meta.url),import.meta.url),{type:"module"})}catch(t){ee.debug("AlphaTab","ESM webworker construction with direct URL failed",t)}let e="";try{e=new ne.alphaTabUrl("./alphaTab.worker.mjs",import.meta.url);const t=`import ${JSON.stringify(e)}`,i=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(t){ee.debug("AlphaTab","ESM webworker construction with blob import failed",e,t)}try{if(!n.core.scriptFile)throw new Error("Could not detect alphaTab script file");e=n.core.scriptFile;const t=`import ${JSON.stringify(n.core.scriptFile)}`,i=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(t){ee.debug("AlphaTab","ESM webworker construction with blob import failed",n.core.scriptFile,t)}}if(!n.core.scriptFile)throw new Ht(It.General,"Could not detect alphaTab script file, cannot initialize renderer");try{ee.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${n.core.scriptFile}')`,t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}catch{return ee.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(n.core.scriptFile)}},(n,e)=>{if(ne.webPlatform===Tn.NodeJs)throw new Ht(It.General,"Audio Worklets not yet supported in Node.js");return ne.webPlatform===Tn.BrowserModule||ne.isWebPackBundled||ne.isViteBundled?(ee.debug("AlphaTab","Creating Module worklet"),n.audioWorklet.addModule(new ne.alphaTabUrl(new URL("/griff/assets/alphaTab.worklet-BNvU1CWB.js",import.meta.url),import.meta.url))):(ee.debug("AlphaTab","Creating Script worklet"),n.audioWorklet.addModule(e.core.scriptFile))});let KO=0;class ZO{constructor(e,t,i,s,a,o){this._id=KO++,this._engine=e,this._index=t,this._name=i,this._mute=s,this._solo=a,this._volume=o}get name(){return this._name}get id(){return this._id}get index(){return this._index}get isMute(){return this._mute}toggleMute(){this._engine._changeTrackMute(this._index,!this._mute),this._mute=!this._mute}get isSolo(){return this._solo}toggleSolo(){this._engine._changeTrackSolo(this._index,!this._solo),this._solo=!this._solo}get volume(){return this._volume}set volume(e){this._volume=e,this._engine._changeTrackVolume(this._index,e)}}class jO{_api=null;_onChange=null;_tracks=[];constructor(){this._initVars()}init(e,t){this._api||(this._api=new Sg(e,{core:{fontDirectory:"assets/font/",useWorkers:!0},player:{enablePlayer:!0,enableCursor:!0,scrollMode:pr.OffScreen,scrollElement:e.parentElement,enableElementHighlighting:!1,soundFont:"assets/gm.sf2"},notation:{rhythmMode:aa.Hidden,elements:{effectDynamics:!1}},display:{resources:{tablatureFont:"bold 14px Arial, sans-serif",barNumberColor:"rgba(121, 121, 121, 1)",barNumberFont:"bold 11px Arial, sans-serif",markerFont:"italic bold 14px Georgia, serif",staffLineColor:"rgba(183, 183, 183, 1)",barSeparatorColor:"rgba(176, 176, 176, 1)",mainGlyphColor:"rgba(0,0,0, 1)",secondaryGlyphColor:"rgba(0,0,0, 0.4)",scoreInfoColor:"rgba(118, 0, 0, 1)"}}}),this.setOnChange(t),this._api.scoreLoaded.on(i=>{i.stylesheet.bracketExtendMode=JO.BracketExtendMode.NoBrackets;for(let s of i.tracks)if(!s.isPercussion)for(let a of s.staves)a.showTablature&&(a.showStandardNotation=!1)}),this._api.midiLoaded.on(i=>{this._loadSuccess()}),this._api.error.on(i=>{this._loadFail()}),this._api.playerReady.on(()=>{}),this._api.playerFinished.on(i=>{this._fireOnChange()}),this._api.playerStateChanged.on(i=>{this._fireOnChange()}),this._api.soundFontLoaded.on(()=>{console.log("soundFontLoaded")}))}get tracks(){return this._tracks}setOnChange(e){this._onChange=e}get isLoaded(){return this._isLoaded}get isLoading(){return this._isLoading}get speed(){return this._api?this._api.playbackSpeed:1}set speed(e){!this._api||e<.5||e>this.maxSpeed||(console.log(e),this._api.playbackSpeed=e,this._fireOnChange())}get maxSpeed(){return 1}get isPlaying(){return this._api?this._api.playerState==QO.PlayerState.Playing:!1}playPause(){this._api&&this._api.isReadyForPlayback&&this._api.playPause()}rewind(){this._api&&this._api.isReadyForPlayback&&(this._api.stop(),this._api.scrollToCursor())}get isLoop(){return!!this._api?.isLooping}toggleLoop(){this._api&&(this._api.isLooping=!this._api.isLooping,this._fireOnChange())}get isSolo(){return this.hasTracks?this._tracks[this._selectedTrack].isSolo:!1}toggleSolo(){this.hasTracks&&this._tracks[this._selectedTrack].toggleSolo()}get isMute(){return this.hasTracks?this._tracks[this._selectedTrack].isMute:!1}toggleMute(){this.hasTracks&&this._tracks[this._selectedTrack].toggleMute()}loadTab(e){this._api&&(this.closeTab(),this._api.load(e))}closeTab(){this._api&&(this._api.stop(),this._api.isLooping=!1,this._initVars(),this._fireOnChange())}get hasTracks(){return this._api&&this._tracks.length>0&&this._isLoaded}get selectedTrackName(){return this.hasTracks?this._tracks[this._selectedTrack].name:""}get selectedTrackIndex(){return this.hasTracks?this._selectedTrack:-1}selectTrack(e){!this.hasTracks||e<0||e>=this._tracks.length||this._selectedTrack==e||(this._selectedTrack=e,this._api.renderTracks([this._apiTrack(e)]),this._fireOnChange())}get tabTitle(){return this.hasTracks?this._api.score.title:""}get tabTitleArtist(){return this.hasTracks?this._api.score.title+" "+this._api.score.artist:""}_initVars(){this._initTracks(),this._isLoaded=!1,this._isLoading=!0,this._tracks=[],this._selectedTrack=-1,this._speed=120}_loadSuccess(){this._isLoaded||(this._api.playbackSpeed=1,this._speed=1,this._isLoaded=!0,this._isLoading=!1,this._reloadTracks(),this._fireOnChange())}_loadFail(){this._isLoaded=!1,this._isLoading=!1,this._fireOnChange()}_initTracks(){this._tracks=[],this._selectedTrack=-1}_reloadTracks(){this._initTracks();const e=this._api.score.tracks;for(let t=0;t<e.length;t++){const i=this._apiTrack(t);this._tracks.push(new ZO(this,t,i.name,i.playbackInfo.isMute,i.playbackInfo.isSolo,i.playbackInfo.volume))}this._tracks.length>0&&(this._selectedTrack=0)}_changeTrackMute(e,t){if(!this.hasTracks)return!1;this._api.changeTrackMute([this._apiTrack(e)],t),this._fireOnChange()}_changeTrackSolo(e,t){if(!this.hasTracks)return!1;this._api.changeTrackSolo([this._apiTrack(e)],t),this._fireOnChange()}_changeTrackVolume(e,t){if(!this.hasTracks)return!1;this._api.changeTrackVolume([this._apiTrack(e)],t/16),this._fireOnChange()}_fireOnChange(){this._onChange&&this._onChange()}_apiTrack(e){return this._api.score.tracks[e]}}function e4(n){const e=O.useCallback(t=>{const i=document.activeElement?.tagName;t.ctrlKey||t.metaKey||t.altKey||i==="INPUT"||i==="TEXTAREA"||document.activeElement?.isContentEditable||(t.code==="Space"||t.key===" ")&&(t.preventDefault(),n())},[n]);O.useEffect(()=>(window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)),[e])}const Ff="#54D11ABF",If="#89a8ebff",t4=Ke(pg)({color:"white",backgroundColor:Ff,width:80,"&:hover":{backgroundColor:Jo(Ff,.2)},"&.Mui-selected":{color:"white",backgroundColor:Ff},"&.Mui-selected:hover":{backgroundColor:Jo(Ff,.2)}});Ke(pg)({color:"white",backgroundColor:If,"&:hover":{backgroundColor:Jo(If,.2)},"&.Mui-selected":{color:"white",backgroundColor:If},"&.Mui-selected:hover":{backgroundColor:Jo(If,.2)}});function i4(){const n=O.useRef(null),[e]=O.useState(()=>new jO),[t,i]=O.useState(0);e.setOnChange(k),O.useEffect(()=>{e.init(n.current,k)},[]),e4(o);function s(_){typeof _=="string"&&(_="assets/tabs/"+_),e.loadTab(_)}function a(){e.closeTab()}function o(){e.playPause()}function c(){e.rewind()}function h(_){e.speed=_}function d(){e.toggleLoop()}function p(){e.toggleMute()}function g(){e.toggleSolo()}function y(){i(t+1)}function k(){y()}return V.jsx(V.Fragment,{children:V.jsxs(sa,{height:"100vh",width:"100vw",overflow:"hidden",alignItems:"center",justifyContent:"center",children:[V.jsxs(Ic,{sx:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},children:[V.jsx(Ic,{sx:{position:"absolute",inset:0},children:V.jsx("div",{style:{overflowY:"auto",overflowX:"hidden",position:"relative",width:"100%",height:"100%"},children:V.jsx("div",{ref:n})})}),V.jsxs(sa,{spacing:4,sx:{position:"absolute",inset:0,display:e.isLoading?"flex":"none",justifyContent:"center",alignItems:"center",bgcolor:"white",zIndex:2e3},children:[V.jsx(Px,{}),V.jsx(Ya,{variant:"h5",children:"Loading..."})]}),V.jsx(Ic,{sx:{position:"absolute",inset:0,display:e.isLoaded?"none":"flex",justifyContent:"center",bgcolor:"lightgrey",zIndex:2001},children:V.jsx(Dx,{onLoadTab:s,tabLib:window.g_tabFiles,sx:{maxWidth:400,width:"100%"}})})]}),V.jsx(PM,{position:"static",color:"default",variant:"outlined",children:V.jsxs(sa,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"100%",maxWidth:900,mx:"auto",p:.5,spacing:1,children:[V.jsxs(sa,{direction:"row",alignItems:"center",spacing:1,children:[V.jsxs(sa,{alignItems:"center",children:[V.jsx(Wh,{size:"medium",color:"primary",onClick:a,disabled:!e.isLoaded,children:V.jsx(b5,{fontSize:"inherit"})}),V.jsx(Ya,{variant:"caption",children:"Tabs"})]}),V.jsx(Ic,{minWidth:250,children:V.jsxs(Tx,{value:e.selectedTrackIndex<0?"":e.selectedTrackIndex,displayEmpty:!0,onChange:_=>e.selectTrack(Number(_.target.value)),renderValue:()=>e.selectedTrackName,MenuProps:{anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},PaperProps:{sx:{maxHeight:"100%"}}},fullWidth:!0,disabled:!e.isLoaded,children:[V.jsxs(sa,{direction:"row",p:1,spacing:1,alignItems:"center",justifyContent:"center",children:[V.jsx(Ya,{variant:"h6",children:e.tabTitle}),V.jsx("a",{target:"_blank",href:`https://www.youtube.com/results?search_query=${e.tabTitleArtist}`,children:V.jsx(w5,{sx:{color:"red",display:"flex",alignItems:"center"}})})]}),e.tracks.map(_=>V.jsx(bA,{value:_.index,children:V.jsx(B5,{tracks:e.tracks,track:_})},_.id))]})})]}),V.jsxs(sa,{direction:"row",spacing:1,alignItems:"center",children:[V.jsx(pg,{size:"large",onClick:c,disabled:!e.isLoaded,children:V.jsx(_5,{})}),V.jsx(t4,{size:"large",selected:e.isPlaying,onChange:o,disabled:!e.isLoaded,children:e.isPlaying?V.jsx(k5,{}):V.jsx(S5,{})})]}),V.jsxs(sa,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",children:[V.jsx(Uf,{title:"Loop",selected:e.isLoop,onChange:d,disabled:!e.isLoaded,iconOn:V.jsx(mB,{}),iconOff:V.jsx(mB,{})}),V.jsx(Uf,{title:"Solo",selected:e.isSolo,onChange:g,disabled:!e.isLoaded,iconOn:V.jsx(Ex,{}),iconOff:V.jsx(Cx,{})}),V.jsx(Uf,{title:"Mute",selected:e.isMute,onChange:p,disabled:!e.isLoaded,iconOn:V.jsx(Nx,{}),iconOff:V.jsx(vx,{})}),V.jsx(Mx,{title:"Speed",speed:e.speed,maxSpeed:e.maxSpeed,onChange:h,disabled:!e.isLoaded})]})]})})]})})}q2.createRoot(document.getElementById("root")).render(V.jsx(O.StrictMode,{children:V.jsxs(CD,{theme:y5,children:[V.jsx(dL,{}),V.jsx(i4,{})]})}));
